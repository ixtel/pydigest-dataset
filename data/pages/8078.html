<html><body><div><div class="entry-content">

                

                <p>Gitter - это система для создания чатов для пользователей Github. 
Чаты бесплатны, есть интеграция с Github, есть API - что еще для небольшого чата надо?</p>
<p>Сегодня мы научимся писать в чат с помощью API. В заголовке отметил, что будем писать от своего лица, поэтому будет все просто.</p>
<p>Для начала стоит изучить возможность API -&gt; <a href="https://developer.gitter.im/docs/welcome">https://developer.gitter.im/docs/welcome</a></p>
<p>После чего авторизуйтесь:</p>
<p><img alt="Image" src="http://old.pynsk.ru/images/posts/gitter_1.png"/></p>
<p>После авторизации вы попадете на страницу https://developer.gitter.im/apps с таким контентом</p>
<p><img alt="Image" src="http://old.pynsk.ru/images/posts/gitter_2.png"/></p>
<p>Как вы заметили - access_token, вот он, сразу готовый. Для нашей задачи его достаточно.
Сохраняем и пишем следующий код:</p>
<div class="highlight"><pre><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="kn">import</span> <span class="nn">requests</span>


<span class="k">class</span> <span class="nc">Gitter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Gitter API wrapper</span>
<span class="sd">    URL: https://developer.gitter.im/docs/welcome</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="sd">"""token: access_token</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">room_id_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_room_id_dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_rooms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""get all room information</span>
<span class="sd">        """</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'Accept'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
            <span class="s1">'Authorization'</span><span class="p">:</span> <span class="s1">'Bearer {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://api.gitter.im/v1/rooms'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_room_id_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        """</span>
        <span class="n">room_id_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rooms</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">room</span><span class="p">[</span><span class="s1">'githubType'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'ONETOONE'</span><span class="p">:</span>
                <span class="n">room_id_dict</span><span class="p">[</span><span class="n">room</span><span class="p">[</span><span class="s1">'uri'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">room</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">room_id_dict</span>

    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">"""send message to room</span>
<span class="sd">        """</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
            <span class="s1">'Accept'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
            <span class="s1">'Authorization'</span><span class="p">:</span> <span class="s1">'Bearer {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">room_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">room_id_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">'https://api.gitter.im/v1/rooms/{room_id}/chatMessages'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">room_id</span><span class="o">=</span><span class="n">room_id</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'text'</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="n">gitter</span> <span class="o">=</span> <span class="n">Gitter</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">gitter</span><span class="o">.</span><span class="n">room_id_dict</span><span class="p">)</span>
    <span class="c1"># Пример имени канала - pythondigest/pythondigest</span>
    <span class="c1"># gitter.send_message('&lt;ИМЯ КАНАЛА&gt;', 'Тестовое сообщание с помощью API')</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">token</span> <span class="o">=</span> <span class="s1">'&lt;ВАШ TOKEN&gt;'</span>

    <span class="n">main</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>


<p>В коде видно, что при создании объекта Gitter мы получаем список доступных комнат и сохраняем себе. Внутренний словарь запоминает соответствие id'шников каналов и человеко-понятных названий. 
И с помощью метода send_message отправляем сообщение в канал.</p>
<p>Вот и все.</p>
            </div>
            
</div></body></html>