<html><body><div><div class=" highlight hl-ipython3"><pre><span/><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGSIZE</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="k">for</span> <span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="n">test_color</span><span class="p">,</span> <span class="n">train_color</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[({},</span> <span class="p">(</span><span class="s1">'#d7191c'</span><span class="p">,</span> <span class="s1">'#2c7bb6'</span><span class="p">)),</span>
                                          <span class="p">({</span><span class="s1">'learning_rate'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'subsample'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
                                           <span class="p">(</span><span class="s1">'#fdae61'</span><span class="p">,</span> <span class="s1">'#abd9e9'</span><span class="p">))]:</span>
    <span class="n">est</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                    <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">est</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">test_dev</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">deviance_plot</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">fmt_params</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
                                 <span class="n">train_color</span><span class="o">=</span><span class="n">train_color</span><span class="p">,</span> <span class="n">test_color</span><span class="o">=</span><span class="n">test_color</span><span class="p">)</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Even lower test error'</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">test_dev</span><span class="p">[</span><span class="mi">399</span><span class="p">]),</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="o">**</span><span class="n">annotation_kw</span><span class="p">)</span>

<span class="n">est</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                <span class="n">subsample</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">test_dev</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">deviance_plot</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">fmt_params</span><span class="p">({</span><span class="s1">'subsample'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}),</span>
                             <span class="n">train_color</span><span class="o">=</span><span class="s1">'#abd9e9'</span><span class="p">,</span> <span class="n">test_color</span><span class="o">=</span><span class="s1">'#fdae61'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Subsample alone does poorly'</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">test_dev</span><span class="p">[</span><span class="mi">299</span><span class="p">]),</span> 
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">),</span> <span class="o">**</span><span class="n">annotation_kw</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">'small'</span><span class="p">)</span>
</pre></div>

</div></body></html>