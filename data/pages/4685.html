<html><body><div><div class="postcontents">
                    <p>Cleo 0.3 is now out. It introduces decorators, validators, autocompletion and removes the need to
declare a <code>configure</code> method when creating a command.</p>

<h2 id="decorators">Decorators</h2>

<p>You can now declare a command, and its associated arguments and options, with decorators:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">cleo</span> <span class="kn">import</span> <span class="n">Application</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>

<span class="nd">@app.command</span><span class="p">(</span><span class="s">'demo:greet'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">'Greets someone'</span><span class="p">)</span>
<span class="nd">@app.option</span><span class="p">(</span><span class="s">'yell'</span><span class="p">,</span> <span class="n">value_required</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="nd">@app.argument</span><span class="p">(</span><span class="s">'last_name'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">'Your last name?'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="nd">@app.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">'Who do you want to greet?'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">'Hello </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">'Hello'</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s">'yell'</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="n">o</span><span class="o">.</span><span class="n">writeln</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code></pre></div>

<div class="note">
<p>If you do not set the command name via the <code>command()</code> decorator, it will automatically get the name of the decorated function.</p>
</div>

<h2 id="validators">Validators</h2>

<p>Cleo now supports validators for arguments and options.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.option</span><span class="p">(</span><span class="s">'iterations'</span><span class="p">,</span> <span class="n">value_required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">Integer</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="c"># ...</span></code></pre></div>

<div class="note">
<p>It is important to note that there is no <code>String()</code> validator.</p>
<p>The reason is quite simple: <strong>By default, the command line arguments and options are considered strings</strong>, so there is no need to specify it.</p>
</div>

<h3 id="boolean">Boolean</h3>

<p>The <code>Boolean()</code> validator accepts the following values: <strong>1</strong>, <strong>true</strong>, <strong>yes</strong>, <strong>y</strong>, <strong>on</strong> and their negatives (<strong>0</strong>, <strong>no</strong>, <strong>n</strong>, <strong>off</strong>) or native boolean types (<strong>True</strong>, <strong>False</strong>).</p>

<h3 id="integer-and-float">Integer and Float</h3>

<p>These two are self explanatory.</p>

<h3 id="range">Range</h3>

<p>The <code>Range()</code> validator accepts a value that must be comprised inside a specified range.</p>

<p>The range can be of anything that can be compared to the specified value, like integers, floats or string.</p>

<p>The default validator for ranges is <code>Integer</code> but it can be changed</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Not including the boundaries</span>
<span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">include_min</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_max</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># Float validator</span>
<span class="n">Range</span><span class="p">(</span><span class="mf">12.34</span><span class="p">,</span> <span class="mf">56.78</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="n">Float</span><span class="p">())</span>

<span class="c"># String validator (just pass None as validator value)</span>
<span class="n">Range</span><span class="p">(</span><span class="s">'c'</span><span class="p">,</span> <span class="s">'h'</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span></code></pre></div>

<h3 id="choiceenum">Choice/Enum</h3>

<p>The <code>Choice()</code> (or its alias <code>Enum()</code>) restricts a possible value to a specified set of choices.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Choice</span><span class="p">([</span><span class="s">'orange'</span><span class="p">,</span> <span class="s">'blue'</span><span class="p">,</span> <span class="s">'yellow'</span><span class="p">])</span>

<span class="c"># With validator</span>
<span class="n">Choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">validator</span><span class="o">=</span><span class="n">Integer</span><span class="p">())</span></code></pre></div>

<h3 id="named-validators">Named validators</h3>

<p>Instead of declaring explicitely the validators it is possible to use their internal names:</p>

<ul>
  <li><code>Boolean</code>: <code>boolean</code></li>
  <li><code>Integer</code>: <code>integer</code></li>
  <li><code>Float</code>: <code>float</code></li>
  <li><code>Choice/Enum</code>: <code>choice</code> or <code>enum</code></li>
  <li><code>Range</code>: <code>range</code></li>
</ul>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.option</span><span class="p">(</span><span class="s">'iterations'</span><span class="p">,</span> <span class="n">value_required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="s">'integer'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="c"># ...</span></code></pre></div>

<div class="note">
<p>When using named validators, the corresponding generated validator will have its default options.</p>
</div>

<h2 id="autocompletion">Autocompletion</h2>

<p>Cleo now supports autocompletion of commands.
However it is not completely automatic. First you have to use the <code>bash_completion.sh</code> file:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># In your .bashrc or .zshrc</span>
<span class="nb">source</span> /path/to/bash_completion.sh</code></pre></div>

<p>Now, if your script is named <code>console</code> autocompletion is set. If not add a line like the following:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">complete</span> -F _complete_console you-script-name</code></pre></div>

<h2 id="a-new-way-to-declare-commands-via-classes">A new way to declare commands via classes</h2>

<p>In previous versions when you used classes to declare commands you needed to override
the <code>configure</code> method, like so:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">HelloCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">'Says hello!'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">InputArgument</span><span class="o">.</span><span class="n">REQUIRED</span><span class="p">,</span> <span class="s">'The name'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>

        <span class="n">o</span><span class="o">.</span><span class="n">writeln</span><span class="p">(</span><span class="s">'Hello &lt;info&gt;</span><span class="si">%s</span><span class="s">&lt;/info&gt;'</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></code></pre></div>

<p>Now, it is no longer necessary since you can set the parameters as class variables:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">HelloCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s">'hello'</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s">'Says hello!'</span>

    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">'name'</span><span class="p">:</span> <span class="s">'name'</span><span class="p">,</span>
            <span class="s">'description'</span><span class="p">:</span> <span class="s">'The name'</span><span class="p">,</span>
            <span class="s">'required'</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>

        <span class="n">o</span><span class="o">.</span><span class="n">writeln</span><span class="p">(</span><span class="s">'Hello &lt;info&gt;</span><span class="si">%s</span><span class="s">&lt;/info&gt;'</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></code></pre></div>

<p>There is a lot more you can do with Cleo, you can just give a look at the documentation: <a href="http://cleo.readthedocs.org">http://cleo.readthedocs.org</a>.</p>

                </div>
                </div></body></html>