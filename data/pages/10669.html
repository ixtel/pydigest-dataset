<html><body><div><div class="post-body entry-content" id="post-body-8761855371961990423" itemprop="description articleBody">


<meta charset="utf-8"/>



<p>I just uploaded mypy-lang 0.3 to PyPI! This release focuses on
further PEP 484 compatibility and Python 2 compatibility, but it also
contains many general improvements. The changes are too numerous to
enumerate them all. Instead, I'll focus here on the most visible and
useful ones.

</p><p>I'm also happy to announce new mypy core developers Guido, David
Fisher and Greg Price, who have joined the project thanks to support
from our employer, Dropbox. This has given mypy development a big
boost, and mypy is currently under very active development.

</p><p><b>Mypy 0.3 breaks backward compatibility. You may have to modify your
code to be PEP 484 compatible if you have been using mypy-lang from
PyPI.</b> As before, mypy is experimental and still has known bugs and
limitations. In particular, we still don't have library stubs for many
commonly used modules. Please report any new issues you encounter --
we try to respond quickly to all user requests, and bugs are often
fixed rapidly.

</p><h2>Feature Highlights</h2>

<ul>

<li>Python 2 support -- now basically all Python 2.7 syntax is
supported in Python 2 mode. Mypy also supports a comment-based
function annotation syntax for Python 2 that was added to PEP 484
<a href="https://www.python.org/dev/peps/pep-0484/#suggested-syntax-for-python-2-7-and-straddling-code">recently</a>. It
also works for code that aims to be both Python 2 and 3
compatible. More about this below.

</li><li>Improved PEP 484 support. Mypy now supports most PEP 484 features
(not yet, however, <tt>sys.version_info</tt> checks), and several
non-standard features have been removed.

</li><li>Partial Python 3.5 support (though async/await are sadly still not supported).

</li><li>New experimental type checking modes (<tt>--silent-imports</tt>
and <tt>--implicit-any</tt> command-line options) that make it much
easier to type check subsets of a larger code base (see discussion of
developer workflow improvements below).

</li><li>Improved type inference -- fewer variable annotations are
required, and mypy is much less likely to give the annoying "Cannot
determine type of x" errors.

</li><li>Many bug fixes and better Python compatibility.

</li><li>Numerous standard library stub improvements (via typeshed, see below).
</li></ul>

<h2>GitHub Changes</h2>

<ul>
<li>The mypy github repository has moved to the Python organization.
The new URL is <a href="https://github.com/python/mypy">https://github.com/python/mypy</a>.

</li><li>Library stubs now live in a separate repo called typeshed
(<a href="https://github.com/python/typeshed">https://github.com/python/typeshed</a>).
The idea of the repository is
make stubs a shared resource between all Python type checking or
inference related projects.

</li></ul>

<h2>Python 2 Support</h2>

<p>Mypy now has experimental Python 2.7 support! For code that needs
to be Python 2 compatible, function type annotations are given in
comments, since the function annotation syntax was introduced in
Python 3. Mypy has had partial, unofficial Python 2 support for a
while, but only now it is actually usable and standard (after a recent
PEP 484 update).

</p><p>Run mypy in Python 2 mode by using the <tt>--py2</tt> option:

</p><pre>
    $ mypy --py2 program.py
</pre>

<p>To run your program, you must have the <tt>typing</tt> module in
your module search path. Use <tt>pip install typing</tt> to install
the module (it also works for Python 3).

</p><p>Python 2 support was a lot of work and here is a summary of some of
the most obvious changes:

</p><ul>
<li>Support pretty much all of Python 2 only syntax, including the print statement and the <tt>except Ex, err:</tt> syntax.
</li><li>Provide Python 2 stubs for many library modules (now in typeshed, as mentioned earlier.)
</li><li>Better Python 2 implementation of <tt>typing</tt>.
</li><li>Document Python 2 support.
</li><li>Make stub generator support generating Python 2 stubs (the stub generator is still highly experimental and not at all well documented, but it has already been pretty useful anyway.)
</li></ul>

<p>The example below illustrates Python 2 function type annotation
syntax. This is also valid in Python 3 mode:

</p><pre>
    from typing import List

    items = []  # type: List[str]

    def hello(): # type: () -&gt; None
        print 'hello'

    class Example:
        def method(self, lst, opt=0, *args, **kwargs):
            # type: (List[str], int, *str, **bool) -&gt; int
            ...
</pre>

<p>Here are some things to note:

</p><ul>
<li>Type syntax for variables is the same as Python 3.
</li><li>Function annotations are in comments and look quite a bit like Python 3 annotations.
</li><li>The module <tt>typing</tt> is available in Python 2 mode and things like <tt>Any</tt> must be imported from it, even if they are only used in comments.
</li><li>You don't provide an annotation for the <tt>self</tt>/<tt>cls</tt> variable of methods.
</li><li>The annotation can be on the same line as the function header or on the following line.
</li><li>You don't need to use string literal escapes for forward references within comments.
</li></ul>

<h2>Better PEP 484 Compatibility</h2>

<p>Several changes improve PEP 484 compatibility. Mypy still doesn't
implement quite everything in PEP 484, but we are pretty close.

</p><h3>Undefined Removed</h3>

<p>As the final version of PEP 484 doesn't include <tt>Undefined</tt>,
mypy no longer supports it. It's easy to migrate old code to not
use <tt>Undefined</tt> -- just use type comments. For example,
refactor this

</p><pre>
      from typing import Undefined
      x = Undefined(int)
</pre>

<p>to this:

</p><pre>
      x = None  # type: int
</pre>

<h3>Support for Callable[..., t]</h3>

<p>Mypy supports callable types with unspecified argument types. Just
replace the arguments with an explicit <tt>...</tt>:

</p><pre>
    from typing import Callable
    def call_a_lot(func: Callable[..., int]) -&gt; None:
        kwargs = {'arg': 1}
        func(1, x=y, **kwargs)  # OK, no checking of arguments
</pre>

<h3>Support for Homogeneous Tuples (Tuple[t, ...])</h3>

<p>Mypy now has a type for homogeneous, variable-length
tuples: <tt>Tuple[t, ...]</tt> (with an explicit <tt>...</tt>). These
can be used like sequences, but the concrete type must be a
tuple. These are useful for several library functions that expect
concrete tuples, and also let us give precise types for <tt>*args</tt>
arguments, which are tuples.


</p><h3>@no_type_check</h3>

<p>You can use the <tt>@no_type_check</tt> decorator to skip all type
checks within a function. It also lets you use function annotations
for non-mypy uses:

</p><pre>
    from typing import no_type_check

    @no_type_check
    def special_annotations(arg: {'value': 1}) -&gt; 1234:   # Fine!
        1 + ''  # We can do all sorts of crazy things here, and mypy is silent!
</pre>

<h3>Changes to Name Visibility in Stubs</h3>

<p>As per PEP 484, mypy no longer export names imported in stubs,
unless they are imported via <tt>as</tt>. For example, this stub won't
export <tt>Tuple</tt> any more:

</p><pre>
    from typing import Tuple

    def my_function() -&gt; Tuple[int, str]: ...
</pre>

<p>This is especially nice together if you import a module with a stub
using <tt>from module import *</tt>, as your namespace won't get
polluted with random names imported by the stub from <tt>typing</tt>.

</p><p>If in a stub you import using <tt>from m import *</tt>, everything
in <tt>m</tt> will get exported. This makes it easy for a stub to
re-export all definitions from another module.


</p><h3>Using ... in Stubs</h3>

<p>PEP 484 recommends using an ellipsis (<tt>...</tt>) instead
of <tt>pass</tt> for empty function and class bodies in stubs. It can
can also be used as variable initializers and default argument
values. This example illustrates all of these:

</p><pre>
    # This is stub file
    var = ...  # type: int
    def function(arg: str = ...) -&gt; int: ...
    class VeryBadError(Exception): ...
</pre>

<h3>bytearray Is Compatible with bytes</h3>

<p>Mypy considers <tt>bytearray</tt> to be compatible
with <tt>bytes</tt> (as per PEP 484). This simplifies stub files and
annotations, as previously we often had to use <tt>Union[bytes,
bytearray]</tt> or something similar, which was hard to remember to do
consistently.

</p><h2>Workflow Improvements</h2>

<p>This release has several experimental improvements to running mypy
against your code. These are subject to change in the future and not
very well documented, but they are useful enough that I'll introduce
them anyway:

</p><ul>

<li>You can give an arbitrary number of files or directories to type
check on the mypy command line (e.g. <tt>mypy file1.py file2.py
dir</tt>). Mypy will recurse into a directory argument if it contains
an <tt>__init__.py</tt> or <tt>__init__.pyi</tt> (stub) file, looking
for <tt>.py</tt> and <tt>.pyi</tt> files. If the directory is not a
package, it'll only look for <tt>.py</tt> / <tt>.pyi</tt> files within
the given directory but not in subdirectories.

</li><li>You can ask mypy to ignore files outside those explicitly
mentioned on the command line (or inferred by the directory traversal
algorithm discussed above) via <tt>--silent-imports</tt>. Stubs are
still consulted, but other than that mypy will not try to follow
imports to other modules or complain about missing stubs. This makes
it easy to start experimenting with mypy on a subset of a larger
codebase without getting a huge number of errors about missing stubs
and similar.

</li><li>By default mypy type checks only functions with annotations. You
can give mypy a the option <tt>--implicit-any</tt> to implicitly give
an annotation with all <tt>Any</tt> types for every unannotated
function. This way mypy can do useful (though a bit limited) type
checking for unannotated code. As you add function annotations, mypy
will do an incrementally better job. In the future, something like
this may be the default mode of operation, once we get this good
enough.

</li></ul>

<h2>Miscellanea</h2>


<p>Here are some additional improvements:

</p><ul>
<li>Mypy now continues processing files after errors and can report errors in multiple files in a single run
</li><li>Rudimentary <tt>__new__</tt> support
</li><li>Better type inference for <tt>isinstance</tt> checks, including support for <tt>and</tt> and <tt>not</tt> operations involving <tt>isinstance</tt> and multiple checks per condition
</li><li>Using a value with <tt>Any</tt> type as a base class (this is very useful together with <tt># type: ignore</tt>)
</li><li>Support for <tt>@abstractproperty</tt>
</li></ul>

<p>There are also some interesting work-in-progress features such as a new automatic stub generator.

</p><h2>Acknowledgements</h2>

<p>First of all, I'd like to thank Dropbox for contributing very
significant engineering resources to improving mypy, including some of
my time! We've been experimenting with using mypy on Dropbox code and
initial results are promising, even though there are some big unsolved
challenges ahead, such as type checking performance and scaling to
very large codebases (but we are working on these!).

</p><p>Also, thanks to Guido and Matt Robben for feedback on earlier
drafts of this article.

</p><p>Many people contributed to this release. Thanks to everybody who
helped! Apologies if I've missed anybody (this includes contributions
to typeshed):

</p><ul>
<li>Andrew Aldridge
</li><li>Anup Chenthamarakshan
</li><li>Ben Darnell
</li><li>Ben Longbons
</li><li>ctcutler
</li><li>Daniel Shaulov
</li><li>Darjus Loktevic
</li><li>David Fisher
</li><li>David Shea
</li><li>Della Anjeh
</li><li>Eric Price
</li><li>Gigi Sayfan
</li><li>Greg Price
</li><li>Guido van Rossum
</li><li>Howard Lee
</li><li>Ian Cordasco
</li><li>icoxfog417
</li><li>Igor Vuk
</li><li>ismail-s
</li><li>James Guthrie
</li><li>Jared Hance
</li><li>Jing Wang
</li><li>Jukka Lehtosalo
</li><li>Kyle Consalus
</li><li>Li Haoyi
</li><li>Matthew Wright
</li><li>Matthias Bussonnier
</li><li>Matthias Kramm
</li><li>Michael Walter
</li><li>Michal Pokorný
</li><li>Mihnea Giurgea
</li><li>Motoki Naruse
</li><li>Prayag Verma
</li><li>Robert T. McGibbon
</li><li>Roy Williams
</li><li>Ryan Gonzalez
</li><li>Sander Kersten
</li><li>Sebastian Reuße
</li><li>Seo Sanghyeon
</li><li>Tad Leonard
</li><li>Tim Abbott
</li><li>Vita Smid
</li><li>Vlad Shcherbina
</li><li>Wen Zhang
</li><li>wizzardx
</li><li>Yuval Langer
</li></ul>

<p>An up-to-date list of all mypy code contributions is available at the
<a href="https://github.com/python/mypy/graphs/contributors">GitHub
contributors page</a>.



</p><p/>
</div>
</div></body></html>