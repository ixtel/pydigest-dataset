<html><body><div><p class="lead" itemprop="description">В начале двухтысячных свет увидела игра испанских разработчиков Severance: Blade of Darkness. Давайте поглядим, что она из себя представляла и как использовала Питон.</p>
                <div class="py_user"><p>У меня дома на полках компьютерного стола разместилось некоторое количество дисков с </p><a href="http://instagram.com/p/deysw-lHTH" target="_blank">программным обеспечением</a><p> и </p><a href="http://instagram.com/p/mpSB4qFHaG" target="_blank">играми</a><p>. Периодически с дисками приключается ревизия и они уходят, поэтому сейчас на полках их остаётся всего около 30-ти. Вчера вечером мой взгляд упал на эту стопку, и я понял, о чём буду писать в очередной статье.</p><p>Эта статья посвящена игре </p><b>Blade of Darkness</b><p> и применению в ней Питона. Сразу признаюсь, что игру дальше первого обучающего уровня варваром никогда не проходил, а потому для меня самого остаётся загадкой, как этому диску до сих пор удаётся пережить ревизии. Видимо есть что-то в этой игре. Игре, в которую в те времена невозможно было играть по двум причинам: 1. требовательность к графическому процессору (игра едва ворочалась на первом 3Dfx) и объему оперативной памяти; 2. фактическая невозможность управления персонажем без джойстика.</p><p>Пожалуй, достаточно для вступления, айда к обзору.</p><p>Переместившись в директорию с файлами игры практически сразу можно определить, что Питон использовался здесь практически для всего, и не имеет отношения разве что к моделям персонажей и объектов, к графическому и звуковому оформлению. </p><b>Bin</b> <p>В этой директории можно увидеть файл динамически связываемой библиотеки, содержащей интерпретатор Питона — </p><i>python15.dll</i><p>. Именно с его помощью отрабатывают скрипты, о которых будет рассказано далее. Обратите внимание на его размер — 667,7 кБ — весьма скромно. Это, конечно, не </p><i>Lua</i><p> за 275,9 кБ, но вполне по-божески. В этой же директории находятся и другие библиотеки, используемые в скриптах. </p><b>Config</b> <p>Это директория со скриптами конфигурации игры и управления. Ничего особенного.</p><b>Data</b> <p>В основном содержит файлы графического оформления, но встречается и скрипты, назначение которых — локализация игры. Файлы из </p><b>Data/Menu</b><p> содержат словари со строками локализации меню и HUD. В </p><b>Data/ObjIds</b><p> можно отыскать названия игровых объектов (предметов, оружие и пр.). Основная часть текстов, связанных с уровнями и персонажами находится в </p><b>Data/Text</b><p>.</p><b>Lib</b> <p>Пожалуй, самая интересная директория. В файлах, находящихся здесь, расположена бОльшая часть движка игры. </p><p>Здесь всё: управление камерой, инвентарём и оружием, позиционирование предметов и персонажей, рассчёты физики предметов и частиц, последовательности анимации и кинематографические эффекты, отрисовка элементов ГИП (GUI), конфигурирование сетевой игры и пр. и пр.</p><p>В </p><b>Lib/PythonLib</b><p> находятся модули Питона. Судя по тому, что здесь есть модули, не использованные в скриптах, здешние модули входили в обычную поставку Питона, то есть, о выборочной сборке речи не идёт.</p><b>Maps</b>  <p>Директория содержит уровни игры. Хотите верьте, хотите нет, но уровни тоже сконфигурированы при помощи Питона. Здесь и расстановка объектов, и камера, и диалоги, и музыкальное оформление по районам.</p><b>Scripts</b><p>Если в </p><i>Lib</i><p> лежали составляющие организма игры, то здесь обретается мозг, координирующий действия тех составляющих. Здесь находятся файлы инициализации игровой машинерии. Здесь же можно отыскать сценарии скелетной анимации. Здесь же скрипты, привязывающие звуки к тем или иным анимациям. И прочее, по мелочи.</p><b>Stats</b><p>Здесь лежит файл </p><i>CharData.py</i><p>, отвечающий за характеристики игровых персонажей.</p><b>Обзор кода</b><p>Код на питоне трудно сделать нечитабельным (во времена 1.5 сделать это было куда сложнее), поэтому с пониманием происходящего у вас, скорее всего, проблем возникнуть не должно, даже не смотря на описания, местами выполненные на испанском. Строк документации, кстати сказать, мало.</p><p>В глаза бросается слабая структурированность проекта. За это говорят и отсутствие разбивки на модули, приводившее к необходимости файлов типа </p><i>Lib/megaimport.py</i><p>, и засорение глобального пространства имён (обратите внимание на обилие директив </p><code>global</code><p>) со всеми вытекающими из него проблемами быстродействия (см. </p><i>Lib/Reference.py</i><p>), и закомментированные, и повторяющиеся куски кода.</p><p>Обратите внимание — практически везде используются функции, но функционального программирования как такового здесь почти нет.</p><p>А ещё здесь никаким PEP-8 даже не пахнет, в силу того, что он тогда ещё не родился: верблюжий регистр в именах функций, методов, атрибутов, переменных; табуляция и несистематизированные импорты.</p><p>Примечательно, что для сохранение игровых данных, используя модуль </p><code>cPickle</code><p>.</p><p>Для отладки проекта, похоже использовали всё, что попадало под руку: это и классический </p><code>print</code><p>, и  </p><code>pdb</code><p>, и собственное решение, основанный на </p><code>Bdb</code><p> класс отладки </p><b>Bldb</b><p> (Blade Python debugger).</p><p>Для того, чтобы использовать Сишные библиотеки (находятся, как мы помним, в директории </p><b>Bin</b><p>), разработчики запускали автогенератор обёрток </p><a href="http://www.swig.org/" target="_blank">SWIG</a><p> (привет Дэвиду Бизли!) и использовали полученный код как есть без прикрас. Нужно ли говорить, что свиговские обёртки без прикрас выглядят довольно страшно.</p><b>Послесловие</b><p>Этот короткий обзор, конечно, лишь верхушка айсберга. При желании в коде можно отыскать ещё много интересного. Однако моей задачей было показать вам, что и в те теперь уже почти далёкие годы Питон уже использовался для создания игр. И, как видно из примера </p><b>Blade of Darkness</b><p>, использоваться он мог совершенно в разных частях игрового приложения.</p><p>Предвосхищая вопрос где взять эту фантасмагорию — </p><a href="http://www.gog.com/game/blade_of_darkness" target="_blank">ссылка на GOG</a><p> (в Steam игра замечена не была), и модификация этого года, чтобы глаз радовался — </p><a href="http://www.moddb.com/mods/blade-of-light" target="_blank">Blade of Light</a><p>.</p><i>Играйте в хорошие игры с друзьями, делайте хорошие игры при помощи Python.</i><p>P.S.: Джедаем быть хотите? Вам в </p><i>Lib/cheats.py</i><p>.</p></div>

                

                

                </div></body></html>