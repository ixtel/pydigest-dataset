<html><body><div><div class="col-lg-10 col-md-12 col-sm-12 col-xs-12 col-lg-offset-1">
                                <h1>Visualize Abstract Syntax Trees (ASTs) to better understand Python</h1>
                                <p class="meta-info">
                                    <em>December 01, 2015</em> written by <em>Adrian Vogelsgesang</em>, Category: <em>Open Source</em>
                                </p>

                                
                                
                                

                                <p/><h2>Abstract Syntax Trees (ASTs)</h2>
<p>On your way to become a real programming expert, there is a great chance that you'll come across Abstract Syntax Trees (ASTs.) As the name suggests, ASTs are an abstract, tree-like representation of your source code. They resemble the structure of your program are an intermediate representation of your code. Here's an example:</p>
<div class="codehilite"><pre><span class="c"># Python code</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"Python"</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"{0} is great"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>


<p>Â </p>
<div class="codehilite"><pre><span class="c1"># Abstract syntax tree</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">functiondef</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">main</span>
  <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">arguments</span>
    <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
    <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
    <span class="l-Scalar-Plain">kwarg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
    <span class="l-Scalar-Plain">vararg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
  <span class="l-Scalar-Plain">decorator_list</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
  <span class="l-Scalar-Plain">docstring</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
  <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">assign</span>
    <span class="l-Scalar-Plain">targets</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name</span>
      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name</span>
      <span class="l-Scalar-Plain">ctx</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">node_type</span><span class="p-Indicator">:</span> <span class="nv">store</span><span class="p-Indicator">}</span>
    <span class="l-Scalar-Plain">value</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">node_type</span><span class="p-Indicator">:</span> <span class="nv">str</span><span class="p-Indicator">,</span> <span class="nv">s</span><span class="p-Indicator">:</span> <span class="nv">Python</span><span class="p-Indicator">}</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">print</span>
    <span class="l-Scalar-Plain">dest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
    <span class="l-Scalar-Plain">nl</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">values</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">call</span>
      <span class="l-Scalar-Plain">func</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">attribute</span>
        <span class="l-Scalar-Plain">value</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">node_type</span><span class="p-Indicator">:</span> <span class="nv">str</span><span class="p-Indicator">,</span> <span class="nv">s</span><span class="p-Indicator">:</span> <span class="s">'{0}</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">great'</span><span class="p-Indicator">}</span>
        <span class="l-Scalar-Plain">attr</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">format</span>
        <span class="l-Scalar-Plain">ctx</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">node_type</span><span class="p-Indicator">:</span> <span class="nv">load</span><span class="p-Indicator">}</span>
      <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">node_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name</span>
        <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name</span>
        <span class="l-Scalar-Plain">ctx</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">node_type</span><span class="p-Indicator">:</span> <span class="nv">load</span><span class="p-Indicator">}</span>
      <span class="l-Scalar-Plain">starargs</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
      <span class="l-Scalar-Plain">keywords</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
      <span class="l-Scalar-Plain">kwargs</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
</pre></div>


<p>As you can see, ASTs represent your code in a very different way. They ommit information thats not necessary for the interpreter/compiler (e.g., parantheses, punctuations, whitespaces, string prefixed, etc.), but they can also contain additional information that's required for translating your code into byte- or machine code.</p>
<h2>Use cases</h2>
<p>Traditionally, ASTs are used by an interpreter or compiler to generate the executable byte- or machine code of your program. However, they also allow you to ...</p>
<ul>
<li>better understand a programming language</li>
<li>comprehend, how code is interpreted/compiled</li>
<li>understand how certain language constructs work</li>
<li>to build static code analysis tools</li>
</ul>
<h2>AST visualization</h2>
<p>At QuantifiedCode, we use ASTs as starting point for our <a href="/how-it-works">data-driven static code analyzers</a>. They allow us to build code checks by creating simple <a href="http://docs.quantifiedcode.com/patterns/language/index.html">(graph) queries</a>. For testing purposes, we built a GraphViz based AST visualizer that helps us to "debug" certain code checks that we create. The following visualizations shows the example from above:</p>
<p><img alt="&quot;Python AST visualization&quot;" src="/static/assets/gfx/blog/2015-10/python-ast-visualization-example-1.png"/></p>
<h2>Practical use cases</h2>
<p>Even though you might not be building static code analysis tools, ASTs and their  visualizations can help you to better understand how Python works internally. Obviously, everything is usally in the docs, but a deeper can help you increase undstanding of the language.  Let's look at the following code example:</p>



<p>Intuitively, most developers expect that this statement returns <code>True</code>, because their intuition parses the code like this:</p>



<p>In reality, this statement returns <code>False</code>, as Python parses the code as follows:</p>
<div class="codehilite"><pre><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="mi">4</span>
</pre></div>


<p>If you look at the AST, you can get a better understanding of what is happening. What you can see below is that Python does not even uses parantheses or they <code>and</code> keyword to priorize the order of the calculations:</p>
<div class="codehilite"><pre>- node_type: expr
  value:
    node_type: compare
    left: {node_type: num, n: 1}
    comparators:
        - {node_type: num, n: 2}
        - {node_type: num, n: 3}
        - {node_type: num, n: 4}
    ops:
        - {node_type: lt}
        - {node_type: eq}
        - {node_type: lt}
</pre></div>


<p>What happens internally is the following:</p>
<ul>
<li>Initially Python compares the first node (the number <code>1</code>) with the first comparators (the number <code>2</code>), using the first operator (<code>lt</code>)</li>
<li>Then, the first comparator (the number two <code>2</code>) will be compared with the second comparator (the number <code>3</code>), using the second operator (<code>eq</code>), and so on.</li>
<li>Finally, the results will be merged using an <code>and</code> statement (you can't see that here).</li>
</ul>
<p>Use our <a href="https://github.com/quantifiedcode/python-ast-visualizer.git">open source Python AST visualizer</a> to visualize the ASTs of your code. It is a fast way to help you understand how Python interprets your code. Certainly, this is not replacing the extensive Python documentation, but it is nice way to explore a programming language from a new angle and helps you to better understand the behaviours of certain language constructs.</p>
<p><img alt="&quot;Python AST visualization&quot;" src="/static/assets/gfx/blog/2015-10/python-ast-visualization-example-2.png"/></p>

                                <hr class="space-top-50 space-bottom-50"/>

                                <div class="row author">
    
    <div class="col-lg-9 col-md-9 col-sm-12 col-xs-12">
        <h5>Published by Adrian Vogelsgesang</h5>
        
            <p>Adrian is student at the Elite Graduate Program for Software Engineering, a joint initative of the TU Augsburg, TU Munich and LMU Munich. He's a full-stack developer and has an academic focus on formal methods that prove the validity of software programs.</p>
            
        
    </div>
</div>

                                <hr class="space-top-20 "/>

                                <nav class="">
                                  
                                </nav>
                                <hr class="space-top-5 space-bottom-10"/>
                                

                                <hr/>
                                <p id="disqus_thread"/>

                            </div>
                        </div></body></html>