<html><body><div><div class="entry-content">
			<p>Hello everybody!</p>
<p>I want to present you my latest project: “German Continuous Speech Recognition”. I’m using Archlinux, so some commands will be “Arch-specific”. Don’t go away if you are using other distros, all in all it is the same. In the next steps we will install sphinxbase and pocketsphinx.</p>
<p>To start I needed to compile and install some software. I had a big issue, because python3 is the standard python under ArchLinux so i created extra PKGBUILDs for the two programs (they are not ready, but working, if you’re interested take a look at the bottom of the page). The main aspect was, that i can later remove or update these packages normally as other programs installed via the repositories.</p>
<p>Let’s create a working directory:</p>
<pre class="lang:default decode:true">mkdir voice_recognition; cd voice_recognition</pre>
<p>If you’re using the PKGBUILDs you can step the following compiling and installing instructions.</p>
<p>First we need to install Sphinxbase. I use the latest version from the Github-Repository.<br/>
We clone the remote repository with:</p>
<pre class="lang:default decode:true ">git clone git://github.com/cmusphinx/sphinxbase.git</pre>
<p>a folder called sphinxbase should be created. Enter this folder with:</p>
<pre class="lang:default decode:true">cd sphinxbase</pre>
<p>Now you are in the folder. Call the autogen.sh file to create the makefiles and automatically run ./configure with it.</p>
<pre class="lang:default decode:true">./autogen</pre>
<p>If you have all dependencies installed, we can go on and compile the sourcecode:</p>
<pre class="lang:default decode:true">make</pre>
<p>After that install sphinxbase with:</p>
<pre class="lang:default decode:true">sudo make install</pre>
<p>Now we have to go back into the working directory:</p>
<pre class="lang:default decode:true">cd ..</pre>
<p>Do the same steps for pocketsphinx:</p>
<pre class="lang:default decode:true">git clone git://github.com/cmusphinx/pocketsphinx.git</pre>
<p>Enter the folder:</p>
<pre class="lang:default decode:true">cd pocketsphinx</pre>
<p>Run autogen.sh</p>
<pre class="lang:default decode:true">./autogen</pre>
<p>Compile the sourcecode:</p>
<pre class="lang:default decode:true">make</pre>
<p>Install pocketsphinx:</p>
<pre class="lang:default decode:true">sudo make install</pre>
<p>Go back into the working directory:</p>
<pre class="lang:default decode:true">cd ..</pre>
<p>Now the two requiered programs are installed. But the Languagemodel, Dictionary and HiddenMarkovModel Files are missing. 
For my recognition I'm using the model from: http://goofy.zamia.org/voxforge/de/<br/>
To download it run:</p>
<pre class="lang:default decode:true">wget http://goofy.zamia.org/voxforge/de/voxforge-de-r20140813.tgz</pre>
<p>Now extract it:</p>
<pre class="lang:default decode:true">tar xvzf voxforge-de-r20140813.tgz</pre>
<p>In the created folder called voxforge… you will find a sh file called run-pocketsphinx.sh. You have to edit it:</p>
<pre class="lang:default decode:true">cd voxforge-de-r20140813; nano run-pocketsphinx.sh</pre>
<p>Change the content to the following:</p>
<pre class="lang:default decode:true">
#!/bin/bash
pocketsphinx_continuous \
    -hmm model_parameters/voxforge.cd_cont_3000 \
    -lw 10 -feat 1s_c_d_dd -beam 1e-80 -wbeam 1e-40 \
    -dict etc/voxforge.dic \
    -wip 0.2 \
    -agc none -varnorm no -cmn current -inmic yes \
    -lm etc/voxforge.lm.DMP
</pre>
<p>(Safe with: Ctrl+O and exit with Ctrl+X)<br/>
A -inmic parameter was in the new pocketsphinx version added, but the voxforge file is not uptodate.</p>
<p>If you want to test everything you can just run:</p>
<pre class="lang:default decode:true">./run-pocketsphinx.sh</pre>
<p>You should get some results. If not checkout the freenode channel #cmusphinx. These guys helped me a lot. (Thanks to @nshm and vklimkov)</p>
<p>——————————————————————————————————————</p>
<p>If you came this far i want to present you my python-programm: I’m working on a styled-terminal version, but it is not ready yet.</p>
<pre class="lang:default decode:true">
#!/usr/bin/env python2
from pocketsphinx import *

hmm = 'voxforge-de-r20140813/model_parameters/voxforge.cd_cont_3000'
dic = 'voxforge-de-r20140813/etc/voxforge.dic'
lm= 'voxforge-de-r20140813/etc/voxforge.lm.DMP'

config = Decoder.default_config()
config.set_string('-hmm', hmm)
config.set_string('-lm', lm)
config.set_string('-dict', dic)
config.set_string('-logfn', '/dev/null')

decoder = Decoder(config)

p = pyaudio.PyAudio()

stream = p.open(format=pyaudio.paInt16, channels=1, rate=16000, input=True, frames_per_buffer=1024)
stream.start_stream()
in_speech_bf = True
decoder.start_utt('')
while True:
    buf = stream.read(1024)
    if buf:
        decoder.process_raw(buf, False, False)
        try:
            if  decoder.hyp().hypstr != '':
                print 'Partial decoding result:', decoder.hyp().hypstr
        except AttributeError:
            pass
        if decoder.get_in_speech():
            sys.stdout.write('.')
            sys.stdout.flush()
        if decoder.get_in_speech() != in_speech_bf:
            in_speech_bf = decoder.get_in_speech()
            if not in_speech_bf:
                decoder.end_utt()
                try:
                    if  decoder.hyp().hypstr != '':
                        print 'Stream decoding result:', decoder.hyp().hypstr
                except AttributeError:
                    pass
                decoder.start_utt('')
    else:
        break
decoder.end_utt()
print 'An Error occured:', decoder.hyp().hypstr
</pre>
<p id="gui"/>
<p>Here is an alpha Version of a Gtk GUI i developed:</p>
<pre class="lang:default decode:true">
https://github.com/mattze96/pocketsphinx-python
</pre>
					</div>
		
		</div></body></html>