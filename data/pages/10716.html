<html><body><div><div id="content">

            
            <h1>Infix Operators in Python <p class="datebox">January 22, 2012</p></h1>
            
            
            
            <img src="http://imgs.xkcd.com/comics/rps.png" title="Thanks go to Oren Held; and XKCD, of course" class="blog-post-image"/>
            
            
            <p>As you may already know, there are 3 kinds of operators calling-notations: <strong>prefix</strong> (<code>+ 3 5</code>),
<strong>infix</strong> (<code>3 + 5</code>), and <strong>postfix</strong> (<code>3 5 +</code>). Prefix (as well as postfix) operators are used
in languages like LISP/Scheme, and have the nice property of not requiring parenthesis —
there’s only one way to read an expression like <code>3 5 + 2 *</code>, unlike <code>3 + 5 * 2</code>.
On the other hand, it reduces code readability and the locality of operators and their arguments.
This is why we all love infix operators.</p>

<p>Now imagine I have a function, <code>add(x,y)</code>, and I have an expression like <code>add(add(add(5,6),7),8)</code>...
wouldn’t it be cool if I could use infix notation here? Sadly though, Python won’t allow you to
define new operators or change how functions take their arguments... but that doesn’t
mean we have to give up!</p>

<p>Haskell, for instance, allows you to define custom operators and set their precedence, as well
as invoking "normal" functions as infix operators. Suppose you have a function <code>f(x,y)</code> — you
can invoke it like <code>f 5 6</code> or <code>5 `f` 6</code> (using backticks). This allows us to turn
our previous expression, <code>add(add(add(5,6),7),8)</code>, into <code>5 `add` 6 `add` 7 `add` 8</code>,
which is much more readable. But how can we do this in Python?</p>

<p>Well, there’s this <a href="http://code.activestate.com/recipes/384122-infix-operators/">Cookbook recipe</a>
that provides a very nice way to achieving the same functionality in Python (adapted a little by me):</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">class</span> <span class="nc">Infix</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
    <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Infix</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span></code></pre></div>


<p>Using instances of this peculiar class, we can now use a new "syntax" for calling functions as
infix operators:</p>

<div class="highlight"><pre><code class="language-pycon" data-lang="pycon"><span class="gp">&gt;&gt;&gt; </span><span class="nd">@Infix</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">5</span> <span class="o">|</span><span class="n">add</span><span class="o">|</span> <span class="mi">6</span>
<span class="go">11</span></code></pre></div>


<p>Surrounding decorated functions with pipes (bitwise ORs) allows them to take their parameters
infix-ly. Using this, we can do all sorts of cool things:</p>

<div class="highlight"><pre><code class="language-pycon" data-lang="pycon"><span class="gp">&gt;&gt;&gt; </span><span class="n">instanceof</span> <span class="o">=</span> <span class="n">Infix</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="mi">5</span> <span class="o">|</span><span class="n">instanceof</span><span class="o">|</span> <span class="nb">int</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">"yes"</span>
<span class="gp">...</span>
<span class="go">yes</span></code></pre></div>


<p>And even <a href="http://en.wikipedia.org/wiki/Currying">curry</a> functions:</p>

<div class="highlight"><pre><code class="language-pycon" data-lang="pycon"><span class="gp">&gt;&gt;&gt; </span><span class="n">curry</span> <span class="o">=</span> <span class="n">Infix</span><span class="p">(</span><span class="n">partial</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">|</span><span class="n">curry</span><span class="o">|</span> <span class="mi">3</span>
<span class="go">&lt;functools.partial object at 0xb7733dec&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span><span class="n">curry</span><span class="o">|</span> <span class="mi">3</span> <span class="o">|</span><span class="n">curry</span><span class="o">|</span> <span class="mi">4</span> <span class="o">|</span><span class="n">curry</span><span class="o">|</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="p">()</span>
<span class="go">12</span></code></pre></div>


<p>Ain’t that cool?</p>



            
            
            
            

            
            
            
            
            

            

        </div>
    </div></body></html>