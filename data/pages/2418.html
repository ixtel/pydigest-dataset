<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-mochi" class="anchor" href="#mochi" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Mochi</h1>

<p>Mochi is a dynamically typed programming language for functional programming and actor-style programming.</p>

<p>Its interpreter is written in Python3. The interpreter translates a program written in Mochi to Python3's AST / bytecode.</p>

<h2><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Features</h2>

<ul>
<li>Python-like syntax</li>
<li>Tail recursion optimization (self tail recursion only), and no loop syntax</li>
<li>Re-assignments are not allowed in function definition.</li>
<li>Basic collection type is a persistent data structure. (using Pyrsistent)</li>
<li>Pattern matching / Data types, like algebraic data types</li>
<li>Pipeline operator</li>
<li>Syntax sugar of anonymous function definition</li>
<li>Actor, like the actor of Erlang (using Eventlet)</li>
<li>Macro, like the traditional macro of Lisp</li>
<li>Builtin functions includes functions exported by itertools module, recipes, functools module and operator module</li>
</ul>

<h2><a id="user-content-examples" class="anchor" href="#examples" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Examples</h2>

<h3><a id="user-content-factorial" class="anchor" href="#factorial" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Factorial</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">factorial</span>(<span class="pl-smi">n</span>, <span class="pl-smi">m</span>):
    <span class="pl-k">if</span> n <span class="pl-k">==</span> <span class="pl-c1">1</span>:
        m
    <span class="pl-k">else</span>:
        factorial(n <span class="pl-k">-</span> <span class="pl-c1">1</span>, n <span class="pl-k">*</span> m)


factorial(<span class="pl-c1">10000</span>, <span class="pl-c1">1</span>)
<span class="pl-c"># =&gt; 28462596809170545189064132121198688...</span>

<span class="pl-c"># Or</span>

<span class="pl-k">def</span> factorial:
    n: factorial(n, <span class="pl-c1">1</span>)
    <span class="pl-c1">0</span>, acc: acc
    n, acc: factorial(n <span class="pl-k">-</span> <span class="pl-c1">1</span>, acc <span class="pl-k">*</span> n)

factorial(<span class="pl-c1">10000</span>)
<span class="pl-c"># =&gt; 28462596809170545189064132121198688...</span></pre></div>

<h3><a id="user-content-fizzbuzz" class="anchor" href="#fizzbuzz" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>FizzBuzz</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">fizzbuzz</span>(<span class="pl-smi">n</span>):
    match [n <span class="pl-k">%</span> <span class="pl-c1">3</span>, n <span class="pl-k">%</span> <span class="pl-c1">5</span>]:
        [<span class="pl-c1">0</span>, <span class="pl-c1">0</span>]: <span class="pl-s"><span class="pl-pds">"</span>fizzbuzz<span class="pl-pds">"</span></span>
        [<span class="pl-c1">0</span>, _]: <span class="pl-s"><span class="pl-pds">"</span>fizz<span class="pl-pds">"</span></span>
        [_, <span class="pl-c1">0</span>]: <span class="pl-s"><span class="pl-pds">"</span>buzz<span class="pl-pds">"</span></span>
        _: n

<span class="pl-c1">range</span>(<span class="pl-c1">1</span>, <span class="pl-c1">31</span>)
<span class="pl-k">|</span><span class="pl-k">&gt;</span> <span class="pl-c1">map</span>(fizzbuzz)
<span class="pl-k">|</span><span class="pl-k">&gt;</span> pvector()
<span class="pl-k">|</span><span class="pl-k">&gt;</span> <span class="pl-c1">print</span>()</pre></div>

<h3><a id="user-content-actor" class="anchor" href="#actor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Actor</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">show</span>():
    receive:
        message:
            <span class="pl-c1">print</span>(message)
            show()

actor <span class="pl-k">=</span> spawn(show)

send(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, actor)
actor ! <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span> <span class="pl-c"># send('bar', actor)</span>

sleep(<span class="pl-c1">1</span>)
<span class="pl-c"># -&gt; foo</span>
<span class="pl-c"># -&gt; bar</span>


<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> !<span class="pl-k">&gt;</span> spawn(show)

sleep(<span class="pl-c1">1</span>)
<span class="pl-c"># -&gt; foo</span>

[<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>] !<span class="pl-k">&amp;</span><span class="pl-k">&gt;</span> spawn(show)
<span class="pl-c"># The meaning of the above is the same as the meaning of the following.</span>
<span class="pl-c"># spawn(show) ! 'foo'</span>
<span class="pl-c"># spawn(show) ! 'bar'</span>

sleep(<span class="pl-c1">1</span>)
<span class="pl-c"># -&gt; foo</span>
<span class="pl-c"># -&gt; bar</span>

<span class="pl-k">def</span> <span class="pl-en">show_loop</span>():
    receive:
        [tag, value]:
            <span class="pl-c1">print</span>(tag, value)
            show_loop()

actor2 <span class="pl-k">=</span> spawn(show_loop)

actor2 ! [<span class="pl-s"><span class="pl-pds">"</span>bar<span class="pl-pds">"</span></span>, <span class="pl-c1">2000</span>]
sleep(<span class="pl-c1">1</span>)
<span class="pl-c"># -&gt; bar 2000</span>

[<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-c1">1000</span>] !<span class="pl-k">&gt;</span> spawn(show_loop)
sleep(<span class="pl-c1">1</span>)
<span class="pl-c"># -&gt; foo 1000</span>

[[<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-c1">1000</span>],[<span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>, <span class="pl-c1">2000</span>]] !<span class="pl-k">&amp;</span><span class="pl-k">&gt;</span> spawn(show_loop)
sleep(<span class="pl-c1">1</span>)
<span class="pl-c"># -&gt; foo 1000</span>
<span class="pl-c"># -&gt; bar 2000</span></pre></div>

<h3><a id="user-content-distributed-computing" class="anchor" href="#distributed-computing" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Distributed Computing</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># comsumer.mochi</span>
<span class="pl-k">from</span> mochi.actor.mailbox <span class="pl-k">import</span> KombuMailbox, ZmqInbox, SQSMailbox

<span class="pl-k">def</span> <span class="pl-en">consumer</span>():
    receive:
        <span class="pl-s"><span class="pl-pds">'</span>exit<span class="pl-pds">'</span></span>:
            <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>exit!<span class="pl-pds">'</span></span>)
        other:
            <span class="pl-c1">print</span>(other)
            consumer()

kombu_mailbox <span class="pl-k">=</span> KombuMailbox(<span class="pl-s"><span class="pl-pds">'</span>sqs://&lt;access_key_id&gt;@&lt;secret_access_key&gt;:80//<span class="pl-pds">'</span></span>,
                             <span class="pl-s"><span class="pl-pds">'</span>&lt;queue_name&gt;<span class="pl-pds">'</span></span>,
                             <span class="pl-c1">dict</span>(<span class="pl-v">region</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>&lt;region&gt;<span class="pl-pds">'</span></span>))
spawn_with_mailbox(consumer, kombu_mailbox)

zmq_mailbox <span class="pl-k">=</span> ZmqInbox(<span class="pl-s"><span class="pl-pds">'</span>tcp://*:9999<span class="pl-pds">'</span></span>)
spawn_with_mailbox(consumer, zmq_mailbox)

sqs_mailbox <span class="pl-k">=</span> SQSMailbox(<span class="pl-s"><span class="pl-pds">'</span>&lt;queue_name&gt;<span class="pl-pds">'</span></span>)
spawn_with_mailbox(consumer, sqs_mailbox)

wait_all()</pre></div>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># producer.mochi</span>
<span class="pl-k">from</span> mochi.actor.mailbox <span class="pl-k">import</span> KombuMailbox, ZmqOutbox, SQSMailbox

kombu_mailbox <span class="pl-k">=</span> KombuMailbox(<span class="pl-s"><span class="pl-pds">'</span>sqs://&lt;access_key_id&gt;@&lt;secret_access_key&gt;:80//<span class="pl-pds">'</span></span>,
                             <span class="pl-s"><span class="pl-pds">'</span>&lt;queue_name&gt;<span class="pl-pds">'</span></span>,
                             <span class="pl-c1">dict</span>(<span class="pl-v">region</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>&lt;region&gt;<span class="pl-pds">'</span></span>))
kombu_mailbox ! [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]
kombu_mailbox ! <span class="pl-s"><span class="pl-pds">'</span>exit<span class="pl-pds">'</span></span>

zmq_mailbox <span class="pl-k">=</span> ZmqOutbox(<span class="pl-s"><span class="pl-pds">'</span>tcp://localhost:9999<span class="pl-pds">'</span></span>)
zmq_mailbox ! [<span class="pl-c1">4</span>, <span class="pl-c1">5</span>, <span class="pl-c1">6</span>]
zmq_mailbox ! <span class="pl-s"><span class="pl-pds">'</span>exit<span class="pl-pds">'</span></span>

sqs_mailbox <span class="pl-k">=</span> SQSMailbox(<span class="pl-s"><span class="pl-pds">'</span>&lt;queue_name&gt;<span class="pl-pds">'</span></span>)
sqs_mailbox ! [<span class="pl-c1">7</span>, <span class="pl-c1">8</span>, <span class="pl-c1">9</span>]
sqs_mailbox ! <span class="pl-s"><span class="pl-pds">'</span>exit<span class="pl-pds">'</span></span></pre></div>

<h3><a id="user-content-flask" class="anchor" href="#flask" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Flask</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> flask <span class="pl-k">import</span> Flask

app <span class="pl-k">=</span> Flask(<span class="pl-s"><span class="pl-pds">'</span>demo<span class="pl-pds">'</span></span>)

<span class="pl-en">@app.route</span>(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>)
<span class="pl-k">def</span> <span class="pl-en">hello</span>():
    <span class="pl-s"><span class="pl-pds">'</span>Hello World!<span class="pl-pds">'</span></span>

app.run()</pre></div>

<h3><a id="user-content-rxpy" class="anchor" href="#rxpy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>RxPY</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># usage: mochi -no-mp timer.mochi</span>
<span class="pl-c"># original:</span>
<span class="pl-c"># https://github.com/ReactiveX/RxPY/blob/master/examples/parallel/timer.py</span>

<span class="pl-k">import</span> rx
<span class="pl-k">import</span> concurrent.futures
<span class="pl-k">import</span> time

seconds <span class="pl-k">=</span> [<span class="pl-c1">5</span>, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">4</span>, <span class="pl-c1">3</span>]


<span class="pl-k">def</span> <span class="pl-en">sleep</span>(<span class="pl-smi">t</span>):
    time.sleep(t)
    <span class="pl-k">return</span> t


<span class="pl-k">def</span> <span class="pl-en">output</span>(<span class="pl-smi">result</span>):
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-c1">%d</span> seconds<span class="pl-pds">'</span></span> <span class="pl-k">%</span> result)


<span class="pl-k">with</span> concurrent.futures.ProcessPoolExecutor(<span class="pl-c1">5</span>) <span class="pl-k">as</span> executor:
    rx.Observable.from_(seconds)
                 .flat_map((s) <span class="pl-ii">-&gt;</span> executor.submit(sleep, s))
                 .subscribe(output)

<span class="pl-c"># 1 seconds</span>
<span class="pl-c"># 2 seconds</span>
<span class="pl-c"># 3 seconds</span>
<span class="pl-c"># 4 seconds</span>
<span class="pl-c"># 5 seconds</span></pre></div>

<h3><a id="user-content-aif-anaphoric-macro" class="anchor" href="#aif-anaphoric-macro" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>aif (Anaphoric macro)</h3>

<div class="highlight highlight-source-python"><pre>macro aif(test, true_expr, false_expr):
    quasi_quote:
        it <span class="pl-k">=</span> unquote(test)
        <span class="pl-k">if</span> it:
            unquote(true_expr)
        <span class="pl-k">else</span>:
            unquote(false_expr)

aif([], first(it), <span class="pl-s"><span class="pl-pds">"</span>empty<span class="pl-pds">"</span></span>)
<span class="pl-c"># =&gt; "empty"</span>
aif([<span class="pl-c1">10</span>, <span class="pl-c1">20</span>], first(it), <span class="pl-s"><span class="pl-pds">"</span>empty<span class="pl-pds">"</span></span>)
<span class="pl-c"># =&gt; 10</span></pre></div>

<h2><a id="user-content-requirements" class="anchor" href="#requirements" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Requirements</h2>

<ul>
<li>CPython &gt;= 3.2 or PyPy &gt;= 3.2.1</li>
<li>rply &gt;= 0.7.2</li>
<li>pyrsistent &gt;= 0.10.1</li>
<li>pathlib &gt;= 1.0.1</li>
<li>eventlet &gt;= 0.17.1</li>
<li>msgpack-python &gt;= 0.4.6</li>
<li>typeannotations &gt;= 0.1.0</li>
</ul>

<h2><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h2>



<h3><a id="user-content-optional-installation" class="anchor" href="#optional-installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Optional Installation</h3>

<div class="highlight highlight-source-shell"><pre>$ pip3 install flask Flask-RESTful Pillow RxPY  <span class="pl-c"># to run the examples</span>
$ pip3 install pyzmq <span class="pl-c"># to use ZmqInbox and ZmqOutbox</span>
$ pip3 install kombu <span class="pl-c"># to use KombuMailbox</span>
$ pip3 install boto <span class="pl-c"># to use SQS as transport of KombuMailbox</span>
$ pip3 install boto3 <span class="pl-c"># to use SQSMailbox</span></pre></div>

<p>Th error of the following may occur when you run Mochi on PyPy.</p>

<pre><code>ImportError: Importing zmq.backend.cffi failed with version mismatch, 0.8.2 != 0.9.2
</code></pre>

<p>In this case, please change the version of cffi to 0.8.2 using pip on PyPy.</p>

<div class="highlight highlight-source-shell"><pre>$ pip3 uninstall cffi
$ pip3 install cffi==0.8.2</pre></div>

<h2><a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage</h2>

<h3><a id="user-content-repl" class="anchor" href="#repl" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>REPL</h3>



<h3><a id="user-content-loading-and-running-a-file" class="anchor" href="#loading-and-running-a-file" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>loading and running a file</h3>

<div class="highlight highlight-source-shell"><pre>$ cat kinako.mochi
print(<span class="pl-s"><span class="pl-pds">'</span>kinako<span class="pl-pds">'</span></span>)
$ mochi kinako.mochi
kinako
$ mochi -no-mp kinako.mochi  <span class="pl-c"># not apply eventlet's monkey patching</span>
kinako</pre></div>

<h3><a id="user-content-byte-compilation" class="anchor" href="#byte-compilation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>byte compilation</h3>

<div class="highlight highlight-source-shell"><pre>$ mochi -c kinako.mochi <span class="pl-k">&gt;</span> kinako.mochic</pre></div>

<h3><a id="user-content-running-a-byte-compiled-file" class="anchor" href="#running-a-byte-compiled-file" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>running a byte-compiled file</h3>

<div class="highlight highlight-source-shell"><pre>$ mochi -e kinako.mochic
kinako
$ mochi -e -no-mp kinako.mochic  <span class="pl-c"># not apply eventlet's monkey patching</span>
kinako</pre></div>

<h3><a id="user-content-generating-pyc" class="anchor" href="#generating-pyc" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>generating .pyc</h3>

<div class="highlight highlight-source-shell"><pre>$ ls
kagami.mochi
$ cat kagami.mochi
print(<span class="pl-s"><span class="pl-pds">'</span>kagami<span class="pl-pds">'</span></span>)
$ mochi
<span class="pl-k">&gt;&gt;&gt;</span> import kagami
kagami
<span class="pl-k">&gt;&gt;&gt;</span> <span class="pl-en">exit</span>()
$ ls
kagami.mochi kagami.pyc
$ python3 kagami.pyc
kagami</pre></div>

<p>Or</p>

<div class="highlight highlight-source-shell"><pre>$ mochi -pyc kagami.mochi <span class="pl-k">&gt;</span> kagami.pyc
$ python3 kagami.pyc
kagami
$ mochi -pyc -no-mp kagami.mochi <span class="pl-k">&gt;</span> kagami.pyc  <span class="pl-c"># not apply eventlet's monkey patching</span>
$ python3 kagami.pyc
kagami</pre></div>

<h2><a id="user-content-examples-for-each-feature" class="anchor" href="#examples-for-each-feature" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Examples for each feature</h2>

<h3><a id="user-content-persistent-data-structures" class="anchor" href="#persistent-data-structures" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Persistent data structures</h3>

<div class="highlight highlight-source-python"><pre>[<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]
<span class="pl-c"># =&gt; pvector([1, 2, 3])</span>

v(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; pvector([1, 2, 3])</span>

vec <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]
vec2 <span class="pl-k">=</span> vec.set(<span class="pl-c1">0</span>, <span class="pl-c1">8</span>)
<span class="pl-c"># =&gt; pvector([8, 2, 3]</span>
vec
<span class="pl-c"># =&gt; pvector([1, 2, 3])</span>
[x, y, z] <span class="pl-k">=</span> vec
x <span class="pl-c"># =&gt; 1</span>
y <span class="pl-c"># =&gt; 2</span>
z <span class="pl-c"># =&gt; 3</span>

get(vec, <span class="pl-c1">0</span>) <span class="pl-c"># =&gt; 1</span>
get(vec, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>) <span class="pl-c"># =&gt; [1, 2]</span>

vec[<span class="pl-c1">0</span>] <span class="pl-c"># =&gt; 1</span>
vec[<span class="pl-c1">0</span>:<span class="pl-c1">2</span>] <span class="pl-c"># =&gt; [1, 2]</span>

{<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>: <span class="pl-c1">100</span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>: <span class="pl-c1">200</span>}
<span class="pl-c"># =&gt; pmap({'y': 200, 'x': 100})</span>

ma <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>: <span class="pl-c1">100</span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>: <span class="pl-c1">200</span>}
ma.get(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>) <span class="pl-c"># =&gt; 100</span>
ma.x <span class="pl-c"># =&gt; 100</span>
ma[<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>] <span class="pl-c"># =&gt; 100</span>
ma2 <span class="pl-k">=</span> ma.set(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-c1">10000</span>)
<span class="pl-c"># =&gt; pmap({'y': 200, 'x': 10000})</span>
ma <span class="pl-c"># =&gt; pmap({'y': 200, 'x': 100})</span>
get(ma, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>) <span class="pl-c"># =&gt; 200</span>
ma[<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>] <span class="pl-c"># =&gt; 200</span>

m(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-c1">100</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-c1">200</span>)
<span class="pl-c"># =&gt; pmap({'y': 200, 'x': 100})</span>

s(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; pset([1, 2, 3])</span>

b(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; pbag([1, 2, 3])</span></pre></div>

<h3><a id="user-content-function-definitions" class="anchor" href="#function-definitions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Function definitions</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">hoge</span>(<span class="pl-smi">x</span>):
    <span class="pl-s"><span class="pl-pds">'</span>hoge<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-c1">str</span>(x)

hoge(<span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; hoge3</span></pre></div>

<h3><a id="user-content-pattern-matching" class="anchor" href="#pattern-matching" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Pattern matching</h3>

<div class="highlight highlight-source-python"><pre>lis <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]

<span class="pl-c"># Sequence pattern</span>
match lis:
    [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, x]: x
    _: <span class="pl-c1">None</span>
<span class="pl-c"># =&gt; 3</span>

match lis:
    [<span class="pl-c1">1</span>, <span class="pl-k">&amp;</span>rest]: rest
    _: <span class="pl-c1">None</span>

<span class="pl-c"># =&gt; pvector([2, 3])</span>


foo_map <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>}

<span class="pl-c"># Mapping pattern</span>
match foo_map:
    {<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> : value}: value
    _: <span class="pl-c1">None</span>
<span class="pl-c"># =&gt; 'bar'</span>


<span class="pl-c"># Type pattern</span>
<span class="pl-c"># &lt;name of variable refers to type&gt; &lt;pattern&gt;: &lt;action&gt;</span>
match <span class="pl-c1">10</span>:
    <span class="pl-c1">int</span> x: <span class="pl-s"><span class="pl-pds">'</span>int<span class="pl-pds">'</span></span>
    <span class="pl-c1">float</span> x: <span class="pl-s"><span class="pl-pds">'</span>float<span class="pl-pds">'</span></span>
    <span class="pl-c1">str</span> x: <span class="pl-s"><span class="pl-pds">'</span>str<span class="pl-pds">'</span></span>
    <span class="pl-c1">bool</span> x: <span class="pl-s"><span class="pl-pds">'</span>bool<span class="pl-pds">'</span></span>
    _: <span class="pl-s"><span class="pl-pds">'</span>other<span class="pl-pds">'</span></span>
<span class="pl-c"># =&gt; 'int'</span>

match [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]:
    [<span class="pl-c1">1</span>, <span class="pl-c1">str</span> x, <span class="pl-c1">3</span>]: <span class="pl-s"><span class="pl-pds">'</span>str<span class="pl-pds">'</span></span>
    [<span class="pl-c1">1</span>, <span class="pl-c1">int</span> x, <span class="pl-c1">3</span>]: <span class="pl-s"><span class="pl-pds">'</span>int<span class="pl-pds">'</span></span>
    _: <span class="pl-s"><span class="pl-pds">'</span>other<span class="pl-pds">'</span></span>
<span class="pl-c"># =&gt; 'int'</span>

num <span class="pl-k">=</span> union(<span class="pl-c1">int</span>, <span class="pl-c1">float</span>)
vector nums[num]
vector strs[<span class="pl-c1">str</span>]

match nums([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]):
    nums[x, y, z]: z
    strs[x, y, z]: x
<span class="pl-c"># =&gt; 3</span>

Positive <span class="pl-k">=</span> predicate(<span class="pl-ii">-&gt;</span> <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>)
Even <span class="pl-k">=</span> predicate(<span class="pl-ii">-&gt;</span> <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">%</span> <span class="pl-c1">2</span> <span class="pl-k">==</span> <span class="pl-c1">0</span>)
EvenAndPositive <span class="pl-k">=</span> predicate(<span class="pl-ii">-&gt;</span> (<span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">%</span> <span class="pl-c1">2</span> <span class="pl-k">==</span> <span class="pl-c1">0</span>) <span class="pl-k">and</span> (<span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">&gt;=</span> <span class="pl-c1">0</span>)) 

match <span class="pl-c1">10</span>:
    EvenAndPositive n: <span class="pl-c1">str</span>(n) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>:Even and Positive<span class="pl-pds">'</span></span>
    Even n: <span class="pl-c1">str</span>(n) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>:Even<span class="pl-pds">'</span></span>
    Positive n: <span class="pl-c1">str</span>(n) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>:Positive<span class="pl-pds">'</span></span>

<span class="pl-c"># =&gt; 10:Even and Positive</span>


<span class="pl-c"># Or pattern</span>
match [<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-c1">100</span>]:
    [<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> <span class="pl-k">or</span> <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>, value]: value
    _: <span class="pl-c1">10000</span>
<span class="pl-c"># =&gt; 100</span>

match [<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-c1">100</span>]:
    [<span class="pl-c1">str</span> x <span class="pl-k">or</span> <span class="pl-c1">int</span> x, value]: value
    _: <span class="pl-c1">10000</span>
<span class="pl-c"># =&gt; 100</span>


<span class="pl-c"># Record pattern</span>
record Person(name, age)

foo <span class="pl-k">=</span> Person(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-c1">32</span>)

match foo:
    Person(<span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>, age):
        <span class="pl-s"><span class="pl-pds">'</span>bar:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-c1">str</span>(age)
    Person(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, age):
        <span class="pl-s"><span class="pl-pds">'</span>foo:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-c1">str</span>(age)
    _: <span class="pl-c1">None</span>
<span class="pl-c"># =&gt; 'foo:32'</span></pre></div>

<h3><a id="user-content-records" class="anchor" href="#records" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Records</h3>

<div class="highlight highlight-source-python"><pre>record Mochi
record AnkoMochi(anko) <span class="pl-k">&lt;</span> Mochi
record KinakoMochi(kinako) <span class="pl-k">&lt;</span> Mochi

anko_mochi <span class="pl-k">=</span> AnkoMochi(<span class="pl-v">anko</span><span class="pl-k">=</span><span class="pl-c1">3</span>)

<span class="pl-c1">isinstance</span>(anko_mochi, Mochi)
<span class="pl-c"># =&gt; True</span>
<span class="pl-c1">isinstance</span>(anko_mochi, AnkoMochi)
<span class="pl-c"># =&gt; True</span>
<span class="pl-c1">isinstance</span>(anko_mochi, KinakoMochi)
<span class="pl-c"># =&gt; False</span>

match anko_mochi:
    KinakoMochi(kinako): <span class="pl-s"><span class="pl-pds">'</span>kinako <span class="pl-pds">'</span></span> <span class="pl-k">*</span> kinako <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> mochi<span class="pl-pds">'</span></span>
    AnkoMochi(anko): <span class="pl-s"><span class="pl-pds">'</span>anko <span class="pl-pds">'</span></span> <span class="pl-k">*</span> anko <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>mochi<span class="pl-pds">'</span></span>
    Mochi(_): <span class="pl-s"><span class="pl-pds">'</span>mochi<span class="pl-pds">'</span></span>
<span class="pl-c"># =&gt; 'anko anko anko mochi'</span>


record Person(name, age):
    <span class="pl-k">def</span> <span class="pl-en">show</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        <span class="pl-c1">print</span>(<span class="pl-v">self</span>.name <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>: <span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-v">self</span>.age)

foo <span class="pl-k">=</span> Person(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>32<span class="pl-pds">'</span></span>)
foo.show()
<span class="pl-c"># -&gt; foo: 32</span>

<span class="pl-c"># runtime type checking</span>
record Point(x:<span class="pl-c1">int</span>, y:<span class="pl-c1">int</span>, z:optional(<span class="pl-c1">int</span>))
Point(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">None</span>)
<span class="pl-c"># =&gt; Point(x=1, y=2, z=None)</span>
Point(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; Point(x=1, y=2, z=3)</span>
Point(<span class="pl-c1">1</span>, <span class="pl-c1">None</span>, <span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; TypeError</span></pre></div>

<h3><a id="user-content-bindings" class="anchor" href="#bindings" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Bindings</h3>

<div class="highlight highlight-source-python"><pre>x <span class="pl-k">=</span> <span class="pl-c1">3000</span>
<span class="pl-c"># =&gt; 3000</span>

[a, b] <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]
a
<span class="pl-c"># =&gt; 1</span>
b
<span class="pl-c"># =&gt; 2</span>

[c, <span class="pl-k">&amp;</span>d] <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]
c
<span class="pl-c"># =&gt; 1</span>
d
<span class="pl-c"># =&gt; pvector([2, 3])</span></pre></div>

<h3><a id="user-content-data-types-like-algebraic-data-types" class="anchor" href="#data-types-like-algebraic-data-types" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Data types, like algebraic data types</h3>

<div class="highlight highlight-source-python"><pre>data Point:
    Point2D(x, y)
    Point3D(x, y, z)

<span class="pl-c"># The meaning of the above is the same as the meaning of the following.</span>
<span class="pl-c"># record Point</span>
<span class="pl-c"># record Point2D(x, y) &lt; Point</span>
<span class="pl-c"># record Point3D(x, y, z) &lt; Point</span>

p1 <span class="pl-k">=</span> Point2D(<span class="pl-v">x</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-c1">2</span>)
<span class="pl-c"># =&gt; Point2D(x=1, y=2)</span>

p2 <span class="pl-k">=</span> Point2D(<span class="pl-c1">3</span>, <span class="pl-c1">4</span>)
<span class="pl-c"># =&gt; Point2D(x=3, y=4)</span>

p1.x
<span class="pl-c"># =&gt; 1</span></pre></div>

<h3><a id="user-content-pattern-matching-function-definitions" class="anchor" href="#pattern-matching-function-definitions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Pattern-matching function definitions</h3>

<div class="highlight highlight-source-python"><pre>data Point:
    Point2D(x, y)
    Point3D(x, y, z)

<span class="pl-k">def</span> offset:
    Point2D(x1, y1), Point2D(x2, y2):
        Point2D(x1 <span class="pl-k">+</span> x2, y1 <span class="pl-k">+</span> y2)
    Point3D(x1, y1, z1), Point3D(x2, y2, z2):
        Point3D(x1 <span class="pl-k">+</span> x2, y1 <span class="pl-k">+</span> y2, z1 <span class="pl-k">+</span> z2)
    _: <span class="pl-c1">None</span>

offset(Point2D(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>), Point2D(<span class="pl-c1">3</span>, <span class="pl-c1">4</span>))
<span class="pl-c"># =&gt; Point2D(x=4, y=6)</span>
offset(Point3D(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>), Point3D(<span class="pl-c1">4</span>, <span class="pl-c1">5</span>, <span class="pl-c1">6</span>))
<span class="pl-c"># =&gt; Point3D(x=5, y=7, z=9)</span>

<span class="pl-k">def</span> show:
    <span class="pl-c1">int</span> x, message: <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>int<span class="pl-pds">'</span></span>, x, message)
    <span class="pl-c1">float</span> x, message: <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>float<span class="pl-pds">'</span></span>, x, message)
    _: <span class="pl-c1">None</span>

show(<span class="pl-c1">1.0</span>, <span class="pl-s"><span class="pl-pds">'</span>msg<span class="pl-pds">'</span></span>)
<span class="pl-c"># -&gt; float 1.0 msg</span>
<span class="pl-c"># =&gt; None</span>

FileMode <span class="pl-k">=</span> options(<span class="pl-s"><span class="pl-pds">'</span>r<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>w<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>r+<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>w+<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a+<span class="pl-pds">'</span></span>)

<span class="pl-k">def</span> open_file:
    <span class="pl-c1">str</span> path, FileMode mode: 
        <span class="pl-c1">open</span>(path, mode)
    <span class="pl-c1">str</span> path:
        <span class="pl-c1">open</span>(path, <span class="pl-s"><span class="pl-pds">'</span>r<span class="pl-pds">'</span></span>)</pre></div>

<h3><a id="user-content-anonymous-function" class="anchor" href="#anonymous-function" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Anonymous function</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># Arrow expression.</span>
add <span class="pl-k">=</span> (x, y) <span class="pl-ii">-&gt;</span> x <span class="pl-k">+</span> y
add(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>)
<span class="pl-c"># =&gt; 3</span>

add <span class="pl-k">=</span> <span class="pl-ii">-&gt;</span> <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-ii">$</span><span class="pl-c1">2</span>
add(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>)
<span class="pl-c"># =&gt; 3</span>

foo <span class="pl-k">=</span> (x, y) <span class="pl-ii">-&gt;</span>
    <span class="pl-k">if</span> x <span class="pl-k">==</span> <span class="pl-c1">0</span>:
        y
    <span class="pl-k">else</span>:
        x

foo(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>)
<span class="pl-c"># =&gt; 1</span>

foo(<span class="pl-c1">0</span>, <span class="pl-c1">2</span>)
<span class="pl-c"># =&gt; 2</span>

pvector(<span class="pl-c1">map</span>(<span class="pl-ii">-&gt;</span> <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">*</span> <span class="pl-c1">2</span>, [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]))
<span class="pl-c"># =&gt; pvector([2, 4, 6])</span></pre></div>

<h3><a id="user-content-pipeline-operator" class="anchor" href="#pipeline-operator" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Pipeline operator</h3>

<div class="highlight highlight-source-python"><pre>add <span class="pl-k">=</span> <span class="pl-ii">-&gt;</span> <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-ii">$</span><span class="pl-c1">2</span>
<span class="pl-c1">2</span> <span class="pl-k">|</span><span class="pl-k">&gt;</span> add(<span class="pl-c1">10</span>) <span class="pl-k">|</span><span class="pl-k">&gt;</span> add(<span class="pl-c1">12</span>)
<span class="pl-c"># =&gt; 24</span>
<span class="pl-c1">None</span> <span class="pl-k">|</span><span class="pl-k">&gt;</span><span class="pl-ii">?</span> add(<span class="pl-c1">10</span>) <span class="pl-k">|</span><span class="pl-k">&gt;</span><span class="pl-ii">?</span> add(<span class="pl-c1">12</span>)
<span class="pl-c"># =&gt; None</span></pre></div>

<h3><a id="user-content-lazy-sequences" class="anchor" href="#lazy-sequences" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Lazy sequences</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">fizzbuzz</span>(<span class="pl-smi">n</span>):
    match [n <span class="pl-k">%</span> <span class="pl-c1">3</span>, n <span class="pl-k">%</span> <span class="pl-c1">5</span>]:
        [<span class="pl-c1">0</span>, <span class="pl-c1">0</span>]: <span class="pl-s"><span class="pl-pds">"</span>fizzbuzz<span class="pl-pds">"</span></span>
        [<span class="pl-c1">0</span>, _]: <span class="pl-s"><span class="pl-pds">"</span>fizz<span class="pl-pds">"</span></span>
        [_, <span class="pl-c1">0</span>]: <span class="pl-s"><span class="pl-pds">"</span>buzz<span class="pl-pds">"</span></span>
        _: n


result <span class="pl-k">=</span> <span class="pl-c1">range</span>(<span class="pl-c1">1</span>, <span class="pl-c1">31</span>) <span class="pl-k">|</span><span class="pl-k">&gt;</span> <span class="pl-c1">map</span>(fizzbuzz)
pvector(result)
<span class="pl-c"># =&gt; pvector([1, 2, fizz, 4, 'buzz', 'fizz', 7, 8, 'fizz', 'buzz', 11, 'fizz', 13, 14, 'fizzbuzz', 16, 17, 'fizz', 19, 'buzz', 'fizz', 22, 23, 'fizz', 'buzz', 26, 'fizz', 28, 29, 'fizzbuzz'])</span>
pvector(result)
<span class="pl-c"># =&gt; pvector([])</span>
pvector(result)
<span class="pl-c"># =&gt; pvector([])</span>


<span class="pl-c"># Iterator -&gt; lazyseq</span>
lazy_result <span class="pl-k">=</span> <span class="pl-c1">range</span>(<span class="pl-c1">1</span>, <span class="pl-c1">31</span>) <span class="pl-k">|</span><span class="pl-k">&gt;</span> <span class="pl-c1">map</span>(fizzbuzz) <span class="pl-k">|</span><span class="pl-k">&gt;</span> lazyseq()
pvector(lazy_result)
<span class="pl-c"># =&gt; pvector([1, 2, fizz, 4, 'buzz', 'fizz', 7, 8, 'fizz', 'buzz', 11, 'fizz', 13, 14, 'fizzbuzz', 16, 17, 'fizz', 19, 'buzz', 'fizz', 22, 23, 'fizz', 'buzz', 26, 'fizz', 28, 29, 'fizzbuzz'])</span>
pvector(lazy_result)
<span class="pl-c"># =&gt; pvector([1, 2, fizz, 4, 'buzz', 'fizz', 7, 8, 'fizz', 'buzz', 11, 'fizz', 13, 14, 'fizzbuzz', 16, 17, 'fizz', 19, 'buzz', 'fizz', 22, 23, 'fizz', 'buzz', 26, 'fizz', 28, 29, 'fizzbuzz'])</span>
pvector(lazy_result)
<span class="pl-c"># =&gt; pvector([1, 2, fizz, 4, 'buzz', 'fizz', 7, 8, 'fizz', 'buzz', 11, 'fizz', 13, 14, 'fizzbuzz', 16, 17, 'fizz', 19, 'buzz', 'fizz', 22, 23, 'fizz', 'buzz', 26, 'fizz', 28, 29, 'fizzbuzz'])</span></pre></div>

<h3><a id="user-content-trailing-closures" class="anchor" href="#trailing-closures" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Trailing closures</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># The following trailing closure expression is passed to a function as the functions first argument.</span>
result <span class="pl-k">=</span> <span class="pl-c1">map</span>([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]) <span class="pl-ii">-&gt;</span>
    <span class="pl-c1">print</span>(<span class="pl-ii">$</span><span class="pl-c1">1</span>)
    <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">*</span> <span class="pl-c1">2</span>

<span class="pl-c1">print</span>(doall(result))

<span class="pl-c"># -&gt; 1</span>
<span class="pl-c"># -&gt; 2</span>
<span class="pl-c"># -&gt; 3</span>
<span class="pl-c"># =&gt; pvector([2, 4, 6])</span>


<span class="pl-k">def</span> <span class="pl-en">foreach</span>(<span class="pl-smi">closure</span>, <span class="pl-smi">seq</span>):
    doall(<span class="pl-c1">filter</span>(closure, seq))

<span class="pl-c"># The following trailing closure expression is passed to a function as the functions first argument.</span>
foreach([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]) (item) <span class="pl-ii">-&gt;</span>
    new_item <span class="pl-k">=</span> item <span class="pl-k">*</span> <span class="pl-c1">100</span>
    <span class="pl-c1">print</span>(new_item)

<span class="pl-c"># -&gt; 100</span>
<span class="pl-c"># -&gt; 200</span>
<span class="pl-c"># -&gt; 300</span>
<span class="pl-c"># =&gt; pvector([])</span>

<span class="pl-c"># Or</span>

<span class="pl-k">def</span> <span class="pl-en">foreach</span>(<span class="pl-smi">seq</span>, <span class="pl-smi">closure</span>):
    doall(<span class="pl-c1">filter</span>(closure, seq))

<span class="pl-c"># The following trailing closure expression is passed to a function as the functions final argument.</span>
foreach([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]) <span class="pl-k">@</span> (item) <span class="pl-ii">-&gt;</span>
    new_item <span class="pl-k">=</span> item <span class="pl-k">*</span> <span class="pl-c1">100</span>
    <span class="pl-c1">print</span>(new_item)

<span class="pl-c"># -&gt; 100</span>
<span class="pl-c"># -&gt; 200</span>
<span class="pl-c"># -&gt; 300</span>
<span class="pl-c"># =&gt; pvector([])</span></pre></div>

<h3><a id="user-content-short-form-for-keyword-arguments-and-dict-keys" class="anchor" href="#short-form-for-keyword-arguments-and-dict-keys" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Short form for keyword arguments and dict keys</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">foo</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>, <span class="pl-smi">c</span>):
    a <span class="pl-k">+</span> b <span class="pl-k">+</span> c

a <span class="pl-k">=</span> <span class="pl-c1">1</span>
b <span class="pl-k">=</span> <span class="pl-c1">2</span>
c <span class="pl-k">=</span> <span class="pl-c1">3</span>

<span class="pl-c"># This is the same as foo(a=a, b=b, c=c)</span>
foo(<span class="pl-k">=</span>a, <span class="pl-k">=</span>b, <span class="pl-k">=</span>c))
<span class="pl-c"># =&gt; 6</span>

<span class="pl-c"># This is the same as {'a': a, 'b': b}</span>
{=a, =b}
<span class="pl-c"># =&gt; pmap({'a': 1, 'b': 2})</span></pre></div>

<h3><a id="user-content-macros" class="anchor" href="#macros" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Macros</h3>

<div class="highlight highlight-source-python"><pre>macro rest_if_first_is_true(first, <span class="pl-k">&amp;</span>args):
     match first:
         quote(<span class="pl-c1">True</span>): quasi_quote(v(unquote_splicing(args)))
         _: quote(<span class="pl-c1">False</span>)

rest_if_first_is_true(<span class="pl-c1">True</span>, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; pvector([1, 2, 3])</span>
rest_if_first_is_true(<span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
<span class="pl-c"># =&gt; False</span>

macro pipeline(<span class="pl-k">&amp;</span>args):
    [Symbol(<span class="pl-s"><span class="pl-pds">'</span>|&gt;<span class="pl-pds">'</span></span>)] <span class="pl-k">+</span> args

pipeline([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>],
         <span class="pl-c1">map</span>(<span class="pl-ii">-&gt;</span> <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">*</span> <span class="pl-c1">2</span>),
         <span class="pl-c1">filter</span>(<span class="pl-ii">-&gt;</span> <span class="pl-ii">$</span><span class="pl-c1">1</span> <span class="pl-k">!=</span> <span class="pl-c1">2</span>),
         pvector())
<span class="pl-c"># =&gt; pvector([4, 6])</span></pre></div>

<h3><a id="user-content-including-a-file-at-compile-time" class="anchor" href="#including-a-file-at-compile-time" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Including a file at compile time</h3>

<div class="highlight highlight-source-shell"><pre>$ cat anko.mochi
x = 10000
y = 20000</pre></div>

<div class="highlight highlight-source-python"><pre>require <span class="pl-s"><span class="pl-pds">'</span>anko.mochi<span class="pl-pds">'</span></span>
x
<span class="pl-c"># =&gt; 10000</span>

x <span class="pl-k">=</span> <span class="pl-c1">30000</span>

require <span class="pl-s"><span class="pl-pds">'</span>anko.mochi<span class="pl-pds">'</span></span> <span class="pl-c"># include once at compile time</span>
x
<span class="pl-c"># =&gt; 30000</span></pre></div>

<h3><a id="user-content-module" class="anchor" href="#module" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Module</h3>

<div class="highlight highlight-source-python"><pre>module Math:
    export add, sub

    <span class="pl-k">def</span> <span class="pl-en">add</span>(<span class="pl-smi">x</span>, <span class="pl-smi">y</span>):
        x <span class="pl-k">+</span> y

    <span class="pl-k">def</span> <span class="pl-en">sub</span>(<span class="pl-smi">x</span>, <span class="pl-smi">y</span>):
        x <span class="pl-k">-</span> y

Math.add(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>)
<span class="pl-c"># =&gt; 3</span></pre></div>

<div class="highlight highlight-source-shell"><pre>$ cat foobar.mochi
foo = <span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>
bar = <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span></pre></div>

<div class="highlight highlight-source-python"><pre>require <span class="pl-s"><span class="pl-pds">'</span>foobar.mochi<span class="pl-pds">'</span></span>
[foo, bar]
<span class="pl-c"># =&gt; pvector(['foo', 'bar'])</span>

foo <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>foofoofoo<span class="pl-pds">'</span></span>

module <span class="pl-c1">X</span>:
    export foobar
    require <span class="pl-s"><span class="pl-pds">'</span>foobar.mochi<span class="pl-pds">'</span></span>
    <span class="pl-k">def</span> foobar:
        [foo, bar]

<span class="pl-c1">X</span>.foobar()
<span class="pl-c"># =&gt; pvector(['foo', 'bar'])</span>

[foo, bar]
<span class="pl-c"># =&gt; pvector(['foofoofoo', 'bar'])</span></pre></div>

<h2><a id="user-content-todo" class="anchor" href="#todo" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>TODO</h2>

<ul>
<li>Improve documentation</li>
<li>Improve parsing</li>
<li>Support type annotation</li>
</ul>

<h2><a id="user-content-license" class="anchor" href="#license" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>License</h2>

<p>MIT License</p>

<h2><a id="user-content-contributors" class="anchor" href="#contributors" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Contributors</h2>

<p><a href="https://github.com/i2y/mochi/graphs/contributors">https://github.com/i2y/mochi/graphs/contributors</a></p>
</article>
  </div></body></html>