<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-mqlalchemy" class="anchor" href="#mqlalchemy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>MQLAlchemy</h1>
<p><a href="https://travis-ci.org/repole/mqlalchemy"><img alt="Build Status" src="https://camo.githubusercontent.com/1fdb097fb9f9b0583abc568207d2e37562d8c098/68747470733a2f2f7472617669732d63692e6f72672f7265706f6c652f6d716c616c6368656d792e7376673f6272616e63683d6d6173746572" data-canonical-src="https://travis-ci.org/repole/mqlalchemy.svg?branch=master"/></a> <a href="https://coveralls.io/r/repole/mqlalchemy?branch=master"><img alt="Coverage Status" src="https://camo.githubusercontent.com/361a67d28e1ca0c95b92708d6788ac9ea7c58643/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f7265706f6c652f6d716c616c6368656d792f62616467652e7376673f6272616e63683d6d6173746572" data-canonical-src="https://coveralls.io/repos/repole/mqlalchemy/badge.svg?branch=master"/></a> <a href="http://mqlalchemy.readthedocs.org/en/latest/"><img alt="Docs" src="https://camo.githubusercontent.com/fc5f277826276dfef632ec967ced5712219b9c6f/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f6d716c616c6368656d792f62616467652f3f76657273696f6e3d6c6174657374" data-canonical-src="https://readthedocs.org/projects/mqlalchemy/badge/?version=latest"/></a></p>
<p>Query SQLAlchemy models using MongoDB style syntax.</p>
<a name="user-content-why"/>
<h2><a id="user-content-why" class="anchor" href="#why" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Why?</h2>
<p>The need arose for me to be able to pass complex database filters from
client side JavaScript to a Python server. I started building some JSON
style syntax to do so, then realized such a thing already existed. I’ve
never seriously used MongoDB, but the syntax for querying lends itself
pretty perfectly to this use case.</p>
<p><strong>That sounds pretty dangerous…</strong></p>
<p>It can be. When using this with any sort of user input, you’ll want to
pass in a whitelist of attributes that are ok to query, otherwise you’ll
open the possibility of leaked passwords and all sorts of other scary
stuff.</p>
<p><strong>So, can I actually use this for a serious project?</strong></p>
<p>Maybe? There’s some decent test coverage, but this certainly isn’t a
very mature project yet.</p>
<p>I’ll be pretty active in supporting this, so if you are using this and
run into problems, I should be pretty quick to fix them.</p>
<p><strong>How fast is it?</strong></p>
<p>I’m sure my actual syntax parsing is inefficient and has loads of room
for improvement, but the time it takes to parse should be minimal
compared to the actual database query, so this shouldn’t slow your
queries down too much.</p>
<a name="user-content-supported-operators"/>
<h2><a id="user-content-supported-operators" class="anchor" href="#supported-operators" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Supported Operators</h2>
<ul>
<li>$and</li>
<li>$or</li>
<li>$not</li>
<li>$nor</li>
<li>$in</li>
<li>$nin</li>
<li>$gt</li>
<li>$gte</li>
<li>$lt</li>
<li>$lte</li>
<li>$ne</li>
<li>$mod</li>
</ul>
<p>Custom operators added for convenience:</p>
<ul>
<li>$eq - Explicit equality check.</li>
<li>$like - Search a text field for the given value.</li>
</ul>
<p>Not yet supported, but would like to add:</p>
<ul>
<li>Index based relation queries. Album.tracks.0.track_id won’t work.</li>
<li>$regex</li>
</ul>
<a name="user-content-examples"/>
<h2><a id="user-content-examples" class="anchor" href="#examples" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Examples</h2>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> sqlalchemy <span class="pl-k">import</span> create_engine
<span class="pl-k">from</span> sqlalchemy.orm <span class="pl-k">import</span> sessionmaker
<span class="pl-k">from</span> mqlalchemy <span class="pl-k">import</span> apply_mql_filters
<span class="pl-k">from</span> myapp.mymodels <span class="pl-k">import</span> Album

<span class="pl-c"># get your sqlalchemy db session here</span>
db_engine <span class="pl-k">=</span> create_engine(<span class="pl-s"><span class="pl-pds">"</span>sqlite+pysqlite:///mydb.sqlite<span class="pl-pds">"</span></span>)
DBSession <span class="pl-k">=</span> sessionmaker(<span class="pl-v">bind</span><span class="pl-k">=</span>db_engine)
db_session <span class="pl-k">=</span> DBSession()

<span class="pl-c"># define which fields of Album are ok to query</span>
whitelist <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">"</span>album_id<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>artist.name<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>tracks.playlists.name<span class="pl-pds">"</span></span>]
<span class="pl-c"># Find all albums that are either by Led Zeppelin or have a track</span>
<span class="pl-c"># that can be found on the "Grunge" playlist.</span>
filters <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>$or<span class="pl-pds">"</span></span>: [
        {<span class="pl-s"><span class="pl-pds">"</span>tracks.playlists.name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Grunge<span class="pl-pds">"</span></span>},
        {<span class="pl-s"><span class="pl-pds">"</span>artist.name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Led Zeppelin<span class="pl-pds">"</span></span>}
    ]
}
query <span class="pl-k">=</span> apply_mql_filters(db_session, Album, filters, whitelist)
matching_records <span class="pl-k">=</span> query.all()</pre></div>
<p>For more, please see the included tests, as they're probably the
easiest way to get an idea of how the library can be used.</p>
<a name="user-content-contributing"/>
<h2><a id="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Contributing</h2>
<p>Submit a pull request and make sure to include an updated AUTHORS
with your name along with an updated CHANGES.rst.</p>
<a name="user-content-license"/>
<h2><a id="user-content-license" class="anchor" href="#license" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>License</h2>
<p>MIT</p>

</article>
  </div></body></html>