<html><body><div><article class="markdown-body entry-content" itemprop="mainContentOfPage"><p>DPS payment processing for django. (Almost) completely agnostic about
your models. By default, you never handle credit card details. Handles
one-off and recurring payments.</p>

<h1>
<a id="user-content-usage" class="anchor" href="https://github.com/gregplaysguitar/django-dps/blob/master/#usage" aria-hidden="true"><span class="octicon octicon-link"/></a>Usage:</h1>

<p>You'll need to add a few items in your <code>settings.py</code>: <code>PXPAY_USERID</code>
and <code>PXPAY_KEY</code> for interactive payments and recurring payment setup,
and <code>PXPOST_USERID</code> and <code>PXPOST_KEY</code> for non-interactive and recurring
billing.</p>

<p>You'll also need to <code>include('dps.urls')</code> in your urls somewhere.</p>

<p>Then, just call this function:</p>

<p><code>dps.transactions.make_payment(obj, request=None, attrs={})</code> where:</p>

<ul>
<li><p><code>obj</code> implements <code>dps.models.BasicTransactionProtocol</code> or
<code>dps.models.FullTransactionProtocol</code>.</p></li>
<li>
<p><code>request</code> is a Django request object or <code>None</code>. </p>

<p>If you intend to make an interactive payment e.g. by redirecting the
user to the DPS page, then provide a request. (It's needed to build
fully-specified URLs for DPS to redirect back to.)</p>

<p>If <code>request</code> is <code>None</code>, the function will attempt to find and use a
stored billing token (as described in the protocol implementations
in <code>dps/models.py</code>) and make a non-interactive recurring payment.</p>
</li>
<li>
<p><code>attrs</code> is a dictionary of PxPay or PxPost request parameters to be
merged in to the transaction request to DPS.</p>

<p>This allows you to do anything, really, as you could override
default parameters, provide credit-card details directly, specify a
refund rather than purchase â€“ anything DPS supports.</p>
</li>
</ul>

<p>To put an accessor/relationship on your own model to it's
transactions, just use GenericRelation:</p>

<pre><code>class MyModel(models.Model):
    ...
    transactions = generic.GenericRelation(Transaction)
</code></pre>

<p>There's also a <code>dps.admin.TransactionInlineAdmin</code> which you can use
with your own model admins like so:</p>

<pre><code>class MyModelAdmin(admin.ModelAdmin):
    ...
    inlines = [TransactionInlineAdmin]

admin.site.register(MyModel, MyModelAdmin)
</code></pre>

<h2>
<a id="user-content-running-tests" class="anchor" href="https://github.com/gregplaysguitar/django-dps/blob/master/#running-tests" aria-hidden="true"><span class="octicon octicon-link"/></a>Running tests</h2>

<p>Create a file called tests/dps_settings.py and add <code>PXPAY_USERID</code> and
<code>PXPAY_KEY</code> values - you'll need valid PXPAY testing credentials.
Then, assuming virtualenvwrapper is installed:</p>

<pre><code>&gt; cd path-to/django-dps
&gt; mkvirtualenv test
&gt; pip install requests
&gt; ./setup.py install
&gt; ./runtests.py
</code></pre>

<p>To run the tests across all supported Python and Django versions, use <code>tox</code>:</p>

<pre><code>&gt; cd path-to/django-dps
&gt; mkvirtualenv test
&gt; pip install tox
&gt; tox
</code></pre>
</article></div></body></html>