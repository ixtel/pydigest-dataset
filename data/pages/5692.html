<html><body><div><div class="section">
              <h1>django-stagesetting 0.4.2</h1>

              


<p>Dynamic runtime settings and configuration for Django sites</p>








<p>An application for managing site configuration through normal <a href="https://docs.djangoproject.com/en/stable/" rel="nofollow">Django</a> forms,
and thus through the <a href="https://docs.djangoproject.com/en/stable/ref/contrib/admin/" rel="nofollow">admin site</a>.</p>
<table>
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr><th>Release</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr><td>stable (0.4.2)</td>
<td><a href="https://travis-ci.org/kezabelle/django-stagesetting" rel="nofollow"><img src="https://travis-ci.org/kezabelle/django-stagesetting.svg?branch=0.4.2"/></a></td>
</tr>
<tr><td>master</td>
<td><a href="https://travis-ci.org/kezabelle/django-stagesetting" rel="nofollow"><img src="https://travis-ci.org/kezabelle/django-stagesetting.svg?branch=master"/></a></td>
</tr>
</tbody>
</table>
<div id="pre-requisites">
<h2>Pre-requisites</h2>
<p>The following versions are tested:</p>
<ul>
<li>Python 2.7, 3.3, or 3.4</li>
<li><a href="https://docs.djangoproject.com/en/stable/" rel="nofollow">Django</a> 1.7 or 1.8</li>
</ul>
</div>
<div id="installation">
<h2>Installation</h2>
<p>First up, you need to install it  (via <a href="https://pip.pypa.io/en/stable/" rel="nofollow">pip</a> as usual):</p>
<pre>pip install django-stagesetting==0.4.2
</pre>
<p>Once that’s downloaded, add the package to your <tt>INSTALLED_APPS</tt>
in your settings:</p>
<pre>INSTALLED_APPS = (
    # ...
    'stagesetting',
    # ...
)
</pre>
<p>do a migrate:</p>
<pre>python manage.py migrate stagesetting
</pre>
<p>Add a <tt>STAGESETTINGS</tt> dictionary to your project’s settings:</p>
<pre>STAGESETTINGS = {
    'SETTING_NAME': '...',
    'ANOTHER_SETTING_NAME': '...',
}
</pre>
<p>The setting collection name is the dictionary key, so must be unique.</p>
<div id="writing-settings">
<h3>Writing settings</h3>
<p>Settings may be created in a number of ways, the simplest of which is to
provide a <tt>dictionary</tt> as the value:</p>
<pre>STAGESETTINGS = {
    'MY_SETTING': {
        'an_example-datetime': datetime.today(),
        'a_date': date.today(),
        'time_now': time(4, 23),
        'boolean_field': False,
        'plain_text': 'char field',
        'decimal': Decimal('3.25'),
        'float': 2.3,
    }
}
</pre>
<p>where possible, this will auto-generate a Form class for you, choosing sensible
defaults for the field variants where possible.</p>
<p>The other option is for the value to be a <tt>list</tt> or a <tt>tuple</tt>, where
the <em>first item</em> represents a form (either a <tt>dictionary</tt> as above, <strong>OR</strong>
the <tt>dotted.path.to.a.Form.Class</tt> if you need custom validation) and the
<em>second, optional item</em> is the default data. The following should all be valid:</p>
<pre>STAGESETTINGS = {
    'AUTO_GENERATED': [{
        'datetime': datetime.today(),
    }],
    'IMPORT_A_FORM': ['myapp.forms.MyForm'],
    'IMPORT_WITH_DEFAULT': ['myapp.forms.MyForm', {'default': 'data'}],
    'AUTO_GENERATED_WITH_OTHER_DEFAULTS': [{
        'datetime': datetime.today(),
    }, {'default': 'data'}],
}
</pre>
<p>A simple configuration form (for the <tt>dotted.path.Format</tt>) might look like:</p>
<pre>from django.core.exceptions import ValidationError
from django.forms import Form, DateField

class DateForm(Form):
    start = DateField()
    end = DateField()

    def clean(self):
        cd = self.cleaned_data
        if 'start' in cd and 'end' in cd and cd['start'] &gt; cd['end']:
            raise ValidationError("Start date cannot be after end date")
        return cd
</pre>
<p>As you can see, it really is just a normal <a href="https://docs.djangoproject.com/en/stable/topics/forms/" rel="nofollow">Form</a>. Internally, this form’s
<tt>cleaned_data</tt> will be converted into <a href="http://json.org/" rel="nofollow">JSON</a> before being saved to the
database.
It will get re-converted to proper Python values when pulled out
of the database, by going through the given <a href="https://docs.djangoproject.com/en/stable/topics/forms/" rel="nofollow">Form</a> class’s validation again,
including converting to rich values like model instances.</p>
<div id="python-types-which-can-be-detected">
<h4>Python types which can be detected</h4>
<p>When detecting a dictionary as the value and auto-generating a form, the
following translations will be applied:</p>
<ul>
<li><tt>None</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#nullbooleanfield" rel="nofollow">NullBooleanField</a></li>
<li><tt>datetime.datetime</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#datetimefield" rel="nofollow">DateTimeField</a></li>
<li><tt>datetime.date</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#datefield" rel="nofollow">DateField</a></li>
<li><tt>datetime.time</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#timefield" rel="nofollow">TimeField</a></li>
<li><tt>datetime.timedelta</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#durationfield" rel="nofollow">DurationField</a></li>
<li><tt>decimal.Decimal</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#decimalfield" rel="nofollow">DecimalField</a></li>
<li><tt>float</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#floatfield" rel="nofollow">FloatField</a></li>
<li><tt>True</tt> or <tt>False</tt> become <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#booleanfield" rel="nofollow">BooleanField</a></li>
<li><tt>int</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#integerfield" rel="nofollow">IntegerField</a></li>
<li><tt>uuid.UUID</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#uuidfield" rel="nofollow">UUIDField</a> or <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#charfield" rel="nofollow">CharField</a>, depending on the <a href="https://docs.djangoproject.com/en/stable/" rel="nofollow">Django</a> version</li>
<li><tt>list</tt> and <tt>tuple</tt> become <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#multiplechoicefield" rel="nofollow">MultipleChoiceField</a></li>
<li><tt>collections.OrderedDict</tt>, <tt>set</tt>, <tt>frozenset</tt>, and <tt>dict</tt> become <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#choicefield" rel="nofollow">ChoiceField</a></li>
<li><tt>models.Model</tt> instances become <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#modelchoicefield" rel="nofollow">ModelChoiceField</a></li>
<li><tt>models.QuerySet</tt> becomes <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#modelmultiplechoicefield" rel="nofollow">ModelMultipleChoiceField</a></li>
<li>strings become one of the following, depending on what checks they pass:
</li>
<li>Some strings are <strong>really</strong> special, and will instead turn into one of the following:<ul>
<li>if the string == <tt>STATIC_URL</tt> or <tt>STATICFILES_STORAGE</tt> the field will be
a <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#choicefield" rel="nofollow">ChoiceField</a> whose options are all the files found by the
project’s <tt>STATICFILES_FINDERS</tt>.</li>
<li>if the string == <tt><span class="pre">MEDIA_URL``or</span> ``DEFAULT_FILE_STORAGE</tt> the field will be
a <a href="https://docs.djangoproject.com/en/stable/ref/forms/fields/#choicefield" rel="nofollow">ChoiceField</a> whose options are all the files found by
<tt>DEFAULT_FILE_STORAGE</tt>.</li>
<li>if the string <em>starts with</em> <tt>STATIC_URL</tt> it will be the same as using
the <tt>STATIC_URL</tt> generated field, but is a regular expression for filtering
to only certain files (i.e. <tt><span class="pre">/static/.*\.css$</span></tt> would find only css files)</li>
<li>if the string <em>starts with</em> <tt>MEDIA_URL</tt> it will be the same as above,
but for files found in <tt>DEFAULT_FILE_STORAGE</tt>.</li>
<li>if a string looks like it contains HTML, it will try to use <a href="https://bitbucket.org/tim_heap/django-bleach" rel="nofollow">django-bleach</a>
for sanitisation, and one of <a href="https://github.com/django-ckeditor/django-ckeditor" rel="nofollow">django-ckeditor</a>, <a href="https://github.com/aljosa/django-tinymce" rel="nofollow">django-tinymce</a>,
<a href="https://github.com/klen/django_markdown" rel="nofollow">django-markdown</a>, <a href="https://github.com/timmyomahony/django-pagedown" rel="nofollow">django-pagedown</a>, or <a href="https://github.com/barraq/django-epiceditor" rel="nofollow">django-epiceditor</a> for an
appropriate widget.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="usage-in-code">
<h2>Usage in code</h2>
<p>The best way to access the settings in your views is to include
<tt>stagesetting.middleware.ApplyRuntimeSettings</tt> in your <tt>MIDDLEWARE_CLASSES</tt>
which will ensure there is a <tt>request.stagesettings</tt> variable which can be
used like so:</p>
<pre>def myview(request):
    how_many_form_data = request.stagesetting.LIST_PER_PAGE
    allow_empty_form_data = request.stagesetting['ALLOW_EMPTY']
</pre>
<p>each setting will be a dictionary of the <a href="https://docs.djangoproject.com/en/stable/topics/forms/" rel="nofollow">Form</a> values, either the default ones
or those changed in the database.</p>
</div>
<div id="usage-in-templates">
<h2>Usage in templates</h2>
<p>If you’ve already got <tt>request</tt> in your template, obviously you can continue
to use <tt>request.stagesettings</tt> if the middleware is wired up.</p>
<p>If you don’t have request, or you’re not using the middleware,
<tt>stagesetting.context_processors.runtime_settings</tt> provides a <tt>STAGESETTING</tt>
template variable which contains the exact same data.</p>
<p>Finally, if not using the middleware nor the context processor, there is a
template tag available as a last resort. It’s usage is:</p>
<pre>{% load stagesetting %}
{% stagesetting as NEW_CONTEXT_VARIABLE %}
{{ NEW_CONTEXT_VARIABLE.SETTING_NAME.fieldname }}
</pre>
</div>
<div id="usage-outside-of-a-request">
<h2>Usage outside of a request</h2>
<p>If you don’t have the middleware, or are in a part of the code which doesn’t
have a <tt>request</tt>, you can use the wrapper object directly:</p>
<pre>from stagesetting.models import RuntimeSettingWrapper
def my_signal_handler(sender, instance, **kwargs):
    live_settings = RuntimeSettingWrapper()
    data = live_settings.LIST_PER_PAGE
</pre>
<p>Try to keep a single <tt>RuntimeSettingWrapper</tt> around for as long as possible,
rather than creating a new instance everywhere, as the object must fetch
the available settings from the database the first time it needs them. It
caches them for it’s lifetime thereafter.</p>
</div>
<div id="alternatives">
<h2>Alternatives</h2>
<p>Other apps I know of that achieve similar things, or overlap in some obvious
way:</p>
<ul>
<li><a href="https://github.com/jezdez/django-constance" rel="nofollow">django-constance</a> is similar<ul>
<li>uses <tt>pickle</tt> to store an arbitrary python value; <tt>stagesetting</tt> only
stores stuff it can put into JSON and relies on <a href="https://docs.djangoproject.com/en/stable/" rel="nofollow">Django</a> <a href="https://docs.djangoproject.com/en/stable/topics/forms/" rel="nofollow">Forms</a> to inflate
the JSON back into python values.</li>
<li>Has both database and redis backends; <tt>stagesetting</tt> only supports
the database, though it will only do one query most of the time.</li>
</ul>
</li>
</ul>
</div>
<hr class="docutils"/>
<div id="license">
<h2>License</h2>
<p><tt><span class="pre">django-stagesetting</span> 0.4.2</tt> is available under the terms of the
Simplified BSD License (alternatively known as the FreeBSD License, or
the 2-clause License):</p>
<pre>Copyright (c) 2015, Keryn Knight
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

The views and conclusions contained in the software and documentation are those
of the authors and should not be interpreted as representing official policies,
either expressed or implied, of the FreeBSD Project.
</pre>
</div>
<hr class="docutils"/>
<div id="change-log">
<h2>Change log</h2>
<div id="id1">
<h3>0.4.2</h3>
<ul>
<li>Admin now displays pretty names for the setting keys.</li>
<li><tt>StaticFilesChoiceField</tt> and <tt>DefaultStorageFilesChoiceField</tt> now both use an
LRU cache to avoid having to enumerate the storage backends/finders repeatedly.</li>
</ul>
</div>
<div id="id2">
<h3>0.4.1</h3>
<ul>
<li>When generating a form from an <tt>OrderedDict</tt>, field ordering is now preserved.</li>
<li>When a form’s values are saved into the database and become stale (because the
underlying form/defaults are added to), the new defaults are transparently
mapped onto the value when it’s made available via the middleware,
context processor or template tag.</li>
</ul>
</div>
<div id="id3">
<h3>0.4.0</h3>
<ul>
<li>Introduced the <tt>stagesetting</tt> template tag.</li>
<li>Settings are no longer automatically created on app <tt>ready()</tt>, instead
the defaults are lazily converted when requested via a <tt>RuntimeSettingWrapper</tt></li>
<li>Added <tt>StaticFilesChoiceField</tt> and <tt>DefaultStorageFilesChoiceField</tt>,
which allow for selecting a file that already exists in the given storage.</li>
<li>When auto-generating a form, the <tt>STATIC_URL</tt> and <tt>MEDIA_URL</tt> settings
are treated as special, and turned into the aforementioned fields.</li>
<li>Providing an incomplete defaults dictionary in the second parameter of a
given setting’s config will now show <em>Info</em> messages to indicate what’s
missing.</li>
<li>When auto-generating a form from a dictionary, HTML-like values will try
to use one of <a href="https://github.com/django-ckeditor/django-ckeditor" rel="nofollow">django-ckeditor</a>, <a href="https://github.com/aljosa/django-tinymce" rel="nofollow">django-tinymce</a>, <a href="https://github.com/klen/django_markdown" rel="nofollow">django-markdown</a>,
<a href="https://github.com/timmyomahony/django-pagedown" rel="nofollow">django-pagedown</a>, or <a href="https://github.com/barraq/django-epiceditor" rel="nofollow">django-epiceditor</a> for a widget instead of a normal
<tt>textarea</tt>.</li>
<li>Added support for using <a href="https://bitbucket.org/tim_heap/django-bleach" rel="nofollow">django-bleach</a> when encountering HTML-like values
in an autogenerated form.</li>
<li>Added initial support for <a href="https://github.com/tomchristie/django-rest-framework" rel="nofollow">djangorestframework</a></li>
</ul>
</div>
<div id="id4">
<h3>0.3.2</h3>
<ul>
<li>Fixed error introduced in <tt>0.3.1</tt> when only providing a dictionary, because
it turns out it wasn’t being covered by tests.</li>
</ul>
</div>
<div id="id5">
<h3>0.3.1</h3>
<ul>
<li>Fixed issue where providing a dictionary wasn’t treating the values as
implicit defaults to be created into the database.</li>
</ul>
</div>
<div id="id6">
<h3>0.3.0</h3>
<ul>
<li>Added ability to auto-generate forms for configuration values which are
dictionaries.</li>
</ul>
</div>

</div>


<a name="downloads"> </a>


<ul class="nodot">
  <li><strong>Downloads (All Versions):</strong></li>
  <li>
    <span>0</span> downloads in the last day
  </li>
  <li>
    <span>88</span> downloads in the last week
  </li>
  <li>
    <span>778</span> downloads in the last month
  </li>
</ul>









            </div>


          </div></body></html>