<html><body><div><div class="post-content">
					    		            			            	                                                                                            
					<p>Remember that in my <a href="http://www.digitaljunky.io/?p=72" title="Playing around with neural networks – Python version">last post</a> about neural networks, I tried (and failed) to replicate the results I obtained in R using Python. </p>
<p>I have been thinking about how I would solve the problem, and frankly I wasn’t eager to spent too much time on such a silly example, especially since I’m not a specialist of the PyBrain module.</p>
<p>The problem is, beside my occasional laziness when it comes to solving problems, I’m also quite stubborn and I don’t like to let things go that easily. </p>
<p>And I realized that it was a great opportunity to write about failure, and how to react when confronted to it.<br/>
<span id="more-222"/></p>
<h3>Recognizing the problem :</h3>
<p>Speaking about failure implies an inability to reach a predefined goal. In my case, my goal was to provide the reader with a simple and working example of a neural network’s implementation. </p>
<p>But unfortunately the result was not the one expected : the predictions made by the network were useless. </p>
<p>So what could I do ? Was I willing to spend a considerable amount of time mastering PyBrain in order to understand precisely what went wrong in order to fix it ? I was not. It sure is the best solution, however practical constraints often lead you away from such optimal responses. Whether it is for your job or for your personal projects, there is always that Best way of getting things done. But then there are also 1000 reasons keeping your from that path : a deadline soon to be met, too many projects to work on at the same time to allocate a lot of energy on a single one, etc. So sometimes we need to adapt in order to find, not the absolute best way of doing things, but the one that will get things done knowing that we live in a constrained environment. </p>
<p>In my case, I wanted to get my network to work quickly so that I could concentrate on other projects. So back to the goal we defined earlier : building a simple neural network example with reasonable predictive power. </p>
<h3>Taking a step back :</h3>
<p>Now, since my last approach didn’t work and instead of desperately trying to get the initial setting I had imagined to work, let’s think again about what the network does ought to do and what we’ve been doing at that point :</p>
<ul>
<li> the ultimate goal is to classify correctly the shapes drawn in the images ; </li>
<li> the network relies on patterns discerned among the data points to make its predictions ;</li>
<li> we have 1024 input data points corresponding to the pixels’ values (0 if white, 1 if black) ; </li>
<li> the network thus created fails to make robust predictions. </li>
</ul>
<p>Based on the following elements, what can be done to resolve this situation ? It’s always a good first step to sum up any useful information we have at hand. And in my case, it’s not much : I know that a neural network is good at finding patterns. I know that the less noise there will be in the data, the easier it’s going to be to find relevant relations between inputs and outputs. I also know that I’m basically treating my network as a black box since when I look at the 1024 input data points, I can’t make any inference on the type of relation going on there. And I don’t like the idea of letting my tool do all the work when I don’t quite understand what I should be looking for. </p>
<h3>Simplifying to understand</h3>
<p>If we don’t understand precisely what’s going on, maybe should we simplify our problem. That way, we may be able to provide data points with a stronger and more directly visible relation to the output. The task will then be easier for us to understand and implement, and the network should perform better if we feed it less data points, but more valuable information. </p>
<p>So what information other than the arrangement of the pixels can we provide ? Look at the matrix representing the image. The lines composing the shapes are 3 pixels wide. A rectangle will thus have 3*2 long lines corresponding to its longest sides, a characteristic it doesn’t share with the other shapes. A triangle should in theory have 3 long lines as base, and a circle none. That’s already one quite strong discriminating value. Let’s find some more. We use the value of the longest row in the image to count them, so we might as well store it as a data point. Our triangles are always orientated the same way. So the upper angle means a row with very few pixels active (1 or 2). It’s a configuration specific to the triangles. And that’s one more data point. It seems pretty robust, but let’s add a last one just to be sure. Look at the shapes : what seems to be characteristic of each one that we haven’t mentioned yet? The angles of course ! A rectangle typically has 8 (you’ll understand quickly why I don’t say 4), which is less than what a triangle would have, which is in turn less than what a circle would have. </p>
<p>Summing up our new data points and the corresponding assumptions:</p>
<ul>
<li> number of repetitions of the longest row ; rectangle should have 6, triangle 3, circle ?
</li><li> number of pixels in the longest line ; rectangles should have the highest value
</li><li> number of pixels in the shortest line ; triangles should have the lowest value
</li><li> number of angles in the image. value for rectangles 
<p>Spoiler : it works and outperforms by far the network built upon 1024 input points. </p>
<h3>Implementing :</h3>
<p>Load the modules we need :</p>

		<div id="crayon-56d5b6b9de009056044717" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b6b9de009056044717-1"><span class="crayon-e">import </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de009056044717-2"><span class="crayon-e">from </span><span class="crayon-v">skimage</span><span class="crayon-sy">.</span><span class="crayon-e">io </span><span class="crayon-e">import </span><span class="crayon-e">imread</span></p><p class="crayon-line" id="crayon-56d5b6b9de009056044717-3"><span class="crayon-e">from </span><span class="crayon-v">pybrain</span><span class="crayon-sy">.</span><span class="crayon-v">tools</span><span class="crayon-sy">.</span><span class="crayon-e">shortcuts </span><span class="crayon-e">import </span><span class="crayon-e">buildNetwork</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de009056044717-4"><span class="crayon-e">from </span><span class="crayon-v">pybrain</span><span class="crayon-sy">.</span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-e">trainers </span><span class="crayon-e">import </span><span class="crayon-e">BackpropTrainer</span></p><p class="crayon-line" id="crayon-56d5b6b9de009056044717-5"><span class="crayon-e">from </span><span class="crayon-v">pybrain</span><span class="crayon-sy">.</span><span class="crayon-e">datasets </span><span class="crayon-e">import </span><span class="crayon-e">ClassificationDataSet</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de009056044717-6"><span class="crayon-e">from </span><span class="crayon-v">pybrain</span><span class="crayon-sy">.</span><span class="crayon-v">structure</span><span class="crayon-sy">.</span><span class="crayon-e">modules   </span><span class="crayon-e">import </span><span class="crayon-e">SoftmaxLayer</span></p><p class="crayon-line" id="crayon-56d5b6b9de009056044717-7"><span class="crayon-e">from </span><span class="crayon-v">pybrain</span><span class="crayon-sy">.</span><span class="crayon-e">structure </span><span class="crayon-e">import </span><span class="crayon-v">SigmoidLayer</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>I may have re-factored a bit too much this time, my bad. Following are the functions we are going to use to load the images and extract the 4 data points from each of them.</p>

		<div id="crayon-56d5b6b9de013102085678" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-2">2</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-4">4</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-6">6</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-8">8</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-10">10</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-12">12</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-14">14</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-16">16</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-18">18</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-20">20</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-22">22</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-24">24</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-26">26</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-28">28</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-30">30</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-32">32</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-34">34</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-36">36</p><p class="crayon-num" data-line="crayon-56d5b6b9de013102085678-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b6b9de013102085678-38">38</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b6b9de013102085678-1"><span class="crayon-e">def </span><span class="crayon-e">compute_rows</span><span class="crayon-sy">(</span><span class="crayon-v">image_array</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-2"><span class="crayon-h">    </span><span class="crayon-v">pixels_per_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image_array</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-3"><span class="crayon-h">    </span><span class="crayon-v">max_pixels_per_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pixels_per_row</span><span class="crayon-sy">.</span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-4"><span class="crayon-h">    </span><span class="crayon-v">min_pixels_per_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pixels_per_row</span><span class="crayon-sy">[</span><span class="crayon-v">pixels_per_row</span><span class="crayon-o">!=</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">min</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-5"><span class="crayon-h">    </span><span class="crayon-v">nbr_max_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pixels_per_row</span><span class="crayon-sy">[</span><span class="crayon-v">pixels_per_row</span><span class="crayon-o">==</span><span class="crayon-v">max_pixels_per_row</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h">    </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-6"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">min_pixels_per_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_pixels_per_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">nbr_max_rows</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-7"><span class="crayon-e">    </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-8"><span class="crayon-e">    </span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-9"><span class="crayon-e">def </span><span class="crayon-e">compute_angles</span><span class="crayon-sy">(</span><span class="crayon-v">image_array</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-10"><span class="crayon-h">    </span><span class="crayon-v">nrows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image_array</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">-</span><span class="crayon-cn">1</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-11"><span class="crayon-h">    </span><span class="crayon-v">ncols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image_array</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">-</span><span class="crayon-cn">1</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-12"><span class="crayon-h">    </span><span class="crayon-v">nangles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h">    </span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-13"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nrows</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-14"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ncols</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-15"><span class="crayon-h">            </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">image_array</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-o">:</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">%</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">!=</span><span class="crayon-cn">0</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-16"><span class="crayon-h">                </span><span class="crayon-v">nangles</span><span class="crayon-o">+=</span><span class="crayon-cn">1</span><span class="crayon-h">                </span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-17"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">nangles</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-18"> </p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-19"><span class="crayon-e">    </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-20"><span class="crayon-e">def </span><span class="crayon-e">image_to_inputs</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-21"><span class="crayon-h">    </span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">where</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-o">==</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-22"><span class="crayon-h">    </span><span class="crayon-v">inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-23"><span class="crayon-h">    </span><span class="crayon-v">rows_info</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">compute_rows</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-h">    </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-24"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows_info</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-25"><span class="crayon-h">        </span><span class="crayon-v">inputs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-h">        </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-26"><span class="crayon-h">    </span><span class="crayon-v">angles_nbr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">compute_angles</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-27"><span class="crayon-h">    </span><span class="crayon-v">inputs</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">angles_nbr</span><span class="crayon-sy">)</span><span class="crayon-h">    </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-28"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">inputs</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-29"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-30"> </p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-31"><span class="crayon-e">def </span><span class="crayon-e">import_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shapes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">used_for</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">samples_nbr</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-32"><span class="crayon-h">    </span><span class="crayon-v">ds</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ClassificationDataSet</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_classes</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-h">    </span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-33"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">shape </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-v">shapes</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-34"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">samples_nbr</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-35"><span class="crayon-h">            </span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-o">+</span><span class="crayon-v">used_for</span><span class="crayon-o">+</span><span class="crayon-s">'/'</span><span class="crayon-o">+</span><span class="crayon-v">shape</span><span class="crayon-o">+</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-s">'.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">as_grey</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">plugin</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flatten</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-36"><span class="crayon-h">            </span><span class="crayon-v">image_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">image_to_inputs</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b6b9de013102085678-37"><span class="crayon-h">            </span><span class="crayon-v">ds</span><span class="crayon-sy">.</span><span class="crayon-e">appendLinked</span><span class="crayon-sy">(</span><span class="crayon-v">image_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shapes</span><span class="crayon-sy">[</span><span class="crayon-v">shape</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h">            </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de013102085678-38"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">ds</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>A word about the algorithm I wrote for compute_angles() : we study 2*2 cells at a time, shifting by 1 cell on the right at each iteration. When the end of the row is reached, we go back at (row+1, col=0) and start again until all rows are done. An angle (corner would be more appropriate) is spotted when the number of white (or black) cells in the 4 considered is odd. Here, have a gif :</p>
<p><a href="http://i0.wp.com/digitaljunky.io/wp-content/uploads/2014/08/algo_corners.gif"><img src="http://i0.wp.com/digitaljunky.io/wp-content/uploads/2014/08/algo_corners.gif?resize=320%2C250" alt="algo_corners" class="aligncenter size-full wp-image-232" data-recalc-dims="1"/></a></p>
<p>Now to load the datasets :</p>

		<div id="crayon-56d5b6b9de019897876816" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b6b9de019897876816-1"><span class="crayon-v">ds_training</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">import_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'C:/Users/alexis.matelin/Documents/Neural Networks/Visual classification/shapes/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shapes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"training"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">15</span><span class="crayon-sy">)</span><span class="crayon-h">  </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de019897876816-2"><span class="crayon-v">ds_testing</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">import_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'C:/Users/alexis.matelin/Documents/Neural Networks/Visual classification/shapes/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shapes</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"testing"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-h">  </span></p><p class="crayon-line" id="crayon-56d5b6b9de019897876816-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de019897876816-4"><span class="crayon-v">ds_training</span><span class="crayon-sy">.</span><span class="crayon-e">_convertToOneOfMany</span><span class="crayon-sy">(</span><span class="crayon-v">bounds</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b6b9de019897876816-5"><span class="crayon-v">ds_testing</span><span class="crayon-sy">.</span><span class="crayon-e">_convertToOneOfMany</span><span class="crayon-sy">(</span><span class="crayon-v">bounds</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>And give it a try ! Compared to last time, I changed the hidden layer activation function from Tanh to Sigmoid because our inputs are no longer binary. I played around with the other parameters in order to find the best set-up. The trainer is limited to 2000 epochs because it’s enough to train a robust model. Otherwise it would train forever until the convergence is reached, without any improvement on the predictive accuracy.<br/>
I trained 20 networks and got 100% correct answers on the testing set for 18 of these trials (pretty good don’t you think).</p>

		<div id="crayon-56d5b6b9de01e936932013" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b6b9de01e936932013-1"><span class="crayon-v">net</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">buildNetwork</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hiddenclass</span><span class="crayon-o">=</span><span class="crayon-v">SigmoidLayer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outclass</span><span class="crayon-o">=</span><span class="crayon-v">SoftmaxLayer</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de01e936932013-2"><span class="crayon-v">trainer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BackpropTrainer</span><span class="crayon-sy">(</span><span class="crayon-v">net</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">learningrate</span><span class="crayon-o">=</span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">momentum</span><span class="crayon-o">=</span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weightdecay</span><span class="crayon-o">=</span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-o">=</span><span class="crayon-v">ds_training</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b6b9de01e936932013-3"><span class="crayon-v">trainer</span><span class="crayon-sy">.</span><span class="crayon-e">trainUntilConvergence</span><span class="crayon-sy">(</span><span class="crayon-v">maxEpochs</span><span class="crayon-o">=</span><span class="crayon-cn">2000</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de01e936932013-4"> </p><p class="crayon-line" id="crayon-56d5b6b9de01e936932013-5"><span class="crayon-v">out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">net</span><span class="crayon-sy">.</span><span class="crayon-e">activateOnDataset</span><span class="crayon-sy">(</span><span class="crayon-v">ds_testing</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b6b9de01e936932013-6"><span class="crayon-v">out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">out</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b6b9de01e936932013-7"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">out</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>
There you go ! So the conclusion is : don’t give up, take your time, try to think differently about the issue you’re confronted to and you’re probably going to end up with a better solution than the one you imagined initially. If you can’t see a way out and the complexity is just too much for what you can handle right now, simplify as much as you can while keeping track of your objective. Very often once broken down into simple but essential pieces a problem is much easier to solve. </p>
<h3>Links :</h3>
<p><a href="http://neuralnetworksanddeeplearning.com/">Neural Networks and Deep Learning</a> by Michael Nielsen<br/>
The images I used can be found <a href="https://www.dropbox.com/sh/95jmm8rs6ep14he/AAAvdq0hx7CeSiyLGFvp4-N9a">here</a>.</p>
<p><br/>
Edit :<br/>
In short : follow the <a href="http://en.wikipedia.org/wiki/KISS_principle">KISS principle</a>.</p>
							
													        
				</li></ul></div> 
				            
				</div></body></html>