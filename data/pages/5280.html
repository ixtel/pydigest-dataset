<html><body><div><div class="post-text" itemprop="text">
<p>@rth and @PeterBrittain help me a lot. Here the solution I use:</p>

<p>structure folder :</p>

<pre><code>setup.py
python_package/
    lib/
        libfoo.dylib
        libfoo.dll
    __init__.py
    main.py
</code></pre>

<p>setup.py :</p>

<pre><code>from setuptools import setup, dist


class BinaryDistribution(dist.Distribution):
    def is_pure(self):
        return False


setup(
    name='python_package',
    package_data={'python_package': ['lib/libfoo.dylib','lib/libfoo.dll']},
    include_package_data=True,
    distclass=BinaryDistribution,
    packages=['python_package'],
)
</code></pre>

<p>main.py :</p>

<pre><code>#!/usr/bin/env python
import platform
from ctypes import CDLL, c_char_p

import pkg_resources

sysname = platform.system()

if sysname == 'Darwin':
    lib_name = "libfoo.dylib"
elif sysname == 'Windows':
    lib_name = "libfoo.dll"
else:
    lib_name = "libfoo.so"
lib_path = pkg_resources.resource_filename('python_package', 'lib/{}'.format(lib_name))
foo = CDLL(lib_path)

bar = foo.bar
bar.restype = c_char_p
bar.argtypes = [c_char_p]

print(bar('hello'))
</code></pre>

<p>build wheel : </p>

<pre><code>python setup.py bdist_wheel
</code></pre>

<p>It creates a specific plateform wheel <code>rtfdoc-0.0.1-cp34-cp34m-macosx_10_10_x86_64.whl</code> and mac users can do a simple <code>pip install rtfdoc-0.0.1-cp34-cp34m-macosx_10_10_x86_64.whl</code></p>

<p>This solution is not entirely satisfactory:</p>

<ul>
<li>I think I will still need to create a <a href="https://docs.python.org/3.4/distutils/setupscript.html#describing-extension-modules" rel="nofollow">Extension</a> or look at <a href="https://bitbucket.org/scons/scons/wiki/AboutSCons" rel="nofollow">SCons</a> for linux users.</li>
<li>Update my package will be difficult because of the production of the lib</li>
<li>I don't know how to manage .dll for 32 bit and 64 bit</li>
</ul>

<p>Thank you, I learned a lot, and I understand with setup.py in Pillow or Psycopg2 are huge</p>
    </div>
    </div></body></html>