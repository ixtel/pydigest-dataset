<html><body><div><div class="post-text" itemprop="text">

<p>I'm reading through McKellar and Fettig's <a href="http://shop.oreilly.com/product/0636920025016.do" rel="nofollow">Twisted Network Programming Essentials, 2nd Ed.</a></p>

<p>I am running Twisted 15.5.0 on Python 2.7.10 on Windows 7.</p>

<p>In the section about <code>Deferred</code> there's an example that is supposed to raise an <code>Unhandled Error in Deferred</code> - but I am only getting complete silence from the console when I run the minimal example below:</p>

<h3>Minimal example</h3>

<pre><code>from twisted.internet.defer import Deferred

def raiseErr(err):
    raise Exception(err)

d = Deferred()
d.addCallback(raiseErr)
d.callback("oh no")
</code></pre>

<p><code>$ python test.py
(no output)
</code></p>

<h3>Minimal example from actual book text</h3>

<p>The actual example from the book is along these lines:</p>

<pre><code>from twisted.internet.defer import Deferred

def callback1(result):
    print "Callback 1 said:", result
    return result

def callback2(result):
    print "Callback 2 said:", result

def callback3(result):
    raise Exception("Callback 3")

def errback1(failure):
    print "Errback 1 had an an error on", failure
    return failure

d = Deferred()
d.addCallback(callback1)
d.addCallback(callback2)
d.addCallback(callback3)
d.callback("Test")
</code></pre>

<p>And the expected output is listed in the book as:</p>

<blockquote>
  <p><code>callback3</code> raises an <code>Exception</code>, and because there is no registered <code>errback</code> to handle the <code>Exception</code>, the program terminates and reports an <code>Unhandled Error</code> to the user. The result is:</p>
</blockquote>

<pre><code>Callback 1 said: Test
Callback 2 said: Test
Unhandled error in Deferred:
Unhandled Error
Traceback (most recent call last):
File "/tmp/test.py", line 33, in &lt;module&gt;
d.callback("Test")
&lt;...&gt;
File "/tmp/test.py", line 11, in callback3
raise Exception("Callback 3")
exceptions.Exception: Callback 3
</code></pre>

<p>Am I doing something wrong?</p>

<h1>EDIT:</h1>

<p>I have gotten the error to display correctly on my machine.</p>

<p>To enable the error to get logged without having an <code>errback</code> handler on the <code>Deferred</code> object, I needed to add the following to my snippet:</p>

<pre><code>import sys
from twisted.python import log

log.startLogging(sys.stdout)

# rest of the code goes here
</code></pre>

<p>Now, when I run my minimal example from the first code snippet in my question, I get the following output:</p>

<pre><code>2016-02-05 09:45:43-0600 [-] Log opened.
2016-02-05 09:45:43-0600 [-] Invalid format string or unformattable object in log message: '%(log_legacy)s', {'format': '%(log_legacy)s', 'log_legacy': &lt;twisted.logger._stdlib.StringifiableFromEvent object at 0x038913F0&gt;, 'time': 1454687143.778, 'message': (), 'log_time': 1454687143.778, 'log_namespace': 'twisted.internet.defer', 'log_level': &lt;LogLevel=critical&gt;, 'log_source': None, 'system': '-', 'isError': True, 'log_logger': &lt;Logger 'twisted.internet.defer'&gt;, 'log_format': 'Unhandled error in Deferred:'}
2016-02-05 09:45:43-0600 [-] Unhandled Error
        Traceback (most recent call last):
          File "testd.py", line 13, in &lt;module&gt;
            d.callback("oh no")
          File "C:\Swat\.virtualenvs\twisted\lib\site-packages\twisted\internet\defer.py", line 393, in callback
            self._startRunCallbacks(result)
          File "C:\Swat\.virtualenvs\twisted\lib\site-packages\twisted\internet\defer.py", line 501, in _startRunCallbacks
            self._runCallbacks()
        --- &lt;exception caught here&gt; ---
          File "C:\Swat\.virtualenvs\twisted\lib\site-packages\twisted\internet\defer.py", line 588, in _runCallbacks
            current.result = callback(current.result, *args, **kw)
          File "testd.py", line 9, in raiseErr
            raise Exception(err)
        exceptions.Exception: oh no
</code></pre>

<p>So, now I can verify that Twisted does indeed raise an error as it is meant to - it just didn't feel like telling me for some reason. If anyone can elaborate as to why that would be the default case for handling an exception without an errback defined, I'd love to know.</p>

<p>I've changed the title to reflect my new question.</p>
    </div>
    </div></body></html>