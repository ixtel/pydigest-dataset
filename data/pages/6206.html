<html><body><div><div class="post-67 post type-post status-publish format-standard hentry category-buildout category-python tag-application-deployment tag-build-python-application tag-buildout-2 tag-eggs tag-packaging-python-application tag-python-2 tag-zipped-eggs" id="post-67">
			<h1>Setting up python development environment with buildout</h1>
			<small class="post-meta"><span class="post-date"><b>Posted:</b> August 17, 2015</span> <span class="author-link">| <b>Author:</b> <a href="https://rajmak.wordpress.com/author/rajmak/" title="Posts by rajmak" rel="author">rajmak</a></span> <span class="meta-sep">|</span> <span class="cat-links"><b>Filed under:</b> <a href="https://rajmak.wordpress.com/category/python/buildout/" rel="category tag">Buildout</a>, <a href="https://rajmak.wordpress.com/category/python/" rel="category tag">Python</a></span> <span class="tag-links"> | <b>Tags:</b> <a href="https://rajmak.wordpress.com/tag/application-deployment/" rel="tag">application deployment</a>, <a href="https://rajmak.wordpress.com/tag/build-python-application/" rel="tag">build python application</a>, <a href="https://rajmak.wordpress.com/tag/buildout-2/" rel="tag">buildout</a>, <a href="https://rajmak.wordpress.com/tag/eggs/" rel="tag">eggs</a>, <a href="https://rajmak.wordpress.com/tag/packaging-python-application/" rel="tag">packaging python application</a>, <a href="https://rajmak.wordpress.com/tag/python-2/" rel="tag">python</a>, <a href="https://rajmak.wordpress.com/tag/zipped-eggs/" rel="tag">zipped eggs</a></span> <span class="edit-link"/> <span class="meta-sep">|</span><span class="comments-link"><a href="https://rajmak.wordpress.com/2015/08/17/setting-up-python-development-environment-with-buildout/#respond">Leave a comment</a></span></small>
			<h2>Attn: Checkout <a href="http://conda.pydata.org/docs/" target="_blank">Conda</a> before trying this.</h2>
<blockquote><p>
Buildout is a Python-based build system for creating, assembling and deploying applications from multiple parts, some of which may be non-Python-based. It lets you create a buildout configuration and reproduce the same software later.<br/>
–<a href="http://www.buildout.org/en/latest/" target="_blank">buildout.org</a>
</p></blockquote>
<p>I’ve documented the steps required to create a simple buildout based project.</p>
<ol>
<li>
Start by creating a project directory and initialise a virtual environment inside the project directory.
<pre class="brush: bash; title: ; notranslate" title="">
$ mkdir word_count_buildout &amp;&amp; cd word_count_buildout
$ virtualenv --no-site-packages .env
$ source .env/bin/activate
</pre>
</li>
<li>
Fetch bootstrap-buildout.py. A common script required to create necessary directories and eggs (like setuptools, etc. )
<pre class="brush: bash; title: ; notranslate" title=""> 
$ wget https://bootstrap.pypa.io/bootstrap-buildout.py
</pre>
</li>
<li>
Create a buildout configuration file
<pre class="brush: bash; title: ; notranslate" title="">
$ vi buildout.cfg
</pre>
<p>copy &amp; paste the following snippet</p>
<pre class="brush: plain; title: ; notranslate" title="">
[buildout]
develop = .
parts = job job-test scripts zipeggs
# index = http://mypypicloud.example.com:6543/pypi/

[job]
recipe = zc.recipe.egg
interpreter = python
eggs = wordcount-job

[job-test]
recipe = pbp.recipe.noserunner
eggs = pbp.recipe.noserunner
working-directory = ${buildout:directory}

[scripts]
recipe = zc.recipe.egg:scripts
eggs = dumbo

[zipeggs]
recipe = zipeggs:zipeggs
target = dist 
source = eggs
</pre>
<p>basic config file structure explained <a href="http://buildout.readthedocs.org/en/latest/docs/tutorial.html#zope-event-buildout-cfg">here.</a></p>
<ul>
<li><strong>ln:4 index</strong> If using private PyPi, uncomment and replace the URL.</li>
<li><strong>ln:21 recipe = zipeggs:zipeggs</strong> – a buildout recipe to zip all flattened/unzipped eggs, flattened/unzipped eggs are convenient while developing (for debugging purpose) and they load faster. Dumbo requires zipped eggs to be passed via <strong>-libegg</strong> param, zipeggs recipe can generate zipped eggs under target directory (dist). more details <a href="https://github.com/tamizhgeek/zipeggs">@tamizhgeek repo</a>. </li>
</ul>
</li>
<li>
Execute the bootstrap file
<pre class="brush: bash; title: ; notranslate" title="">
$ python bootstrap-buildout.py

Downloading https://pypi.python.org/packages/source/s/setuptools/setuptools-18.1.zip
Extracting in /tmp/tmpZ7ki33
Now working in /tmp/tmpZ7ki33/setuptools-18.1
Building a Setuptools egg in /tmp/bootstrap-q4Xfc5
/tmp/bootstrap-q4Xfc5/setuptools-18.1-py2.7.egg
Creating directory '/home/raj/workspace/word_count/eggs'.
Creating directory '/home/raj/workspace/word_count/bin'.
Creating directory '/home/raj/workspace/word_count/parts'.
Creating directory '/home/raj/workspace/word_count/develop-eggs'.
Generated script '/home/raj/workspace/word_count/bin/buildout'.
</pre>
<p>The script has created few directories and a <strong>buildout</strong> script inside bin directory. Read more about the directory structure <a href="http://buildout.readthedocs.org/en/latest/docs/dirstruct.html"> here</a>
</p></li>
<li>
Create <strong>setup.py</strong>.
<pre class="brush: bash; title: ; notranslate" title="">
$ vi setup.py
</pre>
<pre class="brush: python; title: ; notranslate" title="">
from setuptools import setup, find_packages
import os
version = os.environ.get("PIPELINE_LABEL", "1.0")
setup(
    name="wordcount-job",
    version=version,
    packages=find_packages(),
    zip_safe=True,
    install_requires=[
        'dumbo'
    ]
)
</pre>
<p>Read more about setuptools <a href="https://pythonhosted.org/setuptools/">here</a>.<br/>
Any changes to <strong>setup.py</strong> and <strong>buildout.cfg</strong> should be followed by executing <strong>./bin/buildout</strong>
</p></li>
<li>
Create a python module for a simple word-count <a href="https://github.com/klbostee/dumbo/wiki" target="_blank">dumbo</a> job.
<pre class="brush: bash; title: ; notranslate" title="">
$ mkdir wordcount-job &amp;&amp; touch wordcount-job/__init__.py
$ vi wordcount-job/wordcount.py
</pre>
<p>copy &amp; paste the following code.</p>
<pre class="brush: python; title: ; notranslate" title="">
def mapper(key, value):
    for word in value.split():
        yield word, 1

def reducer(key, values):
    yield key, sum(values)

if __name__ == "__main__":
    import dumbo
    dumbo.run(mapper, reducer)
</pre>
</li>
<li>
Finally, run the buildout script to fetch artifacts from private or central pypi
<pre class="brush: bash; title: ; notranslate" title="">
$ ./bin/buildout
</pre>
<p>All the dependencies (and its dependencies) mentioned in <strong>setup.py</strong> are collected under <strong>eggs/</strong> directory. Zipped eggs are available under <strong>dist/</strong> directory and executable scripts with dependencies wired are generated under bin directory. Try viewing the contents of  <strong>bin/dumbo</strong>.
</p></li>
<li>
To run the job
<pre class="brush: bash; title: ; notranslate" title="">
$ ./bin/dumbo start wordcount-job/wordcount.py -input /tmp/input -output /tmp/output 
</pre>
<p>wordcount.py can access all the dependencies (under <strong>eggs/</strong> directory) mentioned in <strong>setup.py</strong>.
</p></li>
<li>
To run tests. 
<pre class="brush: plain; title: ; notranslate" title="">
$ ./bin/job-test
</pre>
<p>read more about <a href="https://github.com/hongbinbao/noserunner">pbp.recipe.noserunner recipe</a> and  <a href="http://pythontesting.net/framework/nose/nose-introduction/" target="_blank">nose</a>
</p></li>
<li>
To build egg
<pre class="brush: bash; title: ; notranslate" title="">
$ ./bin/buildout setup . bdist_egg
</pre>
</li>
<li>
<a href="http://pypicloud.readthedocs.org/en/latest/">Private PyPi</a> repos can also be used to distribute python eggs. To publish an egg to a private pypi, create config for pypicloud under home directory
<pre class="brush: bash; title: ; notranslate" title="">
$ cd $HOME &amp;&amp; vi .pypirc
</pre>
<p>copy &amp; paste the following</p>
<pre class="brush: plain; title: ; notranslate" title="">
[distutils]
index-servers = my-pypi
&amp;nbsp;
[my-pypi]
repository: http://mypypicloud.example.com:6543/pypi/
username: username
password: password
</pre>
<p>Under project working directory</p>
<pre class="brush: bash; title: ; notranslate" title="">
$ ./bin/buildout setup . bdist_egg upload -r my-pypi
</pre>
</li>
<li>
<a href="https://github.com/rajeshmr/rajmak.wordpress.com/tree/master/word_count_buildout" target="_blank">Source code</a>
</li>
<li>
<strong>Beer</strong> to bud <a href="https://twitter.com/azhaguselvan">@azhaguselvan</a> for support and stuff.
</li>
</ol>
		<p id="geo-post-67" class="geo geo-post">
			<span class="latitude">13.082680</span>
			<span class="longitude">80.270718</span>
		</p>		<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><p class="geolocation-chip"><span class="noticon noticon-location"/>Chennai, Tamil Nadu, India</p>
<div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-49519113-67-56d5a802457a1" data-src="//widgets.wp.com/likes/#blog_id=49519113&amp;post_id=67&amp;origin=rajmak.wordpress.com&amp;obj_id=49519113-67-56d5a802457a1" data-name="like-post-frame-49519113-67-56d5a802457a1"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div></div>						<hr/>
		</div>

		
</div></body></html>