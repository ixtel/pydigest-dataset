<html><body><div><div class="entry-content">
		<p>A picture is worth a thousand tweets: more often than not, designing a good <a href="http://en.wikipedia.org/wiki/Data_visualization">visual representation</a> of our data, can help us make sense of them and highlight interesting insights. After collecting and analysing Twitter data, the tutorial continues with some notions on data visualisation with Python.</p>
<p>Tutorial Table of Contents:</p>

<h2>From Python to Javascript with Vincent</h2>
<p>While there are some options to create plots in Python using libraries like matplotlib or ggplot, one of the coolest libraries for data visualisation is probably <a href="http://d3js.org/">D3.js</a> which is, as the name suggests, based on Javascript. D3 plays well with web standards like CSS and SVG, and allows to create some wonderful interactive visualisations. </p>
<p><a href="https://github.com/wrobstory/vincent">Vincent</a> bridges the gap between a Python back-end and a front-end that supports D3.js visualisation, allowing us to benefit from both sides. The tagline of Vincent is in fact “The data capabilities of Python. The visualization capabilities of JavaScript”. Vincent, a Python library, takes our data in Python format and translates them into <a href="https://github.com/trifacta/vega">Vega</a>, a JSON-based visualisation grammar that will be used on top of D3. It sounds quite complicated, but it’s fairly simple and <em>pythonic</em>. You don’t have to write a line in Javascript/D3 if you don’t want to.</p>
<p>Firstly, let’s install Vincent:</p>
<pre>sudo pip install vincent</pre>
<p>Secondly, let’s create our first plot. Using the <a href="http://marcobonzanini.com/2015/03/17/mining-twitter-data-with-python-part-3-term-frequencies/">list of most frequent terms</a> (without hashtags) from our <a href="http://marcobonzanini.com/2015/03/23/mining-twitter-data-with-python-part-4-rugby-and-term-co-occurrences/">rugby data set</a>, we want to plot their frequencies:</p>
<pre class="brush: python; title: ; notranslate" title="">
import vincent

word_freq = count_terms_only.most_common(20)
labels, freq = zip(*word_freq)
data = {'data': freq, 'x': labels}
bar = vincent.Bar(data, iter_idx='x')
bar.to_json('term_freq.json')
</pre>
<p>At this point, the file <tt>term_freq.json</tt> will contain a description of the plot that can be handed over to D3.js and Vega. A simple template (taken from Vincent resources) to visualise the plot:</p>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;html&gt;  
&lt;head&gt;    
    &lt;title&gt;Vega Scaffold&lt;/title&gt;
    &lt;script src="http://d3js.org/d3.v3.min.js" charset="utf-8"&gt;&lt;/script&gt;
    &lt;script src="http://d3js.org/topojson.v1.min.js"&gt;&lt;/script&gt;
    &lt;script src="http://d3js.org/d3.geo.projection.v0.min.js" charset="utf-8"&gt;&lt;/script&gt;
    &lt;script src="http://trifacta.github.com/vega/vega.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="vis"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script type="text/javascript"&gt;
// parse a spec and create a visualization view
function parse(spec) {
  vg.parse.spec(spec, function(chart) { chart({el:"#vis"}).update(); });
}
parse("term_freq.json");
&lt;/script&gt;
&lt;/html&gt;
</pre>
<p>Save the above HTML page as <tt>chart.html</tt> and run the simple Python web server:</p>
<pre>python -m http.server 8888 # Python 3
python -m SimpleHTTPServer 8888 # Python 2</pre>
<p>Now you can open your browser at <a href="http://localhost:8888/chart.html">http://localhost:8888/chart.html</a> and observe the result:</p>
<p><a href="https://marcobonzanini.files.wordpress.com/2015/04/term_freq.png"><img src="https://marcobonzanini.files.wordpress.com/2015/04/term_freq.png?w=300&amp;h=159" alt="Term Frequencies" class="alignnone size-medium wp-image-102"/></a></p>
<p>Notice: you could save the HTML template directly from Python with:</p>
<pre class="brush: python; title: ; notranslate" title="">
bar.to_json('term_freq.json', html_out=True, html_path='chart.html')
</pre>
<p>but, at least in Python 3, the output is not a well formed HTML and you’d need to manually strip some characters.</p>
<p>With this procedure, we can plot many different types of charts with Vincent. Let’s take a moment to <a href="http://vincent.readthedocs.org/en/latest/">browse the docs</a> and see its capabilities.</p>
<h2>Time Series Visualisation</h2>
<p>Another interesting aspect of analysing data from Twitter is the possibility to observe the distribution of tweets over time. In other words, if we organise the frequencies into temporal buckets, we could observe how Twitter users react to real-time events.</p>
<p>One of my favourite tools for data analysis with Python is <a href="http://pandas.pydata.org/">Pandas</a>, which also has a fairly decent support for time series. As an example, let’s track the hashtag <tt>#ITAvWAL</tt> to observe what happened during the first match.</p>
<p>Firstly, if we haven’t done it yet, we need to install Pandas:</p>
<pre>sudo pip install pandas</pre>
<p>In the main loop which reads all the tweets, we simply track the occurrences of the hashtag, i.e. we can refactor the code <a href="http://marcobonzanini.com/2015/03/23/mining-twitter-data-with-python-part-4-rugby-and-term-co-occurrences/">from the previous episodes</a> into something similar to:</p>
<pre class="brush: python; title: ; notranslate" title="">
import pandas
import json

dates_ITAvWAL = []
# f is the file pointer to the JSON data set
for line in f:
    tweet = json.loads(line)
    # let's focus on hashtags only at the moment
    terms_hash = [term for term in preprocess(tweet['text']) if term.startswith('#')]
    # track when the hashtag is mentioned
    if '#itavwal' in terms_hash:
        dates_ITAvWAL.append(tweet['created_at'])

# a list of "1" to count the hashtags
ones = [1]*len(dates_ITAvWAL)
# the index of the series
idx = pandas.DatetimeIndex(dates_ITAvWAL)
# the actual series (at series of 1s for the moment)
ITAvWAL = pandas.Series(ones, index=idx)

# Resampling / bucketing
per_minute = ITAvWAL.resample('1Min', how='sum').fillna(0)
</pre>
<p>The last line is what allows us to track the frequencies over time. The series is re-sampled with intervals of 1 minute. This means all the tweets falling within a particular minute will be aggregated, more precisely they will be summed up, given <tt>how='sum'</tt>. The time index will not keep track of the seconds anymore. If there is no tweet in a particular minute, the <tt>fillna()</tt> function will fill the blanks with zeros.</p>
<p>To put the time series in a plot with Vincent:</p>
<pre class="brush: python; title: ; notranslate" title="">
time_chart = vincent.Line(ITAvWAL)
time_chart.axis_titles(x='Time', y='Freq')
time_chart.to_json('time_chart.json')
</pre>
<p>Once you embed the <tt>time_chart.json</tt> file into the HTML template discussed above, you’ll see this output:</p>
<p><a href="https://marcobonzanini.files.wordpress.com/2015/04/time1.png"><img src="https://marcobonzanini.files.wordpress.com/2015/04/time1.png?w=300&amp;h=163" alt="Time Series" class="alignnone size-medium wp-image-103"/></a></p>
<p>The interesting moments of the match are observable from the spikes in the series. The first spike just before 1pm corresponds to the first Italian try. All the other spikes between 1:30 and 2:30pm correspond to Welsh tries and show the Welsh dominance during the second half. The match was over by 2:30, so after that Twitter went quiet.</p>
<p>Rather than just observing one sequence at a time, we could compare different series to observe how the matches has evolved. So let’s refactor the code for the time series, keeping track of the three different hashtags <tt>#ITAvWAL</tt>, <tt>#SCOvIRE</tt> and <tt>#ENGvFRA</tt> into the corresponding <tt>pandas.Series</tt>. </p>
<pre class="brush: python; title: ; notranslate" title="">
# all the data together
match_data = dict(ITAvWAL=per_minute_i, SCOvIRE=per_minute_s, ENGvFRA=per_minute_e)
# we need a DataFrame, to accommodate multiple series
all_matches = pandas.DataFrame(data=match_data,
                               index=per_minute_i.index)
# Resampling as above
all_matches = all_matches.resample('1Min', how='sum').fillna(0)

# and now the plotting
time_chart = vincent.Line(all_matches[['ITAvWAL', 'SCOvIRE', 'ENGvFRA']])
time_chart.axis_titles(x='Time', y='Freq')
time_chart.legend(title='Matches')
time_chart.to_json('time_chart.json')
</pre>
<p>And the output:</p>
<p><a href="https://marcobonzanini.files.wordpress.com/2015/04/time2.png"><img src="https://marcobonzanini.files.wordpress.com/2015/04/time2.png?w=300&amp;h=155" alt="time2" class="alignnone size-medium wp-image-104"/></a></p>
<p>We can immediately observe when the different matches took place (approx 12:30-2:30, 2:30-4:30 and 5-7) and we can see how the last match had the all the attentions, especially in the end when the winner was revealed.</p>
<h2>Summary</h2>
<p>Data visualisation is an important discipline in the bigger context of data analysis. By supporting visual representations of our data, we can provide interesting insights. We have discussed a relatively simple option to support data visualisation with Python using Vincent. In particular, we have seen how we can easily bridge the gap between Python and a language like Javascript that offers a great tool like D3.js, one of the most important libraries for interactive visualisation. Overall, we have just scratched the surface of data visualisation, but as a starting point this should be enough to get some nice ideas going. The nature of Twitter as a medium has also encouraged a quick look into the topic of time series analysis, allowing us to mention <tt>pandas</tt> as a great Python tool.</p>
<p>If this article has given you some ideas for data visualisation, please leave a comment below or get in touch.</p>
<p><a href="http://www.twitter.com/marcobonzanini">@MarcoBonzanini</a></p>
<p>Tutorial Table of Contents:</p>

<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-82018920-101-56d5b41f9f79a" data-src="//widgets.wp.com/likes/#blog_id=82018920&amp;post_id=101&amp;origin=marcobonzanini.wordpress.com&amp;obj_id=82018920-101-56d5b41f9f79a" data-name="like-post-frame-82018920-101-56d5b41f9f79a"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p></div>	</div>

	
</div></body></html>