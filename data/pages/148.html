<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-responses" class="anchor" href="#responses" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Responses</h1>
<a href="https://travis-ci.org/getsentry/responses"><img alt="https://travis-ci.org/getsentry/responses.png?branch=master" src="https://camo.githubusercontent.com/4c0ddb26785ae124bef6ef0fe7e2c71a74d30d83/68747470733a2f2f7472617669732d63692e6f72672f67657473656e7472792f726573706f6e7365732e706e673f6272616e63683d6d6173746572" data-canonical-src="https://travis-ci.org/getsentry/responses.png?branch=master"/></a>
<p>A utility library for mocking out the requests Python library.</p>
<div>
<p>Note</p>
<p>Responses requires Requests &gt;= 2.0</p>
</div>
<a name="user-content-response-body-as-string"/>
<h2><a id="user-content-response-body-as-string" class="anchor" href="#response-body-as-string" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Response body as string</h2>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> responses
<span class="pl-k">import</span> requests

<span class="pl-en">@responses.activate</span>
<span class="pl-k">def</span> <span class="pl-en">test_my_api</span>():
    responses.add(responses.<span class="pl-c1">GET</span>, <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>,
                  <span class="pl-v">body</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>{"error": "not found"}<span class="pl-pds">'</span></span>, <span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-c1">404</span>,
                  <span class="pl-v">content_type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>)

    resp <span class="pl-k">=</span> requests.get(<span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>)

    <span class="pl-k">assert</span> resp.json() <span class="pl-k">==</span> {<span class="pl-s"><span class="pl-pds">"</span>error<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>not found<span class="pl-pds">"</span></span>}

    <span class="pl-k">assert</span> <span class="pl-c1">len</span>(responses.calls) <span class="pl-k">==</span> <span class="pl-c1">1</span>
    <span class="pl-k">assert</span> responses.calls[<span class="pl-c1">0</span>].request.url <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>
    <span class="pl-k">assert</span> responses.calls[<span class="pl-c1">0</span>].response.text <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>{"error": "not found"}<span class="pl-pds">'</span></span></pre></div>
<p>You can also specify a JSON object instead of a body string.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> responses
<span class="pl-k">import</span> requests

<span class="pl-en">@responses.activate</span>
<span class="pl-k">def</span> <span class="pl-en">test_my_api</span>():
    responses.add(responses.<span class="pl-c1">GET</span>, <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>,
                  <span class="pl-v">json</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">"</span>error<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>not found<span class="pl-pds">"</span></span>}, <span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-c1">404</span>)

    resp <span class="pl-k">=</span> requests.get(<span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>)

    <span class="pl-k">assert</span> resp.json() <span class="pl-k">==</span> {<span class="pl-s"><span class="pl-pds">"</span>error<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>not found<span class="pl-pds">"</span></span>}

    <span class="pl-k">assert</span> <span class="pl-c1">len</span>(responses.calls) <span class="pl-k">==</span> <span class="pl-c1">1</span>
    <span class="pl-k">assert</span> responses.calls[<span class="pl-c1">0</span>].request.url <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>
    <span class="pl-k">assert</span> responses.calls[<span class="pl-c1">0</span>].response.text <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>{"error": "not found"}<span class="pl-pds">'</span></span></pre></div>
<a name="user-content-request-callback"/>
<h2><a id="user-content-request-callback" class="anchor" href="#request-callback" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Request callback</h2>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> json

<span class="pl-k">import</span> responses
<span class="pl-k">import</span> requests

<span class="pl-en">@responses.activate</span>
<span class="pl-k">def</span> <span class="pl-en">test_calc_api</span>():

    <span class="pl-k">def</span> <span class="pl-en">request_callback</span>(<span class="pl-smi">request</span>):
        payload <span class="pl-k">=</span> json.loads(request.body)
        resp_body <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>: <span class="pl-c1">sum</span>(payload[<span class="pl-s"><span class="pl-pds">'</span>numbers<span class="pl-pds">'</span></span>])}
        headers <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>request-id<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>728d329e-0e86-11e4-a748-0c84dc037c13<span class="pl-pds">'</span></span>}
        <span class="pl-k">return</span> (<span class="pl-c1">200</span>, headers, json.dumps(resp_body))

    responses.add_callback(
        responses.<span class="pl-c1">POST</span>, <span class="pl-s"><span class="pl-pds">'</span>http://calc.com/sum<span class="pl-pds">'</span></span>,
        <span class="pl-v">callback</span><span class="pl-k">=</span>request_callback,
        <span class="pl-v">content_type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>,
    )

    resp <span class="pl-k">=</span> requests.post(
        <span class="pl-s"><span class="pl-pds">'</span>http://calc.com/sum<span class="pl-pds">'</span></span>,
        json.dumps({<span class="pl-s"><span class="pl-pds">'</span>numbers<span class="pl-pds">'</span></span>: [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]}),
        <span class="pl-v">headers</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>content-type<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>},
    )

    <span class="pl-k">assert</span> resp.json() <span class="pl-k">==</span> {<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>: <span class="pl-c1">6</span>}

    <span class="pl-k">assert</span> <span class="pl-c1">len</span>(responses.calls) <span class="pl-k">==</span> <span class="pl-c1">1</span>
    <span class="pl-k">assert</span> responses.calls[<span class="pl-c1">0</span>].request.url <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>http://calc.com/sum<span class="pl-pds">'</span></span>
    <span class="pl-k">assert</span> responses.calls[<span class="pl-c1">0</span>].response.text <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>{"value": 6}<span class="pl-pds">'</span></span>
    <span class="pl-k">assert</span> (
        responses.calls[<span class="pl-c1">0</span>].response.headers[<span class="pl-s"><span class="pl-pds">'</span>request-id<span class="pl-pds">'</span></span>] <span class="pl-k">==</span>
        <span class="pl-s"><span class="pl-pds">'</span>728d329e-0e86-11e4-a748-0c84dc037c13<span class="pl-pds">'</span></span>
    )</pre></div>
<p>Instead of passing a string URL into responses.add or responses.add_callback
you can also supply a compiled regular expression.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> re
<span class="pl-k">import</span> responses
<span class="pl-k">import</span> requests

<span class="pl-c"># Instead of</span>
responses.add(responses.<span class="pl-c1">GET</span>, <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>,
              <span class="pl-v">body</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>{"error": "not found"}<span class="pl-pds">'</span></span>, <span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-c1">404</span>,
              <span class="pl-v">content_type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>)

<span class="pl-c"># You can do the following</span>
url_re <span class="pl-k">=</span> re.compile(<span class="pl-sr"><span class="pl-k">r</span><span class="pl-pds">'</span>https<span class="pl-k">?</span>://twitter<span class="pl-c1">.</span>com/api/<span class="pl-c1">\d</span><span class="pl-k">+</span>/foobar<span class="pl-pds">'</span></span>)
responses.add(responses.<span class="pl-c1">GET</span>, url_re,
              <span class="pl-v">body</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>{"error": "not found"}<span class="pl-pds">'</span></span>, <span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-c1">404</span>,
              <span class="pl-v">content_type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>)</pre></div>
<p>A response can also throw an exception as follows.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> responses
<span class="pl-k">import</span> requests
<span class="pl-k">from</span> requests.exceptions <span class="pl-k">import</span> HTTPError

exception <span class="pl-k">=</span> HTTPError(<span class="pl-s"><span class="pl-pds">'</span>Something went wrong<span class="pl-pds">'</span></span>)
responses.add(responses.<span class="pl-c1">GET</span>, <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>,
              <span class="pl-v">body</span><span class="pl-k">=</span>exception)
<span class="pl-c"># All calls to 'http://twitter.com/api/1/foobar' will throw exception.</span></pre></div>
<a name="user-content-responses-as-a-context-manager"/>
<h2><a id="user-content-responses-as-a-context-manager" class="anchor" href="#responses-as-a-context-manager" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Responses as a context manager</h2>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> responses
<span class="pl-k">import</span> requests


<span class="pl-k">def</span> <span class="pl-en">test_my_api</span>():
    <span class="pl-k">with</span> responses.RequestsMock() <span class="pl-k">as</span> rsps:
        rsps.add(responses.<span class="pl-c1">GET</span>, <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>,
                 <span class="pl-v">body</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span><span class="pl-c1">{}</span><span class="pl-pds">'</span></span>, <span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-c1">200</span>,
                 <span class="pl-v">content_type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>)
        resp <span class="pl-k">=</span> requests.get(<span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>)

        <span class="pl-k">assert</span> resp.status_code <span class="pl-k">==</span> <span class="pl-c1">200</span>

    <span class="pl-c"># outside the context manager requests will hit the remote server</span>
    resp <span class="pl-k">=</span> requests.get(<span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>)
    resp.status_code <span class="pl-k">==</span> <span class="pl-c1">404</span></pre></div>
<a name="user-content-assertions-on-declared-responses"/>
<h2><a id="user-content-assertions-on-declared-responses" class="anchor" href="#assertions-on-declared-responses" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Assertions on declared responses</h2>
<p>When used as a context manager, Responses will, by default, raise an assertion
error if a url was registered but not accessed. This can be disabled by passing
the <code>assert_all_requests_are_fired</code> value:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> responses
<span class="pl-k">import</span> requests


<span class="pl-k">def</span> <span class="pl-en">test_my_api</span>():
    <span class="pl-k">with</span> responses.RequestsMock(<span class="pl-v">assert_all_requests_are_fired</span><span class="pl-k">=</span><span class="pl-c1">False</span>) <span class="pl-k">as</span> rsps:
        rsps.add(responses.<span class="pl-c1">GET</span>, <span class="pl-s"><span class="pl-pds">'</span>http://twitter.com/api/1/foobar<span class="pl-pds">'</span></span>,
                 <span class="pl-v">body</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span><span class="pl-c1">{}</span><span class="pl-pds">'</span></span>, <span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-c1">200</span>,
                 <span class="pl-v">content_type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>)</pre></div>

</article>
  </div></body></html>