<html><body><div><div class="content html_format"><p>
      Наверно в каждом проекте есть система навигации — пользователи кликают по ссылкам, менюшкам и нам(разработчикам\дизайнерам\верстальщикам) надо как-то «подсвечивать» страницу\ссылку на которой сейчас находится пользователь.</p>
<p>
Предоставляю не тривиальное решение очень тривиальной задачи при разработки навигации в Django проектах.
</p><a name="habracut"/><p>
Для не терпеливых можно сразу взглянуть на </p><a href="https://github.com/hellysmile/django-activeurl">проект на github</a><p>.

</p><h2>Самое тривиальное решение</h2><p>
В каждой вьюхе в контексте передаем некую переменную, пусть будет «location» и потом беспощадно хардкодим:

</p><pre><code class="django">&lt;ul&gt;
  &lt;li {% if location=='random_page' %} class="active" {% endif %}&gt;
    &lt;a href="{% url 'random_page' %}"&gt;
      {% trans 'random page' %}
    &lt;/a&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>
Получается — к каждой ссылки уникальное значение «location», что порождает очень много лишнего кода, когда ссылок\вьюх становится много практически не возможно запомнить какой «location» к какой ссылке, а так же верстальщик может быть крайне не доволен необходимостью вникать в логику питоновских вьюх и какое значение от куда попадает в контекст.
</p><p>
Можно передавать «location» такой же как именная ссылка данной вьюхи и навигация станет слегка наглядней.

</p><h2>Реализация через простой «template filter»</h2><p>
собственно фильтр:

</p><pre><code class="python">from django import template


register = template.Library()


def active(url, request):
    if url == request.get_full_path():
        return True
    else:
        return False


register.filter('active', active)
</code></pre><p>
дальше в шаблоне:

</p><pre><code class="django">{% load active %}

&lt;ul&gt;
  {% url 'random_page' as random_page %}
  &lt;li {% if random_page|active:request %} class="active" {% endif %}&gt;
    &lt;a href="{{ random_page }}"&gt;
      {% trans 'random page' %}
    &lt;/a&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>
Передавать переменные с вьюх уже не нужно, можно заменить сравнение на .startswith() или вовсе на регулярки и добавить поддержу меню, например светить ссылку на "/menu/" когда пользователь находится на странице "/menu/submenu/". Но рутина никуда не делась…

</p><h2>Мои велосипеды — django-activeurl</h2><p>
Рутинные действия напрочь отсутствуют, а именно:

</p><pre><code class="django">{% load activeurl %}

{% activeurl %}
  &lt;ul&gt;
    &lt;li&gt;
      &lt;a href="{% url 'random_page' %}"&gt;
        {% trans 'random page' %}
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
{% endactiveurl %}
</code></pre><p>
немного магии…

</p><pre><code class="html">&lt;ul&gt;
  &lt;li class="active"&gt;
    &lt;a href="/random_page/"&gt;
      random page
    &lt;/a&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>
Установка как и у всех питоновских батареек:

</p><pre><code class="bash">pip install django-activeurl
</code></pre><p>
Все нюансы описаны </p><a href="https://github.com/hellysmile/django-activeurl#installation">тут</a><p>.
</p><p>
Теперь, немного о том как всё это работает — из переданного html с помощью </p><a href="http://lxml.de/">lxml</a><p> строится дерево, в нем идет поиск HTML элементов которые надо подсветить(по умолчанию «li»), потом в этом тэге берутся все ссылки и их параметр «href» сравнивается с «request.get_full_path()».
</p><p>
Реализованные фичи:

</p><p>
Поменьше всем рутинных задач при разработке!

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>