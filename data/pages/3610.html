<html><body><div><header class="entry-header"><h1 class="entry-title" itemprop="headline">pytest expect fixture plugin, iteration 1</h1> 
<p class="entry-meta"><time class="entry-time" itemprop="datePublished" datetime="2015-03-10T06:28:02+00:00">March 10, 2015</time> By <span class="entry-author" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="http://pythontesting.net/author/brian-2/" class="entry-author-link" itemprop="url" rel="author"><span class="entry-author-name" itemprop="name">Brian</span></a></span> <span class="entry-comments-link"><a href="http://pythontesting.net/framework/pytest/pytest-expect-plugin-1/#comments">2 Comments</a></span> </p></header><div class="entry-content" itemprop="text"><p>This is the first iteration that implements ‘expect’ as a fixture.</p>
<p>This is really the third attempt at an ‘expect()’ implementation that allows multiple failures per test.</p>
<ol>
<li><a href="http://pythontesting.net/strategy/delayed-assert/">First attempt</a> was a general solution that works with any test framework, but with a slightly clunky API. The main problem with it was that it required the test to call a final ‘assert_expectations()’ from the test code. If you forgot to call that function, the failures weren’t reported.</li>
<li><a href="http://pythontesting.net/framework/pytest/pytest-delayed-assert-plugin-1/">Second attempt</a> was a pytest plugin implementation that eliminated the need for the ‘assert_expectations()’ call in the test because it was called automatically. <a href="http://pythontesting.net/framework/pytest/pytest-delayed-assert-plugin-1/#issues">I wasn’t thrilled with this solution.</a> But it works.</li>
<li>In the solution I’m presenting in this post, I’m moving all of the code into one file and implementing ‘expect’ as a pytest fixture. </li>
</ol>
<p><span id="more-50137"/></p>
<p>I think there are advantages to having ‘expect’ as a fixture.<br/>
Let me know what you think.</p>
<p>For now, it’s implemented as a local plugin in ‘conftest.py’.<br/>
I’ll implement it as an installable plugin in a future iteration.</p>
<h2>Implementation of expect fixture as a local plugin</h2>
<p><strong>conftest.py</strong><br/>
<code/></p>
<p/>

		<div id="crayon-56d5a7ac4e09d747225519" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-1">1</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-2">2</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-3">3</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-4">4</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-5">5</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-6">6</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-7">7</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-8">8</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-9">9</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-10">10</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-11">11</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-12">12</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-13">13</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-14">14</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-15">15</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-16">16</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-17">17</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-18">18</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-19">19</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-20">20</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-21">21</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-22">22</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-23">23</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-24">24</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-25">25</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-26">26</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-27">27</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-28">28</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-29">29</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-30">30</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-31">31</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-32">32</p><p class="crayon-num" data-line="crayon-56d5a7ac4e09d747225519-33">33</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-1"><span class="crayon-e">import </span><span class="crayon-e">pytest</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-2"><span class="crayon-e">import </span><span class="crayon-e">inspect</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-3"><span class="crayon-e">import </span><span class="crayon-v">os</span><span class="crayon-sy">.</span><span class="crayon-i">path</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-4"> </p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-5"><span class="crayon-sy">@</span><span class="crayon-v">pytest</span><span class="crayon-sy">.</span><span class="crayon-e">fixture</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-6"><span class="crayon-e">def </span><span class="crayon-e">expect</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-7"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">do_expect</span><span class="crayon-sy">(</span><span class="crayon-v">expr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-8"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">expr</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-9"><span class="crayon-h">            </span><span class="crayon-e">_log_failure</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">node</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-10"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">do_expect</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-11"> </p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-12"><span class="crayon-e">def </span><span class="crayon-e">_log_failure</span><span class="crayon-sy">(</span><span class="crayon-v">node</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-o">=</span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-13"><span class="crayon-h">    </span><span class="crayon-p"># get filename, line, and context</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-14"><span class="crayon-h">    </span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">funcname</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">contextlist</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">  </span><span class="crayon-v">inspect</span><span class="crayon-sy">.</span><span class="crayon-e">stack</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-15"><span class="crayon-h">    </span><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">os</span><span class="crayon-sy">.</span><span class="crayon-v">path</span><span class="crayon-sy">.</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-16"><span class="crayon-h">    </span><span class="crayon-v">context</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">contextlist</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-17"><span class="crayon-h">    </span><span class="crayon-p"># format entry</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-18"><span class="crayon-h">    </span><span class="crayon-v">msg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'%s\n'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">msg </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">msg </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-s">''</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-19"><span class="crayon-h">    </span><span class="crayon-v">entry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&gt;%s%s%s:%s\n--------'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">context</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-20"><span class="crayon-h">    </span><span class="crayon-p"># add entry </span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-21"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">hasattr</span><span class="crayon-sy">(</span><span class="crayon-v">node</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'_failed_expect'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-22"><span class="crayon-h">        </span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-v">_failed_expect</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-23"><span class="crayon-h">    </span><span class="crayon-v">node</span><span class="crayon-sy">.</span><span class="crayon-v">_failed_expect</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">entry</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-24"> </p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-25"><span class="crayon-sy">@</span><span class="crayon-v">pytest</span><span class="crayon-sy">.</span><span class="crayon-v">mark</span><span class="crayon-sy">.</span><span class="crayon-e">tryfirst</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-26"><span class="crayon-e">def </span><span class="crayon-e">pytest_runtest_makereport</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">call</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">__multicall__</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-27"><span class="crayon-h">    </span><span class="crayon-v">report</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">__multicall__</span><span class="crayon-sy">.</span><span class="crayon-e">execute</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-28"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">call</span><span class="crayon-sy">.</span><span class="crayon-v">when</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"call"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">report</span><span class="crayon-sy">.</span><span class="crayon-e">passed </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">hasattr</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'_failed_expect'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-29"><span class="crayon-h">        </span><span class="crayon-v">report</span><span class="crayon-sy">.</span><span class="crayon-v">outcome</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"failed"</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-30"><span class="crayon-h">        </span><span class="crayon-v">summary</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Failed Expectations:%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">.</span><span class="crayon-v">_failed_expect</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-31"><span class="crayon-h">        </span><span class="crayon-v">item</span><span class="crayon-sy">.</span><span class="crayon-v">_failed_expect</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">summary</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-32"><span class="crayon-h">        </span><span class="crayon-v">report</span><span class="crayon-sy">.</span><span class="crayon-v">longrepr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\n'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">.</span><span class="crayon-v">_failed_expect</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e09d747225519-33"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">report</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p/>
<h2>Test code that uses ‘expect’ fixture.</h2>
<p><strong>test_expect_fixture.py</strong><br/>
<code/></p>
<p/>

		<div id="crayon-56d5a7ac4e0ab347753059" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7ac4e0ab347753059-1"><span class="crayon-e">def </span><span class="crayon-e">test_should_pass</span><span class="crayon-sy">(</span><span class="crayon-v">expect</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0ab347753059-2"><span class="crayon-h">    </span><span class="crayon-e">expect</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'one is one'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0ab347753059-3"> </p><p class="crayon-line" id="crayon-56d5a7ac4e0ab347753059-4"><span class="crayon-e">def </span><span class="crayon-e">test_should_fail</span><span class="crayon-sy">(</span><span class="crayon-v">expect</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0ab347753059-5"><span class="crayon-h">    </span><span class="crayon-e">expect</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0ab347753059-6"><span class="crayon-h">    </span><span class="crayon-e">expect</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'three is four'</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p/>
<h2>The output</h2>
<p>I think this is identical to the last iteration. But here it is anyway.</p>
<p><strong>test run</strong><br/>
<code/></p>
<p/>

		<div id="crayon-56d5a7ac4e0b3479678771" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-1">1</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-2">2</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-3">3</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-4">4</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-5">5</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-6">6</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-7">7</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-8">8</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-9">9</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-10">10</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-11">11</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-12">12</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-13">13</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-14">14</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-15">15</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-16">16</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-17">17</p><p class="crayon-num" data-line="crayon-56d5a7ac4e0b3479678771-18">18</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">python</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-e">pytest </span><span class="crayon-v">test_expect_fixture</span><span class="crayon-sy">.</span><span class="crayon-v">py</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-2"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-e">test </span><span class="crayon-e">session </span><span class="crayon-v">starts</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-3"><span class="crayon-e">platform </span><span class="crayon-v">darwin</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-i">Python</span><span class="crayon-h"> </span><span class="crayon-cn">2.7.9</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-v">py</span><span class="crayon-o">-</span><span class="crayon-cn">1.4.26</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-v">pytest</span><span class="crayon-o">-</span><span class="crayon-cn">2.6.4</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-4"><span class="crayon-i">collected</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">items </span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-5"> </p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-6"><span class="crayon-v">test_expect_fixture</span><span class="crayon-sy">.</span><span class="crayon-i">py</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-v">F</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-7"> </p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-8"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">FAILURES</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-9"><span class="crayon-e">_____________________________________ </span><span class="crayon-e">test_should_fail </span><span class="crayon-v">______________________________________</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-10"><span class="crayon-o">&gt;</span><span class="crayon-h">    </span><span class="crayon-e">expect</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-11"><span class="crayon-v">test_expect_fixture</span><span class="crayon-sy">.</span><span class="crayon-v">py</span><span class="crayon-o">:</span><span class="crayon-cn">7</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-12"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-13"><span class="crayon-o">&gt;</span><span class="crayon-h">    </span><span class="crayon-e">expect</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'three is four'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-14"><span class="crayon-e">three </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">four</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-15"><span class="crayon-v">test_expect_fixture</span><span class="crayon-sy">.</span><span class="crayon-v">py</span><span class="crayon-o">:</span><span class="crayon-cn">8</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-16"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-17"><span class="crayon-e">Failed </span><span class="crayon-v">Expectations</span><span class="crayon-o">:</span><span class="crayon-cn">2</span></p><p class="crayon-line" id="crayon-56d5a7ac4e0b3479678771-18"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-v">failed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">passed </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-h"> </span><span class="crayon-v">seconds</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">==</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p/>
<h2>Next</h2>
<ol>
<li>Make this an installable pytest plugin and package and such.</li>
<li>Push it to github or bitbucket. </li>
<li>Implement something like assert argument re-evaluation like pytest.</li>
<li>Perhaps implement something like assert rewrite. Again, I’ll probably have to beg and plead with some core pytest devs to assist in this because the AST stuff scares me.</li>
<li>At some point I’m going to have to implement it differently than using the ‘pytest_runtest_makereport(item, call, <strong>multicall</strong>)’ function, as I believe this is going to be depricated.</li>
<li>Maybe submit it to pypi, if it’s useful for other people.</li>
</ol>
<h2>Feedback</h2>
<p>I received some great feedback from both posts. I’m incorporating feedback from <a href="https://plus.google.com/u/1/103163484469110740177/posts">Bruno</a> and <a href="https://twitter.com/ossronny">Ronny</a> in this post.</p>
<p>Please provide feedback on this iteration as well.</p>

</div></div></body></html>