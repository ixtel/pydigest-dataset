<html><body><div><div class="comment-body markdown-body markdown-format js-comment-body">
          <p><a href="https://github.com/shoyer" class="user-mention">@shoyer</a> I'll give some comments, can copy to the list in a bit. Hopefully not TL;DR!</p>

<p>Their are 3 'dtype' likes that exist in pandas that could in theory mostly be migrated back to numpy. These currently exist as the <code>.values</code>  in-other-words the object to which pandas defers data storage and computation for some/most of operations.</p>

<p>1) <code>SparseArray</code>: This is the basis for <code>SparseSeries</code>. It is <code>ndarray</code>-like (its actually a ndarray-sub-class) and optimized for the 1-d case. My guess is that <a href="https://github.com/wesm" class="user-mention">@wesm</a> created this because it a) didn't exist in numpy, and b) didn't want <code>scipy</code> as a dependency.</p>

<p>2) datetime support: This is not a target dtype per se, but really a reimplementation over the top of <code>datetime64[ns]</code>, with the associated scalar <code>Timestamp</code> which is a proper sub-class of <code>datetime.datetime</code>. I believe <a href="https://github.com/wesm" class="user-mention">@wesm</a> created this because numpy datetime support was (and still is to some extent) just completely broken. It doesn't support proper timezones. And the scalar type (<code>np.datetime64</code>) is not extensible at all (e.g. so have not easy to have custom printing, or parsing).</p>

<p>3) <code>pd.Categorical</code>: This was another class wesm wrote several years ago. It is actually <em>could</em> be a numpy sub-class, though its a bit awkward as its really a numpy-like sub-class that contains 2 ndarray-like arrays, and is more appropriately implemented as a container of multiple-ndarrays.</p>

<p>So when we added support for <code>Categoricals</code> recently, why didn't we say try to push a <code>categorical</code> dtype? I think their are several reasons, in no particular order:</p>

<ul>
<li><p><code>pd.Categorical</code> is really a container of multiple ndarrays, and is ndarray-like. Further its API is somewhat constrained. It was simpler to make a python container class rather than try to sub-class ndarray and basically override / throw out many methods (as a lot of computation methods simply don't make sense between 2 categoricals). You can make a case that this *should not * be in numpy for this reason.</p></li>
<li><p>The changes in pandas for the 3 cases outlined above, were mostly on how to integrate these with the top-level containers (Series/DataFrame), rather than actually writing / re-writing a new dtype for a ndarray class. We always try to reuse, so we just try to extend the ndarray-like rather than create a new one from scratch.</p></li>
<li><p>Getting for example a Categorical dtype into numpy prob would take a pretty long cycle time. I think you need a champion for new features to really push them. It hasn't happened with datetime and that's been a while (of course its possible that pandas diverted some of this need)</p></li>
<li><p>API design: I think this is a big issue actually. When I added <code>Categorical</code> container support, I didn't want to change the API of <code>Categorical</code> much (and it pretty much worked out that way, mainly adding to it). So, say we took the path of assuming that numpy would have a nice categorical data dtype. We would almost certainly have to wrap it in something to provided needed functionaility that would necessarily be missing in an initial version. (of course eventually that may not be necessary).</p></li>
<li><p>So the 'nobody wants to write in C' argument is true for datetimes, but not for <code>SparseArray</code>/<code>Categorical</code>. In fact much of that code is just calling out to numpy (though some cython code too).</p></li>
<li><p>from a performance perspective, numpy needs a really good hashtable in order to support proper factorizing, which <a href="https://github.com/wesm" class="user-mention">@wesm</a> co-opted klib to do (see this thread <a href="https://www.mail-archive.com/numpy-discussion@scipy.org/msg46024.html">here</a></p></li>
</ul>

<p>So I know I am repeating myself, but it comes down to this. The API/interface of the delegated methods needs to be defined. For ndarrays it is long established and well-known. So easy to gear pandas to that. However with a <em>newer</em> type that is not the case, so pandas can easily decide, hey this is the most correct behavior, let's do it this way, nothing to break, no back compat needed.</p>
      </div>
    </div></body></html>