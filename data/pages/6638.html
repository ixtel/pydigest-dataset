<html><body><div><div class="col-md-12">
				<p>
Have you ever had your call disconnect while you were on hold with customer service and waiting for a transfer from one department to another? You probably felt like this when the call dropped:</p>
<p><img alt="" src="https://www.twilio.com/blog/wp-content/uploads/2015/09/NmcPm4Pu5ik-B9fRZa9hPP3n69c8s7UAsxWtDPZHOUWdR6yvTUDvIHJu8Qb4ZleT7-CIlK1SDmwkukmT1U69e960IX9iGfBrWk-jDzU6BB1CjusgVDYCDC5mnqUA2-Cum124H5g1.png" title="" class="&quot; aligncenter"/></p>
<p>A <a href="https://en.wikipedia.org/wiki/Call_transfer">warm phone call transfer</a>, where a caller is on the phone with an agent then the agent brings on another agent and introduces them to the customer, shouldn’t be so difficult. There are only a few steps that need to be done properly for a warm phone call transfer to work, as we can visualize in the following diagram.</p>
<p><img alt="" src="https://www.twilio.com/blog/wp-content/uploads/2015/09/71X8sfpyV03AcRP1h43lvSPO-3oaOCbFBPWexxwboPB766aXq6Z-cbVYZAhyKEPiqESy8DCJd8WAsJaYY6WR_xOD6ji2rXx98dMOqFZlbj9EeXGm7sozQojNkkOyKvPtDrLH_EE1.png" title="" class="&quot; aligncenter"/></p>
<p>As the diagram shows, a customer, who in this post we’ll refer to as Trinity, dials into a typical phone number for service. An agent, known as Agent Smith, answers the calls. However, Agent Smith discovers he can’t solve the problem and needs to connect Trinity to Agent Johnson, who’s better equipped to handle the issue. Agent Smith dials in Agent Johnson, introduces Agent Johnson to the customer, then hangs up so Trinity and Agent Johnson can solve the problem and finish the support call.<br/>
 <br/>
In this blog post, we’ll use <a href="https://www.twilio.com/voice">Twilio’s Voice API</a> and a bit of Python code to implement the above scenario and help rid the world of warm transfer failures so that this problem never happens to your callers.
</p>
<h2 class="c3 c4">
<a name="h.xjkovahktumn"/>What We’ll Need<br/>
</h2>
<p>Let’s walk through how to perform a warm transfer with Python and a simple web application built with the Flask framework. The following dependencies will be used to create and run the application:
</p>

<p>
We’ll also need three phones with phone numbers to represent Trinity, Agent Smith and Agent Johnson. If you don’t have multiple phones lying around for testing, you can use <a href="https://www.twilio.com/client">Twilio Client</a> to turn three browser tabs into different phones. Use <a href="https://github.com/choppen5/twilio-client-quicker-starter">this Twilio Client quickstart project with the deploy to Heroku button</a> to create phones as you need them.</p>
<p>There is also a <a href="https://github.com/makaimc/python-warm-transfer-call">GitHub repository with the code</a> we’ll be creating in this post. It’s a handy reference in case you make a typo or get stuck somewhere along the way. </p>
<p>Also, if Python isn’t your jam and Java is more your speed, check out <a href="https://www.twilio.com/blog/2015/08/how-to-warm-transfer-a-call-with-java-and-twilio-voice.html">my colleague’s post that handles a warm transfer in that language instead</a>.</p>
<p>Now that we know our dependencies, let’s get our coding environment established.
</p>
<h2 class="c3 c4">
<a name="h.wlcrnpq0se2z"/>Python Environment Setup<br/>
</h2>
<p>It’s time to get our Python development environment ready for this application. In this section we’ll handle the following steps to make sure you’re ready to run the code:
</p>
<ol class="c13 lst-kix_ptv63ymgpopf-0 start" start="1">
<li>
Check the Python installation
</li>
<li>
Set up a new <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> then activate it
</li>
<li>
Install a couple of dependencies via <a href="https://pypi.python.org/pypi/pip">pip</a>
</li>
<li>Fire up Ngrok to handle localhost tunneling</li>
<li>Obtain a phone number for our customer service line</li>
<li>Export a few critical environment variables for our application to use</li>
</ol>
<h3 class="c3 c4">
<a name="h.i3881r3h7o1m"/>Setup Step 1: Check the Python installation<br/>
</h3>
<p>If you’re on Mac OS X or Linux, you’ve already got Python installed on your system. Check the version by going into the terminal and typing 
			<span id="crayon-56d59b3e36e02120960966" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">python</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">version</span></span></span>. You’ll see the precise version number, something like 
			<span id="crayon-56d59b3e36e21110340960" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-i">Python</span><span class="crayon-h"> </span><span class="crayon-cn">2.7.6</span></span></span>. If you’re on Python 2.6 or greater, you’re good to go.</p>
<p>For Windows, make sure you <a href="https://www.python.org/downloads/">download and install the Python .exe installation package</a>. Either Python 2 or 3 is fine. My recommendation is to use Python 3.5 unless you have a pressing reason to use an earlier version, because the Python community is now migrating en masse to the Python 3.</p>
<p>Once Python is installed on your system and you can run it with the 
			<span id="crayon-56d59b3e36e2f312916716" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">python</span></span></span> command, we’re ready to set up a virtualenv.<br/>
 </p>
<h3 class="c3 c4">
<a name="h.3zy880owrph8"/>Setup Step 2: Set up a new virtualenv and activate it<br/>
</h3>
<p><a href="https://virtualenv.pypa.io/en/latest/">Virtualenv</a> is a dependency isolation library that makes it much easier to switch between Python versions and various code packages you’re using on different projects. Create a virtualenv in a location you’ll remember using the following command. In my case, I have a folder called 
			<span id="crayon-56d59b3e36e39295127595" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">Envs</span></span></span> under my home directory that keeps my virtualenv organized.
</p>
<p/>

		<div id="crayon-56d59b3e36e43971786626" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36e43971786626-1"><span class="crayon-v">virtualenv</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-o">/</span><span class="crayon-v">Envs</span><span class="crayon-o">/</span><span class="crayon-e">warmtransfer</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36e43971786626-2"><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-o">/</span><span class="crayon-v">Envs</span><span class="crayon-o">/</span><span class="crayon-v">warmtransfer</span><span class="crayon-o">/</span><span class="crayon-v">bin</span><span class="crayon-o">/</span><span class="crayon-v">activate</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
</p><p>
Now we have our virtualenv activated and should see our command prompt show the name of our virutalenv, such as 
			<span id="crayon-56d59b3e36e4d031789173" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-sy">(</span><span class="crayon-v">warmtransfer</span><span class="crayon-sy">)</span><span class="crayon-sy">$</span></span></span>. With the virtualenv in place and activated, we can use 
			<span id="crayon-56d59b3e36e57655623678" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">pip</span></span></span> to install our dependencies.
</p>
<h3 class="c3 c4">
<a name="h.kn9fbu8zhnu5"/>Setup Step 3: Install dependencies with pip<br/>
</h3>
<p>
			<span id="crayon-56d59b3e36e61465535915" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">pip</span></span></span> handles Python library installations. With your virtualenv still activated, run the following command to install our Flask and Twilio helper library dependencies.
</p>
<p/>

		<div id="crayon-56d59b3e36e70541698251" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36e70541698251-1"><span class="crayon-sy">(</span><span class="crayon-v">warmtransfer</span><span class="crayon-sy">)</span><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">flask</span><span class="crayon-o">==</span><span class="crayon-cn">0.10.1</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-o">==</span><span class="crayon-cn">4.4.0</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
</p><p>
You can likely install the newest versions of the Flask and Twilio packages but it’s preferable to peg dependencies to a specific version number just in case there are future backwards-incompatible modifications. With those libraries installed, next we need to launch Ngrok to create a localhost tunnel so that our application will be reachable by Twilio.
</p>
<h3 class="c3 c4">
<a name="h.mmw07o2gocr4"/>Setup Step 4: Fire up Ngrok<br/>
</h3>
<p><a href="https://ngrok.com/download">Download and install the Ngrok application</a>. From the command line, run Ngrok to create a localhost tunnel to the port our application will run on using the following command:</p>
<p>
			<span id="crayon-56d59b3e36e82452768640" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-e">ngrok </span><span class="crayon-i">http</span><span class="crayon-h"> </span><span class="crayon-cn">5000</span></span></span></p>
<p>We should see a screen like the following that shows Ngrok started properly. Take note of the second line that begins with “Forwarding”. That’s the URL we need to set for the BASE_URL environment variable as well as our Twilio webhook.</p>
<p><img alt="ngrok.png" src="https://www.twilio.com/blog/wp-content/uploads/2015/09/mTIRhWtuKz-k3J3mHIZ8zU2TUgEgm1nM_9RnWYBtp7WlXAxmaCfGxGj_vOMHBQ0rX9HwdGEDguZv9WSWn5XTes57DiQ63aVHbYpr_IgWqOlLiXGd3dpeqXQj5U21gWQ1Hc-fNUw1.png" title="" class="&quot; aligncenter"/></p>
<p>With Ngrok up and running, we can turn our attention to setting up a phone number for Trinity  to call into for customer service.</p>
<h3 class="c3 c4">
<a name="h.mn8utsnxo17d"/>Setup Step 5: Obtain a number for our customer service line<br/>
</h3>
<p>Where do we get the phone number to use as a customer service line for our warm phone call transfer example? That phone number comes from our Twilio account.</p>
<p>If you don’t already have a Twilio account, you can <a href="https://www.twilio.com/try-twilio">sign up for a free trial account</a>. After signing up, <a href="https://www.twilio.com/help/faq/billing-pricing/how-do-i-upgrade-to-a-paid-account">upgrade to a paid account</a> as we’ll need its ability to call multiple telephone numbers other than our own verified number.</p>
<p>Obtain a Twilio phone number with calling capabilities that we can configure for our warm call transfer example. Go to the <a href="https://www.twilio.com/user/account/phone-numbers/incoming">Twilio numbers page</a> which should look like the following screenshot:</p>
<p><img alt="numbers-screen.png" src="https://www.twilio.com/blog/wp-content/uploads/2015/09/0QmOIk8NNXNW6g6hsAcB2SZKJs4nbTd0hJgD4yFlN3lWQ_HaaiX51KHj4KKVRdM5d71DF0VeLnWfvbpX4bzubD_nVwC-YCfqM0-a81sO18l2Xy1c595wSXDFhfuCkuZY_Glmp7w1.png" title="" class="&quot; aligncenter"/></p>
<p>Click on the “Buy a Number” button and purchase a phone number with calling capabilities in the location of your choice. After obtaining the phone number, you’ll get to set up voice calling on the numbers configuration page:</p>
<p><img alt="webhook.png" src="https://www.twilio.com/blog/wp-content/uploads/2015/09/3oWAUcdAuK75e1N-vfKAjOcodYEeJyscBCKWEQvV2bshAN3EYxw_yvCGIzngt_M4MmWtPrrtxflTr2eutZGtkwNFaaKjDU8i5YQdyTXbaLJCDcm2ztyF5pwXOmMj3BR5OFr26MY1.png" title="" class="&quot; aligncenter"/></p>
<p>As shown above, within the phone number’s screen there is a voice webhook we need to configure. WIthin the Request URL text box, type in the Ngrok Forwarding URL, such as “<a href="https://5341e8cd.ngrok.io">https://5341e8cd.ngrok.io</a>” plus “/call” because that is the route we are going to write in the next section to respond to the webhook with appropriate TwiML. Make sure to scroll down and click the “Save” button at the bottom of the screen so our changes take effect.</p>
<p>With our Python development environment established, Ngrok started and a Twilio phone number in hand, we just need to use that information to set environment variables our application will need.
</p>
<h3 class="c3 c4">
<a name="h.lo7ibsru1zej"/>Setup Step 6: Set environment variables<br/>
</h3>
<p>How to set environment variables depends on your operating system. Here are some handy guides if you’re on <a href="http://www.computerhope.com/issues/ch000549.htm">Windows</a>, <a href="http://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x">Mac OS X</a> or <a href="https://help.ubuntu.com/community/EnvironmentVariables">Ubuntu Linux</a> that’ll help with the specific steps.</p>
<p>Note that if you don’t set these environment variables now there are spots within the application code to set them. However, in Python it’s a good practice to use environment variables instead of hardcoding these sensitive values.</p>
<p>There are six variables that need to be set:</p>
<ul>
<li>

			<span id="crayon-56d59b3e36e97254179175" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_ACCOUNT_SID</span></span></span> – found on your <a href="https://www.twilio.com/user/account">Twilio account dashboard</a>
</li>
<li>

			<span id="crayon-56d59b3e36ea8023967608" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_AUTH_TOKEN</span></span></span> – also found on your <a href="https://www.twilio.com/user/account">Twilio account dashboard</a>
</li>
<li>

			<span id="crayon-56d59b3e36eb9521015374" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span></span></span> – a number you’ve <a href="https://www.twilio.com/phone-numbers">purchased on Twilio</a>
</li>
<li>

			<span id="crayon-56d59b3e36eca260061839" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">AGENT1_NUMBER</span></span></span> – the phone number of the agent who will first answer the call. For testing purposes this is most likely your own phone number, specified in the +12025551234 format
</li>
<li>

			<span id="crayon-56d59b3e36edb264911964" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">AGENT2_NUMBER</span></span></span> – the phone number of the agent who will be transferred in, in the +12025551234 format
</li>
<li>

			<span id="crayon-56d59b3e36eed869039825" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">BASE_URL</span></span></span> – the forwarding URL given by Ngrok when it starts up, for example “https://5341e8cd.ngrok.io”
</li>
</ul>
<p>
On Mac OS X and Linux, you can set environment variables with the 
			<span id="crayon-56d59b3e36efd725632128" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">export</span></span></span> shell command. For example, you’d run 
			<span id="crayon-56d59b3e36f0b868571441" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">export</span></span></span> six times to set the following variables:
</p>
<p/>

		<div id="crayon-56d59b3e36f15549480327" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36f15549480327-1"><span class="crayon-e">export </span><span class="crayon-v">TWILIO_ACCOUNT_SID</span><span class="crayon-o">=</span><span class="crayon-s">"ACxxxxxxxxxxxxxxxxxxxxxx"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f15549480327-2"><span class="crayon-e">export </span><span class="crayon-v">TWILIO_AUTH_TOKEN</span><span class="crayon-o">=</span><span class="crayon-s">"yyyyyyyyyyyyyyyyyyyyyyyyyyy"</span></p><p class="crayon-line" id="crayon-56d59b3e36f15549480327-3"><span class="crayon-e">export </span><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span><span class="crayon-o">=</span><span class="crayon-s">"+12025551234"</span><span class="crayon-h"> </span><span class="crayon-c"># this will be a Twilio number</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f15549480327-4"><span class="crayon-e">export </span><span class="crayon-v">AGENT1_NUMBER</span><span class="crayon-o">=</span><span class="crayon-s">"+19735551234"</span><span class="crayon-h"> </span><span class="crayon-c"># your phone number</span></p><p class="crayon-line" id="crayon-56d59b3e36f15549480327-5"><span class="crayon-e">export </span><span class="crayon-v">AGENT2_NUMBER</span><span class="crayon-o">=</span><span class="crayon-s">"+14155551234"</span><span class="crayon-h"> </span><span class="crayon-c"># a second phone number for testing</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f15549480327-6"><span class="crayon-e">export </span><span class="crayon-v">BASE_URL</span><span class="crayon-o">=</span><span class="crayon-s">"https://5341e8cd.ngrok.io"</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>Now that our environment is ready to go, let’s write some code to handle inbound customer service phone calls.
</p>
<h2 class="c3 c4">
<a name="h.ldbtgajuf7mm"/>Calling Agent Smith<br/>
</h2>
<p>Our environment is established and we have a Twilio phone number, so it’s time to write some Python code to handle an incoming phone call. </p>
<p><img alt="write-code.gif" src="https://www.twilio.com/blog/wp-content/uploads/2015/09/MjackKlNUehzt1NASbe8cs_8bYNlQAaB1cdo4DpC6JPAifuzbEq7Mj1xr63UYIlwTIiuVVFcWkJCCj_Mfwe1ZM6U3v9SJR2boWOBVbYrt9FjIoZCd-ZgbG_8lTXo_luHIIau7sQ1.png" title="" class="&quot; aligncenter"/></p>
<p>We’ll start out by importing our Flask and Twilio dependencies that we installed earlier. We also need a bit of boilerplate to initialize the Flask application and the Twilio helper library. This code will run the application in Flask’s debug mode in case we run into any issues while building our application.</p>
<p/>

		<div id="crayon-56d59b3e36f20610038977" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36f20610038977-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f20610038977-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Flask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Response</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">request</span></p><p class="crayon-line" id="crayon-56d59b3e36f20610038977-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">twilio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">twiml</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f20610038977-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">rest </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span></p><p class="crayon-line" id="crayon-56d59b3e36f20610038977-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f20610038977-6"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e36f20610038977-7"><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f20610038977-8"> </p><p class="crayon-line" id="crayon-56d59b3e36f20610038977-9"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f20610038977-10"><span class="crayon-h">    </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
</p><p>
Next our application needs to obtain the environment variables we exported to our shell. The 
			<span id="crayon-56d59b3e36f2a656587598" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">os</span></span></span> module is used to get the environment variables for customer service number, the agent phone numbers and the base URL that Ngrok gives us when we fire it up.
</p>
<p/>

		<div id="crayon-56d59b3e36f35898836524" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59b3e36f35898836524-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-2">2</p><p class="crayon-num" data-line="crayon-56d59b3e36f35898836524-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-4">4</p><p class="crayon-num" data-line="crayon-56d59b3e36f35898836524-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-6">6</p><p class="crayon-num" data-line="crayon-56d59b3e36f35898836524-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-8">8</p><p class="crayon-num" data-line="crayon-56d59b3e36f35898836524-9">9</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-10">10</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59b3e36f35898836524-11">11</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-12">12</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59b3e36f35898836524-13">13</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-14">14</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59b3e36f35898836524-15">15</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-16">16</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d59b3e36f35898836524-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-18">18</p><p class="crayon-num" data-line="crayon-56d59b3e36f35898836524-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e36f35898836524-20">20</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36f35898836524-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Flask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Response</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">request</span></p><p class="crayon-line" id="crayon-56d59b3e36f35898836524-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">twilio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">twiml</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">rest </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span></p><p class="crayon-line" id="crayon-56d59b3e36f35898836524-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-6"> </p><p class="crayon-line" id="crayon-56d59b3e36f35898836524-7"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-8"><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e36f35898836524-9"> </p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d59b3e36f35898836524-10"><span class="crayon-c"># this should be your Twilio number, format: +14155551234</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59b3e36f35898836524-11"><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'CUSTOMER_SERVICE_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-12"><span class="crayon-c"># your cell phone number (agent's number), format: +14155551234</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59b3e36f35898836524-13"><span class="crayon-v">AGENT1_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'AGENT1_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-14"><span class="crayon-c"># second person's phone or Twilio number if testing, format: +14155551234</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59b3e36f35898836524-15"><span class="crayon-v">AGENT2_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'AGENT2_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-16"><span class="crayon-c"># ngrok URL, such as "https://17224f9e.ngrok.io", no trailing slash</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d59b3e36f35898836524-17"><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'BASE_URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'https://143e6ab2.ngrok.io'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-18"> </p><p class="crayon-line" id="crayon-56d59b3e36f35898836524-19"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f35898836524-20"><span class="crayon-h">    </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>
We could run our Flask web application at this point but without any routes it doesn’t have any pages to load. Create a couple routes now, named 
			<span id="crayon-56d59b3e36f45224251170" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">inbound_call</span></span></span> and 
			<span id="crayon-56d59b3e36f54536619675" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">conference_line</span></span></span>, as shown below.
</p>
<p/>

		<div id="crayon-56d59b3e36f5e570151458" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-1"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/call'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">inbound_call</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-3"><span class="crayon-h">    </span><span class="crayon-v">call_sid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">[</span><span class="crayon-s">'CallSid'</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-4"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-5"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">dial</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">conference</span><span class="crayon-sy">(</span><span class="crayon-v">call_sid</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-6"><span class="crayon-h">    </span><span class="crayon-v">call</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">calls</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-v">to</span><span class="crayon-o">=</span><span class="crayon-v">AGENT1_NUMBER</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-7"><span class="crayon-h">                               </span><span class="crayon-v">from_</span><span class="crayon-o">=</span><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-8"><span class="crayon-h">                               </span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/conference/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">call_sid</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-9"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mimetype</span><span class="crayon-o">=</span><span class="crayon-s">"application/xml"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-10"> </p><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-12"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/conference/&lt;conference_name&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-13"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">conference_line</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-14"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e36f5e570151458-15"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">dial</span><span class="crayon-sy">(</span><span class="crayon-v">hangupOnStar</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">conference</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36f5e570151458-16"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mimetype</span><span class="crayon-o">=</span><span class="crayon-s">"application/xml"</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>
The above code in 
			<span id="crayon-56d59b3e36f6f536935307" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">inbound_call</span></span></span> handles an inbound call by generating and returning a TwiML response when Twilio performs an HTTP POST request to our application. We also use our instantiated 
			<span id="crayon-56d59b3e36f80943462745" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TwilioRestClient</span></span></span> to dial an outbound phone call to Agent Smith, our first agent who will take the customer’s call.</p>
<p>The second function, 
			<span id="crayon-56d59b3e36f8e628334953" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">conference_line</span></span></span>, creates a TwiML response that looks like the following XML. We don’t need to hand code the TwiML because the Python helper library generates this when we call the 
			<span id="crayon-56d59b3e36f9b043110404" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">Response</span></span></span>, 
			<span id="crayon-56d59b3e36fa8424685100" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">dial</span></span></span> and 
			<span id="crayon-56d59b3e36fb7197495540" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">conference</span></span></span> functions.
</p>
<p/>

		<div id="crayon-56d59b3e36fc6376381264" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36fc6376381264-1"><span class="crayon-ta">&lt;?</span><span class="crayon-e">xml </span><span class="crayon-i">version</span><span class="crayon-o">=</span><span class="crayon-s">"1.0"</span><span class="crayon-h"> </span><span class="crayon-i">encoding</span><span class="crayon-o">=</span><span class="crayon-s">"UTF-8"</span><span class="crayon-ta">?&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36fc6376381264-2"><span class="crayon-o">&lt;</span><span class="crayon-v">Response</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d59b3e36fc6376381264-3"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">Dial </span><span class="crayon-v">hangupOnStar</span><span class="crayon-o">=</span><span class="crayon-s">"true"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36fc6376381264-4"><span class="crayon-h">    </span><span class="crayon-o">&lt;</span><span class="crayon-v">Conference</span><span class="crayon-o">&gt;</span><span class="crayon-v">callSid</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">Conference</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d59b3e36fc6376381264-5"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">Dial</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36fc6376381264-6"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">Response</span><span class="crayon-o">&gt;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>
Our application is now a simple conference call application. Let’s give the initial version of our warm call transfer application a spin to make sure everything works so far. Run the Flask app from the command line with the following command.
</p>
<p>
			<span id="crayon-56d59b3e36fd2273579089" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">python </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span></p>
<p>
With the application running and exposed to Twilio using Ngrok, we can test the application by calling the customer service Twilio number.</p>
<p>Now we’re connected to our initial customer service agent. However, let’s assume the agent can’t answer the question and needs to connect the caller to another person who knows what they’re talking about.
</p>
<h2 class="c3 c4">
<a name="h.95b5q1giw5k"/>Bringing in Agent Johnson<br/>
</h2>
<p>We need to slightly modify our application to allow for the warm transfer. The 
			<span id="crayon-56d59b3e36fe2120448564" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">gather</span></span></span> function in our response will generate a <a href="https://www.twilio.com/docs/api/twiml">TwiML</a> response for us that instructs Twilio how to handle the phone call.
</p>
<p/>

		<div id="crayon-56d59b3e36ff3646119552" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e36ff3646119552-1"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/conference/&lt;conference_name&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36ff3646119552-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">conference_line</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59b3e36ff3646119552-3"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36ff3646119552-4"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">dial</span><span class="crayon-sy">(</span><span class="crayon-v">hangupOnStar</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">conference</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d59b3e36ff3646119552-5"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">gather</span><span class="crayon-sy">(</span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/add-agent/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">conference_name</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-56d59b3e36ff3646119552-6"><span class="crayon-h">                    </span><span class="crayon-v">numDigits</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e36ff3646119552-7"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mimetype</span><span class="crayon-o">=</span><span class="crayon-s">"application/xml"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e36ff3646119552-8"> </p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d59b3e36ff3646119552-9"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/add-agent/&lt;conference_name&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59b3e36ff3646119552-10"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_second_agent</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59b3e36ff3646119552-11"><span class="crayon-h">    </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">calls</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-v">to</span><span class="crayon-o">=</span><span class="crayon-v">AGENT2_NUMBER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">from_</span><span class="crayon-o">=</span><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59b3e36ff3646119552-12"><span class="crayon-h">                        </span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/conference/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59b3e36ff3646119552-13"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59b3e36ff3646119552-14"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">dial</span><span class="crayon-sy">(</span><span class="crayon-v">hangupOnStar</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">conference</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d59b3e36ff3646119552-15"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mimetype</span><span class="crayon-o">=</span><span class="crayon-s">"application/xml"</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>
In the modified 
			<span id="crayon-56d59b3e37003786380626" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">inbound_call</span></span></span> route we create TwiML for a conference line and then dial our first agent into the conference call. A conference is actually the easiest way to handle adding and removing people from a call. Our customer calling in doesn’t even need to know it’s a conference call, it’s seamless to her as Agent Smith and Agent Johnson add and remove themselves from the line.</p>
<p>The 
			<span id="crayon-56d59b3e3700d556557369" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">conference_line</span></span></span> route creates the TwiML to put Agent Smith in the conference call. The 
			<span id="crayon-56d59b3e37017045623985" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">hangupOnStar</span><span class="crayon-o">=</span><span class="crayon-t">True</span></span></span> parameter allows Agent Smith to put the call on hold by pressing the 
			<span id="crayon-56d59b3e37021591108815" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-o">*</span></span></span> key on the dial pad. Then Agent Smith gets back into the call by pressing any number key on the dial pad, which causes the 
			<span id="crayon-56d59b3e3702c534144049" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">gather</span></span></span> TwiML to add the agent back to the conference with our customer.</p>
<p>We’re ready to test out our application one more time to see it all put together. Here is a review of the entire 
			<span id="crayon-56d59b3e3703c336503027" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file we wrote together throughout this post.</p>
<p/>

		<div id="crayon-56d59b3e37048097374545" class="crayon-syntax crayon-theme-solarized-dark crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-2">2</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-4">4</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-6">6</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-8">8</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-10">10</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-12">12</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-14">14</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-16">16</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-18">18</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-20">20</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-22">22</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-24">24</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-26">26</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-28">28</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-30">30</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-32">32</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-34">34</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-36">36</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-38">38</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-40">40</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-42">42</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-44">44</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-46">46</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-48">48</p><p class="crayon-num" data-line="crayon-56d59b3e37048097374545-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59b3e37048097374545-50">50</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59b3e37048097374545-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Flask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Response</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">request</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">twilio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">twiml</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">rest </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-6"> </p><p class="crayon-line" id="crayon-56d59b3e37048097374545-7"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-8"><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-10"><span class="crayon-c"># this should be your Twilio number, format: +14155551234</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-11"><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'CUSTOMER_SERVICE_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-12"><span class="crayon-c"># your cell phone number (agent's number), format: +14155551234</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-13"><span class="crayon-v">AGENT1_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'AGENT1_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-14"><span class="crayon-c"># second person's phone or Twilio number if testing, format: +14155551234</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-15"><span class="crayon-v">AGENT2_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'AGENT2_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-16"><span class="crayon-c"># ngrok URL, such as "https://17224f9e.ngrok.io", no trailing slash</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-17"><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'BASE_URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'https://143e6ab2.ngrok.io'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-18"> </p><p class="crayon-line" id="crayon-56d59b3e37048097374545-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-20"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/call'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-21"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">inbound_call</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-22"><span class="crayon-h">    </span><span class="crayon-v">call_sid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">[</span><span class="crayon-s">'CallSid'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-23"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-24"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">dial</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">conference</span><span class="crayon-sy">(</span><span class="crayon-v">call_sid</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-25"><span class="crayon-h">    </span><span class="crayon-v">call</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">calls</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-v">to</span><span class="crayon-o">=</span><span class="crayon-v">AGENT1_NUMBER</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-26"><span class="crayon-h">                               </span><span class="crayon-v">from_</span><span class="crayon-o">=</span><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-27"><span class="crayon-h">                               </span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/conference/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">call_sid</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-28"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mimetype</span><span class="crayon-o">=</span><span class="crayon-s">"application/xml"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-29"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-30"> </p><p class="crayon-line" id="crayon-56d59b3e37048097374545-31"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/conference/&lt;conference_name&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-32"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">conference_line</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-33"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-34"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">dial</span><span class="crayon-sy">(</span><span class="crayon-v">hangupOnStar</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">conference</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-35"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">gather</span><span class="crayon-sy">(</span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/add-agent/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">conference_name</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-36"><span class="crayon-h">                    </span><span class="crayon-v">numDigits</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-37"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mimetype</span><span class="crayon-o">=</span><span class="crayon-s">"application/xml"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-38"> </p><p class="crayon-line" id="crayon-56d59b3e37048097374545-39"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-40"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/add-agent/&lt;conference_name&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-41"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_second_agent</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-42"><span class="crayon-h">    </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">calls</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-v">to</span><span class="crayon-o">=</span><span class="crayon-v">AGENT2_NUMBER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">from_</span><span class="crayon-o">=</span><span class="crayon-v">CUSTOMER_SERVICE_NUMBER</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-43"><span class="crayon-h">                        </span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-v">BASE_URL</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/conference/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-44"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-45"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">dial</span><span class="crayon-sy">(</span><span class="crayon-v">hangupOnStar</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">conference</span><span class="crayon-sy">(</span><span class="crayon-v">conference_name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-46"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mimetype</span><span class="crayon-o">=</span><span class="crayon-s">"application/xml"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59b3e37048097374545-47"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-48"> </p><p class="crayon-line" id="crayon-56d59b3e37048097374545-49"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59b3e37048097374545-50"><span class="crayon-h">    </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>With the above code written and running, call into our customer service phone number and the app will use the Twilio Voice API to call Agent Smith. When Agent Smith picks up, press 
			<span id="crayon-56d59b3e37054562039332" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-o">*</span></span></span> plus a number on the keypad to “hang up” which hits the 
			<span id="crayon-56d59b3e37061444568411" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-o">/</span><span class="crayon-v">add</span><span class="crayon-o">-</span><span class="crayon-v">agent</span></span></span> route and calls out to Agent Johnson.</p>
<p>Agent Smith will be placed back into the call. Agent Smith then transfers to Agent Johnson, they’re both on the line, then Agent Smith drops off while Agent Johnson continues on with Trinity.
</p>
<h2 class="c3 c4">
<a name="h.1r1rzmeqbsp8"/>Warm Transfer Complete<br/>
</h2>
<p>Now that’s how a warm call transfer should be done!</p>
<p>In this post, we solved the problem of poorly handled call transfers. Now when your customers call in, Agent Smith will be ready to hand off to Agent Johnson when the need arises.</p>
<p><img alt="matrix-3.gif" src="https://www.twilio.com/blog/wp-content/uploads/2015/09/vDOSbk6VlNOVGf_yi1XZGfIUFkt2G_MOv_0hx25nx76BnZXM1cbDTBs-ZB8TQv-ohA9Y7VKA1gwsyTBC0RcCqlwPRYXLr773mRCbdQ8ncIQIpEYVwFbUg8wcxeOfHdCrvKC4cJo1.png" title="" class="&quot; aligncenter"/></p>
<p>If you’re looking for more tutorials and Python code to do additional voice communications to your application, check out one of my favorite tutorials named <a href="https://www.twilio.com/docs/howto/walkthrough/click-to-call/python/flask">Click to Call</a> that uses Python and Flask to allow visitors on the web to easily call your support or sales lines on the phone.</p>
<p>That’s all for now! If you run into any issues throughout the tutorial feel free to drop a comment below or contact me via:</p>
<ul>
<li>Email: makai@twilio.com</li>
<li>
GitHub: Follow <a href="https://github.com/makaimc">makaimc</a> for repository updates
</li>
<li>
Twitter: <a href="https://twitter.com/mattmakai">@mattmakai</a>
</li>
</ul>
			</div>
					</div></body></html>