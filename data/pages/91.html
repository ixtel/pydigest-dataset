<html><body><div><p>When used for models’ FileFields, django-db-file-storage uses a specific model to hold each FileField.</p>
<div id="models">
<h3>Models</h3>
<p>For each FileField you want to save, you will need a separated model to hold the file in the database. I will refer to this extra model as the <strong>FileModel</strong>. The FileModel must have at least these fields:</p>
<ul>
<li>a <tt>TextField()</tt> which will hold the encoded contents of the file</li>
<li>a <tt>CharField(max_length=255)</tt> which will hold the file’s name</li>
<li>a <tt>CharField(max_length=50)</tt> which will hold the file’s MIME type</li>
</ul>
<p>For example (in a models.py file, inside an app called ‘console’):</p>
<pre>from django.db import models

class ConsolePicture(models.Model):
    bytes = models.TextField()
    filename = models.CharField(max_length=255)
    mimetype = models.CharField(max_length=50)
</pre>
<p>And the class which will have the FileField:</p>
<pre>class Console(models.Model):
    name = models.CharField(max_length=100)
    picture = models.ImageField(upload_to='console.ConsolePicture/bytes/filename/mimetype', blank=True, null=True)
</pre>
<p>In this example, the FileField is actually an ImageField. Its <tt>upload_to</tt> argument must be a string in the following format:</p>
<ol>
<li>the FileModel’s app’s name</li>
<li>a dot (.)</li>
<li>the FileModel’s name</li>
<li>a forward slash (/)</li>
<li>the name of the FileModel’s field which will hold the encoded contents of the files</li>
<li>a forward slash</li>
<li>the name of the FileModel’s field which will hold the name of the files</li>
<li>a forward slash</li>
<li>the name of the FileModel’s field which will hold the MIME type of the files</li>
</ol>
<p>Let’s check it again:</p>
<pre>#   1   2       3      4  5  6    7   8    9
'console.ConsolePicture/bytes/filename/mimetype'
</pre>
<p>Don’t forget to create the necessary tables in your database, if you haven’t yet.</p>
<p>If you want stale files to be deleted when editing and deleting instances, override the <tt>save</tt> and <tt>delete</tt> methods of your model, calling <tt>db_file_storage.model_utils.delete_file_if_needed</tt> and <tt>db_file_storage.model_utils.delete_file</tt> inside them, respectively:</p>
<pre>from db_file_storage.model_utils import delete_file, delete_file_if_needed
from django.db import models

class Console(models.Model):
    name = models.CharField(max_length=100, unique=True)
    picture = models.ImageField(upload_to='console.ConsolePicture/bytes/filename/mimetype', blank=True, null=True)

    def save(self, *args, **kwargs):
        delete_file_if_needed(self, 'picture')
        super(Console, self).save(*args, **kwargs)

    def delete(self, *args, **kwargs):
        super(Console, self).delete(*args, **kwargs)
        delete_file(self, 'picture')
</pre>
<p>Pay extra attention here to when the methods should be called. <tt>delete_file_if_needed</tt> should be called <strong>before</strong> the <tt>save</tt> method of the super class, and <tt>delete_file</tt> should be called <strong>after</strong> the <tt>delete</tt> method of the super class.</p>
</div>
<div id="downloading-and-viewing-the-files">
<h3>Downloading (and viewing) the files</h3>
<p>Django DB File Storage comes with views that you can use to download the files or to just view them (for images, for example). They are accessed through the <a href="https://docs.djangoproject.com/en/dev/topics/http/urls/#naming-url-patterns" rel="nofollow">named url patterns</a> <strong>db_file_storage.download_file</strong> and <strong>db_file_storage.get_file</strong>.</p>
<p>Both views must be passed a GET parameter named <tt>name</tt>, and the value of this parameter must be the value of the filefield of the instance. The template-snippet example below must make it clearer; <tt>console</tt> is an instance of the <tt>Console</tt> model defined above:</p>
<pre>&lt;!-- The url used to VIEW the file: --&gt;
&lt;img src="{% url 'db_file_storage.get_file' %}?name={{ console.picture }}" /&gt;

&lt;br/&gt;

&lt;!-- The url used to DOWNLOAD the file: --&gt;
&lt;a href='{% url "db_file_storage.download_file" %}?name={{ console.picture }}'&gt;
    &lt;i&gt;Click here to download the picture&lt;/i&gt;
&lt;/a&gt;
</pre>
</div>
</div></body></html>