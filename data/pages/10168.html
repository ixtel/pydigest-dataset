<html><body><div><ul>
<li><p>Supervisorctl now reports a better error message when the main supervisor
XML-RPC namespace is not registered.  Thanks to Mike Orr for reporting
this. (Mike Naberezny)</p>
</li>
<li><p>Create <tt><span>scripts</span></tt> directory within supervisor package, move
<tt><span>pidproxy.py</span></tt> there, and place sample event listener and comm event
programs within the directory.</p>
</li>
<li><p>When an event notification is buffered (either because a listener rejected
it or because all listeners were busy when we attempted to send it
originally), we now rebuffer it in a way that will result in it being
retried earlier than it used to be.</p>
</li>
<li><p>When a listener process exits (unexpectedly) before transitioning from the
BUSY state, rebuffer the event that was being processed.</p>
</li>
<li><p>supervisorctl <tt><span>tail</span></tt> command now accepts a trailing specifier: <tt><span>stderr</span></tt>
or <tt><span>stdout</span></tt>, which respectively, allow a user to tail the stderr or
stdout of the named process.  When this specifier is not provided, tail
defaults to stdout.</p>
</li>
<li><p>supervisor <tt><span>clear</span></tt> command now clears both stderr and stdout logs for the
given process.</p>
</li>
<li><p>When a process encounters a spawn error as a result of a failed execve or
when it cannot setuid to a given uid, it now puts this info into the
process’ stderr log rather than its stdout log.</p>
</li>
<li><p>The event listener protocol header now contains the <tt><span>server</span></tt> identifier,
the <tt><span>pool</span></tt> that the event emanated from, and the <tt><span>poolserial</span></tt> as well
as the values it previously contained (version, event name, serial, and
length).  The server identifier is taken from the config file options value
<tt><span>identifier</span></tt>, the <tt><span>pool</span></tt> value is the name of the listener pool that
this event emanates from, and the <tt><span>poolserial</span></tt> is a serial number
assigned to the event local to the pool that is processing it.</p>
</li>
<li><p>The event listener protocol header is now a sequence of key-value
pairs rather than a list of positional values.  Previously, a
representative header looked like:</p>
<div><div><pre>SUPERVISOR3.0 PROCESS_COMMUNICATION_STDOUT 30 22\n
</pre></div>
</div>
<p>Now it looks like:</p>
<div><div><pre>ver:3.0 server:supervisor serial:21 ...
</pre></div>
</div>
</li>
<li><p>Specific event payload serializations have changed.  All event
types that deal with processes now include the pid of the process
that the event is describing.  In event serialization “header”
values, we’ve <span class="changelog-highlight-inc">removed</span> the space between the header name and the
value and headers are now separated by a space instead of a line
feed.  The names of keys in all event types have had underscores
<span class="changelog-highlight-inc">removed</span>.</p>
</li>
<li><p>Abandon the use of the Python stdlib <tt><span>logging</span></tt> module for speed
and cleanliness purposes.  We’ve rolled our own.</p>
</li>
<li><p><span class="changelog-highlight-fix">Fix</span> crash on start if AUTO logging is used with a max_bytes of
zero for a process.</p>
</li>
<li><p>Improve process communication event performance.</p>
</li>
<li><p>The process config parameters <tt><span>stdout_capturefile</span></tt> and
<tt><span>stderr_capturefile</span></tt> are no longer valid.  They have been replaced with
the <tt><span>stdout_capture_maxbytes</span></tt> and <tt><span>stderr_capture_maxbytes</span></tt> parameters,
which are meant to be suffix-multiplied integers.  They both default to
zero.  When they are zero, process communication event capturing is not
performed.  When either is nonzero, the value represents the maximum number
of bytes that will be captured between process event start and end tags.
This change was to support the fact that we no longer keep capture data in
a separate file, we just use a FIFO in RAM to maintain capture info.  For
users whom don’t care about process communication events, or whom haven’t
changed the defaults for <tt><span>stdout_capturefile</span></tt> or <tt><span>stderr_capturefile</span></tt>,
they needn’t do anything to their configurations to deal with this change.</p>
</li>
<li><p>Log message levels have been normalized.  In particular, process
stdin/stdout is now logged at <tt><span>debug</span></tt> level rather than at <tt><span>trace</span></tt>
level (<tt><span>trace</span></tt> level is now reserved for output useful typically for
debugging supervisor itself).  See “Supervisor Log Levels” in the
documentation for more info.</p>
</li>
<li><p>When an event is rebuffered (because all listeners are busy or a
listener rejected the event), the rebuffered event is now inserted
in the head of the listener event queue.  This doesn’t guarantee
event emission in natural ordering, because if a listener rejects
an event or dies while it’s processing an event, it can take an
arbitrary amount of time for the event to be rebuffered, and other
events may be processed in the meantime.  But if pool listeners
never reject an event or don’t die while processing an event, this
guarantees that events will be emitted in the order that they were
received because if all listeners are busy, the rebuffered event
will be tried again “first” on the next go-around.</p>
</li>
<li><p><span class="changelog-highlight-inc">Removed</span> EVENT_BUFFER_OVERFLOW event type.</p>
</li>
<li><p>The supervisorctl xmlrpc proxy can now communicate with
supervisord using a persistent HTTP connection.</p>
</li>
<li><p>A new module “supervisor.childutils” was added.  This module
provides utilities for Python scripts which act as children of
supervisord.  Most notably, it contains an API method
“getRPCInterface” allows you to obtain an xmlrpxlib ServerProxy
that is willing to communicate with the parent supervisor.  It
also contains utility functions that allow for parsing of
supervisor event listener protocol headers.  A pair of scripts
(loop_eventgen.py and loop_listener.py) were added to the script
directory that serve as examples about how to use the childutils
module.</p>
</li>
<li><p>A new envvar is added to child process environments:
SUPERVISOR_SERVER_URL.  This contains the server URL for the
supervisord running the child.</p>
</li>
<li><p>An <tt><span>OK</span></tt> URL was added at <tt><span>/ok.html</span></tt> which just returns the string
<tt><span>OK</span></tt> (can be used for up checks or speed checks via plain-old-HTTP).</p>
</li>
<li><p>An additional command-line option <tt><span>--profile_options</span></tt> is accepted
by the supervisord script for developer use:</p>
<div><div><pre>supervisord -n -c sample.conf --profile_options=cumulative,calls
</pre></div>
</div>
<p>The values are sort_stats options that can be passed to the
standard Python profiler’s PStats sort_stats method.</p>
<p>When you exit supervisor, it will print Python profiling output to
stdout.</p>
</li>
<li><p>If cElementTree is installed in the Python used to invoke
supervisor, an alternate (faster, by about 2X) XML parser will be
used to parse XML-RPC request bodies.  cElementTree was added as
an “extras_require” option in setup.py.</p>
</li>
<li><p>Added the ability to start, stop, and restart process groups to
supervisorctl.  To start a group, use <tt><span>start</span> <span>groupname:*</span></tt>.  To start
multiple groups, use <tt><span>start</span> <span>groupname1:*</span> <span>groupname2:*</span></tt>.  Equivalent
commands work for “stop” and “restart”. You can mix and match short
processnames, fullly-specified group:process names, and groupsplats on the
same line for any of these commands.</p>
</li>
<li><p>Added <tt><span>directory</span></tt> option to process config.  If you set this
option, supervisor will chdir to this directory before executing
the child program (and thus it will be the child’s cwd).</p>
</li>
<li><p>Added <tt><span>umask</span></tt> option to process config.  If you set this option,
supervisor will set the umask of the child program.  (Thanks to
Ian Bicking for the suggestion).</p>
</li>
<li><p>A pair of scripts <tt><span>osx_memmon_eventgen.py</span></tt> and <cite>osx_memmon_listener.py`</cite>
have been added to the scripts directory.  If they are used together as
described in their comments, processes which are consuming “too much”
memory will be restarted.  The <tt><span>eventgen</span></tt> script only works on OSX (my
main development platform) but it should be trivially generalizable to
other operating systems.</p>
</li>
<li><p>The long form <tt><span>--configuration</span></tt> (-c) command line option for
supervisord was broken.  Reported by Mike Orr.  (Mike Naberezny)</p>
</li>
<li><p>New log level: BLAT (blather).  We log all
supervisor-internal-related debugging info here.  Thanks to Mike
Orr for the suggestion.</p>
</li>
<li><p>We now allow supervisor to listen on both a UNIX domain socket and an inet
socket instead of making them mutually exclusive.  As a result, the options
“http_port”, “http_username”, “http_password”, “sockchmod” and “sockchown”
are no longer part of the <tt><span>[supervisord]</span></tt> section configuration. These
have been supplanted by two other sections: <tt><span>[unix_http_server]</span></tt> and
<tt><span>[inet_http_server]</span></tt>.  You’ll need to insert one or the other (depending
on whether you want to listen on a UNIX domain socket or a TCP socket
respectively) or both into your supervisord.conf file.  These sections have
their own options (where applicable) for port, username, password, chmod,
and chown.  See README.txt for more information about these sections.</p>
</li>
<li><p>All supervisord command-line options related to “http_port”,
“http_username”, “http_password”, “sockchmod” and “sockchown” have
been <span class="changelog-highlight-inc">removed</span> (see above point for rationale).</p>
</li>
<li><p>The option that <em>used</em> to be <tt><span>sockchown</span></tt> within the <tt><span>[supervisord]</span></tt>
section (and is now named <tt><span>chown</span></tt> within the <tt><span>[unix_http_server]</span></tt>
section) used to accept a dot-separated user.group value.  The separator
now must be a colon ”:”, e.g. “user:group”.  Unices allow for dots in
usernames, so this change is a <span class="changelog-highlight-fix">bugfix</span>.  Thanks to Ian Bicking for the <span class="changelog-highlight-fix">bug</span>
report.</p>
</li>
<li><p>If a ‘-c’ option is not specified on the command line, both supervisord and
supervisorctl will search for one in the paths <tt><span>./supervisord.conf</span></tt> ,
<tt><span>./etc/supervisord.conf</span></tt> (relative to the current working dir when
supervisord or supervisorctl is invoked) or in <tt><span>/etc/supervisord.conf</span></tt>
(the old default path).  These paths are searched in order, and supervisord
and supervisorctl will use the first one found.  If none are found,
supervisor will fail to start.</p>
</li>
<li><p>The Python string expression <tt><span>%(here)s</span></tt> (referring to the directory in
which the the configuration file was found) can be used within the
following sections/options within the config file:</p>
<div><div><pre>unix_http_server:file
supervisor:directory
supervisor:logfile
supervisor:pidfile
supervisor:childlogdir
supervisor:environment
program:environment
program:stdout_logfile
program:stderr_logfile
program:process_name
program:command
</pre></div>
</div>
</li>
<li><p>The <tt><span>--environment</span></tt> aka <tt><span>-b</span></tt> option was <span class="changelog-highlight-inc">removed</span> from the list of
available command-line switches to supervisord (use “A=1 B=2
bin/supervisord” instead).</p>
</li>
<li><p>If the socket filename (the tail-end of the unix:// URL) was
longer than 64 characters, supervisorctl would fail with an
encoding error at startup.</p>
</li>
<li><p>The <tt><span>identifier</span></tt> command-line argument was not functional.</p>
</li>
<li><p><span class="changelog-highlight-fix">Fixed</span> <a href="http://www.plope.com/software/collector/215">http://www.plope.com/software/collector/215</a> (bad error
message in supervisorctl when program command not found on PATH).</p>
</li>
<li><p>Some child processes may not have been shut down properly at
supervisor shutdown time.</p>
</li>
<li><p>Move to ZPL-derived (but not ZPL) license available from
<a href="http://www.repoze.org/LICENSE.txt">http://www.repoze.org/LICENSE.txt</a>; it’s slightly less restrictive
than the ZPL (no servicemark clause).</p>
</li>
<li><p>Spurious errors related to unclosed files (“bad file descriptor”,
typically) were evident at supervisord “reload” time (when using
the “reload” command from supervisorctl).</p>
</li>
<li><p>We no longer bundle ez_setup to bootstrap setuptools installation.</p>
</li>
</ul>
    </div></body></html>