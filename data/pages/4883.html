<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-propel" class="anchor" href="#propel" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Propel</h1>

<h3><a id="user-content-about" class="anchor" href="#about" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>About</h3>

<p>Propel allows you to deploy multiple Python/PHP/HTML apps (sites) 
on a single server, run scripts and background workers.</p>

<h4><a id="user-content---why-did-i-create-propel-" class="anchor" href="#--why-did-i-create-propel-" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>- Why did I create Propel ?</h4>

<p>The main reason, was to deploy multiple Flask apps on a single DigitalOcean VM
 effortlessly. The other reason, was to make it easy to deploy applications. </p>

<hr/>

<h2><a id="user-content-tldr-install-and-run-propel-simple-flask-example" class="anchor" href="#tldr-install-and-run-propel-simple-flask-example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>TLDR; Install and run Propel (simple Flask example)</h2>

<ol>
<li><p>On the server you intend to run your applications, install Propel 
by running the following commands:</p>

<pre><code> pip install propel

 propel-setup
</code></pre></li>
<li><p>CD in the directory that contains your app, and create the following files:</p>

<p>-app.py </p>

<pre><code>from flask import Flask

app = Flask(__name__)

@app.route("/")
def index():
    return "Hello Propel!"
</code></pre>

<p>-requirements.txt</p>

<pre><code>Flask
</code></pre>

<p>-propel.yml</p>

<pre><code>virtualenv:
  name: "mysitename.com"

web:
  -
    name: "mysitename.com"
    application: "app:app"
</code></pre></li>
<li><p>Inside of your app directory run:</p>

<pre><code>propel -w
</code></pre></li>
<li><p>Now go to <code>http://mysitename.com</code></p></li>
<li><p>Profit! (or your money back)</p></li>
</ol>

<hr/>

<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Features</h3>

<h4><a id="user-content-deploy-python" class="anchor" href="#deploy-python" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Deploy Python</h4>

<p>Propel allows you deploy multiple Python sites/applications (Flask, Django)
by isolating each app into its own virtualenv, using Virtualenvwrapper, then 
puts it online using Gunicon+Gevent under Supervisor, to make sure it's always up. 
Then uses NGinx as proxy to access the sites.</p>

<h4><a id="user-content---deploy-phphtml" class="anchor" href="#--deploy-phphtml" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>- Deploy PHP/HTML</h4>

<p>Propel is not limited to only Python app, it can deploy PHP/HTML sites too 
using PHP-FPM.</p>

<h4><a id="user-content---script-and-workers" class="anchor" href="#--script-and-workers" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>- Script and Workers</h4>

<p>Besides deploying sites/apps. Propel can run scripts before and after deployment.
Run other scripts individually. And background running scripts (workers) with Supervisor. </p>

<h4><a id="user-content---maintenance-mode" class="anchor" href="#--maintenance-mode" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>- Maintenance mode</h4>

<p>Propel also has a maintenance mode that will display a maintenance page when the 
website is down for maintenance or is being deployed.</p>

<h4><a id="user-content---packages" class="anchor" href="#--packages" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>- Packages</h4>

<p>Propel makes use of the following packages:</p>

<pre><code>- Gunicorn

- Supervisor

- Gevent

- Virtualenvwrapper

- PyYaml

- Jinja2
</code></pre>

<p>(They will be installed automatically, so no need to do it manually)</p>

<p>Requirements:</p>

<pre><code>- Nginx

- php-fpm

- git (not really required, but good to have)
</code></pre>

<hr/>

<h2><a id="user-content-install--setup" class="anchor" href="#install--setup" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Install &amp; Setup</h2>

<pre><code>pip install propel
</code></pre>

<p>After installing <em>propel</em> for the first time, run the following command to setup 
Supervisor conf and logs directories compatible to propel.</p>

<pre><code>propel-setup
</code></pre>

<p>** You may need root admin</p>

<p>You may also need to install some other packages based on your system.</p>

<p>Once done, you should be good to go.</p>

<hr/>

<h2><a id="user-content-how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to use</h2>

<p><strong>Propel</strong> works in the current working directory (CWD). You must have the file
<code>propel.yml</code> in order for it to execute properly.</p>

<p>So you must <code>cd</code> into the directory that contains your <code>propel.yml</code></p>

<p>Let's say my application is at: <code>/home/myapp.com/www</code></p>

<pre><code>cd /home/myapp.com/www
</code></pre>

<p>From there you can run the commands below:</p>

<h4><a id="user-content-propel--w----websites" class="anchor" href="#propel--w----websites" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel -w | --websites</h4>

<p>To deploy websites. It will also run scripts.before_web and scripts.after_web</p>

<pre><code>propel -w
</code></pre>

<h3><a id="user-content-propel--s----scripts-name-names-" class="anchor" href="#propel--s----scripts-name-names-" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel -s | --scripts [name, [names ...]]</h3>

<p>To run a custom script</p>

<pre><code>propel --scripts my_script_name
</code></pre>

<p>Run multiple scripts</p>

<pre><code>propel --scripts my_script_name another_script a_third_script
</code></pre>

<h4><a id="user-content-propel--k----workers-name-names-" class="anchor" href="#propel--k----workers-name-names-" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel -k | --workers [name, [names ...]]</h4>

<p>To run workers in the background using Supervisor</p>

<pre><code>propel --workers worker_name another_name
</code></pre>

<h3><a id="user-content-propel--x----undeploy" class="anchor" href="#propel--x----undeploy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel -x | --undeploy</h3>

<p>To undeploy all. It will remove sites, scripts, workers, and destroy the virtualenv</p>

<pre><code>propel --undeploy
</code></pre>

<h3><a id="user-content-propel--m----maintenance-onoff" class="anchor" href="#propel--m----maintenance-onoff" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel -m | --maintenance on|off</h3>

<p>To activate/deactivate the site maintenance page</p>

<pre><code>propel --maintenance on

propel --maintenance off
</code></pre>

<h3><a id="user-content-propel--c----create-name" class="anchor" href="#propel--c----create-name" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel -c | --create [name]</h3>

<p>To create a new application bare repository ready to push application to. </p>

<pre><code>propel -c mynewapp

# or

# It will place the repository inside of /myother-dir
propel -c mynewapp --basedir=/myother-dir 
</code></pre>

<h3><a id="user-content-propel--r----reload" class="anchor" href="#propel--r----reload" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel -r | --reload</h3>

<p>To reload Nginx servers and refresh Supervisors config</p>

<pre><code>propel --reload
</code></pre>

<h3><a id="user-content-propel---ps" class="anchor" href="#propel---ps" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel --ps</h3>

<p>To list all the running applications. Running applications are active apps on Supervisor.</p>

<pre><code>propel -ps
</code></pre>

<h3><a id="user-content-propel---restart" class="anchor" href="#propel---restart" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel --restart</h3>

<p>To completely restart all Supervisors processes</p>

<pre><code>propel --restart
</code></pre>

<hr/>

<h1><a id="user-content-propelyml" class="anchor" href="#propelyml" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel.yml</h1>

<p><code>propel.yml</code> is a config file that tells propel what to deploy and run.</p>

<h3><a id="user-content-how-does-it-work-" class="anchor" href="#how-does-it-work-" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How does it work ?</h3>

<h2><a id="user-content-web" class="anchor" href="#web" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>WEB</h2>

<h4><a id="user-content-a-simple-flask-app-deployment-would-look-something-like-this" class="anchor" href="#a-simple-flask-app-deployment-would-look-something-like-this" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>A simple flask app deployment would look something like this:</h4>

<pre><code>virtualenv:
  name: "mynewsite.com"

web:
  -
    name: "mynewsite.com"
    application: "run:flask_app"

    nginx:
      aliases:
        "/static": "static"
</code></pre>

<p>**For Python application/sites, <code>virtualenv</code> is required. The requirements.txt must also exist to install the necessary packages.  </p>

<p>Upon deploying a Python app, Propel will the following:</p>

<ul>
<li><p>Instantly set the site on maintenance mode. So when a visitor comes, the will a maintenance page </p></li>
<li><p>create the virtualenv</p></li>
<li><p>install the requirements.txt in the virtualenv</p></li>
<li><p>create a random port and assign it to Gunicorn. By default it will assign <code>gevent</code> 
as the worker-class for Gunicorn, set the numbers of workers and threads.</p></li>
<li><p>add the Gunicorn command to Supervisor for process monitoring </p></li>
<li><p>create the Nginx config file for the site and use it as proxy to point to the Gunicorn instance.</p></li>
<li><p>... </p></li>
<li><p>Profit!</p></li>
</ul>

<h4><a id="user-content-a-basic-phphtml-site-would-have-the-following-structure-php-fpm-is-required" class="anchor" href="#a-basic-phphtml-site-would-have-the-following-structure-php-fpm-is-required" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>A basic PHP/HTML site would have the following structure. PHP-FPM is required.</h4>

<pre><code>web:
  -
    name: "my-php-html-site.com"
</code></pre>

<p>**For PHP/HTML site we don't need <code>virtualenv</code>.        </p>

<p>Upon deploying, it will create the NGINX config file and use PHP-FPM.</p>

<h4><a id="user-content-description-of-the-config-above" class="anchor" href="#description-of-the-config-above" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Description of the config above</h4>



<p><strong>Concerning paths</strong></p>

<p>By default, all paths are relative to the current directory. So let's say you are under: <code>/home/myapp.com/www</code>, setting the aliases: <code>/static: "my-static"</code>, it will automatically add the current directory to the path. The alias will turn into: <code>/home/myapp.com/www/my-static</code></p>

<p>That's how it would be in the Nginx file:</p>

<pre><code>location /static {
    alias /home/myapp.com/www/my-static
}
</code></pre>

<p>** To refer an absolute path, you must prefix the path with a slash <code>/</code></p>

<h4><a id="user-content-example-of-multiple-sites" class="anchor" href="#example-of-multiple-sites" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example of multiple sites</h4>

<p>The same above, but with multiple sites and multiple aliases</p>

<pre><code>virtualenv:
  name: "mynewsite.com"

web:
  -
    name: "mynewsite.com"
    application: "run:flask_app"

    nginx:
      aliases:
        "/static": "mytothersite/static"
        "/photos": "mytothersite/photos"

  -
    name: "my-php-html-site.com"
    nginx:
        root_dir: "html"
</code></pre>

<p>For the <code>my-php-html-site.com</code> the root dir is the <code>html</code> directory that's in the current working directory.</p>

<p>The above conf, will deploy multiple sites. The python app will be deployed in the virtualenv, the php/html site will be deployed as is.</p>

<h2><a id="user-content-web-advanced-config" class="anchor" href="#web-advanced-config" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>WEB: Advanced config</h2>

<p>You can add more NGINX and Gunicorn config. Gunicorn config is only for Python app. </p>

<pre><code>virtualenv:
  name: "mynewsite.com"
  rebuild: False
  directory: ""
  pip_options: ""

web:
  -
    name: "mynewsite.com"
    application: "run:flask_app"
    remove: False
    exclude: False
    environment: KEY1="value1",KEY2="value2"

    # Nginx Config
    nginx:
      server_name: "site1.com admin.site2.com"
      port: 80
      root_dir: ""
      logs_dir: ""
      aliases:
        "/static": "mysite/static"
      force_non_www: True
      force_www: False
      server_directives: ""
      ssl_directives: ""
      ssl_cert: ""
      ssl_key: ""

    # Gunicorn config
    gunicorn:
      workers: 4
      threads: 4
      "max-requests": 100
</code></pre>

<h4><a id="user-content-virtualenv-config" class="anchor" href="#virtualenv-config" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Virtualenv config</h4>

<ul>
<li><p>name: The name of the virtualenv</p></li>
<li><p>rebuild: (bool) When True, it will rebuild the virtualenv </p></li>
<li><p>directory: (path) The virtualenvs directory. By default it is set to /root/.virtualenvs </p></li>
<li><p>pip_options: (string) String of options to pass to pip. ie: --process-dependency-links --upgrade </p></li>
</ul>

<h4><a id="user-content-web-config" class="anchor" href="#web-config" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Web config</h4>

<ul>
<li><p>name: (string domain) The site's name</p></li>
<li><p>application: The application to run. It requires virtualenv. Python only.</p></li>
<li><p>remove: (bool) When True, it will remove the Nginx config file and stop Supervisor if Python, from the server</p></li>
<li><p>exclude: (bool) When True, it will not try to deploy or re-deploy. It takes precedence over 'remove'. </p></li>
<li><p>environment: A list of key/value pairs in the form KEY="val",KEY2="val2" that will be placed in the supervisord process’ environment</p></li>
</ul>

<h4><a id="user-content-nginx-config" class="anchor" href="#nginx-config" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>NGINX config</h4>

<ul>
<li><p>port: 80 by default</p></li>
<li><p>server_name: (string) Optional if the server name is different than name, or has multiple server_name. Separate multiple server with space </p></li>
<li><p>root_dir: If provided, it will be used as root dir in nginx, when using PHP/HTML site</p></li>
<li><p>logs_dir: If provided, it will be used to save the logs </p></li>
<li><p>aliases: (dict) location/path pair to create aliases</p></li>
<li><p>force_non_www: (boolean) - If True, it will redirect www to non-www</p></li>
<li><p>force_www: (boolean) - If True, it will redirect non-www to www</p></li>
<li><p>server_directives: (multi line text) Extra directives to include in the server block. </p></li>
<li><p>ssl_directives: (multi line text) Custom ssl directives to include the server block</p></li>
<li><p>ssl_cert: (path) path to the SSL certificate path. </p></li>
<li><p>ssl_key: (path) path the the SSL certificate key </p></li>
</ul>

<h4><a id="user-content-gunicorn-config" class="anchor" href="#gunicorn-config" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Gunicorn config</h4>

<p>For Gunicorn, the following values are set by default:</p>



<p>To disable any of the default values, you can set them as empty or use the desired value</p>

<p>For more config, please refer to: <a href="http://docs.gunicorn.org/en/develop/configure.html">http://docs.gunicorn.org/en/develop/configure.html</a></p>

<h4><a id="user-content-maintenance-config" class="anchor" href="#maintenance-config" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Maintenance config</h4>

<p>The maintenance config allows you to set page to show and turn on/off automatically </p>

<ul>
<li><p>active: (bool) Turn on/off maintenance page</p></li>
<li><p>page: (path) The maintenance page. If it doesn't exist, it will fallback to the propel default one</p></li>
<li><p>allowed_ips: (list) List of ips to allow. When allowed_ips is available, it will allow the ips to 
access the site, but show the maintenance page to all others. </p></li>
</ul>

<hr/>

<h2><a id="user-content-scripts" class="anchor" href="#scripts" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>SCRIPTS</h2>

<p>Propel allows you to run scripts. Scripts can be run as is, or before and after deployment:</p>

<p>Scripts is a dict of with script name to execute. A script can contain multiple commands </p>

<p>Each command must have the <code>command</code> param, and optionally <code>directory</code> if the script is not being excuted from the same directory. When <code>directory</code> is provided, it will <code>cd</code> into it and run the <code>command</code></p>

<pre><code>scripts:

  # Run before all
  before_all: 
    - command: "$PYTHON_ENV myscript.py"

  # Run after all
  after_all:
    - command: "$PYTHON_ENV myscript.py"

  # run before web deployment
  before_web:
    - command: "$PYTHON_ENV myscript.py"

  # run after web deployment
  after_web:
    - command: "$PYTHON_ENV myscript.py"

  # run this script when UNDEPLOYING
  undeploy:
    - command: ""

  # MY_SCRIPT_NAME: Custom script by name
  my_script_name:
    - 
      command: ""
    -
      directory: ""
      command: "$PYTHON_ENV myscript.py"
</code></pre>

<p>And to run any of these scripts, you can just do:</p>

<pre><code>propel -s my_script_name
</code></pre>

<p>or multiple scripts:</p>

<pre><code>propel -s my_script_name another_script after_all
</code></pre>

<h4><a id="user-content-scripts-command-with-variables-python_env-and-local_bin" class="anchor" href="#scripts-command-with-variables-python_env-and-local_bin" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Scripts command with variables: $PYTHON_ENV and $LOCAL_BIN</h4>

<p>As a convenience, there are a few variables to refer to the virtualenv. They allow you to refer to the location without knowing the full path, specially when in virtualenv.</p>

<ul>
<li><p>$PYTHON_ENV: refers to the Python (ie: /root/.virtualenvs/myvirtualenv/local/bin/python2.7)</p></li>
<li><p>$LOCAL_BIN: refers to the local bin like (ie: /root/.virtualenvs/myvirtualenv/local/bin/)</p></li>
<li><p>$CWD: refers to the current working directory</p>

<pre><code>-
  command: "$PYTHON_ENV manage.py"
</code></pre></li>
</ul>

<p>The command above will execute the manage.py with the virtualenv python.</p>

<p><strong>Config description</strong></p>

<ul>
<li><p>command: (string) (required) the command to use. You can the $PYTHON_ENV and $LOCAL_BIN variables in it.</p></li>
<li><p>directory: (string) The directory the command is being executed at. If empty, it will be executed in the current working directory</p></li>
<li><p>exclude: (bool) When True it will no run or rerun the worker</p></li>
</ul>

<h4><a id="user-content-before_all-after_all-before_web-after_web-before_workers-after_workers" class="anchor" href="#before_all-after_all-before_web-after_web-before_workers-after_workers" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>before_all, after_all, before_web, after_web, before_workers, after_workers</h4>

<p>Some pre-made hook to run before and after </p>

<p><code>before_all</code>: Before setting up everything</p>

<p><code>after_all</code>: After setting up everything</p>

<p><code>before_web</code>: Before web deployment</p>

<p><code>after_web</code>: After web deployment</p>

<p><code>before_workers</code>: Before workers deployment</p>

<p><code>after_workers</code>: After workers deployment </p>

<pre><code>scripts:
    before_all:
      - command: "$PYTHON_ENV myscript.py"

    after_all:
      - command: "$PYTHON_ENV another-script.py"

    before_web:
      - command: "$PYTHON_ENV myscript.py"

    after_web:
      - command: "$PYTHON_ENV another-script.py"

    before_workers:
      - command: "$PYTHON_ENV myscript.py"

    after_workers:
      - command: "$PYTHON_ENV myscript.py"
</code></pre>

<h4><a id="user-content-undeploy" class="anchor" href="#undeploy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>UNDEPLOY</h4>

<p><code>undeploy</code> will run when undeploying the application. It can be used to clean up etc when removing the site.
ie: <code>propel --undeploy</code></p>

<pre><code>scripts:
  undeploy:
    - command: "time"
    - command: "rm some_path"
</code></pre>

<h4><a id="user-content-custom-scripts-script_name" class="anchor" href="#custom-scripts-script_name" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Custom Scripts: $SCRIPT_NAME</h4>

<p>You can setup your custom scripts to be run manually.</p>

<p><code>$script_name</code> (with $script_name being the name of the script). It will be run when called manually. </p>

<p>ie: <code>propel -s setup_cron</code></p>

<pre><code>scripts:
  setup_cron:
    -
      directory: ""
      command: "mysetup_cron_script"
</code></pre>

<hr/>

<h2><a id="user-content-workers" class="anchor" href="#workers" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>WORKERS</h2>

<p>Workers (just like Scripts) are scripts to run continuously in the background via <code>Supervisor</code>. </p>

<p><code>workers</code> contains a dict of tasks grouped by name, which contain the work to execute.</p>

<pre><code>  # To run this: propel -k managers
  managers:
    -
      name: "manager1"
      command: "$PYTHON_ENV trigger.py
      environment: ""

  # To run this: propel -k jobs
  jobs:
    -
      name: "myworker1"
      command: "$PYTHON_ENV myyworker1.py
      environment: ""
    -
      name: "myworker2"
      directory: ""
      command: "$PYTHON_ENV myyworker2.py"
      environment: ""
      user: ""
      exclude: True  # Prevent this worker from rerunning
</code></pre>

<p><strong>Config description</strong></p>

<ul>
<li><p>name: (string) (required) The name of the worker</p></li>
<li><p>command: (string) (required) the command to use. You can the $PYTHON_ENV and $LOCAL_BIN variables in it.</p></li>
<li><p>directory: (string) The directory the command is being executed at. If empty, it will be executed in the current working directory</p></li>
<li><p>user: (string) The user </p></li>
<li><p>environment: (string) Environment string</p></li>
<li><p>exclude: (bool) When True it will no run or rerun the worker. It takes precedence over 'remove'. </p></li>
<li><p>remove: (bool) When True it will remove the worker from the script</p></li>
</ul>

<hr/>

<h2><a id="user-content-maintenance" class="anchor" href="#maintenance" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>MAINTENANCE</h2>

<p>Propel allows you to set your site on Maintenance mode. When visitors come to the site, they will be
greeted with a maintenance page to tell them the site is under maintenance. </p>

<p>To manually set the site under maintenance</p>

<pre><code>propel --maintenance on 

// or 

propel -m on
</code></pre>

<p>And to remove it</p>

<pre><code>propel --maintenance off

// or 

propel -m off
</code></pre>

<p>Propel already has a default page that it will render upon being under maintenance.</p>

<h4><a id="user-content-set-the-maintenance-in-propelyml" class="anchor" href="#set-the-maintenance-in-propelyml" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Set the maintenance in propel.yml</h4>

<p>You can also set the maintenance mode in the <code>propel.yml</code>. This way it will turn on/off maintenance each time 
you run <code>propel -w</code></p>

<p>Edit your <code>propel.yml</code> and add the line below.</p>

<pre><code>maintenance:
  active: True 
</code></pre>

<h4><a id="user-content-set-a-custom-maintenance-page" class="anchor" href="#set-a-custom-maintenance-page" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Set a custom maintenance page</h4>

<p>To set your custom maintenance page, add the <code>page</code> under maintenance. The page must be relative to the site's root</p>

<pre><code>maintenance:
  active: True  
  page: "maintenance/index.html" 
</code></pre>

<p>So if your site is at: /home/mysite.com, the maintenance page is at: /home/mysite.com/maintenance/index.html</p>

<h4><a id="user-content-put-site-under-maintenance-but-give-full-access-to-certain-ips" class="anchor" href="#put-site-under-maintenance-but-give-full-access-to-certain-ips" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Put site under maintenance, but give full access to certain ips</h4>

<p>Sometimes, even if the site is under maintenance, you would like to check everything on it to make sure it works 
before activate it back again; or you would want to give certain people access before going live.</p>

<p>To do so, Propel allows to set a list of ips you would like to give access while the site is under maintenance</p>

<pre><code>maintenance:
  active: True
  allow_ips: # List of ips to allow to view the site
    - 1.2.4.5
    - 2.3.4.5
</code></pre>

<h4><a id="user-content-deactivate-maintenance-mode" class="anchor" href="#deactivate-maintenance-mode" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Deactivate Maintenance Mode</h4>

<p>To deactivate and put the full site back online</p>

<pre><code>maintenance:
  active: False
</code></pre>

<p>If the site is under maintenance using propel.yml, <code>propel -m off</code> will not turn off maintenance. 
You must deactivate it in propel.yml</p>

<hr/>

<hr/>

<h2><a id="user-content-some-xtra" class="anchor" href="#some-xtra" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Some Xtra</h2>

<h3><a id="user-content-propel---git-init-repo_name" class="anchor" href="#propel---git-init-repo_name" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel --git-init $repo_name</h3>

<p>To create a <code>git bare repo</code> directory to push content to with <code>git push</code></p>

<pre><code>cd /home/mydomain.com

propel --git-init www
</code></pre>

<p>It will create 3 directories:</p>

<p><code>www</code> : Where your application content will reside</p>

<p><code>www.git</code> : A git bare repo</p>

<p><code>www.logs</code>: A logs directory</p>

<p>So your git path to push directly could be:</p>

<pre><code>ssh://my.ip.address/home/mydomain/www.git
</code></pre>

<p>And when you <code>git push</code> it will update the <code>/home/mydomain/www</code> directory</p>

<h3><a id="user-content-propel---git-push-web-repo_name" class="anchor" href="#propel---git-push-web-repo_name" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel --git-push-web $repo_name</h3>

<p>It will add the command <code>propel -w</code> in the <em>post-receive</em> hook file so it redeploy the app on each push. Good for Python app. </p>

<pre><code>cd /home/mydomain.com

propel --git-push-web www
</code></pre>

<h3><a id="user-content-propel---git-push-cmd-repo_name--cmd-cmd" class="anchor" href="#propel---git-push-cmd-repo_name--cmd-cmd" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>propel --git-push-cmd $repo_name  [cmd, [cmd...]]</h3>

<p>To add custom command to be executed after a git push</p>

<pre><code>cd /home/mydomain.com

propel --git-push-cmd www 'ls -l' 'cd /' ''
</code></pre>

<hr/>

<p>Thank you </p>

<p>Mardix :) </p>

<hr/>

<p>License: MIT - Copyright 2015 Mardix</p>
</article>
  </div></body></html>