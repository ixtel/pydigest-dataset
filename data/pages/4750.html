<html><body><div><div class="section" id="new-modules-tornado-locks-and-tornado-queues">

<p>These modules provide classes for coordinating coroutines, merged from
<a class="reference external" href="http://toro.readthedocs.org">Toro</a>.</p>
<p>To port your code from Toro’s queues to Tornado 4.2, import <a class="reference internal" href="../queues.html#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a>,
<a class="reference internal" href="../queues.html#tornado.queues.PriorityQueue" title="tornado.queues.PriorityQueue"><code class="xref py py-obj docutils literal"><span class="pre">PriorityQueue</span></code></a>, or <a class="reference internal" href="../queues.html#tornado.queues.LifoQueue" title="tornado.queues.LifoQueue"><code class="xref py py-obj docutils literal"><span class="pre">LifoQueue</span></code></a> from <a class="reference internal" href="../queues.html#module-tornado.queues" title="tornado.queues"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues</span></code></a> instead of from
<code class="docutils literal"><span class="pre">toro</span></code>.</p>
<p>Use <a class="reference internal" href="../queues.html#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a> instead of Toro’s <code class="docutils literal"><span class="pre">JoinableQueue</span></code>. In Tornado the methods
<a class="reference internal" href="../queues.html#tornado.queues.Queue.join" title="tornado.queues.Queue.join"><code class="xref py py-obj docutils literal"><span class="pre">join</span></code></a> and <a class="reference internal" href="../queues.html#tornado.queues.Queue.task_done" title="tornado.queues.Queue.task_done"><code class="xref py py-obj docutils literal"><span class="pre">task_done</span></code></a> are available on all queues, not on a
special <code class="docutils literal"><span class="pre">JoinableQueue</span></code>.</p>
<p>Tornado queues raise exceptions specific to Tornado instead of reusing
exceptions from the Python standard library.
Therefore instead of catching the standard <a class="reference external" href="https://docs.python.org/3.4/library/queue.html#queue.Empty" title="(in Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">queue.Empty</span></code></a> exception from
<a class="reference internal" href="../queues.html#tornado.queues.Queue.get_nowait" title="tornado.queues.Queue.get_nowait"><code class="xref py py-obj docutils literal"><span class="pre">Queue.get_nowait</span></code></a>, catch the special <a class="reference internal" href="../queues.html#tornado.queues.QueueEmpty" title="tornado.queues.QueueEmpty"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues.QueueEmpty</span></code></a> exception,
and instead of catching the standard <a class="reference external" href="https://docs.python.org/3.4/library/queue.html#queue.Full" title="(in Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">queue.Full</span></code></a> from <a class="reference internal" href="../queues.html#tornado.queues.Queue.get_nowait" title="tornado.queues.Queue.get_nowait"><code class="xref py py-obj docutils literal"><span class="pre">Queue.get_nowait</span></code></a>,
catch <a class="reference internal" href="../queues.html#tornado.queues.QueueFull" title="tornado.queues.QueueFull"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues.QueueFull</span></code></a>.</p>
<p>To port from Toro’s locks to Tornado 4.2, import <a class="reference internal" href="../locks.html#tornado.locks.Condition" title="tornado.locks.Condition"><code class="xref py py-obj docutils literal"><span class="pre">Condition</span></code></a>, <a class="reference internal" href="../locks.html#tornado.locks.Event" title="tornado.locks.Event"><code class="xref py py-obj docutils literal"><span class="pre">Event</span></code></a>,
<a class="reference internal" href="../locks.html#tornado.locks.Semaphore" title="tornado.locks.Semaphore"><code class="xref py py-obj docutils literal"><span class="pre">Semaphore</span></code></a>, <a class="reference internal" href="../locks.html#tornado.locks.BoundedSemaphore" title="tornado.locks.BoundedSemaphore"><code class="xref py py-obj docutils literal"><span class="pre">BoundedSemaphore</span></code></a>, or <a class="reference internal" href="../locks.html#tornado.locks.Lock" title="tornado.locks.Lock"><code class="xref py py-obj docutils literal"><span class="pre">Lock</span></code></a> from <a class="reference internal" href="../locks.html#module-tornado.locks" title="tornado.locks"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locks</span></code></a>
instead of from <code class="docutils literal"><span class="pre">toro</span></code>.</p>
<p>Toro’s <code class="docutils literal"><span class="pre">Semaphore.wait</span></code> allowed a coroutine to wait for the semaphore to
be unlocked <em>without</em> acquiring it. This encouraged unorthodox patterns; in
Tornado, just use <a class="reference internal" href="../locks.html#tornado.locks.Semaphore.acquire" title="tornado.locks.Semaphore.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a>.</p>
<p>Toro’s <code class="docutils literal"><span class="pre">Event.wait</span></code> raised a <code class="docutils literal"><span class="pre">Timeout</span></code> exception after a timeout. In
Tornado, <a class="reference internal" href="../locks.html#tornado.locks.Event.wait" title="tornado.locks.Event.wait"><code class="xref py py-obj docutils literal"><span class="pre">Event.wait</span></code></a> raises <a class="reference internal" href="../gen.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a>.</p>
<p>Toro’s <code class="docutils literal"><span class="pre">Condition.wait</span></code> also raised <code class="docutils literal"><span class="pre">Timeout</span></code>, but in Tornado, the <a class="reference internal" href="../concurrent.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
returned by <a class="reference internal" href="../locks.html#tornado.locks.Condition.wait" title="tornado.locks.Condition.wait"><code class="xref py py-obj docutils literal"><span class="pre">Condition.wait</span></code></a> resolves to False after a timeout:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@gen.coroutine</span>
<span class="k">def</span> <span class="nf">await_notification</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="k">yield</span> <span class="n">condition</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">))):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'timed out'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'condition is true'</span><span class="p">)</span>
</pre></div>
</div>
<p>In lock and queue methods, wherever Toro accepted <code class="docutils literal"><span class="pre">deadline</span></code> as a keyword
argument, Tornado names the argument <code class="docutils literal"><span class="pre">timeout</span></code> instead.</p>
<p>Toro’s <code class="docutils literal"><span class="pre">AsyncResult</span></code> is not merged into Tornado, nor its exceptions
<code class="docutils literal"><span class="pre">NotReady</span></code> and <code class="docutils literal"><span class="pre">AlreadySet</span></code>. Use a <a class="reference internal" href="../concurrent.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> instead. If you wrote code like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tornado</span> <span class="kn">import</span> <span class="n">gen</span>
<span class="kn">import</span> <span class="nn">toro</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">toro</span><span class="o">.</span><span class="n">AsyncResult</span><span class="p">()</span>

<span class="nd">@gen.coroutine</span>
<span class="k">def</span> <span class="nf">setter</span><span class="p">():</span>
    <span class="n">result</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@gen.coroutine</span>
<span class="k">def</span> <span class="nf">getter</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c"># Prints "1".</span>
</pre></div>
</div>
<p>Then the Tornado equivalent is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tornado</span> <span class="kn">import</span> <span class="n">gen</span>
<span class="kn">from</span> <span class="nn">tornado.concurrent</span> <span class="kn">import</span> <span class="n">Future</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>

<span class="nd">@gen.coroutine</span>
<span class="k">def</span> <span class="nf">setter</span><span class="p">():</span>
    <span class="n">result</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@gen.coroutine</span>
<span class="k">def</span> <span class="nf">getter</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">result</span>
    <span class="k">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c"># Prints "1".</span>
</pre></div>
</div>
</div>
</div></body></html>