<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-pyspaces" class="anchor" href="#pyspaces" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>pyspaces</h1>

<p>Works with Linux namespaces through glibc with pure python</p>

<p><a href="https://pypi.python.org/pypi/pyspaces/"><img src="https://camo.githubusercontent.com/cb404497e95a90bfce92bacd368049e50c782206/68747470733a2f2f70797069702e696e2f6c6963656e73652f70797370616365732f62616467652e737667" alt="License" data-canonical-src="https://pypip.in/license/pyspaces/badge.svg"/></a>
<a href="https://pypi.python.org/pypi/pyspaces/"><img src="https://camo.githubusercontent.com/3a9bbf522975131b8eaee212e5db06e2f49c60fe/68747470733a2f2f70797069702e696e2f76657273696f6e2f70797370616365732f62616467652e737667" alt="Latest Version" data-canonical-src="https://pypip.in/version/pyspaces/badge.svg"/></a>
<a href="https://pypi.python.org/pypi/pyspaces/"><img src="https://camo.githubusercontent.com/6e2658e932358e4ffb218ae62fb8b7aaebb73c93/68747470733a2f2f70797069702e696e2f646f776e6c6f61642f70797370616365732f62616467652e737667" alt="Downloads" data-canonical-src="https://pypip.in/download/pyspaces/badge.svg"/></a>
<a href="https://pyspaces.readthedocs.org/en/latest/"><img src="https://camo.githubusercontent.com/b808fec80890f6d60024c8fcd06d60a3183be5c0/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f70797370616365732f62616467652f" alt="Docs" data-canonical-src="https://readthedocs.org/projects/pyspaces/badge/"/></a></p>

<p>discuss: <a href="https://www.reddit.com/r/Python/comments/33z84l/linux_namespaces_througth_glibc_with_pure_python/">reddit</a>, <a href="http://habrahabr.ru/company/wargaming/blog/256647/">habrahabr</a></p>

<h2><a id="user-content-goals" class="anchor" href="#goals" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Goals</h2>

<p>There is so many beautiful tools like <a href="https://github.com/docker/docker">docker</a>, <a href="https://github.com/coreos/rkt">rocket</a> and <a href="https://github.com/tailhook/vagga">vagga</a> written in go and rust, but none in python.
I think that is because there is no easy way to work with linux namespaces in python:</p>

<ul>
<li>you can use <a href="https://pypi.python.org/pypi/asylum/0.4.1">asylum</a> - a project that looks dead and with a codebase hosted not on mainstream hub like github</li>
<li>or you can use the <a href="https://pypi.python.org/pypi/libvirt-python/1.2.13">python-libvirt</a> bindings with a big layer of abstraction</li>
<li>or just use the native glibc library with ctypes</li>
<li>otherwise subprocess.Popen -- your choice</li>
</ul>

<p>I want to change this: I want to create native python bindings to glibc with interface of python multiprocessing.Process.</p>

<p>PS: you can look at <a href="https://github.com/zalando/python-nsenter">python-nsenter</a> too, it's looks awesome.</p>

<p>PPS: new project from author of asylum - <a href="https://pypi.python.org/pypi/butter/0.10">butter</a></p>

<h2><a id="user-content-example" class="anchor" href="#example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example</h2>

<p>First simple example:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> os
<span class="pl-k">from</span> pyspaces <span class="pl-k">import</span> Container


<span class="pl-k">def</span> <span class="pl-en">execute</span>(<span class="pl-smi">argv</span>):
    os.execvp(argv[<span class="pl-c1">0</span>], argv)

cmd <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>mount -t proc proc /proc; ps ax<span class="pl-pds">"</span></span>
c <span class="pl-k">=</span> Container(<span class="pl-v">target</span><span class="pl-k">=</span>execute, <span class="pl-v">args</span><span class="pl-k">=</span>((<span class="pl-s"><span class="pl-pds">'</span>bash<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>-c<span class="pl-pds">'</span></span>, cmd),),
              <span class="pl-v">uid_map</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>0 1000 1<span class="pl-pds">'</span></span>,
              <span class="pl-v">newpid</span><span class="pl-k">=</span><span class="pl-c1">True</span>, <span class="pl-v">newuser</span><span class="pl-k">=</span><span class="pl-c1">True</span>, <span class="pl-v">newns</span><span class="pl-k">=</span><span class="pl-c1">True</span>
              )
c.start()
<span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span>PID of child created by clone() is <span class="pl-c1">%ld</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">%</span> c.pid)
c.join()
<span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Child returned: pid <span class="pl-c1">%s</span>, status <span class="pl-c1">%s</span><span class="pl-pds">"</span></span> <span class="pl-k">%</span> (c.pid, c.exitcode))</pre></div>

<p>output:</p>

<div class="highlight highlight-source-shell"><pre>PID of child created by <span class="pl-en">clone</span>() is 15978

PID TTY      STAT   TIME COMMAND
1   pts/19   S+     0:00 bash -c mount -t proc proc /proc<span class="pl-k">;</span> ps ax
3   pts/19   R+     0:00 ps ax

Child returned: pid 15978, status 0</pre></div>

<h2><a id="user-content-cli" class="anchor" href="#cli" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>CLI</h2>

<div class="highlight highlight-source-shell"><pre>space execute -v --pid --mnt --user --uid 1000 --gid 1000 bash -c <span class="pl-s"><span class="pl-pds">'</span>mount -t proc /proc; ps ax<span class="pl-pds">'</span></span></pre></div>

<div class="highlight highlight-source-shell"><pre>space chroot --pid --uid <span class="pl-s"><span class="pl-pds">'</span>0 1000 1<span class="pl-pds">'</span></span> <span class="pl-k">~</span>/.<span class="pl-k">local</span>/share/lxc/ubuntu/rootfs/ /bin/ls /home/</pre></div>

<div class="highlight highlight-source-shell"><pre>space inject --net --mnt 19840 bash</pre></div>

<p>Note: If the program you're trying to exec is dynamically linked, and the dynamic linker is not present in /lib in the chroot environment - you will get the following error: "OSError: [Errno 2] No such file or directory". You need all the other files the dynamic-linked program depends on, including shared libraries and any essential configuration/tables/etc in the new root directories. <a href="http://www.ciiycode.com/0JiJzPgggqPg/why-doesnt-exec-work-after-chroot">src</a></p>

<h2><a id="user-content-security" class="anchor" href="#security" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Security</h2>

<p>Read <a href="https://github.com/Friz-zy/awesome-linux-containers#security">this article</a> please</p>

<h2><a id="user-content-changelog" class="anchor" href="#changelog" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Changelog</h2>

<p><a href="https://github.com/Friz-zy/pyspaces/blob/master/CHANGELOG.md">on github</a><br/>
<a href="https://allmychanges.com/p/python/pyspaces/">digest</a>  </p>

<h2><a id="user-content-todo" class="anchor" href="#todo" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>TODO</h2>


</article>
  </div></body></html>