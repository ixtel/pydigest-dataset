<html><body><div><div class="content html_format"><p>
      Хотел бы поделиться простым, но полезным инструментом. Когда много работаешь с данными, часто возникают примитивные, но долгие операции, например: «скачать 10 000 урлов», «прочитать файл на 2Гб, и что-то сделать с каждой строчкой», «распарсить 10 000 html-файлов и достать заголовки». Долго смотреть в зависший терминал тревожно, поэтому долгое время я использовал следующий гениальный код: </p><pre><code class="python">def log_progress(sequence, every=10):
    for index, item in enumerate(sequence):
        if index % every == 0:
            print &gt;&gt;sys.stderr, index,
        yield item
</code></pre><img src="https://habrastorage.org/files/41d/b19/857/41db19857a664e74b03d763e7243f0c3.gif"/>
<p>
Эта функция прекрасна, больше года она кочевала у меня из задачи в задачу. Но недавно я заметил в стандартной поставке Jupyter виджет IntProgress и понял, что пора что-то менять:
</p><img src="https://habrastorage.org/files/fde/8d9/be6/fde8d9be6e4f4cae9bc1c169bfd6a688.gif"/>
<a name="habracut"/><p>
У логирования в stderr есть три небольшие проблемы:</p><ol>
<li>Это некрасиво. Очевидно.</li>
<li>Иногда это взрывает буфер.<br/>
<img src="https://habrastorage.org/files/f43/4c5/b03/f434c5b030974ad4b46d20c9b4790c9d.gif"/></li>
<li>Иногда кто-то ещё пишет в stderr или stdout.<br/>
<img src="https://habrastorage.org/files/318/029/310/31802931010d47c081560377182a6681.gif"/></li>
</ol>
<p>
Как и многие люди, которые работают с данными, я фанат Jupyter. Большую часть времени провожу там. Поэтому могу позволить себе следующее, несовместимое с другими средами, решение: </p><pre><code class="python">def log_progress(sequence, every=10):
    from ipywidgets import IntProgress
    from IPython.display import display

    progress = IntProgress(min=0, max=len(sequence), value=0)
    display(progress)
    
    for index, record in enumerate(sequence):
        if index % every == 0:
            progress.value = index
        yield record
</code></pre><img src="https://habrastorage.org/files/c67/996/ac5/c67996ac58024bfa9929b30e3ae56e8f.gif"/>
<p>
Всё то же самое, только счётчик выводится не в stderr, а в специальный виджет. Очень просто и удобно. Для тех, кто тоже подсел на Jupyter, я выложил немного улучшенную версию на Гитхаб </p><a href="https://github.com/alexanderkuk/log-progress">github.com/alexanderkuk/log-progress</a><p>. Модуль распространяется копипейстом. Пользуйтесь на здоровье.
</p><p>
Улучшенная версия выводит кроме полоски ещё и счётчик. И меняет цвет в зависимости от того успешно завершилась операция или нет:
</p><img src="https://habrastorage.org/files/d7a/1f5/9f6/d7a1f59f61634d63a42b274ba186d1ba.gif"/>
<img src="https://habrastorage.org/files/1bc/544/e8a/1bc544e8a50b419382d0fc090e087cce.gif"/>
<p>
Поддерживает итераторы:
</p><img src="https://habrastorage.org/files/712/255/d77/712255d77fd5473b8113e7bfc1bd852f.gif"/>
<p>
Естественно, в одной ячейке может быть несколько прогресс баров:
</p><img src="https://habrastorage.org/files/1b4/48f/9a5/1b448f9a5b74456091eb5b16799c7c3e.gif"/>
<img src="https://habrastorage.org/files/95d/c00/1df/95dc001dffb24852999a73ae8129a209.gif"/>
<p>
И они даже могут работать из разных тредов:
</p><img src="https://habrastorage.org/files/e64/69a/fe5/e6469afe59ed485c84565a672d24cd50.gif"/>
<p>
Короче, ещё раз ссылка на код </p><a href="https://github.com/alexanderkuk/log-progress">github.com/alexanderkuk/log-progress</a><p>.

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>