<html><body><div><div class="entry-content">
      <p>Hi there guys! I hope all of you are fine and doing well. Recently I was hanging out on a python related IRC where I got a request from someone to write an article on decorators in Python. It is perhaps one of the most difficult concept to grasp. So as usual without wasting anytime let get on with it.</p>
<h2>- Everything in python is an object (Functions too!):</h2>
<p>First of all let's understand functions in python:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">hi</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"yasoob"</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"hi "</span><span class="o">+</span><span class="n">name</span>

<span class="k">print</span> <span class="n">hi</span><span class="p">()</span>
<span class="c">#output: 'hi yasoob'</span>

<span class="c">#We can even assign a function to a variable like</span>
<span class="n">greet</span> <span class="o">=</span> <span class="n">hi</span>
<span class="c">#We are not using parentheses here because we are not calling the function hi</span>
<span class="c">#instead we are just putting it into the greet variable. Let's try to run this</span>

<span class="k">print</span> <span class="n">greet</span><span class="p">()</span>
<span class="c">#output: 'hi yasoob'</span>

<span class="c">#lets see what happens if we delete the old hi function!</span>
<span class="k">del</span> <span class="n">hi</span>
<span class="k">print</span> <span class="n">hi</span><span class="p">()</span>
<span class="c">#outputs: NameError</span>

<span class="k">print</span> <span class="n">greet</span><span class="p">()</span>
<span class="c">#outputs: 'hi yasoob'</span>
</pre></div>


<h2>- Defining functions within functions:</h2>
<p>So those are the basics when it comes to functions. Lets take your knowledge one step further! In Python we can define functions inside other functions. You might be wondering what sorcery is this! Let me explain it with an example.</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">hi</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"yasoob"</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">"now you are inside the hi() function"</span>

    <span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">"now you are in the greet() function"</span>

    <span class="k">def</span> <span class="nf">welcome</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">"now you are in the welcome() function"</span>

    <span class="k">print</span> <span class="n">greet</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">welcome</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">"now you are back in the hi() function"</span>

<span class="n">hi</span><span class="p">()</span>
<span class="c">#output:now you are inside the hi() function</span>
<span class="c">#       now you are in the greet() function</span>
<span class="c">#       now you are in the welcome() function</span>
<span class="c">#       now you are back in the hi() function</span>

<span class="c"># This shows that whenever you call hi(), greet() and welcome()</span>
<span class="c"># are also called. However the greet() and welcome() functions</span>
<span class="c"># are not available outsite the hi() function e.g:</span>

<span class="n">greet</span><span class="p">()</span>
<span class="c">#outputs: NameError: name 'greet' is not defined</span>
</pre></div>


<p>So now we know that we can define functions in other functions. In simpler words we can make nested functions. Now you need to learn one more thing that functions can return functions too. </p>
<h2>- Returning functions from within functions:</h2>
<p>It is not necessary to execute a function within another function, we can return it as an output as well. Let's take a look at it with an example!</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">hi</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"yasoob"</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">"now you are in the greet() function"</span>

    <span class="k">def</span> <span class="nf">welcome</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">"now you are in the welcome() function"</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"yasoob"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">greet</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">welcome</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">hi</span><span class="p">()</span>
<span class="k">print</span> <span class="n">a</span>
<span class="c">#outputs: &lt;function greet at 0x7f2143c01500&gt;</span>

<span class="c">#This clearly shows that `a` now points to the greet() function in hi()</span>
<span class="c">#Now try this</span>

<span class="k">print</span> <span class="n">a</span><span class="p">()</span>
<span class="c">#outputs: now you are in the greet() function</span>
</pre></div>


<p>Just take a look at the code again! In the if/else clause we are returning greet and welcome, not greet() and welcome(). Why is that? It is so because when you put parentheses around it the function gets executed whereas if you don't put parenthesis around it then it can be passed around and can be assigned to other variables without executing it. Did you get it ? Let me explain it a little bit in more detail. When we write <code>a = hi()</code> hi() gets executed and because the name is <code>yasoob</code> by default, the function greet is returned. If we change the statement to <code>a = hi(name = "ali")</code> then the welcome function will be returned. We can also do <code>print hi()()</code> which outputs <code>now you are in the greet() function</code>. I hope you have not fainted by now. Was it difficult ? No? I guess you are in the mood to finally learn about decorators! Lets continue our talk and move forward.</p>
<h2>- Giving a function as an argument to another function:</h2>
<p>Lets take a look at an example:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">hi</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"hi yasoob!"</span>

<span class="k">def</span> <span class="nf">doSomethingBeforeHi</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">"I am doing some  boring work before executing hi()"</span>
    <span class="k">print</span> <span class="n">func</span><span class="p">()</span>

<span class="n">doSomethingBeforeHi</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span>
<span class="c">#outputs:I am doing some  boring work before executing hi()</span>
<span class="c">#        hi yasoob!</span>
</pre></div>


<p>Congratulations! You have all of the knowledge to entitle you as a decorator wrangler! Oh wait, I still haven't told you what decorators really are. Here is a short definition <code>decorators let you execute code before and after the function they decorate</code></p>
<h2>- Writing your first decorator:</h2>
<p>You have already written your first decorator! Do you know when? In the last example we actually made a decorator! Lets modify the previous decorator and make a little bit more usable program:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">a_new_decorator</span><span class="p">(</span><span class="n">a_func</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">wrapTheFunction</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">"I am doing some  boring work before executing a_func()"</span>

        <span class="n">a_func</span><span class="p">()</span>

        <span class="k">print</span> <span class="s">"I am doing some boring work after executing a_func()"</span>

    <span class="k">return</span> <span class="n">wrapTheFunction</span>

<span class="k">def</span> <span class="nf">a_function_requiring_decoration</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">"I am the function which needs some decoration to remove my foul smell"</span>

<span class="n">a_function_requiring_decoration</span><span class="p">()</span>
<span class="c">#outputs: "I am the function which needs some decoration to remove my foul smell"</span>

<span class="n">a_function_requiring_decoration</span> <span class="o">=</span> <span class="n">a_new_decorator</span><span class="p">(</span><span class="n">a_function_requiring_decoration</span><span class="p">)</span>
<span class="c">#now a_function_requiring_decoration is wrapped by wrapTheFunction()</span>

<span class="n">a_function_requiring_decoration</span><span class="p">()</span>
<span class="c">#outputs:I am doing some  boring work before executing a_function_requiring_decoration()</span>
<span class="c">#        I am the function which needs some decoration to remove my foul smell</span>
<span class="c">#        I am doing some boring work after executing a_function_requiring_decoration()</span>
</pre></div>


<p>Did you get it? We just applied the previously learned principles. This is exactly what the decorators do in python! They wrap a function and modify its behaviour in one way or the another. Now you might be wondering that we did not use the <code>@</code> anywhere in our code? That is just a short way of making up a decorated function. Here is how we could have run the previous code sample using <code>@</code>.</p>
<div class="codehilite"><pre><span class="nd">@a_new_decorator</span>
<span class="k">def</span> <span class="nf">a_function_requiring_decoration</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">"I am the function which needs some decoration to remove my foul smell"</span>

<span class="n">a_function_requiring_decoration</span><span class="p">()</span>
<span class="c">#outputs: I am doing some  boring work before executing a_function_requiring_decoration()</span>
<span class="c">#         I am the function which needs some decoration to remove my foul smell</span>
<span class="c">#         I am doing some boring work after executing a_function_requiring_decoration()</span>

<span class="c">#the @a_new_decorator is just a short way of saying:</span>
<span class="n">a_function_requiring_decoration</span> <span class="o">=</span> <span class="n">a_new_decorator</span><span class="p">(</span><span class="n">a_function_requiring_decoration</span><span class="p">)</span>
</pre></div>


<h2>- Decorators Demystified:</h2>
<p>I hope you now have a basic understanding of how decorators work in Python. They are not something to be afraid of at all. In addition, we can chain two or more than two decorators! For example:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">bread</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">"&lt;/''''''\&gt;"</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">"&lt;\______/&gt;"</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">ingredients</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">"#tomatoes#"</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">"~salad~"</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="s">"--ham--"</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">food</span>

<span class="n">sandwich</span><span class="p">()</span>
<span class="c">#outputs: --ham--</span>
<span class="n">sandwich</span> <span class="o">=</span> <span class="n">bread</span><span class="p">(</span><span class="n">ingredients</span><span class="p">(</span><span class="n">sandwich</span><span class="p">))</span>
<span class="n">sandwich</span><span class="p">()</span>
<span class="c">#outputs:</span>
<span class="c">#&lt;/''''''\&gt;</span>
<span class="c"># #tomatoes#</span>
<span class="c"># --ham--</span>
<span class="c"># ~salad~</span>
<span class="c">#&lt;\______/&gt;</span>
</pre></div>


<p>In the following example <a href="http://stackoverflow.com/users/9951/e-satis">e-satis</a> really does a great job demonstrating how decorators are used. We can run the previous example as so:</p>
<div class="codehilite"><pre><span class="nd">@bread</span>
<span class="nd">@ingredients</span>
<span class="k">def</span> <span class="nf">sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="s">"--ham--"</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">food</span>

<span class="n">sandwich</span><span class="p">()</span>
<span class="c">#outputs:</span>
<span class="c">#&lt;/''''''\&gt;</span>
<span class="c"># #tomatoes#</span>
<span class="c"># --ham--</span>
<span class="c"># ~salad~</span>
<span class="c">#&lt;\______/&gt;</span>
</pre></div>


<p>The order in which you use decorators matters and can change the whole behaviour of your decorated function if they are not executed in the intended order. Suppose you write this:</p>
<div class="codehilite"><pre><span class="nd">@ingredients</span>
<span class="nd">@bread</span>
<span class="k">def</span> <span class="nf">sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="s">"--ham--"</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">food</span>

<span class="n">sandwich</span><span class="p">()</span>
<span class="c">#outputs:</span>
<span class="c">##tomatoes#</span>
<span class="c">#&lt;/''''''\&gt;</span>
<span class="c"># --ham--</span>
<span class="c">#&lt;\______/&gt;</span>
<span class="c"># ~salad~</span>
</pre></div>


<p>Nobody wants a sandwich with tomato on the top and salad on the bottom. This demonstrates why you should not mix up the arrangement of the decorators; otherwise you'll pay the price. In our case we paid the price by ruining our beautiful sandwich.</p>
<p>I hope you learned something useful from this post! If there's any demand I will cover some more gotchas and features of decorators in the future. Please share your views in the comments below. If you have any suggestions, then please do tell me about them. You can also follow me on facebook, twitter, or you can send me an email. The links to my social media accounts are at the bottom of the post. Farewell, and don't forget to subscribe to my blog, tweet, and share this post on facebook.</p>
<footer class="post-info">
  <p>Tags: 
    <a href="../tag/decorator-pattern.html">decorator-pattern</a>
    <a href="../tag/decorators.html">decorators</a>
    <a href="../tag/design-patterns.html">design-patterns</a>
    <a href="../tag/patterns.html">patterns</a>
    <a href="../tag/programming.html">programming</a>
    <a href="../tag/python.html">python</a>
    <a href="../tag/python-decorators.html">python decorators</a>
  </p>

</footer>




    </div>
    </div></body></html>