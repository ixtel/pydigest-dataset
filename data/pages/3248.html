<html><body><div><div class="content_body" data-subscribe="true" data-view="content#body"><p>Though many <a href="https://www.toptal.com/django">Django Developers</a> might consider it blasphemous, sometimes it is actually necessary to deploy <a href="https://www.djangoproject.com/">Django</a> applications on Windows/IIS, especially when working with a client that has based its infrastructure around the Windows ecosystem. The “blasphemy” part comes from Django having really been targeted at the Unix environment, relying heavily on features like <a href="http://wsgi.readthedocs.org/en/latest/">WSGI</a>, <a href="http://www.fastcgi.com/drupal/">FastCGI</a>, and command-line tooling, all of which are foreign to Windows. Fortunately, Django/IIS compatibility is improving, thanks to the addition of features (which would otherwise be a kludge) on both the Windows and the Python+Django sides of the equation, thereby helping to resolve compatibility issues between these two disparate technical worlds.</p>

<p><img src="//assets.toptal.io/uploads/blog/image/847/toptal-blog-image-1423530232594.png" alt="Installing Django on IIS"/></p>

<p>This short, focused tutorial walks you through the basic setup of a Django project on Windows. It covers the installation of Python, Django, and related tools, including running the Django project both standalone and as a FastCGI server. The latter is increasingly important, incidentally, since <a href="http://www.iis.net/downloads/microsoft/fastcgi-for-iis">IIS now officially supports FastCGI</a> (on IIS 7+, simply install the CGI feature).</p>

<p><strong>Note:</strong> This tutorial is intended for those with a working understanding of Windows and who are familiar with the IIS management console. The version of IIS used in this tutorial is 8.5, but the descriptions and techniques are similar on earlier versions. The tutorial is based on Python 2.7 and Django 1.7, since those are the versions I use for my projects.
You can find another <a href="https://www.toptal.com/django/django-flask-and-redis-sharing-user-sessions-between-frameworks">Django tutorial here</a>.</p>

<blockquote>
  <p><strong>Pro tip:</strong> If you are going to deploy multiple Django (or even plain Python) projects, or if you are a developer, you should look at <a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">virtualenv</a>, a tool for creating isolated Python environments.</p>
</blockquote>

<h2 id="installing-python-on-windows">Installing Python on Windows</h2>

<p>First, <a href="https://www.python.org/downloads/release/python-279/">download Python</a>. Both 32-bit and 64-bit MSI installers are provided, and you should choose the one appropriate for the machine you are installing on.</p>



<div class="pop_out_box">

<p>The Basics of PIP</p>
<p>
PIP is the tool which installs and maintains Python libraries (of which Django is only one example). It is invoked by running the </p><span class="codeText">pip</span><p> command at the command prompt. It implements several sub-commands, and two of the most useful ones are </p><span class="codeText">install</span><p> and </p><span class="codeText">freeze</span><p>. PIP will also install project dependencies (additional libraries) are installed, should the project have any.
</p><p>
Running </p><span class="codeText">pip install &lt;package_name&gt;</span><p> will download and install the package and all of its dependencies (which may be nested and fairly complex). Running </p><span class="codeText">pip install --upgrade &lt;package_name&gt;</span><p> will likewise upgrade an existing package to its most recent version. PIP supports a special syntax for installing precise versions of a package instead of just "the most recent one". It is done by appending an operator and a version number to the package name; e.g. "Jinja2==2.7.3" (to install a precise version) or "six&gt;=1.8" (to install any version equal to or greater than the specified version number).
</p><p>
Running </p><span class="codeText">pip freeze</span><p> simply shows the list of currently installed packages in a format which is directly usable by </p><span class="codeText">pip install</span><p>.
</p><p>
Note that some Python / PIP packages come with libraries written in C, which must be compiled for the package to work. Unless you set up your system to have a working C compiler which is also compatible with the Python executables, you will not be able to install such packages. Django is a pure Python library so it does not require a C compiler to install.
</p></div>

<p><em>It’s important that you install Python 2.7.9 or later, since Python versions beginning with 2.7.9 include <a href="https://pip.pypa.io/en/latest/">PIP</a>, the Python library/package/software manager which is used to install everything else in this tutorial.</em></p>

<p>The installer process is very straightforward and simple. It will offer to install Python in the <code>C:\Python27</code> directory, which you should accept as it makes life easier afterwards. Try not to give in to the Windows habit of installing stuff in directories with spaces in their names.</p>

<p>The basic directory after installation will contain around 8 subdirectories, some miscellaneous files and two executables named <code>Python.exe</code> and <code>PythonW.exe</code>. The former is the default command-line interpreter and Python shell, while the latter is only the interpreter, which will not use (or spawn) a console window if invoked, and because of this is suitable for running GUI Python applications.</p>

<p>Next, Python should be added to the system’s PATH environment variable.  This is done in <em>Advanced System Settings</em> (or <em>System Properties</em>), in the <em>Advanced</em> tab, by clicking on the <em>Environment Variables</em> button.  There are two directories to be added: <code>C:\Python27</code> and <code>C:\Python27\Scripts</code>. These should be appended to the PATH list, separated by semicolons (<code>;</code>). The ending of your PATH variable should look like <code>;C:\Python27;C:\Python27\Scripts</code>.</p>

<blockquote>
  <p><strong>Pro tip:</strong> You may also want to install <a href="https://github.com/bmatzelle/gow">GOW</a>, a light-weight collection of Unix command-line utilities similar to Cygwin. It will provide you with tools such as <code>ls</code>, but also more interesting ones such as <code>make</code>, <code>wget</code>, <code>curl</code>, <code>ssh</code>, <code>scp</code>, <code>gzip</code> and <code>tar</code>.</p>
</blockquote>

<h2 id="installing-django-on-windows">Installing Django on Windows</h2>

<p>Django can be installed using PIP with a command such as <code>pip install django</code>. The process may pull in some additional dependencies if they are not already present on your system. Otherwise, it will simply install only Django, with output similar to the following:</p>

<pre><code>Downloading/unpacking django
Installing collected packages: django
Successfully installed django
Cleaning up...
</code></pre>

<p>You can check if both Python and Django for Windows are working by starting a new Windows Command Prompt, running the <code>python</code> command, and entering the <code>import django</code> command at the Python prompt.  If it works properly, there should be no output or messages after the <code>import django</code> command; i.e.:</p>

<pre><code>Python 2.7.9 (default, Dec 10 2014, 12:24:55) [MSC v.1500 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import django
&gt;&gt;&gt;
</code></pre>

<h2 id="installing-a-django-project-on-windows">Installing a Django project on Windows</h2>

<p>A Django “project” consists of one or more “apps”. A project’s top-level directory usually contains one special project subdirectory which contains settings and some general project-level information, one subdirectory per app, and a command-line script called <code>manage.py</code>. For example:</p>

<pre><code>C:\Devel\djangoproject\src&gt;dir
 Volume in drive C is OS
 Volume Serial Number is 6A3D-C1B8

 Directory of C:\Devel\djangoproject\src

22/12/2014  04:25    &lt;DIR&gt;          .
22/12/2014  04:25    &lt;DIR&gt;          ..
22/12/2014  04:19    &lt;DIR&gt;          project
22/12/2014  04:58    &lt;DIR&gt;          djangoapp
16/12/2014  03:30    &lt;DIR&gt;          templates
16/12/2014  00:50               250 manage.py
               1 File(s)            250 bytes
               5 Dir(s)  23,552,929,792 bytes free
</code></pre>

<p>Django projects can be simply distributed by archiving the entire project directory and decompressing it on another machine. In the example above, the project contains the <code>project</code> subdirectory, the application directory named <code>djangoapp</code>, and an auxiliary  <code>templates</code> subdirectory.</p>

<p>The <code>manage.py</code> script is the “swiss army knife” of Django applications.  It does everything from creating new apps, to database migrations, to running a test (embedded) HTTP server or even a FastCGI server.</p>

<h2 id="running-a-test-http-server">Running a test HTTP server</h2>

<p>If the project and its apps are functional, you should be able to start the default Django development-only HTTP server by running the command <code>manage.py runserver</code>, which should result in output similar to the following:</p>

<pre><code>C:\Devel\djangoproject\src&gt;manage.py runserver
Performing system checks...

System check identified no issues (0 silenced).
December 23, 2014 - 01:19:02
Django version 1.7.1, using settings 'project.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
</code></pre>

<p>As you can see from the messages, this starts a server on localhost, port 8000. You can access it immediately with your web browser.</p>

<h2 id="configuring-and-running-a-fastcgi-server">Configuring and running a FastCGI server</h2>

<p>A more interesting option is to enable a FastCGI server. With FastCGI, you can use IIS, Apache, or any other web server, to serve the application in a production setting. For this to work, you need to download the <a href="https://gist.github.com/antoinemartin">fcgi.py</a> (the Django management command to run Django on Windows with IIS through FastCGI) and put it into the <code>management/commands</code> subdirectory of the Django app’s (not the project’s!) subdirectory. Both the <code>management</code> and the <code>commands</code> subdirectories <strong>must</strong> have an empty file named <code>__init__.py</code> (which turn those directories into Python modules).</p>

<p><code>fcgi.py</code> is a very simple and minimalistic WSGI to FastCGI adapter that does <em>not</em> support listening on a TCP socket or a pipe, and does all its processing by using <code>stdin</code> and  stdout`. As such, it is not usable with modern web servers such as <a href="http://nginx.org/en/">nginx</a>, but <em>will</em> work with IIS.</p>

<h2 id="configuring-iis-to-run-a-fastcgi-application">Configuring IIS to run a FastCGI application</h2>

<p>If the FastCGI module is loaded in IIS (or simply the CGI module in IIS 7+), the IIS management console will have the “FastCGI Settings” icon available. Django is a framework which has its own URL routing, so Django apps must be installed as a “handler” in IIS for specific paths. To install a Django app on the IIS’s <em>Default Web Site</em>, select it in the management console, and open the <em>Handler mappings</em> configuration feature. In it, click on the <em>Add Module Mapping…</em> action, and enter the following information:</p>

<ul>
  <li><strong><em>Request path</em></strong>: Set it to <code>\*</code> to handle all requests with internal Django routing</li>
  <li><strong><em>Module</em></strong>: Set it to <code>FastCgiModule</code> to use the IIS’ FastCGI module</li>
  <li><strong><em>Executable</em></strong>: Here, both the <code>python.exe</code> path and its command line arguments need to be set, using the pipe character (<code>|</code>) as a separator. An example value for this setting is: <code>C:\Python27\python.exe|C:\app\src\manage.py fcgi --pythonpath C:\app\src --settings project.settings</code>. Note that you need to specify the <code>fcgi</code> command for the <code>manage.py</code> script, and manually set the Python interpreter’s search path for the project, as well as the Python module name for the project’s setting module.</li>
  <li><strong><em>Name</em></strong>: You can set this to whatever you like.</li>
</ul>

<p>Your configuration dialog should look something like this:</p>

<p><img src="//assets.toptal.io/uploads/blog/image/837/toptal-blog-image-1423099177763.png" alt="iis configuration dialog"/></p>

<p>Next, click the <em>Request restrictions</em> button and edit the <em>Mapping</em> tab. Uncheck the “Invoke handler only if the request is mapped to…” checkbox (otherwise, IIS will have problems mapping what it thinks are subdirectories in the URL request):</p>

<p><img src="//assets.toptal.io/uploads/blog/image/838/toptal-blog-image-1423099197810.png" alt="request restrictions"/></p>

<p>Click OK on the handler information dialog.  IIS will then ask you to confirm the creation of a matching FastCGI application entry which you will need to confirm. This entry will be visible in the <em>FastCGI Settings</em> feature, accessible at the root screen of the IIS Management Console. The default entry created by IIS itself is adequate, but there are some optional settings available which you may want to take advantage of:</p>

<ul>
  <li><strong><em>Max instances</em></strong>: The approach we’re employing for running FastCGI applications is single-process, single-threaded, meaning that a separate Python interpreter process will be started for each <em>simultaneous</em> request. This setting limits the number of simultaneous Django app instances.</li>
  <li><strong><em>Monitor changes to file</em></strong>: By default, once started, the app processes will be active either until manually shut down, or until they handle <em>Instance MaxRequest</em> requests. By using this setting, IIS will monitor a timestamp of an arbitrary file, and if it changes, it will stop and reload app instances. This is convenient both for developers and for production environments, as it allows apps to be reloaded when changed. The “monitor a file’s timestamp for a reload indicator” is a fairly strange concept on Windows, but it’s normal in Unix-like environments, and so it was carried over here with FastCGI.</li>
</ul>

<p><img src="//assets.toptal.io/uploads/blog/image/839/toptal-blog-image-1423099216110.png" alt="add FastCGI application"/></p>



<p>Modern web applications use multiple resource files, such as CSS, JavaScript and others, and Django apps are no exception. Django provides for a very convenient feature which allows developers to integrate the needed resources into the application directory tree, but which can be extracted and copied by Django into a proper, static directory. This is basically a developer-controlled feature, and the locations where Django will store the static files is controlled in the project’s <code>settings.py</code>. Well-behaved projects will use a reasonably sane path for this, but it is not standardized.</p>

<p>Apps which handle uploaded files store them in a similarly-managed directory which, in Django, is traditionally named <code>media</code>. The <code>static</code> and <code>media</code> directories need to be added to the IIS configuration as virtual directories:</p>

<p><img src="//assets.toptal.io/uploads/blog/image/840/toptal-blog-image-1423099233874.png" alt="Configuring the static resource and media directories"/></p>

<p>The important step here is to reconfigure the <em>Handler Mappings</em> feature for each of the directories and remove the Django App handler, leaving the <code>StaticFile</code> handler as the most important one.</p>

<p>Note that the <code>static</code> directory must be readable by IIS (as well as all other files and directories in the Django project), but the <code>media</code> directory must also be writable by IIS. The final site configuration should resemble the following:</p>

<p><img src="//assets.toptal.io/uploads/blog/image/841/toptal-blog-image-1423099250511.png" alt="iis site configuration example"/></p>

<h2 id="a-note-about-databases">A note about databases</h2>

<p><a href="http://www.sqlite.org/">SQLite</a> works by default on Windows, as it does on Unix-like systems. Most of the other open source databases now work on Windows, even <a href="http://www.postgresql.org/">PostgreSQL</a>, which I recommend. On existing Windows installations, though, there could be a requirement to deploy Django with the MS SQL Server. This is possible either by using an <a href="https://code.google.com/p/django-pyodbc/">ODBC bridge driver</a> or by using a <a href="https://bitbucket.org/Manfre/django-mssql/">native MS SQL driver</a>. In theory, both work, but I haven’t tested them. At least the database connection parameters (in the project’s <code>settings.py</code> file) need to be changed to switch to a new database. Data migration needs to be done manually.</p>

<p>Note that if using the SQLite database, both the database file and the directory where it is located need to be writable by IIS.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>The described configuration is tested and proven to work, but if something goes wrong, here are some basic steps for troubleshooting your Django for Windows install:</p>

<ol>
  <li>Try starting the FastCGI command line yourself. This is the command configured in the <em>FastCGI Settings</em> and which must match the one configured in <em>Handler Mappings</em> for the site.</li>
  <li>Install the <a href="http://www.iis.net/learn/develop/runtime-extensibility/how-to-add-tracing-to-iis-managed-modules">Tracing feature for IIS</a>, then configure it for the Django site in <em>Failed Request Tracing Rules</em> to trace all content (<em>), the status code “500” and the event severity “Error”. The traces will be available as XML files (with attached XSLT) in the     IIS’s <code>C:\inetpub\logs\FailedReqLogFiles</code> directory (or a similar one, depending on your configuration). You then need to enable tracing for the particular web site (or a virtual directory) in the *Configure-&gt;Failed request tracing…</em> action.</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>To be sure, Django is tailored for a Unix-like environment, and the most wide-spread and supported way of running Django is on a Linux system (e.g., with uwsgi and nginx).</p>

<p>Yet it doesn’t take much work to make Django run on Windows, as shown in this tutorial. Some of the steps described may seem counter-intuitive from a pure Windows perspective, but they are necessary and, fortunately, the effort spent in the configuration is one-time only. Once configured, the Django application should then behave in much the same way that it would on a Linux platform.</p>
<div class="blog_author_big_banner is-active" data-ga-action="ClickedOnHireTheAuthor_bottom" data-ga-label="installing-django-on-iis-a-step-by-step-tutorial" data-view="content#bottom_banner"><h2>About the author</h2><div class="skill_talent for-blog_post"><div class="skill_talent-main"><a class="link skill_talent-name" href="/resume/ivan-voras">Ivan Voras, Croatia</a><div class="clearfix"><p class="skill_talent-member_since">member since June 18, 2014</p></div><div class="skill_talent-description"><p>Ivan is primarily a back-end developer with 10+ years of experience in architecting and implementing server-side solutions, including non-web-related distributed platforms such as Bitcoin, chat servers, and general client-server solutions. He has handled DBA operations, developed modules for PostgreSQL, operating system kernel modules (FreeBSD), and new algorithms. He is interested in general client-server problems and distributed apps. </p><a class="link" href="/resume/ivan-voras">[click to continue...]</a></div></div></div></div><p class="template" data-role="subscribe_template" data-template="{&quot;html&quot;:&quot;\u003cdiv class=\&quot;embeddable_form-wrapper\&quot; data-view=\&quot;blog_subscribe#form\&quot;\u003e\u003cform action=\&quot;/blog/subscription\&quot; class=\&quot;embeddable_form for-post\&quot; data-entity=\&quot;blog_subscription\&quot; data-remote=\&quot;\&quot; data-view=\&quot;form#form\&quot; method=\&quot;post\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-step is-email_form is-current\&quot; data-role=\&quot;step\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-row is-label\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-label_title\&quot;\u003eLike what you\u0026#39;re reading?\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-label\&quot;\u003eGet the latest updates first.\u003c/div\u003e\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-row form-field is-email_field\&quot;\u003e\u003cinput autocomplete=\&quot;off\&quot; class=\&quot;input is-medium\&quot; data-role=\&quot;email\&quot; name=\&quot;blog_subscription[email]\&quot; placeholder=\&quot;Enter your email address...\&quot; type=\&quot;text\&quot; /\u003e\u003cinput name=\&quot;blog_subscription[vertical]\&quot; type=\&quot;hidden\&quot; value=\&quot;developers\&quot; /\u003e\u003cinput name=\&quot;from_widget\&quot; type=\&quot;hidden\&quot; value=\&quot;true\&quot; /\u003e\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-row is-submit\&quot;\u003e\u003cinput class=\&quot;button is-green_candy is-default is-full_width\&quot; data-loader-text=\&quot;Subscribing...\&quot; data-role=\&quot;submit\&quot; type=\&quot;submit\&quot; value=\&quot;Get Exclusive Updates\&quot; /\u003e\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-row is-privacy\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-privacy\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-privacy_icon\&quot;\u003e\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-privacy_text\&quot;\u003eNo spam. Just great engineering and design posts.\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-step is-confirmation\&quot; data-role=\&quot;step\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-row is-label is-success\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-label_title\&quot;\u003eLike what you\u0026#39;re reading?\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-label\&quot;\u003eGet the latest updates first.\u003c/div\u003e\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-row is-success\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-label is-header\&quot;\u003eThank you for subscribing!\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-label\&quot;\u003eYou can edit your subscription preferences \u003ca href='#' data-role='preferences_link'\u003ehere\u003c/a\u003e.\u003c/div\u003e\u003c/div\u003e\u003cdiv class=\&quot;embeddable_form-row is-success\&quot;\u003e\u003cdiv class=\&quot;embeddable_form-done\&quot;\u003e\u003cul class=\&quot;blog_follow_us\&quot;\u003e\u003cul class=\&quot;social_share\&quot;\u003e\u003cli class=\&quot;social_share-item is-facebook\&quot;\u003e\u003cdiv class=\&quot;fb-like\&quot; data-href=\&quot;https://www.toptal.com/blog\&quot; data-layout=\&quot;button_count\&quot; data-send=\&quot;false\&quot; data-show-faces=\&quot;false\&quot; data-width=\&quot;450\&quot;\u003e\u003c/div\u003e\u003c/li\u003e\u003cli class=\&quot;social_share-item is-twitter_follow\&quot;\u003e\u003ca class=\&quot;twitter-follow-button\&quot; data-show-count=\&quot;true\&quot; href=\&quot;https://twitter.com/toptalllc\&quot;\u003eFollow @toptalllc\u003c/a\u003e\u003c/li\u003e\u003cli class=\&quot;social_share-item is-google_plus_follow\&quot;\u003e\u003cdiv class=\&quot;g-follow\&quot; data-annotation=\&quot;bubble\&quot; data-height=\&quot;20\&quot; data-href=\&quot;https://plus.google.com/109028009576318848424\&quot; data-rel=\&quot;publisher\&quot;\u003e\u003c/div\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/form\u003e\u003c/div\u003e&quot;}"/></div></div></body></html>