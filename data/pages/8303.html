<html><body><div><div id="usage">
<h2>Usage</h2>
<p>The C extension module follows closely the C API (see <tt>add_key(2)</tt>,
<tt>request_key(2)</tt>, <tt>keyctl_read_alloc(2)</tt>).</p>
<p>Exceptions also follow the C API. The only notable difference is for
<tt>request_key</tt>: when the key is not present, <tt>None</tt> is returned, instead of
raising an exception (which is usually a more expensive operation).</p>
<p>Note that the function parameters are passed as bytes not strings! On python 3
this usually requires an explicit <tt>param.encode()</tt> call.</p>
<p>For example:</p>
<pre><span class="kn">import</span> <span class="nn">keyutils</span>

<span class="c1"># NOTE: only pass `bytes` to the keyutils API:</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'foo'</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">b</span><span class="s1">'bar'</span>
<span class="n">ring</span> <span class="o">=</span> <span class="n">keyutils</span><span class="o">.</span><span class="n">KEY_SPEC_PROCESS_KEYRING</span>

<span class="n">key_id</span> <span class="o">=</span> <span class="n">keyutils</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">keyutils</span><span class="o">.</span><span class="n">request_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span> <span class="o">==</span> <span class="n">key_id</span>
<span class="k">assert</span> <span class="n">keyutils</span><span class="o">.</span><span class="n">read_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span>

<span class="c1"># set timeout to 5 seconds, wait and thenâ€¦ it's gone:</span>
<span class="n">keyutils</span><span class="o">.</span><span class="n">set_timeout</span><span class="p">(</span><span class="n">key_id</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">keyutils</span><span class="o">.</span><span class="n">request_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span> <span class="o">==</span> <span class="bp">None</span>
</pre>
<p>Further examples can be found in the <tt>tests</tt> subfolder.</p>
</div>


</div></body></html>