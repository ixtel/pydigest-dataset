<html><body><div><div class="entry-content">
        <p>There are three types of model relationships that Django provides: many-to-one,
many-to-many and one-to-one. In the following post I intend to make a case for
adding a one-to-many relationship to this list.</p>

<p>Obviously, the immediate opposition to this proposal is that all relationships
in Django are provided in a two-way manner (via <code>related_name</code>), so there’s no
need for it. Let’s take a look at two reasons why I think this new relationship
is called for.</p>

<h1>Semantics</h1>

<p>The many-to-one relationship that Django provides is <code>ForeignKey</code>. A foreign
key is always declared on the “one” side of the relationship, e.g., if you have
a <code>Band</code> model and each <code>Band</code> has several <code>Musician</code> models related to it,
then you would put a <code>ForeignKey</code> in the <code>Musician</code> model like so:</p>

<figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">Band</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Musician</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ..</span>
</span><span class="line"><span class="err">    </span><span class="n">band</span> <span class="o">=</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Band</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"members"</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This way, every musician has a band related to it, and bands may have musicians
related to them, but this is the wrong way around! Musicians exist without
bands. Some are in bands, some aren’t. Even those who are in a band aren’t
defined by it. However, a band is determined by its members. A band without
members cannot exist. So, there’s a semantic issue here. Therefore, I suggest
the following syntax:</p>

<figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">Band</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line"><span class="err">    </span><span class="n">members</span> <span class="o">=</span> <span class="n">OneToMany</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Musician</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Musician</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ..</span>
</span></code></pre></td></tr></table></div></figure>


<p>This way – every band has musicians. Musicians may be in bands, but not
necessarily. And, and this is the difference between the proposed <code>OneToMany</code>
and the already-existing <code>ManyToMany</code>, each musician is in only one band.</p>

<h1>Readability</h1>

<p>Let’s toss some more models into the mix. Suppose we have music agents and each
one of them has musicians as clients. Perhaps we also have different musician
unions. Using <code>ForeignKey</code> again, it’ll look like this:</p>

<figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">Band</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Union</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Musician</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ..</span>
</span><span class="line"><span class="err">    </span><span class="n">band</span> <span class="o">=</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Band</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"members"</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line"><span class="err">    </span><span class="n">agent</span> <span class="o">=</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Agent</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"clients"</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line"><span class="err">    </span><span class="n">union</span> <span class="o">=</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Union</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"members"</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, for <code>Agent</code> and <code>Union</code> (like <code>Band</code> before), it’s confusing that a
required piece of information about them is defined elsewhere, while in
<code>Musician</code> there are so many optional members that clutter up what’s important
about the musician. Here’s how it’ll look like with <code>OneToMany</code> relationships:</p>

<figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">Band</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line"><span class="err">    </span><span class="n">members</span> <span class="o">=</span> <span class="n">OneToMany</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Musician</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line"><span class="err">    </span><span class="n">clients</span> <span class="o">=</span> <span class="n">OneToMany</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Musician</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Union</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ...</span>
</span><span class="line"><span class="err">    </span><span class="n">members</span> <span class="o">=</span> <span class="n">OneToMany</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">Musician</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Musician</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line"><span class="err">    </span><span class="c"># ..</span>
</span></code></pre></td></tr></table></div></figure>


<p>Every model contains all of its required information and at the same time they
are not cluttered with a bunch of optional members. With <code>ForeignKey</code>, the more
“musician groups” we have, the more clutter is gathered in the <code>Musician</code>
model.  So OneToMany helps keep the information where it has the most meaning
to you, the programmer.</p>

<h1>Extensibility</h1>

<p>The previous example also suggests another advantage of the relationship. When
working with an already-existing model, both <code>OneToOne</code> and <code>ManyToMany</code>
relationships allow us to add information to that model without altering its
source code. However, when adding a many-to-one relationship, you must always
place the ForeignKey in the “one” side, which may be a model which you can’t
change, for any number of reasons (e.g., working with a library, or working
with code that is common to several applications). The OneToMany relationship
allows us to break that barrier.</p>

    </div>


</div></body></html>