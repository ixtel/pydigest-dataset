<html><body><div><div class="article__body">
      <p>Bokeh is quickly proving to be the easiest plotting toolkit for web-enabled graphs. Continuum recently released version 0.2 , with 0.3 coming shortly. One of the distinguishing features of Bokeh compared to other web-based plotting toolkits is that streaming, as a feature, is not an afterthought. Animated as well as streaming realtime plots on the web should be nearly as easy as static plots — and with Bokeh, it really is that easy. It’s good to remind yourself that Bokeh is built with Python as a first-class citizen — in other words, all of the plotting commands are in Python and NOT Javascript. Bokeh is open-source and <a href="http://bokeh.pydata.org/">our documentation</a> has loads of beautiful interactive plots.</p><h2>The Physical World and Realtime Plotting</h2><p>In this post I’m going to show you a few of the fun and exciting things that can be done with Bokeh. Given the recent <a href="http://makerfaire.com/">MakerFaire</a> events in New York and Italy, I thought it would be fun to bring a bit of hardware into the mix rather than simply <em>simulate</em> streaming data. I decided to incorporate some <a href="http://en.wikipedia.org/wiki/Xbee">XBee Modules</a>, which are wireless devices popular among hardware enthusiasts and wireless sensor network (WSN) developers.</p><p><img alt="Hardware" title="Hardware" class="media-element file-default" typeof="foaf:Image" src="/sites/default/files/xbee_hardware.jpg"/></p><p>I set up a WSN with two XBees: one acts as the base station and the second is a mobile unit. The base station records the signal strength (RSSI) of the incoming packets from the mobile unit and dumps the data into a database. The closer the mobile unit is to the base station, the stronger the signal will be. I recorded several minutes of myself (with the mobile unit attached) running around the base station in order to generate a wide landscape of values. My plotting script can then ask for the last X points of data or a slice of rows within the DB.</p><h2>Bokeh Plotting</h2><p>After pulling the data, plotting a line plot should be quite familiar to other plotting libraries.</p><figure>
<pre>line(x,rssi, color="#0000FF", x_axis_type = "datetime", 
    tools="pan,zoom,resize", width=1200,height=300, 
    title = 'Streaming RSSI Values',
    legend='XBee %s Raw' % (xbee_id))
 
xaxis()[0].axis_label = "Time"
yaxis()[0].axis_label = "Signal Strength"
</pre>
 
<figcaption>Python</figcaption></figure>
<p>Below is a screenshot—you can see that the while signal is noisy, the farther the mobile unit is from the base station, the smaller the signal strength is:</p>
<p><img alt="Static Bokeh RSSI Plot" title="Static Bokeh RSSI Plot" class="media-element file-default" typeof="foaf:Image" src="/sites/default/files/xbee_rssi.png"/></p>
<p>I’ve added a few other plot elements in addition to plotting the data (x,rssi): height/width, title, legend, and pan/zoom/resize (more on this later)</p>
<p>The above plot is merely an image. But because Bokeh is a <em>web-enabled</em> plotting toolkit, if I render my plot in Bokeh I can interact with my data in exciting and novel ways. Below is the sample plot above but rendered with Bokeh:</p>
<p/>
<p>You can manipulate this plot: zooming, panning, and resizing all in the browser! To achieve this level of interactivity, I added the additional arguments to the line function<code>tools="pan,zoom,resize"</code>. Bokeh gives us the option of saving a single plot as an HTML file OR we can output an embeddable javascript plot:</p>
<figure>
<pre>line_snippet =  line_plot.inject_snippet()
print line_snippet
'''
&lt;script src="xbee_plot.embed.js" bokeh_plottype="embeddata" bokeh_modelid="xbee_plot" bokeh_modeltype="Plot" async="true"&gt;&lt;/script&gt;
'''
</pre>
 
<figcaption>Python</figcaption></figure>
<p>The above code delivers a javascript file which we can embed in a webpage (as I am doing here), an example HTML file with the Javascript called, and a printout of the appropriate code snippet for later use. Again, this is all done with Python!</p>
<h2>Painless Realtime Plotting</h2>
<p>Lastly, with Bokeh we can easily animate our plot and view the RSSI signal in realtime. For this we will need a server — and luckily enough, Bokeh ships with its own server. Calling<code>bokeh-server</code> instantiates everything we need to serve up streaming plots.</p>
<figure>
<pre>#Code will be significantly simplified in the 0.4 release
import time
from bokeh.objects import GlyphRenderer
renderer = [r for r in curplot().renderers if isinstance(r, GlyphRenderer)][0]
ds = renderer.data_source
while True:
    df = pd.io.json.read_json(url+json_call)
    ds.data["x"] = x+N*i
    ds.data["y"] = df.rssi
    ds._dirty = True
    session().store_obj(ds)
    time.sleep(1.5)
    i+=1
</pre>
 
<figcaption>Python</figcaption></figure>
<p>With less than 15 lines of code, we’ve animated the plot and can serve it on the web. Below is a captured GIF and you can also see the <a href="http://162.243.82.136:5006/bokeh/">plots live here</a>. <strong>Note: more streaming/animation improvements are coming in 0.4 release</strong></p>
<p><img alt="Bokeh GIF RSSI Plot" title="Bokeh GIF RSSI Plot" class="media-element file-default" typeof="foaf:Image" src="/sites/default/files/rssi_out.gif"/></p>
<h2>Code and Install</h2>
<p>The example code can be found in <a href="https://github.com/quasiben/bokeh_examples">my xbee-bokeh example repository</a> and installing dependencies can either be done through conda or pip. For use with a <a href="http://www.raspberrypi.org/">Raspberry Pi</a> or<a href="http://www.raspberrypi.org/">BeagleBone</a> download the <a href="http://repo.continuum.io/miniconda/">minimal anaconda installer</a> for ARM architectures.</p>
<p>Conda is quite easy — simply add the following Anaconda.org channels to your .condarc file:</p>
<ul><li>https://conda.anaconda.org/quasiben</li><li>https://conda.anaconda.org/asmeurer</li></ul>
<p>Then create an new environment:</p>
<p><code>conda create -n bokeh_rssi python=2.7 pip sqlite pyserial xbee flask-restful bokeh</code></p>
<p>Similarly, pip can also install all the necessary packages.</p>
<h2>Pushing Ahead</h2>
<p>Interactivity through the web is more than just a novel feature. For many, it means changing their entire workflow. If I no longer have to take/generate a snapshot, this means my colleagues and collaborators can see analysis as it happens — no photo uploads or emails of static plots. And, as the data changes the plots similarly should update as well. Additionally, building a tool with the Python analyst/developer as our target audience means not having to reach for another language and stack of technologies to learn and manage.</p>
<p><a href="http://bokeh.pydata.org/">Bokeh</a> is open source and fully supported by <a href="/">Continuum Analytics</a>. </p>  </div>

        
  
</div></body></html>