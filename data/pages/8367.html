<html><body><div><article class="markdown-body entry-content" itemprop="text"><p><a href="https://camo.githubusercontent.com/4657e3077c256dd46330cba412b8cac9e5877f05/68747470733a2f2f692e696d6775722e636f6d2f33786a496e4f442e706e67" target="_blank"><img src="https://camo.githubusercontent.com/4657e3077c256dd46330cba412b8cac9e5877f05/68747470733a2f2f692e696d6775722e636f6d2f33786a496e4f442e706e67" alt="Maltrail" data-canonical-src="https://i.imgur.com/3xjInOD.png"/></a></p>

<p><a href="https://api.travis-ci.org/stamparm/maltrail"><img src="https://camo.githubusercontent.com/9b2728f242a993aaad640984b5f322efdd6f8818/68747470733a2f2f6170692e7472617669732d63692e6f72672f7374616d7061726d2f6d616c747261696c2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://api.travis-ci.org/stamparm/maltrail.svg?branch=master"/></a> <a href="https://www.python.org/"><img src="https://camo.githubusercontent.com/72899da19fbd391d48b4c14804344662b0ed56de/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d322e36253743322e372d79656c6c6f772e737667" alt="Python 2.6|2.7" data-canonical-src="https://img.shields.io/badge/python-2.6%7C2.7-yellow.svg"/></a> <a href="https://github.com/stamparm/maltrail#license"><img src="https://camo.githubusercontent.com/b5f801688d063570e28501a05ca6e0bef0bbefaa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d7265642e737667" alt="License" data-canonical-src="https://img.shields.io/badge/license-MIT-red.svg"/></a> <a href="https://twitter.com/maltrail"><img src="https://camo.githubusercontent.com/dd1b2e663f384416f6dd18fc3f8094479d56b928/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f747769747465722d406d616c747261696c2d626c75652e737667" alt="Twitter" data-canonical-src="https://img.shields.io/badge/twitter-@maltrail-blue.svg"/></a></p>

<h2><a id="user-content-content" class="anchor" href="#content" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Content</h2>



<h2><a id="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Introduction</h2>

<p><strong>Maltrail</strong> is a malicious traffic detection system, utilizing publicly available (black)lists containing malicious and/or generally suspicious trails, along with static trails compiled from various AV reports and custom user defined lists, where trail can be anything from domain name (e.g. <code>zvpprsensinaix.com</code> for <a href="http://www.johannesbader.ch/2015/02/the-dga-of-banjori/">Banjori</a> malware), URL (e.g. <code>http://109.162.38.120/harsh02.exe</code> for known malicious <a href="https://www.virustotal.com/en/file/61f56f71b0b04b36d3ef0c14bbbc0df431290d93592d5dd6e3fffcc583ec1e12/analysis/">executable</a>), IP address (e.g. <code>185.130.5.231</code> for known attacker) or HTTP User-Agent header value (e.g. <code>sqlmap</code> for automatic SQL injection and database takeover tool). Also, it uses (optional) advanced heuristic mechanisms that can help in discovery of unknown threats (e.g. new malware).</p>

<p><a href="https://camo.githubusercontent.com/0038e0fd9c97e8a8552dac8c048e3efdce49afbe/68747470733a2f2f692e696d6775722e636f6d2f53643965716f612e706e67" target="_blank"><img src="https://camo.githubusercontent.com/0038e0fd9c97e8a8552dac8c048e3efdce49afbe/68747470733a2f2f692e696d6775722e636f6d2f53643965716f612e706e67" alt="Reporting tool" data-canonical-src="https://i.imgur.com/Sd9eqoa.png"/></a></p>

<p>The following (black)lists (i.e. feeds) are being utilized:</p>

<pre><code>alienvault, autoshun, badips, bambenekconsultingc2dns,
bambenekconsultingc2ip, bambenekconsultingdga, bitcoinnodes,
blocklist, botscout, bruteforceblocker, ciarmy, cruzit,
cybercrimetracker, deepviz, dragonresearchgroupssh,
dragonresearchgroupvnc, dshielddns, dshieldip, emergingthreatsbot,
emergingthreatscip, emergingthreatsdns, feodotrackerdns,
malwaredomainlist, malwaredomains, malwarepatrol, maxmind, myip,
nothink, openbl, openphish, packetmailcarisirt,
packetmailramnode, palevotracker, policeman, proxylists,
proxyrss, proxy, riproxies, rutgers, sblam,
securityresearch, snort, socksproxy, sslipbl, sslproxies,
torproject, torstatus, turris, urlvir, voipbl, vxvault,
zeustrackerdns, zeustrackerip, zeustrackermonitor, zeustrackerurl,
etc.
</code></pre>

<p>As of static entries, the trails for the following malicious entities (e.g. malware C&amp;Cs or sinkholes) have been manually included (from various AV reports and personal research):</p>

<pre><code>adwind, alienspy, alureon, android_adrd, android_alienspy,
android_arspam, android_backflash, android_basebridge,
android_chuli, android_claco, android_coolreaper,
android_counterclank, android_cyberwurx, android_dendoroid,
android_dougalek, android_droidkungfu, android_enesoluty,
android_ewalls, android_exprespam, android_fakebanco,
android_fakedown, android_fakelog, android_fakemart,
android_fakemrat, android_fakeneflic, android_fakesecsuit,
android_feabme, android_flexispy, android_frogonal,
android_geinimi, android_ghostpush, android_gmaster,
android_godwon, android_golddream, android_gonesixty,
android_ibanking, android_kemoge, android_lockdroid,
android_lovetrap, android_maistealer, android_maxit,
android_oneclickfraud, android_opfake, android_ozotshielder,
android_pikspam, android_pjapps, android_qdplugin,
android_repane, android_roidsec, android_samsapo,
android_sandorat, android_selfmite, android_simplocker,
android_skullkey, android_spytekcell, android_stealer,
android_stels, android_teelog, android_tetus, android_tonclank,
android_uracto, android_usbcleaver, android_walkinwat,
android_windseeker, android_zertsecurity, angler, aridviper,
axpergle, babar, balamid, bamital, bankapol, bankpatch,
bayrob, bedep, black_vine, bubnix, carbanak, careto,
casper, chekua, chewbacca, cleaver, conficker, corebot,
cosmicduke, couponarific, crilock, cryptolocker, cryptowall,
ctblocker, cutwail, darkhotel, defru, desertfalcon,
destory, dorifel, dorkbot, dridex, dukes, dursg,
dyreza, elf_aidra, elf_billgates, elf_darlloz, elf_ekoms,
elf_fysbis, elf_groundhog, elf_hacked_mint, elf_mayhem,
elf_mokes, elf_pinscan, elf_rekoobe, elf_shelldos,
elf_sshscan, elf_themoon, elf_turla, elf_xnote, elf_xorddos,
emotet, equation, evilbunny, expiro, fakeran, fareit,
fbi_ransomware, fiexp, fignotok, fin4, finfisher,
gamarue, gauss, generic, gozi, helompy, htran,
immortal, ios_keyraider, ios_muda, ios_oneclickfraud,
ios_specter, jenxcus, kegotip, kolab, kovter, lollipop,
lotus_blossom, luckycat, mariposa, miniduke, modpos,
nbot, nettraveler, neurevt, nitol, nivdort, nonbolqu,
nuqel, nwt, nymaim, onkods, osx_wirelurker, palevo,
pdfjsc, pift, plugx, ponmocup, powelike, proslikefan,
pushdo, ramnit, ransirac, reactorbot, redoctober,
renocide, reveton, russian_doll, sality, sathurbot,
scieron, seaduke, sefnit, shifu, shylock, siesta,
simda, sinkhole_1and1, sinkhole_abuse, sinkhole_arbor,
sinkhole_blacklab, sinkhole_blacklistthisdomain,
sinkhole_botnethunter, sinkhole_certpl, sinkhole_checkpoint,
sinkhole_conficker, sinkhole_cryptolocker, sinkhole_drweb,
sinkhole_dynadot, sinkhole_dyre, sinkhole_farsight,
sinkhole_fbizeus, sinkhole_fitsec, sinkhole_fnord,
sinkhole_fsecure, sinkhole_fsi, sinkhole_gameoverzeus,
sinkhole_georgiatech, sinkhole_gladtech, sinkhole_haiyao,
sinkhole_kaspersky, sinkhole_malwaredns, sinkhole_microsoft,
sinkhole_shadowserver, sinkhole_sidnlabs, sinkhole_sinkdns,
sinkhole_sugarbucket, sinkhole_unknown, sinkhole_xaayda,
sinkhole_zinkhole, skynet, skyper, smsfakesky, snake,
snifula, sockrat, sofacy, sohanad, stuxnet, teamspy,
teerac, teslacrypt, themida, tinba, torpig,
torrentlocker, unruy, upatre, utoti, vawtrak, virut,
vittalia, vobfus, volatile_cedar, vundo, waterbug,
xcodeghost, zeroaccess, zeus, zlob, etc.
</code></pre>

<h2><a id="user-content-architecture" class="anchor" href="#architecture" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Architecture</h2>

<p>Maltrail is based on the <strong>Traffic</strong> -&gt; <strong>Sensor</strong> &lt;-&gt; <strong>Server</strong> &lt;-&gt; <strong>Client</strong> architecture. <strong>Sensor</strong>(s) is a standalone component running on the monitoring node (e.g. Linux platform connected passively to the SPAN/mirroring port or transparently inline on a Linux bridge) or at the standalone machine (e.g. Honeypot) where it "monitors" the passing <strong>Traffic</strong> for blacklisted items/trails (i.e. domain names, URLs and/or IPs). In case of a positive match, it sends the event details to the (central) <strong>Server</strong> where they are being stored inside the appropriate logging directory (i.e. <code>LOG_DIR</code> described in the <em>Configuration</em> section). If <strong>Sensor</strong> is being run on the same machine as <strong>Server</strong> (default configuration), logs are stored directly into the local logging directory. Otherwise, they are being sent via UDP messages to the remote server (i.e. <code>LOG_SERVER</code> described in the <em>Configuration</em> section).</p>

<p><a href="https://camo.githubusercontent.com/b78aaabd05a3b32d759e34c47ec7777364b296d1/68747470733a2f2f692e696d6775722e636f6d2f324950394d68322e706e67" target="_blank"><img src="https://camo.githubusercontent.com/b78aaabd05a3b32d759e34c47ec7777364b296d1/68747470733a2f2f692e696d6775722e636f6d2f324950394d68322e706e67" alt="Architecture diagram" data-canonical-src="https://i.imgur.com/2IP9Mh2.png"/></a></p>

<p><strong>Server</strong>'s primary role is to store the event details and provide back-end support for the reporting web application. In default configuration, server and sensor will run on the same machine. So, to prevent potential disruptions in sensor activities, the front-end reporting part is based on the <a href="https://en.wikipedia.org/wiki/Fat_client">"Fat client"</a> architecture (i.e. all data post-processing is being done inside the client's web browser instance). Events (i.e. log entries) for the chosen (24h) period are transferred to the <strong>Client</strong>, where the reporting web application is solely responsible for the presentation part. Data is sent toward the client in compressed chunks, where they are processed sequentially. The final report is created in a highly condensed form, practically allowing presentation of virtually unlimited number of events.</p>

<p>Note: <strong>Server</strong> component can be skipped altogether, and just use the standalone <strong>Sensor</strong>. In such case, all events would be stored in the local logging directory, while the log entries could be examined either manually or by some CSV reading application.</p>

<h2><a id="user-content-quick-start" class="anchor" href="#quick-start" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Quick start</h2>

<p>The following set of commands should get your Maltrail <strong>Sensor</strong> up and running (out of the box with default settings and monitoring interface "any"):</p>

<pre><code>sudo apt-get install python-pcapy
git clone https://github.com/stamparm/maltrail.git
cd maltrail
sudo python sensor.py
</code></pre>

<p><a href="https://camo.githubusercontent.com/0447a8d0dd710415cb0fb5a446ff6973798d3802/68747470733a2f2f692e696d6775722e636f6d2f4539747432656b2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/0447a8d0dd710415cb0fb5a446ff6973798d3802/68747470733a2f2f692e696d6775722e636f6d2f4539747432656b2e706e67" alt="Sensor" data-canonical-src="https://i.imgur.com/E9tt2ek.png"/></a></p>

<p>To start the (optional) <strong>Server</strong> on same machine, open a new terminal and execute the following:</p>

<pre><code>[[ -d maltrail ]] || git clone https://github.com/stamparm/maltrail.git
cd maltrail
python server.py
</code></pre>

<p><a href="https://camo.githubusercontent.com/d8f441f0add56871802f12939be78f2eccbb606e/68747470733a2f2f692e696d6775722e636f6d2f6c6f47573647412e706e67" target="_blank"><img src="https://camo.githubusercontent.com/d8f441f0add56871802f12939be78f2eccbb606e/68747470733a2f2f692e696d6775722e636f6d2f6c6f47573647412e706e67" alt="Server" data-canonical-src="https://i.imgur.com/loGW6GA.png"/></a></p>

<p>To test that everything is up and running execute the following:</p>

<pre><code>ping -c 1 136.161.101.53
cat /var/log/maltrail/$(date +"%Y-%m-%d").log
</code></pre>

<p><a href="https://camo.githubusercontent.com/ed161cf167b84bd629c1c6c985ddba5698018c42/68747470733a2f2f692e696d6775722e636f6d2f4e594a67364b6c2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/ed161cf167b84bd629c1c6c985ddba5698018c42/68747470733a2f2f692e696d6775722e636f6d2f4e594a67364b6c2e706e67" alt="Test" data-canonical-src="https://i.imgur.com/NYJg6Kl.png"/></a></p>

<p>Access the reporting interface (i.e. <strong>Client</strong>) by visiting the <a href="http://127.0.0.1:8338">http://127.0.0.1:8338</a> (default credentials: <code>admin:changeme!</code>) from your web browser:</p>

<p><a href="https://camo.githubusercontent.com/92b908d6a697669d240d401a5e860572bf17cb2f/68747470733a2f2f692e696d6775722e636f6d2f564173713863732e706e67" target="_blank"><img src="https://camo.githubusercontent.com/92b908d6a697669d240d401a5e860572bf17cb2f/68747470733a2f2f692e696d6775722e636f6d2f564173713863732e706e67" alt="Reporting interface" data-canonical-src="https://i.imgur.com/VAsq8cs.png"/></a></p>

<h2><a id="user-content-administrators-guide" class="anchor" href="#administrators-guide" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Administrator's guide</h2>

<h3><a id="user-content-sensor" class="anchor" href="#sensor" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Sensor</h3>

<p>Sensor's configuration can be found inside the <code>maltrail.conf</code> file's section <code>[Sensor]</code>:</p>

<p><a href="https://camo.githubusercontent.com/032205f3ab66b4a78d53cdecb682b033153d6289/68747470733a2f2f692e696d6775722e636f6d2f38795a4b4831342e706e67" target="_blank"><img src="https://camo.githubusercontent.com/032205f3ab66b4a78d53cdecb682b033153d6289/68747470733a2f2f692e696d6775722e636f6d2f38795a4b4831342e706e67" alt="Sensor's configuration" data-canonical-src="https://i.imgur.com/8yZKH14.png"/></a></p>

<p>If option <code>USE_MULTIPROCESSING</code> is set to <code>true</code> then all CPU cores will be used. One core will be used only for packet capture (with appropriate affinity, IO priority and nice level settings), while other cores will be used for packet processing. Otherwise, everything will be run on a single core. Option <code>USE_FEED_UPDATES</code> can be used to turn off the trail updates from feeds altogether (and just use the provided static ones). Option <code>UPDATE_PERIOD</code> contains the number of seconds between each automatic trails update (Note: default value is set to <code>86400</code> (i.e. one day)) by using definitions inside the <code>trails</code> directory (Note: both <strong>Sensor</strong> and <strong>Server</strong> take care of the trails update). Option <code>CUSTOM_TRAILS_DIR</code> can be used by user to provide location of directory containing the custom trails (<code>*.txt</code>) files.
Option <code>USE_HEURISTICS</code> turns on heuristic mechanisms (e.g. <code>long domain name (suspicious)</code>, <code>excessive no such domain name (suspicious)</code>, <code>direct .exe download (suspicious)</code>, etc.), potentially introducing false positives. Option <code>CAPTURE_BUFFER</code> presents a total memory (in bytes of percentage of total physical memory) to be used in case of multiprocessing mode for storing packet capture in a ring buffer for further processing by non-capturing processes. Option <code>MONITOR_INTERFACE</code> should contain the name of the capturing interface. Use value <code>any</code> to capture from all interfaces (if OS supports this). Option <code>CAPTURE_FILTER</code> should contain the network capture (<code>tcpdump</code>) filter to skip the uninteresting packets and ease the capturing process. Option <code>SENSOR_NAME</code> contains the name that should be appearing inside the events <code>sensor_name</code> value, so the event from one sensor could be distinguished from the other. If option <code>LOG_SERVER</code> is set, then all events are being sent remotely to the <strong>Server</strong>, otherwise they are stored directly into the logging directory set with option <code>LOG_DIR</code>, which can be found inside the <code>maltrail.conf</code> file's section <code>[All]</code>. In case that the option <code>UPDATE_SERVER</code> is set, then all the trails are being pulled from the given location, otherwise they are being updated from trails definitions located inside the installation itself.</p>

<p>When running the sensor (e.g. <code>sudo python sensor.py</code>) for the first time and/or after a longer period of non-running, it will automatically update the trails from trail definitions (Note: stored inside the <code>trails</code> directory). After the initialization, it will start monitoring the configured interface (option <code>MONITOR_INTERFACE</code> inside the <code>maltrail.conf</code>) and write the events to either the configured log directory (option <code>LOG_DIR</code> inside the <code>maltrail.conf</code> file's section <code>[All]</code>) or send them remotely to the logging/reporting <strong>Server</strong> (option <code>LOG_SERVER</code>).</p>

<p><a href="https://camo.githubusercontent.com/18c116da0a49491d0dc1fd92ecc0bf099fcf7b9a/68747470733a2f2f692e696d6775722e636f6d2f413071524f70382e706e67" target="_blank"><img src="https://camo.githubusercontent.com/18c116da0a49491d0dc1fd92ecc0bf099fcf7b9a/68747470733a2f2f692e696d6775722e636f6d2f413071524f70382e706e67" alt="Sensor run" data-canonical-src="https://i.imgur.com/A0qROp8.png"/></a></p>

<p>Detected events are stored inside the <strong>Server</strong>'s logging directory (i.e. option <code>LOG_DIR</code> inside the <code>maltrail.conf</code> file's section <code>[All]</code>) in easy-to-read CSV format (Note: whitespace ' ' is used as a delimiter) as single line entries consisting of: <code>time</code> <code>sensor</code> <code>src_ip</code> <code>src_port</code> <code>dst_ip</code> <code>dst_port</code> <code>proto</code> <code>trail_type</code> <code>trail</code> <code>trail_info</code> <code>reference</code> (e.g. <code>"2015-10-19 15:48:41.152513" beast 192.168.5.33 32985 8.8.8.8 53 UDP DNS 0000mps.webpreview.dsl.net malicious siteinspector.comodo.com</code>):</p>

<p><a href="https://camo.githubusercontent.com/92973003dc5fca1523aa538851595eb4e65040e5/68747470733a2f2f692e696d6775722e636f6d2f527963675672752e706e67" target="_blank"><img src="https://camo.githubusercontent.com/92973003dc5fca1523aa538851595eb4e65040e5/68747470733a2f2f692e696d6775722e636f6d2f527963675672752e706e67" alt="Sample log" data-canonical-src="https://i.imgur.com/RycgVru.png"/></a></p>

<h3><a id="user-content-server" class="anchor" href="#server" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Server</h3>

<p>Server's configuration can be found inside the <code>maltrail.conf</code> section <code>[Server]</code>:</p>

<p><a href="https://camo.githubusercontent.com/a80c078c060c5af8f540783a0fb82721d414efd4/68747470733a2f2f692e696d6775722e636f6d2f546955704c58382e706e67" target="_blank"><img src="https://camo.githubusercontent.com/a80c078c060c5af8f540783a0fb82721d414efd4/68747470733a2f2f692e696d6775722e636f6d2f546955704c58382e706e67" alt="Server's configuration" data-canonical-src="https://i.imgur.com/TiUpLX8.png"/></a></p>

<p>Option <code>HTTP_ADDRESS</code> contains the web server's listening address (Note: use <code>0.0.0.0</code> to listen on all interfaces). Option <code>HTTP_PORT</code> contains the web server's listening port. Default listening port is set to <code>8338</code>. If option <code>USE_SSL</code> is set to <code>true</code> then <code>SSL/TLS</code> will be used for accessing the web server (e.g. <code>https://192.168.6.10:8338/</code>). In that case, option <code>SSL_PEM</code> should be pointing to the server's private/cert PEM file. </p>

<p>Subsection <code>USERS</code> contains user's configuration settings. Each user entry consists of the <code>username:sha256(password):UID:filter_netmask(s)</code>. Value <code>UID</code> represents the unique user identifier, where it is recommended to use values lower than 1000 for administrative accounts, while higher value for non-administrative accounts. The part <code>filter_netmask(s)</code> represents the comma-delimited hard filter(s) that can be used to filter the shown events depending on the user account(s). Default entry is as follows:</p>

<p><a href="https://camo.githubusercontent.com/3b2130a19e347a68c18c932f3d6bcfaaa68a8fd0/68747470733a2f2f692e696d6775722e636f6d2f505977735a6b6e2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/3b2130a19e347a68c18c932f3d6bcfaaa68a8fd0/68747470733a2f2f692e696d6775722e636f6d2f505977735a6b6e2e706e67" alt="Configuration users" data-canonical-src="https://i.imgur.com/PYwsZkn.png"/></a></p>

<p>Option <code>UDP_ADDRESS</code> contains the server's log collecting listening address (Note: use <code>0.0.0.0</code> to listen on all interfaces), while option <code>UDP_PORT</code> contains listening port value. If turned on, when used in combination with option <code>LOG_SERVER</code>, it can be used for distinct (multiple) <strong>Sensor</strong> &lt;-&gt; <strong>Server</strong> architecture.</p>

<p>Same as for <strong>Sensor</strong>, when running the <strong>Server</strong> (e.g. <code>python server.py</code>) for the first time and/or after a longer period of non-running, if option <code>USE_SERVER_UPDATE_TRAILS</code> is set to <code>true</code>, it will automatically update the trails from trail definitions (Note: stored inside the <code>trails</code> directory). Its basic function is to store the log entries inside the logging directory (i.e. option <code>LOG_DIR</code> inside the <code>maltrail.conf</code> file's section <code>[All]</code>) and provide the web reporting interface for presenting those same entries to the end-user (Note: there is no need install the 3rd party web server packages like Apache):</p>

<p><a href="https://camo.githubusercontent.com/8c075ecb2099b868ae3bca4a86e2cddb72bb387a/68747470733a2f2f692e696d6775722e636f6d2f474864475077372e706e67" target="_blank"><img src="https://camo.githubusercontent.com/8c075ecb2099b868ae3bca4a86e2cddb72bb387a/68747470733a2f2f692e696d6775722e636f6d2f474864475077372e706e67" alt="Server run" data-canonical-src="https://i.imgur.com/GHdGPw7.png"/></a></p>

<h2><a id="user-content-users-guide" class="anchor" href="#users-guide" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>User's guide</h2>

<h3><a id="user-content-reporting-interface" class="anchor" href="#reporting-interface" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Reporting interface</h3>

<p>When entering the <strong>Server</strong>'s reporting interface (i.e. via the address defined by options <code>HTTP_ADDRESS</code> and <code>HTTP_PORT</code>), user will be presented with the following authentication dialog. User has to enter the proper credentials that have been set by the server's administrator inside the configuration file <code>maltrail.conf</code> (Note: default credentials are <code>admin:changeme!</code>):</p>

<p><a href="https://camo.githubusercontent.com/b8534e437841f9ee7b79d339950c3dfae037e81d/68747470733a2f2f692e696d6775722e636f6d2f575670415341492e706e67" target="_blank"><img src="https://camo.githubusercontent.com/b8534e437841f9ee7b79d339950c3dfae037e81d/68747470733a2f2f692e696d6775722e636f6d2f575670415341492e706e67" alt="User login" data-canonical-src="https://i.imgur.com/WVpASAI.png"/></a></p>

<p>Once inside, user will be presented with the following reporting interface:</p>

<p><a href="https://camo.githubusercontent.com/9124a52ee03b94fd1e7809295fe318e64f9fe2c6/68747470733a2f2f692e696d6775722e636f6d2f505a59384a45432e706e67" target="_blank"><img src="https://camo.githubusercontent.com/9124a52ee03b94fd1e7809295fe318e64f9fe2c6/68747470733a2f2f692e696d6775722e636f6d2f505a59384a45432e706e67" alt="Reporting interface" data-canonical-src="https://i.imgur.com/PZY8JEC.png"/></a></p>

<p>The top part holds a sliding timeline (Note: activated after clicking the current date label and/or the calendar icon <a href="https://camo.githubusercontent.com/a3619ec746b327333d213edc626c06c90e50574a/68747470733a2f2f692e696d6775722e636f6d2f4e664e6f7265392e706e67" target="_blank"><img src="https://camo.githubusercontent.com/a3619ec746b327333d213edc626c06c90e50574a/68747470733a2f2f692e696d6775722e636f6d2f4e664e6f7265392e706e67" alt="Calendar icon" data-canonical-src="https://i.imgur.com/NfNore9.png"/></a>) where user can select logs for past events (Note: mouse over event will trigger display of tooltip with approximate number of events for current date). Dates are grouped by months, where 4 month period of data are displayed inside the widget itself. However, by using the provided slider (i.e. <a href="https://camo.githubusercontent.com/3c8d5fd8fc014027a22698231e28ed60173ca2db/68747470733a2f2f692e696d6775722e636f6d2f534e47565361502e706e67" target="_blank"><img src="https://camo.githubusercontent.com/3c8d5fd8fc014027a22698231e28ed60173ca2db/68747470733a2f2f692e696d6775722e636f6d2f534e47565361502e706e67" alt="Timeline slider" data-canonical-src="https://i.imgur.com/SNGVSaP.png"/></a>) user can easily access events from previous months.</p>

<p><a href="https://camo.githubusercontent.com/9e7a5f56e6c9a630e8ae1409bd17c7a1c1cae214/68747470733a2f2f692e696d6775722e636f6d2f526e49524f636e2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/9e7a5f56e6c9a630e8ae1409bd17c7a1c1cae214/68747470733a2f2f692e696d6775722e636f6d2f526e49524f636e2e706e67" alt="Timeline" data-canonical-src="https://i.imgur.com/RnIROcn.png"/></a></p>

<p>Once clicking the date, all events for that particular date should be loaded and represented by the client's web browser. Depending on number of events and the network connection speed, loading and display of logged events could take from couple of seconds, up to several minutes (e.g. 100,000 events takes around 5 seconds in total). For the whole processing time, animated loader will be displayed across the disabled user interface:</p>

<p><a href="https://camo.githubusercontent.com/5af598bcc09fc2f4a1b20678f77dcb3ad013fc2b/68747470733a2f2f692e696d6775722e636f6d2f6f583752746a6f2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/5af598bcc09fc2f4a1b20678f77dcb3ad013fc2b/68747470733a2f2f692e696d6775722e636f6d2f6f583752746a6f2e706e67" alt="Loader" data-canonical-src="https://i.imgur.com/oX7Rtjo.png"/></a></p>

<p>Middle part holds a summary of displayed events. <code>Events</code> box represents total number of events in a selected 24-hour period, where red line represents IP-based events, blue line represents DNS-based events and yellow line represents URL-based events. <code>Sources</code> box represents number of events per top sources in form of a stacked column chart, with total number of sources on top. <code>Threats</code> box represents percentage of top threats in form of a pie chart (Note: gray area holds all threats having each &lt;1% in total events), with total number of threats on top. <code>Trails</code> box represents percentage of top trails in form of a pie chart (Note: gray area holds all trails having each &lt;1% in total events), with total number of trails on top. Each of those boxes are active, hence the click on one of those will result with a more detailed graph.</p>

<p><a href="https://camo.githubusercontent.com/eed3abd79328b95197a0269873140c567886888a/68747470733a2f2f692e696d6775722e636f6d2f354e46627143622e706e67" target="_blank"><img src="https://camo.githubusercontent.com/eed3abd79328b95197a0269873140c567886888a/68747470733a2f2f692e696d6775722e636f6d2f354e46627143622e706e67" alt="Summary" data-canonical-src="https://i.imgur.com/5NFbqCb.png"/></a></p>

<p>Bottom part holds a condensed representation of logged events in form of a paginated table. Each entry holds details for a single threat (Note: uniquely identified by a pair <code>(src_ip, trail)</code> or <code>(dst_ip, trail)</code> if the <code>src_ip</code> is the same as the <code>trail</code> as in case of attacks coming from the outside):</p>

<p><a href="https://camo.githubusercontent.com/ec4359073472eee7670bc35e0e926698ced4881f/68747470733a2f2f692e696d6775722e636f6d2f497850774b4b5a2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/ec4359073472eee7670bc35e0e926698ced4881f/68747470733a2f2f692e696d6775722e636f6d2f497850774b4b5a2e706e67" alt="Single threat" data-canonical-src="https://i.imgur.com/IxPwKKZ.png"/></a></p>

<p>Column <code>threat</code> holds threat's unique ID (e.g. <code>85fdb08d</code>) and color (Note: extruded from the threat's ID), <code>sensor</code> holds sensor name(s) where the event has been triggered (e.g. <code>blitvenica</code>), <code>events</code> holds total number of events for a current threat, <code>severity</code> holds evaluated severity of threat (Note: calculated based on values in <code>info</code> and <code>reference</code> columns, prioritizing malware generated traffic), <code>first_seen</code> holds time of first event in a selected (24h) period (e.g. <code>06th 08:21:54</code>), <code>last_seen</code> holds time of last event in a selected (24h) period (e.g. <code>06th 15:21:23</code>), <code>sparkline</code> holds a small sparkline graph representing threat's activity in selected period, <code>src_ip</code> holds source IP(s) of a threat (e.g. <code>99.102.41.102</code>), <code>src_port</code> holds source port(s) (e.g. <code>44556, 44589, 44601</code>), <code>dst_ip</code> holds destination IP(s) (e.g. <code>213.202.100.28</code>), <code>dst_port</code> holds destination port(s) (e.g. <code>80 (HTTP)</code>), <code>proto</code> holds protocol(s), (e.g. <code>TCP</code>), <code>trail</code> holds a blacklisted (or heuristic) entry that triggered the event(s), <code>info</code> holds more information about the threat/trail (e.g. <code>known attacker</code> for known attacker's IP addresses or <code>ipinfo</code> for known IP information service commonly used by malware during a startup), <code>reference</code> holds a source of the blacklisted entry (e.g. <code>(static)</code> for static trails or <code>myip.ms</code> for a dynamic feed retrieved from that same source) and <code>tags</code> holds user defined tags for a given trail (e.g. <code>APT28</code>).</p>

<p>When moving mouse over <code>src_ip</code> and <code>dst_ip</code> table entries, information tooltip is being displayed with detailed reverse DNS and WHOIS information (Note: <a href="http://www.ripe.net/">RIPE</a> is the information provider):</p>

<p><a href="https://camo.githubusercontent.com/92ac47978365f669e0520a5b1c4680aaa392939d/68747470733a2f2f692e696d6775722e636f6d2f42674b636841582e706e67" target="_blank"><img src="https://camo.githubusercontent.com/92ac47978365f669e0520a5b1c4680aaa392939d/68747470733a2f2f692e696d6775722e636f6d2f42674b636841582e706e67" alt="On mouse over IP" data-canonical-src="https://i.imgur.com/BgKchAX.png"/></a></p>

<p>Event details (e.g. <code>src_port</code>, <code>dst_port</code>, <code>proto</code>, etc.) that differ inside same threat entry are condensed in form of a cloud icon (i.e. <a href="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/ellipsis.png" target="_blank"><img src="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/ellipsis.png" alt="Cloud ellipsis"/></a>). This is performed to get an usable reporting interface with as less rows as possible. Moving mouse over such icon will result in a display of an information tooltip with all items held (e.g. all port numbers being scanned by <code>attacker</code>):</p>

<p><a href="https://camo.githubusercontent.com/9907e119cc7e275a555a312f24e818ea4a47994e/68747470733a2f2f692e696d6775722e636f6d2f426659543275372e706e67" target="_blank"><img src="https://camo.githubusercontent.com/9907e119cc7e275a555a312f24e818ea4a47994e/68747470733a2f2f692e696d6775722e636f6d2f426659543275372e706e67" alt="On mouse over cloud" data-canonical-src="https://i.imgur.com/BfYT2u7.png"/></a></p>

<p>Clicking on one such icon will open a new dialog containing all stored items (Note: in their uncondensed form) ready to be Copy-Paste(d) for further analysis:</p>

<p><a href="https://camo.githubusercontent.com/44144fd4c32813beb2b00054607d1db1cb489d99/68747470733a2f2f692e696d6775722e636f6d2f3970674d7069522e706e67" target="_blank"><img src="https://camo.githubusercontent.com/44144fd4c32813beb2b00054607d1db1cb489d99/68747470733a2f2f692e696d6775722e636f6d2f3970674d7069522e706e67" alt="Ctrl-C dialog" data-canonical-src="https://i.imgur.com/9pgMpiR.png"/></a></p>

<p>When hovering mouse pointer over the threat's trail for couple of seconds it will result in a frame consisted of results using the trail as a search term performed against <a href="https://duckduckgo.com/">DuckDuckGo</a> search engine. In lots of cases, this provides basic information about the threat itself, eliminating the need for user to do the manual search for it. In upper right corner of the opened frame window there are two extra buttons. By clicking the first one (i.e. <a href="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/newtab.png" target="_blank"><img src="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/newtab.png" alt="New tab icon"/></a>), the resulting frame will be opened inside the new browser's tab (or window), while by clicking the second one (i.e. <a href="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/close.png" target="_blank"><img src="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/close.png" alt="Close icon"/></a>) will immediately close the frame (Note: the same action is achieved by moving the mouse pointer outside the frame borders):</p>

<p><a href="https://camo.githubusercontent.com/9725aeb34f80db4d7cd0f02bde580fb090ec2d14/68747470733a2f2f692e696d6775722e636f6d2f70706f4d4875622e706e67" target="_blank"><img src="https://camo.githubusercontent.com/9725aeb34f80db4d7cd0f02bde580fb090ec2d14/68747470733a2f2f692e696d6775722e636f6d2f70706f4d4875622e706e67" alt="On mouse over trail" data-canonical-src="https://i.imgur.com/ppoMHub.png"/></a></p>

<p>For each threat there is a column <code>tag</code> that can be filled with arbitrary "tags" to closely describe all threats sharing the same trail. Also, it is a great way to describe threats individually, so all threats sharing the same tag (e.g. <code>yahoo</code>) could be grouped out later:</p>

<p><a href="https://camo.githubusercontent.com/2601cb911675e9cf426e1e7124278a6b6531a070/68747470733a2f2f692e696d6775722e636f6d2f75355a343735322e706e67" target="_blank"><img src="https://camo.githubusercontent.com/2601cb911675e9cf426e1e7124278a6b6531a070/68747470733a2f2f692e696d6775722e636f6d2f75355a343735322e706e67" alt="Tags" data-canonical-src="https://i.imgur.com/u5Z4752.png"/></a></p>

<h3><a id="user-content-real-life-cases" class="anchor" href="#real-life-cases" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Real-life cases</h3>

<p>In the following section some of the "usual suspects" scenarios will be described through the real-life cases.</p>

<h4><a id="user-content-mass-scans" class="anchor" href="#mass-scans" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Mass scans</h4>

<p>Mass scans is a fairly common phenomenon where individuals and/or organizations give themselves a right to scan the whole 0.0.0.0/0 IP range (i.e. whole Internet) on a daily basis, with disclaimer where they say that if you don't like it then you should contact them privately to be skipped from future scans. </p>

<p><a href="https://camo.githubusercontent.com/46a253d1a0f165d27096698dd4fc1bf519221e60/68747470733a2f2f692e696d6775722e636f6d2f6e774f774c50392e706e67" target="_blank"><img src="https://camo.githubusercontent.com/46a253d1a0f165d27096698dd4fc1bf519221e60/68747470733a2f2f692e696d6775722e636f6d2f6e774f774c50392e706e67" alt="Shodan FileZilla results" data-canonical-src="https://i.imgur.com/nwOwLP9.png"/></a></p>

<p>To make stuff worse, organizations as <a href="https://www.shodan.io/">Shodan</a> and <a href="http://www.zoomeye.org">ZoomEye</a> give all results freely available (to other potential attackers) through their search engine. In the following screenshots you'll see details of Shodan scans in one single day.</p>

<p>Here is a reverse DNS and WHOIS lookup of the "attacker"'s address:</p>

<p><a href="https://camo.githubusercontent.com/53254e484c12b53c2850146bb5f074159650bc15/68747470733a2f2f692e696d6775722e636f6d2f4c5136567530302e706e67" target="_blank"><img src="https://camo.githubusercontent.com/53254e484c12b53c2850146bb5f074159650bc15/68747470733a2f2f692e696d6775722e636f6d2f4c5136567530302e706e67" alt="Shodan 1" data-canonical-src="https://i.imgur.com/LQ6Vu00.png"/></a></p>

<p>When hovering mouse pointer over the <code>trail</code> column's content (IP address), you'll be presented with the search results from <a href="https://duckduckgo.com/">DuckDuckGo</a> where you'll be able to find more information about the "attacker" (i.e. Shodan):</p>

<p><a href="https://camo.githubusercontent.com/8cdffc8bc138a71173114dfa5a901572ae73e77c/68747470733a2f2f692e696d6775722e636f6d2f7376374f4e7a6b2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/8cdffc8bc138a71173114dfa5a901572ae73e77c/68747470733a2f2f692e696d6775722e636f6d2f7376374f4e7a6b2e706e67" alt="Shodan 2" data-canonical-src="https://i.imgur.com/sv7ONzk.png"/></a></p>

<p>In the <code>dst_ip</code> column, if you have a large organization, you'll be presented with large list of scanned IP addresses:
<a href="https://camo.githubusercontent.com/4652df4f79888ed8117a4c21e29549794d6151be/68747470733a2f2f692e696d6775722e636f6d2f456841745873372e706e67" target="_blank"><img src="https://camo.githubusercontent.com/4652df4f79888ed8117a4c21e29549794d6151be/68747470733a2f2f692e696d6775722e636f6d2f456841745873372e706e67" alt="Shodan 3" data-canonical-src="https://i.imgur.com/EhAtXs7.png"/></a></p>

<p>In the <code>dst_port</code> column you'll be able to see all ports that have been scanned by such mass scans:</p>

<p><a href="https://camo.githubusercontent.com/e497622e8d665155dfdc764828fe922108b30908/68747470733a2f2f692e696d6775722e636f6d2f576b38586a68712e706e67" target="_blank"><img src="https://camo.githubusercontent.com/e497622e8d665155dfdc764828fe922108b30908/68747470733a2f2f692e696d6775722e636f6d2f576b38586a68712e706e67" alt="Shodan 4" data-canonical-src="https://i.imgur.com/Wk8Xjhq.png"/></a></p>

<p>In other similar situations you'll see the same behaviour, coming from blacklisted individual attacker(s) (in this case by <a href="http://cinsscore.com/">cinsscore.com</a>):</p>

<p><a href="https://camo.githubusercontent.com/7fa44c1aefc1f3bd1d17c153a5a4d85dc458ad3c/68747470733a2f2f692e696d6775722e636f6d2f77534f4f6e514d2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/7fa44c1aefc1f3bd1d17c153a5a4d85dc458ad3c/68747470733a2f2f692e696d6775722e636f6d2f77534f4f6e514d2e706e67" alt="Known attacker" data-canonical-src="https://i.imgur.com/wSOOnQM.png"/></a></p>

<p>One more common behaviour is scanning of the whole 0.0.0.0/0 IP range (i.e. Internet) in search for one particular port (e.g. TCP port 443 when <a href="http://heartbleed.com/">Heartbleed</a> has been found). In the following screenshot you'll find one such case for previously blacklisted attacker(s) (in this case by <a href="http://alienvault.com">alienvault.com</a> and two other blacklists) targeting the UDP port 5060 (i.e. SIP) in search for <a href="https://isc.sans.edu/diary/Targeting+VoIP%3A+Increase+in+SIP+Connections+on+UDP+port+5060/9193">misconfigured VoIP devices</a>:</p>

<p><a href="https://camo.githubusercontent.com/dd0ce9e19fa75a86fbc352ec6aebc2833a1692f2/68747470733a2f2f692e696d6775722e636f6d2f646b4a665538362e706e67" target="_blank"><img src="https://camo.githubusercontent.com/dd0ce9e19fa75a86fbc352ec6aebc2833a1692f2/68747470733a2f2f692e696d6775722e636f6d2f646b4a665538362e706e67" alt="SIP scan" data-canonical-src="https://i.imgur.com/dkJfU86.png"/></a></p>

<h4><a id="user-content-anonymous-attackers" class="anchor" href="#anonymous-attackers" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Anonymous attackers</h4>

<p>To spot the potential attackers hidden behind the <a href="https://www.torproject.org/">Tor</a> anonymity network, Maltrail utilizes publicly available lists of Tor exit nodes. In the following screenshot you'll see a case where potential attacker has been utilizing the Tor network to access the web target (over HTTP) in our organization's range in suspicious way (total 171 connection requests in 10 minutes):</p>

<p><a href="https://camo.githubusercontent.com/3f475f5f94dcf74a220c24b58c14afec8774f544/68747470733a2f2f692e696d6775722e636f6d2f6458463872324b2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/3f475f5f94dcf74a220c24b58c14afec8774f544/68747470733a2f2f692e696d6775722e636f6d2f6458463872324b2e706e67" alt="Tor attacker" data-canonical-src="https://i.imgur.com/dXF8r2K.png"/></a></p>

<h4><a id="user-content-service-attackers" class="anchor" href="#service-attackers" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Service attackers</h4>

<p>Fairly similar case to the previous one is when previously blacklisted attacker tries to access particular (e.g. non-HTTP(s)) service in our organization's range in rather suspicious way (i.e. total 1513 connection attempts in less than 15 minutes):</p>

<p><a href="https://camo.githubusercontent.com/176db10fab14837a3f9992e0e52de06b86a91ecc/68747470733a2f2f692e696d6775722e636f6d2f4f6f32616443662e706e67" target="_blank"><img src="https://camo.githubusercontent.com/176db10fab14837a3f9992e0e52de06b86a91ecc/68747470733a2f2f692e696d6775722e636f6d2f4f6f32616443662e706e67" alt="RDP brute force" data-canonical-src="https://i.imgur.com/Oo2adCf.png"/></a></p>

<p>If we enter the <code>ssh attacker</code> to the <code>Filter</code> field, we'll be able to see all similar occurrences for that day, but in this case for port 22 (i.e. SSH):</p>

<p><a href="https://camo.githubusercontent.com/35563f2d0f927ef3247d086a4b3643d77499324d/68747470733a2f2f692e696d6775722e636f6d2f6f437634326a642e706e67" target="_blank"><img src="https://camo.githubusercontent.com/35563f2d0f927ef3247d086a4b3643d77499324d/68747470733a2f2f692e696d6775722e636f6d2f6f437634326a642e706e67" alt="SSH attackers filter" data-canonical-src="https://i.imgur.com/oCv42jd.png"/></a></p>

<h4><a id="user-content-malware" class="anchor" href="#malware" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Malware</h4>

<p>In case of connection attempts coming from infected computers inside our organization toward already known C&amp;C servers, you'll be able to find threats similar to the following (in this case <a href="https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Win32/Beebone">Beebone</a>):</p>

<p><a href="https://camo.githubusercontent.com/500691dd7a9bf9b43ce33923e71358081f34ff8d/68747470733a2f2f692e696d6775722e636f6d2f47424c5749536f2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/500691dd7a9bf9b43ce33923e71358081f34ff8d/68747470733a2f2f692e696d6775722e636f6d2f47424c5749536f2e706e67" alt="beebone malware" data-canonical-src="https://i.imgur.com/GBLWISo.png"/></a></p>

<p>In case of DNS requests containing known <a href="https://en.wikipedia.org/wiki/Domain_generation_algorithm">DGA</a> domain names, threat will be shown like (in this case <a href="https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Win32/Necurs">Necurs</a>):</p>

<p><a href="https://camo.githubusercontent.com/f83ec4e1e4b5bb9a26e6c8c43540078fd3849f98/68747470733a2f2f692e696d6775722e636f6d2f3874576a32706d2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/f83ec4e1e4b5bb9a26e6c8c43540078fd3849f98/68747470733a2f2f692e696d6775722e636f6d2f3874576a32706d2e706e67" alt="necurs malware" data-canonical-src="https://i.imgur.com/8tWj2pm.png"/></a></p>

<p>In the following case file downloads from blacklisted (in this case by <a href="https://malwarepatrol.net/">malwarepatrol.net</a>) URL(s) have occurred:</p>

<p><a href="https://camo.githubusercontent.com/d55c502c94d65fed1f385fc97f54b58c3410ec3f/68747470733a2f2f692e696d6775722e636f6d2f67324e483773542e706e67" target="_blank"><img src="https://camo.githubusercontent.com/d55c502c94d65fed1f385fc97f54b58c3410ec3f/68747470733a2f2f692e696d6775722e636f6d2f67324e483773542e706e67" alt="malware download" data-canonical-src="https://i.imgur.com/g2NH7sT.png"/></a></p>

<p>If we enter the particular malware name (in this case <a href="https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Win32%2fRamnit">Ramnit</a>) into the <code>Filter</code> field, only threats that are known to be linked to this malware will be filtered in (showing you all affected internal computers):</p>

<p><a href="https://camo.githubusercontent.com/83378a3d87d889ab2ff59567cdeaffe637066230/68747470733a2f2f692e696d6775722e636f6d2f7a636f506e5a6b2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/83378a3d87d889ab2ff59567cdeaffe637066230/68747470733a2f2f692e696d6775722e636f6d2f7a636f506e5a6b2e706e67" alt="ramnit malware" data-canonical-src="https://i.imgur.com/zcoPnZk.png"/></a></p>

<p>More generally, if we enter the <code>malware</code> into the <code>Filter</code> field, all threats that have been found by malware(-related) trails (e.g. <code>IP</code> addresses) will be filtered in:</p>

<p><a href="https://camo.githubusercontent.com/e1750262ab0f64e4998c385827a641a8aa83dd90/68747470733a2f2f692e696d6775722e636f6d2f675659416653552e706e67" target="_blank"><img src="https://camo.githubusercontent.com/e1750262ab0f64e4998c385827a641a8aa83dd90/68747470733a2f2f692e696d6775722e636f6d2f675659416653552e706e67" alt="malware filter" data-canonical-src="https://i.imgur.com/gVYAfSU.png"/></a></p>

<h4><a id="user-content-suspicious-domain-lookups" class="anchor" href="#suspicious-domain-lookups" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Suspicious domain lookups</h4>

<p>Maltrail uses the static list of TLD <a href="https://github.com/stamparm/maltrail/blob/master/trails/static/suspicious/domain.txt">domains</a> that are known to be commonly involved in suspicious activities. Most such <a href="https://en.wikipedia.org/wiki/Top-level_domain">TLD</a> domains are coming from free domain registrars (e.g. <a href="http://www.freenom.com">Freenom</a>), hence they should be under greater scrutiny. In the following screenshot we can find a case where one such TLD domain <code>.cm</code> has been used by unknown malware using the <a href="https://en.wikipedia.org/wiki/Domain_generation_algorithm">DGA</a> algorithm to contact its <a href="https://www.trendmicro.com/vinfo/us/security/definition/command-and-control-%28c-c%29-server">C&amp;C</a> server(s):</p>

<p><a href="https://camo.githubusercontent.com/90c9d044f6e7da0375e366ec45b6410fdf561e82/68747470733a2f2f692e696d6775722e636f6d2f4a544764744a302e706e67" target="_blank"><img src="https://camo.githubusercontent.com/90c9d044f6e7da0375e366ec45b6410fdf561e82/68747470733a2f2f692e696d6775722e636f6d2f4a544764744a302e706e67" alt="cm DGA" data-canonical-src="https://i.imgur.com/JTGdtJ0.png"/></a></p>

<p>There are also cases when perfectly valid TLD domains (e.g. <code>.ru</code>) are used for suspicious activities, such in this case (e.g. <code>long domain name (suspicious)</code>) where the domains are obviously DGA generated by unknown malware:</p>

<p><a href="https://camo.githubusercontent.com/003603a01014876deb8159a8d729b4f3eb4ac8d7/68747470733a2f2f692e696d6775722e636f6d2f454a4f533551622e706e67" target="_blank"><img src="https://camo.githubusercontent.com/003603a01014876deb8159a8d729b4f3eb4ac8d7/68747470733a2f2f692e696d6775722e636f6d2f454a4f533551622e706e67" alt="Suspicious long domains" data-canonical-src="https://i.imgur.com/EJOS5Qb.png"/></a></p>

<p>Maltrail uses static <a href="https://github.com/stamparm/maltrail/blob/master/trails/static/suspicious/dynamic_domain.txt">list</a> of so-called "dynamic domains" that are often used in suspicious activities (e.g. for malware C&amp;C servers that often change the destination's IP addresses):</p>

<p><a href="https://camo.githubusercontent.com/4238163129b825f2ce611f9e540ca6176dd80eb8/68747470733a2f2f692e696d6775722e636f6d2f3157564c4d66392e706e67" target="_blank"><img src="https://camo.githubusercontent.com/4238163129b825f2ce611f9e540ca6176dd80eb8/68747470733a2f2f692e696d6775722e636f6d2f3157564c4d66392e706e67" alt="Suspicious dynamic domains" data-canonical-src="https://i.imgur.com/1WVLMf9.png"/></a></p>

<p>Also, Maltrail uses static <a href="https://github.com/stamparm/maltrail/blob/master/trails/static/suspicious/onion.txt">list</a> of "onion"-related domains that are also often used in suspicious activities (e.g. malware contacting C&amp;C servers by using Tor2Web service(s)):</p>

<p><a href="https://camo.githubusercontent.com/fe0a9e6c25dc2f2d437028c909bd538fcc82ae30/68747470733a2f2f692e696d6775722e636f6d2f51646f415930772e706e67" target="_blank"><img src="https://camo.githubusercontent.com/fe0a9e6c25dc2f2d437028c909bd538fcc82ae30/68747470733a2f2f692e696d6775722e636f6d2f51646f415930772e706e67" alt="Suspicious onion" data-canonical-src="https://i.imgur.com/QdoAY0w.png"/></a></p>

<p>In case of old and/or obsolete malware that sits undetected on organization's infected internal computers, there is often a "phenomenon" where malware continuously tries to contact the long dead C&amp;C server's domain without any DNS resolution. Hence, those kind of (potential) threats will be marked as <code>excessive no such domain (suspicious)</code>:</p>

<p><a href="https://camo.githubusercontent.com/b3e8e2c7fa8ac3a5948c1518fc7d4ab067c64a2e/68747470733a2f2f692e696d6775722e636f6d2f4b50774e4f4d382e706e67" target="_blank"><img src="https://camo.githubusercontent.com/b3e8e2c7fa8ac3a5948c1518fc7d4ab067c64a2e/68747470733a2f2f692e696d6775722e636f6d2f4b50774e4f4d382e706e67" alt="Excessive no such domain name" data-canonical-src="https://i.imgur.com/KPwNOM8.png"/></a></p>

<p>In case that one trail is responsible for too many threats (e.g. in case of fake source IPs like in DNS amplification attacks), all similar threats will be grouped under a single <code>flood</code> threat (Note: threat's ID will be marked with suffix <code>F0</code>), like in the following example:</p>

<p><a href="https://camo.githubusercontent.com/5c61fbe5ec2400b1ec9aeee1d50b8c52e8eb1c24/68747470733a2f2f692e696d6775722e636f6d2f5a74704d5233642e706e67" target="_blank"><img src="https://camo.githubusercontent.com/5c61fbe5ec2400b1ec9aeee1d50b8c52e8eb1c24/68747470733a2f2f692e696d6775722e636f6d2f5a74704d5233642e706e67" alt="Flood" data-canonical-src="https://i.imgur.com/ZtpMR3d.png"/></a></p>

<h4><a id="user-content-suspicious-ipinfo-requests" class="anchor" href="#suspicious-ipinfo-requests" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Suspicious ipinfo requests</h4>

<p>Lots of malware uses some kind of <code>ipinfo</code> service (e.g. <a href="http://ipinfo.io">ipinfo.io</a>) to find out the victim's Internet IP address. In case of regular and especially in out-of-office hours, those kind of requests should be closely monitored, like in the following example:</p>

<p><a href="https://camo.githubusercontent.com/e8632740712398950efbd7738fe2739bc2ba4fb3/68747470733a2f2f692e696d6775722e636f6d2f3354484f6f57572e706e67" target="_blank"><img src="https://camo.githubusercontent.com/e8632740712398950efbd7738fe2739bc2ba4fb3/68747470733a2f2f692e696d6775722e636f6d2f3354484f6f57572e706e67" alt="suspicious ipinfo" data-canonical-src="https://i.imgur.com/3THOoWW.png"/></a></p>

<p>By using filter <code>ipinfo</code> all potentially infected computers in our organization's range can be listed that share this kind of suspicious behaviour:</p>

<p><a href="https://camo.githubusercontent.com/dad6eafa2fe4c0913b601076bbdac35f23fbabfd/68747470733a2f2f692e696d6775722e636f6d2f36534d4e3061742e706e67" target="_blank"><img src="https://camo.githubusercontent.com/dad6eafa2fe4c0913b601076bbdac35f23fbabfd/68747470733a2f2f692e696d6775722e636f6d2f36534d4e3061742e706e67" alt="ipinfo filter" data-canonical-src="https://i.imgur.com/6SMN0at.png"/></a></p>

<h4><a id="user-content-suspicious-direct-file-downloads" class="anchor" href="#suspicious-direct-file-downloads" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Suspicious direct file downloads</h4>

<p>Maltrail tracks all suspicious direct file download attempts (e.g. <code>.apk</code>, <code>.exe</code> and <code>.scr</code> file extensions). This can trigger lots of false positives, but eventually could help in reconstruction of the chain of infection (Note: legitimate service providers, like Google, usually use encrypted HTTPS to perform this kind of downloads):</p>

<p><a href="https://camo.githubusercontent.com/0957d2bf2ea01685e7146de910c0a613cd8c297a/68747470733a2f2f692e696d6775722e636f6d2f6a7235425331682e706e67" target="_blank"><img src="https://camo.githubusercontent.com/0957d2bf2ea01685e7146de910c0a613cd8c297a/68747470733a2f2f692e696d6775722e636f6d2f6a7235425331682e706e67" alt="Direct .exe download" data-canonical-src="https://i.imgur.com/jr5BS1h.png"/></a></p>

<h4><a id="user-content-suspicious-http-requests" class="anchor" href="#suspicious-http-requests" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Suspicious HTTP requests</h4>

<p>In case of suspicious requests coming from outer web application security scanners (e.g. searching for SQLi, XSS, LFI, etc. vulnerabilities) and/or the internal user malicious attempts toward unknown web sites, threats like the following could be found (real case of attackers trying to exploit Joomla! CMS CVE-2015-7297, CVE-2015-7857, and CVE-2015-7858 <a href="https://blog.sucuri.net/2015/10/joomla-3-4-5-released-fixing-a-serious-sql-injection-vulnerability.html">vulnerabilities</a>):</p>

<p><a href="https://camo.githubusercontent.com/c6dd6e97ecc85f158f729db7ba0e7f76f86848ee/68747470733a2f2f692e696d6775722e636f6d2f705a75475870722e706e67" target="_blank"><img src="https://camo.githubusercontent.com/c6dd6e97ecc85f158f729db7ba0e7f76f86848ee/68747470733a2f2f692e696d6775722e636f6d2f705a75475870722e706e67" alt="SQLi com_contenthistory" data-canonical-src="https://i.imgur.com/pZuGXpr.png"/></a></p>

<p>In following example, web application vulnerability scan has been marked as "suspicious":</p>

<p><a href="https://camo.githubusercontent.com/5280df7fb545b49872615219742f5f29bc52369f/68747470733a2f2f692e696d6775722e636f6d2f517a63614573472e706e67" target="_blank"><img src="https://camo.githubusercontent.com/5280df7fb545b49872615219742f5f29bc52369f/68747470733a2f2f692e696d6775722e636f6d2f517a63614573472e706e67" alt="Vulnerability scan" data-canonical-src="https://i.imgur.com/QzcaEsG.png"/></a></p>

<p>If we click on the cloud icon (i.e. <a href="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/ellipsis.png" target="_blank"><img src="https://raw.githubusercontent.com/stamparm/maltrail/master/html/images/ellipsis.png" alt="Cloud ellipsis"/></a>) for details and copy paste the whole content to a textual file, we'll be able to see all suspicious HTTP requests:</p>

<p><a href="https://camo.githubusercontent.com/c2912fb446d008122e9bc4cf3c1048a8456027dc/68747470733a2f2f692e696d6775722e636f6d2f5859394b30316f2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/c2912fb446d008122e9bc4cf3c1048a8456027dc/68747470733a2f2f692e696d6775722e636f6d2f5859394b30316f2e706e67" alt="Vulnerability scan requests" data-canonical-src="https://i.imgur.com/XY9K01o.png"/></a></p>

<p>In the following screenshot, a run of popular SQLi vulnerability tool <a href="https://github.com/sqlmapproject/sqlmap/">sqlmap</a> can be found inside our logs:</p>

<p><a href="https://camo.githubusercontent.com/ce3350b7c94229ddd54e030e2378ae9b02f086ca/68747470733a2f2f692e696d6775722e636f6d2f6d485a6d4d37742e706e67" target="_blank"><img src="https://camo.githubusercontent.com/ce3350b7c94229ddd54e030e2378ae9b02f086ca/68747470733a2f2f692e696d6775722e636f6d2f6d485a6d4d37742e706e67" alt="sqlmap scan requests" data-canonical-src="https://i.imgur.com/mHZmM7t.png"/></a></p>

<h4><a id="user-content-port-scanning" class="anchor" href="#port-scanning" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Port scanning</h4>

<p>In case of too many connection attempts toward considerable amount of different TCP ports, Maltrail will warn about the potential port scanning, as a result of its heuristic mechanism detection. It the following screenshot such warning(s) can be found for a run of popular port scanning tool <a href="https://nmap.org/">nmap</a>:</p>

<p><a href="https://camo.githubusercontent.com/2a420c8f934129bb9e62def97e1dd79b00e08d13/68747470733a2f2f692e696d6775722e636f6d2f5653374c3241332e706e67" target="_blank"><img src="https://camo.githubusercontent.com/2a420c8f934129bb9e62def97e1dd79b00e08d13/68747470733a2f2f692e696d6775722e636f6d2f5653374c3241332e706e67" alt="nmap scan" data-canonical-src="https://i.imgur.com/VS7L2A3.png"/></a></p>

<h4><a id="user-content-dns-resource-exhaustion" class="anchor" href="#dns-resource-exhaustion" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>DNS resource exhaustion</h4>

<p>One popular DDoS attack against the web server(s) infrastructure is the resource exhaustion of its (main) DNS server by making valid DNS recursion queries for (pseudo)random subdomain names (e.g. <code>abpdrsguvjkyz.www.dedeni.com</code>):</p>

<p><a href="https://camo.githubusercontent.com/d4cc7d5fb7c1a3ce750307b8fae2900834c59087/68747470733a2f2f692e696d6775722e636f6d2f52756a686e4b572e706e67" target="_blank"><img src="https://camo.githubusercontent.com/d4cc7d5fb7c1a3ce750307b8fae2900834c59087/68747470733a2f2f692e696d6775722e636f6d2f52756a686e4b572e706e67" alt="DNS resource exhaustion" data-canonical-src="https://i.imgur.com/RujhnKW.png"/></a></p>

<h4><a id="user-content-data-leakage" class="anchor" href="#data-leakage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Data leakage</h4>

<p>Miscellaneous programs (especially mobile-based) present malware(-like) behaviour where they send potentially sensitive data to the remote beacon posts. Maltrail will try to capture such behaviour like in the following example:</p>

<p><a href="https://camo.githubusercontent.com/1ac5d22d201ca83da05c44d6dcd370d90b86911e/68747470733a2f2f692e696d6775722e636f6d2f367a74326758672e706e67" target="_blank"><img src="https://camo.githubusercontent.com/1ac5d22d201ca83da05c44d6dcd370d90b86911e/68747470733a2f2f692e696d6775722e636f6d2f367a74326758672e706e67" alt="Data leakage" data-canonical-src="https://i.imgur.com/6zt2gXg.png"/></a></p>

<h4><a id="user-content-false-positives" class="anchor" href="#false-positives" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>False positives</h4>

<p>Like in all other security solutions, Maltrail is prone to "<a href="https://en.wikipedia.org/wiki/False_positives_and_false_negatives">false positives</a>". In those kind of cases, Maltrail will (especially in case of <code>suspicious</code> threats) record a regular user's behaviour and mark it as malicious and/or suspicious. In the following example it can be seen that a blacklist feed provider <code>blocklist.de</code> marked regular Google server as <code>attacker</code>(s), resulting with the following threat:</p>

<p><a href="https://camo.githubusercontent.com/412181a9fd07262a052661040166ce8a0fecff1f/68747470733a2f2f692e696d6775722e636f6d2f484676434e4e4b2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/412181a9fd07262a052661040166ce8a0fecff1f/68747470733a2f2f692e696d6775722e636f6d2f484676434e4e4b2e706e67" alt="Google false positive 1" data-canonical-src="https://i.imgur.com/HFvCNNK.png"/></a></p>

<p>By hovering mouse over the trail, frame with results from <a href="https://duckduckgo.com/">DuckDuckGo</a> search show that this is a regular Google's server:</p>

<p><a href="https://camo.githubusercontent.com/6caabae19d31ad9a23e1df88820c065a145b376e/68747470733a2f2f692e696d6775722e636f6d2f346353394e4a422e706e67" target="_blank"><img src="https://camo.githubusercontent.com/6caabae19d31ad9a23e1df88820c065a145b376e/68747470733a2f2f692e696d6775722e636f6d2f346353394e4a422e706e67" alt="Google false positive 2" data-canonical-src="https://i.imgur.com/4cS9NJB.png"/></a></p>

<p>As another example, access to regular <code>.work</code> domains (popular TLD for malicious purposes) resulted with the following threat:</p>

<p><a href="https://camo.githubusercontent.com/648a02b89c9543e4e7857d56c02d1958d9761691/68747470733a2f2f692e696d6775722e636f6d2f4d7371384867482e706e67" target="_blank"><img src="https://camo.githubusercontent.com/648a02b89c9543e4e7857d56c02d1958d9761691/68747470733a2f2f692e696d6775722e636f6d2f4d7371384867482e706e67" alt="Suspicious domain false positive" data-canonical-src="https://i.imgur.com/Msq8HgH.png"/></a></p>

<p>Nevertheless, administrator(s) should invest some extra time and check (with other means) whether the "suspicious" means malicious or not, as in the following example:</p>

<p><a href="https://camo.githubusercontent.com/4967d965bf0a2ae099303faf69622a6a2c11c508/68747470733a2f2f692e696d6775722e636f6d2f624f4c6d5855452e706e67" target="_blank"><img src="https://camo.githubusercontent.com/4967d965bf0a2ae099303faf69622a6a2c11c508/68747470733a2f2f692e696d6775722e636f6d2f624f4c6d5855452e706e67" alt="Suspicious .ws" data-canonical-src="https://i.imgur.com/bOLmXUE.png"/></a></p>

<h2><a id="user-content-requirements" class="anchor" href="#requirements" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Requirements</h2>

<p>To properly run the Maltrail, <a href="http://www.python.org/download/">Python</a> <strong>2.6.x</strong> or <strong>2.7.x</strong> is required, together with <a href="http://corelabs.coresecurity.com/index.php?module=Wiki&amp;action=view&amp;type=tool&amp;name=Pcapy">pcapy</a> (e.g. <code>sudo apt-get install python-pcapy</code>). There are no other requirements, other than to run the <strong>Sensor</strong> component with the administrative/root privileges.</p>

<h2><a id="user-content-license" class="anchor" href="#license" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>License</h2>

<p>This software is provided under under a MIT License. See the accompanying <a href="https://github.com/stamparm/maltrail/blob/master/LICENSE">LICENSE</a> file for more information.</p>

<h2><a id="user-content-donations" class="anchor" href="#donations" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Donations</h2>

<p>This project is a result of numerous hours of software development. If you appreciate the work and you want to see it further developed, please consider making a donation via <a href="https://www.paypal.com/">PayPal</a> to <code>miroslav.stampar@gmail.com</code> or via itcoin to <code>1JCtgmpC1eWvdHXrKfvMAunfvcaaMXLP5G</code>.</p>

<p>Thank you:</p>

<ul>
<li>Thomas Kristner</li>
<li>Eduardo Arcusa Les</li>
</ul>
</article>
  </div></body></html>