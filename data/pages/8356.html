<html><body><div><div class="entry-content">
		<p>Have you ever wondered what comforts a truly programmable app can give to a consumer. Many of us admire Internet of things( IOT) . So today I am going to talk about creating Personal Assistants (PA) for Telegram app, an application similar to whatsApp but fully programmable using it’s Bot API. We can pass messages to multiple devices in a click of eye. Telegram is the app which hackers likes because of it’s customization. Messaging apps should not only provide communication between humans but also should lay channels between humans and programmable machines. There are obvious advantages for programmers who use Telegram App.</p>
<ol>
<li>Get Github and Sentry messages directly to your app</li>
<li>Get favorite tweets from Twitter</li>
<li>Get updates from multiple information sources like weather or scores</li>
<li>Control home appliances by sending pre-defined commands</li>
</ol>
<p>Applications are endless. In this IOT generation you need a platform to program and Telegram API provides you that.</p>
<p>This tutorial will use two main ingredients.</p>
<ol>
<li>Telegram app</li>
<li>Telepot python library</li>
</ol>
<h2>Target</h2>
<p>Our goal is to build a PA for us using Bot API provided by Telegram app. We need to install the app</p>
<p><a href="https://play.google.com/store/apps/details?id=org.telegram.messenger&amp;hl=en" target="_blank">Telegram app on Google playstore</a></p>
<p>You can also have a Telegram client for your system. Mine is Ubuntu14.04. You can download all clients here.</p>
<p><a href="https://desktop.telegram.org/" target="_blank">Telegram desktop clients</a></p>
<p>I presume that you installed the telegram app. Now we need to create a bot for us. Telegram provides us a program called Bot Father using which we can create custom bots. Launch BotFather by visiting this link.</p>
<p><a href="https://telegram.me/botfather" target="_blank">https://telegram.me/botfather</a></p>
<p>After adding BotFather to your chat list enter into it, you will see few options like this</p>
<p> </p>
<p><a href="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-213156.png" rel="attachment wp-att-1375"><img class="aligncenter size-full wp-image-1375" src="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-213156.png?w=1000" alt="Screenshot from 2015-12-06 21:31:56"/></a></p>
<p>now type /newbot and hit Enter. It will ask you for a name, give that. Next it will generate an API key, which we are going to use to build our Bot. Store this <strong>API key</strong>. It also gives a<strong> link to your bot</strong>. Visit that link to add it as one of your friends. Share it to others if you want to.</p>
<h2>Telepot, a python client for Telegram</h2>
<p>Telepot is a python client which is the REST wrapper for Telegram API. Using it we can take commands from user and compute something and give back results to the user. Now I am going to build a small bot program which does following things when below commands are given.</p>
<ol>
<li><strong>/timeline</strong> -&gt; Should fetch the latest tweets on my timeline</li>
<li><strong>/tweet=message</strong>  -&gt; Should tweet my message on Twitter</li>
<li><strong>/chat</strong>  -&gt; Should launch a virtual chat with machine</li>
<li><strong>/stopchat</strong> -&gt; You are bored and stop chatting</li>
</ol>
<p>These tasks might be simpler one. But you should be aware that if you know how to unleash the power of message passing between devices you can define your own custom tasks which can have greater value of application. Code for this application is at  <a href="https://github.com/narenaryan/Mika" target="_blank">https://github.com/narenaryan/Mika</a></p>
<h2>Let us build the PA</h2>
<p>First we need to install the sufficient libraries for constructing the Virtual Assistant. I name my PA as mika.</p>
<pre class="code-pre ">$ virtualenv  telegram-bot
$ source telegram-bot/bin/activate
$ pip install telepot tweepy nltk</pre>
<p>We are installing telepot for sending and receiving messages from Telegram. NLTK for using it’s virtual chat engines. Tweepy is used for accessing twitter account through consumer keys. For now I am creating a simple bot command which returns “Hello, how are you?” when we say hello to it.</p>
<pre class="code-pre "># pa.py
import telepot, time

def handle(msg):
    chat_id = msg['chat']['id']
    command = msg['text']
    print 'Got command: %s' % command

    if command == '/hello':
        bot.sendMessage(chat_id, "Hello, how are you?")

# Create a bot object with API key
bot = telepot.Bot('152871568:AAFRaZ6ibZQ52wEs2sd2XXXXXXXXX')

# Attach a function to notifyOnMessage call back
bot.notifyOnMessage(handle)

# Listen to the messages
while 1:
    time.sleep(10)

</pre>
<p>Run<strong> $ python pa.py </strong></p>
<p>Now enter /hello in the bot channel you created. you will see the following output.</p>
<p><a href="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-214920.png" rel="attachment wp-att-1379"><img class="aligncenter size-full wp-image-1379" src="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-214920.png?w=1000" alt="Screenshot from 2015-12-06 21:49:20"/></a></p>
<p>So our bot received our message and replied back to us with the greeting. It is actually the Python code running under the hood managing those tasks. Code is very simple. We need to</p>
<ul>
<li>Create  Bot object using API key</li>
<li>Create a function for handling commands and returning information</li>
<li>Attach the above function to call back handler of Bot. Whenever bot receives a message this function handler executes. We can have any logic in those handlers.</li>
</ul>
<p>You can see what all inputs you can accept and types of outputs you can send to users from bot here. <a href="https://github.com/nickoala/telepot" target="_blank">telepot github link</a></p>
<p>For now let us Integrate twitter and chat engines of NLTK into our bot. We all know that NLTK comes with few chat engines like Eliza, Iesha,Zen etc. I am here using a chatbot called Iesha. Before I create a file called tweep.py for managing my tweet and timeline fetch tasks.</p>
<pre class="code-pre "># tweep.py
import tweepy

#I prepared this class for simplicity. Fill in details and use it.
class Tweet:
    #My Twitter consumer key
    consumer_key='3CbMubgpZvXXXXXXXXXX'
    #My consumer secret
    consumer_secret='Clua2xLNfvbjj3Zoi4BQU5EXXXXXXXXXXX'
    #My access token
    access_token='153952894-cPurjdaQW7bA3B3eXXXXXXXXXXXX'
    #My access token secret
    access_token_secret='r6NJ6qjPrYDenqwuHaop1eBnXXXXXXXXXXXXX'

    def __init__(self):
        self.auth = tweepy.OAuthHandler(self.consumer_key,self.consumer_secret)
        self.auth.set_access_token(self.access_token, self.access_token_secret)
        self.handle = tweepy.API(self.auth)

        def hitme(self,str):
            self.handle.update_status(str)
            print 'tweet posted succesfully'

</pre>
<p>Now let me finish the show with adding both chatting and Tweeting.</p>
<pre class="code-pre ">import telepot, time
from nltk.chat.iesha import iesha_chatbot
from tweep import Tweet

# create tweet client
tweet_client = Tweet()
is_chatting = False

def handle(msg):
    global is_chatting
    global tweet_client
    chat_id = msg['chat']['id']
    command = msg['text']
    print 'Got command: %s' % command
    
    if command == '/timeline' and not is_chatting:
        bot.sendMessage(chat_id, '\n'.join([message.text for message in tweet_client.handle.home_timeline()]))
    elif command.split('=')[0] == '/tweet' and not is_chatting:
        try:
            tweet_client.hitme(command.split('=')[1] + ' #mika')
            bot.sendMessage(chat_id, 'Your message tweeted successfully')
        except:
            bot.sendMessage(chat_id, 'There is some problem tweeting! Try after some time')
    elif command == '/chat':
        is_chatting = True
        bot.sendMessage(chat_id, 'Hi I am Iesha. Who are You?')
    elif command == '/stopchat':
        is_chatting = False
        bot.sendMessage(chat_id, 'Bye Bye. take care!')
    elif not command.startswith('/') and is_chatting:
        bot.sendMessage(chat_id, iesha_chatbot.respond(command))
    else:
        pass


# Create a bot object with API key
bot = telepot.Bot('152871568:AAFRaZ6ibZQ52wEs2sd2Tp4Wcs-IXoWfA-Q')

# Attach a function to notifyOnMessage call back
bot.notifyOnMessage(handle)

# Listen to the messages
while 1:
 time.sleep(10)

</pre>
<p>So output screens will be like this for /chat and /tweet</p>
<p><a href="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-234121.png" rel="attachment wp-att-1383"><img class="aligncenter size-full wp-image-1383" src="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-234121.png?w=1000" alt="Screenshot from 2015-12-06 23:41:21"/></a></p>
<p>For /timeline</p>
<p><a href="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-234232.png" rel="attachment wp-att-1384"><img class="aligncenter size-full wp-image-1384" src="https://impythonist.files.wordpress.com/2015/12/screenshot-from-2015-12-06-234232.png?w=1000" alt="Screenshot from 2015-12-06 23:42:32"/></a></p>
<p>Isn’t it funny. We can add lots of features to this basic personal assistant bot like</p>
<ol>
<li>Tracking time</li>
<li>Scheduler and alert</li>
<li>Notes taking etc</li>
<li>Opening your garage gate when you push a command to bot</li>
</ol>
<p>If you observe the code there isn’t much in that. I just used Elisha chat bot from NLTK. Used tweepy methods to fetch timeline and post a tweet. If you want to use code visit my repo.</p>
<p><a href="https://github.com/narenaryan/Mika" target="_blank">https://github.com/narenaryan/Mika</a></p>
<p>Thanks for reading this stuff. Hope it will be helpful for you to build your own IOT.</p>
		<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-62549587-1367-56d5a98831cef" data-src="//widgets.wp.com/likes/#blog_id=62549587&amp;post_id=1367&amp;origin=impythonist.wordpress.com&amp;obj_id=62549587-1367-56d5a98831cef" data-name="like-post-frame-62549587-1367-56d5a98831cef"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p></div>					</div>

	</div></body></html>