<html><body><div><div id="content">

            

            
        


            <div class="section">
              <h1>ogn-python 0.2.1</h1>

              


<p>A python module for the Open Glider Network</p>








<a href="https://travis-ci.org/glidernet/ogn-python" rel="nofollow"><img src="https://img.shields.io/travis/glidernet/ogn-python.svg"/>
</a>
<a href="https://pypi.python.org/pypi/ogn-python" rel="nofollow"><img src="https://img.shields.io/pypi/v/ogn-python.svg"/>
</a>
<p>A python module for the <a href="http://wiki.glidernet.org/" rel="nofollow">Open Glider
Network</a>. The submodule ‘ogn.gateway’ is
an aprs client which could be invoked via a CLI or used by other python
projects. The CLI allows to save all received beacons into a database
with <a href="http://www.sqlalchemy.org/" rel="nofollow">SQLAlchemy</a>. The
<a href="https://www.sqlite.org/" rel="nofollow">sqlite</a>-backend is sufficient for simple
testing, but some tasks (e.g. logbook generation) require a proper
backend like <a href="http://www.postgresql.org/" rel="nofollow">postgresql</a>. An external
python project would instantiate ogn.gateway and register a custom
callback, called each time a beacon is received.</p>
<p><a href="https://github.com/glidernet/ogn-python/wiki/Examples" rel="nofollow">Examples</a></p>
<div id="usage-python-module">
<h2>Usage - python module</h2>
<p>Implement your own gateway by using ogn.gateway with a custom callback
function. Each time a beacon is received, this function gets called and
lets you process the incoming data.</p>
<p>Example:</p>
<pre><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">ogn.model</span> <span class="kn">import</span> <span class="n">AircraftBeacon</span><span class="p">,</span> <span class="n">ReceiverBeacon</span>
<span class="kn">from</span> <span class="nn">ogn.gateway.client</span> <span class="kn">import</span> <span class="n">ognGateway</span>


<span class="k">def</span> <span class="nf">process_beacon</span><span class="p">(</span><span class="n">beacon</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">beacon</span><span class="p">)</span> <span class="ow">is</span> <span class="n">AircraftBeacon</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Received aircraft beacon from {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beacon</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">beacon</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ReceiverBeacon</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Received receiver beacon from {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beacon</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">gateway</span> <span class="o">=</span> <span class="n">ognGateway</span><span class="p">(</span><span class="n">aprs_user</span><span class="o">=</span><span class="s1">'N0CALL'</span><span class="p">)</span>
    <span class="n">gateway</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">gateway</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="n">process_beacon</span><span class="p">,</span> <span class="n">autoreconnect</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Stop ogn gateway'</span><span class="p">)</span>

    <span class="n">gateway</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre>
</div>
<div id="usage-cli">
<h2>Usage - CLI</h2>
<div id="installation-and-setup">
<h3>Installation and Setup</h3>
<ol>
<li><p>Checkout the repository</p>
<pre>git clone https://github.com/glidernet/ogn-python.git
</pre>
</li>
<li><p>Install python requirements</p>
<pre>pip install -r requirements.txt
</pre>
</li>
<li><p>Install redis for asynchronous tasks (like takeoff/landing-detection)</p>
<pre>apt-get install redis-server
</pre>
</li>
<li><p>Create database</p>
<pre>./manage.py db.init
</pre>
</li>
</ol>
</div>
<div id="running-the-aprs-client-and-task-server">
<h3>Running the aprs client and task server</h3>
<p>To schedule tasks like takeoff/landing-detection (<tt>logbook.compute</tt>),
<a href="http://www.celeryproject.org/" rel="nofollow">Celery</a> with
<a href="http://www.redis.io/" rel="nofollow">Redis</a> is used. The following scripts run in
the foreground and should be deamonized (eg. use
<a href="http://supervisord.org/" rel="nofollow">supervisord</a>).</p>
<ul>
<li><p>Start the aprs client</p>
<pre>./manage.py gateway.run
</pre>
</li>
<li><p>Start a task server (make sure redis is up and running)</p>
<pre>celery -A ogn.collect worker -l info
</pre>
</li>
<li><p>Start the task scheduler (make sure a task server is up and running)</p>
<pre>celery -A ogn.collect beat -l info
</pre>
</li>
</ul>
<p>To load a custom configuration, create a file <tt>myconfig.py</tt> (see
<a href="https://github.com/glidernet/ogn-python/blob/master/config/default.py" rel="nofollow">config/default.py</a>) and set the environment
variable <tt>OGN_CONFIG_MODULE</tt> accordingly.</p>
<pre>touch myconfig.py
export OGN_CONFIG_MODULE="myconfig"
./manage.py gateway.run
</pre>
</div>
<div id="manage-py-cli-options">
<h3>manage.py - CLI options</h3>
<pre>usage: manage.py [&lt;namespace&gt;.]&lt;command&gt; [&lt;args&gt;]

positional arguments:
  command     the command to run

optional arguments:
  -h, --help  show this help message and exit

available commands:

  [db]
    drop                   Drop all tables.
    import_ddb             Import registered devices from the DDB.
    import_file            Import registered devices from a local file.
    init                   Initialize the database.
    upgrade                Upgrade database to the latest version.

  [gateway]
    run                    Run the aprs client.

  [logbook]
    compute                Compute takeoffs and landings.
    show                   Show a logbook for &lt;airport_name&gt; located at given position.

  [show.devices]
    stats                  Show some stats on registered devices.

  [show.receiver]
    hardware_stats         Show some statistics of receiver hardware.
    list_all               Show a list of all receivers.
    software_stats         Show some statistics of receiver software.
</pre>
<p>Only the command <tt>logbook.compute</tt> requires a running task server
(celery) at the moment.</p>
</div>
<div id="available-tasks">
<h3>Available tasks</h3>
<ul>
<li><tt>ogn.collect.database.import_ddb</tt> - Import registered devices from
the ddb</li>
<li><tt>ogn.collect.database.import_file</tt> - Import registered devices from
a local file</li>
<li><tt>ogn.collect.heatmap.update_beacon_receiver_distance_all</tt> -
Calculate the distance between aircraft and receiver for the last
aircraft beacons</li>
<li><tt>ogn.collect.receiver.update_receivers</tt> - Populate/update receiver
table (requires postgresql-backend)</li>
<li><tt>ogn.collect.logbook.compute_takeoff_and_landing</tt> - Generate
TakeoffLanding table (requires postgresql-backend)</li>
</ul>
<p>If the task server is up and running, tasks could be started manually.</p>
<pre>python3
&gt;&gt;&gt;from ogn.collect.database import import_ddb
&gt;&gt;&gt;import_ddb.delay()
</pre>
</div>
</div>
<div id="license">
<h2>License</h2>
<p>Licensed under the AGPLv3.</p>
</div>


<a name="downloads"> </a>


<ul class="nodot">
  <li><strong>Downloads (All Versions):</strong></li>
  <li>
    <span>0</span> downloads in the last day
  </li>
  <li>
    <span>59</span> downloads in the last week
  </li>
  <li>
    <span>361</span> downloads in the last month
  </li>
</ul>









            </div>


          </div>
          </div></body></html>