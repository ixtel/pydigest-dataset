<html><body><div><div>
<p>GraphQL is an interesting technology originating at Facebook. It is a
query language that lets you get JSON results from a server. It's
<em>not</em> a database system but can work with any kind of backend
structure. It tries to solve the same issues traditionally solved by
HTTP "REST-ish" APIs.</p>
<div class="section" id="some-problems-with-rest">
<h2>Some problems with REST</h2>
<p>When you do a REST-ish HTTP API, you expose information about the
server on a bunch of URLs. These URLs each return some data, typically
JSON. You can also update the server using HTTP methods, such as
<tt class="docutils literal">POST</tt>, <tt class="docutils literal">PUT</tt> and <tt class="docutils literal">DELETE</tt>. The client-side code needs to know
what URLs exist on the system and construct URLs based on what it
wants to know. If your REST-ish HTTP API is also a proper REST API
(aka a hypermedia API), you make sure that all information can
actually be accessed without constructing URLs but by following links
(or doing search requests) instead -- this is more loosely coupled but
also more difficult to implement.</p>
<p>But REST-ish HTTP APIs have some problems:</p>
<dl class="docutils">
<dt>spamminess</dt>
<dd>
<p class="first">Imagine you have person resources and address resources.
If you have a UI on the client that shows a person's address, you
will have to access both resources on separate URLs. This can easily
add up to a lot of requests from the client to the server. This not
only causes network traffic but can also make it harder to program
the client, especially if you can only do a new request based on
information you got in another response.</p>
<p class="last">You can reduce this problem by embedding information -- a person
resource has address information directly embedded in it. But
there's no standard way to control what gets embedded and this makes
the next issue worse.</p>
</dd>
<dt>too much information</dt>
<dd>In a HTTP API, you want to send out as much information about a
resource as possible, even if a particular UI doesn't need it. This
means that there is more network traffic, and possibly more work
done on the server to generate the data even though it's not needed.</dd>
<dt>too little information</dt>
<dd>There is typically rather little machine-readable metadata that
describes what the information on the server really exists. Having
such information can really help with tooling, and this in turn can
help avoid bugs. There are emerging specifications that tackle this,
but they're not commonly used.</dd>
</dl>
<p>REST will be here to stay for the foreseeable future. There is also
nothing inherent in REST that stops you from solving this -- I wrote
about this in a <a class="reference external" href="http://blog.startifact.com/posts/graphql-and-rest.html">previous blog entry</a>. But meanwhile GraphQL has
already solved much of this stuff, so at the very least is interesting
to explore.</p>
</div>
<div class="section" id="graphql">
<h2>GraphQL</h2>
<p>GraphQL introduces a query language that lets the client express what
it really wants from the server. A single request with this query goes
to the server, and the server comes back with a complete structure
with everything that's needed for a particular state of the UI. To get
person information with its address information embedded, you can
write something like:</p>
<pre class="literal-block">
{
  person(id: 101) {
    fullname,
    address {
      street
      number
      postalCode
      city
      country
    }
  }
}
</pre>
<p>You get back JSON like:</p>
<pre class="literal-block">
{
  "person":
    "fullname": "Bob Lasereyes',
    "address: {
      "street": "Laserstreet",
      "number": "77",
      "postalCode": "XYZQ",
      "city": "Super City",
      "country": "Mutantia"
  }
}
</pre>
<p>Check the <a class="reference external" href="https://github.com/facebook/graphql/blob/master/README.md">GraphQL readme</a> for much more.</p>
<p>This solves the issues with RESTish HTTP APIs:</p>
<dl class="docutils">
<dt>less spamminess</dt>
<dd>To represent a single UI state you can typically get away with doing
just a single request to the server specifying everything you need. The
server then gives you a single response.</dd>
<dt>the right amount of information</dt>
<dd>You only get the information you ask for, nothing more, nothing less.</dd>
<dt>enough meta information</dt>
<dd>The server has a schema (which tools can introspect) that describes
exactly what kind of data you can access.</dd>
</dl>
</div>
<div class="section" id="relay">
<h2>Relay</h2>
<p>If you use GraphQL with the React UI library there's another project
from Facebook you can use with it: <a class="reference external" href="https://facebook.github.io/relay/">Relay</a>. Relay lets you declare what
data you want (using GraphQL), co-locate GraphQL snippets with the
bits of UI that need it, so your UIs are more composable and can be
rearranged more easily, and has a sophisticated system to help with
mutations, so that you display the updated information in the
UI as quickly as possible without re-fetching too much data.</p>
<p>It's cool, it's just new, I want to explore it to see whether it can
tackle some of my use cases and make life easier for developers.</p>
</div>
<div class="section" id="on-the-server-side">
<h2>On the server side</h2>
<p>So Relay and GraphQL are interesting and cool. So what do we need to
start using it? To use React with Relay on the client side to build
UIs, we need a Relay-compliant GraphQL server.</p>
<p>Facebook released a reference implementation of GraphQL, in
JavaScript: <a class="reference external" href="https://github.com/graphql/graphql-js">graphql-js</a>.  It also released a library to help make a
GraphQL server Relay compliant, again in JavaScript:
<a class="reference external" href="https://github.com/graphql/graphql-relay-js">graphql-relay-js</a>. It also released a server that exposes GraphQL
over HTTP, again in JavaScript: <a class="reference external" href="https://github.com/graphql/express-graphql">express-graphql</a>.</p>
<p>That's all very cool if your server is in JavaScript. But what if your
server is in Python? Luckily the Facebook people anticipated this and
GraphQL is not bound to JavaScript. See the <a class="reference external" href="https://facebook.github.io/graphql/">GraphQL draft
specification</a> and the <a class="reference external" href="https://facebook.github.io/relay/docs/graphql-relay-specification.html">GraphQL Relay specification</a>.</p>
</div>
<div class="section" id="the-python-graphql-stack">
<h2>The Python GraphQL stack</h2>
<p>Last week I started exploring the state of the GraphQL stack in Python
on the server. I was very pleased to find that it was in good shape already:</p>
<ul class="simple">
<li>
<a class="reference external" href="https://github.com/dittos/graphqllib">graphqllib</a>: this is an implementation of GraphQL by Taeho Kim
with contributions by an emerging open source community around
it. Lots of contributions are by Jake Heinz, who was also very
helpful in discussions on the Slack chat (<cite>#python</cite> at
<a class="reference external" href="https://graphql-slack.herokuapp.com/">https://graphql-slack.herokuapp.com/</a>).</li>
<li>
<a class="reference external" href="https://github.com/syrusakbary/graphql-relay-py">graphql-relay-py</a>: an implementation of <cite>graphql-relay-js</cite> for Python by
Syrus Akbary, so we can make our GraphQL Relay server
more compliant.</li>
</ul>
<p>The piece that was missing was actually using this stack as a backend
for a React + Relay frontend. Was it mature enough to do this? I
figured I'd give it a try. So I set out to port the one missing piece
to Python, the HTTP web server. So I took <cite>express-graphql</cite> and ported
over its code and tests to Python + WSGI using WebOb. The result is
<a class="reference external" href="https://github.com/faassen/wsgi_graphql">wsgi_graphql</a>, a WSGI component that offers the same HTTP API as
<cite>express-graphql</cite>.</p>
<p>It was a fun little exercise. I found a few issues in <cite>graphqllib</cite>
while doing so, and they're fixed already. I even found a minor bug
in <cite>express-graphql</cite> while doing so, which is fixed as well.</p>
<p>So does it work? Can you use React and Relay on the frontend with
Python on the backend? I created a demo project, <a class="reference external" href="https://github.com/faassen/relaypy">relaypy</a>, that
experimentally pulls all these pieces together. It exposes a GraphQL
server with a Relay-compliant schema. I hooked up some simple React +
Relay code on the frontend. <em>It worked!</em> In addition, I threw in a cool introspection/query UI
that was created for GraphQL called <cite>GraphiQL</cite>. This works too!</p>
<p>Should you be using this stuff in the real world? No, not yet. There
are big warning letters on the graphqllib project that it's <strong>highly
experimental</strong>. But while it's all very early days for these
components, but the Python support has come very far in just a few
short months -- GraphQL was only released as a public project in July,
and Relay is even younger. I expect that in a short time this stuff
will be ready for production and we'll have a capable GraphQL stack in
Python that we can use with React and Relay.</p>
</div>
<div class="section" id="bonus-graphene">
<h2>Bonus: Graphene</h2>
<p>Emerging just last week as well was <a class="reference external" href="https://github.com/syrusakbary/graphene">graphene</a>, which a very new
library by Syrus Akbary to make implementing GraphQL servers more
Pythonic. The API offered by <cite>graphqllib</cite> is rather low-level, which
is nice as it's very flexible, but for many Python projects you'd like
to use something more Pythonic. Graphene promises to be that API.</p>
</div>
</div>
    </div></body></html>