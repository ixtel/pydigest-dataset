<html><body><div><div class="comment-body markdown-body markdown-format js-comment-body">
          <p><strong>Edit:</strong></p>

<p>Like all benchmarks, this one is flawed. PyPy does resize at a load factor of 2/3, yes, but it resizes by a factor of 4, not a factor of 2 as C++ does. Accounting for this,</p>

<pre><code>// Just doing "s.max_load_factor(2./3)" isn't enough
// as PyPy resizes by a factor of 4
int32_t reserved = 2;
while (2 * reserved &lt;= 3 * number) { reserved &lt;&lt;= 2; }
s.reserve(reserved);
</code></pre>

<p>makes C++ come a few percentage points faster than PyPy. Saddeningly, one can no longer claim PyPy to be faster, although getting C++ to a competitive point took a lot more effort.</p>

<p>I wouldn't just dismiss parity with heavily-optimized C++, though!</p>

<hr/>

<pre><code>&gt;&gt;&gt; time pypy just_some_python.py
52676
pypy just_some_python.py  0.34s user 0.01s system 99% cpu 0.348 total
</code></pre>



<pre><code>&gt;&gt;&gt; g++ -std=c++14 -O3 just_some_cplusplus.cpp -o just_some_cplusplus.out
&gt;&gt;&gt; time ./just_some_cplusplus.out
52676
./just_some_cplusplus.out  0.44s user 0.00s system 99% cpu 0.437 total
</code></pre>

<hr/>

<p>Versions, on reminder from <a href="http://www.reddit.com/user/wyldphyre">wyldphyre</a>:</p>

<pre><code>&gt;&gt;&gt; pypy --version
Python 2.7.6 (3cf384e86ef7, Jul 09 2014, 04:28:24)
[PyPy 2.4.0-alpha0 with GCC 4.9.0 20140604 (prerelease)]
</code></pre>



<pre><code>&gt;&gt;&gt; g++ --version
g++ (GCC) 4.9.1
</code></pre>

<hr/>

<p><code>perf stat</code> output, on request from <a href="http://www.reddit.com/user/Imxset21">Imxset21</a>:</p>

<pre><code>&gt;&gt;&gt; perf stat -B pypy just_some_python.py
52676

 Performance counter stats for 'pypy just_some_python.py':

        356.810792      task-clock (msec)         #    1.000 CPUs utilized          
                 1      context-switches          #    0.003 K/sec                  
                 1      cpu-migrations            #    0.003 K/sec                  
             7,747      page-faults               #    0.022 M/sec                  
     1,122,951,081      cycles                    #    3.147 GHz                    
   &lt;not supported&gt;      stalled-cycles-frontend  
   &lt;not supported&gt;      stalled-cycles-backend   
     1,842,013,319      instructions              #    1.64  insns per cycle        
       426,880,039      branches                  # 1196.376 M/sec                  
        11,606,870      branch-misses             #    2.72% of all branches        

       0.356679893 seconds time elapsed
</code></pre>



<pre><code>&gt;&gt;&gt; perf stat -B ./just_some_cplusplus.out
52676

 Performance counter stats for './just_some_cplusplus.out':

        440.630517      task-clock (msec)         #    1.001 CPUs utilized          
                 1      context-switches          #    0.002 K/sec                  
                 0      cpu-migrations            #    0.000 K/sec                  
               102      page-faults               #    0.231 K/sec                  
     1,390,791,156      cycles                    #    3.156 GHz                    
   &lt;not supported&gt;      stalled-cycles-frontend  
   &lt;not supported&gt;      stalled-cycles-backend   
       553,660,623      instructions              #    0.40  insns per cycle        
       126,883,541      branches                  #  287.959 M/sec                  
        11,647,020      branch-misses             #    9.18% of all branches        

       0.440386974 seconds time elapsed
</code></pre>

<hr/>

<p><a href="http://www.reddit.com/user/msiemens">msiemens</a> wanted more data than just a single time, so I plotted it:</p>

<pre><code>python plot_times.py 128 "./just_some_cplusplus.out" "./just_some_cplusplus_default_load_factor.out" "pypy just_some_python.py" "pypy3 just_some_python.py"
</code></pre>

<p><a href="https://camo.githubusercontent.com/9ea7833b85ee89814ed6aaba5de4f6c068088d2a/687474703a2f2f692e696d6775722e636f6d2f733972626649372e706e67" target="_blank"><img src="https://camo.githubusercontent.com/9ea7833b85ee89814ed6aaba5de4f6c068088d2a/687474703a2f2f692e696d6775722e636f6d2f733972626649372e706e67" alt="PDE and histogram of time to run, comparing C++ with both a default load factor and a load factor of 2/3, and PyPy and PyPy3" data-canonical-src="http://i.imgur.com/s9rbfI7.png"/></a></p>
      </div>
    </div></body></html>