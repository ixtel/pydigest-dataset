<html><body><div><div class="entry-content description clearfix">
		    <p>So i have some django webb projects and now its time to get my django apps prod ready with docker.<br/>
My plan is to with jenkins build my django apps (soon start a docker of the app and run some test but that will be later) make a docker image and send that to the docker cloud.</p>
<p>Then a can download the docker image on my prod server and start the app. I hope that this also can be triggerd from my jenkins so the flow will be</p>
<p> </p>
<p><strong>me -&gt;push github master -&gt; jenkins make build and docker image -&gt; push up to dockercloud -&gt; prodserver gets image and deploy to server</strong></p>
<p> </p>
<p>And i would like this flow to start from my push to the master branch in github. So my masterpush gets my data from dev to prod.</p>
<h2>1. Dockerfile</h2>
<p> </p>
<p>First task is to make a dockerfile to use for my app.<br/>
In the base django app i created a folder called Docker and put the dockerfile there.</p>
<p>1. I use centos7 as base<br/>
2. I have e file in called req.sh that contains all my pip req for my project<br/>
3. I have i defult settings file for my django project that I use in the docker build(Match this to you own settings).</p>
<p>I also have the plan to mount static content from the host into the docker image so that is in the dockerfile but not activated.</p>
<p> </p>
<p>Here is the link to my <a title="Dockerfile" href="https://github.com/mattiashem/asylguiden/blob/master/Docker/Dockerfile">dockerfile</a></p>
<p>to build the image i use</p>
<p> </p>
<pre>sudo docker build -t mattiashem/theguide --no-cache .</pre>
<p>And to run to test the server in DEV MODE use.</p>
<p> </p>
<pre>sudo docker  run -i -p 8080:8080 mattiashem/theguide  python /var/www/asylguiden/manage.py runserver 0.0.0.0:8080</pre>
<p>And to run the server in prod mode use</p>
<p> </p>
<pre>docker run -d -p 8000:8000 mattiashem/theguide /var/www/asylguiden/Docker/start_prod.sh</pre>
<p> </p>
<p>I use gunicorn as prodserver for djangoproject and i have a small bash script that will start the app.</p>
<p>(questions about media and server check out next post when I setup the prod servers)</p>
<p> </p>
<p>Now we should have a working docker running on our localserver lets get into the dockercloud</p>
<p> </p>
<pre>sudo docker login</pre>
<pre>sudo docker push mattiashem/theguide</pre>
<p> </p>
<p>And now we have build our app and push it to the dockercloud ready to be used.</p>
<p> </p>
<h3>2. Getting jenkins to build my app and make the dockerimage and push it upto the docker cloud.</h3>
<p>First lets fix sudo for the jenkins user so we can use docker.</p>
<p> </p>
<pre>visudo</pre>
<p> </p>
<p>fix this make the jenkins user allow to run docker and dont req tty</p>
<p> </p>
<pre>jenkins ALL=(docker) NOPASSWD: ALL</pre>
<pre>#Defaults requiretty</pre>
<p> </p>
<p>login to the dockercloud with</p>
<p> </p>
<pre>docker login</pre>
<p> </p>
<p> </p>
<p>Now the server is ready to build the dockerimage. Start i new project and make it checkout you code and set other settings.<br/>
Then in the last “exchute shell” past something like this in</p>
<p> </p>
<pre>echo "Building docker image"
 pwd
 cd Docker
 pwd
 echo "Buildning docker image"
 sudo docker build -t mattiashem/theguide --no-cache .
 sudo docker push mattiashem/theguide</pre>
<p> </p>
<p> </p>
<p>This will now build the docker image and the push the new build image to the dockercloud ready to be used.</p>
<p> </p>
<p> </p>
<h3>3. To to</h3>
<p>Fix so that the jenkins server start a dockerimage and then perform some test on the new dockerbuild.</p>
<p> </p>
<p> </p>
<div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-53201497-357-56d5a044c29e3" data-src="//widgets.wp.com/likes/#blog_id=53201497&amp;post_id=357&amp;origin=lifeandshell.com&amp;obj_id=53201497-357-56d5a044c29e3" data-name="like-post-frame-53201497-357-56d5a044c29e3"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p><p class="adsxpls" id="adsxpls2">
</p>	    </div>
	    	</div></body></html>