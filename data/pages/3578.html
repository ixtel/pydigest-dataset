<html><body><div><section class="post-content">
		    <p><em>This post is by Chou-han Yang, principal engineer at BloomReach.</em></p>
<p>Today we are excited to announce <a href="https://github.com/bloomreach/briefly">Briefly</a>, a new open-source project designed to tackle the challenge of simultaneously handling the flow of Hadoop and non-Hadoop tasks. In short, Briefly is a Python-based, meta-programming job-flow control engine for big data processing pipelines. We called it <em>Briefly</em> because it provides us with a way to describe complex data processing flows in a very concise way.</p>
<p>At BloomReach, we have hundreds of Hadoop clusters running with different applications at any given time. From parsing HTML pages and creating indexes to aggregating page visits, we all rely on Hadoop for our day to day work. The job sounds simple, but the challenge is to handle complex operational issues without compromising code quality, as well as the ability to control a group of Hadoop clusters to maximize efficiency.</p>
<p>Among our biggest challenges are:</p>
<ul>
<li>Data skew, or the high variance of data volume from different customers.</li>
<li>Non-Hadoop tasks are mixed in with the Hadoop tasks and need to be completed before or after the Hadoop tasks.</li>
<li>The fact that we run Elastic Map Reduce (EMR) with spot instances, which means clusters might be killed because of spot instance price spikes.</li>
</ul>
<p>There are several different approaches to solve similar problems with pipeline abstraction, including <a href="http://www.cascading.org/">cascading</a> and <a href="https://github.com/spotify/luigi">Luigi</a>, but they all solve our problems partially. They all provide some features, but none of them help in the case of multiple Hadoop clusters. That’s why we turned to <em>Briefly</em> to solve our large-scale pipeline processing problems.</p>
<p>The main idea behind <em>Briefly</em>, is to wrap all types of jobs into a concise Python function, so we only need to focus on the job flow logic instead of operational issues (such as fail/retry). For example, a typical Hadoop job in <em>Briefly</em> is wrapped like this:</p>
<p/>

		<div id="crayon-56d5a7a435318761233253" class="crayon-syntax crayon-theme-familiar crayon-font-monospace crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7a435318761233253-1"> </p><p class="crayon-line" id="crayon-56d5a7a435318761233253-2"><span class="crayon-sy">@</span><span class="crayon-e">simple_hadoop_process</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-3"><span class="crayon-e">def </span><span class="crayon-e">preprocess</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-4"><span class="crayon-h">  </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">defaults</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-5"><span class="crayon-h">    </span><span class="crayon-v">main_class</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'com.bloomreach.html.preprocess'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-6"><span class="crayon-h">    </span><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'${input}'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'${output}'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-7"><span class="crayon-h">  </span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-8"> </p><p class="crayon-line" id="crayon-56d5a7a435318761233253-9"><span class="crayon-sy">@</span><span class="crayon-e">simple_hadoop_process</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-10"><span class="crayon-e">def </span><span class="crayon-e">parse</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-11"><span class="crayon-h">  </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">defaults</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-12"><span class="crayon-h">    </span><span class="crayon-v">main_class</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'com.bloomreach.html.parser'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-13"><span class="crayon-h">    </span><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'${input}'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'${output}'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-14"><span class="crayon-h">  </span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a435318761233253-15"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>And similarly, a Java process and a python process look like this:</p>
<p/>

		<div id="crayon-56d5a7a43532c798667075" class="crayon-syntax crayon-theme-familiar crayon-font-monospace crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7a43532c798667075-1"> </p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-2"><span class="crayon-sy">@</span><span class="crayon-e">simple_java_process</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-3"><span class="crayon-e">def </span><span class="crayon-e">gen_index</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-4"><span class="crayon-h">  </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">defaults</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-5"><span class="crayon-h">    </span><span class="crayon-v">classpath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'.'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'some.other.classpath'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-6"><span class="crayon-h">    </span><span class="crayon-v">main_class</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'com.bloomreach.html.genIndex'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-7"><span class="crayon-h">    </span><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'${input}'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'${output}'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-8"><span class="crayon-h">  </span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-9"> </p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-10"><span class="crayon-sy">@</span><span class="crayon-e">simple_process</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-11"><span class="crayon-e">def </span><span class="crayon-e">gen_stats</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-12"><span class="crayon-h">  </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-13"><span class="crayon-h">    </span><span class="crayon-p"># Do something here to analyze each line</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-14"><span class="crayon-h">  </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-s">'stats output'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a43532c798667075-15"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>And here’s what it looks like when we chain the jobs together to create dependencies:</p>
<p/>

		<div id="crayon-56d5a7a435332097126616" class="crayon-syntax crayon-theme-familiar crayon-font-monospace crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7a435332097126616-1"> </p><p class="crayon-line" id="crayon-56d5a7a435332097126616-2"><span class="crayon-v">objs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Pipeline</span><span class="crayon-sy">(</span><span class="crayon-s">"My first pipeline"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a435332097126616-3"><span class="crayon-v">prop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">objs</span><span class="crayon-sy">.</span><span class="crayon-e">prop</span></p><p class="crayon-line" id="crayon-56d5a7a435332097126616-4"> </p><p class="crayon-line" id="crayon-56d5a7a435332097126616-5"><span class="crayon-v">parsed_html</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">source</span><span class="crayon-sy">(</span><span class="crayon-v">raw_html</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-e">preprocess</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-e">parse</span><span class="crayon-sy">(</span><span class="crayon-v">params</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a435332097126616-6"><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">parsed_html</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-e">gen_index</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a435332097126616-7"><span class="crayon-v">stats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">parsed_html</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-e">gen_stats</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a435332097126616-8"> </p><p class="crayon-line" id="crayon-56d5a7a435332097126616-9"><span class="crayon-v">targets</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">stats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7a435332097126616-10"><span class="crayon-v">objs</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">targets</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a7a435332097126616-11"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>This script creates the workflow like this:</p>
<p><a href="http://engineering.bloomreach.com/wp-content/uploads/2015/02/ExampleFlow1.png" data-slb-group="11" data-slb-active="1" data-slb-internal="0"><img class="aligncenter size-full wp-image-27" src="http://engineering.bloomreach.com/wp-content/uploads/2015/02/ExampleFlow1.png" alt="ExampleFlow1"/></a></p>
<p>The pipeline can be executed locally (with Hadoop local mode), on Amazon EMR, or on Qubole simply by supplying different configurations. For example, running on Amazon EMR would require the following configuration:</p>
<p/>

		<div id="crayon-56d5a7a435339404176989" class="crayon-syntax crayon-theme-familiar crayon-font-monospace crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-1">1</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-2">2</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-3">3</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-4">4</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-5">5</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-6">6</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-7">7</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-8">8</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-9">9</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-10">10</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-11">11</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-12">12</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-13">13</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-14">14</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-15">15</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-16">16</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-17">17</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-18">18</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-19">19</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-20">20</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-21">21</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-22">22</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-23">23</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-24">24</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-25">25</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-26">26</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-27">27</p><p class="crayon-num" data-line="crayon-56d5a7a435339404176989-28">28</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7a435339404176989-1"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-2"><span class="crayon-p"># emr.conf</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-3"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-4"><span class="crayon-p"># Where to run your pipeline. It can be local, emr, or qubole</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-5"><span class="crayon-v">hadoop</span><span class="crayon-sy">.</span><span class="crayon-v">runner</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"emr"</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-6"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-7"><span class="crayon-p"># Max number of concurrent EMR clusters to be created</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-8"><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">max_cluster</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-9"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-10"><span class="crayon-p"># Instance groups for each cluster</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-11"><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">instance_groups</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"MASTER"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"m2.2xlarge"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"CORE"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"m2.2xlarge"</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-12"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-13"><span class="crayon-p"># Name of your EMR cluster</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-14"><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">cluster_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"my-emr-cluster"</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-15"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-16"><span class="crayon-p"># A unique name for the project for cost tracking purpose</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-17"><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">project_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"my-emr-project"</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-18"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-19"><span class="crayon-p"># Where EMR is going to put yoru log</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-20"><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">log_uri</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"s3://log-bucket/log-path/"</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-21"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-22"><span class="crayon-p"># EC2 key pairs if you want to login into your EMR cluster</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-23"><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">keyname</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ec2-keypair"</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-24"> </p><p class="crayon-line" id="crayon-56d5a7a435339404176989-25"><span class="crayon-p"># Spot instance price upgrade strategy. The multipliers to the EC2 on-demand price you want</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-26"><span class="crayon-p"># to bid against the spot instances. 0 means use on-demand instances.</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-27"><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">price_upgrade_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a7a435339404176989-28"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>Extra keys also need to be provided for specific platforms, such as Amazon EMR:</p>
<p/>

		<div id="crayon-56d5a7a43533f952359894" class="crayon-syntax crayon-theme-familiar crayon-font-monospace crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7a43533f952359894-1"> </p><p class="crayon-line" id="crayon-56d5a7a43533f952359894-2"><span class="crayon-p"># your_pipeline.conf</span></p><p class="crayon-line" id="crayon-56d5a7a43533f952359894-3"> </p><p class="crayon-line" id="crayon-56d5a7a43533f952359894-4"><span class="crayon-v">ec2</span><span class="crayon-sy">.</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"your_ec2_key"</span></p><p class="crayon-line" id="crayon-56d5a7a43533f952359894-5"><span class="crayon-v">ec2</span><span class="crayon-sy">.</span><span class="crayon-v">secret</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"your_ec2_secret"</span></p><p class="crayon-line" id="crayon-56d5a7a43533f952359894-6"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>And then your are good go. Run your <em>Briefly</em> pipeline with all your configuration files:</p>
<p/>

		<div id="crayon-56d5a7a435344243571642" class="crayon-syntax crayon-theme-familiar crayon-font-monospace crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a7a435344243571642-1"> </p><p class="crayon-line" id="crayon-56d5a7a435344243571642-2"><span class="crayon-e">python </span><span class="crayon-v">your_pipeline</span><span class="crayon-sy">.</span><span class="crayon-v">py</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-v">your_pipeline</span><span class="crayon-sy">.</span><span class="crayon-v">conf</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-v">emr</span><span class="crayon-sy">.</span><span class="crayon-v">conf</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">Dbuild_dir</span><span class="crayon-o">=</span><span class="crayon-v">build_dir</span><span class="crayon-sy">_</span>path</p><p class="crayon-line" id="crayon-56d5a7a435344243571642-3"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>Now you can have several different configurations for running job locally, on Qubole, or with different cluster sizes. One thing we find useful is to subdivide a big cluster into smaller clusters which increases the survivability of the entire group of clusters, especially when running on spot instances.</p>
<p><a href="http://engineering.bloomreach.com/wp-content/uploads/2015/02/BigSmallClster.png" data-slb-group="11" data-slb-active="1" data-slb-internal="0"><img class="aligncenter size-full wp-image-23" src="http://engineering.bloomreach.com/wp-content/uploads/2015/02/BigSmallClster.png" alt="BigSmallClster"/></a></p>
<p>The number of clusters and the cluster size can be adjusted according to the jobs being executed. Many small clusters provides better throughput when running with a lot of small jobs. On the other hand, a large job may run longer on a few clusters while other clusters may be terminated after a predetermined idle time. The setting can be changed easily in the configuration for performance tests.</p>
<p>Other features of the <em>Briefly</em> framework are:</p>
<ul>
<li>Use of a <a href="http://en.wikipedia.org/wiki/Hartmann_pipeline">Hartman pipeline</a> to create job flow.</li>
<li>Resource management for multiple Hadoop clusters (<a href="http://aws.amazon.com/elasticmapreduce/">Amazon EMR</a>, <a href="http://www.qubole.com/">Qubole</a>) for parallel execution, also allowing customized Hadoop clusters.</li>
<li>Individual logs for each process to make debugging easier.</li>
<li>Fully resumable pipeline with customizable execution check and error handling.</li>
<li>Encapsulated local and remote filesystem (s3) for unified access.</li>
<li>Automatic download of files from s3 for local processes and upload of files to s3 for remote processes with <a href="https://github.com/bloomreach/s4cmd">s4cmd</a>.</li>
<li>Automatic fail/retry logic for all failed processes.</li>
<li>Automatic price upgrades for EMR clusters with spot instances.</li>
<li>Timeout for Hadoop jobs to prevent long-running clusters.</li>
</ul>
<p>In conclusion, we use <em>Briefly</em> to build and operate complex data processing pipelines across multiple mapreduce clusters. <em>Briefly</em> provides us with an ability to simplify the pipeline building and separate the operational logic from business logic, which makes each component reusable. Special thanks to all the BloomReach contributors who made this project possible:</p>
<ul>
<li>Shao-Chuan Wang</li>
<li>Yiran Wang</li>
<li>Kazuyuki Tanimura</li>
<li>Sumeet Khullar</li>
<li>Prateek Gupta</li>
<li>Amit Kumar</li>
<li>Ching-lun Lin</li>
<li>Viksit Gaur</li>
</ul>
<p>Please leave us feedback, file issues and submit pull requests if you find this useful. The code is available on GitHub at <a href="https://github.com/bloomreach/briefly">https://github.com/bloomreach/briefly</a>.</p>
		    			<p class="clear"> </p>
		</section>
	
	</div></body></html>