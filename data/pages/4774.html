<html><body><div><div class="postcontents">
                    <p>Orator 0.6 is now out. This version introduces model events, query pagination and performance improvements and fixes.</p>

<div class="warning">
<p>The stable version is actually the <strong>0.6.1</strong> version.</p>
<p>The 0.6 version introduced bugs in how relationships were handled, breaking the functionality. Everything should now be fixed in 0.6.1.</p>
</div>

<h2 id="model-events">Model events</h2>

<p>Orator models fire several events, allowing you to hook into various points in
the model’s lifecycle using the following methods:
<code>creating</code>, <code>created</code>, <code>updating</code>, <code>updated</code>, <code>saving</code>, <code>saved</code>, <code>deleting</code>, <code>deleted</code>,
<code>restoring</code>, <code>restored</code>.</p>

<p>Whenever a new item is saved for the first time, the <code>creating</code> and <code>created</code> events will fire.
If an item is not new and the <code>save</code> method is called, the <code>updating</code> / <code>updated</code> events will fire.
In both cases, the <code>saving</code> / <code>saved</code> events will fire.</p>

<h3 id="cancelling-save-operations-via-events">Cancelling save operations via events</h3>

<p>If <code>False</code> is returned from the <code>creating</code>, <code>updating</code>, <code>saving</code>, or <code>deleting</code> events,
the action will be cancelled:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">User</span><span class="o">.</span><span class="n">creating</span><span class="p">(</span><span class="k">lambda</span> <span class="n">user</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span></code></pre></div>

<h2 id="model-observers">Model observers</h2>

<p>To consolidate the handling of model events, you can register a model observer.
An observer class can have methods that correspond to the various model events.
For example, <code>creating</code>, <code>updating</code>, <code>saving</code> methods can be on an observer,
in addition to any other model event name.</p>

<p>So, for example, a model observer might look like this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">UserObserver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">saving</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
        <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">saved</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
        <span class="c"># ...</span></code></pre></div>

<p>You can register an observer instance using the <code>observe</code> method:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">User</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">UserObserver</span><span class="p">())</span></code></pre></div>

<p>There is a lot more you can do with Orator, just give a look at the <a href="http://orator.readthedocs.org">documentation</a>
to see all available features.</p>

<h2 id="pagination">Pagination</h2>

<h3 id="paginate-database-records">Paginate database records</h3>

<p>There are several ways to paginate items. The simplest is by using the <code>paginate</code> method
on the <a href="http://orator.readthedocs.org/en/latest/query_builder.html">Query Builder</a> or an <a href="http://orator.readthedocs.org/en/latest/orm.html">ORM</a> query.
The <code>paginate</code> method provided by Orator automatically takes care of setting the proper limit and offset based on the current page.
By default, the current page needs to be specified.
However, as we’ll see it later, you can create a custom current page resolver.</p>

<h4 id="paginating-query-builder-results">Paginating Query Builder results</h4>

<p>First, let’s take a look at calling the <code>paginate</code> method on a query generated by the query builder:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre></div>

<p>In this example, the first argument passed to paginate is the number of items we would like displayed “per page”
and the second is the current page we want to display. So, in this case, we want to retrieve <code>15</code> items on page <code>2</code>.</p>

<div class="warning">
<p>Currently, pagination operations that use a <code>group_by</code> statement cannot be executed efficiently by Orator.
If you need to use a <code>group_by</code> with a paginated result set, it is recommended that you query the database and create a paginator manually.</p>
</div>

<h4 id="paginating-models">Paginating models</h4>

<p>You can also paginate <a href="http://orator.readthedocs.org/en/latest/orm.html">ORM</a> queries. In this example, we will paginate the <code>User</code> model with <code>15</code> items per page
for the second page. As you can see, the syntax is nearly identical to paginating query builder results:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">all_users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre></div>

<p>Of course, you can call paginate after setting other constraints on the query:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">some_users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'votes'</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre></div>

<h5 id="simple-pagination">Simple pagination</h5>

<p>If you only need “Next” and “Previous” pages in your pagination,
you have the option of using the <code>simple_paginate</code> method to perform a more efficient query.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">some_users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'votes'</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">simple_paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre></div>

<h4 id="creating-a-paginator-manually">Creating a Paginator manually</h4>

<p>Sometimes you may wish to create a pagination instance manually, passing it a list of items.
You can do so by creating either a <code>Paginator</code> or a <code>LengthAwarePaginator</code> instance, depending on your needs.</p>

<p>The <code>Paginator</code> class does not need to know the total number of items in the result set;
however, because of this, the class does not have methods to retrieve the index of the last page.
The <code>LengthAwarePaginator</code> accepts almost the same arguments as the <code>Paginator</code>,
except that it does require a count of the total number of items in the result set.</p>

<p>In other words, the <code>Paginator</code> corresponds to the <code>simple_paginate</code> method on the query builder
and the ORM, while the <code>LengthAwarePaginator</code> corresponds to the <code>paginate</code> method.</p>

<h3 id="displaying-results">Displaying Results</h3>

<p>When you call the <code>paginate</code> or <code>simple_paginate</code> methods on a query builder or ORM query,
you will receive a paginator instance. When calling the <code>paginate</code> method,
you will receive an instance of <code>LengthAwarePaginator</code>. When calling the <code>simple_paginate</code> method,
you will receive an instance of <code>Paginator</code>. These objects provide several methods and attributes
that describe the result set. In addition to these helpers methods, the paginator instances are iterators
and may be looped as a list.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">some_users</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></code></pre></div>

<h4 id="additional-attributes-and-helper-methods">Additional attributes and helper methods</h4>

<p>You may also access additional pagination information via the following methods and attributes
on paginator instances:</p>

<table>
  <thead>
    <tr>
      <th>Method or attribute</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>results.count()</code></td>
      <td>Returns the number of results on the current page</td>
    </tr>
    <tr>
      <td><code>results.current_page</code></td>
      <td>The current page of the paginator</td>
    </tr>
    <tr>
      <td><code>results.has_more_pages()</code></td>
      <td>Returns <code>True</code> if there is more pages else <code>False</code></td>
    </tr>
    <tr>
      <td><code>results.last_page</code></td>
      <td>The number of the last page (Not available when using <code>simple_paginate</code>)</td>
    </tr>
    <tr>
      <td><code>results.next_page</code></td>
      <td>The number of the next page if it exists else <code>None</code></td>
    </tr>
    <tr>
      <td><code>results.per_page</code></td>
      <td>The number of results per page</td>
    </tr>
    <tr>
      <td><code>results.previous_page</code></td>
      <td>The number of the previous page if it exists else <code>None</code></td>
    </tr>
    <tr>
      <td><code>results.total</code></td>
      <td>The total number of results (Not available when using <code>simple_paginate</code></td>
    </tr>
  </tbody>
</table>

<h3 id="converting-results-to-json">Converting Results To JSON</h3>

<p>The Orator paginator result classes expose the <code>to_json</code> method,
so it’s very easy to convert your pagination results to JSON.</p>

<p>By default, it will return the JSON formatted underlying <code>Collection</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">some_users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'votes'</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">some_users</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span></code></pre></div>

<p>For the full list of changes, see the <a href="https://github.com/sdispater/orator/blob/master/CHANGELOG.md">CHANGELOG</a></p>

<h2 id="whats-next">What’s next?</h2>

<p>Finally, here are some features targeted for future versions (actual roadmap to be determined):</p>



                </div>
                </div></body></html>