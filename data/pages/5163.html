<html><body><div><div class="section" id="quickstart">
<h1>Quickstart</h1>
<p>Hi, welcome to the twelve-minute quick-start tutorial.</p>
<div class="section" id="connecting-to-a-database">
<h2>Connecting to a database</h2>
<p>At first you need to import the dataset package :)</p>

<p>To connect to a database you need to identify it by its <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html#engine-creation-api">URL</a>, which basically is a string of the form <code class="docutils literal"><span class="pre">"dialect://user:password@host/dbname"</span></code>. Here are a few examples for different database backends:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># connecting to a SQLite database</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'sqlite:///mydatabase.db'</span><span class="p">)</span>

<span class="c"># connecting to a MySQL database with user and password</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'mysql://user:password@localhost/mydatabase'</span><span class="p">)</span>

<span class="c"># connecting to a PostgreSQL database</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'postgresql://scott:tiger@localhost:5432/mydatabase'</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to define the <cite>URL</cite> as an environment variable called <cite>DATABASE_URL</cite>
so you can initialize database connection without explicitly passing an <cite>URL</cite>:</p>

<p>Depending on which database you’re using, you may also have to install
the database bindings to support that database. SQLite is included in
the Python core, but PostgreSQL requires <code class="docutils literal"><span class="pre">psycopg2</span></code> to be installed.
MySQL can be enabled by installing the <code class="docutils literal"><span class="pre">mysql-db</span></code> drivers.</p>
</div>
<div class="section" id="storing-data">
<h2>Storing data</h2>
<p>To store some data you need to get a reference to a table. You don’t need
to worry about whether the table already exists or not, since dataset
will create it automatically:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># get a reference to the table 'user'</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span>
</pre></div>
</div>
<p>Now storing data in a table is a matter of a single function call. Just
pass a <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict">dict</a> to <em>insert</em>. Note that you don’t need to create the columns
<em>name</em> and <em>age</em> – dataset will do this automatically:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Insert a new record.</span>
<span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John Doe'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">46</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">'China'</span><span class="p">))</span>

<span class="c"># dataset will create "missing" columns any time you insert a dict with an unknown key</span>
<span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Jane Doe'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">37</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">'France'</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s">'female'</span><span class="p">))</span>
</pre></div>
</div>
<p>Updating existing entries is easy, too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John Doe'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">47</span><span class="p">),</span> <span class="p">[</span><span class="s">'name'</span><span class="p">])</span>
</pre></div>
</div>
<p>The list of filter columns given as the second argument filter using the
values in the first column. If you don’t want to update over a
particular value, just use the auto-generated <code class="docutils literal"><span class="pre">id</span></code> column.</p>
</div>
<div class="section" id="using-transactions">
<h2>Using Transactions</h2>
<p>You can group a set of database updates in a transaction. In that case, all updates
are committed at once or, in case of exception, all of them are reverted. Transactions
are supported through a context manager, so they can be used through a <code class="docutils literal"><span class="pre">with</span></code>
statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">dataset</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
    <span class="n">tx</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John Doe'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">46</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">'China'</span><span class="p">))</span>
</pre></div>
</div>
<p>You can get same functionality by invoking the methods <code class="xref py py-meth docutils literal"><span class="pre">begin()</span></code>,
<code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code>
explicitly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">db</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John Doe'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">46</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">'China'</span><span class="p">))</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
<p>Nested transactions are supported too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="k">with</span> <span class="n">db</span> <span class="k">as</span> <span class="n">tx1</span><span class="p">:</span>
    <span class="n">tx1</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John Doe'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">46</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">'China'</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">db</span> <span class="k">as</span> <span class="n">tx2</span><span class="p">:</span>
        <span class="n">tx2</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Jane Doe'</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">37</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s">'France'</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s">'female'</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="inspecting-databases-and-tables">
<h2>Inspecting databases and tables</h2>
<p>When dealing with unknown databases we might want to check their structure
first. To start exploring, let’s find out what tables are stored in the
database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">tables</span><span class="p">)</span>
<span class="go">[u'user']</span>
</pre></div>
</div>
<p>Now, let’s list all columns available in the table <code class="docutils literal"><span class="pre">user</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="go">[u'id', u'country', u'age', u'name', u'gender']</span>
</pre></div>
</div>
<p>Using <code class="docutils literal"><span class="pre">len()</span></code> we can get the total number of rows in a table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s">'user'</span><span class="p">]))</span>
<span class="go">2</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-data-from-tables">
<h2>Reading data from tables</h2>
<p>Now let’s get some real data out of the table:</p>

<p>If we simply want to iterate over all rows in a table, we can omit <a class="reference internal" href="api.html#dataset.Table.all" title="dataset.Table.all"><code class="xref py py-meth docutils literal"><span class="pre">all()</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">db</span><span class="p">[</span><span class="s">'user'</span><span class="p">]:</span>
   <span class="k">print</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s">'age'</span><span class="p">])</span>
</pre></div>
</div>
<p>We can search for specific entries using <a class="reference internal" href="api.html#dataset.Table.find" title="dataset.Table.find"><code class="xref py py-meth docutils literal"><span class="pre">find()</span></code></a> and
<a class="reference internal" href="api.html#dataset.Table.find_one" title="dataset.Table.find_one"><code class="xref py py-meth docutils literal"><span class="pre">find_one()</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># All users from China</span>
<span class="n">chinese_users</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="s">'China'</span><span class="p">)</span>

<span class="c"># Get a specific user</span>
<span class="n">john</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John Doe'</span><span class="p">)</span>
</pre></div>
</div>
<p>Using  <a class="reference internal" href="api.html#dataset.Table.distinct" title="dataset.Table.distinct"><code class="xref py py-meth docutils literal"><span class="pre">distinct()</span></code></a> we can grab a set of rows
with unique values in one or more columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get one user per country</span>
<span class="n">db</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">'country'</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can use the <code class="docutils literal"><span class="pre">row_type</span></code> parameter to choose the data type in which
results will be returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">dataset</span>
<span class="kn">from</span> <span class="nn">stuf</span> <span class="kn">import</span> <span class="n">stuf</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'sqlite:///mydatabase.db'</span><span class="p">,</span> <span class="n">row_type</span><span class="o">=</span><span class="n">stuf</span><span class="p">)</span>
</pre></div>
</div>
<p>Now contents will be returned in <code class="docutils literal"><span class="pre">stuf</span></code> objects (basically, <code class="docutils literal"><span class="pre">dict</span></code>
objects whose elements can be acessed as attributes (<code class="docutils literal"><span class="pre">item.name</span></code>) as well as
by index (<code class="docutils literal"><span class="pre">item['name']</span></code>).</p>
</div>
<div class="section" id="running-custom-sql-queries">
<h2>Running custom SQL queries</h2>
<p>Of course the main reason you’re using a database is that you want to
use the full power of SQL queries. Here’s how you run them with <code class="docutils literal"><span class="pre">dataset</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'SELECT country, COUNT(*) c FROM user GROUP BY country'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
   <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'country'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">'c'</span><span class="p">])</span>
</pre></div>
</div>
<p>The <code class="xref py py-meth docutils literal"><span class="pre">query()</span></code> method can also be used to
access the underlying <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/query.html#the-query-object">SQLAlchemy core API</a>, which allows for the
programmatic construction of more complex queries:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">table</span>
<span class="n">statement</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s">'%John%'</span><span class="p">))</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="exporting-data">
<h2>Exporting data</h2>
<p>While playing around with our database in Python is a nice thing, they are
sometimes just a processing stage until we go on to use it in another
place, say in an interactive web application. To make this seamless,
<code class="docutils literal"><span class="pre">dataset</span></code> supports serializing rows of data into static JSON and CSV files
such using the <a class="reference internal" href="api.html#dataset.freeze" title="dataset.freeze"><code class="xref py py-meth docutils literal"><span class="pre">freeze()</span></code></a> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># export all users into a single JSON</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s">'users'</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">'json'</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">'users.json'</span><span class="p">)</span>
</pre></div>
</div>
<p>You can create one file per row by setting <code class="docutils literal"><span class="pre">mode</span></code> to “item”:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># export one JSON file per user</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">'json'</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">'users/{{ id }}.json'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'item'</span><span class="p">)</span>
</pre></div>
</div>
<p>Since this is a common operation we made it available via command line
utility <code class="docutils literal"><span class="pre">datafreeze</span></code>. Read more about the <a class="reference internal" href="freezefile.html"><em>freezefile markup</em></a>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>datafreeze freezefile.yaml
</pre></div>
</div>
</div>
</div>


          </div></body></html>