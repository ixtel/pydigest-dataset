<html><body><div><div class="body" role="main">
            
  <div class="section" id="finding-wally">
<h1>Finding Wally</h1>
<p>This was originally an <a class="reference external" href="http://stackoverflow.com/questions/8849869/how-do-i-find-wally-with-python">answer on stackoverflow</a>
We can use it as a simple tutorial example.</p>
<p>The problem is to find Wally (who goes by Waldo in the US) in the following
image:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">import</span> <span class="nn">mahotas</span>
<span class="kn">import</span> <span class="nn">mahotas.demos</span>
<span class="n">wally</span> <span class="o">=</span> <span class="n">mahotas</span><span class="o">.</span><span class="n">demos</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'Wally'</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">wally</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//wally-1.py">Source code</a>, <a class="reference external" href=".//wally-1.png">png</a>, <a class="reference external" href=".//wally-1.hires.png">hires.png</a>, <a class="reference external" href=".//wally-1.pdf">pdf</a>)</p>

<p>From October 11 2013 onwards (version 1.0.4 or later), you can get the Wally
image from mahotas as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mahotas.demos</span>
<span class="n">wally</span> <span class="o">=</span> <span class="n">mahotas</span><span class="o">.</span><span class="n">demos</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'Wally'</span><span class="p">)</span>
</pre></div>
</div>
<p>Can you see him?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wfloat</span> <span class="o">=</span> <span class="n">wally</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">wfloat</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Split into red, green, and blue channels. It’s better to use floating point
arithmetic below, so we convert at the top.</p>

<p>w is the white channel.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pattern</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">24</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>Build up a pattern of +1,+1,-1,-1 on the vertical axis. This is Wally’s shirt.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">v</span> <span class="o">=</span> <span class="n">mahotas</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
</pre></div>
</div>
<p>Convolve with red minus white. This will give a strong response where the shirt
is.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">mahotas</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">48</span><span class="p">,</span><span class="mi">24</span><span class="p">)))</span>
</pre></div>
</div>
<p>Look for the maximum value and dilate it to make it visible. Now, we tone down
the whole image, except the region or interest:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wally</span> <span class="o">-=</span> <span class="o">.</span><span class="mi">8</span><span class="o">*</span><span class="n">wally</span> <span class="o">*</span> <span class="o">~</span><span class="n">mask</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">]</span>
</pre></div>
</div>
<p>And we get the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wfloat</span> <span class="o">=</span> <span class="n">wally</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">wfloat</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">wfloat</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">24</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">pattern</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">mahotas</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">mahotas</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">48</span><span class="p">,</span><span class="mi">24</span><span class="p">)))</span>
<span class="n">wally</span> <span class="o">-=</span> <span class="o">.</span><span class="mi">8</span><span class="o">*</span><span class="n">wally</span> <span class="o">*</span> <span class="o">~</span><span class="n">mask</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">]</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">wally</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//wally-2.py">Source code</a>, <a class="reference external" href=".//wally-2.png">png</a>, <a class="reference external" href=".//wally-2.hires.png">hires.png</a>, <a class="reference external" href=".//wally-2.pdf">pdf</a>)</p>

</div>


          </div>
        </div></body></html>