<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-zsh-history-analysis" class="anchor" href="#zsh-history-analysis" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Zsh History Analysis</h1>

<p><a href="http://www.zsh.org/">zsh</a> logs commands and timestamps to <code>~/.zsh_history</code> for
shell features such as reverse history search.
This repository is a fun project that provides shell, Python, and R
scripts to parse, analyze, visualize <code>.zsh_history</code> files.
These scripts can be extended to support Bash's <code>.bash_history</code>.</p>

<p>Note: This is my first time using R and I am happy for improvements.</p>

<h1><a id="user-content-getting-started" class="anchor" href="#getting-started" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Getting Started</h1>

<p>You can run this on your <code>.zsh_history</code> files by cloning this repository
with <code>git clone https://github.com/bamos/zsh-history-analysis.git</code>
and installing the following prerequisites.
Ensure you have increased the history file size so commands aren't removed.
Then, follow the steps in <code>Control Flow</code> to generate the plots.</p>

<h2><a id="user-content-prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Prerequisites</h2>

<ul>
<li><code>PATH</code> contains <code>python3</code> and <code>Rscript</code>, which can be installed from
your package manager.
In Arch Linux, the required packages are
<a href="https://www.archlinux.org/packages/extra/x86_64/python/">python</a>
and <a href="https://www.archlinux.org/packages/extra/i686/r/">r</a>.</li>
<li><code>R</code>: <a href="http://ggplot2.org/">ggplot2</a> and
<a href="http://had.co.nz/reshape">reshape</a> are installed
from an R shell with <code>install.packages("ggplot2")</code>
and <code>install.packages("reshape")</code>.</li>
</ul>

<h2><a id="user-content-increasing-the-history-file-size" class="anchor" href="#increasing-the-history-file-size" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Increasing the History File Size</h2>

<p>Unfortunately, zsh's default history file size is limited to
10000 lines by default and will truncate the history to this
length by deduplicating entries and removing old data.</p>

<p>Adding the following lines to <code>.zshrc</code> will remove the limits and
deduplication of the history file.</p>

<div class="highlight highlight-source-shell"><pre><span class="pl-k">export</span> HISTSIZE=1000000000
<span class="pl-k">export</span> SAVEHIST=<span class="pl-smi">$HISTSIZE</span>
setopt EXTENDED_HISTORY</pre></div>

<h2><a id="user-content-control-flow" class="anchor" href="#control-flow" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Control Flow</h2>

<p>The following is the control flow for generating plots.</p>

<ol>
<li>Archive all <code>.zsh_history</code> files in <code>data/&lt;server&gt;.zsh_history</code>.
<code>./pull-history-data.sh</code> is a script to partially help archiving the data
that will pull files from a list of servers separated by newlines in a
file named <code>servers</code>.</li>
<li>Run <code>./analyze.py</code> to analyze the raw data files.
<code>./analyze.py --help</code> will provide a help menu with the supported options.</li>
<li>Run <code>./plot.r</code> to generate plots from the analyzed data.</li>
</ol>

<h1><a id="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Contributing</h1>

<p>I'm happy to review pull requests and look through issues.
The most outstanding issue preventing a lot more analysis to
be added is <a href="https://github.com/bamos/zsh-history-analysis/issues/1">#1</a>,
which I would appreciate some ideas on.</p>

<h1><a id="user-content-sample-results" class="anchor" href="#sample-results" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Sample Results</h1>

<p>Following is a snapshot of results from my computers over
the last few months.</p>

<h2><a id="user-content-command-frequencies" class="anchor" href="#command-frequencies" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Command Frequencies</h2>

<p>At a given hour or weekday, how frequently do I run commands?
The following shows the average number of commands executed
for each hour and weekday.
I average 10 commands per hour overnight and
a little more during the day, and Wednesdays seem to be
my least productive days.</p>

<p><a href="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-hours-bar.png" target="_blank"><img src="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-hours-bar.png" alt=""/></a>
<a href="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-wdays-bar.png" target="_blank"><img src="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-wdays-bar.png" alt=""/></a></p>

<p>Many hours have 0 commands executed since I'm not typing commands every hour of
every day, so these points have a high standard deviation.
<a href="http://en.wikipedia.org/wiki/Empirical_distribution_function">Empirical Cumulative Distribution Functions (ECDF's)</a>
provide a deeper visualization of the distributions.</p>

<p><a href="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-hours-ecdf.png" target="_blank"><img src="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-hours-ecdf.png" alt=""/></a>
<a href="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-wdays-ecdf.png" target="_blank"><img src="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/time-wdays-ecdf.png" alt=""/></a></p>

<h2><a id="user-content-average-command-length" class="anchor" href="#average-command-length" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Average command length</h2>

<p><a href="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/cmd-lengths-full.png" target="_blank"><img src="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/cmd-lengths-full.png" alt=""/></a></p>

<p>What command was over 100 characters!?
<code>analyze.py</code> will output the top five commands, and these
long commands are from using the full path to an executable,
such as the Android ARM cross compiler, as shown in the following output.</p>

<div class="highlight highlight-source-shell"><pre>$ ./analyze.py commandLengths
  105: /opt/android-ndk-r9/toolchains/arm-linux-androideabi-4.8/prebuilt/linux-x86/bin/arm-linux-androideabi-gcc</pre></div>

<p>Scoping into the majority of the data shows that almost 50% of my
commands are one or two characters.</p>

<p><a href="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/cmd-lengths-zoomed.png" target="_blank"><img src="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/cmd-lengths-zoomed.png" alt=""/></a></p>

<h2><a id="user-content-top-commands" class="anchor" href="#top-commands" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Top Commands</h2>

<p>Since almost 50% of my commands are one or two characters,
what are the top commands?
The following plot shows the top commands are Linux utilities
and <a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a> aliases.</p>

<p><a href="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/top-cmds.png" target="_blank"><img src="https://github.com/bamos/zsh-history-analysis/raw/master/sample-results/top-cmds.png" alt=""/></a></p>
</article>
  </div></body></html>