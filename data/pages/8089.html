<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-acme-tiny" class="anchor" href="#acme-tiny" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>acme-tiny</h1>

<p><a href="https://travis-ci.org/diafygi/acme-tiny"><img src="https://camo.githubusercontent.com/f6e3bc9572e35843fbe99cf53c7b6c93d3430e80/68747470733a2f2f7472617669732d63692e6f72672f646961667967692f61636d652d74696e792e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/diafygi/acme-tiny.svg"/></a>
<a href="https://coveralls.io/github/diafygi/acme-tiny?branch=master"><img src="https://camo.githubusercontent.com/39059f0b6d0ab4e0c3cab12ea8e45fe1ab81c80e/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f646961667967692f61636d652d74696e792f62616467652e7376673f6272616e63683d6d617374657226736572766963653d676974687562" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/diafygi/acme-tiny/badge.svg?branch=master&amp;service=github"/></a></p>

<p>This is a tiny, auditable script that you can throw on your server to issue
and renew <a href="https://letsencrypt.org/">Let's Encrypt</a> certificates. Since it has
to be run on your server and have access to your private Let's Encrypt account
key, I tried to make it as tiny as possible (currently less than 200 lines).
The only prerequisites are python and openssl.</p>

<p><strong>PLEASE READ THE SOURCE CODE! YOU MUST TRUST IT WITH YOUR PRIVATE KEYS!</strong></p>

<h2><a id="user-content-donate" class="anchor" href="#donate" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Donate</h2>

<p>If this script is useful to you, please donate to the EFF. I don't work there,
but they do fantastic work.</p>

<p><a href="https://eff.org/donate/">https://eff.org/donate/</a></p>

<h2><a id="user-content-how-to-use-this-script" class="anchor" href="#how-to-use-this-script" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to use this script</h2>

<p>If you already have a Let's Encrypt issued certificate and just want to renew,
you should only have to do Steps 3 and 6.</p>

<h3><a id="user-content-step-1-create-a-lets-encrypt-account-private-key-if-you-havent-already" class="anchor" href="#step-1-create-a-lets-encrypt-account-private-key-if-you-havent-already" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Step 1: Create a Let's Encrypt account private key (if you haven't already)</h3>

<p>You must have a public key registered with Let's Encrypt and sign your requests
with the corresponding private key. If you don't understand what I just said,
this script likely isn't for you! Please use the official Let's Encrypt
<a href="https://github.com/letsencrypt/letsencrypt">client</a>.
To accomplish this you need to initially create a key, that can be used by
acme-tiny, to register a account for you and sign all following requests.</p>

<pre><code>openssl genrsa 4096 &gt; account.key
</code></pre>

<h4><a id="user-content-use-existing-lets-encrypt-key" class="anchor" href="#use-existing-lets-encrypt-key" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Use existing Let's Encrypt key</h4>

<p>Alternatively you can convert your key, previously generated by the original
Let's Encrypt client.</p>

<p>The private account key from the Let's Encrypt client is saved in the
<a href="https://tools.ietf.org/html/rfc7517">JWK</a> format. <code>acme-tiny</code> is using the PEM
key format. To convert the key, you can use the tool
<a href="https://gist.github.com/JonLundy/f25c99ee0770e19dc595">conversion script</a> by JonLundy:</p>

<div class="highlight highlight-source-shell"><pre><span class="pl-c"># Download the script</span>
wget -O - <span class="pl-s"><span class="pl-pds">"</span>https://gist.githubusercontent.com/JonLundy/f25c99ee0770e19dc595/raw/6035c1c8938fae85810de6aad1ecf6e2db663e26/conv.py<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> conv.py

<span class="pl-c"># Copy your private key to your working directory</span>
cp /etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/<span class="pl-k">&lt;</span>id<span class="pl-k">&gt;</span>/private_key.json private_key.json

<span class="pl-c"># Create a DER encoded private key</span>
openssl asn1parse -noout -out private_key.der -genconf <span class="pl-s"><span class="pl-pds">&lt;(</span>python conv.py private_key.json<span class="pl-pds">)</span></span>

<span class="pl-c"># Convert to PEM</span>
openssl rsa -in private_key.der -inform der <span class="pl-k">&gt;</span> account.key</pre></div>

<h3><a id="user-content-step-2-create-a-certificate-signing-request-csr-for-your-domains" class="anchor" href="#step-2-create-a-certificate-signing-request-csr-for-your-domains" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Step 2: Create a certificate signing request (CSR) for your domains.</h3>

<p>The ACME protocol (what Let's Encrypt uses) requires a CSR file to be submitted
to it, even for renewals. You can use the same CSR for multiple renewals. NOTE:
you can't use your account private key as your domain private key!</p>

<pre><code>#generate a domain private key (if you haven't already)
openssl genrsa 4096 &gt; domain.key
</code></pre>

<pre><code>#for a single domain
openssl req -new -sha256 -key domain.key -subj "/CN=yoursite.com" &gt; domain.csr

#for multiple domains (use this one if you want both www.yoursite.com and yoursite.com)
openssl req -new -sha256 -key domain.key -subj "/" -reqexts SAN -config &lt;(cat /etc/ssl/openssl.cnf &lt;(printf "[SAN]\nsubjectAltName=DNS:yoursite.com,DNS:www.yoursite.com")) &gt; domain.csr
</code></pre>

<h3><a id="user-content-step-3-make-your-website-host-challenge-files" class="anchor" href="#step-3-make-your-website-host-challenge-files" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Step 3: Make your website host challenge files</h3>

<p>You must prove you own the domains you want a certificate for, so Let's Encrypt
requires you host some files on them. This script will generate and write those
files in the folder you specify, so all you need to do is make sure that this
folder is served under the ".well-known/acme-challenge/" url path. NOTE: This
must be on port 80 (not port 443).</p>

<pre><code>#make some challenge folder (modify to suit your needs)
mkdir -p /var/www/challenges/
</code></pre>

<div class="highlight highlight-source-nginx"><pre><span class="pl-c">#example for nginx</span>
<span class="pl-k">server</span> {
    <span class="pl-k">listen</span> <span class="pl-s">80</span>;
    <span class="pl-k">server_name</span> yoursite.com www.yoursite.com;

    <span class="pl-k">location</span> <span class="pl-en">/.well-known/acme-challenge/ </span>{
        <span class="pl-k">alias</span> /var/www/challenges/;
        <span class="pl-k">try_files</span> <span class="pl-smi">$uri</span> <span class="pl-c1">=404</span>;
    }

    ...<span class="pl-k">the</span> rest of your config
}</pre></div>

<h3><a id="user-content-step-4-get-a-signed-certificate" class="anchor" href="#step-4-get-a-signed-certificate" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Step 4: Get a signed certificate!</h3>

<p>Now that you have setup your server and generated all the needed files, run this
script on your server with the permissions needed to write to the above folder
and read your private account key and CSR.</p>

<pre><code>#run the script on your server
python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &gt; ./signed.crt
</code></pre>

<h3><a id="user-content-step-5-install-the-certificate" class="anchor" href="#step-5-install-the-certificate" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Step 5: Install the certificate</h3>

<p>The signed https certificate that is output by this script can be used along
with your private key to run an https server. You need to include them in the
https settings in your web server's configuration. Here's an example on how to
configure an nginx server:</p>

<pre><code>#NOTE: For nginx, you need to append the Let's Encrypt intermediate cert to your cert
wget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem &gt; intermediate.pem
cat signed.crt intermediate.pem &gt; chained.pem
</code></pre>

<div class="highlight highlight-source-nginx"><pre><span class="pl-k">server</span> {
    <span class="pl-k">listen</span> <span class="pl-s">443</span>;
    <span class="pl-k">server_name</span> yoursite.com, www.yoursite.com;

    <span class="pl-k">ssl</span><span class="pl-c1"> on</span>;
    <span class="pl-k">ssl_certificate</span> /path/to/chained.pem;
    <span class="pl-k">ssl_certificate_key</span> /path/to/domain.key;
    <span class="pl-k">ssl_session_timeout</span> <span class="pl-c1">5m</span>;
    <span class="pl-k">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2;
    <span class="pl-k">ssl_ciphers</span> ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA;
    <span class="pl-k">ssl_session_cache</span> shared:SSL:50m;
    <span class="pl-k">ssl_dhparam</span> /path/to/server.dhparam;
    <span class="pl-k">ssl_prefer_server_ciphers</span><span class="pl-c1"> on</span>;

    ...<span class="pl-k">the</span> rest of your config
}

<span class="pl-k">server</span> {
    <span class="pl-k">listen</span> <span class="pl-s">80</span>;
    <span class="pl-k">server_name</span> yoursite.com, www.yoursite.com;

    <span class="pl-k">location</span> <span class="pl-en">/.well-known/acme-challenge/ </span>{
        <span class="pl-k">alias</span> /var/www/challenges/;
        <span class="pl-k">try_files</span> <span class="pl-smi">$uri</span> <span class="pl-c1">=404</span>;
    }

    ...<span class="pl-k">the</span> rest of your config
}</pre></div>

<h3><a id="user-content-step-6-setup-an-auto-renew-cronjob" class="anchor" href="#step-6-setup-an-auto-renew-cronjob" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Step 6: Setup an auto-renew cronjob</h3>

<p>Congrats! Your website is now using https! Unfortunately, Let's Encrypt
certificates only last for 90 days, so you need to renew them often. No worries!
It's automated! Just make a bash script and add it to your crontab (see below
for example script).</p>

<p>Example of a <code>renew_cert.sh</code>:</p>

<div class="highlight highlight-source-shell"><pre><span class="pl-c">#!/usr/bin/sh</span>
python /path/to/acme_tiny.py --account-key /path/to/account.key --csr /path/to/domain.csr --acme-dir /var/www/challenges/ <span class="pl-k">&gt;</span> /tmp/signed.crt <span class="pl-k">||</span> <span class="pl-c1">exit</span>
wget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem <span class="pl-k">&gt;</span> intermediate.pem
cat /tmp/signed.crt intermediate.pem <span class="pl-k">&gt;</span> /path/to/chained.pem
service nginx reload</pre></div>

<pre><code>#example line in your crontab (runs once per month)
0 0 1 * * /path/to/renew_cert.sh 2&gt;&gt; /var/log/acme_tiny.log
</code></pre>

<h2><a id="user-content-permissions" class="anchor" href="#permissions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Permissions</h2>

<p>The biggest problem you'll likely come across while setting up and running this
script is permissions. You want to limit access to your account private key and
challenge web folder as much as possible. I'd recommend creating a user
specifically for handling this script, the account private key, and the
challenge folder. Then add the ability for that user to write to your installed
certificate file (e.g. <code>/path/to/chained.pem</code>) and reload your webserver. That
way, the cron script will do its thing, overwrite your old certificate, and
reload your webserver without having permission to do anything else.</p>

<p><strong>BE SURE TO:</strong></p>

<ul>
<li>Backup your account private key (e.g. <code>account.key</code>)</li>
<li>Don't allow this script to be able to read your domain private key!</li>
<li>Don't allow this script to be run as root!</li>
</ul>

<h2><a id="user-content-feedbackcontributing" class="anchor" href="#feedbackcontributing" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Feedback/Contributing</h2>

<p>This project has a very, very limited scope and codebase. I'm happy to receive
bug reports and pull requests, but please don't add any new features. This
script must stay under 200 lines of code to ensure it can be easily audited by
anyone who wants to run it.</p>

<p>If you want to add features for your own setup to make things easier for you,
please do! It's open source, so feel free to fork it and modify as necessary.</p>
</article>
  </div></body></html>