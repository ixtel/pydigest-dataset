<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-shellpy" class="anchor" href="#shellpy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>shellpy</h1>

<p>A tool for convenient shell scripting in Python. It allows you to write all your shell scripts in Python in a convenient way and in many cases replace Bash/Sh. </p>

<p><a href="https://travis-ci.org/lamerman/shellpy"><img src="https://camo.githubusercontent.com/c728fb1b16a1ce9aba698d20fbd7894b7a66ebb0/68747470733a2f2f7472617669732d63692e6f72672f6c616d65726d616e2f7368656c6c70792e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/lamerman/shellpy.svg?branch=master"/></a>
<a href="https://gitter.im/lamerman/shellpy?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/10f6de864f8db9d5b25740219badb58052a0e4a1/68747470733a2f2f6261646765732e6769747465722e696d2f6c616d65726d616e2f7368656c6c70792e737667" alt="Join the chat at https://gitter.im/lamerman/shellpy" data-canonical-src="https://badges.gitter.im/lamerman/shellpy.svg"/></a></p>

<h2><a id="user-content-preface---why-do-we-need-shell-python" class="anchor" href="#preface---why-do-we-need-shell-python" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Preface - Why do we need shell python?</h2>

<p>For many people bash/sh seem to be pretty complicated. An example would be regular expressions, working with json/yaml/xml, named arguments parsing and so on. There are many things that are much easier in python to understand and work with.</p>

<h2><a id="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Introduction</h2>

<p>Shell python has no differences from python except for one. Grave accent symbol (`) does not mean eval, it means execution of shell commands. So</p>

<pre><code>`ls -l`
</code></pre>

<p>will execute <code>ls -l</code> in shell. You can also skip one ` in the end of line</p>

<pre><code>`ls -l
</code></pre>

<p>and it will also be a correct syntax. It is also possible to write multiline expressions</p>

<pre><code>`
echo test &gt; test.txt
cat test.txt
`
</code></pre>

<p>and long lines</p>

<pre><code>`echo This is \
  a very long \
  line
</code></pre>

<p>Every shellpy exression returns a Result</p>

<pre><code>result = `ls -l
</code></pre>

<p>It can be either <a href="https://github.com/lamerman/shellpy/wiki/Simple-mode#result">Result</a> or <a href="https://github.com/lamerman/shellpy/wiki/Interactive-mode#interactive-result">InteractiveResult</a>. Let's start with a simple Result. First you can check returncode of a command</p>

<pre><code>result = `ls -l
print result.returncode
</code></pre>

<p>You can also get text from stdout or stderr</p>

<pre><code>result = `ls -l
result_text = result.stdout
result_error = result.stderr
</code></pre>

<p>You can iterate over lines of result stdout</p>

<pre><code>result = `ls -l
for line in result:
    print line.upper()
</code></pre>

<p>and so on. </p>

<p>It also has syntactic sugar for some operations like checking result for zero</p>

<pre><code>result = `ls -l
if result:
    print 'Return code for ls -l was 0'
</code></pre>

<p>Or getting stdout</p>

<pre><code>result = `ls -l
print result
</code></pre>

<h2><a id="user-content-integration-with-python-and-code-reuse" class="anchor" href="#integration-with-python-and-code-reuse" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Integration with python and code reuse</h2>

<p>As it was said before shellpython does not differ a lot from ordinary python. You can import python modules and use them as usual</p>

<pre><code>import os.path

`mkdir /tmp/mydir
os.path.exists('/tmp/mydir') # True
</code></pre>

<p>And you can do the same with shellpython modules. Suppose you have shellpy module <code>common</code> as in examples directory. So this is how it looks</p>

<pre><code>ls common/
common.spy  __init__.spy
</code></pre>

<p>So you have directory <code>common</code> and two files inside: <code>__init__.spy</code> and <code>common.spy</code>. Looks like a python module right? Exactly. The only difference is file extension. For <code>__init__.spy</code> and other files it must be <code>.spy</code>. Let's look inside <code>common.spy</code></p>

<pre><code>def common_func():
    return `echo 5
</code></pre>

<p>A simple function that returns <a href="https://github.com/lamerman/shellpy/wiki/Simple-mode#result">Result</a> of <code>echo 5</code> execution. How is it used how in code? As same as in python</p>

<pre><code>from common.common import common_func

print('Result of imported function is ' + str(common_func()))
</code></pre>

<p>Note that the <code>common</code> directory must be in pythonpath to be imported.</p>

<h3><a id="user-content-how-does-import-work" class="anchor" href="#how-does-import-work" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How does import work?</h3>

<p>It uses import hooks described in <a href="https://www.python.org/dev/peps/pep-0302/">PEP 0302 -- New Import Hooks</a>. So, whenever importer finds a shellpy module or a file with .spy extension and with the name that you import, it will try to first preprocess it from shellpy to python and then import it using standard python import. Once preprocessed, the file is cached in your system temp directory and the second time it will be just imported directly.</p>

<h3><a id="user-content-example" class="anchor" href="#example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example</h3>

<p>This script clones shellpython to temporary directory and finds the commit hash where README was created</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> tempfile
<span class="pl-k">import</span> os.path
<span class="pl-k">from</span> shellpython.helpers <span class="pl-k">import</span> Dir

<span class="pl-c"># We will make everything in temp directory. Dir helper allows you to change current directory</span>
<span class="pl-c"># withing 'with' block</span>
<span class="pl-k">with</span> Dir(tempfile.gettempdir()):
    <span class="pl-k">if</span> <span class="pl-k">not</span> os.path.exists(<span class="pl-s"><span class="pl-pds">'</span>shellpy<span class="pl-pds">'</span></span>):
        <span class="pl-c"># just executes shell command</span>
        <span class="pl-id">`git clone https:<span class="pl-k">//</span>github.com<span class="pl-k">/</span>lamerman<span class="pl-k">/</span>shellpy.git</span>

    <span class="pl-c"># switch to newly created tempdirectory/shellpy</span>
    <span class="pl-k">with</span> Dir(<span class="pl-s"><span class="pl-pds">'</span>shellpy<span class="pl-pds">'</span></span>):
        <span class="pl-c"># here we capture result of shell execution. log here is an instance of Result class</span>
        log <span class="pl-k">=</span> <span class="pl-id">`git log <span class="pl-ii">--</span>pretty=oneline <span class="pl-ii">--</span>grep=<span class="pl-s"><span class="pl-pds">'</span>Create<span class="pl-pds">'</span></span></span>

        <span class="pl-c"># shellpy allows you to iterate over lines in stdout with this syntactic sugar</span>
        <span class="pl-k">for</span> line <span class="pl-k">in</span> log:
            <span class="pl-k">if</span> line.find(<span class="pl-s"><span class="pl-pds">'</span>README.md<span class="pl-pds">'</span></span>):
                hashcode <span class="pl-k">=</span> log.stdout.split(<span class="pl-s"><span class="pl-pds">'</span> <span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>]
                <span class="pl-c1">print</span> hashcode
                <span class="pl-c1">exit</span>(<span class="pl-c1">0</span>)

        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>The commit where the readme was created was not found<span class="pl-pds">'</span></span>

<span class="pl-c1">exit</span>(<span class="pl-c1">1</span>)</pre></div>

<p>Two lines here are executed in shell <code>git clone https://github.com/lamerman/shellpy.git</code> and <code>git log --pretty=oneline --grep='Create'</code>. The result of the second line is assigned to variable <code>log</code> and then we iterate over the result line by line in the for cycle</p>

<h3><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h3>

<p>You can install it either with <code>pip install shellpy</code> or by cloning this repository and execution of <code>setup.py install</code>. After that you will have <code>shellpy</code> command installed.</p>

<h3><a id="user-content-running" class="anchor" href="#running" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Running</h3>

<p>You can try shellpython by running examples after installation. Download this repository and run the following command in the root folder of the cloned repository:</p>

<p><code>shellpy example/curl.spy</code></p>

<p><code>shellpy example/git.spy</code></p>

<p>There is also so called allinone example which you can have a look at and execute like this:</p>

<p><code>shellpy example/allinone/test.spy</code></p>

<p>It is called all in one because it demonstrates all features available in shellpy. If you have python3 run instead:</p>

<p><code>shellpy example/allinone/test3.spy</code></p>

<h3><a id="user-content-documentation" class="anchor" href="#documentation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Documentation</h3>

<p><a href="https://github.com/lamerman/shellpy/wiki">Wiki</a></p>

<h3><a id="user-content-compatibility" class="anchor" href="#compatibility" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Compatibility</h3>

<p>It works on Linux and Mac for both Python 2.x and 3.x. It should also work on Windows.</p>

<h3><a id="user-content-contact" class="anchor" href="#contact" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Contact</h3>

<p>Please contact me in gitter 
<a href="https://gitter.im/lamerman/shellpy?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/10f6de864f8db9d5b25740219badb58052a0e4a1/68747470733a2f2f6261646765732e6769747465722e696d2f6c616d65726d616e2f7368656c6c70792e737667" alt="Join the chat at https://gitter.im/lamerman/shellpy" data-canonical-src="https://badges.gitter.im/lamerman/shellpy.svg"/></a> 
if you want to share your thoughts about the project or tell about possible improvements.</p>
</article>
  </div></body></html>