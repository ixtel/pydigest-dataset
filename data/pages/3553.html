<html><body><div><article class="markdown-body entry-content" itemprop="text"><h2><a id="user-content-how-to-build-a-notification-feed-using-stream" class="anchor" href="#how-to-build-a-notification-feed-using-stream" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to build a notification feed using Stream</h2>

<h3><a id="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Introduction</h3>

<p>In this tutorial we are going to show how easy it is to build a notification feed using GetStream.io. First of all, let's quickly introduce you to our fictional example app. It's called bug-your-friends.com and allows you interact with your friends, ping them, follow them or poke them. Here's a quick list of example interactions:</p>

<ul>
<li>poke another user (eg. Thierry pokes Alessandra)<br/></li>
<li>follow a user (eg. Tommaso follows Iris)<br/></li>
<li>ping a user (eg. Josie pings Carolina)<br/></li>
</ul>

<p>Whenever a user is part of one of these interactions, we want to update his notification feed, update the number of unseen and unread
notifications and listen to changes in realtime. We also want to present these interactions in an aggregated fashion, so that common events are grouped together
(eg. Thierry poked you 100 times, Tommaso, Josie and 3 other people pinged you ...).</p>

<p><strong>The unread notifications</strong>    </p>

<p><a href="https://cloud.githubusercontent.com/assets/88735/6528401/aaafe5ee-c3ef-11e4-9b0c-16b86e8274be.png" target="_blank"><img src="https://cloud.githubusercontent.com/assets/88735/6528401/aaafe5ee-c3ef-11e4-9b0c-16b86e8274be.png" alt="noti_small"/></a></p>

<p><strong>The notification feed box</strong>   </p>

<p><a href="https://cloud.githubusercontent.com/assets/88735/6528400/aaadd4f2-c3ef-11e4-91d2-c339a1eead7a.png" target="_blank"><img src="https://cloud.githubusercontent.com/assets/88735/6528400/aaadd4f2-c3ef-11e4-91d2-c339a1eead7a.png" alt="notification_box"/></a></p>

<h3><a id="user-content-1-get-your-api-keys" class="anchor" href="#1-get-your-api-keys" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>1.) Get your API keys</h3>

<p>GetStream.io helps you build scalable newsfeeds and notification feeds. It's a REST API with clients in PHP, JS, Ruby and Python. To start, quickly <a href="https://getstream.io/">signup</a> using Github to get your API keys (in the dashboard), this is completely free and takes 3 clicks. Once you have an account, you need to install the client (in this tutorial we are going to use Python).</p>

<div class="highlight highlight-source-python"><pre>pip install stream<span class="pl-k">-</span>python</pre></div>

<h3><a id="user-content-2-add-notifications" class="anchor" href="#2-add-notifications" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>2.) Add notifications</h3>

<p>The first step in building our annoying app is to actually send events to users' notification feeds. Here's how you send a ping event.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> stream
client <span class="pl-k">=</span> stream.connect(<span class="pl-s"><span class="pl-pds">'</span>api_key<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>api_secret<span class="pl-pds">'</span></span>)

<span class="pl-k">def</span> <span class="pl-en">notify_ping</span>(<span class="pl-smi">user</span>, <span class="pl-smi">ping</span>, <span class="pl-smi">ping_target</span>):
    activity <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>actor<span class="pl-pds">'</span></span>: user.username, <span class="pl-s"><span class="pl-pds">'</span>verb<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>ping<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>object<span class="pl-pds">'</span></span>: ping.id}
    feed <span class="pl-k">=</span> client.feed(<span class="pl-s"><span class="pl-pds">'</span>notification<span class="pl-pds">'</span></span>, ping_target.id)
    feed.add_activity(activity)</pre></div>

<p>In the example above, we first create an instance of the api client (using the api key and secret from the <a href="https://getstream.io/dashboard/">dashboard</a>), then we compose the ping event as an activity (actor, verb, object)
and last we send that data to the notification feed of the pinged user. Note that you can also add custom fields to the activity.
By default the activities are aggregated by verb and time. Later on we'll explain how to change this.</p>

<h3><a id="user-content-3-read-a-notification-feed" class="anchor" href="#3-read-a-notification-feed" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>3.) Read a notification feed</h3>

<p>Reading a notification feed is even easier.</p>

<div class="highlight highlight-source-python"><pre>feed <span class="pl-k">=</span> client.feed(<span class="pl-s"><span class="pl-pds">'</span>notification<span class="pl-pds">'</span></span>, current_user.id)
activities <span class="pl-k">=</span> feed.get()[<span class="pl-s"><span class="pl-pds">'</span>results<span class="pl-pds">'</span></span>]</pre></div>

<p>activities is a python dictionary containing the following information:
    * the list of activities present in the feed
    * the count of activities that are yet to be marked as seen
    * the count of activities that are yet to be marked as read</p>

<h3><a id="user-content-4-update-notification-counters" class="anchor" href="#4-update-notification-counters" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>4.) Update notification counters</h3>

<p>Every notification feed keeps count of the notifications that are yet to be marked as read and seen. Stream's API allows you to mark the entire feed as read or seen as well as marking single activities as such.</p>

<div class="highlight highlight-source-python"><pre>feed <span class="pl-k">=</span> client.feed(<span class="pl-s"><span class="pl-pds">'</span>notification<span class="pl-pds">'</span></span>, current_user.id)

<span class="pl-c"># marks the entire feed as seen</span>
feed.get(<span class="pl-v">seen</span><span class="pl-k">=</span><span class="pl-c1">True</span>)

<span class="pl-c"># marks the entire feed as read</span>
feed.get(<span class="pl-v">read</span><span class="pl-k">=</span><span class="pl-c1">True</span>)

<span class="pl-c"># marks one activity as seen and read</span>
activity_id <span class="pl-k">=</span> activity[<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>]
feed.get(<span class="pl-v">read</span><span class="pl-k">=</span>[activity_id], <span class="pl-v">seen</span><span class="pl-k">=</span>[activity_id])</pre></div>

<h3><a id="user-content-5-customize-aggregation" class="anchor" href="#5-customize-aggregation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>5.) Customize aggregation</h3>

<p>As we introduced briefly in the beginning, activities sent to feeds get aggregated into groups. Let's expand a bit on this.</p>

<p>Stream's notifications feeds use user defined aggregation rules. Whenever an activity is added to a feed, a group id will be assigned as the result of the aggregated function. The default aggregation rule groups activities by verb and creation date. Stream allows you to use different and even more complex aggregation rules based on the activity data. You can read more about this in <a href="http://getstream.io/docs/#aggregated-feeds">aggregation docs</a>.</p>

<h3><a id="user-content-6-realtime-notifications" class="anchor" href="#6-realtime-notifications" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>6.) Realtime notifications</h3>

<p>Realtime notifications are a great addition to a notification feed. It is possible to subscribe to
feed updates using the javascript client (available on npm and github). This is how you can get notification updates. Whenever something is added to the current user's feed, the updateNotificationCallback function will be fired.</p>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>path/to/stream.js<span class="pl-pds">"</span></span> /&gt;

<span class="pl-s1">&lt;<span class="pl-ent">script</span>&gt;</span>
<span class="pl-s1">require <span class="pl-s"><span class="pl-pds">'</span>stream<span class="pl-pds">'</span></span></span>
<span class="pl-s1">client <span class="pl-k">=</span> <span class="pl-smi">stream</span>.<span class="pl-en">connect</span>(<span class="pl-s"><span class="pl-pds">'</span>api_secret<span class="pl-pds">'</span></span>, <span class="pl-c1">null</span>, <span class="pl-s"><span class="pl-pds">'</span>733<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">notification <span class="pl-k">=</span> <span class="pl-smi">client</span>.<span class="pl-en">feed</span>(<span class="pl-s"><span class="pl-pds">'</span>notification<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>{{ current_user.id }}<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>{{ feed.token }}<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"/>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">updateNotificationCallback</span>(<span class="pl-smi">data</span>){</span>
<span class="pl-s1">    <span class="pl-c">// new activities will be available in the data argument</span></span>
<span class="pl-s1">}</span>
<span class="pl-s1"/>
<span class="pl-s1"><span class="pl-smi">notification</span>.<span class="pl-en">subscribe</span>(<span class="pl-k">function</span> <span class="pl-en">callback</span>(<span class="pl-smi">data</span>) {</span>
<span class="pl-s1">    <span class="pl-en">updateNotificationCallback</span>(data);</span>
<span class="pl-s1">});</span>
<span class="pl-s1">&lt;/<span class="pl-ent">script</span>&gt;</span></pre></div>

<h3><a id="user-content-conclusion" class="anchor" href="#conclusion" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Conclusion</h3>

<p>In this tutorial we showed you how to quickly build an aggregated notification feed and listen to changes in realtime. To keep this tutorial brief we only scratched the surface of the feature set that Stream offers. To have a better understanding I suggest you to try the 1 minute interactive demo (<a href="https://getstream.io/getstarted/">https://getstream.io/getstarted/</a>) and to have a look at the code examples (<a href="https://getstream.io/docs/">https://getstream.io/docs/</a>).</p>
</article>
  </div></body></html>