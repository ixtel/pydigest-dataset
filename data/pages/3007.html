<html><body><div><article class="post-content">
		

<p><em>Computational Geometry</em> is a field of mathematics that seeks the development of
efficient algorithms to solve problems described in terms of basic geometrical
objects.  We differentiate between <em>Combinatorial Computational Geometry</em> and
<em>Numerical Computational Geometry</em>.</p>

<ul>
  <li>
    <p>Combinatorial Computational Geometry deals with interaction of basic
geometrical objects: points, segments, lines, polygons, and polyhedra.  In this
setting we have three categories of problems:</p>

    <ul>
      <li>
        <p><em>Static Problems</em>: The construction of a known target object is required
from a set of input geometric objects.</p>
      </li>
      <li>
        <p><em>Geometric Query Problems</em>:  Given a set of known objects (the <em>search
space</em>) and a sought property (the <em>query</em>), these problems deal with the search
of objects that satisfy the query.</p>
      </li>
      <li>
        <p><em>Dynamic Problems</em>: Similar to problems from the previous two categories,
with the added challenge that the input is not known in advance, and objects are
inserted or deleted between queries/constructions.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Numerical Computational Geometry deals mostly with representation of objects
in space described by means of curves, surfaces, and regions in space bounded by
those.</p>
  </li>
</ul>

<p>Before we proceed to the development and analysis of the different algorithms in
those two settings, it pays off to explore the basic background: Plane Geometry.</p>

<h2 id="plane-geometry">Plane Geometry</h2>

<p>The basic Geometry capabilities are usually treated through the Geometry module
of the <code class="highlighter-rouge">sympy</code> libraries.  Rather than giving an academical description of all
objects and properties in that module, we discover the most useful ones through
a series of small self-explanatory <code class="highlighter-rouge">python</code> sessions.</p>

<h3 id="points-segments">Points, Segments</h3>

<p>We start with the concepts of <em>point</em> and <em>segment</em>.  The aim is to illustrate
how easily we can check for collinearity, compute lengths, midpoints, or slopes
of segments, for example.  We also show how to quickly compute the angle between
two segments, as well as deciding whether a given point belongs to a segment or
not.  The next diagram illustrates an example, which we follow up with code.</p>



<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sympy.geometry</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P3</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P4</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">S1</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">S2</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Point</span><span class="o">.</span><span class="n">is_collinear</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">)</span>
<span class="bp">False</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">S1</span><span class="o">.</span><span class="n">length</span>
<span class="mi">5</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">S2</span><span class="o">.</span><span class="n">midpoint</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">S1</span><span class="o">.</span><span class="n">slope</span>
<span class="mi">4</span><span class="o">/</span><span class="mi">3</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">S1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
<span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">9</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="o">/</span><span class="mi">5</span><span class="p">)]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">Segment</span><span class="o">.</span><span class="n">angle_between</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">)</span>
<span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">S1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">P3</span><span class="p">)</span>
<span class="bp">False</span></code></pre></figure>

<h3 id="lines">Lines</h3>

<p>The next logical geometrical concept is the <em>line</em>.  We can perform more
interesting operations with lines, and to that effect we have a few more
constructors.  We can find their equations, compute the distance between a point
and a line, and many other operations.</p>



<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">L1</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">L2</span> <span class="o">=</span> <span class="n">L1</span><span class="o">.</span><span class="n">perpendicular_line</span><span class="p">(</span><span class="n">P3</span><span class="p">)</span>  <span class="c"># perpendicular line to L1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">L2</span><span class="o">.</span><span class="n">arbitrary_point</span><span class="p">()</span>            <span class="c"># parametric equation of L2</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">L2</span><span class="o">.</span><span class="n">equation</span><span class="p">()</span>                   <span class="c"># algebraic equation of L2</span>
<span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="mi">2</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">L2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">P4</span><span class="p">)</span>                 <span class="c"># is P4 in L2?</span>
<span class="bp">False</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">L2</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">P4</span><span class="p">)</span>                 <span class="c"># distance from P4 to L2</span>
<span class="mi">3</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">L1</span><span class="o">.</span><span class="n">is_parallel</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>              <span class="c"># is S2 parallel to L1?</span>
<span class="bp">False</span></code></pre></figure>

<h3 id="circles">Circles</h3>

<p>The next geometrical concept we are to explore is the <em>circle</em>.  We may define a circle by its center and radius, or by three points on it.  We can easily compute all of its properties.</p>



<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">C1</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">area</span>
<span class="mi">1105</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">98</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">radius</span>
<span class="n">sqrt</span><span class="p">(</span><span class="mi">2210</span><span class="p">)</span><span class="o">/</span><span class="mi">14</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">equation</span><span class="p">()</span>
<span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">5</span><span class="o">/</span><span class="mi">14</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">27</span><span class="o">/</span><span class="mi">14</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1105</span><span class="o">/</span><span class="mi">98</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">center</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span> <span class="mi">27</span><span class="o">/</span><span class="mi">14</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">circumference</span>
<span class="n">sqrt</span><span class="p">(</span><span class="mi">2210</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span></code></pre></figure>

<p>Computing intersections with other objects, checking whether a line is tangent
to a circle, or finding the tangent lines through an non-interior point, are
simple tasks too:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span>
<span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">55</span><span class="o">/</span><span class="mi">754</span> <span class="o">+</span> <span class="mi">27</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6665</span><span class="p">)</span><span class="o">/</span><span class="mi">754</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6665</span><span class="p">)</span><span class="o">/</span><span class="mi">754</span> <span class="o">+</span> <span class="mi">297</span><span class="o">/</span><span class="mi">754</span><span class="p">),</span>
 <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">27</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6665</span><span class="p">)</span><span class="o">/</span><span class="mi">754</span> <span class="o">+</span> <span class="mi">55</span><span class="o">/</span><span class="mi">754</span><span class="p">,</span> <span class="mi">297</span><span class="o">/</span><span class="mi">754</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6665</span><span class="p">)</span><span class="o">/</span><span class="mi">754</span><span class="p">)]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
<span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C2</span><span class="o">.</span><span class="n">is_tangent</span><span class="p">(</span><span class="n">L2</span><span class="p">)</span>
<span class="bp">False</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C1</span><span class="o">.</span><span class="n">tangent_lines</span><span class="p">(</span><span class="n">P4</span><span class="p">)</span>
<span class="p">[</span><span class="n">Line</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="o">/</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">15</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">/</span><span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">/</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">45</span><span class="o">/</span><span class="mi">26</span><span class="p">)),</span>
 <span class="n">Line</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">/</span><span class="mi">26</span> <span class="o">-</span> <span class="mi">9</span><span class="o">/</span><span class="mi">26</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">/</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">45</span><span class="o">/</span><span class="mi">26</span><span class="p">))]</span></code></pre></figure>

<h3 id="triangles">Triangles</h3>

<p>The most useful basic geometric concept is the <em>triangle</em>.   We need robust and fast algorithms to manipulate and extract information from them.  Let us show first the definition of one, together with a series of queries to describe its properties:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">T</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">area</span>                          <span class="c"># Note it gives a signed area</span>
<span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="mi">2</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">angles</span>
<span class="p">{</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">acos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">25</span><span class="p">),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">acos</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">130</span><span class="p">)</span><span class="o">/</span><span class="mi">130</span><span class="p">),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">acos</span><span class="p">(</span><span class="mi">23</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="o">/</span><span class="mi">130</span><span class="p">)}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">sides</span>
<span class="p">[</span><span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
 <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
 <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">perimeter</span>
<span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">is_right</span><span class="p">()</span>                    <span class="c"># Is T a right triangle?</span>
<span class="bp">False</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">is_equilateral</span><span class="p">()</span>              <span class="c"># Is T equilateral?</span>
<span class="bp">False</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">is_scalene</span><span class="p">()</span>                  <span class="c"># Is T scalene?</span>
<span class="bp">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">is_isosceles</span><span class="p">()</span>                <span class="c"># Is T isosceles?</span>
<span class="bp">False</span></code></pre></figure>

<p>Next, note how easily we can obtain representation of the different segments, centers, and circles associated with triangles, as well as the <em>medial triangle</em> (the triangle with vertices at the midpoints of the segments).</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">altitudes</span>
<span class="p">{</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">55</span><span class="o">/</span><span class="mi">26</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="mi">26</span><span class="p">)),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">25</span><span class="p">,</span> <span class="mi">8</span><span class="o">/</span><span class="mi">25</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">5</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">orthocenter</span>                  <span class="c"># Intersection of the altitudes</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">10</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">11</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">bisectors</span><span class="p">()</span>                  <span class="c"># Angle bisectors</span>
<span class="p">{</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">7</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)),</span> <span class="mi">4</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">))),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">),</span> <span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span> <span class="o">+</span> <span class="mi">25</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">incenter</span>                     <span class="c"># Intersection of angle bisectors</span>
<span class="n">Point</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">incircle</span>
<span class="n">Circle</span><span class="p">(</span><span class="n">Point</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">))),</span> <span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">inradius</span>
<span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">medians</span>
<span class="p">{</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
 <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="n">Segment</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">centroid</span>                   <span class="c"># Intersection of the medians</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">circumcenter</span>               <span class="c"># Intersection of perpendicular bisectors</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">45</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="mi">35</span><span class="o">/</span><span class="mi">22</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">circumcircle</span>
<span class="n">Circle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">45</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="mi">35</span><span class="o">/</span><span class="mi">22</span><span class="p">),</span> <span class="mi">5</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">130</span><span class="p">)</span><span class="o">/</span><span class="mi">22</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">circumradius</span>
<span class="mi">5</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">130</span><span class="p">)</span><span class="o">/</span><span class="mi">22</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">medial</span>
<span class="n">Triangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span></code></pre></figure>

<p>Some other interesting operations with triangles:</p>

<ul>
  <li>Intersection with other objects</li>
  <li>Computation of the minimum distance from a point to each of the segments.</li>
  <li>Checking whether two triangles are similar.</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python">    
<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span>
<span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">9</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="o">/</span><span class="mi">5</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">113</span><span class="p">)</span><span class="o">/</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">55</span><span class="o">/</span><span class="mi">26</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">113</span><span class="p">)</span><span class="o">/</span><span class="mi">26</span><span class="p">)]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">circumcenter</span><span class="p">)</span>
<span class="n">sqrt</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="o">/</span><span class="mi">11</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">is_similar</span><span class="p">(</span><span class="n">Triangle</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P4</span><span class="p">))</span>
<span class="bp">False</span></code></pre></figure>

<blockquote>
  <p>The other basic geometrical objects currently coded in the Geometry module are</p>

  
</blockquote>

<h3 id="curves">Curves</h3>

<p>There is also a <em>non-basic</em> geometric object: A <code class="highlighter-rouge">Curve</code>, which we define by
providing parametric equations, together with the interval of definition of the
parameter.  It currently does not have many useful methods, other than those
describing its constructors.  Let us illustrate how to deal with these objects.
For example, a three-quarters arc of an ellipse could be coded as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">var</span><span class="p">(</span><span class="s">'t'</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Arc</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="mi">4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span></code></pre></figure>

<h3 id="affine-transformations">Affine Transformations</h3>

<p>To end the exposition on basic objects from the geometry module in the <code class="highlighter-rouge">sympy</code>
library, we must mention that we may apply any basic affine transformations to
any of the previous objects.  This is done by combination of the methods
<code class="highlighter-rouge">reflect</code>, <code class="highlighter-rouge">rotate</code>, <code class="highlighter-rouge">translate</code> and <code class="highlighter-rouge">scale</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span><span class="n">L1</span><span class="p">)</span>
<span class="n">Triangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">38</span><span class="o">/</span><span class="mi">25</span><span class="p">,</span> <span class="mi">41</span><span class="o">/</span><span class="mi">25</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">P2</span><span class="p">)</span>
<span class="n">Triangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Triangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">Triangle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">Arc</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">P3</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">Curve</span><span class="p">((</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span></code></pre></figure>

<p>With these basic definitions and operations, we are ready to address more
complex situations.  Let us explore these new challenges next.</p>

<h2 id="combinatorial-computational-geometry">Combinatorial Computational Geometry</h2>

<p>Also called <em>algorithmic geometry</em>, the applications of this field are plenty:
in robotics, these are used to solve visibility problems, and motion planning,
for instance.  Similar applications are employed to design route planning or
search algorithms in <em>geographic information systems</em> (<em>GIS</em>).</p>

<p>Let us describe the different categories of problems, making emphasis on the
tools for solving them that are available in the <code class="highlighter-rouge">scipy</code> stack.</p>

<h3 id="static-problems">Static Problems</h3>

<p>The fundamental problems in this category are the following:</p>

<ul>
  <li><em>Convex hulls</em>:  Given a set of points in space, find the smallest convex
polyhedron containing them.</li>
  <li><em>Voronoi diagrams</em>:  Given a set of points in space (the <em>seeds</em>), compute a
partition in regions consisting of all points closer to each seed.</li>
  <li><em>Triangulations</em>:  Partition the plane with triangles, in a way that two
triangles are either disjoint, or otherwise they share an edge or a vertex.
There are different triangulations depending on the input objects, or
constraints on the properties of the triangles.</li>
  <li><em>Shortest paths</em>: Given a set of obstacles in a space, and two points, find
the shortest path between the points that does not intersect any of the
obstacles.</li>
</ul>

<blockquote>
  <p>The problems of computation of convex hulls, basic triangulations, and Voronoi
diagrams are intimately linked.  The theory that explains this beautiful topic
is explained in detail in a monograph in Computer Science titled <em>Computational
Geometry</em>, written by Franco Preparata and Michael Shamos.  It was published by
Springer-Verlag in 1985.</p>
</blockquote>

<h4 id="convex-hulls">Convex Hulls</h4>

<p>While it is possible to compute the convex hull of a reasonably large set of
points in the plane through the geometry module of the library <code class="highlighter-rouge">sympy</code>, this is
not recommendable.  A much faster and reliable code is available in the module
<code class="highlighter-rouge">scipy.spatial</code> through the routine <code class="highlighter-rouge">ConvexHull</code>, which is in turn a wrapper to
<code class="highlighter-rouge">qconvex</code>, from the <code class="highlighter-rouge">Qhull</code> libraries <a href="www.qhull.org">www.qhull.org</a>.  This
routine also allows the computation of convex hulls in higher dimensions.   Let
us compare both methods, with the famous <em>Lake Superior</em> polygon,
<code class="highlighter-rouge">superior.poly</code>.</p>

<blockquote>
  <p><code class="highlighter-rouge">poly</code> files represent <em>planar straight line graphs</em>—a simple list of
vertices and edges, together with information about holes and concavities, in
some cases.  The running example can be downloaded from
<a href="www.math.sc.edu/~blanco/superior.poly">www.math.sc.edu/~blanco/superior.poly</a>.
It contains a polygonal description of the coastline of Lake Superior, with 7
holes (for the islands), 518 vertices, and 518 edges.
For a complete description of the <code class="highlighter-rouge">poly</code> format, refer to <a href="www.cs.cmu.edu/~quake/triangle.poly.html">www.cs.cmu.edu/~qua
ke/triangle.poly.html</a>.  With that
information, we can write  a simple reader without much effort.  This is an
example:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">read_poly</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="s">"""
    Simple poly-file reader, that creates a python dictionary 
    with information about vertices, edges and holes.
    It assumes that vertices have no attributes or boundary markers.
    It assumes that edges have no boundary markers.
    No regional attributes or area constraints are parsed.
    """</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s">'vertices'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">'holes'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">'segments'</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    
    <span class="c"># open file and store lines in a list</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    
    <span class="c"># Store vertices</span>
    <span class="n">vertices</span><span class="o">=</span> <span class="p">[]</span>
    <span class="n">N_vertices</span><span class="p">,</span> <span class="n">dimension</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">bdry_markers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c"># We assume attr = bdrt_markers = 0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_vertices</span><span class="p">):</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span> <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)])</span>
    <span class="n">output</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">]</span><span class="o">=</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
    
    <span class="c"># Store segments</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">N_segments</span><span class="p">,</span> <span class="n">bdry_markers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">N_vertices</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_segments</span><span class="p">):</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">pointer_1</span><span class="p">,</span> <span class="n">pointer_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span> <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">N_vertices</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">pointer_1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">pointer_2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">output</span><span class="p">[</span><span class="s">'segments'</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
    
    <span class="c"># Store holes</span>
    <span class="n">N_holes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">N_segments</span><span class="o">+</span><span class="n">N_vertices</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">holes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_holes</span><span class="p">):</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span> <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">N_segments</span> <span class="o">+</span> <span class="n">N_vertices</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">k</span><span class="p">]]</span>
        <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)])</span>
    
    <span class="n">output</span><span class="p">[</span><span class="s">'holes'</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">holes</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">output</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">ConvexHull</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lake_superior</span> <span class="o">=</span> <span class="n">read_poly</span><span class="p">(</span><span class="s">"../chapter6/superior.poly"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vertices_ls</span> <span class="o">=</span> <span class="n">lake_superior</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">%</span><span class="n">time</span> <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">)</span>
<span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">413</span> <span class="err">µ</span><span class="n">s</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">213</span> <span class="err">µ</span><span class="n">s</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">626</span> <span class="err">µ</span><span class="n">s</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">372</span> <span class="err">µ</span><span class="n">s</span>    

<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vertices_ls</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.01</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vertices_ls</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.01</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertices_ls</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="s">'b.'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">simplex</span> <span class="ow">in</span> <span class="n">hull</span><span class="o">.</span><span class="n">simplices</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">[</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertices_ls</span><span class="p">[</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s">'r-'</span><span class="p">)</span>
<span class="o">...</span>    
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<h4 id="voronoi-diagrams">Voronoi Diagrams</h4>

<p>Computing the Voronoi diagram of a set of vertices (our <em>seeds</em>) can be done
with the routine <code class="highlighter-rouge">Voronoi</code> (and its companion <code class="highlighter-rouge">voronoi_plot_2d</code> for
visualization) from the module <code class="highlighter-rouge">scipy.spatial</code>.  The routine <code class="highlighter-rouge">Voronoi</code> is in
turn a wrapper to the function <code class="highlighter-rouge">qvoronoi</code>  from the <code class="highlighter-rouge">Qhull</code> libraries, with the
following default <code class="highlighter-rouge">qvoronoi</code> controls: <code class="highlighter-rouge">qhull_option='Qbb Qc Qz Qx'</code> if the
dimension of the points is greater than 4, and <code class="highlighter-rouge">qhull_options='Qbb Qc Qz'</code>
otherwise.  For the computation of the <em>furthest-site Voronoi diagram</em>, instead
of the nearest-site, we would use the extra control <code class="highlighter-rouge">Qu</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Voronoi</span><span class="p">,</span> <span class="n">voronoi_plot_2d</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vor</span> <span class="o">=</span> <span class="n">Voronoi</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">voronoi_plot_2d</span><span class="p">(</span><span class="n">vor</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span> <span class="mf">0.45</span><span class="p">,</span>  <span class="mf">0.50</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.35</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<ul>
  <li>The small dots are the original seeds with <code class="highlighter-rouge">x</code>-coordinates between <code class="highlighter-rouge">0.45</code> and
<code class="highlighter-rouge">0.50</code>, and <code class="highlighter-rouge">y</code>-coordinates between <code class="highlighter-rouge">-0.40</code> and <code class="highlighter-rouge">-0.35</code>.  We access those values
either from the original list <code class="highlighter-rouge">vertices_ls</code>, or from <code class="highlighter-rouge">vor.points</code>.</li>
  <li>The plane gets partitioned into different regions (the Voronoi cells), one for
each seed.  These regions contain all points in the plane which are closest to
its seed.  Each region receives an index, which is not necessarily the same
index as the index of its seed in the <code class="highlighter-rouge">vor.points</code> list.  To access the
corresponding region to a given seed, we use <code class="highlighter-rouge">vor.point_region</code>.</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">vor</span><span class="o">.</span><span class="n">point_region</span>
<span class="n">array</span><span class="p">([</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">22</span><span class="p">,</span>  <span class="mi">24</span><span class="p">,</span>  <span class="mi">21</span><span class="p">,</span>  <span class="mi">92</span><span class="p">,</span>  <span class="mi">89</span><span class="p">,</span>  <span class="mi">91</span><span class="p">,</span>  <span class="mi">98</span><span class="p">,</span>  <span class="mi">97</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span>
       <span class="mi">217</span><span class="p">,</span> <span class="mi">336</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">334</span><span class="p">,</span> <span class="mi">332</span><span class="p">,</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">453</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span>
       <span class="mi">235</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">333</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">340</span><span class="p">,</span>  <span class="mi">93</span><span class="p">,</span> <span class="mi">343</span><span class="p">,</span> <span class="mi">339</span><span class="p">,</span> <span class="mi">342</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">327</span><span class="p">,</span> <span class="mi">412</span><span class="p">,</span>
       <span class="mi">413</span><span class="p">,</span> <span class="mi">344</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">338</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span>  <span class="mi">67</span><span class="p">,</span> <span class="mi">272</span><span class="p">,</span> <span class="mi">408</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">403</span><span class="p">,</span> <span class="mi">407</span><span class="p">,</span> <span class="mi">406</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span>
       <span class="mi">268</span><span class="p">,</span> <span class="mi">269</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">257</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">258</span><span class="p">,</span> <span class="mi">259</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">261</span><span class="p">,</span> <span class="mi">263</span><span class="p">,</span>  <span class="mi">15</span><span class="p">,</span>  <span class="mi">70</span><span class="p">,</span>
        <span class="mi">72</span><span class="p">,</span> <span class="mi">278</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">277</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">274</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="mi">318</span><span class="p">,</span>
       <span class="mi">317</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">313</span><span class="p">,</span> <span class="mi">309</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">364</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span>
       <span class="mi">433</span><span class="p">,</span> <span class="mi">362</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">363</span><span class="p">,</span> <span class="mi">361</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">308</span><span class="p">,</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">311</span><span class="p">,</span> <span class="mi">316</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">319</span><span class="p">,</span>
       <span class="mi">284</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">286</span><span class="p">,</span> <span class="mi">452</span><span class="p">,</span> <span class="mi">451</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">482</span><span class="p">,</span> <span class="mi">483</span><span class="p">,</span> <span class="mi">409</span><span class="p">,</span> <span class="mi">493</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">485</span><span class="p">,</span> <span class="mi">484</span><span class="p">,</span>
       <span class="mi">510</span><span class="p">,</span> <span class="mi">516</span><span class="p">,</span> <span class="mi">517</span><span class="p">,</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">494</span><span class="p">,</span> <span class="mi">518</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">515</span><span class="p">,</span> <span class="mi">511</span><span class="p">,</span> <span class="mi">513</span><span class="p">,</span> <span class="mi">514</span><span class="p">,</span> <span class="mi">508</span><span class="p">,</span> <span class="mi">509</span><span class="p">,</span>
       <span class="mi">487</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span> <span class="mi">488</span><span class="p">,</span> <span class="mi">489</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">429</span><span class="p">,</span> <span class="mi">431</span><span class="p">,</span> <span class="mi">430</span><span class="p">,</span> <span class="mi">359</span><span class="p">,</span> <span class="mi">490</span><span class="p">,</span> <span class="mi">491</span><span class="p">,</span> <span class="mi">492</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span>
       <span class="mi">146</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">463</span><span class="p">,</span> <span class="mi">428</span><span class="p">,</span> <span class="mi">357</span><span class="p">,</span>
       <span class="mi">427</span><span class="p">,</span> <span class="mi">462</span><span class="p">,</span> <span class="mi">459</span><span class="p">,</span> <span class="mi">461</span><span class="p">,</span> <span class="mi">460</span><span class="p">,</span> <span class="mi">426</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">352</span><span class="p">,</span> <span class="mi">356</span><span class="p">,</span> <span class="mi">355</span><span class="p">,</span> <span class="mi">421</span><span class="p">,</span>
       <span class="mi">423</span><span class="p">,</span> <span class="mi">424</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">422</span><span class="p">,</span>  <span class="mi">46</span><span class="p">,</span>  <span class="mi">47</span><span class="p">,</span>  <span class="mi">48</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span>  <span class="mi">33</span><span class="p">,</span>  <span class="mi">32</span><span class="p">,</span>  <span class="mi">31</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>
       <span class="mi">107</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">358</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span>  <span class="mi">44</span><span class="p">,</span>   <span class="mi">6</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span>
       <span class="mi">135</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span>  <span class="mi">45</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span>  <span class="mi">41</span><span class="p">,</span>  <span class="mi">36</span><span class="p">,</span>  <span class="mi">37</span><span class="p">,</span>
        <span class="mi">40</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span>   <span class="mi">7</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span>  <span class="mi">39</span><span class="p">,</span>  <span class="mi">38</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span>   <span class="mi">8</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span>
        <span class="mi">35</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span>  <span class="mi">34</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>  <span class="mi">99</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>  <span class="mi">29</span><span class="p">,</span>
       <span class="mi">104</span><span class="p">,</span>  <span class="mi">28</span><span class="p">,</span>  <span class="mi">30</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">306</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">348</span><span class="p">,</span> <span class="mi">349</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span>
        <span class="mi">57</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span>  <span class="mi">58</span><span class="p">,</span>   <span class="mi">9</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">295</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">346</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span>
       <span class="mi">161</span><span class="p">,</span>  <span class="mi">53</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span>  <span class="mi">19</span><span class="p">,</span>  <span class="mi">20</span><span class="p">,</span>  <span class="mi">55</span><span class="p">,</span>  <span class="mi">56</span><span class="p">,</span>  <span class="mi">49</span><span class="p">,</span> <span class="mi">298</span><span class="p">,</span> <span class="mi">296</span><span class="p">,</span> <span class="mi">299</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span>
       <span class="mi">292</span><span class="p">,</span> <span class="mi">291</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>  <span class="mi">52</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">293</span><span class="p">,</span>  <span class="mi">50</span><span class="p">,</span>  <span class="mi">83</span><span class="p">,</span>
        <span class="mi">82</span><span class="p">,</span>  <span class="mi">84</span><span class="p">,</span>  <span class="mi">85</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">249</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span>
       <span class="mi">213</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">371</span><span class="p">,</span> <span class="mi">372</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">374</span><span class="p">,</span> <span class="mi">442</span><span class="p">,</span> <span class="mi">445</span><span class="p">,</span> <span class="mi">441</span><span class="p">,</span> <span class="mi">444</span><span class="p">,</span> <span class="mi">438</span><span class="p">,</span> <span class="mi">446</span><span class="p">,</span>
       <span class="mi">439</span><span class="p">,</span> <span class="mi">440</span><span class="p">,</span> <span class="mi">468</span><span class="p">,</span> <span class="mi">467</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">470</span><span class="p">,</span> <span class="mi">471</span><span class="p">,</span> <span class="mi">505</span><span class="p">,</span> <span class="mi">507</span><span class="p">,</span> <span class="mi">464</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">379</span><span class="p">,</span>
       <span class="mi">382</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">478</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">449</span><span class="p">,</span> <span class="mi">398</span><span class="p">,</span> <span class="mi">447</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">474</span><span class="p">,</span> <span class="mi">477</span><span class="p">,</span> <span class="mi">383</span><span class="p">,</span> <span class="mi">381</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span>
       <span class="mi">437</span><span class="p">,</span> <span class="mi">466</span><span class="p">,</span> <span class="mi">434</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">436</span><span class="p">,</span> <span class="mi">387</span><span class="p">,</span> <span class="mi">386</span><span class="p">,</span> <span class="mi">385</span><span class="p">,</span> <span class="mi">479</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">481</span><span class="p">,</span>
       <span class="mi">448</span><span class="p">,</span> <span class="mi">395</span><span class="p">,</span> <span class="mi">399</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">281</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">391</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">396</span><span class="p">,</span> <span class="mi">397</span><span class="p">,</span>
       <span class="mi">388</span><span class="p">,</span> <span class="mi">389</span><span class="p">,</span> <span class="mi">394</span><span class="p">,</span> <span class="mi">393</span><span class="p">,</span> <span class="mi">392</span><span class="p">,</span> <span class="mi">163</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span>  <span class="mi">76</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">283</span><span class="p">,</span> <span class="mi">279</span><span class="p">,</span> <span class="mi">282</span><span class="p">,</span>
       <span class="mi">194</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span>  <span class="mi">78</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span>
       <span class="mi">182</span><span class="p">,</span>  <span class="mi">75</span><span class="p">,</span>  <span class="mi">71</span><span class="p">,</span> <span class="mi">264</span><span class="p">,</span> <span class="mi">262</span><span class="p">,</span>  <span class="mi">73</span><span class="p">,</span>  <span class="mi">74</span><span class="p">,</span>  <span class="mi">59</span><span class="p">,</span>  <span class="mi">63</span><span class="p">,</span>  <span class="mi">62</span><span class="p">,</span>  <span class="mi">60</span><span class="p">,</span>  <span class="mi">61</span><span class="p">,</span>  <span class="mi">66</span><span class="p">,</span>
        <span class="mi">64</span><span class="p">,</span>  <span class="mi">65</span><span class="p">,</span>  <span class="mi">11</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span>  <span class="mi">14</span><span class="p">,</span>  <span class="mi">69</span><span class="p">,</span>  <span class="mi">68</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span>  <span class="mi">88</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span>
       <span class="mi">228</span><span class="p">,</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">322</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">323</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">321</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span>  <span class="mi">27</span><span class="p">,</span>  <span class="mi">25</span><span class="p">,</span>  <span class="mi">95</span><span class="p">,</span>
        <span class="mi">94</span><span class="p">,</span>  <span class="mi">96</span><span class="p">,</span>  <span class="mi">90</span><span class="p">,</span>  <span class="mi">86</span><span class="p">,</span>  <span class="mi">87</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">326</span><span class="p">,</span> <span class="mi">499</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">498</span><span class="p">,</span> <span class="mi">458</span><span class="p">,</span>
       <span class="mi">496</span><span class="p">,</span> <span class="mi">497</span><span class="p">,</span> <span class="mi">411</span><span class="p">,</span> <span class="mi">329</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="mi">457</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">455</span><span class="p">,</span> <span class="mi">331</span><span class="p">,</span> <span class="mi">267</span><span class="p">,</span> <span class="mi">266</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span>
       <span class="mi">183</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span>
       <span class="mi">177</span><span class="p">,</span> <span class="mi">402</span><span class="p">,</span> <span class="mi">380</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span>  <span class="mi">79</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span>
       <span class="mi">199</span><span class="p">,</span>  <span class="mi">81</span><span class="p">,</span>  <span class="mi">18</span><span class="p">,</span>  <span class="mi">17</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span>  <span class="mi">77</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">469</span><span class="p">,</span> <span class="mi">473</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">376</span><span class="p">,</span>
       <span class="mi">366</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">369</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">367</span><span class="p">,</span> <span class="mi">368</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">472</span><span class="p">,</span> <span class="mi">504</span><span class="p">,</span> <span class="mi">506</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">354</span><span class="p">,</span>
       <span class="mi">353</span><span class="p">,</span>  <span class="mi">54</span><span class="p">,</span>  <span class="mi">42</span><span class="p">,</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">417</span><span class="p">,</span> <span class="mi">414</span><span class="p">,</span> <span class="mi">415</span><span class="p">,</span> <span class="mi">418</span><span class="p">,</span> <span class="mi">419</span><span class="p">,</span> <span class="mi">425</span><span class="p">])</span></code></pre></figure>

<ul>
  <li>Each Voronoi cell is defined by its delimiting vertices and edges (also known
as <em>ridges</em> in Voronoi jargon).  The list with the coordinates of the computed
vertices of the Voronoi diagram can be obtained with <code class="highlighter-rouge">vor.vertices</code>.  These
vertices were represented as bigger dots in the previous image, and are easily
identifiable because they are always at the intersection of at least two edges
— while the seeds have no incoming edges.</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">vor</span><span class="o">.</span><span class="n">vertices</span>
<span class="n">array</span><span class="p">([[</span> <span class="mf">0.88382749</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.23508215</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.10607886</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.63051169</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.03091439</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.55536174</span><span class="p">],</span>
       <span class="o">...</span><span class="p">,</span> 
       <span class="p">[</span> <span class="mf">0.49834202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.62265786</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.50247159</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.61971784</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.5028735</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.62003065</span><span class="p">]])</span></code></pre></figure>

<ul>
  <li>For each of the regions, we can access the set of delimiting vertices with
<code class="highlighter-rouge">vor.regions</code>.  For instance, to obtain the coordinates of the vertices that
delimit the region around the 4th seed, we could issue</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">vor</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vor</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">vor</span><span class="o">.</span><span class="n">point_region</span><span class="p">[</span><span class="mi">4</span><span class="p">]]]</span>
<span class="p">[</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.13930793</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.81205929</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="mf">0.11638</span>   <span class="p">,</span> <span class="o">-</span><span class="mf">0.92111088</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="mf">0.11638</span>   <span class="p">,</span> <span class="o">-</span><span class="mf">0.63657789</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="mf">0.11862537</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6303235</span> <span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="mf">0.12364332</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.62893576</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="mf">0.12405738</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.62891987</span><span class="p">])]</span>

 </code></pre></figure>

<p>Care must be taken with the previous step: Some of the vertices of the Voronoi
cells are not actual vertices, but lie <em>at infinity</em>.  When this is the case,
they are identified with the index <code class="highlighter-rouge">-1</code>.  In this situation, to provide an
accurate representation of a ridge of these characteristics we must use the
knowledge of the two seeds whose contiguous Voronoi cells intersect on said
ridge—since the ridge is perpendicular to the segment defined by those two
seeds.  We obtain the information about those seeds with <code class="highlighter-rouge">vor.ridge_points</code></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">vor</span><span class="o">.</span><span class="n">ridge_points</span>
<span class="n">array</span><span class="p">([[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">433</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">434</span><span class="p">],</span>
       <span class="o">...</span><span class="p">,</span> 
       <span class="p">[</span><span class="mi">124</span><span class="p">,</span> <span class="mi">118</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">119</span><span class="p">,</span> <span class="mi">122</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span></code></pre></figure>

<p>The first entry of <code class="highlighter-rouge">vor.ridge_points</code> can be read as follows: There is a ridge
perpendicular to both the first and second seeds.</p>

<p>There are other attributes of the object <code class="highlighter-rouge">vor</code> that we may use to inquire
properties of the Voronoi diagram, but the ones we have described should be
enough to replicate the previous image.  We leave this as a nice exercise:</p>

<ol>
  <li>Gather the indices of the seeds from <code class="highlighter-rouge">vor.points</code> that have their <code class="highlighter-rouge">x</code>- and
<code class="highlighter-rouge">y</code>-coordinates in the required window.  Plot them.</li>
  <li>For each of those seeds, gather information about vertices of their
corresponding Voronoi cells.  Plot those vertices not at the infity with a
different style as the seeds.</li>
  <li>Gather information about the ridges of each relevant region, and plot them as
simple thin segments.  Some of the ridges cannot be represented by their two
vertices.  In that case, we use the information about the seeds that determine
them.</li>
</ol>

<h4 id="triangulations">Triangulations</h4>

<p>A <em>triangulation</em> of a set of vertices in the plane is a division of the convex
hull of the vertices into triangles, satisfying one important condition.  Any
two given triangles:</p>

<ul>
  <li>must be disjoint, or</li>
  <li>must intersect only at one common vertex, or</li>
  <li>must share one common edge.</li>
</ul>

<p>These plain triangulations have not much computational value, since some of its
triangles might be too skinny — this leads to uncomfortable rounding errors,
or computation or erroneous areas, centers, etc.  Among all possible
triangulations, we always seek one where the properties of the triangles are
somehow balanced.</p>

<p>With this purpose in mind, we have the <em>Delaunay triangulation</em> of a set of
vertices.  This triangulation satisfies an extra condition: None of the vertices
lies in the interior of the circumcircle of any triangle.  We refer to triangles
with this property as <em>Delaunay triangles</em>.</p>

<p>For this simpler setting, in the module <code class="highlighter-rouge">scipy.spatial</code>, we have the routine
<code class="highlighter-rouge">Delaunay</code>, which is in turn a wrapper to the function <code class="highlighter-rouge">qdelaunay</code> from the
<code class="highlighter-rouge">Qhull</code> libraries, with the <code class="highlighter-rouge">qdelaunay</code> controls set exactly as for the Voronoi
diagram computations.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span><span class="p">,</span> <span class="n">delaunay_plot_2d</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">delaunay_plot_2d</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<p>It is possible to generate triangulations with imposed edges too.  Given a
collection of vertices and edges, a <em>constrained Delaunay triangulation</em> is a
division of the space into triangles with those prescribed features.  The
triangles in this triangulation are not necessarily Delaunay.</p>

<p>We can accomplish this extra condition sometimes by subdivision of each of the
imposed edges.  We call this triangulation <em>conforming Delaunay</em>, and the new
(artificial) vertices needed to subdivide the edges are called <em>Steiner points</em>.</p>

<p>A <em>constrained conforming Delaunay triangulation</em> of an imposed set of vertices
and edges satisfies a few more conditions, usually setting thresholds on the
values of angles or areas of the triangles.  This is achieved by introducing a
new set of <em>Steiner points</em>, which are allowed anywhere, not only on edges.</p>

<blockquote>
  <p>To achieve these high-level triangulations, we need to step outside of the
<code class="highlighter-rouge">scipy</code> stack.  We have a <code class="highlighter-rouge">python</code> wrapper to the amazing implementation of mesh
generators
<a href="www.cs.cmu.edu/~quake/triangle.html">www.cs.cmu.edu/~quake/triangle.html</a> by
Richard Shewchuck .  This wrapper, together with examples and other related
functions, can be installed by issuing
       pip install triangle
For more information on this module, refer to the documentation online from
its author, Dzhelil Rufat, at
<a href="dzhelil.info/triangle/index.html">dzhelil.info/triangle/index.html</a></p>
</blockquote>

<p>Let us compute those different triangulations for our running example.  We use
once again the <code class="highlighter-rouge">poly</code> file with the features of Lake Superior, which we read
into a dictionary with all the information about vertices, segments and holes.
The first example is that of the constrained Delaunay triangulation (<code class="highlighter-rouge">cndt</code>).
We accomplish this task with the flag <code class="highlighter-rouge">p</code> (indicating that the source is a
<em>planar straight line graph</em>, rather than a set of vertices).</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">triangle</span> <span class="kn">import</span> <span class="n">triangulate</span><span class="p">,</span> <span class="n">plot</span> <span class="k">as</span> <span class="n">tplot</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cndt</span> <span class="o">=</span> <span class="n">triangulate</span><span class="p">(</span><span class="n">lake_superior</span><span class="p">,</span> <span class="s">'p'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">cndt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<p>The next step is the computation of a conforming Delaunay triangulation
(<code class="highlighter-rouge">cfdt</code>).  We enforce Steiner points on some segments to ensure as many Delaunay
triangles as possible.  We achieve this with extra flag <code class="highlighter-rouge">D</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; cfdt = triangulate(lake_superior, 'pD')
</code></pre>
</div>

<p>But slight or no improvements with respect to the previous diagram can be
observed in this case.  The real improvement arises when we further impose
constraints in the values of minimum angles on triangles (with the flag <code class="highlighter-rouge">q</code>), or
in the maximum values of the areas of triangles (with the flag ‘a’).  For
instance, if we require a constrained conforming Delaunay triangulation
(<code class="highlighter-rouge">cncfdt</code>) in which all triangles have a minimum angle of at least 20 degrees,
we issue the following command</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">cncfq20dt</span> <span class="o">=</span> <span class="n">triangulate</span><span class="p">(</span><span class="n">lake_superior</span><span class="p">,</span> <span class="s">'pq20D'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">cncfq20dt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<p>For the last example to conclude this section, we further impose a maximum area
on triangles.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">cncfq20adt</span> <span class="o">=</span> <span class="n">triangulate</span><span class="p">(</span><span class="n">lake_superior</span><span class="p">,</span> <span class="s">'pq20a.001D'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">cncfq20adt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<h4 id="shortest-paths">Shortest Paths</h4>

<p>We will use the last example to introduce a special setting of the problem of
shortest paths.  We pick a location in the North-West coast of the lake (say,
the vertex indexed as <code class="highlighter-rouge">370</code> in the original <code class="highlighter-rouge">poly</code> file), and the goal is to
compute the shortest path to the furthest South-East location on the shore, at
the bottom-right corner—this is the vertex indexed as <code class="highlighter-rouge">179</code> in the original
<code class="highlighter-rouge">poly</code> file.   By a <em>path</em> in this setting, we mean a chain of edges of the
triangulation.</p>

<p>In the <code class="highlighter-rouge">scipy</code> stack we accomplish the computation of shortest paths on a
triangulation (and in some other similar geometries that can be coded by means
of graphs) by relying on two modules:</p>

<ul>
  <li><code class="highlighter-rouge">scipy.sparse</code> to store a weighted-adjacency matrix <code class="highlighter-rouge">G</code> representing the
triangulation.  Each non-zero entry <code class="highlighter-rouge">G[i,j]</code> of this adjacency matrix is
precisely the length of the edge from vertex <code class="highlighter-rouge">i</code> to vertex <code class="highlighter-rouge">j</code>.</li>
  <li><code class="highlighter-rouge">scipy.sparse.csgraph</code>, the module that deals with <em>compressed sparse graphs</em>.
This module contains routines to analyze, extract information or manipulate
graphs.  Among these routines, we have several different algorithms to compute
shortest paths on a graph.</li>
</ul>

<blockquote>
  <p>For more information on the module <code class="highlighter-rouge">scipy.sparse.csgraph</code>, refer to the online
documentation at <a href="docs.s&#10;cipy.org/doc/scipy/reference/sparse.csgraph.html">docs.scipy.org/doc/scipy/reference/sparse.csgraph.html</a>
For the theory and applications of Graph Theory, one of the best sources is
the introductory book by Reinhard Diestel, <em>Graph Theory</em>, published by
Springer-Verlag.</p>
</blockquote>

<p>Let us illustrate this example with proper code.  We start by collecting the
indices of the vertices of all segments in the triangulation, and the lengths of
these segments.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">minkowski_distance</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'triangles'</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'triangles'</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'triangles'</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Xvert</span> <span class="o">=</span> <span class="p">[</span><span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Yvert</span> <span class="o">=</span> <span class="p">[</span><span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">Y</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Zvert</span> <span class="o">=</span> <span class="p">[</span><span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">][</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">Z</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lengthsXY</span> <span class="o">=</span> <span class="n">minkowski_distance</span><span class="p">(</span><span class="n">Xvert</span><span class="p">,</span> <span class="n">Yvert</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lengthsXZ</span> <span class="o">=</span> <span class="n">minkowski_distance</span><span class="p">(</span><span class="n">Xvert</span><span class="p">,</span> <span class="n">Zvert</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lengthsYZ</span> <span class="o">=</span> <span class="n">minkowski_distance</span><span class="p">(</span><span class="n">Yvert</span><span class="p">,</span> <span class="n">Zvert</span><span class="p">)</span></code></pre></figure>

<p>We now create the weighted-adjacency matrix, which we store as a <code class="highlighter-rouge">lil_matrix</code>,
and compute the shortest path between the requested vertices.  We gather in a
list all the vertices included in the computed path, and plot the resulting
chain overlaid on the triangulation.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">lil_matrix</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.sparse.csgraph</span> <span class="kn">import</span> <span class="n">shortest_path</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nvert</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">G</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="n">nvert</span><span class="p">,</span> <span class="n">nvert</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
<span class="o">...</span>     <span class="n">G</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lengthsXY</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">G</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">Z</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lengthsXZ</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">G</span><span class="p">[</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">Z</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lengthsYZ</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="o">...</span> 

<span class="o">&gt;&gt;&gt;</span> <span class="n">dist_matrix</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">return_predecessors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">unweighted</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">370</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="mi">370</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">while</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">197</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">index</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="mi">197</span><span class="p">,</span> <span class="n">index</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="o">...</span>     

<span class="o">&gt;&gt;&gt;</span> <span class="n">Xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">cncfq20adt</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">cncfq20adt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">,</span> <span class="s">'-'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">);</span> \
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<h3 id="geometric-query-problems">Geometric Query Problems</h3>

<p>The fundamental problems in this category are the following:</p>

<ul>
  <li>Point Location.</li>
  <li>Nearest neighbor.</li>
  <li>Range searching.</li>
</ul>

<h4 id="point-location">Point Location</h4>

<p>The problem of <em>point location</em> is fundamental in Computational Geometry—given a
partition of the space into disjoint regions, we need to query the region that
contains a target location.</p>

<p>The most basic point location problems are those where the partition is given by
a single geometric object: a circle, or a polygon, for example. For those simple
objects that have been constructed through any of the classes in the module
<code class="highlighter-rouge">sympy.geometry</code>, we have two useful methods: <code class="highlighter-rouge">.encloses_point</code> and <code class="highlighter-rouge">.encloses</code>.</p>

<p>The former checks whether a point is interior to a source object (but not on the
border), while the latter checks whether another target object has all its
defining entities in the interior of the source object.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">P1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P3</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P4</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">T</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="o">.</span><span class="n">encloses_point</span><span class="p">(</span><span class="n">P1</span><span class="p">)</span>
<span class="bp">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="o">.</span><span class="n">encloses</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="bp">False</span></code></pre></figure>

<p>Of special importance is this simple setting where the source object is a
polygon.  The routines in the <code class="highlighter-rouge">sympy.geometry</code> module get the job done, but at
the cost of too many resources and time.  A much faster way to approach this
problem is by using the <code class="highlighter-rouge">Path</code> class from the libraries of <code class="highlighter-rouge">matplotlib.path</code>.
Let us see how with a quick session: first, we create a representation of a
polygon as a <code class="highlighter-rouge">Path</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">my_polygon</span> <span class="o">=</span> <span class="n">Path</span><span class="p">([</span><span class="n">hull</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hull</span><span class="o">.</span><span class="n">vertices</span><span class="p">])</span></code></pre></figure>

<p>We may ask now whether a point (respectively, a sequence of points) is interior
to the polygon.  We accomplish this with either attribute <code class="highlighter-rouge">contains_point</code> or
<code class="highlighter-rouge">contains_points</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Y</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">my_polygon</span><span class="o">.</span><span class="n">contains_points</span><span class="p">([[</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))])</span>
<span class="n">array</span><span class="p">([</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>
       <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
        <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
        <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
       <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
       <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
       <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
        <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>
        <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
       <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
        <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span></code></pre></figure>

<p>More challenging point location problem arise when our space is partitioned by a
complex structure.  For instance, once a triangulation has been computed, and a
random location is considered, we need to query for the triangle where our
target location lies.  In the module <code class="highlighter-rouge">scipy.spatial</code> we have handy routines to
perform this task over Delaunay triangulations created with
<code class="highlighter-rouge">scipy.spatial.Delaunay</code>.  In the following example, we track the triangles that
contain a set of 100 random points in the domain.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">tsearch</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">points</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tsearch</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mi">274</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span> <span class="mi">647</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">988</span><span class="p">,</span> <span class="mi">882</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">691</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">647</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">647</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">602</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">11</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">894</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">819</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
       <span class="mi">180</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">728</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">11</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span></code></pre></figure>

<p>The same result is obtained with the method <code class="highlighter-rouge">.find_simplex</code> of the <code class="highlighter-rouge">Delaunay</code>
object <code class="highlighter-rouge">tri</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mi">274</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span> <span class="mi">647</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">988</span><span class="p">,</span> <span class="mi">882</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">691</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">647</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">454</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">647</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">602</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">11</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">894</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">819</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
       <span class="mi">180</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">728</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">11</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span></code></pre></figure>

<blockquote>
  <p>Note that, when a triangle is found, the routine reports its corresponding
index in <code class="highlighter-rouge">tri.simplices</code>.  If no triangle is found (which means the point is
exterior to the convex hull of the triangulation), the index reported is <code class="highlighter-rouge">-1</code>.</p>
</blockquote>

<h4 id="nearest-neighbors">Nearest Neighbors</h4>

<p>The problem of finding the Voronoi cell that contains a given location is
equivalent to the search for the <em>nearest neighbor</em> in a set of seeds.  We can
always perform this search with a brute force algorithm — and this is
acceptable in some cases — but in general, there are more elegant and less
complex approaches to this problem.   The key lies in the concept of <em>k-d
trees</em>: a special case of binary space partitioning structures for organizing
points, conductive to fast searches.</p>

<p>In the <code class="highlighter-rouge">scipy</code> stack we have an implementation of k-d trees, the <code class="highlighter-rouge">python</code> class
<code class="highlighter-rouge">KDTree</code>, in the module <code class="highlighter-rouge">scipy.spatial</code>.  This implementation is based on ideas
published in 1999 by Maneewongvatana and Mount.  It is initialized with the
location of our input points.  Once created, it can be manipulated and queried
with the following methods and attributes:</p>

<ul>
  <li>
    <p>Methods:</p>

    <ul>
      <li><code class="highlighter-rouge">data</code>: it presents the input</li>
      <li><code class="highlighter-rouge">leafsize</code>: the number of points at which the algorithm switches to brute-
force.  This value can be optionally offered in the initialization of the
<code class="highlighter-rouge">KDTree</code> object.</li>
      <li><code class="highlighter-rouge">m</code>: The dimension of the space where the points are located.</li>
      <li><code class="highlighter-rouge">n</code>: The number of input points.</li>
      <li><code class="highlighter-rouge">maxes</code>: It indicates the highest values of each of the coordinates of the
input points.</li>
      <li><code class="highlighter-rouge">mins</code>: It indicates the lowest values of each of the coordinates of the
input points.</li>
    </ul>
  </li>
  <li>
    <p>Attributes:</p>

    <ul>
      <li><code class="highlighter-rouge">query(self, Q, p=2.0)</code>: The attribute that searches for the nearest-
neighbor or a target location <code class="highlighter-rouge">Q</code>, using the structure of the k-d tree, with
respect to the Minkowski <code class="highlighter-rouge">p</code>-distance.</li>
      <li><code class="highlighter-rouge">query_ball_point(self, Q, r, p=2.0)</code>: A more sophisticated query that
outputs all points within Minkowski <code class="highlighter-rouge">p</code>-distance <code class="highlighter-rouge">r</code> from a target location <code class="highlighter-rouge">Q</code></li>
      <li><code class="highlighter-rouge">query_pairs(self, r, p=2.0)</code>:  Find all pairs of points whose Minkowski
<code class="highlighter-rouge">p</code>-distance is at most <code class="highlighter-rouge">r</code>.</li>
      <li><code class="highlighter-rouge">query_ball_tree(self, other, r, p=2.0)</code>: similar to <code class="highlighter-rouge">query_pairs</code>, but
this attribute finds all pairs of points from two different k-d trees, which are
at a Minkowski <code class="highlighter-rouge">p</code>-distance of at least <code class="highlighter-rouge">r</code>.</li>
      <li><code class="highlighter-rouge">sparse_distance_matrix(self, other, max_distance)</code>: Computes a distance
matrix between two k-d trees, leaving as zero any distance greater than
<code class="highlighter-rouge">max_distance</code>.  The output is stored in a sparse <code class="highlighter-rouge">dok_matrix</code>.</li>
      <li><code class="highlighter-rouge">count_neighbors(self, other, r, p=2.0)</code>: This attribute is an
implementation of the <em>Two-point correlation</em> designed by Gray and Moore, to
count the number of pairs of points from two different kd-trees, which are at a
Minkowski <code class="highlighter-rouge">p</code>-distance not larger than <code class="highlighter-rouge">r</code>.  Unlike <code class="highlighter-rouge">query_ball</code>, this attribute
does not produce the actual pairs.</li>
    </ul>
  </li>
</ul>

<p>There is a faster implementation of this object created as an extension type in
<code class="highlighter-rouge">cyton</code>, the <code class="highlighter-rouge">cdef</code> class <code class="highlighter-rouge">cKDTree</code>.  The main difference is in the way the
nodes are coded on each case:</p>

<ul>
  <li>For <code class="highlighter-rouge">KDTree</code>, the nodes are nested <code class="highlighter-rouge">python</code> classes (<code class="highlighter-rouge">node</code> being the top
class, and <code class="highlighter-rouge">leafnode</code>, <code class="highlighter-rouge">innernode</code> being subclasses that represent different
kinds of nodes in the tree).</li>
  <li>For <code class="highlighter-rouge">cKDTree</code>, the nodes are <code class="highlighter-rouge">C</code>-type malloc’d structs, not classes.  This
makes the implementation much faster, at a price of less control over a possible
manipulation of the nodes.</li>
</ul>

<p>Let use this idea to solve a point location problem, and at the same time
revisit the Voronoi diagram from Lake Superior.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vor</span>  <span class="o">=</span> <span class="n">Voronoi</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">)</span></code></pre></figure>

<p>First, we query for the previous dataset of 100 random locations, the seeds that
are closer to each of them</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="p">(</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.00696135</span><span class="p">,</span>  <span class="mf">0.2156821</span> <span class="p">,</span>  <span class="mf">0.03359866</span><span class="p">,</span>  <span class="mf">0.01102301</span><span class="p">,</span>  <span class="mf">0.02959793</span><span class="p">,</span>
         <span class="mf">0.00332914</span><span class="p">,</span>  <span class="mf">0.23081084</span><span class="p">,</span>  <span class="mf">0.01235589</span><span class="p">,</span>  <span class="mf">0.03570128</span><span class="p">,</span>  <span class="mf">0.27909962</span><span class="p">,</span>
         <span class="mf">0.14464606</span><span class="p">,</span>  <span class="mf">0.11046009</span><span class="p">,</span>  <span class="mf">0.16062173</span><span class="p">,</span>  <span class="mf">0.12011036</span><span class="p">,</span>  <span class="mf">0.06896572</span><span class="p">,</span>
         <span class="mf">0.41319946</span><span class="p">,</span>  <span class="mf">0.23482566</span><span class="p">,</span>  <span class="mf">0.0202923</span> <span class="p">,</span>  <span class="mf">0.00503325</span><span class="p">,</span>  <span class="mf">0.00312809</span><span class="p">,</span>
         <span class="mf">0.09461517</span><span class="p">,</span>  <span class="mf">0.02886394</span><span class="p">,</span>  <span class="mf">0.02134482</span><span class="p">,</span>  <span class="mf">0.04146156</span><span class="p">,</span>  <span class="mf">0.00963273</span><span class="p">,</span>
         <span class="mf">0.07768318</span><span class="p">,</span>  <span class="mf">0.24809128</span><span class="p">,</span>  <span class="mf">0.00973111</span><span class="p">,</span>  <span class="mf">0.02865847</span><span class="p">,</span>  <span class="mf">0.06101067</span><span class="p">,</span>
         <span class="mf">0.03944798</span><span class="p">,</span>  <span class="mf">0.1415272</span> <span class="p">,</span>  <span class="mf">0.16795927</span><span class="p">,</span>  <span class="mf">0.03543673</span><span class="p">,</span>  <span class="mf">0.0333806</span> <span class="p">,</span>
         <span class="mf">0.21161309</span><span class="p">,</span>  <span class="mf">0.35952025</span><span class="p">,</span>  <span class="mf">0.05399864</span><span class="p">,</span>  <span class="mf">0.2133998</span> <span class="p">,</span>  <span class="mf">0.10991783</span><span class="p">,</span>
         <span class="mf">0.16167264</span><span class="p">,</span>  <span class="mf">0.24837308</span><span class="p">,</span>  <span class="mf">0.04195559</span><span class="p">,</span>  <span class="mf">0.01060838</span><span class="p">,</span>  <span class="mf">0.20048378</span><span class="p">,</span>
         <span class="mf">0.34552545</span><span class="p">,</span>  <span class="mf">0.03215333</span><span class="p">,</span>  <span class="mf">0.02900217</span><span class="p">,</span>  <span class="mf">0.06124501</span><span class="p">,</span>  <span class="mf">0.10751073</span><span class="p">,</span>
         <span class="mf">0.19669567</span><span class="p">,</span>  <span class="mf">0.17761417</span><span class="p">,</span>  <span class="mf">0.06772935</span><span class="p">,</span>  <span class="mf">0.04775046</span><span class="p">,</span>  <span class="mf">0.15318515</span><span class="p">,</span>
         <span class="mf">0.05524147</span><span class="p">,</span>  <span class="mf">0.06485813</span><span class="p">,</span>  <span class="mf">0.07798391</span><span class="p">,</span>  <span class="mf">0.29622176</span><span class="p">,</span>  <span class="mf">0.04096707</span><span class="p">,</span>
         <span class="mf">0.15903166</span><span class="p">,</span>  <span class="mf">0.10583702</span><span class="p">,</span>  <span class="mf">0.25479728</span><span class="p">,</span>  <span class="mf">0.02080896</span><span class="p">,</span>  <span class="mf">0.01747343</span><span class="p">,</span>
         <span class="mf">0.04874742</span><span class="p">,</span>  <span class="mf">0.07251445</span><span class="p">,</span>  <span class="mf">0.0267058</span> <span class="p">,</span>  <span class="mf">0.01481491</span><span class="p">,</span>  <span class="mf">0.00478615</span><span class="p">,</span>
         <span class="mf">0.15630242</span><span class="p">,</span>  <span class="mf">0.0728038</span> <span class="p">,</span>  <span class="mf">0.03154718</span><span class="p">,</span>  <span class="mf">0.13789812</span><span class="p">,</span>  <span class="mf">0.00113166</span><span class="p">,</span>
         <span class="mf">0.11565746</span><span class="p">,</span>  <span class="mf">0.33276404</span><span class="p">,</span>  <span class="mf">0.19057214</span><span class="p">,</span>  <span class="mf">0.03953368</span><span class="p">,</span>  <span class="mf">0.2055712</span> <span class="p">,</span>
         <span class="mf">0.07878881</span><span class="p">,</span>  <span class="mf">0.18618894</span><span class="p">,</span>  <span class="mf">0.29061068</span><span class="p">,</span>  <span class="mf">0.28516096</span><span class="p">,</span>  <span class="mf">0.03010459</span><span class="p">,</span>
         <span class="mf">0.20610317</span><span class="p">,</span>  <span class="mf">0.11743626</span><span class="p">,</span>  <span class="mf">0.01496555</span><span class="p">,</span>  <span class="mf">0.08025486</span><span class="p">,</span>  <span class="mf">0.04525199</span><span class="p">,</span>
         <span class="mf">0.08830948</span><span class="p">,</span>  <span class="mf">0.23479888</span><span class="p">,</span>  <span class="mf">0.2565738</span> <span class="p">,</span>  <span class="mf">0.05088667</span><span class="p">,</span>  <span class="mf">0.02761566</span><span class="p">,</span>
         <span class="mf">0.16531317</span><span class="p">,</span>  <span class="mf">0.09743108</span><span class="p">,</span>  <span class="mf">0.04672793</span><span class="p">,</span>  <span class="mf">0.17032771</span><span class="p">,</span>  <span class="mf">0.1878217</span> <span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span><span class="mi">262</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span>  <span class="mi">57</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">311</span><span class="p">,</span> <span class="mi">412</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">406</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span>
        <span class="mi">311</span><span class="p">,</span>  <span class="mi">91</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span>  <span class="mi">91</span><span class="p">,</span> <span class="mi">451</span><span class="p">,</span> <span class="mi">326</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">409</span><span class="p">,</span> <span class="mi">311</span><span class="p">,</span>
        <span class="mi">311</span><span class="p">,</span> <span class="mi">414</span><span class="p">,</span> <span class="mi">398</span><span class="p">,</span>  <span class="mi">89</span><span class="p">,</span> <span class="mi">263</span><span class="p">,</span> <span class="mi">417</span><span class="p">,</span> <span class="mi">371</span><span class="p">,</span>  <span class="mi">33</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">396</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span>
        <span class="mi">370</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span>  <span class="mi">49</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">247</span><span class="p">,</span>  <span class="mi">89</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span> <span class="mi">311</span><span class="p">,</span>
        <span class="mi">370</span><span class="p">,</span>   <span class="mi">7</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span>  <span class="mi">91</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span>  <span class="mi">64</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span>  <span class="mi">74</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span>
        <span class="mi">342</span><span class="p">,</span>  <span class="mi">45</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">446</span><span class="p">,</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">293</span><span class="p">,</span> <span class="mi">372</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">311</span><span class="p">,</span> <span class="mi">311</span><span class="p">,</span>
        <span class="mi">476</span><span class="p">,</span> <span class="mi">421</span><span class="p">,</span> <span class="mi">417</span><span class="p">,</span>  <span class="mi">33</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span>  <span class="mi">42</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">278</span><span class="p">,</span>  <span class="mi">49</span><span class="p">,</span> <span class="mi">281</span><span class="p">,</span> <span class="mi">298</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span>
        <span class="mi">311</span><span class="p">,</span> <span class="mi">311</span><span class="p">,</span> <span class="mi">508</span><span class="p">,</span> <span class="mi">388</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span>  <span class="mi">49</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">307</span><span class="p">]))</span></code></pre></figure>

<p>Note the output is a tuple with two <code class="highlighter-rouge">numpy.array</code>: the first one indicates the
distances the each point closest seed (their nearest-neighbors), and the second
one indicates the index of the corresponding seed.</p>

<p>We may use this idea to represent the Voronoi diagram without a geometric
description in terms of vertices, segments and rays.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mf">0.45</span><span class="p">,</span>  <span class="mf">0.50</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.35</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">canvas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">canvas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">queries</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">points</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">voronoi_plot_2d</span><span class="p">(</span><span class="n">vor</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span> <span class="mf">0.45</span><span class="p">,</span>  <span class="mf">0.50</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.35</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vor</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">vor</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="s">'ro'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span> <span class="mf">0.45</span><span class="p">,</span>  <span class="mf">0.50</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.35</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<h4 id="range-searching">Range Searching</h4>

<p>A <em>range searching problem</em> tries to determine which objects of an input set
intersect with a query object (that we call the <em>range</em>).</p>

<p>For example, given a set of points in the plane, which ones are contained inside
a circle of radius <code class="highlighter-rouge">r</code> centered at a target location <code class="highlighter-rouge">Q</code>. We can solve this
sample problem easily with the attribute <code class="highlighter-rouge">query_ball_point</code> from a suitable
implementation of a k-d tree.  We can go even further: if the range is an object
formed by the intersection of a sequence of different balls, the same attribute
gets the job done, as the following code illustrates.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">range_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">range_radii</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">point</span>  <span class="o">=</span> <span class="n">range_points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">radius</span> <span class="o">=</span> <span class="n">range_radii</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">partial_query</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">partial_query</span><span class="p">))</span>
<span class="o">...</span>     

<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">result</span>
<span class="nb">set</span><span class="p">([</span><span class="mi">192</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">295</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">186</span><span class="p">])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">'ko'</span><span class="p">)</span>
<span class="o">...</span>     

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">point</span> <span class="o">=</span> <span class="n">range_points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">radius</span> <span class="o">=</span> <span class="n">range_radii</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="o">...</span>     

<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

<div class="thumbnail">
    <img src="/images/chapter6_files/chapter6_158_1.png"/>
</div>

<p>This gives the following diagram, where the small dots represent the locations
of the search space, and the circles are the range.  The query is, of course,
the points located inside of the circles, that our algorithm computed.</p>

<p>Problems in this setting vary from trivial to extremely complicated, depending
on the input object types, range types, and query types.  An excellent
exposition of this subject is the survey paper <em>Geometric Range Searching and
its Relatives</em>, published by Pankaj K. Agarwal and Jeff Erickson in 1999, by the
American Mathematical Society Press, as part of the <em>Advances in Discrete and
Computational Geometry: proceedings of the 1996 AMS-IMS-SIAM joint summer
research conference, Discrete and Computational Geometry</em>.</p>

<h3 id="dynamic-problems">Dynamic Problems</h3>

<p>A dynamic problem is regarded as any of the problems in the previous two
settings (static or query), but with the added challenge that objects are
constantly being inserted or deleted.  Besides solving the base problem, we need
to take extra measures to assure that the implementation is efficient with
respect to these changes.</p>

<p>To this effect, the implementations wrapped from the <code class="highlighter-rouge">Qhull</code> libraries in the
module <code class="highlighter-rouge">scipy.spatial</code> are equiped to deal with insertion of new points.   We
accomplish this by stating the option <code class="highlighter-rouge">incremental=True</code>, which basically
suppresses the <code class="highlighter-rouge">qhull</code> control <code class="highlighter-rouge">'Qz'</code>, and prepares the output structure for
these complex situations.</p>

<p>Let us illustrate with a simple example.  We start with the first ten vertices
of Lake Superior, and inserting ten vertices at a time, update the corresponding
triangulation and Voronoi diagrams.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">small_superior</span> <span class="o">=</span> <span class="n">lake_superior</span><span class="p">[</span><span class="s">'vertices'</span><span class="p">][:</span><span class="mi">9</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">small_superior</span><span class="p">,</span> <span class="n">incremental</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vor</span> <span class="o">=</span> <span class="n">Voronoi</span><span class="p">(</span><span class="n">small_superior</span><span class="p">,</span> <span class="n">incremental</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">tri</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">[</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="o">...</span>     <span class="n">vor</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">vertices_ls</span><span class="p">[</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="o">...</span>     <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span> <span class="mf">0.00</span><span class="p">,</span>  <span class="mf">1.00</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.70</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.30</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">delaunay_plot_2d</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.70</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.30</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">voronoi_plot_2d</span><span class="p">(</span><span class="n">vor</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
<span class="o">...</span>     

<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>



<h2 id="numerical-computational-geometry">Numerical Computational Geometry</h2>

<p>This field arose simultaneously among different groups of researchers seeking
solutions to a priori non-related problems.  As it turns out, all the solutions
they posed did actually have an important common denominator: they were obtained
upon representing objects by means of parametric curves, parametric surfaces, or
regions bounded by those.   These scientists ended up unifying their techniques
over the years, to finally define the field of Numerical Computational Geometry.
In this journey, the field received different names: <em>Machine Geometry</em>,
<em>Geometric Modeling</em>, and the most widespread <em>Computer Aided Geometric Design</em>
(<em>CAGD</em>).</p>

<p>It is used in computer vision, for example, for 3D reconstruction and movement
outline.   It is widely employed for the design and qualitative analysis of  the
bodies of automobiles, aircraft, or watercraft.  There are many computer aided
design software packages (<em>CAD</em>) that facilitate interactive manipulation and
solution of many of the problems in this area.  In this regard, any interaction
with <code class="highlighter-rouge">python</code> gets relegated to being part of the underlying computational
engine behind the visualization or animation—which are none of the strengths of
<code class="highlighter-rouge">scipy</code>.  For this reason, we will not cover visualization or animation
applications in this book, and focus on the basic mathematics instead.</p>

<p>In that regard, the foundation of Numerical Computational Geometry is based on
three key concepts: Bézier surfaces, Coons patches, and B-spline methods.   In
turn, the theory of Bézier curves plays a central role in the development of
these concepts.  They are the geometric standard for the representation of
piecewise polynomial curves.  In this section we focus solely on the basic
development of the theory of plane Bézier curves.</p>

<blockquote>
  <p>The rest of the material is also beyond the scope of <code class="highlighter-rouge">scipy</code>, and we therefore
leave its exposition to more technical books.  The best source in that sense is,
without a doubt, the book <em>Curves and Surfaces for Computer Aided Geometric
Design—A Practical Guide</em> (5th ed.), by Gerald Farin, published by Academic
Press under the Morgan Kauffman Series in Computer Graphics and Geometric
Modeling.</p>
</blockquote>

<h3 id="bzier-curves">Bézier Curves</h3>

<p>It all starts with the <em>de Casteljau Algorithm</em> to construct parametric
equations of an arc of a polynomial of order 3.  In the submodule
<code class="highlighter-rouge">matplotlib.path</code>  we have an implementation of this algorithm using the class
<code class="highlighter-rouge">Path</code>, which we can use to generate our own user-defined routines to generate
and plot plane Bézier curves.</p>

<blockquote>
  <p>For information about the class <code class="highlighter-rouge">Path</code> and its usage within the <code class="highlighter-rouge">matplotlib</code>
libraries, refer to the official documentation at <a href="http://matplotlib.org/api/path_api.html#matplotlib.path.Path">matplotlib.org/api/path_api.h
tml#matplotlib.path.Path</a>
, as well as the very instructive tutorial at <a href="http://matplotlib.org/users/path_tutorial.html">matplotlib.org/users/path_tutoria
l.html</a>.  In this section, we focus
solely on the necessary material to deal with Bézier curves.</p>
</blockquote>

<p>Before we proceed, we need some basic code to represent and visualize Bézier
curves:</p>

<ul>
  <li>
    <p>The de Casteljau algorithm for arcs of polynomials of order 2 is performed by
creating a <code class="highlighter-rouge">Path</code> with the three control points as vertices, and the list
<code class="highlighter-rouge">[Path.MOVETO, Path.CURVE3, Path.CURVE3]</code> as code.  This ensures that the
resulting curve starts at <code class="highlighter-rouge">P1</code> in the direction given by the segment <code class="highlighter-rouge">P1P2</code>, and
ends at <code class="highlighter-rouge">P3</code> with direction given by the segment <code class="highlighter-rouge">P2P3</code>.  If the three points
are collinear, we obtain a segment containing them all.  Otherwise, we obtain an
arc of parabola.</p>
  </li>
  <li>
    <p>The de Casteljau algorithm for arcs of polynomials of order 3 is performed in
a similar way to the previous case.  We have four control points, and we create
a <code class="highlighter-rouge">Path</code> with those as vertices.  The code is the list <code class="highlighter-rouge">[Path.MOVETO,
Path.CURVE4, Path.CURVE4, Path.CURVE4]</code>, which ensures that the arc starts at
<code class="highlighter-rouge">P1</code> with direction given by the segment <code class="highlighter-rouge">P1P2</code>.  It also ensures that the arc
ends at <code class="highlighter-rouge">P4</code> in the direction of the segment <code class="highlighter-rouge">P3P4</code>.</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="kn">as</span> <span class="nn">patches</span>

<span class="k">def</span> <span class="nf">bezier_parabola</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">Path</span><span class="p">([</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">],</span>
               <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">bezier_cubic</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Path</span><span class="p">([</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">],</span>
                <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">plot_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s">'equal'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Ys</span><span class="p">)</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">Ys</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">,</span> <span class="s">'o--'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> 
                <span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

<p>Let us test it with a few basic examples:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">P1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">path_1</span> <span class="o">=</span> <span class="n">bezier_parabola</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plot_path</span><span class="p">(</span><span class="n">path_1</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">'P1'</span><span class="p">,</span> <span class="s">'P2'</span><span class="p">,</span> <span class="s">'P3'</span><span class="p">])</span></code></pre></figure>



<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">P4</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">P5</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">path_2</span> <span class="o">=</span> <span class="n">bezier_cubic</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plot_path</span><span class="p">(</span><span class="n">path_2</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">'P1'</span><span class="p">,</span> <span class="s">'P2'</span><span class="p">,</span> <span class="s">'P4'</span><span class="p">,</span> <span class="s">'P5'</span><span class="p">])</span></code></pre></figure>



<p>Higher degree curves are computationally expensive to evaluate.  When complex
paths are needed, we rather create them as a piecewise sequence of low order
Bézier patched together—we call this object a <em>Bézier spline</em>.   Notice it is
not hard to guarantee continuity on these splines.  It is enough to make the end
of each path the starting point of the next one.  It is also easy to guarantee
smoothness (at least up to the first derivative), by making the last two control
points of one curve be aligned with the first two control points of the next
one.  Let us illustrate this with an example.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">Q1</span> <span class="o">=</span> <span class="n">P5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Q2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Q3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Q4</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">path_3</span> <span class="o">=</span> <span class="n">bezier_cubic</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">path_4</span> <span class="o">=</span> <span class="n">bezier_cubic</span><span class="p">(</span><span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span><span class="p">,</span> <span class="n">Q3</span><span class="p">,</span> <span class="n">Q4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plot_path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">make_compound_path</span><span class="p">(</span><span class="n">path_3</span><span class="p">,</span> <span class="n">path_4</span><span class="p">))</span></code></pre></figure>



<p>A clear advantage of representing curves as Bézier splines arises when we need
to apply an affine transformation to a curve.  For instance, if we required a
counter-clockwise rotated version of the last curve computed, instead of
performing the operation over all points of the curve, we simply apply the
transformation to the control points, and repeat the de Casteljau algorithm on
the new controls.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">rotation</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
<span class="o">...</span>             <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="o">...</span> 

<span class="o">&gt;&gt;&gt;</span> <span class="n">new_Ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">rotation</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">path_3</span><span class="o">.</span><span class="n">vertices</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">new_Qs</span> <span class="o">=</span> <span class="p">[</span><span class="n">rotation</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="n">path_4</span><span class="o">.</span><span class="n">vertices</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">path_5</span> <span class="o">=</span> <span class="n">bezier_cubic</span><span class="p">(</span><span class="o">*</span><span class="n">new_Ps</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">path_6</span> <span class="o">=</span> <span class="n">bezier_cubic</span><span class="p">(</span><span class="o">*</span><span class="n">new_Qs</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plot_path</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">make_compound_path</span><span class="p">(</span><span class="n">path_5</span><span class="p">,</span> <span class="n">path_6</span><span class="p">))</span></code></pre></figure>



<h2 id="summary">Summary</h2>

<p>we have developed a brief incursion in the field of Computational Geometry, and
we have mastered all the tools coded in the <code class="highlighter-rouge">scipy</code> stack to effectively address
the most common problems in this topic.</p>




	</article>

	
	</div></body></html>