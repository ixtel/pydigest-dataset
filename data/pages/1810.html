<html><body><div><div class="entry-content">

				
			

				
				

				<p>Python tuples have a surprising trait: they are immutable, but their values may change. This may happen when a <tt>tuple</tt> holds a reference to any mutable object, such as a <tt>list</tt>. If you need to explain this to a colleague who is new to Python, a good first step is to debunk the common notion that variables are like boxes where you store data.</p>
<p>In 1997 I took a summer course about Java at MIT. The professor, Lynn Andrea Stein — an award-winning computer science educator — made the point that the usual “variables as boxes” metaphor actually hinders the understanding of reference variables in OO languages. Python variables are like reference variables in Java, so it’s better to think of them as labels attached to objects.</p>
<p>Here is an example inspired by Lewis Carroll’s <em>Through the Looking-Glass, and What Alice Found There</em>.</p>
<p><img src="http://s.radar.oreilly.com/wp-files/2/2014/10/Tweedledum-Tweedledee_500x390.png" alt="Tweedledum-Tweedledee_500x390" class="aligncenter size-full wp-image-71326" srcset="http://radar.oreilly.com/wp-files/2/2014/10/Tweedledum-Tweedledee_500x390-300x234.png 300w, http://radar.oreilly.com/wp-files/2/2014/10/Tweedledum-Tweedledee_500x390.png 500w" sizes="(max-width: 500px) 100vw, 500px"/></p>
<p>Tweedledum and Tweedledee are twins. From the book: “Alice knew which was which in a moment, because one of them had ‘DUM’ embroidered on his collar, and the other ‘DEE’.”</p>
<p><span id="more-71323"/><img src="http://s.radar.oreilly.com/wp-files/2/2014/10/dum-dee.png" alt="dum-dee" class="aligncenter size-full wp-image-71327" srcset="http://radar.oreilly.com/wp-files/2/2014/10/dum-dee-300x119.png 300w, http://radar.oreilly.com/wp-files/2/2014/10/dum-dee.png 590w" sizes="(max-width: 590px) 100vw, 590px"/></p>
<p>We’ll represent them as tuples with the date of birth and a list of their skills:</p>
<p/>

		<div id="crayon-56d5a0b515b38068402820" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0b515b38068402820-1"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">dum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'1861-10-23'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'poetry'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'pretend-fight'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b38068402820-2"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">dee</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'1861-10-23'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'poetry'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'pretend-fight'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0b515b38068402820-3"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">dum</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">dee</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b38068402820-4"><span class="crayon-t">True</span></p><p class="crayon-line" id="crayon-56d5a0b515b38068402820-5"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">dum </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">dee</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b38068402820-6"><span class="crayon-t">False</span></p><p class="crayon-line" id="crayon-56d5a0b515b38068402820-7"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">id</span><span class="crayon-sy">(</span><span class="crayon-v">dum</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">id</span><span class="crayon-sy">(</span><span class="crayon-v">dee</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b38068402820-8"><span class="crayon-sy">(</span><span class="crayon-cn">4313018120</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4312991048</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>It’s clear that <tt>dum</tt> and <tt>dee</tt> refer to objects that are equal, but not to the same object. They have distinct identities.</p>
<p>Now, after the events witnessed by Alice, Tweedledum decided to become a rapper, adopting the stage name T-Doom. This is how we can express this in Python:</p>
<p/>

		<div id="crayon-56d5a0b515b49270686962" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0b515b49270686962-1"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">t_doom</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dum</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b49270686962-2"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">t_doom</span></p><p class="crayon-line" id="crayon-56d5a0b515b49270686962-3"><span class="crayon-sy">(</span><span class="crayon-s">'1861-10-23'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'poetry'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'pretend-fight'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b49270686962-4"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">t_doom</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">dum</span></p><p class="crayon-line" id="crayon-56d5a0b515b49270686962-5"><span class="crayon-t">True</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b49270686962-6"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">t_doom </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">dum</span></p><p class="crayon-line" id="crayon-56d5a0b515b49270686962-7"><span class="crayon-t">True</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>So, <tt>t_doom</tt> and <tt>dum</tt> are equal — but Alice might complain that it’s foolish to say that, because <tt>t_doom</tt> and <tt>dum</tt> refer to the same person: <tt>t_doom is dum</tt>.</p>
<p><img src="http://s.radar.oreilly.com/wp-files/2/2014/10/dum-t_doom-dee.png" alt="dum-t_doom-dee" class="aligncenter size-full wp-image-71329" srcset="http://radar.oreilly.com/wp-files/2/2014/10/dum-t_doom-dee-300x119.png 300w, http://radar.oreilly.com/wp-files/2/2014/10/dum-t_doom-dee.png 590w" sizes="(max-width: 590px) 100vw, 590px"/></p>
<p>The names <tt>t_doom</tt> and <tt>dum</tt> are aliases. I like that the official Python docs often refer to variables as “names”. Variables are names we give to objects. Alternate names are aliases. That helps freeing our mind from the idea that variables are like boxes. Anyone who thinks of variables as boxes can’t make sense of what comes next.</p>
<p>After much practice, T-Doom is now a skilled rapper. In code, this is what happened:</p>
<p/>

		<div id="crayon-56d5a0b515b52720450431" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0b515b52720450431-1"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">skills</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">t_doom</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b52720450431-2"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">skills</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">'rap'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0b515b52720450431-3"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">t_doom</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b52720450431-4"><span class="crayon-sy">(</span><span class="crayon-s">'1861-10-23'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'poetry'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'pretend-fight'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rap'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0b515b52720450431-5"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">dum</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b52720450431-6"><span class="crayon-sy">(</span><span class="crayon-s">'1861-10-23'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'poetry'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'pretend-fight'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rap'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>T-Doom acquired the <tt>'rap'</tt> skill, and so did Tweedledum — of course, they are one and the same. If <tt>t_doom</tt> was a box containing a <tt>str</tt> and a <tt>list</tt>, how could you explain that appending to the list in <tt>t_doom</tt> also changes the list in the <tt>dum</tt> box? However, it makes perfect sense if you see variables as labels.</p>
<p>The label analogy is much better because aliasing is explained simply as an object with two or more labels. In the example, <tt>t_doom[1]</tt> and <tt>skills</tt> are two names given to the same list object, just as <tt>dum</tt> and <tt>t_doom</tt> are two names given to the same tuple object.</p>
<p>Below is an alternative depiction of the objects that represent Tweedledum. This figure emphasizes that a tuple holds references to objects.</p>
<p><img src="http://s.radar.oreilly.com/wp-files/2/2014/10/dum-skills-references.png" alt="dum-skills-references" class="aligncenter size-full wp-image-71331" srcset="http://radar.oreilly.com/wp-files/2/2014/10/dum-skills-references-282x300.png 282w, http://radar.oreilly.com/wp-files/2/2014/10/dum-skills-references.png 301w" sizes="(max-width: 301px) 100vw, 301px"/></p>
<p>What is immutable is the physical content of a tuple, consisting of the object references only. The value of the list referenced by <tt>dum[1]</tt> changed, but the referenced object id is still the same. A tuple has no way of preventing changes to the values of its items, which are independent objects and may be reached through references outside of the tuple, like the <tt>skills</tt> name we used earlier. Lists and other mutable objects inside tuples may change, but their ids will always be the same.</p>
<p>This highlights the difference between the concepts of identity and value, described in <em>Python Language Reference</em> <a href="https://docs.python.org/3/reference/datamodel.html#objects-values-and-types">Data model</a> chapter:</p>
<blockquote><p>
Every object has an identity, a type and a value. An object’s identity never changes once it has been created; you may think of it as the object’s address in memory. The ‘is’ operator compares the identity of two objects; the id() function returns an integer representing its identity.</p></blockquote>
<p>After <tt>dum</tt> became a rapper, the twin brothers are no longer equal:</p>
<p/>

		

<p/>
<p>We have two tuples that were created equal, but now they are different.</p>
<p>The other built-in immutable collection type in Python, <tt>frozenset</tt>, does not suffer from the problem of being immutable yet potentially changing in value. That’s because a <tt>frozenset</tt> (or a plain <tt>set</tt>, for that matter) may only hold references to hashable objects, and the value of hashable objects may naver change, by definition.</p>
<p>Tuples are commonly used as <tt>dict</tt> keys, and those must be hashable — just as set elements. So, are tuples hashable or not? The right answer is: <strong>some</strong> tuples are hashable. The value of a tuple holding a mutable object may change, and such a tuple is not hashable. To be used as a <tt>dict</tt> key or set element, the tuple must be made only of hashable objects. Our tuples named <tt>dum</tt> and <tt>dee</tt> are unhashable because each contains a list reference, and lists are unhashable.</p>
<p>Now let’s focus on the assignment statements at the heart of this whole exercise.</p>
<p>Assignment in Python never copies values. It only copies references. So when I wrote <tt>skills = t_doom[1]</tt> I did not copy the list at <tt>t_doom[1]</tt>, I only copied a reference to it, which I then used to change the list by doing <tt>skills.append('rap')</tt>.</p>
<p>Back at MIT, Prof. Stein spoke about assignment in a very deliberate way. For example, when talking about a seesaw object in a simulation, she would say: “Variable <tt>s</tt> is assigned to the seesaw”, but never “The seesaw is assigned to variable <tt>s</tt>“. With reference variables it makes much more sense to say that the variable is assigned to an object, and not the other way around. After all, the object is created before the assignment.</p>
<p>In an assignment such as <tt>y = x * 10</tt>, the right-hand side is evaluated first. This creates a new object or retrieves an existing one. Only after the object is constructed or retrieved, the name is assigned to it.</p>
<p>Here is proof in code. First we create a <tt>Gizmo</tt> class, and an instance of it:</p>
<p/>

		<div id="crayon-56d5a0b515b66665992042" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0b515b66665992042-1"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Gizmo</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b66665992042-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">     </span><span class="crayon-e">def </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0b515b66665992042-3"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">         </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Gizmo id: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">id</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b66665992042-4"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5a0b515b66665992042-5"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Gizmo</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b66665992042-6"><span class="crayon-e">Gizmo </span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">4328764080</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>Note that the <tt>__init__</tt> method displays the id of the object just created. This will be important in the next demonstration.</p>
<p>Now let’s instantiate another <tt>Gizmo</tt> and immediately try to perform an operation with it before binding a name to the result:</p>
<p/>

		<div id="crayon-56d5a0b515b6e366486725" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0b515b6e366486725-1"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Gizmo</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b6e366486725-2"><span class="crayon-e">Gizmo </span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">4328764360</span></p><p class="crayon-line" id="crayon-56d5a0b515b6e366486725-3"><span class="crayon-e">Traceback</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">most </span><span class="crayon-e">recent </span><span class="crayon-e">call </span><span class="crayon-v">last</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b6e366486725-4"><span class="crayon-h">  </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5a0b515b6e366486725-5"><span class="crayon-v">TypeError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">unsupported </span><span class="crayon-e">operand </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'Gizmo'</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-s">'int'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0b515b6e366486725-6"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'y'</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">globals</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0b515b6e366486725-7"><span class="crayon-t">False</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>This snippet shows that the new object was instantiated (its id was <tt>4328764360</tt>) but before the <tt>y</tt> name could be created, a <tt>TypeError</tt> aborted the assignment. The <tt>'y' in globals()</tt> check proves there is no <tt>y</tt> global name.</p>
<p>To wrap up: always read the right-hand side of an assignment first. That’s where the object is created or retrieved. After that, the name on the left is bound to the object, like a label stuck to it. Just forget about the boxes.</p>
<p>As for tuples, make sure they only hold references to immutable objects before trying to use them as dictionary keys or put them in sets.</p>
<p><em>This post was based on chapter 8 of my <a href="http://shop.oreilly.com/product/0636920032519.do">Fluent Python</a> book. That chapter, titled <em>Object references, mutability, and recycling</em> also covers the semantics of function parameter passing, best practices for mutable parameter handling, shallow copies and deep copies, and the concept of weak references — among other topics. The book focuses on Python 3 but most of its content also applies to Python 2.7, like everything in this post.</em></p>
<p><em>Public domain <a href="http://commons.wikimedia.org/wiki/File:Tennieldumdee.jpg">illustration</a> from Lewis Carroll’s “Through the Looking-Glass, and What Alice Found There.”</em></p>


								
								
				
					

			</div>

				

			</div></body></html>