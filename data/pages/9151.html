<html><body><div><p>A cython implementation of an ffmpeg based player.</p>








<p>FFPyPlayer is a python binding for the FFmpeg library for playing and writing
media files.</p>
<div>
<p>Warning</p>
<p>Although the ffpyplayer source code is licensed under the LGPL, the ffpyplayer wheels
for Windows on PYPI are distributed under the GPL because the pre-compiled FFmpeg binaries
are GPLâ€™d. For LGPL builds you can compile FFmpeg yourself using LGPL options.</p>
</div>
<div id="usage-example">
<h2>Usage example</h2>
<p>Playing a file:</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ffpyplayer.player</span> <span class="kn">import</span> <span class="n">MediaPlayer</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">time</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">player</span> <span class="o">=</span> <span class="n">MediaPlayer</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">val</span> <span class="o">=</span> <span class="s1">''</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">while</span> <span class="n">val</span> <span class="o">!=</span> <span class="s1">'eof'</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">frame</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span>
<span class="o">...</span>     <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s1">'eof'</span> <span class="ow">and</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">img</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">frame</span>
<span class="o">...</span>         <span class="c1"># display img</span>
</pre>
<p>Writing a video file:</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ffpyplayer.writer</span> <span class="kn">import</span> <span class="n">MediaWriter</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ffpyplayer.pic</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># write at 5 fps.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">out_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'pix_fmt_in'</span><span class="p">:</span><span class="s1">'rgb24'</span><span class="p">,</span> <span class="s1">'width_in'</span><span class="p">:</span><span class="n">w</span><span class="p">,</span> <span class="s1">'height_in'</span><span class="p">:</span><span class="n">h</span><span class="p">,</span>
<span class="o">...</span>     <span class="s1">'codec'</span><span class="p">:</span><span class="s1">'rawvideo'</span><span class="p">,</span> <span class="s1">'frame_rate'</span><span class="p">:(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">MediaWriter</span><span class="p">(</span><span class="s1">'output.avi'</span><span class="p">,</span> <span class="p">[</span><span class="n">out_opts</span><span class="p">])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Construct image</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">size</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">plane_buffers</span><span class="o">=</span><span class="p">[</span><span class="n">buf</span><span class="p">],</span> <span class="n">pix_fmt</span><span class="o">=</span><span class="s1">'rgb24'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">writer</span><span class="o">.</span><span class="n">write_frame</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">i</span> <span class="o">/</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
<p>Converting images:</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ffpyplayer.pic</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">SWScale</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">100</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">size</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">plane_buffers</span><span class="o">=</span><span class="p">[</span><span class="n">buf</span><span class="p">],</span> <span class="n">pix_fmt</span><span class="o">=</span><span class="s1">'rgb24'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sws</span> <span class="o">=</span> <span class="n">SWScale</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">get_pixel_format</span><span class="p">(),</span> <span class="n">ofmt</span><span class="o">=</span><span class="s1">'yuv420p'</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">img2</span> <span class="o">=</span> <span class="n">sws</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img2</span><span class="o">.</span><span class="n">get_pixel_format</span><span class="p">()</span>
<span class="s1">'yuv420p'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">planes</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">to_bytearray</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">planes</span><span class="p">)</span>
<span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">12500</span><span class="p">,</span> <span class="mi">12500</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre>
</div>


</div></body></html>