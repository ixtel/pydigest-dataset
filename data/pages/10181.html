<html><body><div><div class="post-text" itemprop="text">

<p>I am attempting to write a script with <a href="https://pypi.python.org/pypi/sharepoint/0.3.2" rel="nofollow">SharePoint</a> package to access files on my company's SharePoint.  The tutorial states </p>

<blockquote>
  <p>First, you need to create a <code>SharePointSite</code> object. We’ll assume you’re using basic auth; if you’re not, you’ll need to create an appropriate <code>urllib2</code> Opener yourself.</p>
</blockquote>

<p>However, after several attempts, I've concluded that basic auth is not sufficient.  While researching how to try to make it work, I came upon <a href="http://allthatjs.com/2012/03/28/remote-authentication-in-sharepoint-online/" rel="nofollow">this article</a> which gives a good overview of the general scheme of authentication.  What I'm struggling with is implementing this in Python.  </p>

<p>I've managed to hijack the basic auth in the SharePoint module.  To do this, I took the XML message in the linked article and used it to replace the XML generated by the SharePoint module.  After making a few other changes, I now recieve a token as described in Step 2 of the linked article.</p>

<p>Now, in Step 3, I need to send that token to SharePoint with a POST.  The below is a sample of what it should look like:</p>

<pre><code>POST http://yourdomain.sharepoint.com/_forms/default.aspx?wa=wsignin1.0 HTTP/1.1
Host: yourdomain.sharepoint.com
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Content-Length: [calculate]

t=EwBgAk6hB....abbreviated
</code></pre>

<p>I currently use the following code to generate my POST.  With the guidance from a few other questions, I've omitted the <code>content-length</code> header since that should be automatically calculated.  I was unsure of where to put the token, so I just shoved it in <code>data</code>.</p>

<pre><code>headers = {
    'Host': 'mydomain.sharepoint.com',
    'Connection': 'keep-alive',
    'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)'
}

data = {'t':'{}'.format(token[2:])}
data = urlencode(data) 

postURL = "https://mydomain.sharepoint.com/_forms/default.aspx?wa=wsignin1.0"   
req = Request(postURL, data, headers) 
response = urlopen(req)
</code></pre>

<p>However, this produces the following error message:</p>

<pre><code>urllib2.HTTPError: HTTP Error 302: The HTTP server returned a redirect error that would lead to an infinite loop.
The last 30x error message was:
Found
</code></pre>

<p>How do I generate a POST which will correctly return the authentication cookies I need?</p>
    </div>
    </div></body></html>