<html><body><div><div class="post-text" itemprop="text">
<p>I have not used sockets in my own code, so the following is based on my general Python knowledge.</p>

<p>The socket docs do not say that a <code>socket.socket</code> instance is a context manager, but the class has the requisite <code>__enter__</code> and <code>__exit__</code> methods.  Both are standard, minimal, implementations.  It is possible you might want to subclass socket or SSLSocket to do something more in <code>__exit__</code>, such as printing your substitute for a traceback.  But to start, you need to see the full tracebacks.  Subclass <code>SSLSocket</code> inherits both methods.  Since an SSLSocket "wraps" a socket, there are apparently two objects to be concerned with.  So I would start with the following (untested, obviously) for the top level structure of your code:</p>

<pre><code>&lt;preliminary code&gt;
with socket.socket(...) as sock  # or other socket-returning function
  &lt;more preparation&gt;
  with ssl.wrap_socket(sock, ...) as SSLsock # or the context function
    &lt;use SSLsock to communicate&gt;
</code></pre>

<p>The error message you got should have been prefixed with <code>SSLEOFError</code>.  Was it?  The doc says "A subclass of SSLError raised when the SSL connection has been terminated abruptly. Generally, you shouldnâ€™t try to reuse the underlying transport when this error is encountered."  This is definitely an Exception.</p>

<pre><code>&gt;&gt;&gt; issubclass(ssl.SSLEOFError, Exception)
True
</code></pre>

<p>What might provoke Cloudfare into terminating the connection 'abruptly'?  A bug in its protocol handling; a bug in ssl.py?  Does your bot somehow violate Terms of Service?</p>

<p>If you can't get all answers you need here, I would try <code>python-list</code>, also accessible as newsgroup <code>gmane.comp.python.general</code> at <code>news.gmane.org</code>.  It has participants with network experience.</p>
    </div>
    </div></body></html>