<html><body><div><div class="post-content" itemprop="articleBody">
    <p><strong>EDIT:</strong> <em>I am sorry for derping out of control. When I initially published this post it was called “Programming Web Sockets in Python”, this is just flat out wrong. What we are making here is just a regular socket. <a href="http://en.wikipedia.org/wiki/WebSocket">Web Sockets</a> and regular sockets are similar but are certainly not the same thing. I hope you will still find this useful!</em></p>

<p>Sockets are pretty much the basis of how applications work on the Internet. Python makes it super easy to get started programming sockets. In this brief introduction we will create a simple server that greets the user when it receives incoming requests from the client application.</p>

<p>Due to my recent obsession with <a href="https://levlaz.org/tag/lxc/">Linux Containers</a> we will also be implementing this inside of two containers. Containers make it really simple to simulate a network because you can create additional hosts in seconds.</p>

<h1 id="creating-your-containers">Creating your Containers</h1>

<p>I am running Ubuntu 14.04. So creating two additional containers can be achieved by running the following as the root user.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>lxc-create -t download -n pyServer 
# Choose ubuntu, trusty, amd64 when prompted 
# Then clone the first container 
lxc-clone -o pyServer -n pyClient 
</code></pre>
</div>

<h1 id="running-the-server">Running the Server</h1>

<p>Now that we have created our containers lets jump into our server container and fire up our simple server application. We can start up the container by issuing the following command as root: <code class="highlighter-rouge">lxc-start -n pyServer -d</code>, this will start the container as a daemon. Let’s go ahead and get into by attaching the container. I like to do this inside of screen so that we can easily get in and out of the container. Create a screen session <code class="highlighter-rouge">screen -dRR pyServer</code> and once inside the screen attach the container <code class="highlighter-rouge">lxc-attach -n pyServer</code></p>

<p>Once we are inside the container we need to install python and launch our simple server.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get install python 
vim pyServer.py 
</code></pre>
</div>

<p>Inside of vim (or your favorite text editor) we need to enter the following simple python code.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>from socket import *

serverPort = 12000

serverSocket = socket(AF_INET, SOCK_DGRAM)

serverSocket.bind(('', serverPort))

print "The server is ready to rock and roll!"

while 1:
    name, clientAddress = serverSocket.recvfrom(2048)
    response = "Hello " + str(name) + "! You are really good at socket programming" 
    serverSocket.sendto(response, clientAddress)
</code></pre>
</div>

<p>The code should be pretty straightforward. We are creating a new serverSocket that is bound to port 12000. When it receives requests (which include a name) it responds with an encouraging message. Fire up this server by running <code class="highlighter-rouge">python pyServer.py</code> if all goes well you should see a message that states <em>This server is ready to rock and roll!</em> Exit the container (and the screen session) by pressing Ctrl+a and Ctrl+d</p>

<h1 id="running-the-client">Running the Client</h1>

<p>Now that we have our server up and running, lets get our client working as well. Before we move forward, lets grab the IP address of our server container because we will need it soon. You can get the IP by running <code class="highlighter-rouge">lxc-ls --fancy</code>. Launch the client container, attach it in screen, and install python in the same way that we did previously.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>lxc-start -n pyClient -d 
screen -dRR pyClient 
lxc-attach -n pyClient 
apt-get install python 
vim pyClient.py 
</code></pre>
</div>

<p>In vim, lets create the pyClient.py program by entering the following code.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>from socket import *

# Replace the IP address in serverName with the IP of your container that you      grabbed previously. 
serverName = '10.0.3.211'
serverPort = 12000
clientSocket = socket(AF_INET, SOCK_DGRAM)

name = raw_input('Please enter your name:')

clientSocket.sendto(name, (serverName, serverPort))
response, serverAddress = clientSocket.recvfrom(2048)
print response
clientSocket.close()
</code></pre>
</div>

<p>This code is also pretty straightforward. It asks the user for their name, sends it to the server, and prints the response.</p>

<p>You can try this out now! Save the file and execute your python program by running <code class="highlighter-rouge">python pyClient.py</code>. After entering your name and pressing enter you should see a response from your server with the encouraging message.</p>

<p>This was a pretty trivial exercise, but we can quickly see that we can expand upon this basic code to create much more interesting and complex applications. We can also leverage the power and simplicity of LXC to create a simulated large network for distributed applications.</p>


  </div>

</div></body></html>