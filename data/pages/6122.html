<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-ceryx---simple-but-powerful-reverse-proxy" class="anchor" href="#ceryx---simple-but-powerful-reverse-proxy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Ceryx - Simple, but powerful Reverse Proxy</h1>

<p>Ceryx is a dynamic reverse proxy based on NGINX OpenResty with an API.</p>

<p>Ceryx is used to provide public URLs to tens of thousands of projects at <a href="https://www.sourcelair.com">https://www.sourcelair.com</a>.</p>

<h2><a id="user-content-proxy" class="anchor" href="#proxy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Proxy</h2>

<p>Ceryx is using NGINX OpenResty under the hood, in order to route requests
based on the request host. The routing is made using the NGINX Lua module,
which is querying a Redis backend for results.</p>

<h2><a id="user-content-api" class="anchor" href="#api" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>API</h2>

<p>Ceryx comes with a simple Flask web service, which supports REST operations on
routes. You can dynamically create, update, and delete routes on the go using
a REST client.</p>

<h2><a id="user-content-configuration" class="anchor" href="#configuration" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Configuration</h2>

<p>Ceryx supports configuration using environment variables. The supported
configuration options are the following:</p>

<ul>
<li><code>CERYX_NAME</code>: sets the API service name - defaults to ceryx</li>
<li><code>CERYX_DEBUG</code>: enables debuging on the API service - defaults to true</li>
<li><code>CERYX_API_HOST</code>: sets the host that the API will bind to - defaults to 127.0.0.1</li>
<li><code>CERYX_API_PORT</code>: sets the port that the API will listen - defaults to 5555</li>
<li><code>CERYX_SERVER_NAME</code>: the URL of the API service - default to None</li>
<li><code>CERYX_SECRET_KEY</code>: the path of the secret key to use - defaults to None</li>
<li><code>CERYX_REDIS_HOST</code>: the redis host to connect to - defaults to 127.0.0.1</li>
<li><code>CERYX_REDIS_PORT</code>: the redis port to connect to - defaults to 6379</li>
<li><code>CERYX_REDIS_PREFIX</code>: the redis prefix to use in keys - defaults to ceryx</li>
</ul>

<h2><a id="user-content-quick-bootstrap" class="anchor" href="#quick-bootstrap" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Quick Bootstrap</h2>

<p>Ceryx loves Docker, so you can easilly bootstrap Ceryx using the following
command, given that you have already installed Docker and Docker Compose.</p>

<pre><code>docker-compose up
</code></pre>

<p>You can also easily create your own production Docker compose file, using the
services defined in base.yml file. An example Docker compose file could be the
following:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-c"># production.yml</span>
<span class="pl-s"><span class="pl-ent">proxy:</span></span>
  <span class="pl-s"><span class="pl-ent">extends:</span></span>
    <span class="pl-s"><span class="pl-ent">file:</span> <span class="pl-s">base.yml</span></span>
    <span class="pl-s"><span class="pl-ent">service:</span> <span class="pl-s">proxy</span></span>
  <span class="pl-s"><span class="pl-ent">ports:</span></span>
   <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>80:80<span class="pl-pds">"</span></span></span>
  <span class="pl-s"><span class="pl-ent">environment:</span></span>
   <span class="pl-s">- <span class="pl-s">CERYX_REDIS_HOST=my.redis.host</span></span>
<span class="pl-s"><span class="pl-ent">api:</span></span>
  <span class="pl-s"><span class="pl-ent">extends:</span></span>
    <span class="pl-s"><span class="pl-ent">file:</span> <span class="pl-s">base.yml</span></span>
    <span class="pl-s"><span class="pl-ent">service:</span> <span class="pl-s">api</span></span>
  <span class="pl-s"><span class="pl-ent">ports:</span></span>
   <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>5555:5555<span class="pl-pds">"</span></span></span>
  <span class="pl-s"><span class="pl-ent">environment:</span></span>
   <span class="pl-s">- <span class="pl-s">CERYX_REDIS_HOST=my.redis.host</span></span>
   <span class="pl-s">- <span class="pl-s">CERYX_DEBUG=false</span></span>
   <span class="pl-s">- <span class="pl-s">CERYX_SECRET_KEY=/path/to/production/secret</span></span></pre></div>

<p>If you'd like to persist data, you can create the following file:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-c"># dev.yml</span>
<span class="pl-s"><span class="pl-ent">proxy:</span></span>
  <span class="pl-s"><span class="pl-ent">extends:</span></span>
    <span class="pl-s"><span class="pl-ent">file:</span> <span class="pl-s">base.yml</span></span>
    <span class="pl-s"><span class="pl-ent">service:</span> <span class="pl-s">proxy</span></span>
  <span class="pl-s"><span class="pl-ent">build:</span> <span class="pl-s">proxy</span></span>
  <span class="pl-s"><span class="pl-ent">ports:</span></span>
   <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>8888:80<span class="pl-pds">"</span></span></span>
   <span class="pl-s">- <span class="pl-s"><span class="pl-pds">"</span>5555:5555<span class="pl-pds">"</span></span></span>
  <span class="pl-s"><span class="pl-ent">volumes:</span></span>
   <span class="pl-s">- <span class="pl-s">proxy/nginx/conf:/opt/openresty/nginx/conf</span></span>
   <span class="pl-s">- <span class="pl-s">proxy/nginx/lualib:/opt/openresty/nginx/lualib</span></span>
   <span class="pl-s">- <span class="pl-s">proxy/nginx/sites-enabled:/opt/openresty/nginx/sites-enabled</span></span>
   <span class="pl-s">- <span class="pl-s">proxy/nginx/sites-available:/opt/openresty/nginx/sites-available</span></span>
<span class="pl-s"><span class="pl-ent">api:</span></span>
  <span class="pl-s"><span class="pl-ent">extends:</span></span>
    <span class="pl-s"><span class="pl-ent">file:</span> <span class="pl-s">base.yml</span></span>
    <span class="pl-s"><span class="pl-ent">service:</span> <span class="pl-s">api</span></span>
  <span class="pl-s"><span class="pl-ent">build:</span> <span class="pl-s">api</span></span>
  <span class="pl-s"><span class="pl-ent">net:</span> <span class="pl-s">container:proxy</span></span>
  <span class="pl-s"><span class="pl-ent">volumes:</span></span>
   <span class="pl-s">- <span class="pl-s">api/ceryx:/ceryx/ceryx</span></span>
   <span class="pl-s">- <span class="pl-s">api/bin:/ceryx/bin</span></span>
<span class="pl-s"><span class="pl-ent">redis:</span></span>
  <span class="pl-s"><span class="pl-ent">image:</span> <span class="pl-s">redis</span></span>
  <span class="pl-s"><span class="pl-ent">net:</span> <span class="pl-s">container:proxy</span></span>
  <span class="pl-s"><span class="pl-ent">volumes:</span></span>
   <span class="pl-s">- <span class="pl-s">data:/data</span></span>
  <span class="pl-s"><span class="pl-ent">command:</span> <span class="pl-s">redis-server --appendonly yes</span></span></pre></div>

<p>The above Redis container will store data in the data directory of your
project.</p>

<h2><a id="user-content-development" class="anchor" href="#development" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Development</h2>

<p>Ceryx was developed as a private project for SourceLair PC. Initial development
had different stages, having tproxy, Twisted and plain NGINX as a proxy server
and backends ranging from MongoDB to etcd.</p>

<p>After a lot of experimentation, we have ended up in this solution and we'll
keep developing this as an Open Source project. Feel free to make suggestions
in the <a href="https://github.com/sourcelair/ceryx/issues">issues section</a> in Github
or open o pull request.</p>

<h2><a id="user-content-license" class="anchor" href="#license" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>License</h2>

<p>Ceryx is licensed under the "The MIT License (MIT)".</p>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2015 SourceLair PC</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</article>
  </div></body></html>