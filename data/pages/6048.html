<html><body><div><div id="installation">
<h2>Installation</h2>
<p>Using <a href="https://pypi.python.org/pypi/pip" rel="nofollow">pip</a>: run <tt>pip install hererocks</tt>, using <tt>sudo</tt> if necessary.</p>
<p>Manually: download hererocks with <tt>wget <span class="pre">https://raw.githubusercontent.com/mpeterv/hererocks/0.5.0/hererocks.py</span></tt>, then use <tt>python hererocks.py ...</tt> to run it.</p>
</div>
<div id="usage">
<h2>Usage</h2>
<div id="installation-location">
<h3>Installation location</h3>
<p>The first argument of <tt>hererocks</tt> command should be path to the directory where Lua and/or LuaRocks should be installed. If it does not exist, it will be created.</p>
<p>If installation directory already has Lua installed, a new version of Lua or LuaRocks can be installed over it as a seamless upgrade (packages installed with LuaRocks will keep working) provided new and old Lua minor versions are same. E.g. Lua 5.1.5 and LuaJIT 2.1 can be installed over Lua 5.1.1, but not over Lua 5.2.1. Otherwise, when installing an incompatible Lua version, the installation directory should be removed prior to running <tt>hererocks</tt>. If <tt>hererocks</tt> detects that it has already installed requested version of Lua or LuaRocks into the directory, it will skip installation for that program, unless <tt><span class="pre">--ignore-installed/-i</span></tt> is used.</p>
<p>After installation Lua and LuaRocks binaries will be in the <tt>bin</tt> subdirectory of the installation directory. Scripts installed using LuaRocks will also turn up there. Lua binary is always named <tt>lua</tt>, even if itâ€™s LuaJIT under the hood, and LuaRocks binary is named <tt>luarocks</tt> as usual.</p>
</div>
<div id="version-selection">
<h3>Version selection</h3>
<p><tt><span class="pre">--lua/-l</span></tt>, <tt><span class="pre">--luajit/-j</span></tt> and <tt><span class="pre">--luarocks/-r</span></tt> options should be used to select versions of programs to install. There are three ways to specify how to fetch the sources:</p>
<ul>
<li>Using version number, such as <tt>5.1.5</tt>. If patch or minor versions are left out the latest possible version will be used, e.g. for Lua <tt>5.2</tt> is currently equivalent to <tt>5.2.4</tt>. <tt>^</tt> can be used to select the latest stable version. <tt>hererocks</tt> will fetch and unpack sources of the selected version from corresponding official downloads location.</li>
<li>Using git URI plus reference to checkout, separated by <tt>@</tt>. Default reference is <tt>master</tt>, and there are default git URIs for Lua (<a href="https://github.com/lua/lua" rel="nofollow">https://github.com/lua/lua</a>), LuaJIT (<a href="https://github.com/luajit/luajit" rel="nofollow">https://github.com/luajit/luajit</a>) and LuaRocks (<a href="https://github.com/keplerproject/luarocks" rel="nofollow">https://github.com/keplerproject/luarocks</a>). For instance, <tt><span class="pre">--luajit</span> @458a40b</tt> installs from a commit at the LuaJIT git repository and <tt><span class="pre">--luajit</span> @</tt> installs from its master branch. <tt>hererocks</tt> will use <tt>git</tt> command for cloning.</li>
<li>Using path to a local directory.</li>
</ul>
</div>
<div id="compatibility-flags">
<h3>Compatibility flags</h3>
<p>Lua and LuaJIT have some flags that add compatibility with other Lua versions. Lua 5.1 has several options for compatibility with Lua 5.0 (on by default), Lua 5.2 has 5.1 compatibility flag (on by default), Lua 5.3 - both 5.1 and 5.2 compatibility flags (only 5.2 compatibility is on by default), and LuaJIT has 5.2 flag (off by default). <tt>hererocks</tt> can change these flags before building when using <tt><span class="pre">--compat</span></tt> option. Possible arguments are <tt>default</tt>, <tt>none</tt>, <tt>all</tt>, <tt>5.1</tt> and <tt>5.2</tt>.</p>
</div>
<div id="installing-standard-puc-rio-lua">
<h3>Installing standard PUC-Rio Lua</h3>
<p>Available versions: 5.1 - 5.1.5, 5.2.0 - 5.2.4, 5.3.0 - 5.3.2.</p>
<p>Use <tt>5.1.0</tt> to install Lua <tt>5.1</tt> which was released without patch version for some reason.</p>
<p>When building Lua, <tt>hererocks</tt> tries to use sensible <tt>make</tt> target. The default can be seen in the help message printed by <tt>hererocks <span class="pre">--help</span></tt>. To select another target, use <tt><span class="pre">--target</span></tt> option.</p>
</div>
<div id="installing-luajit">
<h3>Installing LuaJIT</h3>
<p>Available versions: 2.0.0 - 2.0.4, 2.1 (installs from <tt>v2.1</tt> branch of the LuaJIT git repository).</p>
</div>
<div id="installing-luarocks">
<h3>Installing LuaRocks</h3>
<p>Available versions: 2.0.8 - 2.0.12, 2.1.0 - 2.1.2, 2.2.0 - 2.2.2, 2.3.0, 3 (installs from <tt><span class="pre">luarocks-3</span></tt> branch of the LuaRocks git repository).</p>
<p>Version 2.0.8 does not suppoer Lua 5.2. Versions 2.1.0 - 2.1.2 do not support Lua 5.3.</p>
</div>
</div>
<div id="using-hererocks-to-set-up-automated-testing">
<h2>Using hererocks to set up automated testing</h2>
<p>Popular continuous integration services such as <a href="https://travis-ci.org/" rel="nofollow">Travis-CI</a> and <a href="https://drone.io/" rel="nofollow">Drone.io</a> do not support Lua out of the box. That can be solved using hererocks in just a couple of lines. Here is an example of Travis-CI configuration file (<tt>.travis.yml</tt>) using hererocks to install a rock and run <a href="http://olivinelabs.com/busted/" rel="nofollow">Busted</a> test suite under Lua 5.1, 5.2, 5.3, LuaJIT 2.0 and 2.1:</p>
<pre><span class="l-Scalar-Plain">language</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">python</span> <span class="c1"># Need python environment for pip</span>
<span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span> <span class="c1"># Use container-based infrastructure</span>

<span class="l-Scalar-Plain">env</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LUA="lua 5.1"</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LUA="lua 5.2"</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LUA="lua 5.3"</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LUA="luajit 2.0"</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LUA="luajit 2.1"</span>

<span class="l-Scalar-Plain">before_install</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">pip install hererocks</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hererocks here -r^ --$LUA</span> <span class="c1"># Install latest LuaRocks version</span>
                              <span class="c1"># plus the Lua version for this build job</span>
                              <span class="c1"># into 'here' subdirectory</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export PATH=$PATH:$PWD/here/bin</span> <span class="c1"># Add directory with all installed binaries to PATH</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">luarocks install busted</span>

<span class="l-Scalar-Plain">install</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">luarocks make</span> <span class="c1"># Install the rock, assuming there is a rockspec</span>
                  <span class="c1"># in the root of the repository</span>

<span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">busted spec</span> <span class="c1"># Run the test suite, assuming tests are in the 'spec' subdirectory</span>
</pre>
</div>


</div></body></html>