<html><body><div><div class="entry-content">
        
      <h1 class="post-title entry-title">Python for Android Tutorial #7 - PyJNIus - Using Android native classes</h1>
      <h3 id="welcome">Welcome!!</h3>

<p>This is the seventh post about mobile development with Python.</p>

<p>In this  post, I’ll show you how to work with PyJNIus, a Python module to access Java classes as Python classes using JNI.</p>

<p>To show how it works, we’ll create a simple share button to open an intent and share a link with an external application :)</p>

<figure class="center ">
  <a href="/images/python-mobile.png"><img src="/images/python-mobile.png" alt=""/></a>
</figure>




<p><ins class="adsbygoogle" data-ad-client="ca-pub-7559770887681599" data-ad-slot="6312284669" data-ad-format="auto"/>
</p>

<h2 id="i---about-the-tutorials">I - About the Tutorials</h2>

<p>I’ll show you how to use each mobile API, like compass, camera, sensors, sound, and others. After the API, we will start to test some Python libs, as PyGame and OpenCV.
I’m using Android with buildozer, but major part are compatible with iOS as well.</p>

<p>Must read:</p>



<h3 id="source-code">Source code</h3>



<h2 id="ii---index">II - Index</h2>

<p>Available tutorials:</p>



<h2 id="iii---about-this-tutorial">III - About this tutorial</h2>

<p>This is a short post, just to show you how to start an Android Intent with Kivy.</p>

<p>In this post I’ll be using <a href="https://github.com/kivy/pyjnius">Pyjnius</a>, a Python module to access Java classes as Python classes using JNI.</p>

<p>This post is explaining more about the game created at <a href="/2015/01/24/python-for-android-tutorial-5-our-first-mobile-game-with-kivy/">Tutorial #5 – Android and iOS game with Python</a></p>

<h2 id="iv---creating-our-project">IV - Creating our project</h2>

<p>Let’s start to work on it.</p>

<p>Create a new folder, and create two files, <strong>main.py</strong>, for the source code, and <strong>main.kv</strong>, the UI. Now, start a new buildozer project with the command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">buildozer init</code></pre></figure>

<p>As we are using an external library, Pyjnius, you need to add it to your buildozer.spec file. Open your <strong>buildozer.spec</strong> and add pyjnius to the following line:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">requirements <span class="o">=</span> kivy, pyjnius</code></pre></figure>

<p>Now to make sure that you are able to run this project, run the following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  
buildozer --verbose android debug deploy run</code></pre></figure>

<p>This command will prepare your environment, check requirements and run the app on Android. If you get some error, please comment here so I can try to help you.</p>

<p>Now, let’s create a simple UI to test the Android Intent.</p>

<h2 id="v---a-simple-ui-with-kv-lang">V - A simple UI with KV Lang</h2>

<p>In this post we’ll have just a simple <a href="http://kivy.org/docs/api-kivy.uix.boxlayout.html?highlight=boxlayout#kivy.uix.boxlayout">BoxLayout</a> with a <a href="http://kivy.org/docs/api-kivy.uix.button.html?highlight=button#kivy.uix.button">Button</a>, nothing beautiful ;/</p>

<p>Just add the following code to your <strong>main.kv</strong>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&lt;</span><span class="n">RootWidget</span><span class="o">&gt;</span><span class="p">:</span>
  <span class="n">Button</span><span class="p">:</span>
    <span class="n">text</span><span class="p">:</span> <span class="s">'Share simple text'</span>
    <span class="n">on_press</span><span class="p">:</span> <span class="n">root</span><span class="o">.</span><span class="n">share</span><span class="p">()</span></code></pre></figure>

<p>With this code, the parent widget will be a <strong>RootWidget</strong>, a Python class that we’ll create later.</p>

<p>The RootWidget has a simple Button, with a text and on_press event.</p>

<p>When the user clicks on the button, it will can the method share() on RootWidget class.</p>

<h2 id="vi---python-code">VI - Python Code</h2>

<p>Let’s add just the necessary to run our app. Use the following code in main.py:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">__version__</span> <span class="o">=</span> <span class="s">'1.0'</span>

<span class="kn">from</span> <span class="nn">kivy.app</span> <span class="kn">import</span> <span class="n">App</span>
<span class="kn">from</span> <span class="nn">kivy.uix.boxlayout</span> <span class="kn">import</span> <span class="n">BoxLayout</span>

<span class="k">class</span> <span class="nc">RootWidget</span><span class="p">(</span><span class="n">BoxLayout</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">share</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">quot</span><span class="p">;</span><span class="n">sharing</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">quot</span><span class="p">;)</span>

<span class="k">class</span> <span class="nc">MainApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">RootWidget</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">on_pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
  <span class="n">MainApp</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></code></pre></figure>

<p>It’s simple! We just added a RootWidget that expends a BoxLayout, and created the method <strong>share().</strong></p>

<h2 id="vii---working-with-pyjnius">VII - Working with PyJNIus</h2>

<p>Now, let’s learn more about PyJNIus and use it.</p>

<p>PyJNI can wrap Java classes to use it with Python! Take a look in this simple example provided by <a href="http://pyjnius.readthedocs.org/en/latest/quickstart.html">PyJNIus documentation</a>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">System</span> <span class="o">=</span> <span class="n">autoclass</span><span class="p">(</span><span class="s">'java.lang.System'</span><span class="p">)</span>
<span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">'Hello World'</span><span class="p">)</span></code></pre></figure>

<p>With these commands you will be able to call Java System.out.println!</p>

<h2 id="viii---starting-an-android-intent-with-kivy-and-pyjnius">VIII - Starting an Android Intent with Kivy and PyJNIus</h2>

<p>Now, let’s integrate PyJNIus with our Android Kivy application.</p>

<p>You can read the Android documentation here: <a href="http://developer.android.com/training/sharing/send.html">http://developer.android.com/training/sharing/send.html</a></p>

<p>Add these lines to the top of your file:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">kivy.utils</span> <span class="kn">import</span> <span class="n">platform</span>

<span class="k">if</span> <span class="n">platform</span><span class="p">()</span> <span class="o">==</span> <span class="s">"android"</span><span class="p">:</span>
  <span class="kn">from</span> <span class="nn">jnius</span> <span class="kn">import</span> <span class="n">cast</span>
  <span class="kn">from</span> <span class="nn">jnius</span> <span class="kn">import</span> <span class="n">autoclass</span></code></pre></figure>

<p>As long as we can share only with Android, first we need to check the running platform and then import the required libraries.</p>

<p>Now, just update the share():</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">share</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">platform</span><span class="p">()</span> <span class="o">==</span> <span class="s">'android'</span><span class="p">:</span> <span class="c">#check if the app is on Android</span>
        <span class="c"># read more here: http://developer.android.com/training/sharing/send.html</span>

        <span class="n">PythonActivity</span> <span class="o">=</span> <span class="n">autoclass</span><span class="p">(</span><span class="s">'org.renpy.android.PythonActivity'</span><span class="p">)</span> <span class="c">#request the Kivy activity instance</span>
        <span class="n">Intent</span> <span class="o">=</span> <span class="n">autoclass</span><span class="p">(</span><span class="s">'android.content.Intent'</span><span class="p">)</span> <span class="c"># get the Android Intend class</span>

        <span class="n">String</span> <span class="o">=</span> <span class="n">autoclass</span><span class="p">(</span><span class="s">'java.lang.String'</span><span class="p">)</span> <span class="c"># get the Java object</span>

        <span class="n">intent</span> <span class="o">=</span> <span class="n">Intent</span><span class="p">()</span> <span class="c"># create a new Android Intent</span>
        <span class="n">intent</span><span class="o">.</span><span class="n">setAction</span><span class="p">(</span><span class="n">Intent</span><span class="o">.</span><span class="n">ACTION_SEND</span><span class="p">)</span> <span class="c">#set the action</span>

        <span class="c"># to send a message, it need to be a Java char array. So we use the cast to convert and Java String to a Java Char array</span>
        <span class="n">intent</span><span class="o">.</span><span class="n">putExtra</span><span class="p">(</span><span class="n">Intent</span><span class="o">.</span><span class="n">EXTRA_SUBJECT</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="s">'java.lang.CharSequence'</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="s">'Byte::Debugger() Tutorial #7'</span><span class="p">)))</span>
        <span class="n">intent</span><span class="o">.</span><span class="n">putExtra</span><span class="p">(</span><span class="n">Intent</span><span class="o">.</span><span class="n">EXTRA_TEXT</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="s">'java.lang.CharSequence'</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="s">"Testing Byte::Debugger() Tutorial #7, with Python for Android"</span><span class="p">)))</span>

        <span class="n">intent</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s">'text/plain'</span><span class="p">)</span> <span class="c">#text message</span>

        <span class="n">currentActivity</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s">'android.app.Activity'</span><span class="p">,</span> <span class="n">PythonActivity</span><span class="o">.</span><span class="n">mActivity</span><span class="p">)</span>
        <span class="n">currentActivity</span><span class="o">.</span><span class="n">startActivity</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span> <span class="c"># show the intent in the game activity</span></code></pre></figure>

<figure class="center ">
  <a href="/images/p4a7.png"><img src="/images/p4a7.png" alt=""/></a>
  <figcaption>Android Intent with Python</figcaption>
</figure>

<p>And here we can the the Android Intent working:</p>

<p>That’s it. I’ll be writing more tutorials soon.</p>

<p>Thanks for reading!</p>

<p>Aron Bordin</p>


<center>
  <ins class="adsbygoogle" data-ad-client="ca-pub-7559770887681599" data-ad-slot="1350374663">
  </ins>
</center>



      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags#Android" title="Pages tagged Android" class="tag"><span class="term">Android</span></a><a href="/tags#application" title="Pages tagged application" class="tag"><span class="term">application</span></a><a href="/tags#development" title="Pages tagged development" class="tag"><span class="term">development</span></a><a href="/tags#example" title="Pages tagged example" class="tag"><span class="term">example</span></a><a href="/tags#intent" title="Pages tagged intent" class="tag"><span class="term">intent</span></a><a href="/tags#kivy" title="Pages tagged kivy" class="tag"><span class="term">kivy</span></a><a href="/tags#python" title="Pages tagged python" class="tag"><span class="term">python</span></a><a href="/tags#python3" title="Pages tagged python3" class="tag"><span class="term">python3</span></a><a href="/tags#research" title="Pages tagged research" class="tag"><span class="term">research</span></a><a href="/tags#share" title="Pages tagged share" class="tag"><span class="term">share</span></a><a href="/tags#Tutorial" title="Pages tagged Tutorial" class="tag"><span class="term">Tutorial</span></a></span>
        
        <span class="author vcard"><span class="fn">Aron Bordin</span></span>
        

      </footer>
    </div>
    </div></body></html>