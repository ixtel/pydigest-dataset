<html><body><div><div class="pgr_content">
<p class="GAtag">
   </p>

<p>One, about Django template</p>
<p>Before the copious and fluent written a Django template, but “ hand ” careful not to delete.... Today to rewrite a, is equivalent to the summary. </p>
<p>---------------------------</p>
<p>Note: always know template template is a mechanism provided by Django, which has a template variable and template tags, that's it! It solves the problem of HTML hard coded in the view, the template is a plain text file, or a marked up using the Django template language of ordinary Python string. </p>
<p>Two, the template module</p>

<pre><span>1</span> &gt;&gt;&gt; <span>from</span> django <span>import</span> template <span>#</span><span>Import template</span></pre>

<p><strong>1,Create a template object</strong></p>
<p>The Template class in the django.template module, the constructor accepts a parameter. Such as: </p>

<pre><span>1</span> t = template.Template(<span>'</span><span>My name is {{ name }}.</span><span>'</span>)</pre>

<p>Create a Template object, the template system to compile this template into an internal format, and to do optimization, do preparation for rendering. </p>
<p>Note: if the template syntax errors, then call Template () will throw a TemplateSyntaxError exception</p>
<p><strong>2,Template rendering</strong></p>
<p>Rendering is by getting the value from the context to replace the template variables and perform all of the template tag. </p>
<p>Once you create a Template object, you can use <strong> context </strong> to transfer the data to it. A context is a set of variables and their values, like a dictionary Context class in the django.template module, parameter her constructor takes an optional: a dictionary mapping variables and their values. </p>
<p>Calls to the Template object's render () method and pass the context to fill in the template: </p>
<p><img src="http://www.programering.com/images/remote/ZnJvbT1jbmJsb2dzJnVybD13WnVCbkwxa3pNa1ZETmpOallsSm1OM01tWjRBRE5tUmpZd2tUTm1KbU41UURaNU1UTDBJek15QVRNM0V6TDFBek14QWpNdmdUTzVZek4wOHladnhtWXYwMmJqNXladnhtWTBsbWJqNXljbGRXWXRsMkx2b0RjMFJIYQ.jpg" alt=""/></p>
<p><strong>Note that the </strong>:t.render (c) returns a Unicode object, not the ordinary Python string. You can distinguish between the string before the U. In the framework, Django will always use the Unicode object instead of the ordinary string. </p>
<p><img src="http://www.programering.com/images/remote/ZnJvbT1jbmJsb2dzJnVybD13WnVCbkxpTkdPMklHTjRJalp4RW1aMmtUTjVNVFloUnpObEZUWnpNbU5oSnpOalpXTDVBVE55QVRNM0V6TDFBek14QWpNdmdUTzVZek4wOHladnhtWXYwMmJqNXladnhtWTBsbWJqNXljbGRXWXRsMkx2b0RjMFJIYQ.jpg" alt=""/></p>
<p>Of course, the same template, also can have more than one context (context)</p>
<p><strong>The 3 period search rule: </strong></p>
<p>1): Dictionary lookup (such as type foo["bar"] )</p>
<p>2): Attributes (such as foo.bar)</p>
<p>3): Method calls (such as foo.bar() )</p>
<p>4): The index type list lookup (such as foo[bar] )</p>
<p>Such as: </p>

<pre><span>1</span> <span>#</span><span>Used to access the list index</span>
<span>2</span> &gt;&gt;&gt; <span>from</span> django.template <span>import</span><span> Template, Context
</span><span>3</span> &gt;&gt;&gt; t = Template(<span>'</span><span>Item 2 is {{ items.2 }}.</span><span>'</span><span>)
</span><span>4</span> &gt;&gt;&gt; c = Context({<span>'</span><span>items</span><span>'</span>: [<span>'</span><span>apples</span><span>'</span>, <span>'</span><span>bananas</span><span>'</span>, <span>'</span><span>carrots</span><span>'</span><span>]})
</span><span>5</span> &gt;&gt;&gt;<span> t.render(c)
</span><span>6</span> u<span>'</span><span>Item 2 is carrots.</span><span>'</span></pre>

<p>Three, use in the view</p>
<p>See: </p>
<p>Study of Django (4): Django templating system (on)</p>
<p>Study of Django (5): Django templating system (below)</p>
<p> Four, RequestContext and Context processor</p>

<pre class="brush:python;gutter:true;">from django.template import Context,RequestContext
</pre>

<p> RequestContext by default in the context template to add some variables, such as information about the HttpRequest object or the currently logged in user. </p>
<p><strong><span>demo: </span></strong></p>

<pre class="brush:python;gutter:true;">URL: 
urlpatterns = patterns('',
    (r'^test1/$','demo.views.t1'), 
    (r'^test2/$','demo.views.t2'),        
)
</pre>

<p> The use of Context and RequestContext difference, pay attention to comment out the part is Context, here to view redundancy, so RequestContext</p>

<pre class="brush:python;gutter:true;">#coding=utf-8
from django.http import HttpRequest,HttpResponse,HttpResponseRedirect
from django.template import TemplateDoesNotExist,RequestContext,loader,Context,Template

def custom_pro(request):
    '''app,user,IP'''
    return{
       'app':'My app',
       'user':request.user,
       'ip':request.META['REMOTE_ADDR']
    }
    
def custom_other_pro(request):
    '''name,age,job'''
    return{
       'name':'BeginMan',
       'age':22,
       'job':'Pythoner'       
    }
    
def t1(request):
    t=loader.get_template('test/t1.html')
#    c=Context({'app':'My app',
#               'user':request.user,
#               'ip':request.META['REMOTE_ADDR'],
#               'message':'i am t1'})
    c=RequestContext(request,{'message':'i am t1'},processors=[custom_pro])
    return HttpResponse(t.render(c))

def t2(request):
    t=loader.get_template('test/t2.html')
#    c=Context({'app':'My app',
#               'user':request.user,
#               'ip':request.META['REMOTE_ADDR'],
#               'message':'i am t2'})
    c=RequestContext(request,{'message':'i am t2'},processors=(custom_pro,custom_other_pro))#Ganso form line
    return HttpResponse(t.render(c))
</pre>

<p> Of course. Can also be used for data processing: </p>

<pre class="brush:python;gutter:true;">def custom_Msg(request):
    '''return Msg data'''
    msg=Msg.objects.all()
    return{'msg':msg}
</pre>

<p><strong> Analysis: </strong></p>
<p>1):The definition of custom_pro, custom_other_pro<strong>, </strong>, custom_Msg these functions, is actually the context processor, it receives a HttpRequest object, and then returns a dictionary, the dictionary contains can be used in the template variables in context. It has done so much. </p>
<p>2):We are in the two view functions to use RequestContext instead of Context . There are two different points in the construction of context object.  One, the first parameter to RequestContext need to pass a HttpRequest object, is the first argument to the view function( request ). Two, RequestContext has an optional processors argument (processor means), this is a context handler function lists or tuples.  Here, we transfer the custom_pro processor function we defined earlier,custom_other_pro<strong>,</strong> custom_Msg</p>
<p>3):If you still don't understand, you can have a look the RequestContext source code: </p>

<pre class="brush:python;gutter:true;">Source code: 
class RequestContext(Context):
    """
    This subclass of template.Context automatically populates itself using
    the processors defined in TEMPLATE_CONTEXT_PROCESSORS.
    Additional processors can be specified as a list of callables
    using the "processors" keyword argument.
    """
    def __init__(self, request, dict=None, processors=None, current_app=None):
        Context.__init__(self, dict, current_app=current_app)
        if processors is None:
            processors = ()
        else:
            processors = tuple(processors)
        for processor in get_standard_processors() + processors:
            self.update(processor(request))
</pre>

<p> Then began a process template, here is a list of t2.html: </p>

<pre class="brush:html;gutter:true;">-------custom_pro&lt;br&gt;
&lt;div style="color:Red"&gt;
{{app}}&lt;br&gt;
{{user}}&lt;br&gt;
{{ip}}&lt;br&gt;
{{message}}&lt;br&gt;
&lt;/div&gt;

-------custom_other_pro&lt;br&gt;
&lt;div style="color:Blue"&gt;
{{name}}&lt;br&gt;
{{age}}&lt;br&gt;
{{job}}
&lt;/div&gt;

&lt;div style="color:#CCC"&gt;
{% for obj in msg %}
&lt;li&gt;{{obj.title}}&lt;/li&gt;
{% endfor %}
&lt;/div&gt;
</pre>

<p> Results are as follows: </p>
<p><img src="http://www.programering.com/images/remote/ZnJvbT1jbmJsb2dzJnVybD13WnVCbkwzSUdPNU1HWjJNell3VVRObVp6TmhWMk5rUlRObU56TmxGV05sQkRad2NUTDVJak4wUVRNM0V6TDFBek14QWpNdmdUTzVZek4wOHladnhtWXYwMmJqNXladnhtWTBsbWJqNXljbGRXWXRsMkx2b0RjMFJIYQ.jpg" alt=""/></p>
<p><strong>Extension: </strong></p>
<p>render_to_response() This shortcut, it can simplify the call loader.get_template (), but the above in order to show the difference between, between the two is not used, here we still have to use render_to_response (), this time to join the <strong>context_instance</strong> parameter to normal use: </p>

<pre class="brush:python;gutter:true;">def t2(request):
    return render_to_response(
        'test/t2.html',
        {'message':'t2'},
        context_instance=RequestContext(request,processors=(custom_pro,custom_other_pro,custom_Msg)))
#    t=loader.get_template('test/t2.html')
#    c=RequestContext(request,{'message':'i am t2'},processors=(custom_pro,custom_other_pro,custom_Msg))
#    return HttpResponse(t.render(c))
</pre>

<p> Five, the global context processor</p>
<p>Django provides global context processor support. TEMPLATE_CONTEXT_PROCESSORS specifies which context processors is always the default is used. Instead of using RequestContext are designated processors. </p>
<p>By default, TEMPLATE_CONTEXT_PROCESSORS is set as follows: </p>

<pre class="brush:python;gutter:true;">TEMPLATE_CONTEXT_PROCESSORS = (
    'django.core.context_processors.auth',
    'django.core.context_processors.debug',
    'django.core.context_processors.i18n',
    'django.core.context_processors.media',
)
</pre>

<p> Is enabled by default</p>
<p>This setting is a function of tuples, where each function used and above our custom_proc the same interface, which takes a request object as an argument, and returns a will be merged into context Dictionary: receiving a request object as parameters, and returns a contains will be merged the dictionary of the context. </p>
<p>See section below specific analysis</p>
<p class="GAtag">
   </p>

<p class="posted">Posted by <font>Laurent</font> at <font>August 30, 2014 - 9:54 AM</font></p>
</div>

</div></body></html>