<html><body><div><div id="available-and-bundled-plugins">
<h3>Available and bundled plugins</h3>
<p>From the box, swk supports: - running commands over ssh (<tt>ssh</tt> and
<tt>pssh</tt> commands), copying files over ssh to multiple hosts (<tt>dist</tt>
command, recursive and without preserving times by default), copying
files from multiple hosts over ssh (<tt>gather</tt>) - and just displaying
results of hostlist expansion (<tt>dr</tt> for ‘dry-run’)</p>
<p>By installing additional packages named <tt><span class="pre">swk-&lt;plugin_name&gt;</span></tt>, you also
get - expanding <strong>zabbix</strong> hostgroups (<tt>^</tt> modifier), <strong>casp</strong>
hostgroups (<tt>%</tt> modifier), special <tt>ALL</tt> hostgroup expanding to all
the hosts - getting and setting hosts environments in <strong>Foreman</strong>
(<tt>getenv</tt> and <tt>setenv</tt> commands), getting, adding and removing
classes linked to hosts and hostgroups (<tt>getcls</tt>, <tt>addcls</tt>,
<tt>rmcls</tt>, <tt>getgcls</tt>, <tt>addgcls</tt>, <tt>rmgcls</tt> respectively), searching
hosts and hostgroups based on given criteria (<tt>srch</tt> and <tt>srchg</tt>),
listing available classes (<tt>lscls</tt>) and describing hosts (<tt>desc</tt>).</p>
<p>To install them, please refer to <a href="#Installation" rel="nofollow">Installation</a>
section above. Also, please read <a href="#usage-notes" rel="nofollow">Usage notes</a> below
before using.</p>
<p>Hopefully, there are more coming.</p>
</div>
<div id="examples">
<h3>Examples</h3>
<p>Imagine that you need to grep all your frontend nginx logs for string
‘/api/do_something’. Your frontend hostnames are <tt>frontend00</tt>,
<tt>frontend01</tt>, …, <tt>frontend99</tt>. You could use something like</p>
<p><tt>swk pssh <span class="pre">frontend[0-9][0-9]</span> grep '/api/do_something' /var/log/nginx/access.log</tt></p>
<p>You can interrupt the command execution at any moment with Ctrl-C.</p>
<p>Suppose your servers are named a bit more sophisticated, like
<tt>frontend01</tt>, <tt>frontend02</tt>, …, <tt>frontend25</tt>. This command would
do the trick (note the quotes around host expression):</p>
<p><tt>swk pssh <span class="pre">'frontend([0-1][0-9]|2[0-5])</span> <span class="pre">-frontend00'</span> grep '/api/do_something' /var/log/nginx/access.log</tt></p>
<p>You can always verify if you did the host expression right:</p>
<p><tt>swk dr <span class="pre">'frontend([0-1][0-9]|2[0-5])</span> <span class="pre">-frontend00'</span></tt></p>
<p>Output:</p>
<pre>frontend01
frontend02
&lt;...skipped...&gt;
frontend24
frontend25
</pre>
<p>Suppose you also have servers <tt>backend01</tt>, <tt>backend02</tt>, …,
<tt>backend10</tt>, and you want to run <tt>uptime</tt> on both frontends and
backends. Try this one:</p>
<p><tt>swk pssh <span class="pre">'frontend([0-1][0-9]|2[0-5])</span> <span class="pre">-frontend00,backend(0[1-9]|10)'</span> uptime</tt></p>
<p>Now imagine you have to execute a certain script named <tt>test.sh</tt> on
those 25 frontends locally. First, copy it to target hosts:</p>
<p><tt>swk dist <span class="pre">'frontend([0-1][0-9]|2[0-5])</span> <span class="pre">-frontend00'</span> ./my_scripts/test.sh /usr/share/</tt></p>
<p>and then execute it:</p>
<p><tt>swk pssh <span class="pre">'frontend([0-1][0-9]|2[0-5])</span> <span class="pre">-frontend00'</span> /usr/share/test.sh</tt></p>
<p>Imagine you need to do something with nginx logs locally on your
computer (say, a simple statistics calculation). You can gather all the
logs to your machine with one command:</p>
<p><tt>swk gather <span class="pre">'frontend([0-1][0-9]|2[0-5])</span> <span class="pre">-frontend00'</span> /var/log/nginx/access.log <span class="pre">./nginx-logs-from-production</span></tt></p>
<p>This will create ‘nginx-logs-from-production’ directory in your current
working directory, and copy over all the access.log files, appending a
suffix so you can tell from which host each log has been copied.</p>
<p>Say you have a Zabbix installation in your environment, and all the
frontends are in ‘frontend’ hostgroup. You can do the same as above
using zabbix hostgroup expansion (note that <tt>zabbix</tt> module is
disabled by default. More on that in <a href="#available-and-bundled-plugins" rel="nofollow">Available
plugins</a> section above)</p>
<p><tt>swk gather ^frontend /var/log/nginx/access.log <span class="pre">./nginx-logs-from-production</span></tt></p>
<p>You probably already have some cli tools for finding hosts falling under
some search criteria. Suppose you have a tool that’s called
<tt>my_awesome_tool</tt> which returns some hostnames on call, like this:</p>
<pre>$ my_awesome_tool
host1
host2
host3
</pre>
<p>If you want to use your tools as a source for hostlists for <tt>swk</tt>, you
can achieve this in two ways:</p>
<pre>swk pssh "`my_awesome_tool`" uptime
</pre>
<p>or</p>
<pre>my_awesome_tool | swk pssh - uptime
</pre>
<p>where <tt>-</tt> instead of host expression indicates that <tt>swk</tt> reads from
stdin.</p>
<p>Imagine that you have Foreman installation and you need to set all the
frontends’ environments to ‘development’ (note that you still use ^
here, so host expansion mechanism works with Zabbix hostgroups)</p>
<p><tt>swk setenv ^frontend development</tt></p>
<p>…or add to frontend Foreman hostgroup your brand new
<tt><span class="pre">nginx::verbose_access_logs</span></tt> Puppet class</p>
<p><tt>swk addgcls frontend <span class="pre">nginx::verbose_access_logs</span></tt></p>
<p>Note: if you have several Foreman hostgroups named the same, but
different hierarchically (for example, <tt>debian/mysql</tt> and <tt>mysql</tt>),
<tt>getgcls</tt>, <tt>addgcls</tt> and <tt>rmgcls</tt> will work with the first group
returned by Foreman API.</p>
<p>You can also get description on an existing host:</p>
<pre>swk desc myhost
</pre>
<p>Output:</p>
<pre>[myhost.example_domain.com]:
Hostgroup:  mysql
OS:     Debian 7.9
IP:     192.168.1.1
Resource:   myhypervisor
Env:        production
Comment:    my favorite host!
</pre>
<p>Or search hosts by a given criteria (Foreman doesn’t support everything
for a search criterias). There are several short keywords for
convenience now: <tt>hg</tt> for hostgroup, <tt>cls</tt> for class, <tt>env</tt> for
environment and <tt>os</tt> for OS family (Debian, RedHat etc). Specifying
several implies AND logic:</p>
<pre>swk srch cls=my_awesome_puppet_class
</pre>
<p>Output:</p>
<pre>myhost
</pre>
<p>This way you can combine <tt>swk</tt> invocations in something really fun
like</p>
<pre>swk pssh "`swk srch cls=my_awesome_puppet_class`" reboot
</pre>
<p>Remember to use and escape quotes when needed!</p>
<p><tt>swk pssh ^mysql mysql <span class="pre">-e</span> 'show variables like "read_only"'</tt> won’t
work (due to shell quote processing, it represents
<tt>mysql <span class="pre">-e</span> show variables like "read only"</tt>), but</p>
<p><tt>swk pssh ^mysql "mysql <span class="pre">-e</span> 'show variables like <span class="pre">\"read_only\"'"</span></tt> will.</p>
<p>You can get more info on available parsers, commands and arguments by
running <tt>swk <span class="pre">-h</span></tt> .</p>
<p>If you need to change your default SSH user, parallel processes count,
API credentials or such, take a look at <strong>swk.ini</strong> file located at
<strong>~/.swk</strong> .</p>
</div>
</div></body></html>