<html><body><div><div class="body"><div itemscope="" itemtype="http://schema.org/Article"><h1 class="title" itemprop="name">Qt reactor in cogen</h1><p class="date"> Sun 20 April 2008</p><div itemprop="articleBody"><p>I've implemented a reactor to integrate the cogen loop in the qt main loop.</p><p>You whould use it like this:</p><div class="highlight"><pre><span/><span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">([])</span>
<span class="n">hello</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span> <span class="s2">"Hello world!"</span> <span class="p">)</span>
<span class="n">hello</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">hello</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">cogen.core</span> <span class="kn">import</span> <span class="n">reactors</span><span class="p">,</span> <span class="n">schedulers</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Scheduler</span><span class="p">(</span><span class="n">reactor</span><span class="o">=</span><span class="n">reactors</span><span class="o">.</span><span class="n">QtReactor</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lorem_ipsum_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s1">'200 OK'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'Content-type'</span><span class="p">,</span><span class="s1">'text/plain'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'Content-Length'</span><span class="p">,</span><span class="s1">'19'</span><span class="p">)])</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">'Lorem ipsum dolor..'</span><span class="p">]</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIServer</span><span class="p">(</span>
    <span class="p">(</span><span class="s1">'0.0.0.0'</span><span class="p">,</span> <span class="mi">9001</span><span class="p">),</span>
    <span class="n">lorem_ipsum_app</span><span class="p">,</span>
    <span class="n">m</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">serve</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># voila! this actualy runs the QApplication loop with the cogen hooks</span>
</pre></div><div class="line-block"><p class="line">Though the reactor isn't tested, well, unittested - I have a bunch of tests to keep the code sane.</p></div><div class="line-block"><p class="line">The problem is that Qt is a big nasty monolithic framework, well, it's nice if you don't need to do any weird stuff - like running the main application loop in a second thread.</p></div><p>I just don't understand why they made this ugly limitation in qt: the application loop must run in the main thread. I'll fix those tests somehow, but in the meanwhile I'll just continue cursing Qt for making me feel miserable about my unittests.</p></div><p class="tags">This entry was tagged as <a href="https://blog.ionelmc.ro/tag/cogen/"><span itemprop="keywords">cogen</span></a><a href="https://blog.ionelmc.ro/tag/python/"><span itemprop="keywords">python</span></a><a href="https://blog.ionelmc.ro/tag/qt/"><span itemprop="keywords">qt</span></a></p></div><p id="disqus_thread"/><noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div></div></body></html>