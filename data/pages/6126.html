<html><body><div><div class="section" id="vim-restructuredtext">
<h1>Vim (и не только) для reStructuredText<a class="headerlink" href="#vim-restructuredtext" title="Ссылка на этот заголовок">¶</a></h1>
<p><a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> - очень удобная разметка, которая используется при
написании документации (<a class="reference external" href="https://pypi.python.org/pypi/sphinx">sphinx</a>), README для гитхаба, битбакета, PyPi и
всего прочего вплоть до научных статей (<a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report_solarized2_dark.html">пример</a>)
или же статей для <a class="reference internal" href="../ablog/#ablog"><span>блога</span></a> :)</p>
<p>Так-как документация отымает бОльшую часть времени от разработки, то хорошо бы
настроить окружение под нее. В конечном счете это сэкономит кучу времени.</p>
<div class="section" id="tagbar">
<h2>TagBar<a class="headerlink" href="#tagbar" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference external" href="https://github.com/majutsushi/tagbar">majutsushi/tagbar</a> - это плагин который показывает тэги документа в
отдельном окне. Для настройки нам понадобится добавить его в <a class="reference external" href="http://www.vim.org">Vim</a> и
установить клавишу вызова (например <code class="kbd docutils literal"><span class="pre">F8</span></code>).</p>
<div class="literal-block-wrapper container" id="vimrc-tagbar">

<div class="highlight-vim"><div class="highlight"><pre>Plug <span class="s1">'majutsushi/tagbar'</span>
nmap <span class="p">&lt;</span>F8<span class="p">&gt;</span> :TagbarToggle<span class="p">&lt;</span>CR<span class="p">&gt;</span>
</pre></div>
</div>
</div>
<p>Все что <code class="docutils literal"><span class="pre">tagbar</span></code> не умеет делать “из коробки” можно подключить в виде
отдельных расширений (<a class="reference external" href="https://github.com/majutsushi/tagbar/wiki">полный список тут</a>) или написать свое.</p>
<p>Для <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> есть <a class="reference external" href="https://github.com/jszakmeister/rst2ctags">jszakmeister/rst2ctags</a>. Подключается
он довольно просто:</p>
<ul class="simple">
<li>клонируем <code class="docutils literal"><span class="pre">git</span></code> репу в локальную папку</li>
<li>и указываем путь до нее в <code class="docutils literal"><span class="pre">.vimrc</span></code></li>
</ul>

<p>После этого по нажатию <code class="kbd docutils literal"><span class="pre">F8</span></code> будет открываться “содержание” вашего
документа, как показано на рисунках ниже.</p>


<p>Таким образом упрощается навигация по документу и структурирование разделов.</p>
</div>
<div class="section" id="riv-vim">
<h2>Riv.vim<a class="headerlink" href="#riv-vim" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference external" href="https://github.com/Rykka/riv.vim">Rykka/riv.vim</a> - это что то на подобии <code class="docutils literal"><span class="pre">python-mode</span></code> для
<a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>. Всякие ништяки для rST.</p>
<div class="literal-block-wrapper container" id="github-rykka-riv-vim-l-vim">

<div class="highlight-vim"><div class="highlight"><pre>Plug <span class="s1">'Rykka/riv.vim'</span><span class="p">,</span> { <span class="s1">'for'</span>: <span class="s1">'rst'</span> }
</pre></div>
</div>
</div>
<p>В командном режиме появятся следующие функции:</p>
<div class="highlight-bash"><div class="highlight"><pre>Riv2BuildPath           RivCreateHyperLink      RivHelpTodo
RivListType2            RivShiftRight           RivTitle2
Riv2HtmlAndBrowse       RivCreateInterpreted    RivInstruction
RivListType3            RivSpecification        RivTitle3
Riv2HtmlFile            RivCreateLink           RivIntro
RivListType4            RivSuperCEnter          RivTitle4
Riv2HtmlProject         RivCreateLiteralBlock   RivItemClick
RivNormEqual            RivSuperEnter           RivTitle5
Riv2Latex               RivCreateLiteralInline  RivItemToggle
RivNormLeft             RivSuperMEnter          RivTitle6
Riv2Odt                 RivCreateStrong         RivLinkNext
RivNormRight            RivSuperSEnter          RivTodoAsk
Riv2Pdf                 RivCreateTime           RivLinkOpen
RivPrimer               RivTableCreate          RivTodoDate
Riv2S5                  RivCreateTransition     RivLinkPrev
RivProjectHtmlIndex     RivTableFormat          RivTodoDel
Riv2Xml                 RivDeleteFile           RivLinkShow
RivProjectIndex         RivTableNextCell        RivTodoPrior
RivCheatSheet           RivDirectives           RivListDelete
RivProjectList          RivTablePrevCell        RivTodoToggle
RivCreateContent        RivFoldAll              RivListNew
RivQuickStart           RivTestFold0            RivTodoType1
RivCreateDate           RivFoldToggle           RivListSub
RivReload               RivTestFold1            RivTodoType2
RivCreateEmphasis       RivFoldUpdate           RivListSup
RivScratchCreate        RivTestObj              RivTodoType3
RivCreateExplicitMark   RivGetLatest            RivListToggle
RivScratchView          RivTestTest             RivTodoType4
RivCreateFoot           RivHelpFile             RivListType0
RivShiftEqual           RivTitle0               RivTodoUpdateCache
RivCreateGitLink        RivHelpSection          RivListType1
RivShiftLeft            RivTitle1               RivVimTest
</pre></div>
</div>
<p>Плагин имеет множество разных функций которые лучше
изучить при помощи команды <code class="docutils literal"><span class="pre">:RivQuickStart</span></code>.</p>
<p>Например команда <code class="docutils literal"><span class="pre">:Riv2HtmlAndBrowse</span></code> рендерит текущий документ и открывает
его в браузере. А сочетание клавиш <code class="kbd docutils literal"><span class="pre">Ctrl+e</span></code> <code class="kbd docutils literal"><span class="pre">s</span></code> <code class="kbd docutils literal"><span class="pre">1</span></code> делает
текущую строку заголовком 1-го уровня, т.е. выполняет функцию <code class="docutils literal"><span class="pre">RivTitle1</span></code>.</p>
</div>
<div class="section" id="rstcheck">
<h2>rstcheck<a class="headerlink" href="#rstcheck" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference external" href="https://github.com/myint/rstcheck">myint/rstcheck</a> - это отличный линтер для разметки
<a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>, также помимо <code class="docutils literal"><span class="pre">docutils</span></code> он понимает <a class="reference external" href="http://sphinx-doc.org/">sphinx-doc</a>
директивы и роли.</p>
<div class="section" id="id3">
<h3>Установка<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pip install --upgrade rstcheck
</pre></div>
</div>
</div>
<div class="section" id="code-block">
<h3>Проверка синтаксиса в директиве <code class="docutils literal"><span class="pre">code-block</span></code><a class="headerlink" href="#code-block" title="Ссылка на этот заголовок">¶</a></h3>
<p><code class="docutils literal"><span class="pre">rstcheck</span></code> умеет проверять синтаксис следующих языков в директиве <code class="docutils literal"><span class="pre">..</span>
<span class="pre">code-block::</span></code>:</p>
<ul class="simple">
<li>Bash</li>
<li>Doctest</li>
<li>C (C99)</li>
<li>C++ (C++11)</li>
<li>JSON</li>
<li>Python</li>
<li>reStructuredText</li>
</ul>
<p>Например я допустил ошибку в коде на <a class="reference external" href="https://www.python.org/">Python</a>:</p>
<div class="highlight-rst"><div class="highlight"><pre><span class="gh">====</span>
<span class="gh">Test</span>
<span class="gh">====</span>

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> python

    print(
</pre></div>
</div>
<p>В этом случае линтер ее обнаружит:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>rstcheck bad_python.rst
bad_python.rst:7: <span class="o">(</span>ERROR/3<span class="o">)</span> <span class="o">(</span>python<span class="o">)</span> unexpected EOF <span class="k">while</span> parsing
</pre></div>
</div>
<p>Еще пример с <code class="docutils literal"><span class="pre">C++</span></code>:</p>
<div class="highlight-rst"><div class="highlight"><pre><span class="gh">====</span>
<span class="gh">Test</span>
<span class="gh">====</span>

<span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> <span class="k">cpp</span>

    <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>rstcheck bad_cpp.rst
bad_cpp.rst:9: <span class="o">(</span>ERROR/3<span class="o">)</span> <span class="o">(</span>cpp<span class="o">)</span> error: <span class="s1">'x'</span> was not declared in this scope
</pre></div>
</div>
<p>И пример с опечаткой в rST:</p>

<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>rstcheck bad_rst.rst
bad_rst.rst:1: <span class="o">(</span>SEVERE/4<span class="o">)</span> Title overline <span class="p">&amp;</span> underline mismatch.
</pre></div>
</div>
<p>Я добавляю <code class="docutils literal"><span class="pre">rstcheck</span></code> в <code class="docutils literal"><span class="pre">travis-ci</span></code> и после каждого коммита проверяю
документацию на наличие ошибок. Пример можно посмотреть <a class="reference external" href="https://github.com/ustu/lectures.www/blob/master/test.sh">здесь</a>.</p>
</div>
<div class="section" id="id5">
<h3>Конфиг<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Про некоторые кастомные роли и директивы <code class="docutils literal"><span class="pre">rstcheck</span></code> ничего не знает, что бы
они не попадали в поток ошибок их можно заигнорировать при помощи конфига. Файл
конфига с именем <code class="docutils literal"><span class="pre">.rstcheck.cfg</span></code> должен располагаться в текущей директории,
например так:</p>
<div class="highlight-bash"><div class="highlight"><pre>docs
├── foo
│   └── bar.rst
├── index.rst
└── .rstcheck.cfg
</pre></div>
</div>
<p>Можно указать какие игнорировать директивы или роли, например для блога я
использую некоторые кастомные вещи из модуля расширения
<a class="reference external" href="https://github.com/ITCase/sphinx-links">ITCase/sphinx-links</a> и <a class="reference external" href="https://github.com/abakan/ablog">ABlog</a>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[rstcheck]</span>
<span class="na">ignore_directives</span><span class="o">=</span><span class="s">post,postlist</span>
<span class="na">ignore_roles</span><span class="o">=</span><span class="s">github,l,man,pypi</span>
</pre></div>
</div>
</div>
<div class="section" id="python">
<h3>Модуль для Python<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h3>
<p>Т.к. <a class="reference external" href="https://pypi.python.org/pypi/rstcheck">rstcheck</a> это <a class="reference external" href="https://www.python.org/">Python</a> модуль, его можно использовать в своих
скриптах:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">rstcheck</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">rstcheck</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s">'Example</span><span class="se">\n</span><span class="s">==='</span><span class="p">))</span>
<span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="s">'(INFO/1) Possible title underline, too short for the title.'</span><span class="p">)]</span>
</pre></div>
</div>
</div>

</div>

</div>

  </div></body></html>