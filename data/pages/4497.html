<html><body><div><div class="post-text" itemprop="text">

<p>I am getting errors when trying to reset the connection to a remote database. It is not the default database. It seems that connections.close only has a affect on the default Database configuration. </p>

<p>Am I missing something or is there a way to reset the connection to a specific database (not default)?</p>

<p>Django 1.7
Python 2.7.9</p>

<pre><code>DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'DefaultDB',
        'USER': 'xxxxx',
        'PASSWORD': 'xxxxxx',
        'HOST': '',
        'PORT': '',
    },
    'BaSS': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'TheDB',
        'USER': 'xxxx',
        'PASSWORD': 'xxxxx',
        'HOST': '10.x.x.x',
        'PORT': 'xxxx',
    }
}
</code></pre>

<p>RemoteDB_models.py:</p>

<pre><code>class RemoteDBRouters(models.Model):
    hostname = models.CharField(max_length=63)
    role = models.CharField(max_length=20, blank=True)
    infodate = models.DateField()
    infotime = models.TimeField()
    serialnum = models.CharField(max_length=20)
    iostype = models.CharField(max_length=50)
    iosver = models.CharField(max_length=15)
    imagefilename = models.CharField(max_length=256, blank=True)
    model = models.CharField(max_length=20)
    cfgver = models.DecimalField(max_digits=3, decimal_places=2, blank=True, null=True)
    filename = models.CharField(max_length=256)
    cfghostname = models.CharField(max_length=63, blank=True)
    medium = models.CharField(max_length=20, blank=True)
    dmtype = models.CharField(max_length=20, blank=True)
    t1size = models.IntegerField(blank=True, null=True)
    spid1 = models.CharField(max_length=20, blank=True)
    spid2 = models.CharField(max_length=20, blank=True)
    mrtglink = models.CharField(max_length=256, blank=True)
    loopbackip = models.CharField(max_length=15, blank=True)
    tunnelip = models.CharField(max_length=15, blank=True)
    managementip = models.CharField(max_length=15, blank=True)
    snmplocation = models.CharField(max_length=200, blank=True)
    uid = models.IntegerField(primary_key=True)
    tun8inet = models.CharField(max_length=31, blank=True)
    tun9inet = models.CharField(max_length=31, blank=True)
    snmpcontact = models.CharField(max_length=300, blank=True)

    class Meta:
        managed = False
        db_table = 'routers'

class RoutersLastupdate(models.Model):
    uid = models.ForeignKey(BaSSRouters)
    hostname = models.ForeignKey(BaSSRouters)
    infodate = models.DateField()
    infotime = models.TimeField()
    deconverted = models.CharField(max_length=1)

    class Meta:
        managed = False
        db_table = 'routers_lastupdate'
</code></pre>

<p>Ouputput of attempts</p>

<pre><code>&gt;&gt;&gt; from django.db import connection; connection.close() 
&gt;&gt;&gt; from thunderdome.RemoteDB_models import RoutersLastupdate, RemoteDBRouters
&gt;&gt;&gt; from thunderdome.models import InventoryWarehouse as Inventory_Warehouse
&gt;&gt;&gt; serial = "0123456789"                                        
&gt;&gt;&gt; Inventory_Warehouse.objects.filter(serial_numb=serial).first()
&lt;InventoryWarehouse: InventoryWarehouse object&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt; RemoteDBRouters.objects.using("BaSS").filter(hostname="router1").last()       
Traceback (most recent call last):
  File "&lt;console&gt;", line 1, in &lt;module&gt;
  File "/usr/local/lib/python2.7/site-packages/django/db/models/query.py", line 520, in last
    return qs[0]
  File "/usr/local/lib/python2.7/site-packages/django/db/models/query.py", line 177, in __getitem__
    return list(qs)[0]
  File "/usr/local/lib/python2.7/site-packages/django/db/models/query.py", line 141, in __iter__
    self._fetch_all()
  File "/usr/local/lib/python2.7/site-packages/django/db/models/query.py", line 966, in _fetch_all
    self._result_cache = list(self.iterator())
  File "/usr/local/lib/python2.7/site-packages/django/db/models/query.py", line 265, in iterator
    for row in compiler.results_iter():
  File "/usr/local/lib/python2.7/site-packages/django/db/models/sql/compiler.py", line 700, in results_iter
    for rows in self.execute_sql(MULTI):
  File "/usr/local/lib/python2.7/site-packages/django/db/models/sql/compiler.py", line 786, in execute_sql
    cursor.execute(sql, params)
  File "/usr/local/lib/python2.7/site-packages/django/db/backends/utils.py", line 81, in execute
    return super(CursorDebugWrapper, self).execute(sql, params)
  File "/usr/local/lib/python2.7/site-packages/django/db/backends/utils.py", line 65, in execute
    return self.cursor.execute(sql, params)
  File "/usr/local/lib/python2.7/site-packages/django/db/utils.py", line 94, in __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File "/usr/local/lib/python2.7/site-packages/django/db/backends/utils.py", line 65, in execute
    return self.cursor.execute(sql, params)
  File "/usr/local/lib/python2.7/site-packages/django/db/backends/mysql/base.py", line 129, in execute
    return self.cursor.execute(query, args)
  File "/usr/local/lib/python2.7/site-packages/MySQLdb/cursors.py", line 205, in execute
    self.errorhandler(self, exc, value)
  File "/usr/local/lib/python2.7/site-packages/MySQLdb/connections.py", line 36, in defaulterrorhandler
    raise errorclass, errorvalue
OperationalError: (2006, 'MySQL server has gone away')
&gt;&gt;&gt; 
</code></pre>

<p><strong>Edit:</strong></p>

<p>The BaSS database is a remote database that I only have read access to all tables. I do not control the timeout on the serverside for this DB.</p>

<p><strong>Update</strong></p>

<p>Restarting MySQl at the service level does reset this and allow connections through. Still this is not a elegant solution to restart the service every 8 hours. Looking for help still.</p>
    </div>
    </div></body></html>