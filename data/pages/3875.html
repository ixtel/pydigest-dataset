<html><body><div><article class="post-content">
    <p>So, bit of code I wrote while halfway going mad arguing with API’s at <a href="https://www.brumhack.co.uk/">BrumHack</a> in order to retain my sanity a little. This really, really, simple piece of code basically <br/>
just takes a screenshot using <a href="https://pypi.python.org/pypi/pyscreenshot">PyScreenshot</a> and uploads it to <a href="https://imgur.com">imgur</a> using the <a href="https://api.imgur.com">imgur api</a>.</p>

<p>Now, to use it, just run it. You will need “pyscreenshot” and “requests” installed, which are both available via Pip. The rest is stdlib python. All it does is take a screenshot, <br/>
upload to imgur, and print the URL you can access the image. Grab it from <a href="https://github.com/0x27/imgurscrot">github here</a>.</p>

<p>I guess I will first take the time to explain how the python screenshot library is used. See the following commented code block to see how it does its magic.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyscreenshot</span> <span class="kn">as</span> <span class="nn">pyscrot</span> <span class="c"># import pyscreenshot module as pyscrot.</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">pyscrot</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span> <span class="c"># grab the full screen and store the PNG screenshot into the image variable where its kept as a PIL object</span>
<span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">"screenshot.png"</span><span class="p">)</span> <span class="c"># save it to the file screenshot.png in CWD.</span></code></pre></div>

<p>Nothing complex about this, if you are interested in the hows and whys of the pyscreenshot modules inner workings, I suggest you have a look at its source code or something.</p>

<p>Obviously, we want to store our image for just long enough to upload it, and writing a tempfile as I originally did is really ugly and tends to be non portable across platforms as <br/>
tempfile locations vary. So… We want our image as base64, in order to upload it. How do we do this…</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyscreenshot</span> <span class="kn">as</span> <span class="nn">pyscrot</span> <span class="c"># import pyscreenshot module as pyscrot.</span>
<span class="kn">import</span> <span class="nn">base64</span> <span class="c"># import the base64 module</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="o">*</span> <span class="c"># import everything from StringIO</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">pyscrot</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span> <span class="c"># grab the full screen and store the PNG screenshot into the image variable where its kept as a PIL object</span>
<span class="n">imgstr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span> <span class="c"># create a StringIO object named imgstr</span>
<span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">imgstr</span><span class="p">,</span> <span class="s">'png'</span><span class="p">)</span> <span class="c"># save the image to the StringIO object (treating it like a file)</span>
<span class="n">b64image</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">standard_b64encode</span><span class="p">(</span><span class="n">imgstr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span> <span class="c"># base64 the string stored in the imgstr object :)</span></code></pre></div>

<p>Now, because the <a href="https://github.com/Imgur/imgurpython/">python imgur library</a> seems to be hideously broken at the moment and I simply could not get the bastard thing to work even with its own samples, I simply <br/>
decided to use <a href="https://pypi.python.org/pypi/requests">python-requests</a> to manually make my API calls. Seeing as we are just uploading images anonymously, the only thing we give a shit about is the fact we <br/>
can, er, upload a screenshot.</p>

<p>In order to upload the screenshot, we need to send an Authorization header with our ClientID in it, as part of a POST request containing the base64 encoded image and a title for it. We <br/>
get back a JSON response containing the URL to our image. In this example, our “image title” is Screenshot-<current time="" and="" date="">.png</current></p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">client_id</span> <span class="o">=</span> <span class="n">OUR_CLIENT_ID</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Authorization'</span><span class="p">:</span> <span class="s">'Client-ID '</span><span class="o">+</span><span class="n">client_id</span><span class="p">}</span> <span class="c"># authorization header.</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'image'</span><span class="p">:</span> <span class="n">b64image</span><span class="p">,</span> <span class="s">'title'</span><span class="p">:</span> <span class="s">'Screenshot-</span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%H:%M:%S-</span><span class="si">%d</span><span class="s">/%m/%Y"</span><span class="p">))}</span> <span class="c"># our image as base64 data as the "image" var, title as... title var.</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">"https://api.imgur.com/3/upload.json"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> <span class="c"># send the request</span>
<span class="n">lol</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="c"># load the json response as ... json</span>
<span class="k">print</span> <span class="n">lol</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="s">'link'</span><span class="p">]</span> <span class="c"># print the link to image stored in the json response</span></code></pre></div>

<p>Well, that concludes the explaination of how it works. Have fun :)</p>


  </article>

</div></body></html>