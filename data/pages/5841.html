<html><body><div><div class="entry-content">
						<p>Happy Friday everyone,</p>
<p>Reading the subject of this blog post I hope you’re all ready to have some fun! A month ago, Google released the code in an <a href="http://googleresearch.blogspot.com.au/2015/07/deepdream-code-example-for-visualizing.html">IPython Notebook</a> letting everyone experiment with neural networks, image recognition algorithms and techniques as described in their <a href="http://googleresearch.blogspot.com.au/2015/06/inceptionism-going-deeper-into-neural.html">Inceptionism: Going Deeper into Neural Networks</a> article. Neural networks are known for their ability to recognize different shapes, forms, sophisticated objects, and even people’s faces. Well, Google engineers used an upside-down approach: you show different images to a pre-trained neural network and let it draw what it sees on the images, with the ultimate goal of generating new creative imagery based on artificial intelligence!</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream0.png"><img class="alignleft size-full wp-image-3349" alt="deepdream0" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream0.png"/></a></p>
<p>The example code for image generation kindly shared by Google is available as an <a href="https://github.com/google/deepdream">IPython Notebook</a> on Google’s GitHub repository. I couldn’t miss the chance to try it in PyCharm. PyCharm natively supports IPython Notebook since v4 as described in <a href="http://blog.jetbrains.com/pycharm/2014/12/feature-spotlight-ipython-notebook-inside-an-ide/">this blog post</a>. In the latest v4.5, this support is even better and can be applied to many areas, including quantitative research as described <a href="http://blog.jetbrains.com/pycharm/2015/07/quantitative-research-in-python-using-notebooks/">here</a>.</p>
<p>While Google’s code example relies on as few dependencies as possible, several things still need to be installed first. I won’t describe the whole process of installing all the dependencies as they slightly differ across various platforms, but I’ll show you how PyCharm helps you along the way.</p>
<p>First, you need to install PyCharm from the <a href="https://www.jetbrains.com/pycharm/">official website</a>. Both Professional and Community editions natively support IPython Notebook. Next, you’ll need to get the deepdream code from the <a href="https://github.com/google/deepdream">Google’s GitHub repository</a>. That’s a very simple task as you can get it automatically from the PyCharm’s welcome screen:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream1.png"><img class="alignleft size-full wp-image-3350" alt="deepdream1" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream1.png"/></a></p>
<p>You can simply enter the repo URL (<a href="https://github.com/google/deepdream">https://github.com/google/deepdream</a>) in the dialog and PyCharm will clone the project for you:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream2_1.png"><img class=" wp-image-3376 alignleft" alt="deepdream2_1" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream2_1.png"/></a></p>
<p>After cloning, PyCharm will offer you to open the newly imported project, so here we go:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream3.png"><img class="alignleft size-full wp-image-3352" alt="deepdream3" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream3.png"/></a></p>
<p>Now let’s take care of the dependencies. For a clean installation, I recommend creating a fresh Python virtual environment, and this is another case where PyCharm helps us. Go to <em>Settings (Preferences for Mac users) | Project | Project Interpreter</em> and add a new virtual environment as shown on the screenshot:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream4.png"><img class="alignleft size-full wp-image-3353" alt="deepdream4" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream4.png"/></a></p>
<p>You’ll get a clean Python virtual environment with only a few standard packages inside. As you can see on the next screenshot, PyCharm highlights the missing dependencies in the code:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream5.png"><img class="alignleft size-full wp-image-3354" alt="deepdream5" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream5.png"/></a></p>
<p>Place the caret on the missing dependency, use the so-called quick-fix action with <em>Alt+Enter</em>, and PyCharm will offer you to install it:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream6.png"><img class="alignleft size-full wp-image-3355" alt="deepdream6" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream6.png"/></a></p>
<p>In a similar manner, install the other dependencies mentioned in the first cell of the IPython Notebook and highlighted by PyCharm. Alternatively, you can go back to <em>Settings | Project Interpreter</em> and install everything using the built-in package manager:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream7.png"><img class="alignleft size-full wp-image-3356" alt="deepdream7" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream7.png"/></a></p>
<p><em>Note: As an option, you can choose to install the Anaconda or Canopy packages which include the superset of the scientific stack comprising most of the mentioned libraries as recommended by Google engineers. These packages are really huge and bloat your environment, so I prefer to install only what’s needed and have a minimal virtual environment.</em></p>
<p>The most difficult part is to install the last but most important dependency—the <a href="http://caffe.berkeleyvision.org/">Caffe</a> deep learning framework, developed by the <a href="http://bvlc.eecs.berkeley.edu/">Berkeley Vision and Learning Center</a>. The installation process deserves a post of its own as it’s long and complicated. Nor PyCharm neither any other tool can help here, as this framework isn’t available on any package repository. Anaconda and Canopy don’t have Caffe on board either. So you have to install it manually. The <a href="http://caffe.berkeleyvision.org/installation.html">installation guide</a> can be found on the BVLC official website. It’s pretty descriptive and I hope you won’t meet any problems installing Caffe along the way.</p>
<p>The only thing I’d like to note here is that Caffe can be installed with or without the <a href="https://developer.nvidia.com/cuda-zone">CUDA</a> library and driver. CUDA installation is huge and will consume a lot of time, so if you want to get quick results, install Caffe without CUDA. But if you need maximum performance and don’t want to spend extra time waiting for image generation, installing CUDA is the way to go.</p>
<p>Finally, when you’re done installing all the dependencies we’re ready to go and have some fun. You can start with running cells one by one inside PyCharm clicking the green “Run” button. On the first cell with Python code, PyCharm will automatically offer you to start the IPython Notebook kernel:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream8.png"><img class="alignleft size-full wp-image-3357" alt="deepdream8" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream8.png"/></a></p>
<p>Make sure you’re following the code and substitute the required paths to Caffe models and images:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream9.png"><img class="alignleft size-full wp-image-3358" alt="deepdream9" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream9.png"/></a></p>
<p>The standard installation of Caffe have the <em>bvlc_googlenet</em> model already pre-installed. You only need to specify the path to your Caffe installation. Later, you can play with other models, trained on different image sets that can be found in the <a href="https://github.com/BVLC/caffe/tree/master/models">BVLC official github repository</a>.</p>
<p>Going cell by cell in the example IPython Notebook, you can generate images from the standard pictures that come with the example project:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream10.png"><img class="alignleft size-full wp-image-3359" alt="deepdream10" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream10.png"/></a></p>
<p>After you’re done with the default examples, it’s time to do something really fun and weird. Experiment with your own pictures and code modifications!</p>
<p>I decided to find out what the neural network would see on the PyCharm logo. I added the logo to the project and changed the code:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream11.png"><img class="alignleft size-full wp-image-3360" alt="deepdream11" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream11.png"/></a></p>
<p>And this was the output:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream12.png"><img class="alignleft size-full wp-image-3361" alt="deepdream12" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream12.png"/></a></p>
<p>Weird and funky, isn’t it? But wait, that’s just the beginning. Let’s go further and write some custom code. When modifying the code, PyCharm helps you with autocompletion:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream13.png"><img class="alignleft size-full wp-image-3362" alt="deepdream13" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream13.png"/></a></p>
<p>It also helps with function parameters:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream14.png"><img class="alignleft size-full wp-image-3363" alt="deepdream14" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream14.png"/></a></p>
<p>I involved a different layer which is responsible for image actualization enhancing edges and textures, giving the image an impressionist feeling:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream15.png"><img class="alignleft size-full wp-image-3364" alt="deepdream15" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream15.png"/></a></p>
<p>The code authors encourage readers to experiment with layer selection to see how it affects the results. There’s definitely lots of room to explore the design!</p>
<p><em>Note: You can get the list of layers by executing the net.blobs.keys() code.</em></p>
<p>The real fun starts when we start feeding a neural network its own output. This leads to very unusual and weird results. You can see true dreams of a neural network and art generated by artificial intelligence.</p>
<p>Executing the following code we produce a number of frames. When transformed slightly, each of them becomes an input on the next cycle of neural network dreaming:</p>
<p/>

		<div id="crayon-56d5afae0b63e883941493" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5afae0b63e883941493-1"><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">w</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5afae0b63e883941493-2"><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-h"> </span><span class="crayon-p"># scale coefficient</span></p><p class="crayon-line" id="crayon-56d5afae0b63e883941493-3"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">xrange</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5afae0b63e883941493-4"><span class="crayon-h">     </span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">deepdream</span><span class="crayon-sy">(</span><span class="crayon-v">net</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5afae0b63e883941493-5"><span class="crayon-h">     </span><span class="crayon-v">PIL</span><span class="crayon-sy">.</span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-e">fromarray</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">uint8</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">save</span><span class="crayon-sy">(</span><span class="crayon-s">"frames/%04d.jpg"</span><span class="crayon-o">%</span><span class="crayon-v">frame_i</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5afae0b63e883941493-6"><span class="crayon-h">     </span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">nd</span><span class="crayon-sy">.</span><span class="crayon-e">affine_transform</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e ">h*</span><span class="crayon-v">s</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-e ">w*</span><span class="crayon-v">s</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5afae0b63e883941493-7"><span class="crayon-h">     </span><span class="crayon-v">frame_i</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>Here is the original image:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/pycharm.jpg"><img class="alignnone  wp-image-3369" alt="pycharm" src="http://blog.jetbrains.com/pycharm/files/2015/08/pycharm.jpg"/></a></p>
<p>And here is what we can see on frame #8:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream17.png"><img class="alignnone size-full wp-image-3365" alt="deepdream17" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream17.png"/></a></p>
<p>Is it a dog appearing out of PyCharm’s logo snake’s head?</p>
<p>And on frame #14 I can see a frog’s head on a bird:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream18.png"><img class="alignnone size-full wp-image-3366" alt="deepdream18" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream18.png"/></a></p>
<p>The further you go, the more interesting results you get. Here’s frame #26:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream19.png"><img class="alignnone size-full wp-image-3367" alt="deepdream19" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream19.png"/></a></p>
<p>In frame #49, there’s something completely bizarre:</p>
<p><a href="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream20.png"><img class="alignnone size-full wp-image-3368" alt="deepdream20" src="http://blog.jetbrains.com/pycharm/files/2015/08/deepdream20.png"/></a></p>
<p>This technique of applying different layers using different image sequences leads to the ultimately infinite number of results and filters we can use to produce and modify images.</p>
<p>The authors of this idea encourage you to play with the code, generate your own images, and post them to Google+, Facebook or Twitter. Be sure to tag them with <strong><em>#deepdream</em></strong> so other researchers can check them out too. Also, use the <strong><em>#pycharm</em></strong> hashtag if you like this post and if PyCharm helps you create your own spectacular pictures.</p>
<p>I hope you enjoyed this fun experiment with Google deepdreams and PyCharm.</p>
<p><em>Talk to you soon!</em><br/>
<em> -Dmitry</em></p>
											</div>

					</div></body></html>