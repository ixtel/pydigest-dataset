<html><body><div><div id="content">

            

            
        


            <div class="section">
              <h1>jinja-vanish 0.1</h1>

              


<p>Customizable auto-escaping for jinja2.</p>








<p>When using <a href="http://jinja.pocoo.org" rel="nofollow">Jinja2</a>-templates to output non-HTML contents, autoescaping cannot
be used because it is hardcoded to work with an HTML <tt>escape</tt> function and
<a href="https://pypi.python.org/pypi/MarkupSafe" rel="nofollow">MarkupSafe</a>’s Markup objects.</p>
<p><cite>jinja_vanish</cite> enables implementing custom auto-escapes by overriding the
<tt>escape</tt> function inside the generated template code using an extended
code-generator and replacing the built-in filters <tt>|e</tt> and <tt>|escape</tt>. Usage
is fairly simple, here is an example that uses <cite>psycopg2</cite>’s <tt>mogrify()</tt>
function to escape SQL for Postgres:</p>
<pre><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">jinja_vanish</span> <span class="kn">import</span> <span class="n">DynAutoEscapeEnvironment</span><span class="p">,</span> <span class="n">markup_escape_func</span>
<span class="kn">from</span> <span class="nn">psycopg2.extensions</span> <span class="kn">import</span> <span class="n">adapt</span>

<span class="nd">@markup_escape_func</span>
<span class="k">def</span> <span class="nf">sql_escape</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="c1"># the decorator handles wrapping/unwrapping in Markup(), but is</span>
    <span class="c1"># otherwise not necessary</span>
    <span class="k">return</span> <span class="n">adapt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>


<span class="n">env</span> <span class="o">=</span> <span class="n">DynAutoEscapeEnvironment</span><span class="p">(</span><span class="n">autoescape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">escape_func</span><span class="o">=</span><span class="n">sql_escape</span><span class="p">)</span>
<span class="n">tpl</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s1">'SELECT * FROM foo where post_date &lt;= {{now}}'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">tpl</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
</pre>
<p>Running it outputs:</p>
<pre>SELECT * FROM foo where post_date &lt;= '2016-01-24T23:23:22.727789'::timestamp
</pre>


<a name="downloads"> </a>


<ul class="nodot">
  <li><strong>Downloads (All Versions):</strong></li>
  <li>
    <span>0</span> downloads in the last day
  </li>
  <li>
    <span>21</span> downloads in the last week
  </li>
  <li>
    <span>142</span> downloads in the last month
  </li>
</ul>









            </div>


          </div>
          </div></body></html>