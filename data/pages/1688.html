<html><body><div><div><p>A lot of things can go wrong when requesting information over HTTP from a remote
web server: requests timeout, servers fail, government operatives cut undersea
cables. You get the picture.</p>
<p>Identifying and handling failures helps build fault tolerant systems that stay
up even when services they rely on are down. A nice side effect is your phone is
less likely to beep in the middle of the night with a message from your coworkers
talking in all caps.</p>
<p>This guide will introduce you to the common ways HTTP requests fail and how to
handle the failures.</p>


<p>The examples use Python's fantastic <a href="http://docs.python-requests.org/"><code>requests</code></a>
library, but the principles shown work across all languages. You can follow
along on your computer by grabbing <code>requests</code> off PyPi.</p>
<p>The <a href="http://docs.python-requests.org/en/latest/api/#requests.get"><code>requests.get(url)</code></a>
method is the cornerstone for all the examples. It makes a synchronous HTTP
<code>GET</code> request to fetch the content from <code>url</code>:</p>
<div class="codehilite"><pre><span class="c"># Importing `requests` is omitted from here on for brevity. If you are coding</span>
<span class="c"># along with the article, make sure to include before trying the examples!</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">"https://www.mobify.com/"</span><span class="p">)</span>
</pre></div>


<p>Where possible, the examples use <a href="https://httpbin.org"><code>httpbin</code></a> to illustrate
the specific failure scenarios. It's a great service for testing how your code
will react in a hostile world!</p>
<p>The guide assumes familiarly with making HTTP requests and uses the following
terminology:</p>
<ul>
<li><strong>Client</strong>: The code making the HTTP requests and the server it lives on.</li>
<li><strong>Server</strong>: The box that delivers the HTTP response we requested.</li>
<li><strong>Caller</strong>: The code which instantiates the client and tells it to make a request.</li>
</ul>
<p>Ready to make some requests? Let's go!</p>
<h3>DNS lookup failures</h3>
<p>HTTP requests can fail before the client can even make a connection to the
server. If the URL specified by the caller has a domain name, the client must
look up its IP address before making the request. If the domain name doesn't
resolve it's possible that it isn't configured correctly or doesn't exist.</p>
<div class="codehilite"><pre><span class="c"># This domain name doesn't exist!</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.definitivelydoesnotexist.com/"</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"These aren't the domains we're looking for."</span>
</pre></div>


<p>It's important to let the caller know they may have entered the wrong domain!</p>
<h3>Errors connecting to the server</h3>
<p>Even if the hostname of the URL correctly resolves, we might not always succeed
in connecting to the server. If someone tripped on its power cord and took it
down, it's unlikely it will accept our connection!</p>
<p>Errors of this nature often block the client, tying it up waiting for a server
that will never respond. For this reason, it's a good idea to add timeouts to
the client. That way, if the server takes too long to respond, the client can
move on to do something else rather than waiting
indefinitely. <a href="http://docs.python-requests.org/en/latest/user/advanced/#timeouts"><code>requests</code> provides  both <code>connect</code> and <code>read</code> timeouts</a>.
<code>connect</code> is the amount of time the client should wait to establish a
connection to the server:</p>
<div class="codehilite"><pre><span class="c"># Using a very short `connect_timeout` gives us a feel for what happens when the</span>
<span class="c"># server is slow to pickup the connection.</span>
<span class="n">connect_timeout</span> <span class="o">=</span> <span class="mf">0.0001</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">"https://httpbin.org/delay/5"</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="n">connect_timeout</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">))</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectTimeout</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Too slow Mojo!"</span>
</pre></div>


<p><code>read</code> is the amount of time it should wait between bytes from the server:</p>
<div class="codehilite"><pre><span class="c"># Our resource takes longer than `read_timeout` to send a byte.</span>
<span class="n">read_timeout</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">"https://httpbin.org/delay/5"</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">read_timeout</span><span class="p">))</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ReadTimeout</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Waited too long between bytes."</span>
</pre></div>


<p>The exact values used for the timeout are usually less important than just
setting one. You don't want the client to be blocked forever on a slowpoke
server. Start with 10 seconds and watch your logs.</p>
<blockquote>
<p>Extra Credit: Depending on the profile of the system you're building, you may
want to implement dynamic timeouts that use historical data to wait longer for
servers that are known to be slow. You may want to <a href="http://martinfowler.com/bliki/CircuitBreaker.html">ban your client</a>
from even trying to connect to servers that always timeout.</p>
</blockquote>
<h3>HTTP errors</h3>
<p>What if something goes sideways while the server is preparing our response?
Maybe its database is unresponsive or it was switched in maintenance mode.
Whatever the reason, if the server is able to detect that it isn't functioning
correctly, it should respond with a <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#5xx_Server_Error">HTTP server error code</a>.</p>
<p>Alternatively, if the client is incorrectly constructing the request, the server
may respond with a <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#4xx_Client_Error">HTTP client error code</a>.</p>
<p>In most cases we'll want to identify these bad response status codes and let the
caller handle them. With <code>requests</code>, this is as easy as calling the <a href="http://docs.python-requests.org/en/latest/api/#requests.Response.raise_for_status"><code>response.raise_for_status()</code></a>
method on the <code>response</code> object:</p>
<div class="codehilite"><pre><span class="c"># This URL returns a HTTP 500 Server Error.</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://httpbin.org/status/500"</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"And you get an HTTPError:"</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>
</pre></div>


<h3>Responses that aren't what we expect</h3>
<p>It's possible that the caller could request a resource that our client wasn't
designed to handle. For example, what if someone uses our RSS reader to request
an MKV file of the last episode of Game of Thrones?</p>
<p>We can assert that <code>Content-Type</code> response header matches what we expect. Our
RSS reader example might look for the following:</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">WrongContent</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">):</span>
    <span class="sd">"""The response has the wrong content."""</span>

<span class="c"># This URL sets the `Content-Type` to `text/plain`.</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://httpbin.org/response-headers?Content-Type=text/plain"</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">"content-type"</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"application/rss+xml"</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">WrongContent</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</pre></div>


<p>Note that even if the <code>Content-Type</code> header does match what we are expecting,
there is no guarantee that the response's body will. Calling code should account
for this. For example, if we're expecting JSON and we don't get back JSON, that's
a problem. In <code>requests</code>, the <code>response.json()</code> method tries to convert the
response body into a Python object from JSON:</p>
<div class="codehilite"><pre><span class="c"># This URL returns an XML document.</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://httpbin.org/xml"</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">WrongContent</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</pre></div>


<blockquote>
<p>Extra Credit: If we're processing text data like HTML, don't forget to
detect its charset and correctly decode it. You'll need to check the
<code>response</code>'s <code>Content-Type</code> header as well as potentially the content itself
to avoid decoding errors.</p>
</blockquote>
<h3>Responses that are too large</h3>
<p>Let's go back to our movie example. Not only is the movie not the content type
our RSS reader expects, it's also really big. If we're not careful, these kinds
of responses could exhaust our client's resources.</p>
<p>To ensure our client hasn't been asked to download the entire internet, we must
track how much content we've received. With <code>requests</code>, <a href="http://docs.python-requests.org/en/latest/user/advanced/#body-content-workflow">this takes a little more code</a>:</p>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">closing</span>

<span class="k">class</span> <span class="nc">TooBig</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">):</span>
    <span class="sd">"""The response was way too big."""</span>

<span class="n">TOO_BIG</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span> <span class="c"># 10MB</span>
<span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">128</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"https://path-to-a-huge-resource/"</span>

<span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="n">content_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">):</span>
        <span class="n">content_length</span> <span class="o">=</span> <span class="n">content_length</span> <span class="o">+</span> <span class="n">CHUNK_SIZE</span>
        <span class="k">if</span> <span class="n">content_length</span> <span class="o">&gt;</span> <span class="n">TOO_BIG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TooBig</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</pre></div>


<h3>Requests to unexpected URLs</h3>
<p>If the client is located inside your network it may have privileged access to
internal servers not addressable from the public internet. For example, what if
the caller requests <code>http://127.0.0.1/admin/</code>?</p>
<p>If you're letting callers request arbitrary URLs, we need to check that they are
allowed to request what they are asking for.</p>
<p>One strategy is to prevent callers from requesting sensitive hosts using a
blacklist. A blacklist checks whether the requested domain is present in a set
of restricted domains. If it is, the request is rejected before it's even made.
At a minimum, we'll want to blacklist internal IP addresses.</p>
<p>Python 3.3 added the <a href="https://docs.python.org/3/howto/ipaddress.html"><code>ipaddress</code></a>
module to the standard library, and in Python 2 we can install its backport
<a href="https://pypi.python.org/pypi/py2-ipaddress/"><code>py2-ipaddress</code> from PyPi</a>. Here
we use it to filter requests for internal IP addresses:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">ipaddress</span>
<span class="kn">import</span> <span class="nn">urlparse</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"http://127.0.0.1/admin/"</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">hostname</span>

<span class="c"># `localhost` isn't an IP address, but we probably don't want callers hitting it.</span>
<span class="k">if</span> <span class="n">hostname</span> <span class="o">==</span> <span class="s">'localhost'</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c"># If `hostname` quacks like an IP address, make sure it isn't internal.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">ip</span><span class="o">.</span><span class="n">is_loopback</span> <span class="ow">or</span> <span class="n">ip</span><span class="o">.</span><span class="n">is_reserved</span> <span class="ow">or</span> <span class="n">ip</span><span class="o">.</span><span class="n">is_private</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>


<p>We might extend our blacklist to include internal hostnames or other sensitive
servers. Maybe we also don't want callers to call the server doing the calling.
Otherwise it could be turtles all the way down.</p>
<blockquote>
<p>Extra Credit: If you want to get serious you'll need to resolve the domain
name of the requested resource and check whether it maps to a local IP
address.</p>
</blockquote>
<p>Alternatively, if callers should only be able to request from a narrow set of
servers it may be easier to use a whitelist to reject requests which aren't
directed at a known host:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">urlparse</span>

<span class="n">WHITELISTED_HOSTS</span> <span class="o">=</span> <span class="p">{</span><span class="s">"rainbows.com"</span><span class="p">,</span> <span class="s">"magic.com"</span><span class="p">}</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"https://unicorns.com/"</span>

<span class="k">if</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WHITELISTED_HOSTS</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>


<blockquote>
<p>Extra Credit: Depending on your needs, you might also want to restrict other
parts of the HTTP request, including the protocol used, or the ports.
Additionally, if you find a caller abusing the system, you might want to build a
mechanism to ban them!</p>
</blockquote>
<h2>Handling errors</h2>
<p>So now that we've identified all these errors, what the heck should be do with
them?</p>
<h3>Logging</h3>
<p>What broke? When? Where? Logging failures creates a trail that you can search
for patterns. Logs will often give you insight about how you can further tweak
your configuration to best suit your system or whether someone is abusing the
system.</p>
<h3>Retrying</h3>
<p>When you're firing bits around the world sometimes you just get unlucky.
Depending on what you're doing, it may make sense to just retry the
request if you think the error was intermittent. <code>requests</code> provides an interface
for creating custom <a href="http://docs.python-requests.org/en/latest/user/advanced/#transport-adapters"><code>adapters</code></a>
that can be used to implement retries:</p>
<div class="codehilite"><pre><span class="c"># Use a `Session` instance to customize how `requests` handles making HTTP requests.</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c"># `mount` a custom adapter that retries failed connections for HTTP and HTTPS requests.</span>
<span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s">"http://"</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">adapters</span><span class="o">.</span><span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s">"https://"</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">adapters</span><span class="o">.</span><span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c"># Rejoice with new fault tolerant behaviour!</span>
<span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">"https://www.service-that-drops-every-odd-request.com/"</span><span class="p">)</span>
</pre></div>


<p>Just make sure you only retry requests that are idempotent!</p>
<h3>Notification</h3>
<p>Finally, you'll need to raise the error to the caller. You'll want to do it in a
way that makes it easy for the caller to handle all possible exceptions, but
also in a way that makes it clear why the exception was raised. This is especially
important if you will be displaying the error to a non-technical user and you
want to provide clear instructions about whether they've mistyped the domain or
the server they are trying to connect to is down. In Python, this is a great
chance to <a href="http://blog.ionelmc.ro/2014/08/03/the-most-underrated-feature-in-python-3/">read up on properly re-raising exceptions</a>!</p>
<h2>For Further Consideration</h2>
<h3>SSL</h3>
<p>SSL is pretty cool and we should do more of it. The <code>requests</code> library
<a href="http://docs.python-requests.org/en/latest/user/advanced/#ssl-cert-verification">verifies certificates by default</a>.
If you're using a different library or language, be sure to check that your client
is checking that certificates are valid. You don't want someone <a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITMing</a>
your connection!</p>
<div class="codehilite"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">"https://www.super-sketchy-website.com,</span>
                            <span class="n">verify</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"That domain looks super sketchy."</span>
</pre></div>


<h3>Internationalized Domain Names</h3>
<p><a href="http://en.wikipedia.org/wiki/Internationalized_domain_name">International Domain Names</a>
are a thing. Many libraries will handle these by default now, but you probably
want to throw a test case in there that makes sure the <a href="http://unicodesnowmanforyou.com/">snowman</a> works:</p>
<div class="codehilite"><pre><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">u"http://âž¡.ws/mobify"</span><span class="p">)</span>
</pre></div>


<h3>Performance</h3>
<p>Depending on how you've built your client, there are a variety of ways you might
be able to improve its performance:</p>
<ul>
<li>Consider requesting the compressed response content by setting the
  header <code>Accept-Content: gzip</code>. You'll need to make sure your <a href="http://docs.python-requests.org/en/latest/community/faq/#encoded-data">client can handle
  decompressing</a>
  the content.</li>
<li>Consider having your client connect through an HTTP proxy
  like <a href="http://www.squid-cache.org/">Squid</a> or <a href="https://www.varnish-cache.org/">Varnish</a>.
  If you expect to be requesting the same resources again and again, the proxy's
  cache may considerably reduce response times for <a href="http://www.mobify.com/blog/beginners-guide-to-http-cache-headers/">cacheable resources</a>.</li>
<li><a href="http://docs.python-requests.org/en/latest/user/advanced/#blocking-or-non-blocking"><code>requests</code> is blocking</a>.
  That means that your client will only be able to process one request at a time.
  If your system needs to support many concurrent requests, you might consider
  going async using libraries like <a href="https://github.com/ross/requests-futures"><code>request-futures</code></a>
  or <a href="https://github.com/kennethreitz/grequests"><code>grequests</code></a>.</li>
</ul>
<h3>Tooling</h3>
<p>There are a number of tools out there that can help simplify putting this all
together:</p>
<ul>
<li><a href="http://httpbin.org">httpbin.org</a> allows you to quickly test a number of different
  HTTP response scenarios. It's <a href="http://httpbin.org/delay/3"><code>delay</code></a> and <a href="http://httpbin.org/drip?numbytes=5&amp;duration=5&amp;code=200"><code>drip</code></a>
  endpoints are especially useful for testing weird edge conditions.</li>
<li><a href="https://github.com/gabrielfalcao/HTTPretty">HTTPretty</a> is a mocking library
  that can make cranking out unit tests for all these errors relatively simple.</li>
</ul>
<h2>Wrapping it all up</h2>
<p>Wow, there are a lot of ways HTTP requests can fail. TLDR, when making a request:</p>
<ul>
<li>Account for DNS lookup failures</li>
<li>Set a connection and read timeout</li>
<li>Be sure to handle HTTP errors</li>
<li>Check that the response has the content type you expect</li>
<li>Limit the maximum response size</li>
<li>Ensure that private URLs are not requestable</li>
<li>Always. Be. SSLing.</li>
</ul>
<p><strong>Now it's your turn!</strong></p>
<p>Go forth and write fault tolerant services that request data using HTTP!</p>
<blockquote>
<p>Did we miss anything? Let us know in the comments below.</p>
</blockquote></div>
        </div></body></html>