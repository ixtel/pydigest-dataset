<html><body><div><div class="post-text" itemprop="text">

<h1>Environment</h1>

<ul>
<li>Mac OSX El Capitan</li>
<li>Chrome Version 48.0.2564.97 (64-bit) </li>
</ul>

<h1>Goal</h1>

<p>Trying to embed a <strong>WebRTC</strong> session in my <strong>Flask</strong> application. </p>

<p>Added the following in my HTML</p>

<pre><code>&lt;iframe src="https://appear.in/my_webrtc_session" width="400" height="320" frameborder="1"&gt;&lt;/iframe&gt;
</code></pre>

<h1>Issue</h1>

<p>When I open <code>https://appear.in/my_webrtc_session</code> in my browser, I am getting the video and audio as expected, but when embedding it in the my Flask app, NO video, BUT the Audio works!</p>

<p>If I create an HTML with the same code on my computer and open directly in the browser without serving it via Flask, then my session opens the webcam video stream correctly. </p>

<p>Any pointers?</p>

<code>__init__.py</code>

<pre><code>    sio = socketio.Server()
    app = Flask(__name__)

    @app.route('/')
    def index():
        """Serve the client-side application."""
        return render_template('index.html')

    if __name__ == "__main__"
       app = socketio.Middleware(_sio, _app)
       eventlet.wsgi.server(eventlet.listen(('', 7000)), app)
</code></pre>

<h3>No video stream when served via Flask</h3>

<p><a href="http://i.stack.imgur.com/QIUK4.jpg" rel="nofollow"><img src="http://i.stack.imgur.com/QIUK4.jpg" alt="enter image description here"/></a></p>

<h3>What I expected</h3>

<p><a href="http://i.stack.imgur.com/UrRFK.jpg" rel="nofollow"><img src="http://i.stack.imgur.com/UrRFK.jpg" alt="enter image description here"/></a></p>

<p><a href="http://i.stack.imgur.com/Abr8M.jpg" rel="nofollow"><img src="http://i.stack.imgur.com/Abr8M.jpg" alt="enter image description here"/></a></p>

<h2><code>getUserMedia() no longer works on insecure origins</code> issue fixed BUT still NO VIDEO STREAM</h2>

<h3>Message in the Chrome console</h3>

<pre><code>This appears to be Chrome
libs.23ea13d0.js:2 ScreenShareAction: check-extension message: undefined
libs.23ea13d0.js:7 chrome: {"audio":{"optional":[{"sourceId":"default"}]},"video":{"optional":[{"sourceId":"default"},{"minWidth":640},{"maxWidth":640},{"minHeight":480},{"maxHeight":480},{"minMaxFrameRate":25},{"maxMaxFrameRate":25}]}}
libs.23ea13d0.js:8 getUserMedia() no longer works on insecure origins. To use this feature, you should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details.
libs.23ea13d0.js:7 chrome: {"audio":{"optional":[{"sourceId":"default"}]}}
libs.23ea13d0.js:7 chrome: {"video":true}
libs.23ea13d0.js:2 Enabling getstats.io for mysession.
libs.23ea13d0.js:2 ChromeNotifierAction: check-extension message: undefined
libs.23ea13d0.js:2 ReferenceError: cxApi is not defined
    at Object.&lt;anonymous&gt; (libs.23ea13d0.js:22)
    at Object.invoke (libs.23ea13d0.js:1)
    at Object.$get (libs.23ea13d0.js:1)
    at Object.invoke (libs.23ea13d0.js:1)
    at libs.23ea13d0.js:1
    at d (libs.23ea13d0.js:1)
    at e (libs.23ea13d0.js:1)
    at Object.invoke (libs.23ea13d0.js:1)
    at Object.$get (libs.23ea13d0.js:1)
    at Object.invoke (libs.23ea13d0.js:1)
libs.23ea13d0.js:2 Chose version -3
libs.23ea13d0.js:2 Loaded flags: {"group":"testimonials","flags":{"testimonials":true}}
libs.23ea13d0.js:2 ChromeNotifierAction: device-credentials message: Object
libs.23ea13d0.js:7 chrome: {"audio":{"optional":[{"sourceId":"default"}]},"video":{"optional":[{"sourceId":"default"},{"minWidth":640},{"maxWidth":640},{"minHeight":480},{"maxHeight":480},{"minMaxFrameRate":25},{"maxMaxFrameRate":25}]}}
libs.23ea13d0.js:2 ChromeNotifierAction: device-credentials message: ObjectdeviceCredentials: Object__proto__: Object
libs.23ea13d0.js:7 chrome: {"audio":{"optional":[{"sourceId":"default"}]}}
libs.23ea13d0.js:7 chrome: {"video":true}
libs.23ea13d0.js:2 Enabling getstats.io for mysession.
qb57:15 'Performance.webkitClearResourceTimings' is deprecated. Please use 'Performance.clearResourceTimings' instead.
</code></pre>

<p><a href="http://i.stack.imgur.com/6UT1o.jpg" rel="nofollow"><img src="http://i.stack.imgur.com/6UT1o.jpg" alt="enter image description here"/></a></p>

<h3>Secure origin</h3>

<blockquote>
  <p>NOTE: Addresses partly my issue, I still don't get the video stream, BUT <code>getUserMedia()</code> issue was removed.</p>
</blockquote>

<p>Created self signed certificates following <a href="http://www.akadia.com/services/ssh_test_certificate.html" rel="nofollow">these instruction</a></p>

<p>And changed my code as follow:</p>

<pre><code>    eventlet.wsgi.server(eventlet.wrap_ssl(eventlet.listen(('', 7000)),
                                       certfile='server.crt',
                                       keyfile='server.key',
                                       server_side=True), app)
</code></pre>

<p>Cf. <a href="http://eventlet.net/doc/modules/wsgi.html" rel="nofollow">wsgi evenlet doc</a></p>

<p>This removed the <code>getUserMedia() no longer works on insecure origins.</code> issue and the camera LED on my Mac lights up. <strong>BUT</strong> I still don't have a video stream.</p>
    </div>
    </div></body></html>