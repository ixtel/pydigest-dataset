<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_api_live_example.gif"><img class="aligncenter wp-image-2310" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_api_live_example.gif" alt="face_api_live_example"/></a></p>
<p>So you’ve just built your first awesome computer vision app.</p>
<p>Maybe it can detect faces in images. Or maybe your app can recognize prescription pills in photos. Or maybe your computer vision app can identify the covers of top selling books, all while displaying the latest reader reviews and the cheapest websites online to purchase them.</p>
<p>So the big question is…<em><strong>how do you wrap your computer vision app in an easy to use web API?</strong></em></p>
<p>With more and more services heading to the cloud, your users, customers, and fellow developers are likely expecting an easy to consume web API (and probably in JSON format).</p>
<p>Creating a computer vision web API is actually not as hard as you think — I’ll go as far as to say it’s <em>unbelievably easy</em> to wrap your application in a consumable API using a Python web framework such as <a href="https://www.djangoproject.com/" target="_blank">Django</a> or <a href="http://flask.pocoo.org/" target="_blank">Flask</a>.</p>
<p>Personally, I’m a big fan of Django. I’ve done a <em>ton</em> of work with Django in the past and loved every minute of it. And while it’s a bit of overkill for a small example project like this (especially when compared to a micro-framework such as Flask),  I still think it’s an excellent choice. And of course, feel free to port this implementation into whichever framework best fits your own personal needs and preferences.</p>
<p>Anyway, in the rest of this tutorial I’ll be demonstrating how to create your own <strong>face detection API</strong> in <strong><em>only</em></strong> <strong><em>5 minutes!</em></strong></p>
<p>And as a bonus at the end of this article, I’ll give you a sneak peak of what’s on deck for next week — the unveiling of the (free) PyImageSearch web API.</p>
<p>Set your timers — Ready. Set. <em>Go!</em></p>

<p><strong>OpenCV and Python versions:</strong><br/>
In order to run this example, you’ll need <strong>Python 2.7</strong> and <strong>OpenCV 2.4.X</strong>.</p>
<h1>Creating a face detection API with Python and OpenCV (in just 5 minutes)</h1>
<p>After getting a ton of awesome reader feedback on the step-by-step tutorial on <a href="http://www.pyimagesearch.com/2015/02/23/install-opencv-and-python-on-your-raspberry-pi-2-and-b/" target="_blank">installing OpenCV on your Raspberry Pi 2/B+</a>, I decided to take the same approach to this tutorial — I’ve created 8 simple, bite size steps to get your own face detection API up and running.</p>
<p><strong>The goal here is that if you were to run the commands presented at each of the steps below, along with copy-and-paste the code snippets into the appropriate Django project files, that your face detection API would be up and running on your local system within 5 minutes.</strong></p>
<p>However, I am going to start by assuming that you have <a href="http://opencv.org" target="_blank">OpenCV</a> setup and installed. If not, then you’re going to need to install it prior to proceeding (and that’s going to break the 5 minute goal of this post).</p>
<p><em><strong>Disclaimer:</strong> Before finishing my PhD, I used to do </em>a lot<em> of web application development. But over the past 3 years my focus has been entirely on the computer vision, scientific, and research side of things. If my Django code is not perfect, I’ll be the first to apologize. </em><em>However, also realize that the intention of this tutorial is not to build a “bulletproof” API using all the latest Django bells and whistles. Instead, it’s meant to be a simple and concise demonstration on how you can take a computer vision application (specifically, a face detector) and turn into a web API with little effort.</em></p>
<h2>Step 1: Setup your environment</h2>
<p>The first step is to get our development environment setup and running. We’ll need only three required packages:</p>

		<div id="crayon-56d5c813843dc332024591" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c813843dc332024591-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-e">numpy </span><span class="crayon-e">django </span><span class="crayon-v">requests</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We need <a href="http://numpy.org" target="_blank">NumPy</a> since OpenCV represents images as multi-dimensional NumPy arrays. And technically NumPy should already be installed if you have OpenCV installed as well.</p>
<p>The 
			<span id="crayon-56d5c813843e6846107594" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">django</span></span></span>  packages obviously contains the Django web framework.</p>
<p>And we’ll also include use the <a href="http://docs.python-requests.org/en/latest/" target="_blank">requests</a> package to make interfacing with our web API much easier.</p>
<h2>Step 2: Create our Django project</h2>
<p>Now that the pre-requisites are installed, let’s setup our Django project:</p>

		<div id="crayon-56d5c813843ea991482897" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c813843ea991482897-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-o">-</span><span class="crayon-e">admin </span><span class="crayon-e">startproject </span><span class="crayon-v">cv</span><span class="crayon-sy">_</span>api</p><p class="crayon-line crayon-striped-line" id="crayon-56d5c813843ea991482897-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-r">cd</span><span class="crayon-h"> </span><span class="crayon-v">cv_api</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>These commands create a new Django project, adequately named 
			<span id="crayon-56d5c813843ed854082774" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span></span></span>.</p>
<p>The 
			<span id="crayon-56d5c813843f0874883219" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span></span></span>  directory now contains all the necessary code and configurations to run our Django project — this code has been auto-generated and includes basic database configurations, project based options, and application settings. It also includes the ability to run a built in web server for testing (which we’ll get to later in this tutorial).</p>
<p>Here’s the directory structure of our new project:</p>

		<div id="crayon-56d5c813843f3961524307" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c813843f3961524307-1"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">cv_api</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c813843f3961524307-2"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">cv_api</span></p><p class="crayon-line" id="crayon-56d5c813843f3961524307-3"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">__init__</span><span class="crayon-e">.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c813843f3961524307-4"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">settings</span><span class="crayon-e">.py</span></p><p class="crayon-line" id="crayon-56d5c813843f3961524307-5"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">urls</span><span class="crayon-e">.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c813843f3961524307-6"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">wsgi</span><span class="crayon-e">.py</span></p><p class="crayon-line" id="crayon-56d5c813843f3961524307-7"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">manage</span><span class="crayon-e">.py</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Before we proceed, let’s briefly chat about the structure of a Django project.</p>
<p>A Django project consists of multiple <em>apps</em>. And one of the core paradigms of the Django framework is that each <em>app</em> should be <em>reusable</em> in any project (theoretically, anyway) — therefore, we do not (normally) place any app-specific code inside the 
			<span id="crayon-56d5c813843f6898273930" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span></span></span>  directory. Instead, we explicitly create separate “apps” inside the 
			<span id="crayon-56d5c813843f9374596747" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span></span></span>  project.</p>
<p>With this in mind, let’s create a new app named 
			<span id="crayon-56d5c813843fc516471109" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">face_detector</span></span></span> , which will house our code for building a face detection API:</p>

		<div id="crayon-56d5c813843ff426853848" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c813843ff426853848-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-e">startapp </span><span class="crayon-v">face_detector</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Notice how we now have a 
			<span id="crayon-56d5c81384402716613777" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">face_detector</span></span></span>  directory inside our 
			<span id="crayon-56d5c81384405480166893" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span></span></span>  directory. Again, Django has auto-generated some boilerplate code and configurations for our 
			<span id="crayon-56d5c81384408184888647" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">face_detector</span></span></span>  app, which we can see the contents of below:</p>

		<div id="crayon-56d5c8138440b705998680" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c8138440b705998680-1"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">cv_api</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440b705998680-2"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">cv_api</span></p><p class="crayon-line" id="crayon-56d5c8138440b705998680-3"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440b705998680-4"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">settings</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line" id="crayon-56d5c8138440b705998680-5"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">urls</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440b705998680-6"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">wsgi</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line" id="crayon-56d5c8138440b705998680-7"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">face_detector</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440b705998680-8"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line" id="crayon-56d5c8138440b705998680-9"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">admin</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440b705998680-10"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">migrations</span></p><p class="crayon-line" id="crayon-56d5c8138440b705998680-11"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440b705998680-12"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">tests</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line" id="crayon-56d5c8138440b705998680-13"><span class="crayon-o">|</span><span class="crayon-h">        </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440b705998680-14"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Now that our Django project is all setup, we can get to coding.</p>
<h2>Step 3: My personal computer vision API template</h2>
<p>This step is where the actual “wrapping” of our computer vision project comes into place and where we are going to insert our face detection code.</p>
<p>The Django framework is a type of a <a href="https://docs.djangoproject.com/en/1.8/faq/general/#django-appears-to-be-a-mvc-framework-but-you-call-the-controller-the-view-and-the-view-the-template-how-come-you-don-t-use-the-standard-names" target="_blank">Model-View-Template</a> (MVT) framework, similar to a <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank">Model-View-Controller</a>, where a “View” can be thought of as a type of web page. Inside the View you place all the necessary code to interact with Models, such as pulling data from a database, and processing it. The View is also responsible for populating the Template before it is sent to the user.</p>
<p>In our case, all we need is the View portion of the framework. We are not going to be interacting with the database, so the Model is not relevant to us. And we are going to ship the results of our API back to the end-user as a JSON object, so we won’t need the Template to render any HTML for us.</p>
<p>Again, our API is simply going to accept an image from a URL/stream, process it, and return a JSON response.</p>
<h3>Step 3a: My personal boilerplate template when building a Python + OpenCV API</h3>
<p>Before we dive into the code to perform the actual face detection, I want to share with you my <em>personal</em> boilerplate template when building a Python + OpenCV. You can use this code as a starting point when building your own computer vision API.</p>

		<div id="crayon-56d5c8138440e536929295" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-2">2</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-4">4</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-6">6</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-8">8</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-10">10</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-12">12</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-14">14</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-16">16</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-18">18</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-20">20</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-22">22</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-24">24</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-26">26</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-28">28</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-30">30</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-32">32</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-34">34</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-36">36</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-38">38</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-40">40</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-42">42</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-44">44</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-46">46</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-48">48</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-50">50</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-52">52</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-54">54</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-56">56</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-58">58</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-60">60</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-62">62</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-63">63</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-64">64</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-65">65</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138440e536929295-66">66</p><p class="crayon-num" data-line="crayon-56d5c8138440e536929295-67">67</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c8138440e536929295-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">decorators</span><span class="crayon-sy">.</span><span class="crayon-e">csrf </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">http </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">JsonResponse</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">urllib</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">json</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-8"> </p><p class="crayon-line" id="crayon-56d5c8138440e536929295-9"><span class="crayon-sy">@</span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-10"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">detect</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-11"><span class="crayon-h">	</span><span class="crayon-c"># initialize the data dictionary to be returned by the request</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-12"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">"success"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-14"><span class="crayon-h">	</span><span class="crayon-c"># check to see if this is a post request</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-15"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">method</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"POST"</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-16"><span class="crayon-h">		</span><span class="crayon-c"># check to see if an image was uploaded</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-17"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">FILES</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-18"><span class="crayon-h">			</span><span class="crayon-c"># grab the uploaded image</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-19"><span class="crayon-h">			</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_grab_image</span><span class="crayon-sy">(</span><span class="crayon-v">stream</span><span class="crayon-o">=</span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">FILES</span><span class="crayon-sy">[</span><span class="crayon-s">"image"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-20"> </p><p class="crayon-line" id="crayon-56d5c8138440e536929295-21"><span class="crayon-h">		</span><span class="crayon-c"># otherwise, assume that a URL was passed in</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-22"><span class="crayon-h">		</span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-23"><span class="crayon-h">			</span><span class="crayon-c"># grab the URL from the request</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-24"><span class="crayon-h">			</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">POST</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"url"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-25"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-26"><span class="crayon-h">			</span><span class="crayon-c"># if the URL is None, then return an error</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-27"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">url </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-28"><span class="crayon-h">				</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-s">"error"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"No URL provided."</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-29"><span class="crayon-h">				</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">JsonResponse</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-30"> </p><p class="crayon-line" id="crayon-56d5c8138440e536929295-31"><span class="crayon-h">			</span><span class="crayon-c"># load the image and convert</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-32"><span class="crayon-h">			</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_grab_image</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-33"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-34"><span class="crayon-h">		</span><span class="crayon-c">### START WRAPPING OF COMPUTER VISION APP</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-35"><span class="crayon-h">		</span><span class="crayon-c"># Insert code here to process the image and update</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-36"><span class="crayon-h">		</span><span class="crayon-c"># the `data` dictionary with your results</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-37"><span class="crayon-h">		</span><span class="crayon-c">### END WRAPPING OF COMPUTER VISION APP</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-38"> </p><p class="crayon-line" id="crayon-56d5c8138440e536929295-39"><span class="crayon-h">		</span><span class="crayon-c"># update the data dictionary</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-40"><span class="crayon-h">		</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-s">"success"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-41"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-42"><span class="crayon-h">	</span><span class="crayon-c"># return a JSON response</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-43"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">JsonResponse</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-44"> </p><p class="crayon-line" id="crayon-56d5c8138440e536929295-45"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">_grab_image</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-o">=</span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stream</span><span class="crayon-o">=</span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-t">None</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-46"><span class="crayon-h">	</span><span class="crayon-c"># if the path is not None, then load the image from disk</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-47"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">path </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-48"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-49"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-50"><span class="crayon-h">	</span><span class="crayon-c"># otherwise, the image does not reside on disk</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-51"><span class="crayon-h">	</span><span class="crayon-st">else</span><span class="crayon-o">:</span><span class="crayon-h">	</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-52"><span class="crayon-h">		</span><span class="crayon-c"># if the URL is not None, then download the image</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-53"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">url </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-54"><span class="crayon-h">			</span><span class="crayon-v">resp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">urllib</span><span class="crayon-sy">.</span><span class="crayon-e">urlopen</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-55"><span class="crayon-h">			</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">resp</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-56"> </p><p class="crayon-line" id="crayon-56d5c8138440e536929295-57"><span class="crayon-h">		</span><span class="crayon-c"># if the stream is not None, then the image has been uploaded</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-58"><span class="crayon-h">		</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-e">stream </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-59"><span class="crayon-h">			</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">stream</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-60"> </p><p class="crayon-line" id="crayon-56d5c8138440e536929295-61"><span class="crayon-h">		</span><span class="crayon-c"># convert the image to a NumPy array and then read it into</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-62"><span class="crayon-h">		</span><span class="crayon-c"># OpenCV format</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-63"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-k ">bytearray</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">"uint8"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-64"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imdecode</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">IMREAD_COLOR</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-65"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138440e536929295-66"><span class="crayon-h">	</span><span class="crayon-c"># return the image</span></p><p class="crayon-line" id="crayon-56d5c8138440e536929295-67"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">image</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This boilerplate API code defines two functions: 
			<span id="crayon-56d5c81384412080963944" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect</span></span></span> , which is our actual view, and 
			<span id="crayon-56d5c81384416051860268" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">_grab_image</span></span></span> , which is a nice little convenience function to read an image from disk, URL, or stream into OpenCV format. From a code organization and reusability perspective, you probably want to put the *_grab_image* function in a “utilities” module that is globally accessible throughout the Django project. But as a manner of completeness, I have included the 
			<span id="crayon-56d5c81384419497462305" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">_grab_image</span></span></span>  function inside the 
			<span id="crayon-56d5c8138441c123334853" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  file — I’ll leave it as a personal decision as to where you want to store this function.</p>
<p>Most of our time should be spent examining the 
			<span id="crayon-56d5c8138441e394657271" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect</span></span></span>  method. In reality, you could call this method whatever you want, but you probably want to make the name relevant to the goal the function is accomplishing. In the context of face detection, naming the main API endpoint as 
			<span id="crayon-56d5c81384421882906778" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect</span></span></span>  in the 
			<span id="crayon-56d5c81384424566238219" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">face_detection</span></span></span>  Django app seems fitting.</p>
<p>The 
			<span id="crayon-56d5c81384427698151797" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect</span></span></span>  method accepts a single parameter, a 
			<span id="crayon-56d5c8138442a578055626" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">request</span></span></span> , which is a Django object containing properties germane to the web request.</p>
<p>Inside the actual view, I like to define a 
			<span id="crayon-56d5c8138442d558157434" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">data</span></span></span>  dictionary. This dictionary represents all data that will be JSON-ified and shipped back to the user. At a <em>bare minimum</em> this dictionary should include a success/failure flag.</p>
<p>From there, we need to process the actual 
			<span id="crayon-56d5c81384430946274727" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">request</span></span></span>  and determine how the image was sent to our API.</p>
<p>If our image was uploaded via multi-part form data, we can simply process the data stream directly and read it into OpenCV format (<strong>Lines 17-19</strong>).</p>
<p>Otherwise, we’ll assume that instead of the raw image being uploaded, a URL pointing to an image was passed into our API. In that case, we’ll read the image from the URL and into OpenCV format (<strong>Lines 22-32</strong>).</p>
<p><strong>Lines 34-37</strong> is where you would actually “wrap” your computer vision app. Here you would insert any code related to processing, manipulating, classifying, etc. of your image. You’ll also want to update your 
			<span id="crayon-56d5c81384433504565143" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">data</span></span></span>  dictionary with any relevant information related to the results of processing your image.</p>
<p>Finally, after all the image processing is done, we send a JSON response of the 
			<span id="crayon-56d5c81384436712282267" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">data</span></span></span>  back to the user on <strong>Line 43</strong>.</p>
<h2>Step 4: Inserting the face detector into my template API</h2>
<p>Now that we have examined the boilerplate code for a Python + OpenCV web API, let’s take it and insert the face detector. Open up the 
			<span id="crayon-56d5c81384439560345563" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span><span class="crayon-o">/</span><span class="crayon-v">face_detector</span><span class="crayon-o">/</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  file and insert the following code:</p>

		<div id="crayon-56d5c8138443c871363672" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-2">2</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-4">4</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-6">6</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-8">8</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-10">10</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-12">12</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-14">14</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-16">16</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-18">18</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-20">20</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-22">22</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-24">24</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-26">26</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-28">28</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-30">30</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-32">32</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-34">34</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-36">36</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-38">38</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-40">40</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-42">42</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-44">44</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-46">46</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-48">48</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-50">50</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-52">52</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-54">54</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-56">56</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-58">58</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-60">60</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-62">62</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-63">63</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-64">64</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-65">65</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-66">66</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-67">67</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-68">68</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-69">69</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-70">70</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-71">71</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-72">72</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-73">73</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-74">74</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-75">75</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c8138443c871363672-76">76</p><p class="crayon-num" data-line="crayon-56d5c8138443c871363672-77">77</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c8138443c871363672-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">decorators</span><span class="crayon-sy">.</span><span class="crayon-e">csrf </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">http </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">JsonResponse</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">urllib</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">json</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-8"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-10"><span class="crayon-c"># define the path to the face detector</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-11"><span class="crayon-v">FACE_DETECTOR_PATH</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"{base_path}/cascades/haarcascade_frontalface_default.xml"</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-12"><span class="crayon-h">	</span><span class="crayon-v">base_path</span><span class="crayon-o">=</span><span class="crayon-k ">os.path</span><span class="crayon-sy">.</span><span class="crayon-e">abspath</span><span class="crayon-sy">(</span><span class="crayon-k ">os.path</span><span class="crayon-sy">.</span><span class="crayon-e">dirname</span><span class="crayon-sy">(</span><span class="crayon-v">__file__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-14"><span class="crayon-sy">@</span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-15"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">detect</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-16"><span class="crayon-h">	</span><span class="crayon-c"># initialize the data dictionary to be returned by the request</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-17"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">"success"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-18"> </p><p class="crayon-line" id="crayon-56d5c8138443c871363672-19"><span class="crayon-h">	</span><span class="crayon-c"># check to see if this is a post request</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-20"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">method</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"POST"</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-21"><span class="crayon-h">		</span><span class="crayon-c"># check to see if an image was uploaded</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-22"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">FILES</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-23"><span class="crayon-h">			</span><span class="crayon-c"># grab the uploaded image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-24"><span class="crayon-h">			</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_grab_image</span><span class="crayon-sy">(</span><span class="crayon-v">stream</span><span class="crayon-o">=</span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">FILES</span><span class="crayon-sy">[</span><span class="crayon-s">"image"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-25"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-26"><span class="crayon-h">		</span><span class="crayon-c"># otherwise, assume that a URL was passed in</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-27"><span class="crayon-h">		</span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-28"><span class="crayon-h">			</span><span class="crayon-c"># grab the URL from the request</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-29"><span class="crayon-h">			</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">POST</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"url"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-30"> </p><p class="crayon-line" id="crayon-56d5c8138443c871363672-31"><span class="crayon-h">			</span><span class="crayon-c"># if the URL is None, then return an error</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-32"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">url </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-33"><span class="crayon-h">				</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-s">"error"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"No URL provided."</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-34"><span class="crayon-h">				</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">JsonResponse</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-35"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-36"><span class="crayon-h">			</span><span class="crayon-c"># load the image and convert</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-37"><span class="crayon-h">			</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_grab_image</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-38"> </p><p class="crayon-line" id="crayon-56d5c8138443c871363672-39"><span class="crayon-h">		</span><span class="crayon-c"># convert the image to grayscale, load the face cascade detector,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-40"><span class="crayon-h">		</span><span class="crayon-c"># and detect faces in the image</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-41"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-42"><span class="crayon-h">		</span><span class="crayon-v">detector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">CascadeClassifier</span><span class="crayon-sy">(</span><span class="crayon-v">FACE_DETECTOR_PATH</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-43"><span class="crayon-h">		</span><span class="crayon-v">rects</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">detector</span><span class="crayon-sy">.</span><span class="crayon-e">detectMultiScale</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaleFactor</span><span class="crayon-o">=</span><span class="crayon-cn">1.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">minNeighbors</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-44"><span class="crayon-h">			</span><span class="crayon-v">minSize</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-o">=</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">cv</span><span class="crayon-sy">.</span><span class="crayon-v">CV_HAAR_SCALE_IMAGE</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-45"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-46"><span class="crayon-h">		</span><span class="crayon-c"># construct a list of bounding boxes from the detection</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-47"><span class="crayon-h">		</span><span class="crayon-v">rects</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rects</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-48"> </p><p class="crayon-line" id="crayon-56d5c8138443c871363672-49"><span class="crayon-h">		</span><span class="crayon-c"># update the data dictionary with the faces detected</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-50"><span class="crayon-h">		</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-s">"num_faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">rects</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">rects</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"success"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-51"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-52"><span class="crayon-h">	</span><span class="crayon-c"># return a JSON response</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-53"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">JsonResponse</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-54"> </p><p class="crayon-line" id="crayon-56d5c8138443c871363672-55"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">_grab_image</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-o">=</span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stream</span><span class="crayon-o">=</span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-t">None</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-56"><span class="crayon-h">	</span><span class="crayon-c"># if the path is not None, then load the image from disk</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-57"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">path </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-58"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-59"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-60"><span class="crayon-h">	</span><span class="crayon-c"># otherwise, the image does not reside on disk</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-61"><span class="crayon-h">	</span><span class="crayon-st">else</span><span class="crayon-o">:</span><span class="crayon-h">	</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-62"><span class="crayon-h">		</span><span class="crayon-c"># if the URL is not None, then download the image</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-63"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">url </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-64"><span class="crayon-h">			</span><span class="crayon-v">resp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">urllib</span><span class="crayon-sy">.</span><span class="crayon-e">urlopen</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-65"><span class="crayon-h">			</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">resp</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-66"> </p><p class="crayon-line" id="crayon-56d5c8138443c871363672-67"><span class="crayon-h">		</span><span class="crayon-c"># if the stream is not None, then the image has been uploaded</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-68"><span class="crayon-h">		</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-e">stream </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-69"><span class="crayon-h">			</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">stream</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-70"> </p><p class="crayon-line" id="crayon-56d5c8138443c871363672-71"><span class="crayon-h">		</span><span class="crayon-c"># convert the image to a NumPy array and then read it into</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-72"><span class="crayon-h">		</span><span class="crayon-c"># OpenCV format</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-73"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-k ">bytearray</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">"uint8"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-74"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imdecode</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">IMREAD_COLOR</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-75"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138443c871363672-76"><span class="crayon-h">	</span><span class="crayon-c"># return the image</span></p><p class="crayon-line" id="crayon-56d5c8138443c871363672-77"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">image</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>As you can see, we haven’t inserted much code beyond the standard boilerplate OpenCV API template.</p>
<p>The first thing you’ll notice is that I’m defining the 
			<span id="crayon-56d5c81384440146532279" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">FACE_DETECTOR_PATH</span></span></span>  (<strong>Lines 11 and 12</strong>), which is simply the path to where the pre-trained OpenCV face detector lives — in this case, I’ve included the pre-trained face detector inside the 
			<span id="crayon-56d5c81384443442955814" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">face_detector</span><span class="crayon-o">/</span><span class="crayon-v">cascades</span></span></span>  application.</p>
<p>The real face detection magic takes place on <strong>Lines 41-44</strong>.</p>
<p>Now that we have our image in OpenCV format (whether it was uploaded via multi-part form encoded data or via URL), we start by converting our input image to grayscale. We discard any color information since color add little to face detection accuracy.</p>
<p>From there we load our face 
			<span id="crayon-56d5c81384446587294395" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detector</span></span></span>  on <strong>Line 42</strong>, supplying the path to our pre-trained face detector. Now that our face detector is loaded, we can apply the 
			<span id="crayon-56d5c81384449783939222" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detectMultiScale</span></span></span>  method and detect the actual faces.</p>
<p>I’m not going to perform an exhaustive review of the parameters to 
			<span id="crayon-56d5c8138444c359252834" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detectMultiScale</span></span></span>  since I cover them in-depth inside my book, <em><a href="http://www.pyimagesearch.com/practical-python-opencv/?src=sidebar-face-detection" target="_blank">Practical Python and OpenCV + Case Studies</a>, </em>but the important takeaway here is that these parameters influence the speed, efficiency, and the false-positive detection rate of faces in images.</p>
<p>The 
			<span id="crayon-56d5c8138444f266994518" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detectMultiScale</span></span></span>  function returns a list of bounding boxes, or simply the <em>(x, y)</em>-coordinates, and width and height, of the faces in the image. Given this list of bounding boxes, we package them into our 
			<span id="crayon-56d5c81384452011851965" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">data</span></span></span>  dictionary and ship them back to the user on <strong>Lines 47-53</strong>.</p>
<p>Not too bad, right?</p>
<p>As you can see, the majority of the code is still related the computer vision API boilerplate — the actual detection of the faces took only a few lines of code.</p>
<h2>Step 5: Update the URLs to include an endpoint to our API</h2>
<p>But before we can access our face detection API, we first need to update the project URLs to include our face detection endpoint.</p>
<p>Simply open up the 
			<span id="crayon-56d5c81384455476303783" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span><span class="crayon-o">/</span><span class="crayon-v">cv_api</span><span class="crayon-o">/</span><span class="crayon-v">urls</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  file, and update it to include a URL endpoint to our face detection view:</p>

		<div id="crayon-56d5c81384458988670544" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c81384458988670544-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">conf</span><span class="crayon-sy">.</span><span class="crayon-e">urls </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">include</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">url</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384458988670544-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">contrib </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">admin</span></p><p class="crayon-line" id="crayon-56d5c81384458988670544-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384458988670544-4"><span class="crayon-v">urlpatterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">patterns</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c81384458988670544-5"><span class="crayon-h">    </span><span class="crayon-c"># Examples:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384458988670544-6"> </p><p class="crayon-line" id="crayon-56d5c81384458988670544-7"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^face_detection/detect/$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'face_detector.views.detect'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384458988670544-8"> </p><p class="crayon-line" id="crayon-56d5c81384458988670544-9"><span class="crayon-h">    </span><span class="crayon-c"># url(r'^$', 'cv_api.views.home', name='home'),</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384458988670544-10"><span class="crayon-h">    </span><span class="crayon-c"># url(r'^blog/', include('blog.urls')),</span></p><p class="crayon-line" id="crayon-56d5c81384458988670544-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384458988670544-12"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^admin/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-v">admin</span><span class="crayon-sy">.</span><span class="crayon-k ">site</span><span class="crayon-sy">.</span><span class="crayon-v">urls</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c81384458988670544-13"><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h2>Step 6: Run the Django test server</h2>
<p>Alright, now we’re ready to test out our face detection API!</p>
<p>Simply use your terminal to navigate back to the 
			<span id="crayon-56d5c8138445b575852101" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv_api</span></span></span> project root and fire up the test server:</p>

		<div id="crayon-56d5c8138445e542865065" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c8138445e542865065-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-v">runserver</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Our web server is now available at 
			<span id="crayon-56d5c81384461025733121" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//localhost:8000</span></span></span></p>
<p>And if you open up your web browser and point it to 
			<span id="crayon-56d5c81384464999609585" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//localhost:8000/face_detection/detect/</span></span></span>  you should see the JSON response from our face detection API:</p>
<div id="attachment_2298" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_api_browser.jpg"><img class="wp-image-2298" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_api_browser.jpg" alt="Figure 1: Navigating our browser to the face detection API endpoint." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_api_browser-300x172.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_api_browser-1024x587.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_api_browser.jpg 1200w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Navigating our browser to the face detection API endpoint.</p></div>
<p>Obviously, since we have not uploaded an image to our API, we are getting a JSON response of 
			<span id="crayon-56d5c81384467810127750" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-sy">{</span><span class="crayon-v">success</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">}</span></span></span> , implying that a face could not be detected in the (non-existent) image.</p>
<h2>Step 7: Test out the face detection API via cURL</h2>
<p>Before we do anything too crazy, let’s test out our face detection using cURL. We’ll start by passing the URL of this image (<a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg" target="_blank">http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg</a>) of Barack Obama into our face detection API:</p>
<div id="attachment_2295" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg"><img class="wp-image-2295" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg" alt="obama" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama-300x169.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg 768w" sizes="(max-width: 400px) 100vw, 400px"/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Passing the URL of this Barack Obama image into our face detector API.</p></div>
<p>Let’s construct the command to interact with our face detection API via cURL:</p>

		<div id="crayon-56d5c8138446b757605435" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c8138446b757605435-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">curl</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">X</span><span class="crayon-h"> </span><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-s">'http://localhost:8000/face_detection/detect/'</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-s">'url=http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg'</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-s">""</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138446b757605435-2"><span class="crayon-sy">{</span><span class="crayon-s">"num_faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"success"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">410</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">591</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">281</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>And sure enough, based on the output we were able to detect Obama’s face (although we can’t yet visualize the bounding box, we’ll do that in the following section).</p>
<p>Let’s try another image, this time uploading via <em>file</em> instead of <em>URL</em>:</p>
<div id="attachment_2299" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/adrian.jpg"><img class="wp-image-2299" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/adrian.jpg" alt="Figure 3: A picture of myself outside Horseshoe Bend, AZ. Will the face detector API be able to detect my face in the image?"/></a><p class="wp-caption-text"><strong>Figure 3:</strong> A picture of myself outside Horseshoe Bend, AZ. Will the face detector API be able to detect my face in the image?</p></div>
<p>Again, we’ll need to construct our cURL command, assuming that the name of the above file is 
			<span id="crayon-56d5c8138446e512091146" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">adrian</span><span class="crayon-sy">.</span><span class="crayon-v">jpg</span></span></span> :</p>

		<div id="crayon-56d5c81384471806177878" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c81384471806177878-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">curl</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">X</span><span class="crayon-h"> </span><span class="crayon-v">POST</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">F</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-o">=</span><span class="crayon-sy">@</span><span class="crayon-v">adrian</span><span class="crayon-e">.jpg</span><span class="crayon-h"> </span><span class="crayon-s">'http://localhost:8000/face_detection/detect/'</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-s">""</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384471806177878-2"><span class="crayon-sy">{</span><span class="crayon-s">"num_faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"success"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">180</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">114</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">222</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">156</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>And based on the JSON response we were indeed about to detect the face in the image.</p>
<h2>Step 8: Write some Python code to interact with the face detection API</h2>
<p>Using cURL to test out our face detection API was simple enough — but let’s write some actual Python code that can <em>upload</em> and <em>interact</em> with images sent to our API. This way we can actually <em>ingest the JSON response</em> and <em>draw the bounding boxes</em> surrounding the faces in the images.</p>
<p>Open up a new file, name it 
			<span id="crayon-56d5c81384475182722161" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">test_api</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and include the following code:</p>

		<div id="crayon-56d5c81384478810797765" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5c81384478810797765-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-2">2</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-4">4</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-6">6</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-8">8</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-10">10</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-12">12</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-14">14</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-16">16</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-18">18</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-20">20</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-22">22</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-24">24</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-26">26</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-28">28</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-30">30</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-32">32</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c81384478810797765-34">34</p><p class="crayon-num" data-line="crayon-56d5c81384478810797765-35">35</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c81384478810797765-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">requests</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-4"> </p><p class="crayon-line" id="crayon-56d5c81384478810797765-5"><span class="crayon-c"># define the URL to our face detection API</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-6"><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"http://localhost:8000/face_detection/detect/"</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-8"><span class="crayon-c"># use our face detection API to find faces in images via image URL</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-9"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-s">"obama.jpg"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-10"><span class="crayon-v">payload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">"url"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg"</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-11"><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-o">=</span><span class="crayon-v">payload</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-12"><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-s">"obama.jpg: {}"</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-14"><span class="crayon-c"># loop over the faces and draw them on the image</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-15"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">startX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">startY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endY</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-s">"faces"</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-16"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">rectangle</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">startX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">startY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">endX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-17"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-18"><span class="crayon-c"># show the output image</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-19"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"obama.jpg"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-20"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-21"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-22"><span class="crayon-c"># load our image and now use the face detection API to find faces in</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-23"><span class="crayon-c"># images by uploading an image directly</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-24"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-s">"adrian.jpg"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-25"><span class="crayon-v">payload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">"image"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">"adrian.jpg"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"rb"</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-26"><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">files</span><span class="crayon-o">=</span><span class="crayon-v">payload</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-27"><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-s">"adrian.jpg: {}"</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-28"> </p><p class="crayon-line" id="crayon-56d5c81384478810797765-29"><span class="crayon-c"># loop over the faces and draw them on the image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-30"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">startX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">startY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endY</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">[</span><span class="crayon-s">"faces"</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-31"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">rectangle</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">startX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">startY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">endX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-32"> </p><p class="crayon-line" id="crayon-56d5c81384478810797765-33"><span class="crayon-c"># show the output image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c81384478810797765-34"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"adrian.jpg"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c81384478810797765-35"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We’ll start by importing the 
			<span id="crayon-56d5c8138447b512611435" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">requests</span></span></span>  package to handle sending and receiving data from our API. We’ll also import 
			<span id="crayon-56d5c8138447e718419219" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span></span></span>  for our OpenCV bindings.</p>
<p>From there, <strong>Lines 6-20</strong> handle uploading an image <em>via URL</em><strong> </strong>to our face detection API.</p>
<p>All we need to do is define a 
			<span id="crayon-56d5c81384481054692768" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">payload</span></span></span>  dictionary that contains a 
			<span id="crayon-56d5c81384484605838919" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">url</span></span></span>  key, with the corresponding value being our image URL of Barack Obama above. We then ship this payload dictionary to the face detection endpoint (<strong>Lines 6-11</strong>), where our API responds with the number of faces detected in the image, along with the bounding boxes of the faces. Finally, we take the bounding boxes and draw them on the actual image (<strong>Lines 15-20</strong>).</p>
<p>We’ll also upload an image from disk to our face detection API on <strong>Lines 24-35</strong>. Just like uploading an image via URL, uploading from an image from disk is just as simple — we just need to specify the 
			<span id="crayon-56d5c81384487053743186" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">files</span></span></span>  parameter rather than the 
			<span id="crayon-56d5c8138448a186421689" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">data</span></span></span>  parameter when making a call to 
			<span id="crayon-56d5c8138448d259982579" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-v">post</span></span></span> .</p>
<p>To see our script in action, just execute the following command:</p>

		

<p>First, we’ll see the image of the bounding box drawn around Obama’s face:</p>
<div id="attachment_2300" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_obama.jpg"><img class="wp-image-2300" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_obama.jpg" alt="Figure 4: Taking the JSON response from our face detection API and drawing the bounding box around Obama's face." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_obama-300x205.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_obama-1024x698.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_obama.jpg 1200w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 4:</strong> Taking the JSON response from our face detection API and drawing the bounding box around Obama’s face.</p></div>
<p>Followed by the successful detection and bounding box around my face:</p>
<div id="attachment_2301" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_adrian.jpg"><img class="wp-image-2301" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_adrian.jpg" alt="Figure 5: Uploading an image from disk to our face detection API -- once again, we are able to detect the face and draw the bounding box surrounding it." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_adrian-300x267.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_adrian-1024x910.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/face_detection_requests_adrian.jpg 1200w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 5:</strong> Uploading an image from disk to our face detection API — once again, we are able to detect the face and draw the bounding box surrounding it.</p></div>
<p>Clearly our face detection API is working! And we were able to utilize it via both image file upload and image URL.</p>
<h1>Faces aren’t being detected in my images. What gives?</h1>
<p>If you downloaded the code to this post and gave it a try with your own images, you might have run into circumstances where faces were not detected in your images — <em>even though the faces were clearly visible.</em></p>
<p><strong>So what gives?</strong></p>
<p>While Haar cascades are quite fast and can obtain decent accuracy, they have two prominent shortcomings.</p>
<p>The first is parameter tuning — you’ll need to tweak the parameters of 
			<span id="crayon-56d5c81384494616976491" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detectMultiScale</span></span></span>  to get the detection <em>just right</em> for many images. It can be a real pain, especially if you are looking to process many images in bulk and can’t visually inspect the output of each face detection.</p>
<p>The second shortcoming of Haar cascades is that they can be highly prone to <em>false positives</em>, meaning that faces are detected when there really aren’t any faces there! Again, this problem can be fixed by tuning the parameters of 
			<span id="crayon-56d5c81384497354532457" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detectMultiScale</span></span></span>  on a case-by-case basis.</p>
<p>In reality, Haar cascades and the Viola-Jones detector, while effective, have ran their course in computer vision history. For highly accurate object detectors we now rely on <a href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">HOG + Linear SVMs</a> and deep learning based methods, especially Convolutional Neural Networks.</p>
<p>That all said, it’s hard to beat the pure speed of Haar cascades, even if their accuracy and false-positive rate is a bit sub-par, at least compared to today’s state-of-the-art techniques.</p>
<h1>Bonus: A live example of the face detection API</h1>
<p>Want to give the face detection API a try? No problem.</p>
<p>I already have a face detection API instance spun up and running. You can find the face detection API endpoint here:</p>
<p>
			<span id="crayon-56d5c8138449b381363765" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//api.pyimagesearch.com/face_detection/detect/</span></span></span></p>
<p>And here’s another cURL example of detecting faces in an image to get you started. Only this time we are using the live API endpoint:</p>

		<div id="crayon-56d5c8138449e873174106" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c8138449e873174106-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">curl</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">X</span><span class="crayon-h"> </span><span class="crayon-i">POST</span><span class="crayon-h"> </span><span class="crayon-s">'http://api.pyimagesearch.com/face_detection/detect/'</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-s">'url=http://www.pyimagesearch.com/wp-content/uploads/2015/05/obama.jpg'</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-s">""</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c8138449e873174106-2"><span class="crayon-sy">{</span><span class="crayon-s">"num_faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"success"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"faces"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">410</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">591</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">281</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>So given the URL <a href="http://api.pyimagesearch.com" target="_blank">http://api.pyimagesearch.com</a>, I bet you can guess what next week’s announcement is…but I’ll leave the rest until next Monday.</p>
<h1>Summary</h1>
<p>In this blog post we learned how to wrap our computer vision applications into an easy to use and consume, JSON web API. We utilized the Django web framework to build our API, but we could use any other Python web framework such as Flask — it really depends on your personal preference and how simple or advanced you want your API to be.</p>
<p>I also shared <em>my personal boilerplate API code</em> that you can use to wrap your own computer vision applications and make them web-ready.</p>
<p>Finally, I gave a sneak preview of next week’s big announcement — <em>the (free) PyImageSearch API.</em></p>
<h1>So, what’s next?</h1>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/02/practicalpythonandopencv_cover.png"><img class="alignleft wp-image-307" src="http://www.pyimagesearch.com/wp-content/uploads/2014/02/practicalpythonandopencv_cover.png" alt="practicalpythonandopencv_cover"/></a></p>
<p>If you enjoyed this blog post and want to learn more about computer vision and OpenCV, I would definitely recommend taking a look at my book, <em><a href="http://www.pyimagesearch.com/practical-python-opencv/?src=sidebar-face-detection" target="_blank">Practical Python and OpenCV + Case Studies</a></em>.</p>
<p>Inside my book you’ll continue to learn all about <strong>face detection</strong> (including an explanation of the 
			<span id="crayon-56d5c813844a1574913388" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detectMultiScale</span></span></span>  parameters I mentioned earlier in this post) in both images and video, <strong>tracking objects in video</strong>, <strong>recognizing handwritten digits</strong>, and even how to <strong>identify book covers in a snap of your smartphone</strong>.</p>
<p>If these topics sound interesting to you, <em><strong><a href="http://www.pyimagesearch.com/practical-python-opencv/?src=sidebar-face-detection" target="_blank">definitely take a look</a> </strong></em>and consider grabbing a free sample chapter.</p>
<h1 id="post_downloads">Downloads:</h1>

	</section>
	</div></body></html>