<html><body><div><div class="content html_format">
      <h3>Введение</h3><p>
Python, точнее его самый известный представитель CPython, не очень предназначен для каких-либо быстрых расчетов. Иначе говоря, производительность у него не такая уж </p><a href="http://benchmarksgame.alioth.debian.org/u64q/python.html">хорошая</a><p>. А вот скорость разработки и читаемости отличная.
</p><p>
О читаемости и пойдет речь, а точнее как ее увеличить.
</p><a name="habracut"/>
<h3>Проблемы форматирования</h3><p>
Идеального форматирования кода не существует. Для каждого языка стоит подстраиваться под общепринятые правила оформления кода. Да что говорить, если среди новичков С++ еще до сих пор войны по поводу ставить скобки на следующей строке или нет.</p><p>
Для python'а основными проблемами форматирования является «C стиль». Не редко в рассматриваемый язык приходят из С-подобных языков, а для них свойственно писать с символами ")(;". </p><p>
Символы не единственная проблема, есть еще и проблема избыточности написания конструкций. Питон, в отличие от Java, менее многословен и чтобы к этому привыкнуть у новичков уходит большое количество времени.</p><p>
Это две основные проблемы, которые встречаются чаще всего.

</p><h3>Стандарты и рекомендации к оформлению</h3><p>
Если для повышения скорости исполнения кода можно использовать </p><a href="http://zokis.github.io/Python--Faster-Way/">разные подходы</a><p>, хотя эти подходы очень индивидуальны, то для форматирования текста существует прям slyle guide — это pep8. Далее его буду называть «стандарт».</p><p>
Почитать про стандарт можно </p><a href="https://www.python.org/dev/peps/pep-0008/">здесь</a><p>, на русском языке можно </p><a href="http://pep8.ru/doc/pep8/">здесь</a><p>
Pep8 весьма обширный и позволяет программисту писать РЕАЛЬНО читаемый код. 
</p><p>
Он включает:
</p><ul>
<li>максимальную длину строк кода и документации</li>
<li>кодировки файлов с исходным кодом</li>
<li>рекомендации как правильно оформлять комментарии</li>
<li>соглашения именования функций/классов, аргументов</li>
<li>и многое другое</li>
</ul><p>
В целом, покрывает множество правил форматирования кода. Однако, стоит заметить, что не все python-программисты соблюдают данные правила. </p><p>
Большие компании, такие как Google, имеют свои рекомендации к написанию python-кода, их можно почитать </p><a href="http://habrahabr.ru/post/179271/">здесь</a><p> и </p><a href="http://habrahabr.ru/post/180509/">здесь</a><p>.</p><p>
Весьма интересное чтиво, рекомендую.

</p><h3>Автоматизируем форматирование</h3><p>
Если посмотреть сколько всяких правил в pep8, то можно сесть за рефакторинг надолго. Вот только это лениво, да и при написании нового кода сиравно будут какие-то ошибки правил. Для этого рассмотрим как же себе можно упростить жизнь.

</p><h4>pep8</h4><p>
Дабы иметь представление сколько ошибок оформления в коде, стоит использовать утилиту </p><a href="https://pypi.python.org/pypi/pep8">pep8</a><p>.</p><p>
У нее достаточный список параметров, который позволяет рекурсивно просмотреть все файлы в папках на предмет соответствия стандарту pep8.</p><p>
Вывод утилиты примерно такой:

</p><pre><code class="bash">$ pep8 --first optparse.py
optparse.py:69:11: E401 multiple imports on one line
optparse.py:77:1: E302 expected 2 blank lines, found 1
optparse.py:88:5: E301 expected 1 blank line, found 0
optparse.py:222:34: W602 deprecated form of raising exception
optparse.py:347:31: E211 whitespace before '('
optparse.py:357:17: E201 whitespace after '{'
optparse.py:472:29: E221 multiple spaces before operator
optparse.py:544:21: W601 .has_key() is deprecated, use 'in'</code></pre><p>
По нему можно однозначно понять: где ошибка и что случилось.

</p><h4>autopep8</h4><p>
Ошибки стандарта часто повторяются от файла в файлу. И возникает сильное желание исправление автоматизировать. В этом случае на арену выходит </p><a href="https://pypi.python.org/pypi/autopep8">autopep8</a><p>.</p><p>
Как и pep8, он умеет самостоятельно определять ошибки, а также исправлять их. Список исправляемых ошибок форматирования можно найти </p><a href="https://pypi.python.org/pypi/autopep8/1.1#features">здесь</a><p>
Само использование autopep8 крайне простое и может выглядеть так:

</p><pre><code class="bash">$ autopep8 ./ --recursive --in-place -a</code></pre><p>
После выполнения данной команды, утилита рекурсивно пойдет по подпапкам и начнет в самих же файлах исправлять ошибки. 

</p><h4>autoflake</h4><p>
Можно пойти дальше и в качестве оружия взять </p><a href="https://pypi.python.org/pypi/autoflake/">autoflake</a><p>. Эта утилита помогает удалить не используемые импорты и переменные.</p><p>
Используется примерно так:

</p><pre><code class="bash">$ autoflake --in-place --remove-all-unused-imports --remove-unused-variables -r ./</code></pre><p>
Тем самым будут рекурсивно почищены файлы в директории.

</p><h4>unify</h4><p>
Крайний, заключительный момент в редактировании кода — это строки. Кто-то любит их писать в одиночных апострофах, кто-то в двойных. Вот только и для этого существует рекомендации, а также и утилита, которая позволяет автоматически приводить в соответствие — </p><a href="https://pypi.python.org/pypi/unify">unify</a><p>
Использование:

</p><pre><code class="bash">$ unify --in-place -r ./src/</code></pre><p>
Как и везде, утилита выполнит свое грязное дело рекурсивно для файлов в папке.

</p><h4>docformatter</h4><p>
Все время говорим о самом коде, а о комментариях еще ни разу не шло речи. Настало время — </p><a href="https://pypi.python.org/pypi/docformatter">docformatter</a><p>. Эта утилита помогает привести ваши docstring по соглашению </p><a href="https://www.python.org/dev/peps/pep-0257/">PEP 257</a><p>. Соглашение предписывает как следует оформлять документацию.</p><p>
Использование утилиты ничуть не сложнее предыдущих:

</p><pre><code class="bash">$ docformatter --in-place example.py</code></pre>

<h4>А все вместе можно?</h4><p>
Выше описаны утилиты, их запуск можно добавить какой-нибудь bash скрипт под магическим названием clean.bash и запускать. А можно пойти и по другому пути и использовать wrapper над этими утилитами — </p><a href="https://pypi.python.org/pypi/pyformat">pyformat</a>

<h3>Выводы</h3><p>
Python-код легко читается, однако, есть способы сделать лапшу и из читаемого кода. </p><p>
В данной статье были озвучены некоторые проблемы оформления кода, а также способы поиска этих проблем. Были рассмотрены несколько утилит, которые позволяют в автоматическом режиме убрать некоторые изъяны оформления кода. </p><p>
Стоит озвучить вслух следующую рекомендацию при написании кода, которая универсальна для любого языка: более важным правилом оформлением, чем подобные pep8-документы — это постоянство стиля. Выбрали в каком стиле будете писать программу, в этом же и пишите весь код.
</p><p>
Если читателям будет интересно, то в следующей статье я опишу как в автоматическом режиме искать ошибки в коде.

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>