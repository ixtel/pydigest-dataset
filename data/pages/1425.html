<html><body><div><div class="entry-content"><p>Здравствуйте! Я продолжаю работу над пособием по python-библиотеке NumPy.</p><p>В <a href="http://pythonworld.ru/numpy/1.html" target="_blank">прошлой части</a> мы научились создавать массивы и их печатать. Однако это не имеет смысла, если с ними ничего нельзя делать.</p><p>Сегодня мы познакомимся с операциями над массивами.</p><div class="section" id="id1"><h2>Базовые операции</h2><p>Математические операции над массивами выполняются поэлементно. Создается новый массив, который заполняется результатами действия оператора.</p><pre class="code pycon literal-block">
<span class="kn"/><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="go">array([20, 31, 42, 53])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<span class="go">array([20, 29, 38, 47])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<span class="go">array([  0,  30,  80, 150])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span>  <span class="c1"># При делении на 0 возвращается inf (бесконечность)</span>
<span class="go">array([         inf,  30.        ,  20.        ,  16.66666667])
&lt;string&gt;:1: RuntimeWarning: divide by zero encountered in true_divide
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">**</span> <span class="n">b</span>
<span class="go">array([     1,     30,   1600, 125000])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">%</span> <span class="n">b</span>  <span class="c1"># При взятии остатка от деления на 0 возвращается 0</span>
<span class="go">&lt;string&gt;:1: RuntimeWarning: divide by zero encountered in remainder
array([0, 0, 0, 2])</span></pre><p>Для этого, естественно, массивы должны быть одинаковых размеров.</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">+</span> <span class="n">d</span>
<span class="gt">Traceback (most recent call last):
</span>  File <span class="nb">"&lt;input&gt;"</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">ValueError</span>: <span class="n">operands could not be broadcast together with shapes (2,3) (3,2)</span></pre><p>Также можно производить математические операции между массивом и числом. В этом случае к каждому элементу прибавляется (или что вы там делаете) это число.</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">array([21, 31, 41, 51])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">**</span> <span class="mi">3</span>
<span class="go">array([  8000,  27000,  64000, 125000])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">35</span>  <span class="c1"># И фильтрацию можно проводить</span>
<span class="go">array([ True,  True, False, False], dtype=bool)</span></pre><p>NumPy также предоставляет множество математических операций для обработки массивов:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">array([ 0.40808206,  0.15425145, -0.66693806,  0.96496603])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">array([ 1.52083793,  1.53747533,  1.54580153,  1.55079899])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">array([  2.42582598e+08,   5.34323729e+12,   1.17692633e+17,
         2.59235276e+21])</span></pre><p>Полный список можно посмотреть <a href="https://docs.scipy.org/doc/numpy/reference/routines.math.html" target="_blank">здесь</a>.</p><p>Многие унарные операции, такие как, например, вычисление суммы всех элементов массива, представлены также и в виде методов класса ndarray.</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">21
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">21
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="go">1
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="go">6</span></pre><p>По умолчанию, эти операции применяются к массиву, как если бы он был списком чисел, независимо от его формы. Однако, указав параметр axis, можно применить операцию для указанной оси массива:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Наименьшее число в каждом столбце</span>
<span class="go">array([1, 2, 3])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Наименьшее число в каждой строке</span>
<span class="go">array([1, 4])</span></pre></div><div class="section" id="id2"><h2>Индексы, срезы, итерации</h2><p>Одномерные массивы осуществляют операции индексирования, срезов и итераций очень схожим образом с обычными списками и другими последовательностями Python (разве что удалять с помощью срезов нельзя).</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([  0,   1,   8,  27,  64, 125, 216, 343, 512, 729])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">1
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
<span class="go">array([ 27,  64, 125, 216])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([  0,   1,   8,   8,   8,   8,   8, 343, 512, 729])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">array([729, 512, 343,   8,   8,   8,   8,   8,   1,   0])
</span><span class="k"/><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):
</span>  File <span class="nb">"&lt;input&gt;"</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">ValueError</span>: <span class="n">cannot delete array elements</span>
<span class="k"/><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">i</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">0.0
1.0
2.0
2.0
2.0
2.0
2.0
7.0
8.0
9.0</span></pre><p>У многомерных массивов на каждую ось приходится один индекс. Индексы передаются в виде последовательности чисел, разделенных запятыми (то бишь, кортежами):</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">]])</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Вторая строка, третий столбец</span>
<span class="go">23
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="go">23
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Можно и так</span>
<span class="go">23
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Третий столбец</span>
<span class="go">array([ 2, 12, 22, 32, 42])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Первые две строки</span>
<span class="go">array([[ 0,  1,  2,  3],
       [10, 11, 12, 13]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span> <span class="p">:</span> <span class="p">]</span>  <span class="c1"># Вторая и третья строки</span>
<span class="go">array([[10, 11, 12, 13],
       [20, 21, 22, 23]])</span></pre><p>Когда индексов меньше, чем осей, отсутствующие индексы предполагаются дополненными с помощью срезов:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Последняя строка. Эквивалентно b[-1,:]</span>
<span class="go">array([40, 41, 42, 43])</span></pre><p>b[i] можно читать как b[i, &lt;столько символов ':', сколько нужно&gt;]. В NumPy это также может быть записано с помощью точек, как b[i, ...].</p><p>Например, если x имеет ранг 5 (то есть у него 5 осей), тогда</p><ul><li>x[1, 2, ...] эквивалентно x[1, 2, :, :, :],</li><li>x[... , 3] то же самое, что x[:, :, :, :, 3] и</li><li>x[4, ... , 5, :] это x[4, :, :, 5, :].</li></ul><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span> <span class="p">[</span><span class="mi">110</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">113</span><span class="p">]]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 2, 3)
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># то же, что a[1, : , :] или a[1]</span>
<span class="go">array([[100, 101, 102],
       [110, 112, 113]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="o">...</span> <span class="p">,</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># то же, что a[: , : ,2]</span>
<span class="go">array([[  2,  13],
       [102, 113]])</span></pre><p>Итерирование многомерных массивов начинается с первой оси:</p><pre class="code pycon literal-block">
<span class="k"/><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">[[ 0  1  2]
 [10 12 13]]
[[100 101 102]
 [110 112 113]]</span></pre><p>Однако, если нужно перебрать поэлементно весь массив, как если бы он был одномерным, для этого можно использовать атрибут flat:</p><pre class="code pycon literal-block">
<span class="k"/><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">0
1
2
10
12
13
100
101
102
110
112
113</span></pre></div><div class="section" id="id3"><h2>Манипуляции с формой</h2><p>Как уже говорилось, у массива есть форма (shape), определяемая числом элементов вдоль каждой оси:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[[  0,   1,   2],
        [ 10,  12,  13]],

       [[100, 101, 102],
        [110, 112, 113]]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 2, 3)</span></pre><p>Форма массива может быть изменена с помощью различных команд:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>  <span class="c1"># Делает массив плоским</span>
<span class="go">array([  0,   1,   2,  10,  12,  13, 100, 101, 102, 110, 112, 113])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Изменение формы</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[  0,   1],
       [  2,  10],
       [ 12,  13],
       [100, 101],
       [102, 110],
       [112, 113]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># Транспонирование</span>
<span class="go">array([[  0,   2,  12, 100, 102, 112],
       [  1,  10,  13, 101, 110, 113]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># Изменение формы</span>
<span class="go">array([[  0,   1,   2,  10],
       [ 12,  13, 100, 101],
       [102, 110, 112, 113]])</span></pre><p>Порядок элементов в массиве в результате функции ravel() соответствует обычному "C-стилю", то есть, чем правее индекс, тем он "быстрее изменяется": за элементом a[0,0] следует a[0,1]. Если одна форма массива была изменена на другую, массив переформировывается также в "C-стиле". Функции ravel() и reshape() также могут работать (при использовании дополнительного аргумента) в FORTRAN-стиле, в котором быстрее изменяется более левый индекс.</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[  0,   1],
       [  2,  10],
       [ 12,  13],
       [100, 101],
       [102, 110],
       [112, 113]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">'F'</span><span class="p">)</span>
<span class="go">array([[  0, 100,   1, 101],
       [  2, 102,  10, 110],
       [ 12, 112,  13, 113]])</span></pre><p>Метод reshape() возвращает ее аргумент с измененной формой, в то время как метод resize() изменяет сам массив:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[  0,   1,   2,  10,  12,  13],
       [100, 101, 102, 110, 112, 113]])</span></pre><p>Если при операции такой перестройки один из аргументов задается как -1, то он автоматически рассчитывается в соответствии с остальными заданными:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="go">array([[  0,   1,   2,  10],
       [ 12,  13, 100, 101],
       [102, 110, 112, 113]])</span></pre></div><div class="section" id="id4"><h2>Объединение массивов</h2><p>Несколько массивов могут быть объединены вместе вдоль разных осей с помощью функций hstack и vstack.</p><p>hstack() объединяет массивы по первым осям, vstack() — по последним:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="go">array([[1, 2],
       [3, 4],
       [5, 6],
       [7, 8]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="go">array([[1, 2, 5, 6],
       [3, 4, 7, 8]])</span></pre><p>Функция column_stack() объединяет одномерные массивы в качестве столбцов двумерного массива:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="go">array([[1, 2, 5, 6],
       [3, 4, 7, 8]])</span></pre><p>Аналогично для строк имеется функция row_stack().</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="go">array([[1, 2],
       [3, 4],
       [5, 6],
       [7, 8]])</span></pre></div><div class="section" id="id5"><h2>Разбиение массива</h2><p>Используя hsplit() вы можете разбить массив вдоль горизонтальной оси, указав либо число возвращаемых массивов одинаковой формы, либо номера столбцов, после которых массив разрезается "ножницами":</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0,  1,  2,  3,  4,  5],
       [ 6,  7,  8,  9, 10, 11]])
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># Разбить на 3 части</span>
<span class="go">[array([[0, 1], [6, 7]]),
 array([[2, 3], [8, 9]]),
 array([[ 4,  5], [10, 11]])]
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># Разрезать a после третьего и четвёртого столбца</span>
<span class="go">[array([[0, 1, 2], [6, 7, 8]]),
 array([[3], [9]]),
 array([[ 4,  5], [10, 11]])]</span></pre><p>Функция vsplit() разбивает массив вдоль вертикальной оси, а array_split() позволяет указать оси, вдоль которых произойдет разбиение.</p></div><div class="section" id="id6"><h2>Копии и представления</h2><p>При работе с массивами, их данные иногда необходимо копировать в другой массив, а иногда нет. Это часто является источником путаницы. Возможно 3 случая:</p><div class="section" id="id7"><h3>Вообще никаких копий</h3><p>Простое присваивание не создает ни копии массива, ни копии его данных:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1"># Нового объекта создано не было</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="ow">is</span> <span class="n">a</span>  <span class="c1"># a и b это два имени для одного и того же объекта ndarray</span>
<span class="go">True
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># изменит форму a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 4)</span></pre><p>Python передает изменяемые объекты как ссылки, поэтому вызовы функций также не создают копий.</p></div><div class="section" id="id8"><h3>Представление или поверхностная копия</h3><p>Разные объекты массивов могут использовать одни и те же данные. Метод view() создает новый объект массива, являющийся представлением тех же данных.</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="ow">is</span> <span class="n">a</span>
<span class="go">False
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">a</span>  <span class="c1"># c это представление данных, принадлежащих a</span>
<span class="go">True
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">owndata</span>
<span class="go">False
&gt;&gt;&gt;
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># форма а не поменяется</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 4)
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1234</span>  <span class="c1"># данные а изменятся</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[  0, 1, 2, 3],
       [1234, 5, 6, 7],
       [ 8, 9, 10, 11]])</span></pre><p>Срез массива это представление:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[  0, 10, 10, 3],
       [1234, 10, 10, 7],
       [ 8, 10, 10, 11]])</span></pre></div><div class="section" id="id9"><h3>Глубокая копия</h3><p>Метод copy() создаст настоящую копию массива и его данных:</p><pre class="code pycon literal-block">
<span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># создается новый объект массива с новыми данными</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="ow">is</span> <span class="n">a</span>
<span class="go">False
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">a</span>  <span class="c1"># d не имеет ничего общего с а</span>
<span class="go">False
</span><span class="n"/><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9999</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[  0, 10, 10, 3],
       [1234, 10, 10, 7],
       [ 8, 10, 10, 11]])</span></pre></div></div></div></div></body></html>