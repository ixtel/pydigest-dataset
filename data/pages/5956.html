<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-json-streamer-" class="anchor" href="#json-streamer-" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>json-streamer <a href="https://travis-ci.org/kashifrazzaqui/json-streamer"><img src="https://camo.githubusercontent.com/3f153a3cf413bbb0f42d275497622edf42be178f/68747470733a2f2f7472617669732d63692e6f72672f6b617368696672617a7a617175692f6a736f6e2d73747265616d65722e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/kashifrazzaqui/json-streamer.svg?branch=master"/></a></h1>

<p>jsonstreamer provides a SAX-like push parser via the JSONStreamer class and a 'object' parser via the
ObjectStreamer class which emits top level entities in any JSON object. Based on the fast c libary 'yajl'.
Great for parsing streaming json over a network as it comes in or json objects that are too large to hold in memory altogether.</p>

<h3><a id="user-content-dependencies" class="anchor" href="#dependencies" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Dependencies</h3>

<pre><code>git clone git@github.com:lloyd/yajl.git
cd yajl
./configure &amp;&amp; make install
</code></pre>

<h3><a id="user-content-setup" class="anchor" href="#setup" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Setup</h3>

<pre><code>pip3 install jsonstreamer
</code></pre>

<p>Also available at PyPi - <a href="https://pypi.python.org/pypi/jsonstreamer">https://pypi.python.org/pypi/jsonstreamer</a></p>

<h3><a id="user-content-example" class="anchor" href="#example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example</h3>

<h4><a id="user-content-shell" class="anchor" href="#shell" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Shell</h4>

<pre><code>python -m jsonstreamer.jsonstreamer &lt; some_file.json
</code></pre>

<h4><a id="user-content-code" class="anchor" href="#code" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Code</h4>

<p>variables which contain the input we want to parse</p>

<div class="highlight highlight-source-python"><pre>json_object <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">    {</span>
<span class="pl-s">        "fruits":["apple","banana", "cherry"],</span>
<span class="pl-s">        "calories":[100,200,50]</span>
<span class="pl-s">    }</span>
<span class="pl-s"><span class="pl-pds">"""</span></span>
json_array <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"""</span>[1,2,true,[4,5],"a"]<span class="pl-pds">"""</span></span></pre></div>

<p>a catch-all event listener function which prints the events</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">_catch_all</span>(<span class="pl-smi">event_name</span>, <span class="pl-k">*</span><span class="pl-smi">args</span>):
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span><span class="pl-c1">{}</span> : <span class="pl-c1">{}</span><span class="pl-pds">'</span></span>.format(event_name, args))</pre></div>

<h4><a id="user-content-jsonstreamer-example" class="anchor" href="#jsonstreamer-example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>JSONStreamer Example</h4>

<p>Event listeners get events in their parameters and must have appropriate signatures for receiving their specific event of interest.</p>

<p>JSONStreamer provides the following events:</p>

<ul>
<li>doc_start</li>
<li>doc_end</li>
<li>object_start</li>
<li>object_end</li>
<li>array_start</li>
<li>array_end</li>
<li>key - this also carries the name of the key as a string param</li>
<li>value -  this also carries the value as a string|int|float|boolean|None param</li>
<li>element - this also carries the value as a string|int|float|boolean|None param</li>
</ul>

<p>Listener methods must have signatures that match</p>

<p>For example for events: doc_start, doc_end, object_start, object_end, array_start and array_end the listener must be as such, note no params required</p>



<p>OR, if your listener is a class method, it can have an additional 'self' param as such</p>



<p>For events: key, value, element listeners must also receive an additional payload and must be declared as such</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">key_listener</span>(<span class="pl-smi">key_string</span>):
    <span class="pl-k">pass</span></pre></div>

<p>import and run jsonstreamer on 'json_object'</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> jsonstreamer <span class="pl-k">import</span> JSONStreamer 

<span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Parsing the json object:<span class="pl-pds">"</span></span>)
streamer <span class="pl-k">=</span> JSONStreamer() 
streamer.add_catch_all_listener(_catch_all)
streamer.consume(json_object[<span class="pl-c1">0</span>:<span class="pl-c1">10</span>]) <span class="pl-c">#note that partial input is possible</span>
streamer.consume(json_object[<span class="pl-c1">10</span>:])
streamer.close()</pre></div>

<p>output</p>

<pre><code>Parsing the json object:
    doc_start : ()
    object_start : ()
    key : ('fruits',)
    array_start : ()
    element : ('apple',)
    element : ('banana',)
    element : ('cherry',)
    array_end : ()
    key : ('calories',)
    array_start : ()
    element : (100,)
    element : (200,)
    element : (50,)
    array_end : ()
    object_end : ()
    doc_end : ()
</code></pre>

<p>run jsonstreamer on 'json_array'</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Parsing the json array:<span class="pl-pds">"</span></span>)
streamer <span class="pl-k">=</span> JSONStreamer() <span class="pl-c">#can't reuse old object, make a fresh one</span>
streamer.add_catch_all_listener(_catch_all)
streamer.consume(json_array[<span class="pl-c1">0</span>:<span class="pl-c1">5</span>])
streamer.consume(json_array[<span class="pl-c1">5</span>:])
streamer.close()</pre></div>

<p>output</p>

<pre><code>Parsing the json array:
    doc_start : ()
    array_start : ()
    element : (1,)
    element : (2,)
    element : (True,)
    array_start : ()
    element : (4,)
    element : (5,)
    array_end : ()
    element : ('a',)
    array_end : ()
    doc_end : ()
</code></pre>

<h4><a id="user-content-objectstreamer-example" class="anchor" href="#objectstreamer-example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>ObjectStreamer Example</h4>

<p>ObjectStreamer provides the following events:</p>

<ul>
<li>object_stream_start</li>
<li>object_stream_end</li>
<li>array_stream_start</li>
<li>array_stream_end</li>
<li>pair</li>
<li>element</li>
</ul>

<p>import and run ObjectStreamer on 'json_object'</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> jsonstreamer <span class="pl-k">import</span> ObjectStreamer

<span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Parsing the json object:<span class="pl-pds">"</span></span>)
object_streamer <span class="pl-k">=</span> ObjectStreamer()
object_streamer.add_catch_all_listener(_catch_all)
object_streamer.consume(json_object[<span class="pl-c1">0</span>:<span class="pl-c1">9</span>])
object_streamer.consume(json_object[<span class="pl-c1">9</span>:])
object_streamer.close()</pre></div>

<p>output</p>

<pre><code>Parsing the json object:
    object_stream_start : ()
    pair : (('fruits', ['apple', 'banana', 'cherry']),)
    pair : (('calories', [100, 200, 50]),)
    object_stream_end : ()
</code></pre>

<p>run the ObjectStreamer on the 'json_array'</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Parsing the json array:<span class="pl-pds">"</span></span>)
object_streamer <span class="pl-k">=</span> ObjectStreamer()
object_streamer.add_catch_all_listener(_catch_all)
object_streamer.consume(json_array[<span class="pl-c1">0</span>:<span class="pl-c1">4</span>])
object_streamer.consume(json_array[<span class="pl-c1">4</span>:])
object_streamer.close()</pre></div>

<p>output - note that the events are different for an array</p>

<pre><code>Parsing the json array:
    array_stream_start : ()
    element : (1,)
    element : (2,)
    element : (True,)
    element : ([4, 5],)
    element : ('a',)
    array_stream_end : ()
</code></pre>

<h4><a id="user-content-example-on-attaching-listeners-for-various-events" class="anchor" href="#example-on-attaching-listeners-for-various-events" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example on attaching listeners for various events</h4>

<div class="highlight highlight-source-python"><pre>ob_streamer <span class="pl-k">=</span> ObjectStreamer()

<span class="pl-k">def</span> <span class="pl-en">pair_listener</span>(<span class="pl-smi">pair</span>):
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Explicit listener: Key: <span class="pl-c1">{}</span> - Value: <span class="pl-c1">{}</span><span class="pl-pds">'</span></span>.format(pair[<span class="pl-c1">0</span>],pair[<span class="pl-c1">1</span>]))

ob_streamer.add_listener(<span class="pl-s"><span class="pl-pds">'</span>pair<span class="pl-pds">'</span></span>, pair_listener) <span class="pl-c">#same for JSONStreamer</span>
ob_streamer.consume(json_object)

ob_streamer.remove_listener(pair_listener) <span class="pl-c">#if you need to remove the listener explicitly</span></pre></div>

<h4><a id="user-content-even-easier-way-of-attaching-listeners" class="anchor" href="#even-easier-way-of-attaching-listeners" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Even easier way of attaching listeners</h4>

<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-en">MyClass</span>:

    <span class="pl-k">def</span> <span class="pl-c1">__init__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        <span class="pl-v">self</span>._obj_streamer <span class="pl-k">=</span> ObjectStreamer() <span class="pl-c">#same for JSONStreamer</span>

        <span class="pl-c"># this automatically finds listeners in this class and attaches them if they are named</span>
        <span class="pl-c"># using the following convention '_on_eventname'. Note method names in this class</span>
        <span class="pl-v">self</span>._obj_streamer.auto_listen(<span class="pl-v">self</span>) 

    <span class="pl-k">def</span> <span class="pl-en">_on_object_stream_start</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        <span class="pl-c1">print</span> (<span class="pl-s"><span class="pl-pds">'</span>Root Object Started<span class="pl-pds">'</span></span>)

    <span class="pl-k">def</span> <span class="pl-en">_on_pair</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">pair</span>):
        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Key: <span class="pl-c1">{}</span> - Value: <span class="pl-c1">{}</span><span class="pl-pds">'</span></span>.format(pair[<span class="pl-c1">0</span>],pair[<span class="pl-c1">1</span>]))

    <span class="pl-k">def</span> <span class="pl-en">parse</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">data</span>):
        <span class="pl-v">self</span>._obj_streamer.consume(data)


m <span class="pl-k">=</span> MyClass()
m.parse(json_object)</pre></div>
</article>
  </div></body></html>