<html><body><div><div class="entry-content">
                    <p>While you can optimize the heck out of your Python code with <tt class="docutils literal">generators</tt> and <tt class="docutils literal">generator expressions</tt> I'm more interested in goofing around and solving classic programming questions with the <tt class="docutils literal">yield</tt> statement.</p>
<p><strong>note:</strong> For this article, since it's easier to explain things as they happen, I'll be including a lot of inline comments.</p>
<p>Let's start with a simple function that returns a sequence of some of my favorite values:</p>
<div class="highlight"><pre><span class="c"># yielding.py</span>
<span class="k">def</span> <span class="nf">pydanny_selected_numbers</span><span class="p">():</span>

    <span class="c"># If you multiple 9 by any other number you can easily play with</span>
    <span class="c">#   numbers to get back to 9.</span>
    <span class="c">#   Ex: 2 * 9 = 18. 1 + 8 = 9</span>
    <span class="c">#   Ex: 15 * 9 = 135. 1 + 3 + 5 = 9</span>
    <span class="c">#   See https://en.wikipedia.org/wiki/Digital_root</span>
    <span class="k">yield</span> <span class="mi">9</span>

    <span class="c"># A pretty prime.</span>
    <span class="k">yield</span> <span class="mi">31</span>

    <span class="c"># What's 6 * 7?</span>
    <span class="k">yield</span> <span class="mi">42</span>

    <span class="c"># The string representation of my first date with Audrey Roy</span>
    <span class="k">yield</span> <span class="s">"2010/02/20"</span>
</pre></div>
<p><strong>note:</strong> When a function uses the <tt class="docutils literal">yield</tt> keyword it's now called a <strong>generator</strong>.</p>
<p>Let's do a test drive in the REPL:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">yielding</span> <span class="kn">import</span> <span class="n">pydanny_selected_numbers</span>  <span class="c"># import ye aulde code</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">pydanny_selected_numbers</span><span class="p">()</span>  <span class="c"># create the iterator object</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">pydanny_selected_numbers</span> <span class="n">at</span> <span class="mh">0x1038a03c0</span><span class="o">&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pydanny_selected_numbers</span><span class="p">():</span>  <span class="c"># iterate through the iterator</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="o">...</span>
<span class="mi">9</span>
<span class="mi">31</span>
<span class="mi">42</span>
<span class="s">"2010/02/20"</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">pydanny_selected_numbers</span><span class="p">()</span> <span class="c"># create the iterator object</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>  <span class="c"># iterate through the iterator object</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="o">...</span>
<span class="mi">9</span>
<span class="mi">31</span>
<span class="mi">42</span>
<span class="s">"2010/02/20"</span>
</pre></div>
<p>Of course, if you know anything about generator expressions, you know I could do this more tersely with the following:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">"2010/02/20"</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="o">...</span>
<span class="mi">9</span>
<span class="mi">31</span>
<span class="mi">42</span>
<span class="s">"2010/02/20"</span>
</pre></div>
<p>While that is more terse, it doesn't give us the amount of control we get by defining our own generator function. For example, what if I want to present the Fibonacci sequence in a loop rather than with recursion?</p>
<div class="highlight"><pre><span class="c"># fun.py</span>
<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nb">max</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">base</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">:</span>

        <span class="c"># This yield statement is where the execution leaves the function.</span>
        <span class="k">yield</span> <span class="n">result</span>
        <span class="c"># This is where the execution comes back into the function. This is</span>
        <span class="c"># just whitespace, but that it came back while preserving the state</span>
        <span class="c"># of the function is pretty awesome.</span>

        <span class="c"># Fibonacci code to increase the number according to</span>
        <span class="c">#   https://en.wikipedia.org/wiki/Fibonacci_number</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">base</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">base</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">n</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fibonacci</span><span class="p">(</span><span class="mi">144</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
<p>Let's try this out in the REPL:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">fun</span> <span class="kn">import</span> <span class="n">fibonacci</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fibonacci</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">fibonacci</span> <span class="n">at</span> <span class="mh">0x10d49e460</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fibonacci</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="mi">8</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">fibonacci</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">iterator</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">fibonacci</span> <span class="n">at</span> <span class="mh">0x10d63c550</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">iterator</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="mi">0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">iterator</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="mi">1</span>
</pre></div>
<p>What's nice about this is so much more than fibonacci logic in a generator function. Instead, imagine instead of a lightweight calculation I had done something performance intensive. By using generator expressions I can readily control the execution calls with the iterator object's <tt class="docutils literal">next()</tt> method, saving processor cycles.</p>
<p>Very nifty.</p>
<div class="section" id="summary">
<h2>Summary</h2>
<p>I admit it. Like many Python developers, I find using tools like yields and generators to optimize the heck out of performance intensive things a lot of fun.</p>
<p>If you are like me and like this sort of stuff, I recommend the following resources:</p>

<p>In the next article I'll demonstrate how to use the <tt class="docutils literal">yield</tt> statement to create context managers.</p>
<p><strong>Update</strong>: <a class="reference external" href="https://twitter.com/ntoll">Nicholas Tollervey</a> pointed me at wikipedia's Digital root article, so I added it to the comments of the first code sample.</p>
<p><strong>Update</strong>: Oddthinking pointed out that I forgot a print statement. In the REPL it's not really needed, but if this is translated to a script then it's necessary.</p>
</div>

                    
                </div>
                                </div></body></html>