<html><body><div><div class="text-content">

								
								


<p>Time flies by! I see Jenika (my daughter) running around in the entire house and my office now. She still slips and trips – but is now independent to explore the world and figure out new stuff on her own. I hope I would have been able to inspire similar confidence with use of Python for data analysis in the followers of this series.</p>
<p>For those, who have been following, here are a pair of shoes for you to start running!</p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/Orange-Shoes.jpg"><img class="aligncenter wp-image-6380 size-medium" src="http://i0.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/Orange-Shoes-300x300.jpg?resize=300%2C300" alt="Orange Shoes" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/Orange-Shoes.jpg?resize=150%2C150 150w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/Orange-Shoes.jpg?resize=300%2C300 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/Orange-Shoes.jpg?resize=1024%2C1024 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/Orange-Shoes.jpg?w=1536 1536w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>By end of this tutorial, you will also have all the tools necessary to perform any data analysis by yourself using Python.</p>
<p> </p>
<h3><strong>Recap – Getting the basics right</strong></h3>
<p>In the previous posts in this series, <a title="Baby steps in learning Python for data analysis" href="http://www.analyticsvidhya.com/blog/2014/07/baby-steps-learning-python-data-analysis/" target="_blank">we had downloaded and setup a Python installation</a>, got introduced to several <a title="Baby steps in Python – Libraries and data structures" href="http://www.analyticsvidhya.com/blog/2014/07/baby-steps-libraries-data-structure/" target="_blank">useful libraries and data structures</a> and finally started with an <a title="Baby steps in Python – Exploratory analysis in Python (using Pandas)" href="http://www.analyticsvidhya.com/blog/2014/08/baby-steps-python-performing-exploratory-analysis-python/" target="_blank">exploratory analysis in Python (using Pandas)</a>.</p>
<p>In this tutorial, we will continue our journey from where we left it in our last tutorial – we have a reasonable idea about the characteristics of the dataset we are working on. If you have not gone through the <a title="Baby steps in Python – Exploratory analysis in Python (using Pandas)" href="http://www.analyticsvidhya.com/blog/2014/08/baby-steps-python-performing-exploratory-analysis-python/" target="_blank">previous article in the series</a>, kindly do so before proceeding further.</p>
<p> </p>
<h3><strong>Data munging – recap of the need</strong></h3>
<p>While our exploration of the data, we found a few problems in the dataset, which need to be solved before the data is ready for a good model. This exercise is typically referred as “Data Munging”. Here are the problems, we are already aware of:</p>
<ol>
<li>About 31% (277 out of 891) of values in Age are missing. We expect age to play an important role and hence would want to estimate this in some manner.</li>
<li>While looking at the distributions, we saw that Fare seemed to contain extreme values at either end – a few tickets were probably provided free or contained data entry error. On the other hand $512 sounds like a very high fare for booking a ticket</li>
</ol>
<p>In addition to these problems with numerical fields, we should also look at the non-numerical fields i.e. Name, Ticket and Cabin to see, if they contain any useful information.</p>
<p> </p>
<h4><strong>Check missing values in the dataset</strong></h4>
<p>Let us look at Cabin to start with. First glance at the variable leaves us with an impression that there are too many NaNs in the dataset. So, let us check the number of nulls / NaNs in the dataset</p>
<pre><div id="stb-container-1418" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-1418" class="stb-grey_box stb-box"> sum(df['Cabin'].isnull()) </p></div></pre>
<p>This command should tell us the number of missing values as isnull() returns 1, if the value is null. The output is 687 – which is a lot of missing values. So, we’ll need to drop this variable.</p>
<p> </p>
<p>Next, let us look at variable Ticket. Ticket looks to have mix of numbers and text and doesn’t seem to contain any information, so will drop Ticket as well.</p>
<pre><div id="stb-container-4921" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-4921" class="stb-grey_box stb-box"> df = df.drop(['Ticket','Cabin'], axis=1) </p></div></pre>
<p> </p>
<h4><strong>How to fill missing values in Age?</strong></h4>
<p>There are numerous ways to fill the missing values of Age – the simplest being replacement by mean, which can be done by following code:</p>
<pre><div id="stb-container-5547" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-5547" class="stb-grey_box stb-box"> meanAge = np.mean(df.Age)
df.Age = df.Age.fillna(meanAge)</p></div></pre>
<p>The other extreme could be to build a supervised learning model to predict age on the basis of other variables and then use age along with other variables to predict survival.</p>
<p>Since, the purpose of this tutorial is to bring out the steps in data munging, I’ll rather take an approach, which lies some where in between these 2 extremes. The key hypothesis is that the salutations in Name, Gender and Pclass combined can provide us with information required to fill in the missing values to a large extent.</p>
<p>Here are the steps required to work on this hypothesis:</p>
<h5><strong>Step 1: Extracting salutations from Name</strong></h5>
<p>Let us define a function, which extracts the salutation from a Name written in this format:</p>
<p>Family_Name, Salutation. First Name</p>
<pre><div id="stb-container-2776" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-2776" class="stb-grey_box stb-box"> 
def name_extract(word):
 return word.split(',')[1].split('.')[0].strip()
</p></div></pre>
<p>This function takes a Name, splits it by a comma (,), then splits it by a dot(.) and removes the whitespaces. The output of calling function with ‘Jain, Mr. Kunal’ would be Mr and ‘Jain, Miss. Jenika’ would be Miss</p>
<p>Next, we apply this function to the entire column using apply() function and convert the outcome to a new DataFrame df2:</p>
<pre><div id="stb-container-3491" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-3491" class="stb-grey_box stb-box"> 
df2 = pd.DataFrame({'Salutation':df['Name'].apply(name_extract)})
</p></div></pre>
<p>Once we have the Salutations, let us look at their distribution. We use the good old groupby after merging the DataFrame df2 with DataFrame df:</p>
<pre><div id="stb-container-5800" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-5800" class="stb-grey_box stb-box"> 
df = pd.merge(df, df2, left_index = True, right_index = True) # merges on index
temp1 = df.groupby('Salutation').PassengerId.count()
print temp1
</p></div></pre>
<p>Following is the output:</p>
<pre>Salutation 
Capt          1 
Col           2 
Don           1 
Dr            7 
Jonkheer      1 
Lady          1 
Major         2 
Master       40 
Miss        182 
Mlle          2 
Mme           1 
Mr          517 
Mrs         125 
Ms            1 
Rev           6  
Sir           1 
the Countess  1 
dtype: int64

</pre>
<p>As you can see, there are 4 main Salutations – Mr, Mrs, Miss and Master – all other are less in number. Hence, we will combine all the remaining salutations under a single salutation – Others. In order to do so, we take the same approach, as we did to extract Salutation – define a function, apply it to a new column, store the outcome in a DataFrame and then merge it with old DataFrame:</p>
<pre><div id="stb-container-4156" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-4156" class="stb-grey_box stb-box"> 
def group_salutation(old_salutation):
 if old_salutation == 'Mr':
    return('Mr')
 else:
    if old_salutation == 'Mrs':
       return('Mrs')
    else:
       if old_salutation == 'Master':
          return('Master')
       else: 
          if old_salutation == 'Miss':
             return('Miss')
          else:
             return('Others')
df3 = pd.DataFrame({'New_Salutation':df['Salutation'].apply(group_salutation)})
df = pd.merge(df, df3, left_index = True, right_index = True)
temp1 = df3.groupby('New_Salutation').count()
temp1
df.boxplot(column='Age', by = 'New_Salutation')
</p></div></pre>
<p>Following is the outcome for Distribution of New_Salutation and variation of Age across them:</p>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/Salutation_distribution.jpg"><img class="aligncenter size-full wp-image-6417" src="http://i0.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/Salutation_distribution.jpg?resize=235%2C209" alt="Salutation_distribution" data-recalc-dims="1"/></a></p>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/age_by_salutation.jpg"><img class="aligncenter size-full wp-image-6418" src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/age_by_salutation.jpg?resize=411%2C318" alt="age_by_salutation" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/age_by_salutation.jpg?resize=300%2C232 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/age_by_salutation.jpg?w=411 411w" sizes="(max-width: 411px) 100vw, 411px" data-recalc-dims="1"/></a></p>
<h5><strong>Step 2: Creating a simple grid (Class x Gender) x Salutation</strong></h5>
<p>Similarly plotting the distribution of age by Sex &amp; Class shows a sloping:</p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/age_by_Sex_Class.jpg"><img class="aligncenter size-full wp-image-6420" src="http://i1.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/age_by_Sex_Class.jpg?resize=388%2C286" alt="age_by_Sex_Class" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/age_by_Sex_Class.jpg?resize=300%2C221 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/age_by_Sex_Class.jpg?w=388 388w" sizes="(max-width: 388px) 100vw, 388px" data-recalc-dims="1"/></a></p>
<p>So, we create a Pivot table, which provides us median values for all the cells mentioned above. Next, we define a function, which returns the values of these cells and apply it to fill the missing values of age:</p>
<pre><div id="stb-container-4889" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><p id="stb-box-4889" class="stb-grey_box stb-box"> 
table = df.pivot_table(values='Age', index=['New_Salutation'], columns=['Pclass', 'Sex'], aggfunc=np.median)
# Define function to return value of this pivot_table
def fage(x):
    return table[x['Pclass']][x['Sex']][<wbr/>x['New_Salutation']]
# Replace missing values
<span>df['Age'].fillna(df[df['Age'].</span><wbr/><span>isnull()].apply(fage, axis=1), inplace=True)
</span></p></div></pre>
<p>This should provide you a good way to impute missing values of Age.</p>
<p> </p>
<h4><strong>How to treat for Outliers in distribution of Fare?</strong></h4>
<p>Next, let us look at distribution of Fare by Pclass:</p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/Fare_by_Class.jpg"><img class="aligncenter size-full wp-image-6421" src="http://i1.wp.com/www.analyticsvidhya.com/blog/wp-content/uploads/2014/09/Fare_by_Class.jpg?resize=398%2C291" alt="Distribution of Fare by class for Titanic dataset on Kaggle" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/Fare_by_Class.jpg?resize=300%2C219 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2014/09/Fare_by_Class.jpg?w=398 398w" sizes="(max-width: 398px) 100vw, 398px" data-recalc-dims="1"/></a></p>
<p>As expected the means of Fare line up neatly by Pclass. However, there are a few extreme values. One particular data point which grabs attention, the fare of 512 for Class 1 – this looks like a likely error. Again there are multiple ways to impute this data – replace by mean / median of Class 1 or you can also replace the value by the second highest value, which is closer to other data points.</p>
<p>You can choose you pick and replace the values. The commands are similar to the ones mentioned above.</p>
<p> </p>
<h4><strong>End Notes:</strong></h4>
<p>Now our dataset is ready for building predictive models. In the next tutorial in this series, we will try out various predictive modeling techniques to predict survival of Titanic passengers and compare them to find out the best technique.</p>
<p>A quick recap, by now – you would be comfortable <a title="Baby steps in Python – Exploratory analysis in Python (using Pandas)" href="http://www.analyticsvidhya.com/blog/2014/08/baby-steps-python-performing-exploratory-analysis-python/" target="_blank">performing exploratory analysis </a>and Data Munging in Pandas. Some of the steps in this tutorial can feel overdone for this problem – the idea was to provide a tutorial, which can help you even on bigger problems. If you have any other tricks, which you use for data cleaning and munging, please feel free to share them through comments below.</p>


<p/>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p>
															</div>

							</div></body></html>