<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-get-and-analyze-hillary-clintons-email" class="anchor" href="#get-and-analyze-hillary-clintons-email" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Get and analyze Hillary Clinton's email</h1>

<p>In response to a public records request, the U.S. State Department is releasing Hillary Clinton's email messages from her time as secretary of state. Every month, newly released messages are posted to <a href="https://foia.state.gov/">foia.state.gov</a> as PDFs, with some metadata.</p>

<p>This collection of tools automates downloading and helps analyze the messages. The Wall Steet Journal's interactive graphics team uses some of this code to power our <a href="http://graphics.wsj.com/hillary-clinton-email-documents/">Clinton inbox search</a> interactive.</p>

<p>We welcome your pull requests and issue reports.</p>

<h2><a id="user-content-whats-in-the-toolkit" class="anchor" href="#whats-in-the-toolkit" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>What's in the toolkit</h2>

<ul>
<li><p><strong>run.sh</strong> runs all of the Python scripts in the toolkit automatically, allowing easy updates when messages are released.</p></li>
<li><p><strong>downloadMetadata.py</strong> scrapes sender, recipient, message date and subject from <a href="https://foia.state.gov/Search/Results.aspx?collection=Clinton_Email">the message list</a> and writes this metadata to a sqlite database, <code>hrcemail.sqlite</code>.</p></li>
<li><strong>generatePDFList.py</strong> writes <code>pdflist.txt</code>, a newline-delimited list of HTTPS URLs of the message PDFs.</li>
<li><strong>zipPDFs.py</strong> makes a zip file of PDFs for each release of messages.</li>
<li><p><strong>pdfTextToDatabase.py</strong> extracts text from the PDF files (which are OCR'd by State) and writes the text to a sqlite database, <code>hrcemail.sqlite</code>.</p></li>
<li><p><strong>HRCEMAIL_names.csv</strong> is a list that pairs sender and recipient names provided by the State Department website with that person's commonly-used name. For example, <code>HRC</code> becomes <code>Hillary Clinton</code>.</p></li>
</ul>

<h2><a id="user-content-how-to-get-started" class="anchor" href="#how-to-get-started" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to get started</h2>

<p>Clone the repo.</p>

<pre><code>git clone https://github.com/wsjdata/clinton-email-cruncher.git
cd clinton-email-cruncher
</code></pre>

<p>Install <a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">virtualenv</a> if necessary.</p>

<pre><code>pip install virtualenv
</code></pre>

<p>Create a virtual environment. <strong>Python 2.7.9</strong> is required, specifically for SSL (HTTPS) support. State Department's website requires HTTPS.</p>

<pre><code>virtualenv -p /usr/bin/python2.7 virt-hrcemail
source virt-hrcemail/bin/activate
</code></pre>

<p>Install all the Python dependencies. </p>

<pre><code>pip install -r requirements.txt
</code></pre>

<p>Then, run the shell script.</p>

<pre><code>./run.sh
</code></pre>

<p>You will need <code>wget</code> to download the PDFs. (Mac OS X users can install it using <a href="http://brew.sh/">homebrew</a>.) Downloading the PDFs can take around 30 minutes. If you don't want to download the PDFs, run <code>./run.sh no-pdf-download</code>.</p>

<p>Finally, load <code>HRCEMAIL_names.csv</code> into the <code>hrcemail.sqlite</code> database.</p>

<pre><code>csvsql --db "sqlite:///hrcemail.sqlite" --insert --no-create --blanks --table name  HRCEMAIL_names.csv 
</code></pre>

<h2><a id="user-content-lets-do-some-analysis" class="anchor" href="#lets-do-some-analysis" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Let's do some analysis!</h2>

<p>How many messages did everyone send and receive? Run this SQL query:</p>

<pre><code>sql2csv --db "sqlite:///hrcemail.sqlite" --query 'SELECT commonName,sum(to_count) to_sum, sum(from_count) from_sum, sum(from_count+to_count) total_sum FROM (
SELECT toName.`commonName`,0 from_count, count(distinct docID) to_count
FROM document d
JOIN name toName ON toName.`originalName` = d.`to`
JOIN name fromName ON fromName.`originalName` = d.`from`
group by toName.`commonName`
UNION ALL
SELECT fromName.`commonName`,count(distinct docID) from_count, 0 to_count
FROM document d
JOIN name toName ON toName.`originalName` = d.`to`
JOIN name fromName ON fromName.`originalName` = d.`from`
group by fromName.`commonName`
) t GROUP BY commonName
ORDER BY total_sum DESC;' | head | csvlook
</code></pre>

<h2><a id="user-content-how-you-can-help" class="anchor" href="#how-you-can-help" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How you can help</h2>

<p>Are there any names in the <code>document</code> table that are not resolved in the <code>name</code> table? Use this query to check:</p>

<pre><code>SELECT d.originalName d,n.originalName n FROM (SELECT distinct `to` originalName
FROM document
UNION
SELECT distinct `from` originalName
FROM document) d
LEFT JOIN name n ON TRIM(d.originalName) LIKE n.originalName
WHERE n.originalName IS NULL;
</code></pre>

<p>Find anything that needs to be updated? Fix the <code>name</code> table, export to <code>HRCEMAIL_names.csv</code>, and make a pull request.</p>

<pre><code>sqlite3 -header -csv hrcemail.sqlite "SELECT * FROM name ORDER BY commonName,originalName;" &gt; HRCEMAIL_names.csv 
</code></pre>

<h2><a id="user-content-future-work" class="anchor" href="#future-work" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Future work</h2>

<ul>
<li>Extract the time the message was sent or received from the full text</li>
<li>Split the full text into constituent messages</li>
<li>Develop a list of phrases to remove from the full text (e.g. "PRODUCED TO HOUSE SELECT BENGHAZI COMM")</li>
<li>Infer message threads</li>
<li>Pair attachments with their messages</li>
</ul>
</article>
  </div></body></html>