<html><body><div><div class="post-text" itemprop="text">

<p>I am experiencing some really weird interactions between <a href="http://docs.h5py.org" rel="nofollow">h5py</a>, <a href="http://www.pytables.org" rel="nofollow">PyTables</a> (via <a href="http://pandas.pydata.org/" rel="nofollow">Pandas</a>), and C++ generated <a href="https://www.hdfgroup.org" rel="nofollow">HDF5</a> files. It seems that, <a href="https://www.hdfgroup.org/products/hdf5_tools/h5check.html" rel="nofollow">h5check</a> and <a href="http://docs.h5py.org" rel="nofollow">h5py</a> seem to cope with type names containing '/' but <a href="http://pandas.pydata.org/" rel="nofollow">pandas</a>/<a href="http://www.pytables.org" rel="nofollow">PyTables</a> cannot. Clearly, there is a gap in my understanding, so:</p>

<p><em>What have I not understood here?</em></p>

<hr/>

<p><strong>The gory details</strong></p>

<p>I have the following data in a <strong>HDF5</strong> file:</p>

<pre><code>   [...]
   DATASET "log" {
      DATATYPE  H5T_COMPOUND {
         H5T_COMPOUND {
            H5T_STD_U32LE "sec";
            H5T_STD_U32LE "usec";
         } "time";
         H5T_IEEE_F32LE "CIF/align/aft_port_end/extend_pressure";
         [...]
</code></pre>

<p>This was created via the C++ API. The <a href="https://www.hdfgroup.org/products/hdf5_tools/h5check.html" rel="nofollow">h5check</a> utility says the file is valid.</p>

<p>Note that <code>CIF/align/aft_port_end/extend_pressure</code> <em>is not</em> meant as a path to a group/node/leaf.  It is a label, that we use internally which happens to have some internal structure that contains '/' as delimiters.  We do not want the HDF5 file to know anything about that: it should not care. Clearly, if '/' are illegal in any HDF5 name, then we have to change that delimiter to something else.</p>

<p>Using <strong>PyTables</strong> (okay, <a href="http://pandas.pydata.org/" rel="nofollow">Pandas</a> but it uses <a href="http://www.pytables.org" rel="nofollow">PyTables</a> internally) to read the file, I get an </p>

<pre><code> &gt;&gt;&gt; import pandas as pd
 &gt;&gt;&gt; store = pd.HDFStore('data/XXX-20150423-071618.h5')
 &gt;&gt;&gt; store
/home/XXX/virt/env/develop/lib/python2.7/site-packages/tables/group. py:1156: UserWarning: problems loading leaf ``/log``::

  the ``/`` character is not allowed in object names: 'XXX/align/aft_port_end/extend_pressure'

The leaf will become an ``UnImplemented`` node. 
</code></pre>

<p>I asked about this in this <a href="http://stackoverflow.com/q/30046902/232794">question</a> and <a href="http://stackoverflow.com/a/30047358/232794">got told</a> that '/' are <a href="http://www.hdfgroup.org/HDF5/doc1.6/UG/03_Model.html" rel="nofollow">illegal in the specification</a>. However, things get stranger with <a href="http://docs.h5py.org" rel="nofollow">h5py</a>...</p>

<p>Using <strong>h5py</strong> to read the file, I get what I want:</p>

<pre><code>&gt;&gt;&gt; f['/log'].dtype
&gt;&gt;&gt;Â dtype([('time', [('sec', '&lt;u4'), ('usec', '&lt;u4')]), ('CI
F/align/aft_port_end/extend_pressure', '&lt;f4')[...]
</code></pre>

<p>Which is more or less what I set out with.</p>

<p>Needless to say, I am confused. Have I managed to create an illegal <a href="https://www.hdfgroup.org" rel="nofollow">HDF5</a> file that somehow passes <a href="https://www.hdfgroup.org/products/hdf5_tools/h5check.html" rel="nofollow">h5check</a>?  Is <a href="http://www.pytables.org" rel="nofollow">PyTables</a> not supporting this edge case? ... I am confused.</p>

<hr/>

<p>Clearly, I could write a simple wrapper something like this:</p>

<pre><code>&gt;&gt;&gt; import matplotlib.pyplot as plt
&gt;&gt;&gt; silly = pd.DataFrame(f['/log']['CIF/align/aft_port_end/extend_pressure'])
&gt;&gt;&gt; silly.plot()
&gt;&gt;&gt; plt.show()
</code></pre>

<p>to get all the data from the <a href="https://www.hdfgroup.org" rel="nofollow">HDF5</a> file into <a href="http://pandas.pydata.org/" rel="nofollow">Pandas</a>. However, I am not sure if this is a good idea because of the confusion earlier. My biggest worry is the conversion might not scale if the data is very large...</p>
    </div>
    </div></body></html>