<html><body><div><div class="entry">
        
        <p class="g-plusone" data-annotation="inline" data-width="300"/>

        
        
        <p>Давно просили написать про создание middleware в django, тут как раз небольшой пришлось писать, думаю будет хорошим примером. </p>

<p><strong>Что такое middleware django?</strong> Нужно просто себе представить, что на глобальном уровне мы можем видоизменять запрос к серверу и ответ от сервера. Я буду видоизменять ответ с помощью метода process_response().</p>

<p>Итак начнем создание:<br/>1. Нужно определить модуль в котором он будет храниться у меня это "core", если создаете новый не забудте добавить его INSTALLED_APPS<br/>2. Создаем в этом модуле питоновский файл с любым названием, но лучше middleware.py<br/>3. Создаем в middleware.py обычный питоновский класс "MyClass"<br/>4. Подключаем нашу middleware в MIDDLEWARE_CLASSES:</p>

<p/><pre><code>MIDDLEWARE_CLASSES = (  <br/>    'core.middleware.MyClass',  <br/>    'django.middleware.common.CommonMiddleware',  <br/>    ...<br/>)  <br/></code></pre>

<p>5. Пишем свой миддлвар.</p>

<p>Мне нужно было при ajax запросе, если ответ сервера - это редирект, то подменить ему код статуса. А то там беда с Jquery, оно возвращает 200 вместо 302:</p>

<p/><pre><code>from django.http import HttpResponseRedirect<br/>#<br/>#<br/>class MyClass(object):<br/>    def process_response(self, request, response):<br/>        if request.is_ajax():<br/>            if type(response) == HttpResponseRedirect:<br/>                response.status_code = 278<br/>        return response<br/></code></pre>

<p>Думаю это довольно исчерпывающе по данной тематике.</p>

        
        <p/>
        

    	
    	<p class="yashare-auto-init" data-yasharel10n="ru" data-yasharetype="none" data-yasharequickservices="vkontakte,facebook,twitter,odnoklassniki,moimir,lj,gplus">
    	</p>
    	
        
        <p id="disqus_thread"/>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
</div></body></html>