<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-opentree" class="anchor" href="#opentree" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>opentree</h1>

<p>This is the repository for the Open Tree of Life web applications, one of many subsystems making up the Open Tree of Life project code.</p>

<p>For Open Tree of Life documentation, see <a href="https://github.com/OpenTreeOfLife/germinator/wiki">the germinator repository's wiki</a>. The 'deployment system' and web API documentation sources that formerly resided in this repository now live in the <a href="https://github.com/OpenTreeOfLife/germinator">germinator repository</a>.</p>

<p>The following instructions have not been reviewed in a long time. For local installation a better place to start might be <a href="https://github.com/OpenTreeOfLife/opentree/wiki/Installing-a-local-curator-and-tree-browser-test-server">this wiki page</a>.</p>

<h1><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h1>

<p>See the phylografter instructions for
more details about using web2py.</p>

<p>We strongly recommend using a virtual environment to manage the version of
Python and installed modules. We're currently running opentree with Python
v2.7.3. Newer versions of python2.7 should work, but <strong>NOTE that web2py is not
compatible with Python 3</strong>.</p>

<p>If necessary, compile Python2.7 and use it when making your virtualenv.  You
should be able to safely install multiple versions of python using your
preferred package manager, or by configuring Python2.7 with the --prefix
option and 'make altinstall'.</p>

<p>So the final invocation to create your virtualenv should look something like:</p>

<pre><code>$ virtualenv --python=/usr/bin/python2.7 --distribute &lt;path/to/new/virtualenv/&gt;
</code></pre>

<p>Or, if you're using virtualenvwrapper (<a href="http://virtualenvwrapper.readthedocs.org/en/latest/index.html">http://virtualenvwrapper.readthedocs.org/en/latest/index.html</a>):</p>

<pre><code>$ mkvirtualenv --python=python2.7 --no-site-packages --distribute opentree
</code></pre>

<p>The included <strong>requirements.txt</strong> file lists known-good versions of all the required
python modules for opentree, plus a few convenience modules. To <a href="http://www.pip-installer.org/en/latest/cookbook.html#requirements-files">install these modules 
using pip</a>, </p>

<pre>pip install -r requirements.txt
</pre>

<p>The contents of the webapp subdirectory are a web2py application.  Make a symbolic 
link called "opentree" in a web2py/applications directory to the webapp directory.
You should be able to launch web2py and see the app running at <a href="http://127.0.0.1:8000/opentree/">http://127.0.0.1:8000/opentree/</a></p>

<p>There is now a second web2py app for the curation tool, which will also need a
symlink. This will be available at <a href="http://127.0.0.1:8000/curator/">http://127.0.0.1:8000/curator/</a></p>

<p>Briefly:</p>

<ol>
<li><p>Download and unpack the source code version of web2py from 
<a href="http://www.web2py.com/examples/default/download">http://www.web2py.com/examples/default/download</a> MTH used version 2.4.2 of web2py</p>

<p>NOTE: This version of web2py includes basic support for OAuth 2.0, but it needs
a minor patch to support for login via the GitHub API v3.  (The curation app
uses GitHub for its datastore and attribution. The tree browser also uses it
for its issue tracker, with optional authentication for convenience.) Replace
this web2py file with a modified version in the same folder as this README:</p>

<pre>{web2py-2.4.4}/gluon/contrib/login_methods/oauth20_account.py
</pre></li>
<li><p>Create the sym links for the main web app and the study curation tool.</p>

<pre>cd web2py/applications
ln -s /full/path/to/opentree/webapp opentree
ln -s /full/path/to/opentree/curator curator
</pre></li>
<li><p>Customize web2py's site-wide routing behavior using "SITE.routes.py"</p>

<pre># return to main web2py directory
cd ..  
cp /full/path/to/opentree/SITE.routes.py routes.py
</pre>

<p>This routing file works in tandem with the opentree app router and lets us have
proper URLs with hyphens instead of underscores.</p></li>
<li><p>Launch web2py</p>

<pre>cd /full/path/to/web2py
python web2py.py --nogui -a '&lt;recycle&gt;'
</pre>

<p>Where the -a flag is allowing you to reuse the previous admin password that you used
with this instance of web2py.</p>

<p><strong>To test with login and proper domain name</strong>, modify your test system's
<code>/etc/hosts</code> file (or equivalent) to resolve the domain <code>devtree.opentreeoflife.org</code>
to localhost (127.0.0.1). Then run web2py on (privileged) port 80 like so:</p>

<pre>cd /full/path/to/web2py
sudo python web2py.py --nogui -p 80 -a '&lt;recycle&gt;'
</pre>

<p><strong>To test with local HTTPS</strong>, modify your test system's
<code>/etc/hosts</code> file as described above, then use a <a href="/OpenTreeOfLife/opentree/blob/master">web2py options file</a> to
support HTTP traffic on port 80 and HTTPS on port 443. This requires working
key and cert files.
to localhost (127.0.0.1). Then run web2py on (privileged) port 80 like so:</p>

<pre>cd /full/path/to/web2py
sudo python web2py.py --verbose -L multiport_options.py
</pre>

<p>This looks for the options file <code>multiport_options.py</code> in the same
directory as <code>web2py.py</code>, with contents something like this:</p>

<pre>import os 
interfaces = [(
                '0.0.0.0',
                80
             ),
             (
                '0.0.0.0',
                443,
                '/Volumes/SecureFiles/.ssh/opentree/ssl-keys/opentreeoflife.org.key',
                '/Volumes/SecureFiles/.ssh/opentree/ssl-keys/STAR_opentreeoflife_org.crt'
             )]
password = '' 
pid_filename = 'httpserver.pid' 
log_filename = 'httpserver.log' 
folder = os.getcwd() 
</pre>

<p>Now you should be able to use production domain names, secure connections,
and OAuth as in the production setup.</p></li>
</ol>

<h2><a id="user-content-subdirectories" class="anchor" href="#subdirectories" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Subdirectories</h2>

<p>mockup
: JAR's hand-written html that mock up the design of the site.</p>

<p>smasher
: construction of synthetic taxonomy. See <a href="https://github.com/OpenTreeOfLife/opentree/wiki/Open-Tree-Taxonomy">https://github.com/OpenTreeOfLife/opentree/wiki/Open-Tree-Taxonomy</a> for details</p>

<p>webapp/controllers
: python code executed by web2py when a URL is successfully mapped to a controller.</p>

<p>webapp/modules
: python code that can be imported and used by the webpp, but is not exposed as controller</p>

<p>webapp/models
: code that describes the database structure used by the web app</p>

<p>webapp/views
: templates for the page content that is rendered in response to a query. The view is typically specific to a few controllers in the web app</p>

<p>webapp/static
: static content to be returned by the web app. Contains css, images and js subdirectories for commonly used items.</p>

<p>webapp/private
: the location to be used for storing installation-specific configuration information.</p>

<p>webapp/cron
: directory that stores commands to be executed periodically by the web2py framework when the app is running.</p>

<p>webapp/databases
: the location of the database files used by web2py.</p>

<p>webapp/languages
: web2py code for internationalization</p>

<p>webapp/cache, webapp/databases, webapp/errors, webapp/sessions, webapp/uploads
: directories used by web2py to store content associated with user's activities. Content here should not need to be committed to version control.</p>

<p>curator/*
: similar subdirectories to those in webapp/* above</p>

<h2><a id="user-content-acknowledgements" class="anchor" href="#acknowledgements" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Acknowledgements</h2>

<p>Argus uses Raphaeljs and jQuery libraries.</p>

<p>Arrow icons are from <a href="http://raphaeljs.com/icons">http://raphaeljs.com/icons</a> those icons are licensed under the followin MIT license:</p>

<p>Copyright © 2008 Dmitry Baranovskiy</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>

<p>The software is provided “as is”, without warranty of any kind, express or implied, including but not limited to the warranties of merchantability, fitness for a particular purpose and noninfringement. In no event shall the authors or copyright holders be liable for any claim, damages or other liability, whether in an action of contract, tort or otherwise, arising from, out of or in connection with the software or the use or other dealings in the software.</p>
</article>
  </div></body></html>