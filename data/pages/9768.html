<html><body><div><div class="content html_format"><p>
      Раньше мы уже </p><a href="https://habrahabr.ru/post/251225/">искали</a><p> необычные модели Playboy с помощью библиотеки Python Scikit-learn. Теперь мы продемонстрируем некоторые возможности библиотек SymPy, SciPy, Matplotlib и Pandas на живом примере из разряда занимательных школьных задач по математике. Цель — облегчить порог вхождения при изучении Python библиотек для анализа данных. 

</p>

<a name="habracut"/>

<h2>Задача 1</h2>
<p>
Стоит девушка с изящными, натренированными, а главное, оголенными ножками. Скучает. Перед тем как демонстрировать свой (n+1)-ый уровень владения техникой пикапа, хочется получше рассмотреть ножки девушки — а стоит ли овчинка выделки? Получше рассмотреть — это под наибольшим углом. Можно незаметно подходить к девушке (типа вдаль смотришь), но приседать нельзя — надо же как-то и приличия соблюдать. С какого расстояния ножки видны под наибольшим углом? Допустим, Ваш рост таков, что глаза находятся на высоте m над поверхностью земли. Ноги девушки оголены до высоты f.

</p><h2>Решение</h2>

<img src="https://habrastorage.org/files/890/0a5/fed/8900a5fed924498f85160bb688bdde69.jpg"/>

<i>Картинка и перефразированная задача из «Кристоф Дрессер: Обольстить математикой. Числовые игры на все случаи жизни. Бином. Лаборатория знаний, 2015»</i>
<p>
Поясним проблему. Издалека плохо рассматривать ноги — они видны под слишком малым углом. Но и если подойти слишком близко, ноги тоже будут видны под малым углом. Где-то должно быть оптимальное расстояние.
</p><p>
Пусть x — расстояние до девушки, f — длина оголенной части ног девушки, alpha — угол, под которым ноги видны (надо максимизировать).
</p><p>
Угол alpha проще всего найти, вычитая из прямого угла углы beta и gamma. Если школьная тригонометрия еще как-то жива в закоулках мозга, легко получим, что

</p><img src="https://habrastorage.org/files/96d/382/23e/96d38223ebcc4cccbc3e6fc2cc1a00db.png"/>
<p>
Задача сводится к максимизации alpha(x) по переменной x.</p><p>
Ну это тоже просто, скажем мы: зануляем производную — и вперед! 
</p><p>
Для начала построим график функции alpha(x). Для определенности возьмем значения пераметров m=1.7 м и f=0.7 м (хотелось бы 1 м, но все же предполагается, что имеется некая юбка).
</p><p>
Теперь код. Используется сборка Anaconda и тетрадки IPython. Код воспроизводим, лежит в </p><a href="https://github.com/Yorko/ipython_demonstrations/">репозитории</a><p> GitHub.

</p><pre><code class="python"># отключим лишние предупреждения Anaconda
import warnings
warnings.filterwarnings('ignore')
# магическая команда IPython, чтоб картинки прямо в тетрадке рисовались
%pylab inline 
import numpy as np
from math import pi, atan
</code></pre>
<pre><code class="python">def alpha(x, m, f):
    return pi/2 - atan(x/m) - atan((m-f)/x)
# задаем иксы с некоторым мелким шагом
x = np.arange(0, 6, 0.05)
plot(x, [alpha(i, 1.7, 0.7) for i in x])
</code></pre>
<img src="https://habrastorage.org/files/8f3/7a9/e21/8f37a9e21fd64c42ba72c5c9d98d1c7e.png"/>
<p>
О! Предположение подтвердилось: где-то в 1-1.5 м от девушки ее ноги видны под наибольшим углом. Ну… это уже сложно без палева. Давайте теперь найдем точное значение оптимального расстояния до девушки.

</p><h2>Аналитическое решение «от руки»</h2><p>
Аналитическое решение очень простое, достаточно помнить производную арктангенса. На Хабре LaTeX не поддерживается, так что эта часть в соответствующей тетрадке IPython. </p><p>
Результат получается такой:

</p><img src="https://habrastorage.org/files/276/319/9cd/2763199cdf374a9d9674148e6abbe4cb.png"/>

<h2>Аналитическое решение с SymPy</h2><p>
SymPy — это библиотека символьных вычислений на языке Python. Мы рассмотрим, как с ее помощью вычислять производные (метод diff) и находить корни уравнений (метод solve).

</p><pre><code class="python">import sympy as sym
</code></pre><p>
Заведем символьную переменную x и функцию alpha(x). Для символьных вычислений число Пи и арктангенс тоже надо взять из SymPy.

</p><pre><code class="python">x = sym.Symbol('x')
alpha = sym.pi/2 - sym.atan(x/1.7) - sym.atan(1/x)
</code></pre>
<pre><code class="python">alpha #  -atan(1/x) - atan(0.588235294117647*x) + pi/2
</code></pre><p>
Посчитаем производную alpha'(x). Методу diff надо указать функцию, переменную, по которой происходит дифференцирование, и порядок производной, в данном случае 1.

</p><pre><code class="python">alpha_deriv = sym.diff(alpha, x, 1)
</code></pre>
<pre><code class="python">alpha_deriv # -0.59/(0.35*x**2 + 1) + 1/(x**2*(1 + x**(-2)))
</code></pre><p>
Можно убедиться, что это то же самое, что получалось, если взять в руки карандаш и бумагу. 
</p><img src="https://habrastorage.org/files/7ca/b1b/11c/7cab1b11c72942708cbe37a60b386362.png"/><p>
Как видно, к общему знаменателю SymPy просто так выражения не приводит. Для этого есть метод simplify.

</p><pre><code class="python">sym.simplify(alpha_deriv) # (-0.24*x**2 + 0.41)/((0.35*x**2 + 1)*(x**2 + 1))
</code></pre><p>
Теперь найдем нули производной с помощью метода solve.

</p><pre><code class="python">sym.solve(alpha_deriv, x) # [-1.30384048104053, 1.30384048104053]
</code></pre><p>
Опять получили, что лучше всего рассматривать девушку примерно с 1.3 м. Интересно, фотографы тоже такие вычисления проводят?

</p><h2>Численное решение c SciPy</h2>
<img src="https://habrastorage.org/files/3df/e44/e9f/3dfe44e9f7b1488ab35d31f76778a835.png"/>
<i>Картинка из курса Andrew Ng по машинному обучению</i>
<p>
В библиотеке SciPy помимо всего полезного реализованы разные методы численной оптимизации. Подробное описание многих методов минимизации одномерных и многомерных функций даны в </p><a href="http://docs.scipy.org/doc/scipy-0.15.1/reference/generated/scipy.optimize.minimize.html">документации</a><p> метода scipy.optimize.minimize.
</p><p>
Метода maximize как такового нет, поэтому задача максимизации будет эмулироваться минимизацией функции, домноженной на (-1). Рассмотрим самый простой случай — минимация скалярной функции одной переменной. Реализованы методы оптимизации 'brent', 'bounded' и 'golden', но отличия почему-то толком </p><a href="http://docs.scipy.org/doc/scipy-0.17.0/reference/generated/scipy.optimize.minimize_scalar.html#scipy.optimize.minimize_scalar">не документированы</a><p>. 

</p><pre><code class="python">from scipy.optimize import minimize_scalar
alpha = lambda x: -(pi/2 - atan(x/1.7) - atan(1/x))
result = minimize_scalar(alpha, bounds=[0., 100.], method = 'bounded')
</code></pre><p>
Ответ прежний, как и ожидалось.

</p><pre><code class="python">result.x # 1.3038404104038319
</code></pre><p>
Теперь выберем девушку, на чьи ноги будем любоваться. Вернемся к знакомому набору данных </p><a href="https://yadi.sk/d/FCGEKxaKeqDrS">girls.csv</a><p> по моделям месяца по Playboy. Выберем самую высокую из недистрофичных девушек. Заодно покажем кое-что из библиотеки Pandas. 

</p><h2>Задача 2</h2>
<p>
Найти среди моделей Playboy девушку с самым высоким ростом при «нормальном» индексе массы тела — от 18 до 18.5.

</p><h2>Решение</h2>

<pre><code class="python">import pandas as pd
girls = pd.read_csv('girls.csv') # объект Pandas.DataFrame
girls.head() # посмотреть 5 первых записей
</code></pre>
<img src="https://habrastorage.org/files/1ec/006/a89/1ec006a894c64803a932ada8e6269292.png"/>
<p>
Создадим новый признак BMI — </p><a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D0%B4%D0%B5%D0%BA%D1%81_%D0%BC%D0%B0%D1%81%D1%81%D1%8B_%D1%82%D0%B5%D0%BB%D0%B0">индекс массы тела</a><p>, равный весу, деленному на рост в метрах в квадрате.

</p><pre><code class="python">girls['BMI'] = 100 ** 2 * girls['Weight'] / (girls['Height'] ** 2)
</code></pre><p>
Построим гистограмму распределения BMI.

</p><pre><code class="python">girls['BMI'].hist()
</code></pre>

<img src="https://habrastorage.org/files/cd1/f9c/82f/cd1f9c82fe6b4d9294682cd1d717c431.png"/>
<p>
Википедия говорит, что нормальный индекс BMI — 18,5—24,99. Видим, что средний индекс у моделей Playboy примерно на нижней границе нормы. </p><p>
Отберем девушек с BMI от 18 до 18.5.

</p><pre><code class="python">selected_girls = girls[(girls['BMI'] &gt;= 18) &amp; 
      (girls['BMI'] &lt;= 18.5)]
</code></pre>
<pre><code class="python">selected_girls.sort(columns=['Height', 'Bust'], 
                    ascending=[False, False]).head(1)
#    Month  Year  Bust  Waist  Hips  Height  Weight        BMI
#430  July  1994    91     61    91     180      59  18.209877

</code></pre><p>
Это Miss July 1994 по версии Playboy Traci Adell. Дальше поисковик в помощь. Такой выбор вряд ли разочарует.
</p><p>
Итак, мы посмотрели самые основы использования библиотек Python SymPy, SciPy и Pandas. Обилие примеров уже реального использования этих библиотек можно найти в репозиториях GitHub. Один из обзоров таких репозиториев </p><a href="https://habrahabr.ru/post/270449/">тут</a><p>.

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>