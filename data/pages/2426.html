<html><body><div><section class="entry">
<p class="fsb-clear"/><p><iframe src="http://www.youtube.com/embed/oooDn5SBUAg?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p>Today’s post is a followup to a previous (extremely popular) article on <a title="Detecting Barcodes in Images with Python and OpenCV" href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/" target="_blank">detecting barcodes in images using Python and OpenCV</a>.</p>
<p>In the previous post we explored how to detect and find barcodes in <b><i>images</i></b>. But today we are going to refactor the code to detect barcodes in <strong><em>video</em></strong>.</p>
<p>As an example, check out the screenshot below (captured using a video stream from my webcam) of me holding up the back cover of <em>Modern Warfare 3</em> and the barcode being detected successfully.</p>
<div id="attachment_1687" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_detection.jpg"><img class="wp-image-1687" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_detection.jpg" alt="Figure 1: Detecting barcodes in video streams using Python and OpenCV." srcset="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_detection-300x184.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_detection.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Detecting barcodes in video streams using Python and OpenCV.</p></div>
<p><em><strong>Note: </strong>Big thanks to <a href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/#comment-196936" target="_blank">Jason</a> who commented on the original post and mentioned that it would be really cool to see barcode detection applied to video. Thanks for the suggestion! And you’re 100% right, it is really cool to see barcode detection applied to video.</em></p>
<p>For example, let’s pretend that we are working at GameStop on the 26th of December. There are a line of kids ten blocks long outside our store — all of them wanting to return or exchange a game (obviously, their parents or relatives didn’t make the correct purchase).</p>
<p>To speedup the exchange process, we are hired to wade out into the sea of teenagers and start the return/exchange process by scanning barcodes. But we have a problem — the laser guns at the register are wired to the computers at the register. And the chords won’t reach far enough into the 10-block long line!</p>
<p>However, we have a plan. <strong><em>We’ll just use our smartphones instead!</em></strong></p>
<p>Using our trusty iPhones (or Androids), we open up our camera app, set it to video mode, and head into the abyss.</p>
<p>Whenever we hold a video game case with a barcode in front of our camera, our app will detect it, and then relay it back to the register.</p>
<p>Sound too good to be true?</p>
<p>Well. Maybe it is. After all, you can accomplish this exact same task using laser barcode readers and a wireless connection. And as we’ll see later on in this post that our approach only works in certain conditions.</p>
<p>But I still think this a good tutorial on how to utilize OpenCV and Python to read barcodes in video — and more importantly, it shows you how you can glue OpenCV functions together to build a real-world application.</p>
<p>Anyway, continue reading to learn how to detect barcodes in video using OpenCV and Python!</p>

<p><strong>OpenCV and Python versions:</strong><br/>
This example will run on<strong> Python 2.7</strong> and <strong>OpenCV 2.4.X</strong>.</p>
<h1>Real-time barcode detection in video with Python and OpenCV</h1>
<p>So here’s the game plan. Our barcode detection in video system can be broken into two components:</p>
<ul>
<li><b>Component #1:</b> A module that handles detecting barcodes in images (or in this case, frames of a video) Luckily, <a title="Detecting Barcodes in Images with Python and OpenCV" href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/" target="_blank">we already have this</a>. We’ll just clean the code up a bit and reformat it to our purposes.</li>
<li><strong>Component #2: </strong>A driver program that obtains access to a video feed and runs the barcode detection module.</li>
</ul>
<p>We’ll go ahead and start with the first component, a module to detect barcodes in single frames of a video.</p>
<h2>Component 1: Barcode detection in frames of a video</h2>
<p>I’m not going to do a complete and exhaustive code review of this component, <a title="Detecting Barcodes in Images with Python and OpenCV" href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/" target="_blank">that was handled in my previous post on barcode detection in images.</a></p>
<p>However, I will provide a quick review for the sake of completeness (and review a few minor updates). Open up a new file, name it 
			<span id="crayon-56d5825d50eea429404423" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">simple_barcode_detection</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and let’s get coding:</p>

		<div id="crayon-56d5825d50ef8460578609" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-2">2</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-4">4</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-6">6</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-8">8</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-10">10</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-12">12</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-14">14</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-16">16</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-18">18</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-20">20</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-22">22</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-24">24</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-26">26</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-28">28</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-30">30</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-32">32</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-34">34</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-36">36</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-38">38</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-40">40</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-42">42</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50ef8460578609-44">44</p><p class="crayon-num" data-line="crayon-56d5825d50ef8460578609-45">45</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5825d50ef8460578609-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-4"> </p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-5"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">detect</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-6"><span class="crayon-h">	</span><span class="crayon-c"># convert the image to grayscale</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-7"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-8"> </p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-9"><span class="crayon-h">	</span><span class="crayon-c"># compute the Scharr gradient magnitude representation of the images</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-10"><span class="crayon-h">	</span><span class="crayon-c"># in both the x and y direction</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-11"><span class="crayon-h">	</span><span class="crayon-v">gradX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Sobel</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ddepth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">cv</span><span class="crayon-sy">.</span><span class="crayon-v">CV_32F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ksize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-12"><span class="crayon-h">	</span><span class="crayon-v">gradY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Sobel</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ddepth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">cv</span><span class="crayon-sy">.</span><span class="crayon-v">CV_32F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ksize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-14"><span class="crayon-h">	</span><span class="crayon-c"># subtract the y-gradient from the x-gradient</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-15"><span class="crayon-h">	</span><span class="crayon-v">gradient</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">subtract</span><span class="crayon-sy">(</span><span class="crayon-v">gradX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">gradY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-16"><span class="crayon-h">	</span><span class="crayon-v">gradient</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">convertScaleAbs</span><span class="crayon-sy">(</span><span class="crayon-v">gradient</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-17"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-18"><span class="crayon-h">	</span><span class="crayon-c"># blur and threshold the image</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-19"><span class="crayon-h">	</span><span class="crayon-v">blurred</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">blur</span><span class="crayon-sy">(</span><span class="crayon-v">gradient</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-20"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thresh</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">threshold</span><span class="crayon-sy">(</span><span class="crayon-v">blurred</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">225</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">THRESH_BINARY</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-21"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-22"><span class="crayon-h">	</span><span class="crayon-c"># construct a closing kernel and apply it to the thresholded image</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-23"><span class="crayon-h">	</span><span class="crayon-v">kernel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">getStructuringElement</span><span class="crayon-sy">(</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">MORPH_RECT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">21</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-24"><span class="crayon-h">	</span><span class="crayon-v">closed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">morphologyEx</span><span class="crayon-sy">(</span><span class="crayon-v">thresh</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">MORPH_CLOSE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-25"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-26"><span class="crayon-h">	</span><span class="crayon-c"># perform a series of erosions and dilations</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-27"><span class="crayon-h">	</span><span class="crayon-v">closed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">erode</span><span class="crayon-sy">(</span><span class="crayon-v">closed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-28"><span class="crayon-h">	</span><span class="crayon-v">closed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">dilate</span><span class="crayon-sy">(</span><span class="crayon-v">closed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-29"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-30"><span class="crayon-h">	</span><span class="crayon-c"># find the contours in the thresholded image</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-31"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">findContours</span><span class="crayon-sy">(</span><span class="crayon-v">closed</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">RETR_EXTERNAL</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-32"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CHAIN_APPROX_SIMPLE</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-33"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-34"><span class="crayon-h">	</span><span class="crayon-c"># if no contours were found, return None</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-35"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-36"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">None</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-37"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-38"><span class="crayon-h">	</span><span class="crayon-c"># otherwise, sort the contours by area and compute the rotated</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-39"><span class="crayon-h">	</span><span class="crayon-c"># bounding box of the largest contour</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-40"><span class="crayon-h">	</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">sorted</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">contourArea</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">reverse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-41"><span class="crayon-h">	</span><span class="crayon-v">rect</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">minAreaRect</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-42"><span class="crayon-h">	</span><span class="crayon-v">box</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">int0</span><span class="crayon-sy">(</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">cv</span><span class="crayon-sy">.</span><span class="crayon-e">BoxPoints</span><span class="crayon-sy">(</span><span class="crayon-v">rect</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-43"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50ef8460578609-44"><span class="crayon-h">	</span><span class="crayon-c"># return the bounding box of the barcode</span></p><p class="crayon-line" id="crayon-56d5825d50ef8460578609-45"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">box</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>If you read the <a title="Detecting Barcodes in Images with Python and OpenCV" href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/" target="_blank">previous post on barcode detection in images</a> then this code should look extremely familiar.</p>
<p>The first thing we’ll do is import the packages we’ll need — NumPy for numeric processing and 
			<span id="crayon-56d5825d50efe016862279" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span></span></span>  for our OpenCV bindings.</p>
<p>From there we define our 
			<span id="crayon-56d5825d50f02438406891" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect</span></span></span>  function on <strong>Line 5</strong>. This function takes a single argument, the 
			<span id="crayon-56d5825d50f06089438050" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">image</span></span></span>  (or frame of a video) that we want to detect a barcode in.</p>
<p><strong>Line 7</strong> converts our image to grayscale, while <strong>Lines 9-16</strong> find regions of the image that have high horizontal gradients and low vertical gradients (again, if you would like more detail on this part of the code, refer to the <a title="Detecting Barcodes in Images with Python and OpenCV" href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/" target="_blank">previous post on barcode detection</a>).</p>
<p>We then blur and threshold the image on <strong>Lines 19 and 20</strong> so we can apply morphological operations to the image on <strong>Lines 23-28</strong>. These morphological operations are used to reveal the rectangular region of the barcode and ignore the rest of the contents of the image.</p>
<p>Now that we know the rectangular region of the barcode, we find its contour (or simply, its “outline”) on <strong>Lines 30 and 31</strong>.</p>
<p>If no outline can be found, then we make the assumption that there is no barcode in the image (<strong>Lines 35 and 36</strong>).</p>
<p>However, if we do find contours in the image, then we sort the contours by their area on <strong>Line 40</strong> (where the contours with the largest area appear at the front of the list). Again, we are making the assumption that the contour with the largest area is the barcoded region of the frame.</p>
<p>Finally, we take the contour and compute its bounding box (<strong>Lines 41 and 42</strong>). This will give us the <em>(x, y)</em> coordinates of the barcoded region, which is returned to the calling function on <strong>Line 45</strong>.</p>
<p>Now that our simple barcode detector is finished, let’s move on to Component #2, the driver that glues everything together.</p>
<h2>Component #2: Accessing our camera to detect barcodes in video</h2>
<p>Let’s move on to building the driver to detect barcodes in video. Open up a new file, name it 
			<span id="crayon-56d5825d50f0b172347600" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect_barcode</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and let’s create the second component:</p>

		<div id="crayon-56d5825d50f0f039551479" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-2">2</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-4">4</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-6">6</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-8">8</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-10">10</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-12">12</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-14">14</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-16">16</p><p class="crayon-num" data-line="crayon-56d5825d50f0f039551479-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f0f039551479-18">18</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5825d50f0f039551479-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">pyimagesearch </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">simple_barcode_detection</span></p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-6"><span class="crayon-c"># construct the argument parse and parse the arguments</span></p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-7"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-8"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-v"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--video"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">help</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"path to the (optional) video file"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-9"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-10"> </p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-11"><span class="crayon-c"># if the video path was not supplied, grab the reference to the</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-12"><span class="crayon-c"># camera</span></p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-13"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"video"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-14"><span class="crayon-h">	</span><span class="crayon-v">camera</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">VideoCapture</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-15"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-16"><span class="crayon-c"># otherwise, load the video</span></p><p class="crayon-line" id="crayon-56d5825d50f0f039551479-17"><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f0f039551479-18"><span class="crayon-h">	</span><span class="crayon-v">camera</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">VideoCapture</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"video"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Again, we’ll start our by importing the packages we need. I’ve placed our 
			<span id="crayon-56d5825d50f13069506835" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">simple_barcode_detection</span></span></span>  function in the 
			<span id="crayon-56d5825d50f16431965282" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pyimagesearch</span></span></span>  module for organizational purposes. Then, we import 
			<span id="crayon-56d5825d50f1a301535620" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">argparse</span></span></span>  for parsing command line arguments and 
			<span id="crayon-56d5825d50f1e259764475" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span></span></span>  for our OpenCV bindings.</p>
<p><strong>Lines 6-9</strong> handle parsing our command line arguments. We’ll need a single (optional) switch, 
			<span id="crayon-56d5825d50f21079088800" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">video</span></span></span> , which is the path to the video file on desk that contains the barcodes we want to detect.</p>
<p><em><strong>Note:</strong> This switch is useful for running the example videos provided in the source code for this blog post. By omitting this </em><em>switch you will be able to utilize the webcam of your laptop or desktop.</em></p>
<p><strong>Lines 13-18</strong> handle grabbing a reference to our 
			<span id="crayon-56d5825d50f25665574314" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">camera</span></span></span>  feed. If we <em>did not</em> supply a 
			<span id="crayon-56d5825d50f29990393623" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">video</span></span></span>  switch, then we grab a handle to our webcam on <strong>Lines 13 and 14</strong>. However, if we <em>did</em> provide a path to a video file, then the file reference is grabbed on <strong>Lines 17 and 18</strong>.</p>
<p>Now that the setup is done, we can move on to applying our actual barcode detection module:</p>

		<div id="crayon-56d5825d50f2d733088908" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-2">2</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-4">4</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-6">6</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-8">8</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-10">10</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-12">12</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-14">14</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-16">16</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-18">18</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-20">20</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-22">22</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-24">24</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5825d50f2d733088908-26">26</p><p class="crayon-num" data-line="crayon-56d5825d50f2d733088908-27">27</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5825d50f2d733088908-1"><span class="crayon-c"># keep looping over the frames</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-2"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-3"><span class="crayon-h">	</span><span class="crayon-c"># grab the current frame</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-4"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">grabbed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">camera</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-5"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-6"><span class="crayon-h">	</span><span class="crayon-c"># check to see if we have reached the end of the</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-7"><span class="crayon-h">	</span><span class="crayon-c"># video</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-8"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">grabbed</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-9"><span class="crayon-h">		</span><span class="crayon-st">break</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-10"> </p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-11"><span class="crayon-h">	</span><span class="crayon-c"># detect the barcode in the image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-12"><span class="crayon-h">	</span><span class="crayon-v">box</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">simple_barcode_detection</span><span class="crayon-sy">.</span><span class="crayon-e">detect</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-14"><span class="crayon-h">	</span><span class="crayon-c"># if a barcode was found, draw a bounding box on the frame</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-15"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">drawContours</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">box</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-16"> </p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-17"><span class="crayon-h">	</span><span class="crayon-c"># show the frame and record if the user presses a key</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-18"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Frame"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-19"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">0xFF</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-20"> </p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-21"><span class="crayon-h">	</span><span class="crayon-c"># if the 'q' key is pressed, stop the loop</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-22"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-k ">ord</span><span class="crayon-sy">(</span><span class="crayon-s">"q"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-23"><span class="crayon-h">		</span><span class="crayon-st">break</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-24"> </p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-25"><span class="crayon-c"># cleanup the camera and close any open windows</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5825d50f2d733088908-26"><span class="crayon-v">camera</span><span class="crayon-sy">.</span><span class="crayon-e">release</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5825d50f2d733088908-27"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">destroyAllWindows</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On <strong>Line 21</strong> we start looping over the frames of our video — this loop will continue to run until (1) the video runs out of frames or (2) we press the 
			<span id="crayon-56d5825d50f31642373752" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">q</span></span></span>  key on our keyboard and break from the loop.</p>
<p>We query our 
			<span id="crayon-56d5825d50f35256987833" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">camera</span></span></span>  on <strong>Line 23</strong>, which returns a 2-tuple. This 2-tuple contains a boolean, 
			<span id="crayon-56d5825d50f38164394812" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">grabbed</span></span></span> , which indicates if the frame was successfully grabbed from the video file/webcam, and 
			<span id="crayon-56d5825d50f3c039156754" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span> , which is the actual frame from the video.</p>
<p>If the frame was not successfully grabbed (such as when we reach the end of the video file), we break from the loop on <strong>Lines 27 and 28</strong>.</p>
<p>Now that we have our frame, we can utilize our barcode detection module to detect a barcode in it — this handled on <strong>Line 31</strong> and our bounding box is returned to us.</p>
<p>We draw our resulting bounding box around the barcoded region on <strong>Line 34</strong> and display our frame to our screen on <strong>Lines 37 and 38</strong>.</p>
<p>Finally, <strong>Lines 41 and 42</strong> handle breaking from our loop if the 
			<span id="crayon-56d5825d50f40013984767" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">q</span></span></span>  key is pressed on our keyboard while <strong>Lines 45 and 46</strong> cleanup pointers to our camera object.</p>
<p>So as you can see, there isn’t much to our driver script!</p>
<p>Let’s put this code into action and look at some results.</p>
<h1>Successful barcode detections in video</h1>
<p>Let’s try some some examples. Open up a terminal and issue the following command:</p>

		<div id="crayon-56d5825d50f44997658130" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5825d50f44997658130-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">detect_barcode</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">video </span><span class="crayon-v">video</span><span class="crayon-o">/</span><span class="crayon-v">video_games</span><span class="crayon-e">.mov</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The video at the top of this post demonstrates the output of our script. And below is a screenshot for each of the three successful barcode detections on the video games:</p>
<div id="attachment_1689" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_video_games.jpg"><img class="wp-image-1689" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_video_games.jpg" alt="Figure 2: Successfully detecting the barcode of three XBox video games in a video stream." srcset="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_video_games-300x162.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_video_games-1024x553.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_video_games.jpg 1400w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Successfully detecting the barcode of three XBox video games in a video stream.</p></div>
<p>Let’s see if we can detect barcodes on a clothing coupon:</p>

		<div id="crayon-56d5825d50f48936327084" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5825d50f48936327084-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">detect_barcode</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">video </span><span class="crayon-v">video</span><span class="crayon-o">/</span><span class="crayon-v">coupon</span><span class="crayon-e">.mov</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Here’s an example screenshot from the video stream:</p>
<div id="attachment_1690" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_coupon.jpg"><img class="wp-image-1690" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_coupon.jpg" alt="Figure 3: Another successful barcode detection using Python and OpenCV." srcset="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_coupon-631x1024.jpg 631w, http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_coupon.jpg 800w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Another successful barcode detection using Python and OpenCV.</p></div>
<p>And the full video of the output:</p>
<p><iframe src="http://www.youtube.com/embed/YlF8hI5BGi8?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p>Of course, like I said that this approach only works in optimal conditions (see the following section for a detailed description of limitations and drawbacks).</p>
<p>Here is an example of where the barcode detection did not work:</p>
<div id="attachment_1691" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_02.jpg"><img class="wp-image-1691" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_02.jpg" alt="Figure 4: An unsuccessful barcode detection. The barcode is too far away from the camera." srcset="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_02-300x184.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_02.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 4:</strong> An unsuccessful barcode detection. The barcode is too far away from the camera.</p></div>
<p>In this case, the barcode is too far away from the camera and there are too many “distractions” and “noise” in the image, such as large blocks of text on the video game case.</p>
<p>This example is also clearly a failure, I just thought it was funny to include:</p>
<div id="attachment_1692" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_01.jpg"><img class="wp-image-1692" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_01.jpg" alt="Figure 5: My ear is clearly not a barcode." srcset="http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_01-300x184.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2014/12/video_barcode_invalid_01.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 5:</strong> My ear is clearly not a barcode.</p></div>
<p>Again, this simple implementation of barcode detection will not work in all cases. It is not a robust solution, but rather an example of how simple image processing techniques can give surprisingly good results, provided that assumptions in the following section are met.</p>
<h1>Limitations and Drawbacks</h1>
<p>So as we’ve seen in this blog post, our approach to detecting barcodes in images works well — <em>provided we make some assumptions regarding the videos we are detecting barcodes in.</em></p>
<p>The <strong>first assumption</strong> is that we have a static camera that is “looking down” on the barcode at a 90-degree angle. This will ensure that the gradient region of the barcoded image will be found by our simple barcode detector.</p>
<p>The <strong>second assumption</strong> is that our video has a “close up” of the barcode, meaning that we are holding our smartphones directly overtop of the barcode, and not holding the barcode far away from the lens. The farther we move the barcode away from the camera, the less successful our simple barcode detector will be.</p>
<p>So how do we improve our simple barcode detector?</p>
<p>Great question.</p>
<p>Christoph Oberhofer has provided a <a href="http://www.oberhofer.co/how-barcode-localization-works-in-quaggajs/" target="_blank">great review on how robust barcode detection is done in QuaggaJS</a>. And my friend Dr. Tomasz Malisiewicz has written a <a href="http://quantombone.blogspot.com/2014/11/barcodes-realtime-training-and.html" target="_blank">fantastic post</a> on how his VMX software can be utilized to train barcode detectors using machine learning. If you’re looking for the next steps, be sure to check out those posts!</p>
<h1>Summary</h1>
<p>In this blog post we built upon our <a title="Detecting Barcodes in Images with Python and OpenCV" href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/" target="_blank">previous codebase to detect barcodes in images</a>. We extended our code into two components:</p>
<ul>
<li>A component to detect barcodes in individual frames of a video.</li>
<li>And a “driver” component that accesses the video feed of our camera or video file.</li>
</ul>
<p>We then applied our simple barcode detector to detect barcodes in video.</p>
<p>However, our approach does make some assumptions:</p>
<ul>
<li>The first assumption is that we have a static camera view that is “looking down” on the barcode at a 90-degree angle.</li>
<li>And the second assumption is that we have a “close up” view of the barcode without other interfering objects or noise in the view of the frame.</li>
</ul>
<p>In practice, these assumptions may or may-not be guaranteeable. It all depends on the application you are developing!</p>
<p>At the very least I hope that this article was able to demonstrate to you some of the basics of image processing, and how these image processing techniques can be leveraged to build a simple barcode detector in video using Python and OpenCV.</p>
<h1 id="post_downloads">Downloads:</h1>

	</section>
	</div></body></html>