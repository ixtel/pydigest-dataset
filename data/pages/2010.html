<html><body><div><div class="content">
            <section class="post">
                <header class="post-header">
                    
                    <h1>Flask Google Maps (plus: how to write a Flask extension)</h1>
                    
                    
                    <p class="post-meta">
                    

   <small class="breadcrumb">
      
          
          &gt; <span><a href="http://brunorocha.org/python/">python</a></span>
          
      
          
          &gt; <span><a href="http://brunorocha.org/python/flask/">flask</a></span>
          
      
   </small>


                    </p>
                    
                    <p class="post-meta">
                        // Tags 
                            <a class="post-category" href="http://brunorocha.org/tag/python/">python</a>
                        
                            <a class="post-category" href="http://brunorocha.org/tag/pyplanet/">pyplanet</a>
                        
                            <a class="post-category" href="http://brunorocha.org/tag/pythonplanet/">pythonplanet</a>
                        
                            <a class="post-category" href="http://brunorocha.org/tag/flask/">flask</a>
                        
                            <a class="post-category" href="http://brunorocha.org/tag/google/">google</a>
                        
                    </p>
                </header>

                 
                      
                            <p>
                            </p>
                      
                 

            </section>

            <p>Last week I was writing a talk to give at <a href="http://developerbus.withgoogle.com/sao-paulo/">Google Developers Bus</a> and I needed to show how to integrate Flask and Google Maps API, 
as I did not found any extension to Google Maps I decided to create one.</p>
<p>One of the best things in Flask is the way it is extended by Extensions and Blueprints,  by the way, <strong>Blueprints</strong> is one of
the best idea I've seem in Python web frameworks, once you start working with Blueprints you want to use it everywhere
(but unfortunatelly not every framework has an ellegant way to be extended)</p>
<p>I will start showing how the extension works and then I will explain how to build it from scratch.</p>
<h2>Flask Google Maps</h2>
<p><strong>Template filter</strong> and a <strong>template global</strong> to create Google Maps from latitude and longitude</p>
<h3>Installing</h3>
<p><code>pip install flask-googlemaps</code></p>
<h3>Loading in your app</h3>
<pre><code>from flask import Flask
from flask.ext.googlemaps import GoogleMaps
app = Flask(__name__)
GoogleMaps(app)
</code></pre>
<h3>Using in templates</h3>
<pre><code>&lt;div&gt;
{{ googlemap('identifier', **params)}}
&lt;/div&gt;

&lt;div&gt;
{{googlemap("map_name", lat=-0.12, lng=-0.45, markers=[(lat, lng), (lat, lng)]}} 
&lt;/div&gt;
</code></pre>
<p>Parameters:</p>
<pre><code>- identifier: The name tat will be used to identify your map (you can have multiple maps in one page)
- lat:  latitude to center the map
- lng: Longitude to center the map
- markers:  a list of tuples, each tuple is a (lat, lng) marker (a pointer in the map)
- zoom: percentage of the zoom
- maptype: Google map type, TERRAIN or ROADMAP. defaults to ROADMAP
- varname: The JS varname to bind the map, defaults to "map"
- style: css style to be appended to the &lt; div &gt;
- cls: css class to the map &lt; div &gt;
</code></pre>
<blockquote><p>TODO: In near future it will be possible to pass an address as argument</p>
</blockquote>
<h3>Example</h3>
<h4>The template</h4>
<pre><code>&lt;body&gt;
&lt;h1&gt;Flask Google Maps Example&lt;/h1&gt;

&lt;h2&gt; Google Dev Bus - Rua Quatá, 255 &lt;/h2&gt;
{% with %}

    {% set location=(-23.599097,-46.675903) %}
    {% set style="width:500px;height:500px;"%}

    {{
    googlemap(
        "simple-map",
        location.0, location.1,
        markers=[location,],
        style=style
        )
    }}

{% endwith %}
&lt;/body&gt;
</code></pre>
<h4>The output</h4>
<p><img src="http://brunorocha.org/mediafiles/image/2013/11/Flask_Google_Maps_Example_58870.png" alt="map"/></p>
<h3>Github</h3>
<p>Screenshots and docs on Github.</p>
<p><a href="https://github.com/rochacbruno/Flask-GoogleMaps">https://github.com/rochacbruno/Flask-GoogleMaps</a></p>
<h2>How to create a Flask Extension</h2>
<p>Flask is extendable by two patterns <strong>Extension</strong> and <strong>Blueprint</strong></p>
<p>An Extension is something like a complete plugin, a distribution containing models, views, templates, static files, template globals and filters etc
and usually an Extension is built of Blueprints, which is an <strong>app prototype</strong>, it can define the way an app will be when registered, exposing resources, 
and url rules, also the Blueprint has the capability to access the current running application to contribute with things like config values, template filters, etc.</p>
<p>In the Flask docs there is a great explanation on <a href="http://flask.pocoo.org/docs/extensions/">Extensions</a> and <a href="http://flask.pocoo.org/docs/blueprints/">Blueprints</a></p>
<h2>Anathomy of an extension</h2>
<p>An extension is just a Python package following the naming convention <strong>Flask_anything</strong>, with packages naming like that Flask will automatically find them in the Python PATH via the <strong>ext</strong> proxy. So instead of <strong>from flask_anything import something</strong> you can do <strong>from flask.ext.anything import something</strong> 
in that way the code will be very clear and explicit and you know you are dealing with a Flask extension.</p>
<h4>Flask-Anything</h4>
<pre><code>root folder
|__ flask_anything/
    |__ templates/
    |__ static/
    |__ __init__.py
    |__ __some_module.py
    |__ *
|__ setup.py
</code></pre>
<p>That is it! you can write really <strong>anything</strong> you want and it will be available throught <strong>from flask.ext.anything.some_module import FooBar</strong></p>
<h4>What is inside?</h4>
<p>Usually extensions expose a main Class which will be registered in your <strong>app</strong>, there is <a href="http://flask.pocoo.org/docs/extensions/#using-extensions">no rule</a>, but there is some conventions, an example:</p>
<pre><code># flask.ext.anything.some_module.py

from flask import Blueprint

class Anything(object):
    def __init__(self, app=None, **kwargs):
        for k, v in kwargs.items():
            setattr(self, k, v)

        if app:
            self.init_app(app)

    def init_app(self, app):
        # here you get the app object and can do anything you want
        app.add_template_filter("pass a template filter function here")
        app.add_template_global("pass a template global here")

        app.add_url_rule("/anything/&lt;arg&gt;", view_func=self.something)

        #or even better you can register a Blueprint
        module = self.create_blueprint("module")
        another_module = self.create_another_blueprint("another_module")

        # then you can register many blueprints in the app
        app.register_blueprint(module)
        app.register_blueprint(another_module)


    def create_blueprint(self, blueprint_name):
        module =  Blueprint(blueprint_name, __name__, template_folder="a_path_to_relative_folder")
        module.add_app_template_filter(...)
        module.add-app_template_global(...)
        module.add_url_rule("/something/&lt;argument&gt;", view_func=self.some_view)
        return module

    def some_view(self, argument):
        context = {'argument': argument}
        return self.render(self.get_template_name, context)

    def render(self, *args, **kwargs):
        return render_template(*args, **kwargs)

    ...
</code></pre>
<blockquote><p>By the community convention your extension main class should receive its configurations in <code>__init__</code> method and should have a lazy way to init defined as a method called <code>init_app</code>, also is a good practice to create methods for things like <code>create_blueprint</code>,  <code>register_blueprint</code>,  <code>get_url_rules</code> and also a <code>render_template</code> method inside your Blueprint is usefull. That is because others could extend your class and overwrite them, in example to use Flask-Themes it is usefull to overwrite the <code>render_template</code> method.</p>
</blockquote>
<h3>Using your extension/Blueprint</h3>
<pre><code># your_app.py

from flask import Flask
from flask.ext.anything.some_module import Anything

app = Flask(__name__)

# option 1
Anything(app)

# option 2
anything = Anything()
anything.init_app(app)
</code></pre>
<p>With the above instantiation/init_app your app will be <strong>manipulated</strong> by the extension and the views, urls, template filters etc will be available.</p>
<blockquote><p>There is more conventions to follow as <strong>state</strong>, <strong>namespace</strong>, <strong>resource access</strong> etc, but you can find all the information on<a href="http://flask.pocoo.org/docs/"> Flask docs.</a></p>
</blockquote>
<p>If you have some idea to improve Flask-GoogleMaps, please comment!</p>


            
                


            

            
                




            

            
                

 
   
      
        
     
 


            

            
                
    
            <hr/>
            <p class="post-meta">
                // Comment
            </p>
        
           
                   <p id="disqus_thread"/>
    
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
           
        
    

            

            
               <a href="http://brunorocha.org/" class="go-top">Go Top</a>
               <footer class="footer">
    <p>
        <span>Powered by <a href="http://www.quokkaproject.org">Quokka CMS</a></span>
        © BrunoRocha.org | Python web development –
        Based in <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a> – 
        Access the <a href="http://brunorocha.org/admin">Admin</a> interface
    </p>
</footer>
            
        </div>
    </div></body></html>