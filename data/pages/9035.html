<html><body><div><div class="entry-content">
					<p>To quote Wikipedia, <strong><a href="https://en.wikipedia.org/wiki/Reactive_programming">Reactive Programming</a></strong> is a programming paradigm oriented around <a title="Dataflow programming" href="https://en.wikipedia.org/wiki/Dataflow_programming">data flows</a> and the <em>propagation of change</em>.</p>
<p>Consider the simple equation <img src="https://s0.wp.com/latex.php?latex=a+%3D+b+%2B+c&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a = b + c" title="a = b + c" class="latex"/>. This relationship defines a <em>flow of data</em>, in that it describes how the data for <img src="https://s0.wp.com/latex.php?latex=a&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a" title="a" class="latex"/> is computed given the data for <img src="https://s0.wp.com/latex.php?latex=b&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="b" title="b" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=c&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="c" title="c" class="latex"/>. Suppose the values of <img src="https://s0.wp.com/latex.php?latex=b&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="b" title="b" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=c&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="c" title="c" class="latex"/> at time t=0 are 4 and 5 respectively. Therefore, <img src="https://s0.wp.com/latex.php?latex=a_%7Bt%3D0%7D+%3D+9&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a_{t=0} = 9" title="a_{t=0} = 9" class="latex"/>. Now, lets say that the value of <img src="https://s0.wp.com/latex.php?latex=b&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="b" title="b" class="latex"/> changes at t=1 so that <img src="https://s0.wp.com/latex.php?latex=b_%7Bt%3D1%7D+%3D+10&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="b_{t=1} = 10" title="b_{t=1} = 10" class="latex"/>. By the definition of <img src="https://s0.wp.com/latex.php?latex=a&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a" title="a" class="latex"/> mentioned before, it follows that <img src="https://s0.wp.com/latex.php?latex=a_%7Bt%3D1%7D%3D15&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a_{t=1}=15" title="a_{t=1}=15" class="latex"/>. Thus, the change in the value of <img src="https://s0.wp.com/latex.php?latex=b&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="b" title="b" class="latex"/> got <em>propagated</em>, causing the value of its ‘parent’ <img src="https://s0.wp.com/latex.php?latex=a&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a" title="a" class="latex"/> to change. I use the word <em>parent</em> because if we were to draw the relationship between <img src="https://s0.wp.com/latex.php?latex=a&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a" title="a" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=b&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="b" title="b" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=c&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="c" title="c" class="latex"/> as a tree, <img src="https://s0.wp.com/latex.php?latex=a&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="a" title="a" class="latex"/> be the parent of <img src="https://s0.wp.com/latex.php?latex=b&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="b" title="b" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=c&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="c" title="c" class="latex"/> (like in a data flow graph). A common example of reactive programming is seen in spreadsheet software like MS-Excel, where the change in the value of a particular cell causes a change in the values of cells that depend on it by some pre-defined equation.</p>
<p><a href="https://github.com/Reactive-Extensions/RxJS">RxJS</a> and <a href="https://www.meteor.com/why-meteor/features">Meteor</a> are two javascript-based frameworks that implement reactive programming for web-based applications.</p>
<p>Reactivity, in general, is a paradigm that’s difficult to find in Python-based systems, and that includes Django. This post describes a method to perform <em>mathematical computations </em>(not reactive programming in general, just mathematical calculations) in a reactive manner in Django-based systems. I will soon describe the exact problem solved by my code, with suggestions on how to modify it to suit your needs.</p>
<p><span><strong>Prerequisites</strong></span></p>
<p>Heres the prerequisites, apart from <a href="https://www.djangoproject.com/">Django</a>:</p>
<p>i. We will use <a href="http://www.celeryproject.org/">Celery</a> to perform tasks asynchronously.</p>
<p>ii. We will use <a href="http://redis.io/">Redis</a> as for temporary data storage, and <a href="https://en.wikipedia.org/wiki/Lock_%28computer_science%29">synchronization</a>.</p>
<p><a href="http://michal.karzynski.pl/blog/2014/05/18/setting-up-an-asynchronous-task-queue-for-django-using-celery-redis/">This</a> is a good place to look if you want to set up both.</p>
<p>iii. We will use <a href="https://pypi.python.org/pypi/python-redis-lock">python-redis-lock</a> to use Redis for locking mechanisms. Locking ensures that one data update/read doesn’t get messed up due to another update that’s running in parallel.</p>
<p><span><strong>The ‘Problem Statement’</strong></span></p>
<p>Consider the two equations:</p>
<p><img src="https://s0.wp.com/latex.php?latex=A+%3D+C+%2B+D+%2B+E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A = C + D + E" title="A = C + D + E" class="latex"/> …(1)</p>
<p><img src="https://s0.wp.com/latex.php?latex=B+%3D+A+%2A+F&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B = A * F" title="B = A * F" class="latex"/> …(2)</p>
<p>We will refer to <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=C&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="C" title="C" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="D" title="D" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="E" title="E" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=F&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="F" title="F" class="latex"/> as <em>computational nodes</em>. <img src="https://s0.wp.com/latex.php?latex=C&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="C" title="C" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="D" title="D" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="E" title="E" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=F&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="F" title="F" class="latex"/> are input values that we acquire from certain sources of data (whatever they might be). They are essentially the <em>independent variables</em> in this context. <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/>‘s value is derived <img src="https://s0.wp.com/latex.php?latex=C&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="C" title="C" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="D" title="D" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="E" title="E" class="latex"/> (making it their ‘parent’ node). You can also say that <img src="https://s0.wp.com/latex.php?latex=C&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="C" title="C" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="D" title="D" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="E" title="E" class="latex"/> are the <em>arguments</em> for <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/>. <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/> in turn has two dependencies, <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> and another independent variable <img src="https://s0.wp.com/latex.php?latex=F&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="F" title="F" class="latex"/>.</p>
<p>You don’t know when you will receive the values of the independent variables. You also don’t know what order they will arrive in. Some of them may come together, some very frequently, etc. etc. Lets say that your application dictates that the value of any node remains valid for about a minute its received or computed. Whenever you have had the latest values of <img src="https://s0.wp.com/latex.php?latex=C&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="C" title="C" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="D" title="D" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="E" title="E" class="latex"/> come within the past 60 seconds, you would want to compute the value of <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/>. The same logic applies to <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/>.</p>
<p>Once the latest value of <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> is computed, you would like the node to ‘forget’ the values of its arguments(children). Therefore, whenever comes the next time that we have fresh values of <img src="https://s0.wp.com/latex.php?latex=C&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="C" title="C" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="D" title="D" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="E" title="E" class="latex"/> together, <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> will be calculated again. The same logic once again applies to <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/>. The code can be easily modified (and I will mention how) so that this restriction is lifted. In that case, <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> would be recomputed whenever the value of any of <img src="https://s0.wp.com/latex.php?latex=C&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="C" title="C" class="latex"/>, <img src="https://s0.wp.com/latex.php?latex=D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="D" title="D" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=E&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="E" title="E" class="latex"/> changes, provided that the other values are still valid.</p>
<p>Whenever you receive/compute the value of a computational node (whether independent or derived), you would want to store its value – along with the appropriate timestamp – in your database.</p>
<p>Now lets see how this data-flow logic can be implemented in a flexible, efficient manner.</p>
<p><span><strong>The Implementation</strong></span></p>
<p>The whole functionality will be enclosed in a Django App called ‘reactive_compute’. It will have the following files:</p>
<p>i. models.py</p>
<p>ii. admin.py</p>
<p>iii. db.py</p>
<p>iv. functions.py</p>
<p>v. functions.py</p>
<p>and obviously</p>
<p>vi. __init__.py</p>
<p>First of all, we will need to define the derived nodes <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/>, in terms of their <em>Function</em> and <em>Number of Arguments</em>. For example, <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/>‘s function can be described as an <em>Addition</em>, with the number of arguments being 3. <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/> on the other hand is a <em>Multiplication</em>, with 2 arguments. To remember this, we will first need to define the database model in <em>models.py</em>. You don’t store this information in Redis, since its ‘permanent’.</p>
<p>The model:</p>
<pre class="brush: python; title: ; notranslate" title="">
from django.db import models


class FunctionType(models.Model):
    """
    Stores information about the type of function/computation
    associated with a node.
    The function name should have a corresponding mapping in
    reactivecompute.functions.Functions.mapping
    """

    node = models.CharField('Node', max_length=25)
    functionname = models.CharField('Function Name', max_length=25)
    noofargs = models.IntegerField('Number of Arguments')
</pre>
<p>As you can see, <img src="https://s0.wp.com/latex.php?latex=functionname&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="functionname" title="functionname" class="latex"/> is a String that will act as an identifier for the Function. We will have “<img src="https://s0.wp.com/latex.php?latex=ADD&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="ADD" title="ADD" class="latex"/>” for Addition, and “<img src="https://s0.wp.com/latex.php?latex=MUL&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="MUL" title="MUL" class="latex"/>” for Multiplication. But there must be someplace to implement those functions. Thats where the <em>functions.py</em> files comes in.</p>
<pre class="brush: python; title: ; notranslate" title="">

##File with all computational functions


def add(args):
    """
    Addition Function.
    """
    return sum(args)


def sub(args):
    """
    Subtraction Function.
    """
    return (args[0] - args[1])


def mul(args):
    """
    Multiplication function.
    """
    prod = 1
    for arg in args:
        prod *= arg
    return prod


class Functions(object):
    """
    Class to store mapping between function name and function
    implementation.
    """

    mapping = {
        'ADD': add,
        'SUB': sub,
        'MUL': mul
        }

</pre>
<p>Adding the mapping as a dictionary to the <img src="https://s0.wp.com/latex.php?latex=Functions&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="Functions" title="Functions" class="latex"/> class allows easy importing. Each of the functions takes in the arguments(in appropriate order) as a list.</p>
<p>The following screenshot shows the appropriate database entries made for <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/> in the Django Admin.</p>
<p><a href="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225104.png" rel="attachment wp-att-306"><img class="wp-image-306 aligncenter" src="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225104.png?w=590&amp;h=332" alt="Screenshot from 2016-01-04 22:51:04"/></a></p>
<p>Now that we have defined the ‘nodes’ we need to direct the appropriate <em>args</em> to them. This is done by creating another model in <em>models.py</em>, for storing the data-flow information as tree ‘edges’. Every <em>child</em> is an argument for the <em>parent</em>.</p>
<pre class="brush: python; title: ; notranslate" title="">

class Dependency(models.Model):
    """
    Models a Parent-Child relationship between computational
    nodes. Also defines the order in which the children are to be
    arranged, to get the Parent's value.
    """

    parent = models.CharField('Parent Node', max_length=25)
    child = models.CharField('Child Node', max_length=25)
    argno = models.IntegerField('Argument Number')

</pre>
<p> </p>
<p><img src="https://s0.wp.com/latex.php?latex=argno&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="argno" title="argno" class="latex"/> doesn’t really matter for the operations of multiplication and addition, but for others(like subtraction), it might.</p>
<p>Heres a Django-Admin screenshot with the required entries for <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> and <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/>.</p>
<p><a href="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225205.png" rel="attachment wp-att-307"><img class=" wp-image-307 aligncenter" src="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225205.png?w=584&amp;h=329" alt="Screenshot from 2016-01-04 22:52:05"/></a></p>
<p>As I mentioned earlier, we would like to store the values of the nodes, whenever they are updated. So heres a model for that:</p>
<pre class="brush: python; title: ; notranslate" title="">

class DataLog(models.Model):
    """
    Stores information about the type of function/computation
    associated with nodes.
    """

    node = models.CharField('Node', max_length=25)
    timestamp = models.DateTimeField('Time Stamp')
    value = models.FloatField('Value', null=True)

</pre>
<p>And heres the contents of the db.py file, that define a function to store the latest value of a node into the database:</p>
<pre class="brush: python; title: ; notranslate" title="">

from reactive_compute.models import DataLog
from django.utils import timezone


def save_node_value(node, value):
    """
    Saves the latest computed value of the given node.
    """
    data_entry = DataLog(node=str(node),
                         timestamp=timezone.now(),
                         value=value)
    data_entry.save()

</pre>
<p>To present a complete example, the following are the contents of the <em>admin.py</em> file.</p>
<pre class="brush: python; title: ; notranslate" title="">
from django.contrib import admin
from reactive_compute.models import *


class DependencyAdmin(admin.ModelAdmin):
    list_display = ('parent', 'child', 'argno')
    list_filter = ['parent', 'child']
    search_fields = ['parent', 'child']

admin.site.register(Dependency, DependencyAdmin)


class FunctionTypeAdmin(admin.ModelAdmin):
    list_display = ('node', 'functionname', 'noofargs')
    list_filter = ['functionname']
    search_fields = ['node', 'functionname']

admin.site.register(FunctionType, FunctionTypeAdmin)


class DataLogAdmin(admin.ModelAdmin):
    list_display = ('node', 'timestamp', 'value')
    list_filter = ['node', 'timestamp']
    search_fields = ['node']

admin.site.register(DataLog, DataLogAdmin)
</pre>
<p>And finally, we come to the crux of the implementation – the <em>tasks.py</em> file. If you read the resource I mentioned for Celery installation, you know that the Celery task is defined in this file. I have heavily commented it, so do go through the in-line docs.</p>
<pre class="brush: python; title: ; notranslate" title="">

from __future__ import absolute_import
from celery import shared_task
from reactive_compute.models import Dependency, FunctionType
from reactive_compute.db import save_node_value
from reactive_compute.functions import Functions
from redis import StrictRedis
import redis_lock


@shared_task
def compute_nodes(nodes, timeout=60):
    """
    Computes values for all computational nodes as defined in the
    FunctionType model. Recursive calls are made based on information
    present in respective Dependency entries.

    'nodes' should be a dict mapping name of computational node, to:
    A floating point number as input, OR
    None, if the value is to be (possibly) computed.
    'timeout' defines the time interval for which the values of the
    nodes mentioned in 'nodes' will be valid. Default is a minute.
    """

    #First handle the boundary case
    if len(nodes) == 0:
        return None

    #Get a connection to Redis
    conn = StrictRedis()

    #This will contain all the parent nodes that we will try to compute
    #recursively based on the args currently provided.
    parents = set([])

    #Default initialization for Celery
    value = None

    #Iterate over all nodes
    for node in nodes:
        ##First obtain the value of the node
        if nodes[node] is not None:
            #Value has been provided as input
            try:
                #Ensure the given value can be parsed/converted to
                #a float.
                value = float(nodes[node])
            except:
                #If representing the value as a float fails,
                #skip this one.
                continue
        else:
            #Value has to be computed.

            #First acquire lock for the particular node.
            #This ensures that the inputs needed for computing
            #the current node don't get modified midway(unless
            #one expires, in which case the computation may or may
            #not go through).
            lock = redis_lock.RedisLock(conn, node + '_lock')
            if lock.acquire():
                try:
                    #This will indicate if all args are present for
                    #computation of the result
                    all_args_flag = True
                    #This will store all the required arguments in order
                    args = []
                    #Get the pertinent FunctionType instance
                    func_info = FunctionType.objects.get(node=node)
                    #Iterate over all arguments
                    for i in range(func_info.noofargs):
                        #Get Redis value
                        v = conn.get(node + '_' + `i`)
                        if v is None or v == 'None':
                            #If value not present stop iterations
                            all_args_flag = False
                            break
                        else:
                            args.append(float(v))
                    #If any arg was absent, abort processing of this node
                    if not all_args_flag:
                        continue
                    #Compute the value, since all args are present
                    value = Functions.mapping[func_info.functionname](
                        args)
                    #Delete info about current args
                    for i in range(func_info.noofargs):
                        conn.delete(node + '_' + `i`)
                except:
                    pass
                finally:
                    #Release lock
                    lock.release()

        ##Now that the value has been obtained, update the args info
        ##for all parent nodes
        parent_objs = Dependency.objects.filter(child=node)
        for parent_obj in parent_objs:
            #Get lock for parent
            lock = redis_lock.RedisLock(conn, parent_obj.parent + '_lock')
            if lock.acquire():
                try:
                    #Set value
                    conn.set(parent_obj.parent + '_' + `parent_obj.argno`,
                             value)
                    #Set expiry time
                    conn.expire(parent_obj.parent + '_' + `parent_obj.argno`,
                                timeout)
                except:
                    pass
                finally:
                    #Release lock
                    lock.release()
            #Add this parent to the set of parents to process
            parents.add(parent_obj.parent)

        #Save value in database as needed
        save_node_value(node, value)

    #Make the recursive call on parent nodes
    compute_nodes.delay(dict((parent, None) for parent in parents),
                        timeout)

</pre>
<p>Given below is an example of using the above task in a simple Django view. It accepts the complete input as a stringified JSON object (like “<img src="https://s0.wp.com/latex.php?latex=%5C%7B%22C%22%3A+4%2C+%22D%22%3A+5%5C%7D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="\{&quot;C&quot;: 4, &quot;D&quot;: 5\}" title="\{&quot;C&quot;: 4, &quot;D&quot;: 5\}" class="latex"/>“), and makes a call to the Celery task.</p>
<pre class="brush: python; title: ; notranslate" title="">
from django.http import HttpResponse
from django.views.decorators.csrf import csrf_exempt
from reactive_compute.tasks import compute_nodes


@csrf_exempt
def input_values(request):
    #Get JSON-ed values dictionary
    value_dict = eval(request.GET.get('input'))
    #Make Celery call
    compute_nodes.delay(value_dict)

    return HttpResponse("OK")

</pre>
<p>Lets run the server and see how things work.<br/>
Heres that the data-logs look like given the input “<img src="https://s0.wp.com/latex.php?latex=%5C%7B%22C%22%3A+4%2C+%22D%22%3A+5%5C%7D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="\{&quot;C&quot;: 4, &quot;D&quot;: 5\}" title="\{&quot;C&quot;: 4, &quot;D&quot;: 5\}" class="latex"/>“.</p>
<p><a href="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225512.png" rel="attachment wp-att-308"><img class="wp-image-308 aligncenter" src="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225512.png?w=576&amp;h=324" alt="Screenshot from 2016-01-04 22:55:12"/></a></p>
<p>Within a minute, we provide “<img src="https://s0.wp.com/latex.php?latex=%5C%7B%22E%22%3A+6%5C%7D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="\{&quot;E&quot;: 6\}" title="\{&quot;E&quot;: 6\}" class="latex"/>“.</p>
<p><a href="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225529.png" rel="attachment wp-att-309"><img class=" wp-image-309 aligncenter" src="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225529.png?w=564&amp;h=318" alt="Screenshot from 2016-01-04 22:55:29"/></a></p>
<p>Notice how <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/> gets computed as well. Now let us provide all inputs, with new values: “<img src="https://s0.wp.com/latex.php?latex=%5C%7B%22C%22%3A+1%2C+%22D%22%3A+1%2C+%22E%22%3A+1%2C+%22F%22%3A+3%5C%7D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="\{&quot;C&quot;: 1, &quot;D&quot;: 1, &quot;E&quot;: 1, &quot;F&quot;: 3\}" title="\{&quot;C&quot;: 1, &quot;D&quot;: 1, &quot;E&quot;: 1, &quot;F&quot;: 3\}" class="latex"/>“.</p>
<p><a href="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225608.png" rel="attachment wp-att-310"><img class=" wp-image-310 aligncenter" src="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225608.png?w=557&amp;h=314" alt="Screenshot from 2016-01-04 22:56:08"/></a></p>
<p>As you must have observed, <img src="https://s0.wp.com/latex.php?latex=B&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="B" title="B" class="latex"/> is computed with the latest value of <img src="https://s0.wp.com/latex.php?latex=A&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="A" title="A" class="latex"/>, which is 3.</p>
<p>One unusual flexibility that this codes provide, is that we can update the values of nodes that are ‘usually’ derived, manually. Heres what happens if we provide “<img src="https://s0.wp.com/latex.php?latex=%5C%7B%22A%22%3A+4%2C+%22F%22%3A+5%5C%7D&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="\{&quot;A&quot;: 4, &quot;F&quot;: 5\}" title="\{&quot;A&quot;: 4, &quot;F&quot;: 5\}" class="latex"/>“.</p>
<p><a href="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225633.png" rel="attachment wp-att-311"><img class=" wp-image-311 aligncenter" src="https://codesachin.files.wordpress.com/2016/01/screenshot-from-2016-01-04-225633.png?w=556&amp;h=313" alt="Screenshot from 2016-01-04 22:56:33"/></a></p>
<p>You don’t need to Copy-Paste this code anywhere, its all present in my <a href="https://github.com/srjoglekar246/Reactive-Computing">github repo</a>. Feel free to fork it and send a PR if you can modify it in some useful way!</p>
<p><span><strong>Thoughts</strong></span></p>
<p>1. The way its implemented, you have complete control over how each computational node works. I have used simple mathematical operations, but you could have your own metrics/functionality written in. As long as you define the arguments and order them right, things will work well.</p>
<p>2. I have worked with floating-point numbers, but your arguments could as well be vectors! Then you might have to run <em>eval</em> over your Redis values, instead of a simple <em>float()</em> conversion. But since every call is made as a Celery task, your runtime will still be optimized.</p>
<p>3. Earlier, I mentioned that you could remove the restriction of deleting previous values of arguments (as long as they are valid). You could do this pretty easily by removing lines 85-87 in the <em>tasks.py</em> code. If you don’t want your node values to have a sense of time-based validity at all, you could just remove lines 106 and 107 from <em>tasks.py</em>.</p>
<p>4. If you want different values to be stored in different ways into the database, you could add another parameter to the <img src="https://s0.wp.com/latex.php?latex=FunctionType&amp;bg=ffffff&amp;fg=5e5e5e&amp;s=0" alt="FunctionType" title="FunctionType" class="latex"/> model, that specified a String that denotes how information about that particular node is added to the database. Ideally, this database storing would also be a Celery task.</p>
<p>5. You could also store the Data-Flow diagram better using a No-SQL database such as MongoDB.</p>
<p>Thats all for now <span class="wp-smiley wp-emoji wp-emoji-smile" title=":-)">:-)</span>. Cheers!</p>
<p> </p>
		<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-67602166-290-56d5a8366c87a" data-src="//widgets.wp.com/likes/#blog_id=67602166&amp;post_id=290&amp;origin=codesachin.wordpress.com&amp;obj_id=67602166-290-56d5a8366c87a" data-name="like-post-frame-67602166-290-56d5a8366c87a"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div></div>					</div>

	</div></body></html>