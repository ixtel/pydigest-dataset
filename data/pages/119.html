<html><body><div><div class="blog-post">

        <p>Mike Rhodes (<a href="https://twitter.com/mikerhodes">@mikerhodes</a>) recently remarked, "Most CouchDB client libraries are just glorified URL constructors." </p>
<p>Yep. And that's the beauty of it.</p>
<p>Cloudant and CouchDB expose a REST API so you can interact with your database over pure HTTP. Python libraries like <a href="http://www.python-requests.org/en/latest/">Requests</a> make HTTP painless, but using general-purpose libraries like Requests with distributed databases like Cloudant will inevitably result in boilerplate. So, we wrote <a href="https://github.com/cloudant-labs/cloudant-python">Cloudant-Python</a>:</p>
<h2>Cloudant-Python</h2>
<p><a href="https://travis-ci.org/cloudant-labs/cloudant-python"><img alt="Build Status" src="https://travis-ci.org/cloudant-labs/cloudant-python.png"/></a>
<a href="https://coveralls.io/r/cloudant-labs/cloudant-python"><img alt="Coverage Status" src="https://coveralls.io/repos/cloudant-labs/cloudant-python/badge.png"/></a>
<a href="https://crate.io/packages/cloudant/"><img alt="PyPi version" src="https://pypip.in/v/cloudant/badge.png"/></a>
<a href="https://crate.io/packages/cloudant/"><img alt="PyPi downloads" src="https://pypip.in/d/cloudant/badge.png"/></a></p>
<p><a href="https://github.com/cloudant-labs/cloudant-python">Cloudant-Python</a> is, as of this writing, the only asynchronous interface to CouchDB and Cloudant instances in Python. It wraps Requests to handle boilerplate like headers, JSON serialization, URL construction, streaming response bodies, and so on. Check it out:</p>
<pre><code>import cloudant

# connect to https://garbados.cloudant.com
account = cloudant.Account('garbados', async=True)
# and https://garbados.cloudant.com/allyourbase
database = account.database('allyourbase')

# create the database
future = database.put()
response = future.result()
# throw an error if the response code indicates failure
response.raise_for_status()

print database.get().result().json()
# { "db_name": "allyourbase", ... }
</code></pre>
<p>Asynchronous HTTP requests return <a href="http://docs.python.org/dev/library/concurrent.futures.html#future-objects">Future</a> objects, which will await the return of the HTTP response. Call <code>result()</code> to get the <a href="http://www.python-requests.org/en/latest/api/#requests.Response">Response</a> object. If you don't pass <code>async=True</code> when you create an object, it performs synchronously, just like Requests does by default:</p>
<pre><code>import cloudant

# connect to http://localhost:5984
account = cloudant.Account()

response = account.get()
print response.json()
# { "couchdb": "Welcome", ... }
</code></pre>
<p>To get Cloudant-Python, just use pip:</p>
<pre><code>pip install cloudant
</code></pre>
<p><a href="/sign-up/" class="btn btn-info">Create an account and try it yourself <i class="icon-white icon-heart"/></a></p>
<h2>Faithful to the API</h2>
<p>As a rule, if Cloudant's API has a special endpoint, like <code>ACCOUNT/_all_dbs</code>, it exists in Cloudant-Python as <code>Account.all_dbs</code>. Just drop the underscore, and you're done. Knowledge of the raw API should map effortlessly to using Cloudant-Python, while using Cloudant-Python should teach you about the raw API. Check it out in <a href="http://cloudant-labs.github.io/cloudant-python/#api">the API reference</a>.</p>
<h2>Easy Inheritance</h2>
<p>Cloudant and CouchDB's APIs follow a simple hierarchy: accounts contain databases contain documents and design documents, which contain indexes. This hierarchy is reflected in how you instantiate Cloudant-Python objects:</p>
<pre><code>import cloudant
from config import PASSWORD

# https://garbados.cloudant.com
account = cloudant.Account('garbados', async=True)
account.login('garbados', PASSWORD).result().raise_for_status()

# https://garbados.cloudant.com/db
database = account.database('db')

# https://garbados.cloudant.com/db/doc
document = database.document('doc')

# https://garbados.cloudant.com/db/_design/doc
design = database.design('doc')

# https://garbados.cloudant.com/db/_design/doc/_view/index_function
index = design.index('_view/index_function')
</code></pre>
<p>Because all of the above objects are created from that <code>cloudant.Account('garbados', async=True)</code> object, they all have <code>async=True</code> set in their options. Because we logged in with the <code>account</code>, all derivative objects will inherit that login session.</p>
<h2>Iterate over Indexes</h2>
<p>Indexes, such as <a href="https://cloudant.com/for-developers/views/">views</a> and Cloudant's <a href="https://cloudant.com/for-developers/search/">search indexes</a>, act as iterators. Check it out:</p>
<pre><code>import cloudant

account = cloudant.Account('garbados')
db = account.database('test')
view = db.all_docs() # returns all docs in the database
for doc in db:
  # iterates over every doc in the database
  pass
for doc in view:
  # and so does this!
  pass
</code></pre>
<p><a href="https://github.com/cloudant-labs/cloudant-python/blob/master/cloudant/index.py#L23-L33">Behind the scenes</a>, Cloudant-Python yields documents only as you consume them, so you only load into memory the documents you're using. By parsing the response line by line, you can begin consuming query results before the response body is even finished loading.</p>
<hr/>
<p>Cloudant-Python is open sourced under the <a href="http://opensource.org/licenses/MIT">MIT</a> license, so feel free to fork it, change it, mangle it, use it, r-r-remix it, etc., to your heartâ€™s content. I had a blast building Cloudant-Python, and I hope you have a blast using it.</p>
<p>As always, if you have any trouble, check our <a href="https://docs.cloudant.com">docs</a>, post your question to <a href="http://stackoverflow.com/questions/tagged/cloudant">StackOverflow</a>, ping us on <a href="http://webchat.freenode.net/?channels=cloudant">IRC</a>, or if you'd like to discuss the matter in private, email us at <a href="mailto:support@cloudant.com">support@cloudant.com</a>.</p>
<p>Happy coding!</p>
        
          </div>
        </div></body></html>