<html><body><div><div class="entry-content"><p>Here’s a followup to last month’s post about <a href="http://preshing.com/20110822/penrose-tiling-in-obfuscated-python">Penrose Tiling in Obfuscated Python</a>.</p>

<p>The <a href="http://en.wikipedia.org/wiki/Mandelbrot_set">Mandelbrot set</a> is a traditional favorite among authors of obfuscated code. You can find obfuscated code in <a href="http://www.iwriteiam.nl/SigProgM.html">C</a>, <a href="http://www.maths.tcd.ie/~mkerrin/Programs/usr/others/mandelbrot">Perl</a>, <a href="http://snakelemma.blogspot.com/2009/08/mandelbrot-set-in-haskell.html">Haskell</a>, <a href="http://forums.thedailywtf.com/forums/p/5518/118328.aspx#118328">Python</a> and many other languages. Nearly all examples render the Mandelbrot set as ASCII art.</p>

<p>The following Python script, on the other hand, begins as ASCII art:</p>

<pre><code>_                                      =   (
                                        255,
                                      lambda
                               V       ,B,c
                             :c   and Y(V*V+B,B,  c
                               -1)if(abs(V)&lt;6)else
               (              2+c-4*abs(V)**-0.4)/i
                 )  ;v,      x=1500,1000;C=range(v*x
                  );import  struct;P=struct.pack;M,\
            j  ='&lt;QIIHHHH',open('M.bmp','wb').write
for X in j('BM'+P(M,v*x*3+26,26,12,v,x,1,24))or C:
            i  ,Y=_;j(P('BBB',*(lambda T:(T*80+T**9
                  *i-950*T  **99,T*70-880*T**18+701*
                 T  **9     ,T*i**(1-T**45*2)))(sum(
               [              Y(0,(A%3/3.+X%v+(X/v+
                               A/3/3.-x/2)/1j)*2.5
                             /x   -2.7,i)**2 for  \
                               A       in C
                                      [:9]])
                                        /9)
                                       )   )
</code></pre>


<p>It renders the Mandelbrot set as a full-color, anti-aliased, 1500x1000 image. Click to enlarge:</p>

<p><a href="/images/M.jpg"><img class="center" src="/images/M-small.jpg"/></a></p>

<p>No third-party libraries are required – just pure Python. However, it will only run on Python 2.5 - 2.7; Python 3 is not supported. The output file is written to <code>M.bmp</code>, in Windows bitmap format.</p>

<p>It runs very slowly, taking about 18 minutes on my 1.86 GHz Core 2 Duo (or 9 minutes using <a href="http://pypy.org/">PyPy</a>). With some modifications, it’s possible to make this code run up to 20 times faster. However, doing so requires sacrificing either code size or image quality.</p>

<p>If you’re willing to leave the script running for a few hours, you can increase the image resolution on line 8. (Just make sure the width is divisible by 4.) The resulting detail is quite nice. Here are some 1:1 pixel excerpts from an image rendered at 7200x4800:</p>

<p><img class="center" src="/images/detail.jpg"/></p>

<p><img class="center" src="/images/detail2.jpg"/></p>

<p>The entire 7200x4800 image is too large to share here, but it’s perfect for making prints. So that’s what I did! Notice the Python script superimposed in the lower-left corner. Is this the first poster to include its own source code?</p>

<p><a href="http://www.cafepress.com/preshing"><img class="center" src="/images/poster-wall.jpg"/></a></p>

<p>If this kind of thing gives you kicks, you can order your own print (or a coffee mug) at <a href="http://www.cafepress.com/preshing">CafePress</a>.</p>

</div>



  

  </div></body></html>