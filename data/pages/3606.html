<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-dukpy" class="anchor" href="#dukpy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>dukpy</h1>
<a href="https://travis-ci.org/amol-/dukpy"><img alt="https://travis-ci.org/amol-/dukpy.png?branch=master" src="https://camo.githubusercontent.com/47f9a9ac75f7d5f7e478e1355011ffd54ee0d5d8/68747470733a2f2f7472617669732d63692e6f72672f616d6f6c2d2f64756b70792e706e673f6272616e63683d6d6173746572" data-canonical-src="https://travis-ci.org/amol-/dukpy.png?branch=master"/></a>
<a href="https://coveralls.io/r/amol-/dukpy?branch=master"><img alt="https://coveralls.io/repos/amol-/dukpy/badge.png?branch=master" src="https://camo.githubusercontent.com/535d741cfa8ab1b97718f58e9dbef9df1c8a86d2/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f616d6f6c2d2f64756b70792f62616467652e706e673f6272616e63683d6d6173746572" data-canonical-src="https://coveralls.io/repos/amol-/dukpy/badge.png?branch=master"/></a>
<p>DukPy is a simple javascript interpreter for Python built on top of
duktape engine <strong>without any external dependency</strong>.
It comes with a bunch of common transpilers built-in for convenience:</p>
<blockquote>
<ul>
<li><em>CoffeeScript</em></li>
<li><em>BabelJS</em></li>
<li><em>TypeScript</em></li>
</ul>
</blockquote>
<p>Dukpy has been tested on <strong>Python 2.7</strong> and <strong>Python 3.4</strong>, dukpy
is currently not production ready and might actually crash your
program as it is mostly implemented in C.</p>
<a name="user-content-coffeescript-compiler"/>
<h2><a id="user-content-coffeescript-compiler" class="anchor" href="#coffeescript-compiler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>CoffeeScript Compiler</h2>
<p>Using the coffeescript compiler is as easy as running:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> dukpy
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> dukpy.coffee_compile(<span class="pl-s"><span class="pl-pds">'''</span></span>
<span class="pl-s">...     fill = (container, liquid = "coffee") -&gt;</span>
<span class="pl-s">...         "Filling the #<span class="pl-c1">{container}</span> with #<span class="pl-c1">{liquid}</span>..."</span>
<span class="pl-s">... <span class="pl-pds">'''</span></span>)
<span class="pl-s"><span class="pl-pds">'</span>(function() {<span class="pl-cce">\n</span>  var fill;<span class="pl-cce">\n\n</span>  fill = function*(container, liquid) {<span class="pl-cce">\n</span>    if (liquid == null) {<span class="pl-cce">\n</span>      liquid = "coffee";<span class="pl-cce">\n</span>    }<span class="pl-cce">\n</span>    return "Filling the " + container + " with " + liquid + "...";<span class="pl-cce">\n</span>  };<span class="pl-cce">\n\n</span>}).call(this);<span class="pl-cce">\n</span><span class="pl-pds">'</span></span></pre></div>
<a name="user-content-typescript-transpiler"/>
<h2><a id="user-content-typescript-transpiler" class="anchor" href="#typescript-transpiler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>TypeScript Transpiler</h2>
<p>The TypeScript compiler can be used through the
<code>dukpy.typescript_compile</code> function:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> dukpy
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> dukpy.typescript_compile(<span class="pl-s"><span class="pl-pds">'''</span></span>
<span class="pl-s">... class Greeter {</span>
<span class="pl-s">...     constructor(public greeting: string) { }</span>
<span class="pl-s">...     greet() {</span>
<span class="pl-s">...         return "&lt;h1&gt;" + this.greeting + "&lt;/h1&gt;";</span>
<span class="pl-s">...     }</span>
<span class="pl-s">... };</span>
<span class="pl-s">...</span>
<span class="pl-s">... var greeter = new Greeter("Hello, world!");</span>
<span class="pl-s">... <span class="pl-pds">'''</span></span>)
<span class="pl-s"><span class="pl-pds">'</span>var Greeter = (function () {<span class="pl-cce">\n</span>    function Greeter(greeting) {<span class="pl-cce">\n</span>        this.greeting = greeting;<span class="pl-cce">\n</span>    }<span class="pl-cce">\n</span>    Greeter.prototype.greet = function () {<span class="pl-cce">\n</span>        return "&lt;h1&gt;" + this.greeting + "&lt;/h1&gt;";<span class="pl-cce">\n</span>    };<span class="pl-cce">\n</span>    return Greeter;<span class="pl-cce">\n</span>})();<span class="pl-cce">\n</span>;<span class="pl-cce">\n</span>var greeter = new Greeter("Hello, world!");<span class="pl-cce">\n</span><span class="pl-pds">'</span></span></pre></div>
<p>Currently the compiler has built-in options and doesn't accept additional ones,</p>
<a name="user-content-ecmascript6-babeljs-transpiler"/>
<h2><a id="user-content-ecmascript6-babeljs-transpiler" class="anchor" href="#ecmascript6-babeljs-transpiler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>EcmaScript6 BabelJS Transpiler</h2>
<p>To compile ES6 code to ES5 for everyday usage you can use
<code>dukpy.babel_compile</code>:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> dukpy
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> dukpy.babel_compile(<span class="pl-s"><span class="pl-pds">'''</span></span>
<span class="pl-s">... class Point {</span>
<span class="pl-s">...     constructor(x, y) {</span>
<span class="pl-s">...             this.x = x;</span>
<span class="pl-s">...         this.y = y;</span>
<span class="pl-s">...         }</span>
<span class="pl-s">...         toString() {</span>
<span class="pl-s">...             return '(' + this.x + ', ' + this.y + ')';</span>
<span class="pl-s">...         }</span>
<span class="pl-s">... }</span>
<span class="pl-s">... <span class="pl-pds">'''</span></span>)
<span class="pl-s"><span class="pl-pds">'</span>"use strict";<span class="pl-cce">\n\n</span>var _prototypeProperties = function (child, staticProps, instanceProps) { if (staticProps) Object.defineProperties(child, staticProps); if (instanceProps) Object.defineProperties(child.prototype, instanceProps); };<span class="pl-cce">\n\n</span>var _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } };<span class="pl-cce">\n\n</span>var Point = (function () {<span class="pl-cce">\n</span>    function Point(x, y) {<span class="pl-cce">\n</span>        _classCallCheck(this, Point);<span class="pl-cce">\n\n</span>        this.x = x;<span class="pl-cce">\n</span>        this.y = y;<span class="pl-cce">\n</span>    }<span class="pl-cce">\n\n</span>    _prototypeProperties(Point, null, {<span class="pl-cce">\n</span>        toString: {<span class="pl-cce">\n</span>            value: function toString() {<span class="pl-cce">\n</span>                return "(" + this.x + ", " + this.y + ")";<span class="pl-cce">\n</span>            },<span class="pl-cce">\n</span>            writable: true,<span class="pl-cce">\n</span>            configurable: true<span class="pl-cce">\n</span>        }<span class="pl-cce">\n</span>    });<span class="pl-cce">\n\n</span>    return Point;<span class="pl-cce">\n</span>})();<span class="pl-cce">\n</span><span class="pl-pds">'</span></span></pre></div>
<p>You  can pass <a href="http://babeljs.io/docs/usage/options/">options</a> to the BabelJS compiler just as keywords on
the call to <code>babel_compile()</code>.</p>
<p>The DukPY based BabelJS compiler also provides a WebAssets (
<a href="http://webassets.readthedocs.org/en/latest/">http://webassets.readthedocs.org/en/latest/</a> ) filter to automatically
compile ES6 code in your assets pipeline.  You register this filter as
<code>babeljs</code> within WebAssets using:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> webassets.filter <span class="pl-k">import</span> register_filter
<span class="pl-k">from</span> dukpy.webassets <span class="pl-k">import</span> BabelJS

register_filter(BabelJS)</pre></div>
<p>Which makes the filter available with the <code>babeljs</code> name.</p>
<p><strong>NOTE:</strong> When using the BabelJS compiler for code that needs to run
in the browser, make sure to add
<a href="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.6.1/polyfill.min.js">https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.6.1/polyfill.min.js</a>
dependency.</p>
<a name="user-content-using-the-javascript-interpreter"/>
<h2><a id="user-content-using-the-javascript-interpreter" class="anchor" href="#using-the-javascript-interpreter" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Using the JavaScript Interpreter</h2>
<p>Using dukpy is as simple as calling the <code>dukpy.evaljs</code> function with
the javascript code:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> dukpy
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> dukpy.evaljs(<span class="pl-s"><span class="pl-pds">"</span>var o = {'value': 5}; o['value'] += 3; o<span class="pl-pds">"</span></span>)
{<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>: <span class="pl-c1">8</span>}</pre></div>
<p>The <code>evaljs</code> function executes the javascript and returns the
resulting value as far as it is possible to encode it in JSON.</p>
<p>If execution fails a <code>dukpy.JSRuntimeError</code> exception is raised
with the failure reason.</p>
<a name="user-content-passing-arguments"/>
<h2><a id="user-content-passing-arguments" class="anchor" href="#passing-arguments" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Passing Arguments</h2>
<p>Any argument passed to <code>evaljs</code> is available in JavaScript inside
the <code>dukpy</code> object in javascript. It must be possible to encode
the arguments using JSON for them to be available in Javascript:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> dukpy
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">def</span> <span class="pl-en">sum3</span>(<span class="pl-smi">value</span>):
<span class="pl-c1">...</span>     <span class="pl-k">return</span> dukpy.evaljs(<span class="pl-s"><span class="pl-pds">"</span>dukpy['value'] + 3<span class="pl-pds">"</span></span>, <span class="pl-v">value</span><span class="pl-k">=</span>value)
<span class="pl-c1">...</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> sum3(<span class="pl-c1">7</span>)
<span class="pl-c1">10</span></pre></div>
<a name="user-content-running-multiple-scripts"/>
<h2><a id="user-content-running-multiple-scripts" class="anchor" href="#running-multiple-scripts" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Running Multiple Scripts</h2>
<p>The <code>evaljs</code> function supports providing multiple source codes to
be executed in the same context.</p>
<p>Multiple script can be passed in a list or tuple:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> dukpy
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> dukpy.evaljs([<span class="pl-s"><span class="pl-pds">"</span>var o = {'value': 5}<span class="pl-pds">"</span></span>,
<span class="pl-c1">...</span>               <span class="pl-s"><span class="pl-pds">"</span>o['value'] += 3<span class="pl-pds">"</span></span>,
<span class="pl-c1">...</span>               <span class="pl-s"><span class="pl-pds">"</span>o<span class="pl-pds">"</span></span>])
{<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>: <span class="pl-c1">8</span>}</pre></div>
<p>This is useful when your code requires dependencies to work,
as you can load the dependency and then your code.</p>
<p>This is actually how the coffeescript compiler is implemented
by DukPy itself:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">coffee_compile</span>(<span class="pl-smi">source</span>):
    <span class="pl-k">with</span> <span class="pl-c1">open</span>(<span class="pl-c1">COFFEE_COMPILER</span>, <span class="pl-s"><span class="pl-pds">'</span>r<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> coffeescript_js:
        <span class="pl-k">return</span> evaljs((coffeescript_js.read(), <span class="pl-s"><span class="pl-pds">'</span>CoffeeScript.compile(dukpy.coffeecode)<span class="pl-pds">'</span></span>),
                      <span class="pl-v">coffeecode</span><span class="pl-k">=</span>source)</pre></div>

</article>
  </div></body></html>