<html><body><div><div class="clearfix"><p><a href="https://github.com/stormpath/stormpath-spring-security"><img src="/images/blog/Flask.png" alt="Flask" title="Flask"/></a></p>


<p>Over the past few years I’ve found myself spending an awful lot of time building <a href="http://flask.pocoo.org/">Flask</a> websites and API services. As someone who came to Flask from <a href="https://www.djangoproject.com/">Django</a>, I loved Flask for its simplicity, flexibility, and elegance. Since it doesn’t come coupled with many required components, Flask can be a strategic tool for writing to-the-point code, working with new technologies (NoSQL data stores, etc.), and maximizing code base maintainability over time.</p>


<p> </p>

<h2>Flask’s Biggest Problem</h2>


<p>Unfortunately, while Flask is an excellent framework, it has one fatal flaw: authentication. As someone who’s been writing Flask apps since practically <a href="http://flask.pocoo.org/docs/changelog/#version-0-2">day 1</a>, the single largest problem I’ve seen in the community and ecosystem is lack of a good authentication framework.</p>


<p>If you are a Flask developer right now, and in the process of figuring out how to build support for user accounts (and user data) into your application: I can’t help but think you’re going to have a difficult time. Why? Because you’re essentially limited to a few (subpar) choices:</p>


<h3>Force Your Users to Use Social Login</h3>


<p>One of the most popular authentication strategies in the Flask community is to force your users to log in via Facebook, Twitter, or Google. As a developer, this mean you don’t have to worry about user account management, and can more or less rely on your social provider to handle the complicated bits for you.</p>


<p><img src="/images/blog/OAuth.jpeg" alt="OAuth" title="OAuth"/></p>


<p>The most popular way to handle social login is with the <a href="http://pythonhosted.org/Flask-OAuth/">Flask-OAuth</a> library. Unfortunately, this piggybacks off the <a href="http://pythonhosted.org/Flask-OAuth/">python-oauth2</a> library, which is <a href="https://github.com/simplegeo/python-oauth2/issues/149">no longer maintained</a>. There are, of course, other issues with this as well, namely:</p>


<ul>
<li>python-oauth only supports Oauth 1.0a.</li>
<li>python-oauth doesn’t seem to be getting updated to support provider changes (social providers seem to break Oauth implementations quite often).</li>
<li>Oauth has some <a href="http://tools.ietf.org/html/rfc5849#section-4">security issues</a> (although, to be fair, Oauth 1.0a is a lot more secure than Oauth 2.0).</li>
<li>Social providers tend to <a href="https://developers.facebook.com/blog/post/614/">break</a> <a href="https://groups.google.com/forum/#!topic/freeagent_api/qC4v_nIJvFg">Oauth</a> <a href="https://groups.google.com/forum/#!topic/fitbit-api/ii4pUt4uTNM">implementations</a> a lot.</li>
</ul>


<p>And of course, the biggest issue with forcing your users to rely on social login is that you still need to implement your own user data storage: database tables, handle user relationships and security, etc.</p>


<p><img src="/images/blog/SocialMedia.png" alt="Social Login" title="Social Login"/>In short: Oauth integration is more of a bandaid than a solution – and a poor one at that. Unless you know you need social login, you should not use Oauth as a replacement for user management.</p>


<p><strong>NOTE:</strong> Am I the only one who finds social login really annoying on most websites? Unless you’re running a social site, the idea granting a company access to all my personal data feels bad.</p>


<h3>Roll Your Own User Authentication</h3>


<p>I personally consider rolling your own user authentication in Flask to be the single greatest mistake new Flask developers make. There are many examples floating around on the internet (just Google Flask + authentication and you’ll see a few) which explain how to do the following:</p>


<ul>
<li>Set up a SQLite3 / MySQL / PostgreSQL database server.</li>
<li>Write a User model (and define a users table).</li>
<li>Build your own login view code to create new user accounts, and store them in the database.</li>
<li>Implement your own crypto, usually by importing from the <a href="http://werkzeug.pocoo.org/">werkzeug</a> library and hashing user passwords yourself.</li>
<li>Hashing user passwords when they attempt to login, then comparing these hashes to the database.</li>
<li>Storing custom user data either in the same database table as your accounts, or relating it via a foreign key.</li>
<li>Handling database migrations to allow you to add new fields to user accounts</li>
<li>Storing user data in cookies and sessions directly to handle logged-in state.</li>
</ul>


<p>See where this is going? Of course you do!</p>


<ul>
<li>Almost nobody hashes passwords correctly.</li>
<li>Almost nobody structures their user database to allow for scaling.</li>
<li>Almost nobody stores user data in a way that allows for future-proofing your database schema – most developers manually change their database schema each time they want to add new user data into their project.</li>
<li>Almost nobody handles user sessions correctly.</li>
<li>Almost nobody locks down their database servers in such a way that it is impossible (or nearly impossible) for attackers to gain access.</li>
</ul>


<p>Even when people DO get all the above right, almost nobody properly deploys their application such that user credentials are protected over the wire (HTTPS, HSTS, etc.).</p>


<p>There are simply so many things required for proper user authentication that it’s no wonder even some of <a href="http://en.wikipedia.org/wiki/2012_LinkedIn_hack">the</a> <a href="http://www.theverge.com/2013/11/7/5078560/over-150-million-breached-records-from-adobe-hack-surface-online">largest</a> <a href="https://corporate.target.com/about/shopping-experience/payment-card-issue-FAQ">corporations</a> (with their own security departments, mind you), routinely have data breaches and leak sensitive data. Millions of users are affected by security breaches every year, and as developers, we are entirely at fault.</p>


<h3>Building on Top of Flask-Login</h3>


<p>The last form of user authentication I’ll discuss is Flask-Login. Unlike the Oauth issues that plague Flask developers, and unlike the 100% roll your own authentication developers, Flask-Login is one of the best ways to at least get you started with authentication.</p>


<p>Flask-Login, unlike the aforementioned solutions, is an abstract authentication framework. Flask-Login provides you with some base classes and a general abstraction of user sessions, login, and logout – all you have to do is implement your own users behind the scenes.</p>


<p>Unfortunately, even though Flask-Login provides some very useful tools to make the authentication problem easier, it still falls short of providing a one-size-fits all solution for developers: you still need to roll your own custom authentication behind the scenes:</p>


<ul>
<li>Build your own user model.</li>
<li>Define your database schema / etc.</li>
<li>Handle storing custom user data on your own.</li>
<li>Build your own library (of sorts) on top of Flask-Login to get functionality working.</li>
<li>Hope you don’t make any mistakes along the way.</li>
</ul>


<p>In reality, there’s still a huge void in the authentication space, even with Flask-Login around to help.</p>


<h2>Recap and Thoughts</h2>


<p>Flask is an excellent framework, plagued by lack of proper authentication support, and the existing, and commonly used attempts to solve this problem, are not suitable solutions.</p>


<p>In the next part of this series I’ll discuss my own attempt at solving this problem: the new <a href="http://flask-stormpath.readthedocs.org/en/latest/">Flask-Stormpath</a> library.</p>


<p>If you have any questions, comments, or suggestions – please leave them in the comments below, or feel free to email me directly: <a href="mailto:randall@stormpath.com">randall@stormpath.com</a></p>


<p>Furthermore, if you’d like to get notified when the next article in this series comes out, don’t forget to subscribe to our blog! http://stormpath.com/blog/feed</p>

</div>



            </div></body></html>