<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-one-line-tree-in-python" class="anchor" href="#one-line-tree-in-python" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>One-line Tree in Python</h1>

<p>Using Python's built-in <a href="http://docs.python.org/library/collections.html#collections.defaultdict">defaultdict</a> we can easily define a tree data structure:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">tree</span>(): <span class="pl-k">return</span> defaultdict(tree)</pre></div>

<p>That's it!</p>

<p>It simply says that a tree is a dict whose default values are trees.</p>

<p>(If you're following along at home, make sure to <code>from collections import defaultdict</code>)</p>

<p>(Also: Hacker News reader @zbuc points out that this is called <a href="https://en.wikipedia.org/wiki/Autovivification">autovivification</a>. Cool!)</p>

<h2><a id="user-content-examples" class="anchor" href="#examples" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Examples</h2>

<h3><a id="user-content-json-esque" class="anchor" href="#json-esque" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>JSON-esque</h3>

<p>Now we can create JSON-esque nested dictionaries without explicitly creating sub-dictionariesâ€”they magically come into existence as we reference them:</p>

<div class="highlight highlight-source-python"><pre>users <span class="pl-k">=</span> tree()
users[<span class="pl-s"><span class="pl-pds">'</span>harold<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>hrldcpr<span class="pl-pds">'</span></span>
users[<span class="pl-s"><span class="pl-pds">'</span>handler<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>matthandlersux<span class="pl-pds">'</span></span></pre></div>

<p>We can print this as json with <code>print(json.dumps(users))</code> and we get the expected:</p>

<div class="highlight highlight-source-python"><pre>{<span class="pl-s"><span class="pl-pds">"</span>harold<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>hrldcpr<span class="pl-pds">"</span></span>}, <span class="pl-s"><span class="pl-pds">"</span>handler<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>matthandlersux<span class="pl-pds">"</span></span>}}</pre></div>

<h3><a id="user-content-without-assignment" class="anchor" href="#without-assignment" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Without assignment</h3>

<p>We can even create structure with no assignment at all, since merely referencing an entry creates it:</p>

<div class="highlight highlight-source-python"><pre>taxonomy <span class="pl-k">=</span> tree()
taxonomy[<span class="pl-s"><span class="pl-pds">'</span>Animalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Chordata<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Mammalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Carnivora<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Felidae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Felis<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>cat<span class="pl-pds">'</span></span>]
taxonomy[<span class="pl-s"><span class="pl-pds">'</span>Animalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Chordata<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Mammalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Carnivora<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Felidae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Panthera<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>lion<span class="pl-pds">'</span></span>]
taxonomy[<span class="pl-s"><span class="pl-pds">'</span>Animalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Chordata<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Mammalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Carnivora<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Canidae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Canis<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>dog<span class="pl-pds">'</span></span>]
taxonomy[<span class="pl-s"><span class="pl-pds">'</span>Animalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Chordata<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Mammalia<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Carnivora<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Canidae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Canis<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>coyote<span class="pl-pds">'</span></span>]
taxonomy[<span class="pl-s"><span class="pl-pds">'</span>Plantae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Solanales<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Solanaceae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Solanum<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>tomato<span class="pl-pds">'</span></span>]
taxonomy[<span class="pl-s"><span class="pl-pds">'</span>Plantae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Solanales<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Solanaceae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Solanum<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>potato<span class="pl-pds">'</span></span>]
taxonomy[<span class="pl-s"><span class="pl-pds">'</span>Plantae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Solanales<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Convolvulaceae<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>Ipomoea<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>sweet potato<span class="pl-pds">'</span></span>]</pre></div>

<p>We'll prettyprint this time, which requires us to convert to standard dicts first:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">dicts</span>(<span class="pl-smi">t</span>): <span class="pl-k">return</span> {k: dicts(t[k]) <span class="pl-k">for</span> k <span class="pl-k">in</span> t}</pre></div>

<p>Now we can prettyprint the structure with <code>pprint(dicts(taxonomy))</code>:</p>

<div class="highlight highlight-source-python"><pre>{<span class="pl-s"><span class="pl-pds">'</span>Animalia<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Chordata<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Mammalia<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Carnivora<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Canidae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Canis<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>coyote<span class="pl-pds">'</span></span>: {},
                                                                            <span class="pl-s"><span class="pl-pds">'</span>dog<span class="pl-pds">'</span></span>: {}}},
                                                      <span class="pl-s"><span class="pl-pds">'</span>Felidae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Felis<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>cat<span class="pl-pds">'</span></span>: {}},
                                                                  <span class="pl-s"><span class="pl-pds">'</span>Panthera<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>lion<span class="pl-pds">'</span></span>: {}}}}}}},
 <span class="pl-s"><span class="pl-pds">'</span>Plantae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Solanales<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Convolvulaceae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Ipomoea<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>sweet potato<span class="pl-pds">'</span></span>: {}}},
                           <span class="pl-s"><span class="pl-pds">'</span>Solanaceae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Solanum<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>potato<span class="pl-pds">'</span></span>: {},
                                                      <span class="pl-s"><span class="pl-pds">'</span>tomato<span class="pl-pds">'</span></span>: {}}}}}}</pre></div>

<p>So the substructures we referenced now exist as dicts, with empty dicts at the leaves.</p>

<h3><a id="user-content-iteration" class="anchor" href="#iteration" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Iteration</h3>

<p>This tree can be fun to iteratively walk through, again because structure comes into being simply by referring to it.</p>

<p>For example, suppose we are parsing a list of new animals to add to our taxonomy above, so we want to call a function like:</p>

<div class="highlight highlight-source-python"><pre>add(taxonomy,
    <span class="pl-s"><span class="pl-pds">'</span>Animalia&gt;Chordata&gt;Mammalia&gt;Cetacea&gt;Balaenopteridae&gt;Balaenoptera&gt;blue whale<span class="pl-pds">'</span></span>.split(<span class="pl-s"><span class="pl-pds">'</span>&gt;<span class="pl-pds">'</span></span>))</pre></div>

<p>We can implement this simply as:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">add</span>(<span class="pl-smi">t</span>, <span class="pl-smi">path</span>):
  <span class="pl-k">for</span> node <span class="pl-k">in</span> path:
    t <span class="pl-k">=</span> t[node]</pre></div>

<p>Again we are never assigning to the dictionary, but just by referencing the keys we have created our new structure:</p>

<div class="highlight highlight-source-python"><pre>{<span class="pl-s"><span class="pl-pds">'</span>Animalia<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Chordata<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Mammalia<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Carnivora<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Canidae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Canis<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>coyote<span class="pl-pds">'</span></span>: {},
                                                                            <span class="pl-s"><span class="pl-pds">'</span>dog<span class="pl-pds">'</span></span>: {}}},
                                                      <span class="pl-s"><span class="pl-pds">'</span>Felidae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Felis<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>cat<span class="pl-pds">'</span></span>: {}},
                                                                  <span class="pl-s"><span class="pl-pds">'</span>Panthera<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>lion<span class="pl-pds">'</span></span>: {}}}},
                                        <span class="pl-s"><span class="pl-pds">'</span>Cetacea<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Balaenopteridae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Balaenoptera<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>blue whale<span class="pl-pds">'</span></span>: {}}}}}}},
 <span class="pl-s"><span class="pl-pds">'</span>Plantae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Solanales<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Convolvulaceae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Ipomoea<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>sweet potato<span class="pl-pds">'</span></span>: {}}},
                           <span class="pl-s"><span class="pl-pds">'</span>Solanaceae<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>Solanum<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>potato<span class="pl-pds">'</span></span>: {},
                                                      <span class="pl-s"><span class="pl-pds">'</span>tomato<span class="pl-pds">'</span></span>: {}}}}}}</pre></div>

<h2><a id="user-content-conclusion" class="anchor" href="#conclusion" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Conclusion</h2>

<p>This probably isn't very useful, and it makes for some perplexing code (see <code>add()</code> above).</p>

<p>But if you like Python then I hope this was fun to think about or worthwhile to understand.</p>

<p>There was a <a href="http://news.ycombinator.com/item?id=3881171">good discussion</a> of this gist on Hacker News.</p>
</article>
  </div></body></html>