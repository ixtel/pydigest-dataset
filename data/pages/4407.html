<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_example_02.gif"><img src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_example_02.gif" alt=""/></a></p>
<p>I’m going to start this post by clueing you in on a piece of personal history that very few people know about me: as a kid in early high school, I used to spend <em>nearly</em> <em>every single Saturday</em> at the local RC (Remote Control) track about 25 miles from my house.</p>
<p>You see, I used to race 1/10th scale (electric) RC cars on an amateur level. Being able to spend time racing every Saturday was definitely one of my favorite (if not <em>the </em>favorite) experience of my childhood.</p>
<p>I used to race the (now antiquated) TC3 from Team Associated. From stock engines, to 19-turns, to modified (I was down to using a 9-turn by the time I stopped racing), I had it all. I even competed in a few big-time amateur level races on the east coast of the United States and placed well.</p>
<p>But as I got older, and as racing became more expensive, I started spending less time at the track and more time programming. In the end, this was probably one of the smartest decisions that I’ve ever made, even though I loved racing so much — it seems quite unlikely that I could have made a career out of racing RC cars, but I certainly have made a career out of programming and entrepreneurship.</p>
<p>So perhaps it comes as no surprise, now that I’m 26 years old, that I felt the urge to get back into RC. But instead of cars, I wanted to do something that I had never done before — <em><strong>drones and quadcopters</strong></em>.</p>
<p>Which leads us to the purpose of this post: <strong>developing a system to automatically detect targets from a quadcopter video recording</strong>.</p>
<p>If you want to see the target acquisition in action, I won’t keep you waiting. Here is the full video:</p>
<p><iframe src="http://www.youtube.com/embed/VoFcNkWMu08?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p>Otherwise, keep reading to see how target detection in quadcopter and drone video streams is done using Python and OpenCV!</p>

<p><strong>OpenCV and Python versions:</strong><br/>
In order to run this example, you’ll need <strong>Python 2.7</strong> and <strong>OpenCV 2.4.X</strong>.</p>
<h1>Getting into drones and quadcopters</h1>
<p>While I have a ton of experience racing RC cars, I’ve never flown anything in my life. Given this, I decided to go with a nice entry level drone so I could learn the ropes of piloting without causing too much damage to my quadcopter or my back account. Based on the excellent recommendation from <a href="https://twitter.com/marekkraft" target="_blank">Marek Kraft</a>, I ended up purchasing the <a href="http://www.amazon.com/gp/product/B00EXBDWZC/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00EXBDWZC&amp;linkCode=as2&amp;tag=trndingcom-20&amp;linkId=JNFJVYGA4RTGDFKK" target="_blank">Hubsan X4</a>:</p>
<div id="attachment_2255" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_copter.jpg"><img class="wp-image-2255" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_copter.jpg" alt="Figure 1: My Hubsan X4 quadcopter. It's tiny (fits in the palm of my hand), inexpensive (only $45), great for learning to fly, and comes with a built-in camera." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_copter-225x300.jpg 225w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_copter.jpg 600w" sizes="(max-width: 400px) 100vw, 400px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> My Hubsan X4 quadcopter. It’s tiny (fits in the palm of my hand), inexpensive (only $45), great for learning to fly, and comes with a built-in camera.</p></div>
<p>I went with this quadcopter for 4: reasons:</p>
<ol>
<li>The Hubsan X4 is excellent for <strong>first time pilots</strong> who are just learning to fly.</li>
<li><strong>It’s very tiny</strong> — you can fly it indoors and around your living room until you get used to the controls.</li>
<li><strong>It comes with a camera that records video footage to a micro-SD card.</strong> As a computer vision researcher and developer, having a built in camera was <em>critical</em> in making my decision. Granted, the camera is only 0.3MP, but that was good enough for me to get started. Hubsan also has <a href="http://www.amazon.com/gp/product/B00N87OOXQ/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00N87OOXQ&amp;linkCode=as2&amp;tag=trndingcom-20&amp;linkId=WXMPWOL7Q7P23QDA" target="_blank">another model</a> that sports a 2MP camera, but it’s over double the price. Furthermore, you could always mount a smaller, higher resolution camera to the undercarriage of the X4, so I couldn’t justify the extra price as a novice pilot.</li>
<li>Not only is the Hubsan X4 <strong>inexpensive </strong>(only $45), but <strong>so are the replacement parts!</strong> When you’re just learning to fly, you’ll be going through a lot of rotor blades. And for a pack of 10 replacement rotor blades you’re only looking at a handful of dollars.</li>
</ol>
<h1>Finding targets in drone and quadcopter video streams using Python and OpenCV</h1>
<p>But of course, I am a computer vision developer and researcher…so after I learned how to fly my quadcopter without crashing it into my apartment walls repeatedly, I decided I wanted to have some fun and apply my computer vision expertise.<strong> The rest of this blog post will detail how to find and detect targets in quadcopter video streams using Python and OpenCV.</strong></p>
<p>The first thing I did was create the “targets” that I wanted to detect. These targets were simply the PyImageSearch logo. I printed a handful of them out, cut them out as <strong><em>squares</em></strong>, and pasted them to my apartment cabinets and walls:</p>
<div id="attachment_2268" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_marker.png"><img class="wp-image-2268" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_marker.png" alt="Figure 2: The target marker we are going to detect in our drone video stream using Python + OpenCV." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_marker-150x150.png 150w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_marker-300x300.png 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_marker-1024x1024.png 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_marker.png 1200w" sizes="(max-width: 300px) 100vw, 300px"/></a><p class="wp-caption-text"><strong>Figure 2:</strong> The target marker we are going to detect in our drone video stream using Python + OpenCV.</p></div>
<p>The end goal will be to detect these targets in the video recorded by my Hubsan X4:</p>
<div id="attachment_2260" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_02.jpg"><img class="wp-image-2260" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_02.jpg" alt="Figure 2: Detecting a PyImageSearch logo &quot;target&quot; from my quadcopter video stream using Python and OpenCV." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_02-300x221.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_02.jpg 599w" sizes="(max-width: 599px) 100vw, 599px"/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Detecting a PyImageSearch logo “target” from my quadcopter video stream using Python and OpenCV.</p></div>
<p><em><strong>So, you might be wondering why I chose my targets to be squares?</strong></em></p>
<p>Well, if you’re a regular follower of the PyImageSearch blog, you may know that I’m a big fan of using contour properties to detect objects in images.</p>
<p><em><strong>IMPORTANT: </strong>A clever use of contour properties can save you from training complicated machine learning models.</em></p>
<p>Why make a problem more challenging than it needs to be?</p>
<p>And when you think about it, detecting squares in images isn’t too terribly challenging of a task when you consider the <strong>geometry of a square</strong>.</p>
<p>Let’s think about the properties of a square for a second:</p>
<ul>
<li><strong>Property #1: </strong>A square has four vertices.</li>
<li><strong>Property #2:</strong> A square will have (approximately) equal width and height. Therefore, the <em>aspect ratio</em>, or more simply, the ratio of the width to the height of the square will be approximately <em>1</em>.</li>
</ul>
<p>Leveraging these two properties (along with two other contour properties; the <em>convex hull </em>and <em>solidity</em>), we’ll be able to detect our targets in an image.</p>
<p>Anyway, enough talk. Let’s get to work. Open up a file, name it 
			<span id="crayon-56d5a2520aedb312712748" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">drone</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and insert the following code:</p>

		<div id="crayon-56d5a2520aee7010267365" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-2">2</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-4">4</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-6">6</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-8">8</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-10">10</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-12">12</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-14">14</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-16">16</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-18">18</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-20">20</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-22">22</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-24">24</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-26">26</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-28">28</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520aee7010267365-30">30</p><p class="crayon-num" data-line="crayon-56d5a2520aee7010267365-31">31</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a2520aee7010267365-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-4"> </p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-5"><span class="crayon-c"># construct the argument parse and parse the arguments</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-6"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-7"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-v"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--video"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"path to the video file"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-8"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-10"><span class="crayon-c"># load the video</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-11"><span class="crayon-v">camera</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">VideoCapture</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"video"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-12"> </p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-13"><span class="crayon-c"># keep looping</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-14"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-15"><span class="crayon-h">	</span><span class="crayon-c"># grab the current frame and initialize the status text</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-16"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">grabbed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">camera</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-17"><span class="crayon-h">	</span><span class="crayon-v">status</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"No Targets"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-18"> </p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-19"><span class="crayon-h">	</span><span class="crayon-c"># check to see if we have reached the end of the</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-20"><span class="crayon-h">	</span><span class="crayon-c"># video</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-21"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">grabbed</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-22"><span class="crayon-h">		</span><span class="crayon-st">break</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-23"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-24"><span class="crayon-h">	</span><span class="crayon-c"># convert the frame to grayscale, blur it, and detect edges</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-25"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-26"><span class="crayon-h">	</span><span class="crayon-v">blurred</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">GaussianBlur</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-27"><span class="crayon-h">	</span><span class="crayon-v">edged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Canny</span><span class="crayon-sy">(</span><span class="crayon-v">blurred</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-28"> </p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-29"><span class="crayon-h">	</span><span class="crayon-c"># find contours in the edge map</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520aee7010267365-30"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">findContours</span><span class="crayon-sy">(</span><span class="crayon-v">edged</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">RETR_EXTERNAL</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a2520aee7010267365-31"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CHAIN_APPROX_SIMPLE</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start off by importing our necessary packages, 
			<span id="crayon-56d5a2520aeec843045174" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">argparse</span></span></span>  to parse command line arguments and 
			<span id="crayon-56d5a2520aef0756792455" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span></span></span>  for our OpenCV bindings.</p>
<p>We then parse our command line arguments on <strong>Lines 6-8</strong>. We’ll need only a single switch here, 
			<span id="crayon-56d5a2520aef4890668971" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">video</span></span></span> , which is the path to the video file our quadcopter recorded while in flight. In an ideal situation we could stream the video from the quadcopter <em>directly</em> to our Python script, but the Hubsan X4 does not have that capability. Instead, we’ll just have to post-process the video, but if you were to stream the video, <em>the same principles would apply</em>.</p>
<p><strong>Line 11</strong> opens our video file for reading and <strong>Line 14</strong> starts a loop, where the goal is to loop over each frame of the input video.</p>
<p>We grab the next frame of the video from the buffer on <strong>Line 16</strong> by making a call to 
			<span id="crayon-56d5a2520aef7916160217" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">camera</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span> . This function returns a tuple of 2 values. The first, 
			<span id="crayon-56d5a2520aefb689868226" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">grabbed</span></span></span> , is a boolean indicating whether or not the frame was successfully read. If the frame was not successfully read or if we have reached the end of the video file, we break from the loop on <strong>Lines 21 and 22</strong>.</p>
<p>The second value returned from 
			<span id="crayon-56d5a2520aefe698822641" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">camera</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span>  is the 
			<span id="crayon-56d5a2520af02479792324" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  itself — this frame is a NumPy array of size <i>N x M</i> pixels which we’ll be processing and attempting to find targets in.</p>
<p>We’ll also initialize a 
			<span id="crayon-56d5a2520af05564239332" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">status</span></span></span>  string on <strong>Line 17</strong> which indicates whether or not a target was found in the current frame.</p>
<p>The first few pre-processing steps are handled on <strong>Lines 25-27</strong>. We’ll start by converting the frame from RGB to <strong><em>grayscale</em></strong> since we are not interested in the color of the image, just the intensity. We’ll then <em><strong>blur</strong></em> the grayscale frame to remove high frequency noise, allowing us to focus on the actual structural components of the frame. And we’ll finally perform edge detection to <strong><em>reveal the outlines</em></strong> of the objects in the image.</p>
<div id="attachment_2279" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_edge_map.png"><img class="wp-image-2279" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_edge_map.png" alt="Figure 4: An example of one of the edge maps generated from a single frame. Notice how the outlines of the door, door handle, and targets are revealed." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_edge_map-300x222.png 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_edge_map.png 834w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 4:</strong> An example of one of the edge maps generated from a single frame. Notice how the outlines of the door, door handle, refrigerator, and targets are revealed.</p></div>
<p>These outlines of the “objects” could correspond to the outlines of a door, a cabinet, the refrigerator, or the target itself. To distinguish between these outlines, we’ll need to leverage contour properties.</p>
<p>But first, we’ll need to find the contours of these objects from the edge map. To do this, we’ll make a call to 
			<span id="crayon-56d5a2520af09854803683" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">findContours</span></span></span>  on <strong>Lines 30 and 31</strong>. This function gives us a list of contoured regions in the edge mapped image.</p>
<p>Now that we have the contours, let’s see how we can leverage them to find the actual targets in an image:</p>

		<div id="crayon-56d5a2520af0d931844126" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-34">34</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-36">36</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-38">38</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-40">40</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-42">42</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-44">44</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-46">46</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-48">48</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-50">50</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-52">52</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-54">54</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-56">56</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-58">58</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-60">60</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-62">62</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-63">63</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-64">64</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-65">65</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-66">66</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-67">67</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-68">68</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-69">69</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af0d931844126-70">70</p><p class="crayon-num" data-line="crayon-56d5a2520af0d931844126-71">71</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a2520af0d931844126-33"><span class="crayon-h">	</span><span class="crayon-c"># loop over the contours</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-34"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cnts</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-35"><span class="crayon-h">		</span><span class="crayon-c"># approximate the contour</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-36"><span class="crayon-h">		</span><span class="crayon-v">peri</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">arcLength</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-37"><span class="crayon-h">		</span><span class="crayon-v">approx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">approxPolyDP</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">peri</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-38"> </p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-39"><span class="crayon-h">		</span><span class="crayon-c"># ensure that the approximated contour is "roughly" rectangular</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-40"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-41"><span class="crayon-h">			</span><span class="crayon-c"># compute the bounding box of the approximated contour and</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-42"><span class="crayon-h">			</span><span class="crayon-c"># use the bounding box to compute the aspect ratio</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-43"><span class="crayon-h">			</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">boundingRect</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-44"><span class="crayon-h">			</span><span class="crayon-v">aspectRatio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-45"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-46"><span class="crayon-h">			</span><span class="crayon-c"># compute the solidity of the original contour</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-47"><span class="crayon-h">			</span><span class="crayon-v">area</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">contourArea</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-48"><span class="crayon-h">			</span><span class="crayon-v">hullArea</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">contourArea</span><span class="crayon-sy">(</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">convexHull</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-49"><span class="crayon-h">			</span><span class="crayon-v">solidity</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">area</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">hullArea</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-50"> </p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-51"><span class="crayon-h">			</span><span class="crayon-c"># compute whether or not the width and height, solidity, and</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-52"><span class="crayon-h">			</span><span class="crayon-c"># aspect ratio of the contour falls within appropriate bounds</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-53"><span class="crayon-h">			</span><span class="crayon-v">keepDims</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">25</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">25</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-54"><span class="crayon-h">			</span><span class="crayon-v">keepSolidity</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">solidity</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0.9</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-55"><span class="crayon-h">			</span><span class="crayon-v">keepAspectRatio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">aspectRatio</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0.8</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">aspectRatio</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">1.2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-56"> </p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-57"><span class="crayon-h">			</span><span class="crayon-c"># ensure that the contour passes all our tests</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-58"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">keepDims </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">keepSolidity </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">keepAspectRatio</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-59"><span class="crayon-h">				</span><span class="crayon-c"># draw an outline around the target and update the status</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-60"><span class="crayon-h">				</span><span class="crayon-c"># text</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-61"><span class="crayon-h">				</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">drawContours</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">approx</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-62"><span class="crayon-h">				</span><span class="crayon-v">status</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"Target(s) Acquired"</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-63"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-64"><span class="crayon-h">				</span><span class="crayon-c"># compute the center of the contour region and draw the</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-65"><span class="crayon-h">				</span><span class="crayon-c"># crosshairs</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-66"><span class="crayon-h">				</span><span class="crayon-v">M</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">moments</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-67"><span class="crayon-h">				</span><span class="crayon-sy">(</span><span class="crayon-v">cX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cY</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m10"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m00"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m01"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m00"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-68"><span class="crayon-h">				</span><span class="crayon-sy">(</span><span class="crayon-v">startX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endX</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">cX</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.15</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">cX</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.15</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-69"><span class="crayon-h">				</span><span class="crayon-sy">(</span><span class="crayon-v">startY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endY</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">cY</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.15</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">cY</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.15</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af0d931844126-70"><span class="crayon-h">				</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">startX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">endX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af0d931844126-71"><span class="crayon-h">				</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">cX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">startY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">cX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The snippet of code above is where the real bulk of the target detection happens.</p>
<p>We’ll start by looping over each of the contours on <strong>Line 34</strong>.</p>
<p>And then for each of these contours, we’ll apply <em>contour approximation</em>. As the name suggests, <em>contour approximation</em>, is an algorithm for reducing the number of points in a curve with a reduced set of points — thus, an approximation. This algorithm is commonly known as the <a href="http://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm" target="_blank">Ramer-Douglas-Peucker algorithm</a>, or simply the split-and-merge algorithm.</p>
<p>The general assumption of this algorithm is that a curve can be approximated by a series of short line segments. And we can thus <em>approximate</em> a given number of these line segments to reduce the number of points it takes to construct a curve.</p>
<p>Performing contour approximation is an excellent way to detect square and rectangular objects in an image. We’ve used in in building a <a href="http://www.pyimagesearch.com/2014/09/01/build-kick-ass-mobile-document-scanner-just-5-minutes/" target="_blank">kick-ass mobile document scanner</a>. We’ve used it to <a href="http://www.pyimagesearch.com/2014/04/21/building-pokedex-python-finding-game-boy-screen-step-4-6/" target="_blank">find the Game Boy screen in an image</a>. And we’ve even used it on a higher level to actually <a href="http://www.pyimagesearch.com/2015/02/09/removing-contours-image-using-python-opencv/" target="_blank">filter shapes from an image</a>.</p>
<p>We’ll apply the same principles here. If our approximated contour has <em>between 4 and 6 points</em> (<strong>Line 40</strong>), then we’ll consider the object to be rectangular and a candidate for further processing.</p>
<p><em><strong>Note: </strong>Ideally, an approximated contour should have exactly 4 vertices, but in the real-world this is not always the case due to sub-par image quality or noise introduced via motion blur, such as flying a quadcopter around a room.</em></p>
<p>Next up, we’ll grab the bounding box of the contour on <strong>Line 43</strong> and use it to compute the <em>aspect ratio</em> of the box (<strong>Line 44</strong>). The aspect ratio is defined as the ratio of the width of the bounding box to the height of the bounding box:</p>
<p><em>aspect ratio = width / height</em></p>
<p>We’ll also compute two more contour properties on <strong>Lines 47-49</strong>. The first is the simple area of the bounding box, or the number of <em>non-zero</em> pixels inside the bounding box region divided by the <em>total number of pixels</em> in the bounding box region.</p>
<p>We’ll also compute the area of the <em><a href="http://en.wikipedia.org/wiki/Convex_hull" target="_blank">convex hull</a></em>, and finally use the area of the original bounding box and the area of the convex hull to compute the <em>solidity:</em></p>
<p><i>solidity</i><em> = original area / convex hull area</em></p>
<p>Since this is meant to be a super practical, hands-on post, I’m not going to go into the details of the convex hull. But if contour properties really interest you, I have over <em><strong>5</strong><strong>0+ pages worth of tutorials</strong></em> on the contour properties inside the <a href="http://www.pyimagesearch.com/pyimagesearch-gurus/" target="_blank">PyImageSearch Gurus course</a> — if that sounds interesting to you, I would definitely reserve your spot in line for when the doors to the course open.</p>
<p>Anyway, now that we have our contour properties, we can use them to determine if we have found our target in the frame:</p>
<ul>
<li><strong>Line 53</strong>: Our target should have a 
			<span id="crayon-56d5a2520af14463347622" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">width</span></span></span>  and 
			<span id="crayon-56d5a2520af18445696602" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">height</span></span></span>  of at least 25 pixels. This ensures that small, random artifacts are filtered from our frame.</li>
<li><strong>Line 54:</strong> The target should have a 
			<span id="crayon-56d5a2520af1b630394601" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">solidity</span></span></span>  value greater than <em>0.9.</em></li>
<li><strong>Line 55:</strong> Finally, the contour region should have an 
			<span id="crayon-56d5a2520af1f546512430" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">aspectRatio</span></span></span>  that is is between <em>0.8 &lt;= aspect ratio &lt;= 1.2</em>, which will indicate that the region is <em><strong>approximately square</strong></em>.</li>
</ul>
<p>Provided that all these tests pass on <strong>Line 58</strong>, we have found our target!</p>
<p><strong>Lines 61 and 62</strong> draw the bounding box region of the approximated contour and update the 
			<span id="crayon-56d5a2520af22016007148" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">status</span></span></span>  text.</p>
<p>Then, <strong>Lines 66-71</strong> compute the center of the bounding box and use the center <em>(x, y)</em>-coordinates to draw crosshairs on the target.</p>
<p>Let’s go ahead and finish up this script:</p>

		<div id="crayon-56d5a2520af26902142006" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-73">73</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af26902142006-74">74</p><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-75">75</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af26902142006-76">76</p><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-77">77</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af26902142006-78">78</p><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-79">79</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af26902142006-80">80</p><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-81">81</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af26902142006-82">82</p><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-83">83</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af26902142006-84">84</p><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-85">85</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a2520af26902142006-86">86</p><p class="crayon-num" data-line="crayon-56d5a2520af26902142006-87">87</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a2520af26902142006-73"><span class="crayon-h">	</span><span class="crayon-c"># draw the status text on the frame</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af26902142006-74"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">putText</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">status</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">FONT_HERSHEY_SIMPLEX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a2520af26902142006-75"><span class="crayon-h">		</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af26902142006-76"> </p><p class="crayon-line" id="crayon-56d5a2520af26902142006-77"><span class="crayon-h">	</span><span class="crayon-c"># show the frame and record if a key is pressed</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af26902142006-78"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Frame"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af26902142006-79"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">0xFF</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af26902142006-80"> </p><p class="crayon-line" id="crayon-56d5a2520af26902142006-81"><span class="crayon-h">	</span><span class="crayon-c"># if the 'q' key is pressed, stop the loop</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af26902142006-82"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-k ">ord</span><span class="crayon-sy">(</span><span class="crayon-s">"q"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a2520af26902142006-83"><span class="crayon-h">		</span><span class="crayon-st">break</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af26902142006-84"> </p><p class="crayon-line" id="crayon-56d5a2520af26902142006-85"><span class="crayon-c"># cleanup the camera and close any open windows</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a2520af26902142006-86"><span class="crayon-v">camera</span><span class="crayon-sy">.</span><span class="crayon-e">release</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a2520af26902142006-87"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">destroyAllWindows</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 74 and 75</strong> then draw the 
			<span id="crayon-56d5a2520af2b013304777" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">status</span></span></span>  text on the top-left corner of our frame, while <strong>Lines 78-83</strong> handle if the 
			<span id="crayon-56d5a2520af2f353863366" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">q</span></span></span>  key is pressed, and if so, we break from the loop.</p>
<p>Finally, <strong>Lines 86 and 87</strong> perform cleanup, release the pointer to the video file, and close all open windows.</p>
<h1>Target detection results</h1>
<p>Even though that was less than 100 lines of code, including comments, that was a decent amount of work. Let’s see our target detection in action.</p>
<p>Open up a terminal, navigate to where the source code resides, and issue the following command:</p>

		<div id="crayon-56d5a2520af33292598866" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a2520af33292598866-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">drone</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">video </span><span class="crayon-v">FlightDemo</span><span class="crayon-e">.mp4</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>And if all goes well, you’ll see output similar to the following:</p>
<div class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_example_01.gif"><img class="alignnone" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_example_01.gif" alt=""/></a><p class="wp-caption-text"><strong>Figure 5:</strong> An example of our quadcopter detecting multiple targets using Python and OpenCV.</p></div>
<p><strong><em>As you can see, our Python script has been able to successfully detect the targets!</em></strong></p>
<p>Here’s another still image from a separate video of the PyImageSearch targets being detected:</p>
<div id="attachment_2263" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_01.jpg"><img class="wp-image-2263 size-full" src="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_01.jpg" alt="Figure 5: Our Python + OpenCV script has been able to successfully detect the targets in our video stream." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_01-300x221.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/05/drone_acquired_01.jpg 599w" sizes="(max-width: 599px) 100vw, 599px"/></a><p class="wp-caption-text"><strong>Figure 6:</strong> Our Python + OpenCV script has been able to successfully detect the targets in our video stream.</p></div>
<p>So as you can see, a our little target detection script has worked quite well!</p>
<p>For the full demo video of our quadcopter detecting targets in our video stream, be sure to watch the <a href="https://www.youtube.com/watch?v=VoFcNkWMu08" target="_blank">YouTube video</a> at the top of this post.</p>
<h1>Further work</h1>
<p>If you watched the YouTube video at the top of this post, you may have noticed that sometimes the crosshairs and bounding box regions of the detected target tend to “flicker”. This is because many (basic) computer vision and image processing functions are very sensitive to noise, especially noise introduced due to motion — a blurred square can easily start to look like an arbitrary polygon, and thus our target detection tests can fail.</p>
<p>To combat this, we could use some more advanced computer vision techniques. For one, we could use <a href="http://www.cs.colostate.edu/~bolme/publications/Bolme2010Tracking.pdf" target="_blank">adaptive correlation filters</a>, which I’ll be covering in a future blog post.</p>
<h1>Summary</h1>
<p>This article detailed how to use simple contour properties to find targets in drone and quadcopter video streams using Python and OpenCV.</p>
<p>The video streams were captured using my <a href="http://www.amazon.com/gp/product/B00EXBDWZC/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00EXBDWZC&amp;linkCode=as2&amp;tag=trndingcom-20&amp;linkId=JNFJVYGA4RTGDFKK" target="_blank">Hubsan X4</a>, which is an excellent starter quadcopter that comes with a built-in camera. While the Hubsan X4 does not directly stream the video back to your system for processing, it does record the video feed to a micro-SD card so that you can post-process the video later.</p>
<p>However, if you had a quadcopter that included video stream properties, you could absolutely apply the same techniques proposed in this article.</p>
<p>Anyway, I hope you enjoyed this post! And please consider sharing it on your Twitter, Facebook, or other social media!</p>
<h1 id="post_downloads">Downloads:</h1>
<p><strong>Just a quick note:</strong> The code + video download for this blog post is roughly 350mb which might take a bit of time to download if you are on a slow connection. I also pay for all Amazon S3 hosting fees out of pocket, so if you enjoy the posts on the PyImageSearch blog, please consider supporting the blog by picking up a copy of my book, <em><a href="https://www.pyimagesearch.com/practical-python-opencv/" target="_blank">Practical Python and OpenCV + Case Studies</a></em>. Otherwise, please enjoy the code and happy hacking!</p>

	</section>
	</div></body></html>