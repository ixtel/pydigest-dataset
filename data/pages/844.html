<html><body><div><div class="post-content" itemprop="articleBody">
    <p>As a technologist at HumanGeo, you're often asked to perform some kind of analysis on geospatial data, and quickly! We frequently work on short turnaround times for our customers so anything that gives us a boost is welcome, which is probably why so many of us love Python. As evidenced by the volume of scientific <a title="pycon 2014 list of talks" href="https://us.pycon.org/2014/schedule/talks/list/">talks</a> at PyCon 2014, we can also lean on the great work of the scientific community. Python lets us go from zero to answer within hours or days, not weeks.</p>
<p>I recently had to do some science on the way we can observe clusters of points on the map - to show how regions of social significance emerge. Luckily I was able to lean heavily on <a href="http://toblerity.org/shapely/">Shapely</a> which is a fantastic Python library for performing geometric operations on points, shapes, lines, etc. As an aside, if you are doing any sort of geospatial work with Python, you'll want to <code>pip install shapely</code>. Once we found a cluster of points which we believed were identifying a unique region, we needed to draw a boundary around the region so that it could be more easily digested by a geospatial analyst. Boundaries are just polygons that enclose something, so I'll walk through some of your options and attempt to provide complete code examples.</p>
<p>The first step towards geospatial analysis in Python is loading your data. In the example below, I have a shapefile containing a number of points which I generated manually with QGIS. I'll use the <a href="http://toblerity.org/fiona/">fiona</a> library to read the file in, and then create point objects with shapely.</p>
<p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="kn">as</span> <span class="nn">geometry</span>
<span class="n">input_shapefile</span> <span class="o">=</span> <span class="s">'concave_demo_points.shp'</span>
<span class="n">shapefile</span> <span class="o">=</span> <span class="n">fiona</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">input_shapefile</span><span class="p">)</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s">'geometry'</span><span class="p">])</span>
          <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">shapefile</span><span class="p">]</span></code></pre></figure>
</p><p>The points list can now be manipulated with Shapely. First, let's plot the points to see what we have.</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span></code></pre></figure>
<p><img class="alignnone wp-image-296" src="/assets/h_sparse.png" alt="H_sparse"/></p>
<p>We can now interrogate the collection. Many shapely operations result in a different kind of geometry than the one you're currently working with. Since our geometry is a collection of points, I can instantiate a MultiPoint, and then ask that MultiPoint for its envelope, which is a Polygon. Easily done like so:</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">point_collection</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
<span class="n">point_collection</span><span class="o">.</span><span class="n">envelope</span></code></pre></figure>
<p>We should take a look at that envelope. matplotlib can help us out, but polygons aren't functions, so we need to use PolygonPatch.</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">descartes</span> <span class="kn">import</span> <span class="n">PolygonPatch</span>
<span class="k">def</span> <span class="nf">plot_polygon</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">margin</span> <span class="o">=</span> <span class="o">.</span><span class="mi">3</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">bounds</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x_min</span><span class="o">-</span><span class="n">margin</span><span class="p">,</span> <span class="n">x_max</span><span class="o">+</span><span class="n">margin</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y_min</span><span class="o">-</span><span class="n">margin</span><span class="p">,</span> <span class="n">y_max</span><span class="o">+</span><span class="n">margin</span><span class="p">])</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">PolygonPatch</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">'#999999'</span><span class="p">,</span>
                         <span class="n">ec</span><span class="o">=</span><span class="s">'#000000'</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                         <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_polygon</span><span class="p">(</span><span class="n">point_collection</span><span class="o">.</span><span class="n">envelope</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span></code></pre></figure>
<p><img class="alignnone wp-image-299" src="/assets/h_envelope.png" alt="H_envelope"/></p>
<p>So without a whole lot of code, we were able to get the envelope of the points, which is the smallest rectangle that contains all of the points. In the real world, boundaries are rarely so uniform and straight, so we were naturally led to experiment with the convex hull of the points. Convex hulls are polygons drawn around points too - as if you took a pencil and connected the dots on the outer-most points. Shapely has convex hull as a built in function so let's try that out on our points.</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">convex_hull_polygon</span> <span class="o">=</span> <span class="n">point_collection</span><span class="o">.</span><span class="n">convex_hull</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_polygon</span><span class="p">(</span><span class="n">convex_hull_polygon</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span></code></pre></figure>
<p><img class="alignnone wp-image-300" src="/assets/h_convex.png" alt="H_convex"/></p>
<p>A tighter boundary, but it ignores those places in the "H" where the points dip inward. For many applications, this is probably good enough but we wanted to explore one more option which is known as a <em>concave</em> hull or alpha shape. At this point we've left the built-in functions of Shapely and we'll have to write some more code. Thankfully, smart people like Sean Gillies, the author of Shapely and fiona, have done the heavy lifting. His post on <a href="http://sgillies.net/blog/1155/the-fading-shape-of-alpha/">the fading shape of alpha</a> gave me a great place to start. I had to fill in some gaps that Sean left so I'll recreate the entire working function here.</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">shapely.ops</span> <span class="kn">import</span> <span class="n">cascaded_union</span><span class="p">,</span> <span class="n">polygonize</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">alpha_shape</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="s">"""
    Compute the alpha shape (concave hull) of a set
    of points.
    @param points: Iterable container of points.
    @param alpha: alpha value to influence the
        gooeyness of the border. Smaller numbers
        don't fall inward as much as larger numbers.
        Too large, and you lose everything!
    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="c"># When you have a triangle, there is no sense</span>
        <span class="c"># in computing an alpha shape.</span>
        <span class="k">return</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
               <span class="o">.</span><span class="n">convex_hull</span>
    <span class="k">def</span> <span class="nf">add_edge</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_points</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="s">"""
        Add a line between the i-th and j-th points,
        if not in the list already
        """</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span> <span class="ow">or</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                <span class="c"># already added</span>
                <span class="k">return</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">edge_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="p">])</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">point</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                       <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>
    <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">edge_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># loop over triangles:</span>
    <span class="c"># ia, ib, ic = indices of corner points of the</span>
    <span class="c"># triangle</span>
    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ic</span> <span class="ow">in</span> <span class="n">tri</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span>
        <span class="c"># Lengths of sides of triangle</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c"># Semiperimeter of triangle</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="c"># Area of triangle by Heron's formula</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">c</span><span class="p">))</span>
        <span class="n">circum_r</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
        <span class="c"># Here's the radius filter.</span>
        <span class="c">#print circum_r</span>
        <span class="k">if</span> <span class="n">circum_r</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">alpha</span><span class="p">:</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_points</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">)</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_points</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_points</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ia</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">edge_points</span><span class="p">)</span>
    <span class="n">triangles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygonize</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cascaded_union</span><span class="p">(</span><span class="n">triangles</span><span class="p">),</span> <span class="n">edge_points</span>
<span class="n">concave_hull</span><span class="p">,</span> <span class="n">edge_points</span> <span class="o">=</span> <span class="n">alpha_shape</span><span class="p">(</span><span class="n">points</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=</span><span class="mf">1.87</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_polygon</span><span class="p">(</span><span class="n">concave_hull</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span></code></pre></figure>
<p>That's a mouthful, but the gist is that we are going to compute Delaunay triangles which establish a connection between each point and nearby points and then we remove some of the triangles that are too far from their neighbors. This removal part is key. By identifying candidates for removal we are saying that these points are too far from their connected points so don't use that connection as part of the boundary. The result looks like this.</p>
<p><img class="alignnone wp-image-303" src="/assets/h_concave_womp_womp.png" alt="H_concave_womp_womp"/></p>
<p>Better, but not great.</p>
<p>It turns out that the alpha value and the scale of the points matters a lot when it comes to how well the Delaunay triangulation method will work. You can usually play with the alpha value to find a suitable response, but unless you can scale up your points it might not help. For the sake of a good example, I'll do both: scale up the "H" and try some different alpha values.</p>
<p>To get more points, I opened up QGIS, drew an "H" like polygon, used the tool to generate regular points, and then spatially joined them to remove any points outside the "H". My new dataset looks like this:</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">input_shapefile</span> <span class="o">=</span> <span class="s">'demo_poly_scaled_points_join.shp'</span>
<span class="n">new_shapefile</span> <span class="o">=</span> <span class="n">fiona</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">input_shapefile</span><span class="p">)</span>
<span class="n">new_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s">'geometry'</span><span class="p">])</span>
              <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">new_shapefile</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">new_points</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">new_points</span><span class="p">]</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span></code></pre></figure>
<p><img class="alignnone wp-image-304" src="/assets/h_dense.png" alt="H_dense"/></p>
<p>When we try the alpha shape transformation on these points we get a much more satisfying boundary. We can try a few permutations to find the best alpha value for these points with the following code. I combined each plot into an animated gif below.</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*.</span><span class="mi">1</span>
    <span class="n">concave_hull</span><span class="p">,</span> <span class="n">edge_points</span> <span class="o">=</span> <span class="n">alpha_shape</span><span class="p">(</span><span class="n">new_points</span><span class="p">,</span>
                                            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="c">#print concave_hull</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">edge_points</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Alpha={0} Delaunay triangulation'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">alpha</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">delaunay_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">point</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">new_points</span><span class="p">])</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delaunay_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">delaunay_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">'o'</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span>

    <span class="n">_</span> <span class="o">=</span> <span class="n">plot_polygon</span><span class="p">(</span><span class="n">concave_hull</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span></code></pre></figure>
<p><img class="alignnone wp-image-306" src="/assets/h_concave_animated_optimized.gif" alt="H_concave_animated_optimized"/></p>
<p>So in this case, alpha of about 0.4 looks pretty good. We can use shapely's buffer operation to clean up that polygon a bit and smooth out any of the jagged edges.</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span>
<span class="n">concave_hull</span><span class="p">,</span> <span class="n">edge_points</span> <span class="o">=</span> <span class="n">alpha_shape</span><span class="p">(</span><span class="n">new_points</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

<span class="n">plot_polygon</span><span class="p">(</span><span class="n">concave_hull</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span>
<span class="n">plot_polygon</span><span class="p">(</span><span class="n">concave_hull</span><span class="o">.</span><span class="nb">buffer</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#f16824'</span><span class="p">)</span></code></pre></figure>
<p><img class="alignnone wp-image-310" src="/assets/h_0-4_concave.png" alt="H_0.4_concave"/> <img class="alignnone wp-image-311" src="/assets/h_0-4_concave_buffer.png" alt="H_0.4_concave_buffer"/></p>
<p>And there you have it. Hopefully this has been a useful tour through some of your geometric boundary options in python. I recommend exploring the Shapely manual to find out about all of the other easy geometric operations you have at your fingertips. Also, if you dig Python and playing with maps, <a href="http://thehumangeo.com/company.html#slide-5">we want to hear from you</a>.</p>

  </div>

</div></body></html>