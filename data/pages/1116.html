<html><body><div><div class="post_content entry-content">
  					<p>I’ve been a professional software engineer now for about a year and 3 months. During that time I’ve learned a ton, and I’ve been able to really see and measure that just recently when I took on a small side project similar in scope to the sorts of things I was working on while I was in the Army. Since the nature of the project was similar and I was deploying a Django app from start to finish, I could compare how fast I was able to write and deploy the code, how clean the code was, how effective it was in general, and the difference in the visuals for the front end.</p>
<p>To compare myself before and after is like comparing Paul Dillett during and after steroid use, except in reverse.</p>
<div><img alt="dillett_then" src="http://scottlobdell.me/wp-content/uploads/2014/08/dillett_then-300x279.jpg"/><p>
Paul Dillett during steroid use.</p></div>
<div>
<p><img alt="" src="http://scottlobdell.me/wp-content/uploads/2014/08/dillett_now-300x225.jpg"/><br/>
Paul Dillett after steroid use.</p>
</div>
<p/>
<p> </p>
<h1>BUT IN REVERSE!</h1>
<p> </p>
<p> </p>
<div><img alt="" src="http://scottlobdell.me/wp-content/uploads/2014/08/dillett_now-300x225.jpg"/><p>
Before</p></div>
<div><img alt="dillett_then" src="http://scottlobdell.me/wp-content/uploads/2014/08/dillett_then-300x279.jpg"/><p>
After</p></div>
<p/>
<p>I intended to write about the brief project both to share the application itself but also to show some code samples that demonstrate some of the things that I’ve learned at <a href="http://www.hearsaysocial.com">Hearsay Social</a>. Since we’re writing proprietary code, I can’t necessarily show those samples unless I try and think of some arbitrary example with no real use case, which typically results in these weird models that no one cares about and would ever use IRL (cool people term for “in real life”).</p>
<p>The work was done on the train ride home over the course of two weeks. I took up the work because of what I’d intended to do over a year ago with aerial photography, but I had given up on the idea basically because the amount of work required to see the entire project through would be more than I think I could take on. However, after working with Larry Fleming from <a href="http://eblimp.com">eBlimp</a>, I found the opportunity to specialize and build an application without having to get directly involved with drones.</p>
<h1>The Project Itself</h1>
<p>Currently, the site is in limbo as far as a corresponding domain name, but I have the application temporary hosted at <a href="http://pictureblimp.com">PictureBlimp.com</a>; I’ll come back to update this post as necessary. In a very generic sense, the idea is that any photographer can be associated with the Django application, and once associated, they can drop pictures onto a folder into Dropbox, and their work is done. From there, my application interfaces with the Dropbox API to grab new pictures from Dropbox, copy the picture to both a watermarked and thumbnailed version, then upload the thumbnail, watermarked file, and original to Amazon S3. The watermark and thumbnail file are public. The original is not.<br/>
<a href="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.49.02-PM.png"><img class="alignnone size-medium wp-image-727" alt="Screen Shot 2014-08-06 at 8.49.02 PM" src="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.49.02-PM-300x285.png"/></a> <a href="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.49.12-PM.png"><img class="alignnone size-medium wp-image-728" alt="Screen Shot 2014-08-06 at 8.49.12 PM" src="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.49.12-PM-300x149.png"/></a></p>
<p>From there, the image is saved and associated with the photographer that uploaded it via Dropbox, and the date taken is extracted via the jpeg’s exif data. The picture can be associated with an event based on the folder name it was in within Dropbox. End users can then peruse pictures on a web application and search either by a calendar view or by an event’s name.<br/>
<a href="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.48.22-PM.png"><img alt="Screen Shot 2014-08-06 at 8.48.22 PM" src="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.48.22-PM-300x176.png"/></a></p>
<p><a href="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.51.53-PM.png"><img class="alignnone size-medium wp-image-729" alt="Screen Shot 2014-08-06 at 8.51.53 PM" src="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-8.51.53-PM-300x254.png"/></a></p>
<p>Pricing is also controlled via dropbox to make maintenance as easy as possible. Rather than just sell original images directly, pricing is determined by resolution with a simple text file that can be modified in Dropbox. Prices are associated with image resolutions.</p>
<p>The site is intentionally lightweight, so shopping cart logic is controlled entirely through the session. Upon checkout, credit card information is handled entirely by Stripe, which offloads the boring logic of payments and alleviates any responsibility of credit card security. Upon a successful credit card charge, the application will download the original image from Amazon, resize it to the size specified by the customer, re-upload the file to Amazon with an encoded file name, and email the customer with a link to the file.</p>
<p>Django does have built-in functionality to email users, but this incurs an extra layer of maintenance when free services exist in API form to email people. I used <a href="http://mailgun.com/">MailGun</a>, which allows 10,000 emails free per month. After that, it’s still dirt cheap, but I don’t intend to Email that many people to begin with. Without that service, we would need to setup some type of Email Server and manage a separate process, risking errors, memory, and general domain setup with Email.</p>
<h1>The Code</h1>
<p>As mentioned earlier, there’s a huge difference between my code now and my code one year ago to the point that it’s embarassing to show my old code samples. The biggest difference is my current obsession with modularity and constantly decomposing problems. Now, I constantly keep <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">The Law of Demeter</a> in mind. The thought process I maintain is:</p>
<ul>
<li>Can this block of code be abstracted into a function with a name describing what I’m doing?</li>
<li>Am I repeating something that I’ve already done that can be abstracted into a function?</li>
<li>Is this class taking on more responsibility than it should?</li>
<li>Does this class know too much about the objects that it’s manipulating?</li>
<li>Is there an excessive number of parameters being passed?</li>
<li>Is this block of code getting to be unnecessarily long?</li>
<li>Does this code have corresponding test coverage / is this function easy to test?</li>
</ul>
<p>Other thoughts going through my head:</p>
<ul>
<li>How is Le doing right now with the kids?</li>
<li>I wonder what’s going on at lunch today?</li>
<li>Would it be too wild and crazy if I drank more coffee?</li>
<li>Is there anything ironic or ridiculous about my current surrounding that I can point out to everyone else around me?</li>
</ul>
<p>Another common pattern I’ve adopted is to create proxy objects for Django models. This was something that Adam “The Blonde Bomber” Depue introduced to me and I initially questioned. My thought process at the time was that creating the proxy objects defeated the purpose of using Django, and building these objects intrinsically indicated that the programmer writing the code was conveying the message that he/she did not trust their co-workers to properly use the associated Django models. Here is some sample code that demonstrates the pattern I’m talking about:</p>
<p/>
<div>
<pre><span>import</span> <span>datetime</span>

<span>from</span> <span>django.core.urlresolvers</span> <span>import</span> <span>reverse</span>
<span>from</span> <span>django.db</span> <span>import</span> <span>models</span>

<span>class</span> <span>_Picture</span><span>(models.Model):</span>

    <span>class</span> <span>Meta</span><span>:</span>
        <span>app_label</span> <span>=</span> <span>'pictures'</span>
        <span>db_table</span> <span>=</span> <span>'pictures_picture'</span>

    <span>event_id</span> <span>=</span> <span>models.IntegerField()</span>
    <span>photographer_name</span> <span>=</span> <span>models.CharField(max_length=</span><span>100</span><span>,</span> <span>null=</span><span>True</span><span>)</span>
    <span>date_taken</span> <span>=</span> <span>models.DateTimeField(null=</span><span>True</span><span>)</span>
    <span>saved_to_hard_drive</span> <span>=</span> <span>models.BooleanField(default=</span><span>False</span><span>)</span>
    <span>uploaded_to_amazon</span> <span>=</span> <span>models.BooleanField(default=</span><span>False</span><span>)</span>
    <span>amazon_bucket</span> <span>=</span> <span>models.CharField(max_length=</span><span>255</span><span>)</span>
    <span>watermark_suffix</span> <span>=</span> <span>models.CharField(max_length=</span><span>100</span><span>)</span>
    <span>thumbnail_suffix</span> <span>=</span> <span>models.CharField(max_length=</span><span>100</span><span>)</span>
    <span>event_name_at_save_time</span> <span>=</span> <span>models.CharField(max_length=</span><span>255</span><span>)</span>
    <span># TODO need to index by date, ID, and event_id</span>

<span>class</span> <span>Picture</span><span>(</span><span>object</span><span>):</span>

    <span>BASE_URL</span> <span>=</span> <span>"https://s3.amazonaws.com"</span>

    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>_picture):</span>
        <span>self</span><span>._picture</span> <span>=</span> <span>_picture</span>

    <span>@classmethod</span>
    <span>def</span> <span>_wrap</span><span>(cls,</span> <span>_picture):</span>
        <span>return</span> <span>Picture(_picture)</span>

    <span>@classmethod</span>
    <span>def</span> <span>create_for_event</span><span>(cls,</span>
                         <span>event_obj,</span>
                         <span>date_taken,</span>
                         <span>photographer_name,</span>
                         <span>amazon_bucket,</span>
                         <span>watermark_suffix,</span>
                         <span>thumbnail_suffix):</span>

        <span>_picture</span> <span>=</span> <span>_Picture.objects.create(event_id=event_obj.id,</span>
                                           <span>photographer_name=photographer_name,</span>
                                           <span>date_taken=date_taken,</span>
                                           <span>amazon_bucket=amazon_bucket,</span>
                                           <span>watermark_suffix=watermark_suffix,</span>
                                           <span>thumbnail_suffix=thumbnail_suffix,</span>
                                           <span>event_name_at_save_time=event_obj.name)</span>
        <span>return</span> <span>Picture._wrap(_picture)</span>

    <span>def</span> <span>mark_saved_on_hard_drive</span><span>(</span><span>self</span><span>):</span>
        <span>self</span><span>._picture.saved_to_hard_drive</span> <span>=</span> <span>True</span>
        <span>self</span><span>._picture.save()</span>

    <span>def</span> <span>mark_uploaded_to_amazon</span><span>(</span><span>self</span><span>):</span>
        <span>self</span><span>._picture.uploaded_to_amazon</span> <span>=</span> <span>True</span>
        <span>self</span><span>._picture.save()</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_pictures_from_filenames</span><span>(cls,</span> <span>file_paths):</span>
        <span>filenames</span> <span>=</span> <span>[file_path.split(</span><span>"/"</span><span>)[-</span><span>1</span><span>]</span> <span>for</span> <span>file_path</span> <span>in</span> <span>file_paths]</span>
        <span>ids</span> <span>=</span> <span>[</span><span>int</span><span>(filename.split(</span><span>"."</span><span>)[</span><span>0</span><span>])</span> <span>for</span> <span>filename</span> <span>in</span> <span>filenames]</span>
        <span>_pictures</span> <span>=</span> <span>_Picture.objects.filter(id__in=ids)</span>
        <span>return</span> <span>[Picture._wrap(_picture)</span> <span>for</span> <span>_picture</span> <span>in</span> <span>_pictures]</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_pictures_in_month_day_year</span><span>(cls,</span> <span>month,</span> <span>day,</span> <span>year):</span>
        <span>start</span> <span>=</span> <span>datetime.datetime(year=year,</span> <span>month=month,</span> <span>day=day,</span> <span>hour=</span><span>0</span><span>,</span> <span>minute=</span><span>0</span><span>,</span> <span>second=</span><span>0</span><span>,</span> <span>microsecond=</span><span>0</span><span>)</span>
        <span>end</span> <span>=</span> <span>start</span> <span>+</span> <span>datetime.timedelta(days=</span><span>1</span><span>)</span>
        <span>_pictures</span> <span>=</span> <span>(_Picture.objects.</span>
                     <span>filter</span><span>(date_taken__gte=start).</span>
                     <span>filter</span><span>(date_taken__lt=end).</span>
                     <span>filter</span><span>(uploaded_to_amazon=</span><span>True</span><span>))</span>
        <span>return</span> <span>[Picture._wrap(_picture)</span> <span>for</span> <span>_picture</span> <span>in</span> <span>_pictures]</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_pictures_in_month_and_year</span><span>(cls,</span> <span>month,</span> <span>year):</span>
        <span>''' 1 is January, 12 is December '''</span>
        <span>start</span> <span>=</span> <span>datetime.datetime(year=year,</span> <span>month=month,</span> <span>day=</span><span>1</span><span>,</span> <span>hour=</span><span>0</span><span>,</span> <span>minute=</span><span>0</span><span>,</span> <span>second=</span><span>0</span><span>,</span> <span>microsecond=</span><span>0</span><span>)</span>
        <span>end</span> <span>=</span> <span>(start</span> <span>+</span> <span>datetime.timedelta(days=</span><span>31</span><span>)).replace(day=</span><span>1</span><span>)</span>
        <span>_pictures</span> <span>=</span> <span>(_Picture.objects.</span>
                     <span>filter</span><span>(date_taken__gte=start).</span>
                     <span>filter</span><span>(date_taken__lt=end).</span>
                     <span>filter</span><span>(uploaded_to_amazon=</span><span>True</span><span>))</span>
        <span>return</span> <span>[Picture._wrap(_picture)</span> <span>for</span> <span>_picture</span> <span>in</span> <span>_pictures]</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_by_id</span><span>(cls,</span> <span>picture_id):</span>
        <span>_picture</span> <span>=</span> <span>_Picture.objects.get(</span><span>id</span><span>=picture_id)</span>
        <span>return</span> <span>Picture._wrap(_picture)</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_by_ids</span><span>(cls,</span> <span>picture_ids):</span>
        <span>_pictures</span> <span>=</span> <span>_Picture.objects.filter(id__in=picture_ids)</span>
        <span>return</span> <span>[Picture._wrap(_picture)</span> <span>for</span> <span>_picture</span> <span>in</span> <span>_pictures]</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_pictures_from_event</span><span>(cls,</span> <span>event_obj):</span>
        <span>_pictures</span> <span>=</span> <span>_Picture.objects.filter(event_id=event_obj.id).filter(uploaded_to_amazon=</span><span>True</span><span>)</span>
        <span>return</span> <span>[Picture._wrap(_picture)</span> <span>for</span> <span>_picture</span> <span>in</span> <span>_pictures]</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_pictures_by_most_recent</span><span>(cls,</span> <span>max_count=</span><span>None</span><span>):</span>
        <span>_pictures</span> <span>=</span> <span>(_Picture.objects.</span>
                     <span>exclude(date_taken__isnull=</span><span>True</span><span>).</span>
                     <span>filter</span><span>(uploaded_to_amazon=</span><span>True</span><span>).</span>
                     <span>order_by(</span><span>"-date_taken"</span><span>))</span>
        <span>if</span> <span>max_count:</span>
            <span>_pictures</span> <span>=</span> <span>_pictures[:max_count]</span>
        <span>return</span> <span>[Picture._wrap(_picture)</span> <span>for</span> <span>_picture</span> <span>in</span> <span>_pictures]</span>

    <span>@classmethod</span>
    <span>def</span> <span>get_most_recent_datetime</span><span>(cls):</span>
        <span>return</span> <span>_Picture.objects.all().latest(</span><span>'date_taken'</span><span>).date_taken</span>

    <span>@property</span>
    <span>def</span> <span>amazon_key</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>"%s/%s.jpg"</span> <span>%</span> <span>(</span><span>self</span><span>._picture.event_name_at_save_time,</span>
                              <span>self</span><span>.id)</span>

    <span>@property</span>
    <span>def</span> <span>thumbnail_url</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>"%s/%s/%s/%s%s.jpg"</span> <span>%</span> <span>(</span><span>self</span><span>.BASE_URL,</span>
                                      <span>self</span><span>._picture.amazon_bucket,</span>
                                      <span>self</span><span>._picture.event_name_at_save_time,</span>
                                      <span>self</span><span>.id,</span>
                                      <span>self</span><span>._picture.thumbnail_suffix)</span>

    <span>@property</span>
    <span>def</span> <span>watermark_url</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>"%s/%s/%s/%s%s.jpg"</span> <span>%</span> <span>(</span><span>self</span><span>.BASE_URL,</span>
                                      <span>self</span><span>._picture.amazon_bucket,</span>
                                      <span>self</span><span>._picture.event_name_at_save_time,</span>
                                      <span>self</span><span>.id,</span>
                                      <span>self</span><span>._picture.watermark_suffix)</span>

    <span>@property</span>
    <span>def</span> <span>filename</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>"%s/%s.jpg"</span> <span>%</span> <span>(</span><span>self</span><span>._picture.event_name_at_save_time,</span> <span>self</span><span>._picture.id)</span>

    <span>@property</span>
    <span>def</span> <span>id</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>._picture.id</span>

    <span>@property</span>
    <span>def</span> <span>event_name</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>._picture.event_name_at_save_time</span>

    <span>@property</span>
    <span>def</span> <span>event_id</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>._picture.event_id</span>

    <span>@property</span>
    <span>def</span> <span>url</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>reverse(</span><span>'picture'</span><span>,</span> <span>args=[</span><span>self</span><span>.id])</span>

    <span>@property</span>
    <span>def</span> <span>date_taken</span><span>(</span><span>self</span><span>):</span>
        <span>return</span> <span>self</span><span>._picture.date_taken</span></pre>
</div>
<p>Note that in the above code, the Picture object that we end up using for the rest of the application is a simple Python object.  Database queries are moved to classmethods on the class, thus creating a single chokepoint for where queries occur.  Properties of the class are read-only, and actions to save or update the model are placed inside explicit methods.</p>
<p>Of course, now I have a different outlook, and even with the questions I raised earlier, distrusting co-workers is healthy to the degree that you can build modules such that it is difficult for them to fail for the very same reason that all production code should have corresponding test coverage. While django is incredibly easy to use, its ease of use can encourage bad or sloppy coding habits. Some of the benefits of building models in this way:</p>
<ul>
<li>It makes it easier to de-couple models (i.e. put django models in different databases entirely if you wanted)</li>
<li>Major use cases are isolated to one file, making it easy to modify or isolate as necessary</li>
<li>It’s easy to see your primary use cases and generate SQL indexes as necessary</li>
<li>Proper usage and querying can be baked into the code</li>
<li>It becomes incredibly easy to understand and learn what the model encompasses</li>
</ul>
<p>To my last point, consider a case in which you as a developer are stepping into someone else’s code and learning about a django model for the first time. Below are some screenshots with me tabbing out the attributes of a django object and its corresponding proxy object:</p>
<p> </p>
<p> </p>
<h2>Django Model</h2>
<p> <br/>
<img class="alignnone size-medium wp-image-721" alt="Screen Shot 2014-08-06 at 5.53.20 PM" src="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-5.53.20-PM.png"/></p>
<p/><center/>
<h2>Proxy Model</h2>
<p> <br/>
<img class="alignnone size-medium wp-image-722" alt="Screen Shot 2014-08-06 at 5.54.09 PM" src="http://scottlobdell.me/wp-content/uploads/2014/08/Screen-Shot-2014-08-06-at-5.54.09-PM.png"/></p>
<p>In the example of the django object, there are tons of generic attributes and methods that I will never use, and I have no idea what they do. The proxy object, by contrast, has clear attributes and methods that I know are safe to use. Within the django object, it’s difficult to discern which attributes/methods are django specific and which ones are items that the authoring developer added.</p>
<p>Also note that there are no foreign keys in my django model. This forces the end operating developer to put his or her thinking cap on and helps to avoid lazy database queries. Foreign keys can create a minor performance cost, and avoiding using them also helps for the servicification aspect I mentioned above. Also, this forces the maintenance logic of the database to be done by python, alleviating a small load from the database. This is beneficial where possible since the database is a shared resource, but the instances of the python code are not necessarily shared between requests. On that note, we can’t as easily join tables together at the SQL level, and instead we generally do the same logic with two queries with python. This, again, shifts the responsibility of building a temp table to python which is fairly easy using dictionary logic. In the process we also use less memory when joining a table; SQL will populate every column with a row on table joins when it’s not really necessary as we duplicate objects on those joins.<br/><br/><br/>
Anyway, another end result is that the logic for the controller is super simple and straightforward, leaving your views.py uncluttered, and use cases are outlined from the top down all the way through:<br/>

</p><div>
<pre><span>def</span> <span>picture</span><span>(request,</span> <span>picture_id):</span>
    <span>render_data</span> <span>=</span> <span>{}</span>
    <span>try</span><span>:</span>
        <span>render_data[</span><span>'picture'</span><span>]</span> <span>=</span> <span>Picture.get_by_id(picture_id)</span>
    <span>except</span> <span>ObjectDoesNotExist:</span>
        <span>raise</span> <span>Http404</span>
    <span>render_data[</span><span>'pricings'</span><span>]</span> <span>=</span> <span>Pricing.get_for_event_id(render_data[</span><span>'picture'</span><span>].event_id)</span>
    <span>return</span> <span>global_render_to_response(request,</span> <span>"basic_navigation/picture.html"</span><span>,</span> <span>render_data)</span>
</pre>
</div>
<h1>Boto</h1>
<p>Of the libraries I ended up using, it’s pretty bananas what power is readily available. Boto is a module that allows a user to readily interface with Amazon S3, which offers crazy cheap storage and is the same hosting tool used by companies like Dropbox. 1 gigabyte costs you $0.03 per month. Conceptually, a bucket can be created in S3 for a developer, and a key represents a filepath from there. Items can be uploaded and downloaded using the key, and files remain private until explicitly made public. As such there are all sorts of applications that could be created even for basic home usage.</p>
<h1>Stripe</h1>
<p>For my purposes, I tried using the Paypal API and gave up shortly thereafter. The API didn’t make much sense, the examples weren’t that great and they were all in PHP, and it was an overly complex process to create a charge. Plus there are additional burdens that get created for the end user. I’d heard of Stripe before, so I gave that a try and was literally up and running within minutes. Stripe is purely comissioned based, so it’s ideal for a side project like mine as well where I have no idea if I’ll even make money and I don’t want to be paying recurring monthly charges (like Paypal requires).</p>
<p>Stripe makes it so that you don’t need to touch credit card information whatsoever. You can use a client-side javascript file that posts information to Stripe, where they handle all of the security requirements of credit card usage, and they pass back a token to you which represents a credit card payment that you can then charge. Their API is extremely straightforward and simple.</p>
<h1>Dropbox API</h1>
<p>The Dropbox API is exactly as you’d expect. There are high level operations to read directory listings from a Dropbox account, read a file, write to a file, move a file, etc.</p>
<h1>Mailgun</h1>
<p>Mailgun is one of many services that create an API interface for sending and receiving emails in bulk for very cheap. They were the #1 result on google, hence why I signed up for their service. A simple POST call sends an email, which was sufficient for my purposes.</p>
  					<p class="clear"/>
 			 </div>	
			 
					   					</div></body></html>