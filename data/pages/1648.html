<html><body><div><div class="num h48 no-margin" data-goal="55000.0" data-percent-raised="4.750008363636363636363636364" data-pledged="261250.46" id="pledged">
<p>This contains most of the information I wanted. I also wanted to add in how much time was left over as well, and found that in another place, nearer the top of the page. (Line 88 of HDMIPi page)</p>
<pre name="code" class="html:firstline[88]"><meta property="twitter:text:time" content="0 seconds"/></pre>
<p>Obviously the time left will be different for a live campaign (e.g. 16 hours or 24 days, rather than 0 seconds).</p>
<p>So this gives us a way of locating the information we want to extract from 2 lines in the HTML.</p>
<p><code>data-goal="55000.0"</code> gives us the fundraising target in £ or $<br/>
<code>data-percent-raised="4.750008363636363636363636364"</code> multipling this by 100 gives us the percentage of the target raised so far. We’ll chop it to 2 decimal places in our code<br/>
<code>data-pledged="261250.46"</code> gives us the total amount pledged so far<br/>
<code>twitter:text:time" content="0 seconds"</code> tells us how much time the campaign has left to run</p>
<p>All we’ve got to do now is make the computer find, then split, slice and present the information how we want it. Sounds easy :)</p>
<h3>Starting To Code</h3>
<p>So having worked out how to find the information, or at least what lines it’s on, I needed to do a bit of homework about urllib2. I knew it could be used to load a web page, but needed a robust way of doing it. I found an <a href="https://docs.python.org/2/howto/urllib2.html" title="urllib2 documentation" target="_blank">excellent resource in the official Python documentation</a> which gave me a whole snippet of code for this. It basically imports all the required parts of urllib2 and wraps the <code>urlopen()</code> call in a <code>try: except:</code> block. </p>
<p>This handles the situation when you lose your internet connection or if the web site doesn’t respond in time. Rather than crash the program, it handles the “Exception”, tells you what’s happening and tries again next time around. This is what I meant when I said “robust”.</p>
<pre name="code" class="python">
from urllib2 import Request, urlopen, URLError
req = Request(someurl)
try:
    response = urlopen(req)
except URLError as e:
    if hasattr(e, 'reason'):
        print 'We failed to reach a server.'
        print 'Reason: ', e.reason
    elif hasattr(e, 'code'):
        print 'The server couldn\'t fulfill the request.'
        print 'Error code: ', e.code
else:
    # this is where you put the rest of your code to run after opening the web page
</pre>
<h3>Now Let’s Add The URL</h3>
<p>This code won’t really do anything unless we give it a value for <code>someurl</code> which is the URL of the web page we want to load. So let’s add some code to the above to tell it the URL and get it to go through each line of the html file looking for the lines we want, and print them out on the screen when found.</p>
<pre name="code" class="Python">
from urllib2 import Request, urlopen, URLError
from time import sleep

someurl= 'https://www.kickstarter.com/projects/697708033/hdmipi-affordable-9-high-def-screen-for-the-raspbe'

req = Request(someurl)
try:
    response = urlopen(req)
except URLError as e:
    if hasattr(e, 'reason'):
        print 'We failed to reach a server.'
        print 'Reason: ', e.reason
    elif hasattr(e, 'code'):
        print 'The server couldn\'t fulfill the request.'
        print 'Error code: ', e.code
else:
    the_page = response.readlines()     # read each line of the html file into a variable 'the_page'
    for line in the_page:               # iterate through the lines
                                        # checking for the ones we want to find &amp; print them
        if 'twitter:text:time' in line:
            print line
    
        if 'data-goal' in line:
            print line
</pre>
<p>This results in…<br/>
</p><div id="attachment_7011" class="wp-caption aligncenter"><a href="http://raspi.tv/wp-content/uploads/2014/09/ks1.png"><img src="http://raspi.tv/wp-content/uploads/2014/09/ks1-1024x209.png" alt="ks1.py program output" class="size-large wp-image-7011" srcset="http://raspi.tv/wp-content/uploads/2014/09/ks1-300x61.png 300w, http://raspi.tv/wp-content/uploads/2014/09/ks1-1024x209.png 1024w" sizes="(max-width: 695px) 100vw, 695px"/></a><p class="wp-caption-text">ks1.py program output</p></div>
<h3>Now We Need To Split The Line</h3>
<p>So we’ve retrieved the two lines we want. Now we want to extract just the data from them. How can we do that? There’s a very useful function called <code>split()</code> which we’ll make use of.</p>
<h4>Explanation Of Split &amp; Slicing</h4>
<p>In line 20 of the Python script below, we use the code<br/>
<code>days_left=line.split('"')[3]</code></p>
<p>This is using <code>split()</code> to split up the whole line…<br/>
<code>&lt;meta property="twitter:text:time" content="0 seconds"&gt;</code><br/>
…into pieces. It breaks everywhere it meets the <code>"</code> character (and removes the <code>"</code>). So it will break this line into a list variable containing the following elements…<br/>
<code><br/>
&lt;meta property=<br/>
twitter:text:time<br/>
 content=<br/>
0 seconds<br/>
&gt;</code></p>
<p>If you print <code>line.split('"')</code> it’ll look like this…<br/>
<code>['&lt;meta property=', 'twitter:text:time', ' content=', '0 seconds', '&gt;']</code></p>
<p>The first list element has position 0. This is called its index. We’re after the ‘0 seconds’ part which has index 3. So we <strong><em>‘slice’</em></strong> the list using [3], which gives us the list element in index position 3.<br/>
<code>days_left=line.split('"')[3]</code> (This [3] is called ‘slice notation’)</p>
<h3>Here’s the full code…</h3>
<pre class="brush: python; title: ; notranslate" title="">
from urllib2 import Request, urlopen, URLError
from time import sleep

someurl= 'https://www.kickstarter.com/projects/697708033/hdmipi-affordable-9-high-def-screen-for-the-raspbe'

req = Request(someurl)
try:
    response = urlopen(req)
except URLError as e:
    if hasattr(e, 'reason'):
        print 'We failed to reach a server.'
        print 'Reason: ', e.reason
    elif hasattr(e, 'code'):
        print 'The server couldn\'t fulfill the request.'
        print 'Error code: ', e.code
else:
    the_page = response.readlines()       # read each line of the html file
    for line in the_page:                 # iterate through the lines
        if 'twitter:text:time' in line:   # check for lines we want to find &amp; print them
            days_left=line.split('"')[3]
    
        if 'data-goal' in line:
            words = line.split(" ")             # split line into 'words' 
            for word in words:                  # iterate through 'words'
                if 'data-goal' in word:     
                    target = word.split('"')    # split word at " character
                                                             # make 2nd element a float
                    print 'target: %.2f' % float(target[1])  # then truncate to 2 d.p.
                if 'data-percent-raised' in word:
                    percent = word.split('"')
                    print 'percentage raised: %.2f' % (float(percent[1]) * 100)
                if 'data-pledged' in word:
                    amount_raised = word.split('"')
                    print 'Total so far: %.2f' % float(amount_raised[1])
            print 'Time left: %s' % days_left
            print ' '                           # stick a blank line on the end
            break                               # break out of the loop once done
</pre>
<p>Lines 26-34 make use of further splitting and slicing. We also need to convert the data we want into ‘float’ variable type before we can do anything mathematical with it.</p>
<p><code>print 'target: %.2f' % float(target[1])</code> takes the 2nd element of ‘target’, converts it to a float and then <code>.2f</code> ensures that only the first two decimal places are printed on the screen.</p>
<h3>Here’s What The Output Looks Like</h3>
<div id="attachment_7015" class="wp-caption aligncenter"><a href="http://raspi.tv/wp-content/uploads/2014/09/ks2.png"><img src="http://raspi.tv/wp-content/uploads/2014/09/ks2-300x129.png" alt="ks2.py output" class="size-medium wp-image-7015" srcset="http://raspi.tv/wp-content/uploads/2014/09/ks2-300x129.png 300w, http://raspi.tv/wp-content/uploads/2014/09/ks2.png 798w" sizes="(max-width: 300px) 100vw, 300px"/></a><p class="wp-caption-text">ks2.py output</p></div>
<p>Obviously, you should change the URL in line 4 to track the live KS campaign you’re interested in.</p>
<h3>The Story So Far</h3>
<p>So far we’ve managed to…</p>
<ul>
<li>load a web page</li>
<li>find the lines where our data is</li>
<li>split out that data and retain just the parts we want by slicing</li>
<li>convert it into something we can manipulate (float)</li>
<li>truncate (shorten) to two decimal places and display it on the screen</li>
</ul>
<p>That’s a very good start. We’ll take it further in the next part by…</p>
<ul>
<li>making the output more visually attractive</li>
<li>adding some more campaigns</li>
<li>putting it all in a continuous loop with a time delay</li>
</ul>
<p><a href="http://raspi.tv/2014/programming-a-kickstarter-tracker-in-python-part-2" title="Kickstarter Tracker part 2">Part 2 can be found here.</a></p>
			</div>
		</div></body></html>