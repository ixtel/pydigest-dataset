<html><body><div><div class="post">
  <h1 class="post-title">Form Handling With Mechanize And Beautifulsoup</h1>
  <span class="post-date">08 Dec 2014</span>
  <p>Python <a target="_blank" href="http://wwwsearch.sourceforge.net/mechanize/">Mechanize</a> 
is a module that provides an API for programmatically browsing web pages and manipulating 
HTML forms. <a target="_blank" href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> 
is a library for parsing and extracting data from HTML. Together they form a powerful 
combination of tools for web scraping.</p>

<p>In this post, I'll highlight some of the features that Mechanize provides for
manipulating HTML forms. Specifically, I'll go over the following:</p>

<ul>
<li>Opening a page with mechanize and selecting a form</li>
<li>Filling in the form</li>
<li>Submitting the form</li>
<li>What to do when things go wrong</li>
</ul>

<h3>Setup</h3>

<p>Execute the following commands in order to install Mechanize and BeautifulSoup within a 
virtual environment: </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mkdir scraper <span class="o">&amp;&amp;</span> <span class="nb">cd </span>scraper
<span class="nv">$ </span>virtualenv venv
<span class="nv">$ </span><span class="nb">source </span>venv/bin/activate
<span class="nv">$ </span>pip install mechanize
<span class="nv">$ </span>pip install beautifulsoup4</code></pre></div>

<h2>Opening a page and selecting a form</h2>

<p>To open a page with mechanize, instantiate a <code>Browser</code> and provide the url of the page
to the <code>open</code> method:</p>

<h3>Opening a page</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">mechanize</span>

<span class="n">br</span> <span class="o">=</span> <span class="n">mechanize</span><span class="o">.</span><span class="n">Browser</span><span class="p">()</span>
<span class="n">br</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">'http://thayton.github.io'</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">response</span><span class="p">()</span>

<span class="k">print</span> <span class="n">response</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span> <span class="c"># URL of the page we just opened</span>
<span class="k">print</span> <span class="n">response</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>   <span class="c"># headers</span>
<span class="k">print</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>   <span class="c"># body</span></code></pre></div>

<h3>Form selection</h3>

<p>Once you've opened a page, select a form using <code>select_form</code> with the name of the form as the argument:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">br</span><span class="o">.</span><span class="n">select_form</span><span class="p">(</span><span class="s">'searchForm'</span><span class="p">)</span></code></pre></div>

<h3>Form selection using a predicate function</h3>

<p>If the form does not have a name attribute, you can use a predicate function to select the form based off
of one of its other attributes. </p>

<p>For instance, the following form has no <code>name</code> attribute:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/en/search/"</span> <span class="na">id=</span><span class="s">"form1"</span><span class="nt">&gt;</span></code></pre></div>

<p>We can select this form by filtering on its <code>id</code>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">select_form</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">form</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="s">'form1'</span>

<span class="n">br</span><span class="o">.</span><span class="n">select_form</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="n">select_form</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span></code></pre></div>

<p>Or we can select against the form's <code>action</code> instead:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">select_form</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">form</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'action'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="s">'/en/search/'</span>

<span class="n">br</span><span class="o">.</span><span class="n">select_form</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="n">select_form</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span></code></pre></div>

<h2>Filling in the form</h2>

<h3>Setting control values by name</h3>

<p>After you have selected a form, fill it in by providing the name of the form control you 
want to set along with its associated value using the following format:</p>



<p>For example,</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'boption'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'CLoad'</span>
<span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'hitsPerPage'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="s">'50'</span> <span class="p">]</span></code></pre></div>

<p>That's equivalient to:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s">'CLoad'</span><span class="p">,</span> <span class="s">'boption'</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">set_value</span><span class="p">([</span><span class="s">'50'</span><span class="p">],</span> <span class="s">'hitsPerPage'</span><span class="p">)</span></code></pre></div>

<p>Which is also equivalent to:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ctl</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">find_control</span><span class="p">(</span><span class="s">'boption'</span><span class="p">)</span>
<span class="n">ctl</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">'CLoad'</span>

<span class="n">ctl</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">find_control</span><span class="p">(</span><span class="s">'hitsPerPage'</span><span class="p">)</span>
<span class="n">ctl</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="s">'50'</span><span class="p">]</span></code></pre></div>

<p>If you get the read-only error </p>

<p><code>ValueError: control '&lt;em&gt;control_name&lt;/em&gt;' is readonly</code> </p>

<p>when filling out the form, change the control's readonly attribute to <code>False</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">find_control</span><span class="p">(</span><span class="s">'control_name'</span><span class="p">)</span><span class="o">.</span><span class="n">readonly</span> <span class="o">=</span> <span class="bp">False</span></code></pre></div>

<p>or call <code>set_all_readonly(False)</code> on the form to make all of the controls writable.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">set_all_readonly</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></code></pre></div>

<h3>Control selection using a predicate function</h3>

<p>You can also use predicate functions in conjunction with regular-expressions to
select controls within a form that match a specific pattern:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">select_control</span><span class="p">(</span><span class="n">control</span><span class="p">):</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r'ctl\d+_HiddenField'</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">control</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="n">ctl</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">find_control</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="n">select_control</span><span class="p">)</span>
<span class="n">ctl</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">'someval'</span></code></pre></div>

<h2>Submitting the form</h2>

<h3>Submitting a form</h3>

<p>Once you've filled out all of the form values, submit the form by
calling <code>submit</code>:</p>



<h3>Form submission when multiple submit buttons present</h3>

<p>Sometimes you can't just call <code>submit</code> with no arguments because there's more than 
one submit button and you want mechanize to choose a specific one. A common scenario 
is when one of the buttons is for 'Search' and the other is for Resetting or 
Clearing the form.</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">"searchForm"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"search.do"</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"image"</span> <span class="na">name=</span><span class="s">"reset"</span> <span class="na">src=</span><span class="s">"Reset.gif"</span> <span class="na">alt=</span><span class="s">"Reset Form"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"image"</span> <span class="na">name=</span><span class="s">"input"</span> <span class="na">src=</span><span class="s">"Search.gif"</span> <span class="na">id=</span><span class="s">"searchButton"</span> <span class="na">alt=</span><span class="s">"Search"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/form&gt;</span></code></pre></div>

<p>In this case, pass the id of the desired control when calling <code>submit</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">br</span><span class="o">.</span><span class="n">select_form</span><span class="p">(</span><span class="s">'searchForm'</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">'searchButton'</span><span class="p">)</span></code></pre></div>

<p>or specify the name:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">br</span><span class="o">.</span><span class="n">select_form</span><span class="p">(</span><span class="s">'searchForm'</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'input'</span><span class="p">)</span></code></pre></div>

<h2>When things go wrong</h2>

<p>Here are some common issues you may encounter when handling forms with mechanize.</p>

<h3>Handling 'ParseError: OPTION outside of SELECT'</h3>

<p>If you attempt to select a form but it fails with the following error:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">mechanize</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">ParseError</span><span class="p">:</span> <span class="n">OPTION</span> <span class="n">outside</span> <span class="n">of</span> <span class="n">SELECT</span></code></pre></div>

<p>Fix the situation by running the page through BeautifulSoup before selecting the 
form with mechanize:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">mechanize</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">br</span> <span class="o">=</span> <span class="n">mechanize</span><span class="o">.</span><span class="n">Browser</span><span class="p">()</span>
<span class="n">br</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">br</span><span class="o">.</span><span class="n">response</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">html</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">mechanize</span><span class="o">.</span><span class="n">make_response</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="p">[(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">)],</span>
                               <span class="n">br</span><span class="o">.</span><span class="n">geturl</span><span class="p">(),</span> <span class="mi">200</span><span class="p">,</span> <span class="s">"OK"</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">set_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">select_form</span><span class="p">(</span><span class="s">'aspnetForm'</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span></code></pre></div>

<h3>Adding controls</h3>

<p>Sometimes mechanize won't pick up certain hidden form controls. I've encountered this with ASP.NET
pages where mechanize won't pick up the <code>__EVENTTARGET</code>, <code>__EVENTARGUMENT</code>, and <code>__LASTFOCUS</code> controls 
in a form like the following:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">"ctl00"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"search"</span> <span class="na">id=</span><span class="s">"ctl00"</span><span class="nt">&gt;</span> 
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"aspNetHidden"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"__EVENTTARGET"</span> <span class="na">id=</span><span class="s">"__EVENTTARGET"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"__EVENTARGUMENT"</span> <span class="na">id=</span><span class="s">"__EVENTARGUMENT"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"__LASTFOCUS"</span> <span class="na">id=</span><span class="s">"__LASTFOCUS"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"__VIEWSTATE"</span> <span class="na">id=</span><span class="s">"__VIEWSTATE"</span> <span class="na">value=</span><span class="s">"/wEPD...."</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></div>

<p>Since mechanize doesn't pick up these controls, you will need to create them manually
in order to get the form submission to work. Use the <code>new_control</code> method to add these 
controls to the form and set their values at the same time:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">new_control</span><span class="p">(</span><span class="s">'hidden'</span><span class="p">,</span> <span class="s">'__EVENTTARGET'</span><span class="p">,</span>   <span class="p">{</span><span class="s">'value'</span><span class="p">:</span> <span class="s">'$next_page'</span><span class="p">})</span>
<span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">new_control</span><span class="p">(</span><span class="s">'hidden'</span><span class="p">,</span> <span class="s">'__EVENTARGUMENT'</span><span class="p">,</span> <span class="p">{</span><span class="s">'value'</span><span class="p">:</span> <span class="s">''</span><span class="p">})</span>
<span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">new_control</span><span class="p">(</span><span class="s">'hidden'</span><span class="p">,</span> <span class="s">'__LASTFOCUS'</span><span class="p">,</span>     <span class="p">{</span><span class="s">'value'</span><span class="p">:</span> <span class="s">''</span><span class="p">})</span>
<span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">fixup</span><span class="p">()</span></code></pre></div>

<h3>Adding items dynamically</h3>

<p>Sometimes a control's values are set dynamically via javascript. So when you go
to set the values for these controls with mechanize, there's no list of items to choose
from because mechanize can't run the javascript that would have created them in the 
first place.</p>

<p>I've encountered this with forms that dynamically generate a select drop down for region,
country, state, city, etc. Here's an example of that scenario:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"searchAuxRegionID"</span> <span class="na">name=</span><span class="s">"searchAuxRegionID"</span> 
  <span class="na">onchange=</span><span class="s">"PopulateCombo(document.frmSearch.searchAuxCountryID);"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>-- Select --<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>Africa<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>Asia<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"4"</span><span class="nt">&gt;</span>Australia<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"5"</span><span class="nt">&gt;</span>Europe<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"6"</span><span class="nt">&gt;</span>North America<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"searchAuxCountryID"</span> <span class="na">name=</span><span class="s">"searchAuxCountryID"</span> 
  <span class="na">onchange=</span><span class="s">"PopulateCombo(document.frmSearch.searchAuxStateID);"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>-- Select --<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span></code></pre></div>

<p>Note in the above form that the second select list for country is empty. That's because it doesn't get populated until 
you've chosen a value for region from the first select list.</p>

<p>Once you select the region, it will trigger javascript code in the onchange attribute to dynamically generate a 
list of country items. </p>

<p>For instance, say I select North America from the dropdown. This causes the searchAuxCountryID select dropdown to 
be populated with the following list of values. </p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"searchAuxCountryID"</span> <span class="na">name=</span><span class="s">"searchAuxCountryID"</span> <span class="na">onchange=</span><span class="s">"PopulateCombo(document.frmSearch.searchAuxStateID);"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>-- Select --<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"4"</span><span class="nt">&gt;</span>Canada<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>USA<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span></code></pre></div>

<p>Now I can select which country I want to submit in the form.</p>

<p>But how can we handle this in mechanize where the javascript code won't be running? </p>

<p>Can you just try setting the value of the <code>searchAuxCountryID</code> to <code>3</code> or <code>4</code>? </p>

<p>Try it and you will see that it will fail with the error <code>*** ItemNotFoundError: insufficient items with name '&lt;your-value&gt;'</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="o">.</span><span class="n">form</span>

<span class="o">&lt;</span><span class="n">frmSearch</span> <span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">search</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
  <span class="o">&lt;</span><span class="n">SelectControl</span><span class="p">(</span><span class="n">searchAuxRegionID</span><span class="o">=</span><span class="p">[,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">*</span><span class="mi">6</span><span class="p">])</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">SelectControl</span><span class="p">(</span><span class="n">searchAuxCountryID</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="p">])</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">SelectControl</span><span class="p">(</span><span class="n">searchAuxStateID</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="p">])</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">SelectControl</span><span class="p">(</span><span class="n">searchAuxCityID</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="p">])</span><span class="o">&gt;&gt;</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'searchAuxCountryID'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'3'</span><span class="p">]</span>

<span class="o">***</span> <span class="n">ItemNotFoundError</span><span class="p">:</span> <span class="n">insufficient</span> <span class="n">items</span> <span class="k">with</span> <span class="n">name</span> <span class="s">'3'</span></code></pre></div>

<p>What you must do is create an <code>Item</code> for the value manually and attach it to the 
control you want it to be part of. In this case we want it to be an item with a value of <code>3</code>
within the <code>searchAuxCountryID</code> control:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">find_control</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'searchAuxCountryID'</span><span class="p">),</span>
           <span class="p">{</span><span class="s">'contents'</span><span class="p">:</span> <span class="s">'3'</span><span class="p">,</span> <span class="s">'value'</span><span class="p">:</span> <span class="s">'3'</span><span class="p">,</span> <span class="s">'label'</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c"># Now it works!</span>
<span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'searchAuxCountryID'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'3'</span><span class="p">]</span></code></pre></div>

<h3>Removing controls to make form submissions work</h3>

<p>All of the previous examples have assumed that we need to add controls to make a form submission work. But sometimes
you will encounter cases where you need to remove controls in order to get the form submission to work. </p>

<p>Remove controls by calling <code>br.form.controls.remove</code> with the control you wish to delete as the argument. </p>

<p>Here's an example where we remove all of the submit, image, or checkbox controls from the form:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">controls</span><span class="p">[:]:</span>
  <span class="k">if</span> <span class="n">control</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'submit'</span><span class="p">,</span> <span class="s">'image'</span><span class="p">,</span> <span class="s">'checkbox'</span><span class="p">]:</span>
    <span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">control</span><span class="p">)</span></code></pre></div>

<p>Note that in the above example we are iterating through all of the controls in the form and filtering
based on the type of the control. We can also look for specific controls to remove by first finding
the control by name (or predicate function) and then removing it:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ctl</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">find_control</span><span class="p">(</span><span class="s">'ctl00$cphMain$btnSearch'</span><span class="p">)</span>
<span class="n">br</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ctl</span><span class="p">)</span></code></pre></div>

<h2>Shameless Plug</h2>

<p>Have a scraping project you'd like done? I'm available for hire. <a href="/contact">Contact me</a> 
with some details about your project and I'll give you a quote.</p>

</div>

</div></body></html>