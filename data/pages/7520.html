<html><body><div><div class="col-md-12">
				<p><strong>International Space Station Notifications with Python, Redis-Queue and Twilio Copilot</strong></p>
<p>With the new <a href="https://youtu.be/sGbxmsDFVnE">Star Wars trailer</a> coming out, I’ve been really excited about space lately. This could be pretty obvious based on what I <a href="https://twitter.com/CarlFlamingo/status/660539445716910080/photo/1">wore during my API demo</a> at BostonHacks last weekend. Twilio also had <a href="https://www.twilio.com/blog/2015/11/getting-started-with-opencv-and-python-featuring-the-martian-2.html">private screenings of The Martian</a> for community members recently in several different cities.</p>
<p><img class="&quot; aligncenter" title="" src="https://www.twilio.com/blog/wp-content/uploads/2015/11/CXREiwDW-s26zrt7I1Q9mNBuk0SjyXBGb6S3b_x0fpbjz-G1_TxmhxMmXaAXIoDSrSXgJ6i3Yc9bkWAJ2ZJuUjavY07AXQUUs5MURQ1rM3zeroclI9S86aJ13-qovCt96ilj1BRL.png" alt="twilioastronaut.jpg"/></p>
<p>It’s not surprising that I think the International Space Station is awesome. Naturally I thought it would be cool to know when it is hovering over me. Once I found out about the <a href="http://open-notify.org/Open-Notify-API/ISS-Pass-Times/">ISS Open Notify API</a>, I knew I had to build a notification system that allows subscribers to receive an SMS whenever the ISS flies over their area.</p>
<p>You can check out the app I built and <a href="https://github.com/sagnew/ISSNotifications">look at the code</a> if you want. Or I can show you step by step how to build this, and how you can scale it to send from a pool of Twilio numbers rather than just one using new <a href="https://www.twilio.com/docs/api/rest/sending-messages-copilot">Twilio Copilot</a> features.</p>
<p><strong>ISS Tracking Tools</strong></p>
<p>We will build a web application for users to subscribe to notifications. To do this we’ll use Flask for our web server and the ISS Open Notify API to find out when the ISS is passing overhead for a given latitude and longitude.</p>
<p>Before you start coding, make sure you have <a href="https://www.python.org/downloads/">Python</a> installed as well as <a href="http://pip.readthedocs.org/en/stable/installing/">pip</a>, which should come with most versions of Python. This will work in either Python 2.7 or Python 3 . You’ll also need to <a href="http://redis.io/download">install Redis</a>, which can be done using the following terminal commands:</p>

		<div id="crayon-56d5a798dfc9f824435749" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfc9f824435749-1"><span class="crayon-e">wget </span><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-v">download</span><span class="crayon-e">.redis</span><span class="crayon-e">.io</span><span class="crayon-o">/</span><span class="crayon-v">releases</span><span class="crayon-o">/</span><span class="crayon-v">redis</span><span class="crayon-o">-</span><span class="crayon-cn">3.0.5.tar.gz</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfc9f824435749-2"><span class="crayon-e">tar </span><span class="crayon-e">xzf </span><span class="crayon-v">redis</span><span class="crayon-o">-</span><span class="crayon-cn">3.0.5.tar.gz</span></p><p class="crayon-line" id="crayon-56d5a798dfc9f824435749-3"><span class="crayon-r">cd</span><span class="crayon-h"> </span><span class="crayon-v">redis</span><span class="crayon-o">-</span><span class="crayon-cn">3.0.5</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfc9f824435749-4"><span class="crayon-r">make</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Running the Redis server now would be helpful because we will be using it later.  Run it in the background using this command:</p>

		

<p>Next, create a virtualenv so we can cleanly install all of our python libraries with pip. If you are unfamiliar with pip and virtualenv you can check out <a href="https://www.twilio.com/docs/quickstart/python/devenvironment">this guide</a>.</p>
<p>Let’s install Flask for our web server and the Twilio python module for sending text messages:</p>

		<div id="crayon-56d5a798dfcc0419922567" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfcc0419922567-1"><span class="crayon-e">pip </span><span class="crayon-i">install</span> <span class="crayon-v">twilio</span><span class="crayon-o">==</span><span class="crayon-cn">4.8.0</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcc0419922567-2"><span class="crayon-e">pip </span><span class="crayon-i">install</span> <span class="crayon-v">flask</span><span class="crayon-o">==</span><span class="crayon-cn">0.10.1</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>In order to send text messages at the time that the ISS is scheduled to fly by, we’ll need to use a task queue such as <a href="http://python-rq.org/">RQ</a> and a scheduler to add tasks to the queue at certain times. RQ uses Redis as a backend for a task queue, and <a href="https://github.com/ui/rq-scheduler">RQ Scheduler</a> allows us to schedule tasks to be added to the queue. Installing RQ Scheduler will also take care of the RQ and redis-py dependencies:</p>

		<div id="crayon-56d5a798dfcca262364696" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfcca262364696-1"><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">rq</span><span class="crayon-o">-</span><span class="crayon-v">scheduler</span><span class="crayon-o">==</span><span class="crayon-cn">0.5.1</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The last dependency to install is requests which will let us send a GET request to the Open Notify API:</p>

		<div id="crayon-56d5a798dfcd4208329680" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfcd4208329680-1"><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">requests</span><span class="crayon-o">==</span><span class="crayon-cn">2.8.1</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Finally, before we start writing the code, make sure you have at least one SMS-enabled Twilio phone number in your Twilio account. Don’t have a Twilio account yet? No problem because it only takes a couple of minutes to <a href="https://www.twilio.com/try-twilio">sign up</a>. I’ll wait here gazing at the stars while you get one.</p>
<p><strong>Scheduling with Python-RQ</strong></p>
<p>With all of our dependencies in place we can get on with building the app.</p>
<p>The ISS Open Notify API takes a GET request with the latitude and longitude of the user’s location, and returns a list of timestamps for the next scheduled passes over that location. Let’s write a function that will return a datetime object of the next ISS flyby for a given latitude and longitude.</p>
<p>Open a file called <code>iss.py</code> and add the following code:</p>

		<div id="crayon-56d5a798dfcde554700575" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-2">2</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-4">4</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-6">6</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-8">8</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-10">10</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-12">12</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-14">14</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-16">16</p><p class="crayon-num" data-line="crayon-56d5a798dfcde554700575-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcde554700575-18">18</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfcde554700575-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">requests</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span></p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">pytz</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-4"> </p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-6"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">get_next_pass</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-7"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">iss_url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://api.open-notify.org/iss-pass.json'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-8"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">location</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'lat'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'lon'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-9"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">iss_url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-o">=</span><span class="crayon-v">location</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-10"> </p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-11"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-s">'response'</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-12"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">next_pass</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">[</span><span class="crayon-s">'response'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'risetime'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-13"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">next_pass_datetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">fromtimestamp</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tz</span><span class="crayon-o">=</span><span class="crayon-v">pytz</span><span class="crayon-sy">.</span><span class="crayon-v">utc</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-14"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Next pass for {}, {} is: {}'</span></p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-15"><span class="crayon-h">              </span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-16"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">next_pass_datetime</span></p><p class="crayon-line" id="crayon-56d5a798dfcde554700575-17"><span class="crayon-e">    </span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcde554700575-18"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'No ISS flyby can be determined for {}, {}'</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Try calling this function with some test values to check that it actually works. I’m going to use the location of Twilio’s HQ for this example. Open your Python shell and try the following:</p>

		<div id="crayon-56d5a798dfce9332514736" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfce9332514736-1"><span class="crayon-e">import </span><span class="crayon-e">iss</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfce9332514736-2"><span class="crayon-v">iss</span><span class="crayon-sy">.</span><span class="crayon-e">get_next_pass</span><span class="crayon-sy">(</span><span class="crayon-cn">37.7833</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">122.4167</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Next, using the datetime returned by the API, we can use rq-scheduler to queue up a function to be called to send a text message at the time of the next flyby.</p>
<p>Let’s write a function adding a task to our queue to send a text message to the user that has just subscribed.</p>
<p>Go back to <code>iss.py</code> and update your code to add this new function and the required imports:</p>

		<div id="crayon-56d5a798dfcf3502228894" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-1">1</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-2">2</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5a798dfcf3502228894-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-4">4</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-6">6</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-7">7</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-8">8</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5a798dfcf3502228894-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-10">10</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-12">12</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-14">14</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-16">16</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-18">18</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-20">20</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-22">22</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-24">24</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-26">26</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-27">27</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-28">28</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-29">29</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-30">30</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-31">31</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-32">32</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-33">33</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-34">34</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-35">35</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-36">36</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-37">37</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-38">38</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-39">39</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-40">40</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-41">41</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-42">42</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-43">43</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-44">44</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfcf3502228894-45">45</p><p class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-46">46</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfcf3502228894-48">48</p><p class="crayon-num" data-line="crayon-56d5a798dfcf3502228894-49">49</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">requests</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5a798dfcf3502228894-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">redis </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Redis</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5a798dfcf3502228894-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">rq_scheduler </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Scheduler</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-4"> </p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-5"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">pytz</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-7"> </p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5a798dfcf3502228894-8"><span class="crayon-c"># Open a connection to your Redis server.</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5a798dfcf3502228894-9"><span class="crayon-v">redis_server</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Redis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-10"> </p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-11"><span class="crayon-c"># Create a scheduler object with your Redis server.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-12"><span class="crayon-v">scheduler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Scheduler</span><span class="crayon-sy">(</span><span class="crayon-v">connection</span><span class="crayon-o">=</span><span class="crayon-v">redis_server</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-14"> </p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-15"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">get_next_pass</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-16"><span class="crayon-h">    </span><span class="crayon-v">iss_url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://api.open-notify.org/iss-pass.json'</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-17"><span class="crayon-h">    </span><span class="crayon-v">location</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'lat'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'lon'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-18"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">iss_url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-o">=</span><span class="crayon-v">location</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-20"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-s">'response'</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-21"><span class="crayon-h">        </span><span class="crayon-v">next_pass</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">[</span><span class="crayon-s">'response'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'risetime'</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-22"><span class="crayon-h">        </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">fromtimestamp</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tz</span><span class="crayon-o">=</span><span class="crayon-v">pytz</span><span class="crayon-sy">.</span><span class="crayon-v">utc</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-23"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-24"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Next pass for {}, {} is: {}'</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-25"><span class="crayon-h">              </span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass_datetime</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-26"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">next_pass_datetime</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-27"><span class="crayon-e">    </span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5a798dfcf3502228894-28"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'No ISS flyby can be determined for {}, {}'</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-29"> </p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-30"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-31"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_to_queue</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-32"><span class="crayon-h">    </span><span class="crayon-c"># Add this phone number to Redis associated with "lat,lon"</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-33"><span class="crayon-h">    </span><span class="crayon-v">redis_server</span><span class="crayon-sy">.</span><span class="crayon-k ">set</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'{},{}'</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-34"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-35"><span class="crayon-h">    </span><span class="crayon-c"># Get the datetime object representing the next ISS flyby for this number.</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-36"><span class="crayon-h">    </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_next_pass</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-37"> </p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-38"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-39"><span class="crayon-h">        </span><span class="crayon-c"># Schedule a text to be sent at the time of the next flyby.</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-40"><span class="crayon-h">        </span><span class="crayon-v">scheduler</span><span class="crayon-sy">.</span><span class="crayon-e">enqueue_at</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass_datetime</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-41"><span class="crayon-h">                             </span><span class="crayon-v">notify_subscriber</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-42"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-43"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'{} will be notified when ISS passes by {}, {}'</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-44"><span class="crayon-h">              </span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfcf3502228894-45"> </p><p class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-56d5a798dfcf3502228894-46"> </p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-47"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">notify_subscriber</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfcf3502228894-48"><span class="crayon-h">    </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Look up! You may not be able to see it, but the International'</span></p><p class="crayon-line" id="crayon-56d5a798dfcf3502228894-49"><span class="crayon-h">          </span><span class="crayon-s">' Space Station is passing above you right now!'</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>In the code above, we are adding a phone number to Redis for logging purposes associated with the latitude and longitude of where they were when they subscribed. Then we are grabbing the time of the next ISS flyby and scheduling a call to the <code>notify_subscriber</code> function. This function only prints a message for now, but we will configure it to send an SMS later.</p>
<p>In order for this code to work, we first have to start the RQ Schedule processes.</p>
<p>Hop back into your terminal and run an rqworker in the background. This process polls Redis and runs the currently queued tasks:</p>

		

<p>Now run the rqscheduler. This process polls Redis once every minute and moves scheduled jobs to the relevant queues when they need to be executed:</p>

		

<p>Our current code prints to the console whenever the ISS flies by a given latitude and longitude. Let’s have more fun by configuring our <code>notify_subscriber</code> function to send text messages.</p>
<p><strong>Sending a text message with Twilio in Python</strong></p>
<p>Now we’ll use the TwilioRestClient to <a href="https://www.twilio.com/docs/api/rest/sending-messages">send an SMS</a> using the <a href="https://www.twilio.com/docs/api/rest">Twilio REST API</a>. Make sure you have your Twilio phone number purchased. While this app will work just fine with a trial account, upgrading will let you remove the trial account text from the messages being sent, and will allow you to buy additional phone numbers to scale the app.</p>
<p><img class="&quot; aligncenter" title="" src="https://www.twilio.com/blog/wp-content/uploads/2015/11/aJtnC5252veILt7mtgPHFv3AZV4wpulthJFYhBivaveqQT6tT1K4rFCeJ6_h350jNkLmLlGKIySwB0Dny109ozpsE7G1OAME8fcUDd_DVwPB6-CBl84OWNLO9h6kXque_elNikv.png" alt="NewBuyANumber.gif"/></p>
<p>Let’s finish writing our <code>notify_subscriber</code> function to send an actual text message. Head back over to <code>iss.py</code> and add the following highlighted code:</p>

		<div id="crayon-56d5a798dfd13818402852" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-2">2</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-3">3</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-4">4</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-6">6</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-8">8</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-10">10</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-12">12</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-14">14</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom" data-line="crayon-56d5a798dfd13818402852-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-16">16</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-18">18</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-20">20</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-22">22</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-24">24</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-26">26</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-28">28</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-30">30</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-32">32</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-34">34</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-36">36</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d5a798dfd13818402852-37">37</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-38">38</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5a798dfd13818402852-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-40">40</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-42">42</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-44">44</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-46">46</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-48">48</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-50">50</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-52">52</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-54">54</p><p class="crayon-num" data-line="crayon-56d5a798dfd13818402852-55">55</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-56">56</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfd13818402852-57">57</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-58">58</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfd13818402852-59">59</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-60">60</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfd13818402852-61">61</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-62">62</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfd13818402852-63">63</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-64">64</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfd13818402852-65">65</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-66">66</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfd13818402852-67">67</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-68">68</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5a798dfd13818402852-69">69</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5a798dfd13818402852-70">70</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5a798dfd13818402852-71">71</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd13818402852-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">requests</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">redis </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Redis</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">rq_scheduler </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Scheduler</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-56d5a798dfd13818402852-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">rest </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-6"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">pytz</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-8"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-9"><span class="crayon-c"># Open a connection to your Redis server.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-10"><span class="crayon-v">redis_server</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Redis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-12"><span class="crayon-c"># Create a scheduler object with your Redis server.</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-13"><span class="crayon-v">scheduler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Scheduler</span><span class="crayon-sy">(</span><span class="crayon-v">connection</span><span class="crayon-o">=</span><span class="crayon-v">redis_server</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-14"> </p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-56d5a798dfd13818402852-15"><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-16"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-17"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-18"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">get_next_pass</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-19"><span class="crayon-h">    </span><span class="crayon-v">iss_url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://api.open-notify.org/iss-pass.json'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-20"><span class="crayon-h">    </span><span class="crayon-v">location</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'lat'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'lon'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-21"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">iss_url</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-o">=</span><span class="crayon-v">location</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-22"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-23"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-s">'response'</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-24"><span class="crayon-h">        </span><span class="crayon-v">next_pass</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">[</span><span class="crayon-s">'response'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'risetime'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-25"><span class="crayon-h">        </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">fromtimestamp</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tz</span><span class="crayon-o">=</span><span class="crayon-v">pytz</span><span class="crayon-sy">.</span><span class="crayon-v">utc</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-26"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-27"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Next pass for {}, {} is: {}'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-28"><span class="crayon-h">              </span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass_datetime</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-29"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">next_pass_datetime</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-30"><span class="crayon-e">    </span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-31"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'No ISS flyby can be determined for {}, {}'</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-32"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-33"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-34"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_to_queue</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-35"><span class="crayon-h">    </span><span class="crayon-c"># Send a text thanking the user for subscribing if they haven't before.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-36"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">redis_server</span><span class="crayon-sy">.</span><span class="crayon-e">exists</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d5a798dfd13818402852-37"><span class="crayon-h">        </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">messages</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-v">to</span><span class="crayon-o">=</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-38"><span class="crayon-h">                               </span><span class="crayon-v">from_</span><span class="crayon-o">=</span><span class="crayon-s">'TWILIO_PHONE_NUMBER'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5a798dfd13818402852-39"><span class="crayon-h">                               </span><span class="crayon-v">body</span><span class="crayon-o">=</span><span class="crayon-s">'Thanks for subscribing to ISS alerts!'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-40"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-41"><span class="crayon-h">    </span><span class="crayon-c"># Add this phone number to Redis associated with "lat,lon"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-42"><span class="crayon-h">    </span><span class="crayon-v">redis_server</span><span class="crayon-sy">.</span><span class="crayon-k ">set</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'{},{}'</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-43"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-44"><span class="crayon-h">    </span><span class="crayon-c"># Get the datetime object representing the next ISS flyby for this number.</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-45"><span class="crayon-h">    </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_next_pass</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-46"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-47"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-48"><span class="crayon-h">        </span><span class="crayon-c"># Schedule a text to be sent at the time of the next flyby.</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-49"><span class="crayon-h">        </span><span class="crayon-v">scheduler</span><span class="crayon-sy">.</span><span class="crayon-e">enqueue_at</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass_datetime</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-50"><span class="crayon-h">                             </span><span class="crayon-v">notify_subscriber</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-51"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-52"><span class="crayon-h">        </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'{} will be notified when ISS passes by {}, {}'</span></p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-53"><span class="crayon-h">              </span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-54"> </p><p class="crayon-line" id="crayon-56d5a798dfd13818402852-55"> </p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5a798dfd13818402852-56"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">notify_subscriber</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd13818402852-57"><span class="crayon-h">    </span><span class="crayon-v">msg_body</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Look up! You may not be able to see it, but the International'</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-58"><span class="crayon-h">               </span><span class="crayon-s">' Space Station is passing above you right now!'</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd13818402852-59"> </p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-60"><span class="crayon-h">    </span><span class="crayon-c"># Retrieve the latitude and longitude associated with this number.</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd13818402852-61"><span class="crayon-h">    </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">redis_server</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-62"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd13818402852-63"><span class="crayon-h">    </span><span class="crayon-c"># Send a message to the number alerting them of an ISS flyby.</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-64"><span class="crayon-h">    </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">messages</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-v">to</span><span class="crayon-o">=</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd13818402852-65"><span class="crayon-h">                           </span><span class="crayon-v">from_</span><span class="crayon-o">=</span><span class="crayon-s">'TWILIO_PHONE_NUMBER'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-66"><span class="crayon-h">                           </span><span class="crayon-v">body</span><span class="crayon-o">=</span><span class="crayon-v">msg_body</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd13818402852-67"> </p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-68"><span class="crayon-h">    </span><span class="crayon-c"># Add the subscriber back to the queue to receive their next flyby message.</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd13818402852-69"><span class="crayon-h">    </span><span class="crayon-e">add_to_queue</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5a798dfd13818402852-70"> </p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5a798dfd13818402852-71"><span class="crayon-h">    </span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Message has been sent to {}'</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Notice that we are adding the subscriber back into the scheduler queue at the end. This allows us to continue sending notifications each time the ISS comes back. We are also now sending them a text message when they are initially added to the queue. Don’t forget to replace where it says <code>TWILIO_PHONE_NUMBER</code> with an actual phone number that you can send messages from.</p>
<p>In order for this code to work, you will need to set your Twilio authentication credentials as environment variables. These values can be found on your <a href="https://www.twilio.com/user/account/messaging">account dashboard</a>:</p>

		<div id="crayon-56d5a798dfd1f285361713" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd1f285361713-1"><span class="crayon-e">export </span><span class="crayon-v">TWILIO_ACCOUNT_SID</span><span class="crayon-o">=</span><span class="crayon-s">''</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd1f285361713-2"><span class="crayon-e">export </span><span class="crayon-v">TWILIO_AUTH_TOKEN</span><span class="crayon-o">=</span><span class="crayon-s">''</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>If you want to see this code in action, add the following two lines to your file to call the <code>add_to_queue</code> function. You can call this with your actual lat and lon, but I’m going to include dummy values for now:</p>

		<div id="crayon-56d5a798dfd29465850406" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd29465850406-1"><span class="crayon-e">add_to_queue</span><span class="crayon-sy">(</span><span class="crayon-s">'your_phone_number'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">37.7833</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">122.4167</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>You should receive a message for subscribing, and you can try checking out <a href="http://www.isstracker.com/">where the ISS currently is</a> if you want to test to see if the notifications work.</p>
<p><strong>Building a Flask application for subscribers</strong></p>
<p>Flask is a really simple, lightweight web framework for Python. We only need very basic functionality, and Flask gives us exactly what we need.</p>
<p>Create a basic <code>app.py</code> file for our Flask app. We’ll just return an <code>index.html</code> page for now:</p>

		<div id="crayon-56d5a798dfd33497738638" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd33497738638-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">iss</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd33497738638-2"> </p><p class="crayon-line" id="crayon-56d5a798dfd33497738638-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Flask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd33497738638-4"> </p><p class="crayon-line" id="crayon-56d5a798dfd33497738638-5"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd33497738638-6"> </p><p class="crayon-line" id="crayon-56d5a798dfd33497738638-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd33497738638-8"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd33497738638-9"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">index</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd33497738638-10"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-s">'index.html'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd33497738638-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd33497738638-12"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-o">=</span><span class="crayon-s">'0.0.0.0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>In the above code, we are setting a route <code>/</code> that takes <code>GET</code> requests. This route only returns an <code>index.html</code> which will act as our signup page. This HTML doesn’t exist yet, so let’s fix that. This will have a form with an input element for their phone number and a submit button. Create a directory called <code>templates</code>, open a file called <code>index.html</code> and add the following code:</p>

		<div id="crayon-56d5a798dfd3d115951170" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-2">2</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-4">4</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-6">6</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-8">8</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-10">10</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-12">12</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-14">14</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-16">16</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd3d115951170-18">18</p><p class="crayon-num" data-line="crayon-56d5a798dfd3d115951170-19">19</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-1"><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-e">DOCTYPE </span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-2"><span class="crayon-o">&lt;</span><span class="crayon-e">html </span><span class="crayon-v">lang</span><span class="crayon-o">=</span><span class="crayon-s">"en"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-3"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-4"><span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">meta </span><span class="crayon-v">charset</span><span class="crayon-o">=</span><span class="crayon-s">"UTF-8"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-5"><span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">title</span><span class="crayon-o">&gt;</span><span class="crayon-e">International </span><span class="crayon-e">Space </span><span class="crayon-e">Station </span><span class="crayon-v">Notifications</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">title</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-6"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-7"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-8"><span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"app"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-9"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">form </span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-s">"/subscribe"</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-o">=</span><span class="crayon-s">"POST"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-10"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">h3</span><span class="crayon-o">&gt;</span><span class="crayon-e">You </span><span class="crayon-e">will </span><span class="crayon-i">receive</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">text </span><span class="crayon-e">message </span><span class="crayon-e">whenever </span><span class="crayon-e">the </span><span class="crayon-e">ISS </span><span class="crayon-e">flies </span><span class="crayon-e">by </span><span class="crayon-e">where </span><span class="crayon-e">you </span><span class="crayon-e">are </span><span class="crayon-e">right </span><span class="crayon-v">now</span><span class="crayon-sy">.</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h3</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-11"><span class="crayon-h"> </span> <span class="crayon-h">   </span> <span class="crayon-h"> </span> <span class="crayon-o">&lt;</span><span class="crayon-v">h4</span><span class="crayon-o">&gt;</span><span class="crayon-e">Enter </span><span class="crayon-e">your </span><span class="crayon-e">phone </span><span class="crayon-v">number</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h4</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-12"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">   </span> <span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text"</span><span class="crayon-h"> </span><span class="crayon-v">placeholder</span><span class="crayon-o">=</span><span class="crayon-s">"ex:  19999999999"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"number"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-13"><span class="crayon-h">   </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"latitude"</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"latitude"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-14"><span class="crayon-h"> </span> <span class="crayon-h">   </span> <span class="crayon-h"> </span> <span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"longitude"</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"longitude"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-15"><span class="crayon-h">        </span><span class="crayon-o">&lt;</span><span class="crayon-e">button </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"submit"</span><span class="crayon-o">&gt;</span><span class="crayon-v">Subscribe</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">button</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-16"><span class="crayon-h">      </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">form</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-17"><span class="crayon-h">    </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd3d115951170-18"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd3d115951170-19"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Notice that we created two hidden elements to hold values for latitude and longitude. We will get these using HTML5’s GeoLocation API. Create a directory called <code>static</code> and write the following code to a file called <code>getLocation.js</code> inside your new directory:</p>

		<div id="crayon-56d5a798dfd48956977670" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd48956977670-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">successFunction</span><span class="crayon-sy">(</span><span class="crayon-v">position</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd48956977670-2"><span class="crayon-h"> </span> <span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-sy">.</span><span class="crayon-v">coords</span><span class="crayon-sy">.</span><span class="crayon-v">latitude</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5a798dfd48956977670-3"><span class="crayon-h"> </span> <span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-sy">.</span><span class="crayon-v">coords</span><span class="crayon-sy">.</span><span class="crayon-v">longitude</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd48956977670-4"><span class="crayon-h">  </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">getElementById</span><span class="crayon-sy">(</span><span class="crayon-s">'latitude'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5a798dfd48956977670-5"><span class="crayon-h">  </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-e">getElementById</span><span class="crayon-sy">(</span><span class="crayon-s">'longitude'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd48956977670-6"> </p><p class="crayon-line" id="crayon-56d5a798dfd48956977670-7"><span class="crayon-h">  </span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Your latitude is :'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">' and longitude is '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd48956977670-8"><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5a798dfd48956977670-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd48956977670-10"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">navigator</span><span class="crayon-sy">.</span><span class="crayon-v">geolocation</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5a798dfd48956977670-11"><span class="crayon-h">  </span><span class="crayon-v">navigator</span><span class="crayon-sy">.</span><span class="crayon-v">geolocation</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentPosition</span><span class="crayon-sy">(</span><span class="crayon-v">successFunction</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd48956977670-12"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5a798dfd48956977670-13"><span class="crayon-h">  </span><span class="crayon-e">alert</span><span class="crayon-sy">(</span><span class="crayon-s">'It seems like Geolocation, which is required for this page, is not enabled in your browser. Please use a browser which supports it.'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd48956977670-14"><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Now include this script in your <code>index.html</code> at the bottom of the <code>&lt;body&gt;</code>:</p>

		<div id="crayon-56d5a798dfd52473344370" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-2">2</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-4">4</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-6">6</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-8">8</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-10">10</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-12">12</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-14">14</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-16">16</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-17">17</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-18">18</p><p class="crayon-num" data-line="crayon-56d5a798dfd52473344370-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd52473344370-20">20</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd52473344370-1"> <span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-e">DOCTYPE </span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-2"><span class="crayon-o">&lt;</span><span class="crayon-e">html </span><span class="crayon-v">lang</span><span class="crayon-o">=</span><span class="crayon-s">"en"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-3"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-4"><span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">meta </span><span class="crayon-v">charset</span><span class="crayon-o">=</span><span class="crayon-s">"UTF-8"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-5"><span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">title</span><span class="crayon-o">&gt;</span><span class="crayon-e">International </span><span class="crayon-e">Space </span><span class="crayon-e">Station </span><span class="crayon-v">Notifications</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">title</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-6"><span class="crayon-h">    </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-7"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-8"><span class="crayon-h">   </span> <span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"app"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-9"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">form </span><span class="crayon-v">action</span><span class="crayon-o">=</span><span class="crayon-s">"/subscribe"</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-o">=</span><span class="crayon-s">"POST"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-10"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">h3</span><span class="crayon-o">&gt;</span><span class="crayon-e">You </span><span class="crayon-e">will </span><span class="crayon-i">receive</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">text </span><span class="crayon-e">message </span><span class="crayon-e">whenever </span><span class="crayon-e">the </span><span class="crayon-e">ISS </span><span class="crayon-e">flies </span><span class="crayon-e">by </span><span class="crayon-e">where </span><span class="crayon-e">you </span><span class="crayon-e">are </span><span class="crayon-e">right </span><span class="crayon-v">now</span><span class="crayon-sy">.</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h3</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-11"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-v">h4</span><span class="crayon-o">&gt;</span><span class="crayon-e">Enter </span><span class="crayon-e">your </span><span class="crayon-e">phone </span><span class="crayon-v">number</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h4</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-12"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"text"</span><span class="crayon-h"> </span><span class="crayon-v">placeholder</span><span class="crayon-o">=</span><span class="crayon-s">"ex:  19999999999"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"number"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-13"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"latitude"</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"latitude"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-14"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">input </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"hidden"</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">"longitude"</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"longitude"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-15"><span class="crayon-h">        </span><span class="crayon-o">&lt;</span><span class="crayon-e">button </span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-s">"submit"</span><span class="crayon-o">&gt;</span><span class="crayon-e">Subscribe</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">button</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-16"><span class="crayon-h">      </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">form</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-17"><span class="crayon-h">    </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">div</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-56d5a798dfd52473344370-18"><span class="crayon-h">    </span><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/JavaScript"</span><span class="crayon-h"> </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"/static/getLocation.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></p><p class="crayon-line" id="crayon-56d5a798dfd52473344370-19"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd52473344370-20"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Check to make sure this works by running your Flask app:</p>

		

<p>And visit <a href="http://localhost:5000/">http://localhost:5000/</a> to see it in action before heading back to the code.</p>
<p>Now create a route for our form to <code>POST</code> to. Open up <code>app.py</code> again and add a <code>/subscribe</code> route that adds the user to the queue with their phone number, latitude and longitude. Open your <code>app.py</code> file again and add this route:</p>

		<div id="crayon-56d5a798dfd67841291347" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-2">2</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-4">4</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-6">6</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-8">8</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-10">10</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-12">12</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-14">14</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-16">16</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-18">18</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd67841291347-20">20</p><p class="crayon-num" data-line="crayon-56d5a798dfd67841291347-21">21</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd67841291347-1"><span class="crayon-e">import </span><span class="crayon-e">iss</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-2"><span class="crayon-e">from </span><span class="crayon-e">flask </span><span class="crayon-e">import </span><span class="crayon-v">Flask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span></p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-4"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-6"> </p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-7"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-8"><span class="crayon-e">def </span><span class="crayon-e">index</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-9"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-s">'index.html'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-10"> </p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-12"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/subscribe'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-13"><span class="crayon-e">def </span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-14"><span class="crayon-h">    </span><span class="crayon-v">number</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">[</span><span class="crayon-s">'number'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-15"><span class="crayon-h">    </span><span class="crayon-v">lat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">[</span><span class="crayon-s">'latitude'</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-16"><span class="crayon-h">    </span><span class="crayon-v">lon</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">[</span><span class="crayon-s">'longitude'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-17"><span class="crayon-h">    </span><span class="crayon-v">iss</span><span class="crayon-sy">.</span><span class="crayon-e">add_to_queue</span><span class="crayon-sy">(</span><span class="crayon-v">number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-18"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">'Thanks for subscribing. '</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-19"><span class="crayon-h">           </span><span class="crayon-s">'Expect to receive notifications whenever the ISS flies over you!'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd67841291347-20"> </p><p class="crayon-line" id="crayon-56d5a798dfd67841291347-21"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-o">=</span><span class="crayon-s">'0.0.0.0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We now have an app for people to subscribe to ISS notifications!</p>
<p><strong>Scaling with Twilio Copilot</strong></p>
<p>This is all awesome, but the International Space Station <em>is</em> international after all. What if we wanted to notify friends from all over the world using a pool of Twilio numbers? This is where Twilio Copilot comes into the picture, giving you several new <a href="https://www.twilio.com/docs/api/rest/sending-messages#copilot">features</a> that make adding international capabilities to our application really easy.</p>
<p>In particular we’ll use <a href="https://www.twilio.com/docs/api/rest/sending-messages#geomatch">Geo-Match</a> to send notifications from a number in the subscriber’s country, and <a href="https://www.twilio.com/docs/api/rest/sending-messages#sticky-sender">Sticky Sender</a> to make sure this notification always comes from the same Twilio number.</p>
<p>Head over to your <a href="https://www.twilio.com/user/account/messaging/services">Twilio account</a> and create a <a href="https://www.twilio.com/docs/api/rest/sending-messages#messaging-services">messaging service</a> in your dashboard. You will be able to add any pre-bought phone numbers to your messaging service or buy new ones as well. Buy multiple phone numbers from different countries and add them to your messaging service.</p>
<p><img class="&quot; aligncenter" title="" src="https://www.twilio.com/blog/wp-content/uploads/2015/11/jtRPS4GLyCqLVHD-8gJydUG_iExnLiY08p7DkO0zqrNG7I_BhYGG-fdI5q1tfOBF2iDrvwlgpMQhz6ueogVehfz3-U6PYfHy3ETMB0sazU1CgXxGVoe_elQtRT0kknTZzh_4M_g.png" alt="MessagingService.gif"/></p>
<p>The Geo-Match and Sticky Sender features are enabled by default when you create a new messaging service.</p>
<p>Changing our code to send from a messaging service instead of a specific phone number is actually fairly easy. Head back over to <code>iss.py</code> and update the <code>notify_subscriber</code> function:</p>

		<div id="crayon-56d5a798dfd7a967218519" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd7a967218519-1"><span class="crayon-e">def </span><span class="crayon-e">notify_subscriber</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd7a967218519-2"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">msg_body</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Look up! You may not be able to see it, but the International'</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></p><p class="crayon-line" id="crayon-56d5a798dfd7a967218519-3"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-s">' Space Station is passing above you right now!'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd7a967218519-4"><span class="crayon-h">    </span><span class="crayon-p"># Retrieve the latitude and longitude associated with this number.</span></p><p class="crayon-line" id="crayon-56d5a798dfd7a967218519-5"><span class="crayon-h">    </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">redis_server</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd7a967218519-6"> </p><p class="crayon-line" id="crayon-56d5a798dfd7a967218519-7"><span class="crayon-h">    </span><span class="crayon-p"># Send a message to the number alerting them of an ISS flyby.</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5a798dfd7a967218519-8"><span class="crayon-h">    </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">messages</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-st">to</span><span class="crayon-o">=</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5a798dfd7a967218519-9"><span class="crayon-h">                           </span><span class="crayon-v">messaging_service_sid</span><span class="crayon-o">=</span><span class="crayon-s">'MESSAGING_SERVICE_SID'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-56d5a798dfd7a967218519-10"><span class="crayon-h">                           </span><span class="crayon-v">body</span><span class="crayon-o">=</span><span class="crayon-v">msg_body</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd7a967218519-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd7a967218519-12"><span class="crayon-h">    </span><span class="crayon-p"># Add the subscriber back to the queue to receive their next flyby message.</span></p><p class="crayon-line" id="crayon-56d5a798dfd7a967218519-13"><span class="crayon-h">    </span><span class="crayon-e">add_to_queue</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd7a967218519-14"> </p><p class="crayon-line" id="crayon-56d5a798dfd7a967218519-15"><span class="crayon-h">    </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Message has been sent to {}'</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>You’ll also want to update the code in the <code>add_to_queue</code> function where a subscription notification is sent:</p>

		<div id="crayon-56d5a798dfd8b800776429" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-2">2</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-4">4</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-6">6</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-8">8</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-10">10</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-12">12</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-14">14</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-16">16</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-18">18</p><p class="crayon-num" data-line="crayon-56d5a798dfd8b800776429-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a798dfd8b800776429-20">20</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-1"><span class="crayon-e">def </span><span class="crayon-e">add_to_queue</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-2"><span class="crayon-h">    </span><span class="crayon-p"># Send a text thanking the user for subscribing if they haven't before.</span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-3"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">redis_server</span><span class="crayon-sy">.</span><span class="crayon-e">exists</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-4"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-v">messages</span><span class="crayon-sy">.</span><span class="crayon-e">create</span><span class="crayon-sy">(</span><span class="crayon-st">to</span><span class="crayon-o">=</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-5"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">messaging_service_sid</span><span class="crayon-o">=</span><span class="crayon-s">'MESSAGING_SERVICE_SID'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-6"> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">body</span><span class="crayon-o">=</span><span class="crayon-s">'Thanks for subscribing to ISS alerts!'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-8"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-p"># Add this phone number to Redis associated with "lat,lon"</span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-9"><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-v">redis_server</span><span class="crayon-sy">.</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'{},{}'</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-10"><span class="crayon-h">    </span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-11"><span class="crayon-h">    </span><span class="crayon-p"># Get the datetime object representing the next ISS flyby for this number.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-12"><span class="crayon-h">    </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_next_pass</span><span class="crayon-sy">(</span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-14"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">next_pass_datetime</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-15"><span class="crayon-h">        </span><span class="crayon-p"># Schedule a text to be sent at the time of the next flyby.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-16"><span class="crayon-h">        </span><span class="crayon-v">scheduler</span><span class="crayon-sy">.</span><span class="crayon-e">enqueue_at</span><span class="crayon-sy">(</span><span class="crayon-v">next_pass_datetime</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-17"><span class="crayon-h">                             </span><span class="crayon-v">notify_subscriber</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">phone_number</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-18"> </p><p class="crayon-line" id="crayon-56d5a798dfd8b800776429-19"><span class="crayon-h">        </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'{} will be notified when ISS passes by {}, {}'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a798dfd8b800776429-20"><span class="crayon-h">              </span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">phone_number</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lon</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>You can find your messaging service SID in your Account dashboard as well:</p>
<p><img class="&quot; aligncenter" title="" src="https://www.twilio.com/blog/wp-content/uploads/2015/11/vMrmpLP4t7gu-eBZtFMPk7icAoEwd97yzvw-CpLyHC349Eg-gJtcFugYPzZTTbN6JnO9xfjsTVc6D-OG-tTjQtLbb4DKYQKDG9IgeoPBr0yGbNSgeSYII0aGE4dTAodQPFzPoLY.png" alt="Screen Shot 2015-11-03 at 2.43.40 PM.png"/></p>
<p>As you can see once you have some phone numbers configured, using the new Twilio Copilot features is as easy as changing one line of code.</p>
<p><strong>Returning to Earth</strong></p>
<p>You were just able to experience how easy it is to incorporate the new features that shipped with Twilio Copilot. All we did was create a messaging service and change one line of code to send from this messaging service as opposed to implementing an entire system ourselves. Thanks to Copilot, we can experience the joy of having a friend in the front seat with the navigation system when scaling SMS delivery systems.</p>
<p>Now anybody can sign up to receive notifications whenever the ISS flies over them. An <a href="https://twitter.com/SamuelCouch">awesome hacker from Temple University</a> built something similar at a hackathon, except it also <a href="https://github.com/CodyJamesCasey/pissa">involved pizza parties</a>.</p>
<p><img class="&quot; aligncenter" title="" src="https://www.twilio.com/blog/wp-content/uploads/2015/11/VlgXsmSZRCixFjKjVZcmdc14AYYN7R5BJe0Lc2PusVbxUl83IMw0mAyjzOBb7M4q7gNg0Na9YYOQvcKOgs-A_bJciP_Wp-sXcbbKN0NZRjvh2b5zp_TWnPET0KHgy9rcVHd-vi-c.png" alt="PizzaTMNT.png"/></p>
<p>Feel free to reach out if you have any questions or if you want to show off how you used Copilot features in your Twilio app.</p>

			</div>
					</div></body></html>