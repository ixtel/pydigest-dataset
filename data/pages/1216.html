<html><body><div><div class="content html_format">
      <a href="http://infobox.ru/hosting/cloud/">Jelastic</a><p> — многоязыковая платформа как сервис. Сначала была добавлена поддержка Java, затем PHP и Ruby, но на этом разработчики не остановились. Месяц за месяцем вытачивалась новая для Jelastic платформа — Python. В этой статье будет рассказано, как развернуть Django CMS на Infobox Jelastic. 

</p><img src="https://habrastorage.org/getpro/habr/post_images/1ed/90a/c7f/1ed90ac7f27d359c5cafcab6fb7983e2.png"/><p>
В конце статьи информация о том, как получить 300 рублей на счет для экспериментов с </p><a href="http://infobox.ru/hosting/cloud/">Infobox Jelastic</a><p>.
</p><a name="habracut"/>
<h4>ЧаВо по Python в Jelastic</h4><p>
В Jelastic поддерживается веб-сервер Apache для хостинга приложений Python. Реализована поддержка Apache + mod_wsgi.</p><p>
Вы можете воспользоваться одной из 3х версий Python:
</p><p>
Все версии предустановлены в контейнеры Python. Пользователь может выбрать необходимую версию при создании окружения и изменить, при необходимости, в процессе работы. 

</p><h5>Развертывание приложений</h5><p>
Вы можете просто развернуть приложение Python:
</p><p>
1. </p><a href="http://docs.jelastic.com/deploy-python-archive-url">с помощью архива или ссылки</a>

<img src="https://habrastorage.org/getpro/habr/post_images/b86/f6b/c25/b86f6bc25e602e00accdd2ccd75e6cb4.png"/>

<img src="https://habrastorage.org/getpro/habr/post_images/1bc/f44/be4/1bcf44be4344a083986fed503b5bfc28.png"/>
<p>
2. </p><a href="http://docs.jelastic.com/python-git-svn">Через GIT/SVN</a>

<img src="https://habrastorage.org/getpro/habr/post_images/448/9e5/40d/4489e540d5f4a680734718e66879e38e.png" alt="GIT Infobox Jelastic"/>
<p>
Вы можете развернуть только одно Python приложение на окружение. Оно будет развернуто в ROOT по умолчанию. Конечно, вы можете воспользоваться и SSH для развертывания приложения.

</p><em>Когда вы разворачиваете пакет, его корень должен содержать следующие файлы:<br/>
<ul>
<li>requirements.txt с именами всех модулей Python, необходимых приложению;</li>
<li>application – скрипт точки входа для запуска вашего приложения с Apache mod_wsgi</li>
</ul><br/>
</em>
<h5>Управление пакетами/модулями</h5><p>
Для успешного развертывания и запуска приложения Python могут потребоваться некоторые дополнительные модули или другие пакеты. Управление требуемым ПО организовано через pip, популярную систему управления пакетами Python.
</p><p>
Для загрузки и установки модулей Python есть два способа:
</p><ul>
<li>Написать список требуемых модулей в requirements.txt и положить файл в корень пакета с проектом. Скрипт развертывания прочитает файл и установит необходимые модули с помощью pip автоматически;</li>
<li>Соединиться с вашим контейнером через SSH и использовать следующие команды:</li>
</ul>
<strong>pip install {package_name}</strong><p> – для установки необходимого модуля;
</p><strong>pip uninstall {package_name}</strong><p> – для удаления установленного модуля;
</p><strong>pip install –upgrade{package_name}</strong><p> – для обновления конкретного модуля до последней версии;
</p><strong>pip install -r requirements.txt</strong><p> – для установки всех модулей из requirements.txt;
</p><strong>pip list</strong><p> — для просмотра уже установленных модулей.
</p><p>
Используя дополнительные команды и их параметры вы можете указать предпочитаемые модули и версии, настроить разрешение зависимостей, показать информацию об установленных модулях или поискать необходимый в репозитории </p><a href="https://pypi.python.org/pypi/">PyPI</a><p>. Для дальнейшего ознакомления с pip рекомендуем </p><a href="https://pip.pypa.io/en/latest/user_guide.html">руководство пользователя</a><p>.

</p><h5>Мониторинг логов</h5><p>
Jelastic создает следующие файлы логов, доступные в Python WSGI:
</p><ul>
<li>access_log-{дата}</li>
<li>error_log-{дата}</li>
</ul><p>
Вы можете посмотреть логи, кликнув на кнопку Log на контейнере Apache в вашем окружении. Здесь вы можете проследить все действия, выполняемые с вашим окружением Python.

</p><h5>Доступные фреймворки</h5><p>
В настоящий момент Jelastic поддерживает следующие фреймворки на Python:
</p><p>
Вы можете развернуть различные приложения Python, основанные на этих фреймворках. Ниже мы покажем, как разворачивать DjangoCMS, а в следующей статье посмотрим на Quokka CMS (основанной на Flask).

</p><h4>Развертывание DjangoCMS</h4><p>
Django – фреймворк с открытыми исходными текстами для приложений Python. Он помогает упростить процесс создания сложных веб-приложений, каждое из которых может состоять из набора подключаемых модулей. Давайте посмотрим на преимущества использования Django в Infobox Jelastic и связки Apache + mod_wsgi на примере организации хостинга приложения на Django CMS.

</p><h5>Создание окружения</h5><p>
Создадим окружение для Python в Infobox Jelastic. Зарегистрируйте аккаунт на </p><a href="http://infobox.ru/hosting/cloud/">http://infobox.ru/hosting/cloud/</a><p> (бесплатно активируется пробная версия), залогиньтесь в панель управления и нажмите кнопку «Создать окружение».

</p><img src="https://habrastorage.org/getpro/habr/post_images/c01/b2f/d80/c01b2fd80745037971554f6260abb25a.png"/>
<p>
Перейдите к вкладке «Python». Apache будет выбран автоматически. Укажите минимальный и максимальный лимиты доступных ресурсов (с Python работает автомасштабирование Jelastic, позволяющее оплачивать за потребляемые ресурсы по факту без необходимости резервирования ресурсов), введите имя окружения (например «django») и нажмите </p><strong>Create</strong><p>.

</p><img src="https://habrastorage.org/getpro/habr/post_images/98a/6b0/4df/98a6b04dfcdf5cc1bdb06e00687a3477.jpg"/>

<em><ul>
<li>Вы можете также выбрать одну из предоставляемых версий Python: 2.7, 3.3, 3.4. Выбирая, учитывайте <a href="https://docs.djangoproject.com/en/dev/faq/install/#what-python-version-can-i-use-with-django">информацию о совместимости Django</a>.</li>
<li>Если вы развертываете большое и посещаемое приложение, мы рекомендуем добавить отдельный контейнер с базой данных для вашего приложения. В остальных случаях можно использовать встроенную базу данных SQLite, которая будет размещена внутри контейнера приложений.</li>
</ul></em><p>
В течение минуты будет создано окружение в вашей панели управления.

</p><img src="https://habrastorage.org/getpro/habr/post_images/53a/bb5/dda/53abb5ddae9a0afe9e491521520b99e1.png" title="Infobox Jelastic Django" alt="Infobox Jelastic Django"/>
<p>
Теперь мы можем непосредственно приступить к развертыванию DjangoCMS одним из следующих способов:
</p><ul>
<li>построение и развертывание нового приложения;</li>
<li>развертывание существующего приложения.</li>
</ul>
<h5>Построение и развертывание Django CMS</h5><p>
1. </p><a href="http://docs.jelastic.com/ru/ssh-generate-key">Сгенерируйте</a><p> и </p><a href="http://docs.jelastic.com/ssh-add-key">добавьте публичный SSH ключ</a><p> в вашу панель управления.
</p><p>
2. </p><a href="http://docs.jelastic.com/ssh-access">Установите соединение</a><p> по SSH с контейнером Apache вашего окружения.
</p><p>
3. После входа в контейнер, убедитесь, что вы находитесь в домашней директории вашего пользователя:
</p><pre><code class="bash">cd ~
</code></pre><p>
4. Вы должны создать виртуальное окружение вашего приложения внутри контейнера. Это позволит вам изолировать окружение Python и устанавливать пакеты без необходимости получения привилегий администратора.
</p><pre><code class="bash">virtualenv virtenv
</code></pre><p>
5. Активируйте и переключитесь на созданное виртуальное окружение.
</p><pre><code class="bash">source virtenv/bin/activate
</code></pre><p>
6. Теперь, давайте установим набор модулей, требуемых Django.
</p><pre><code class="bash">pip install django django-cms   djangocms_video  djangocms_teaser djangocms_picture djangocms_link  django-reversion djangocms_inherit  djangocms_googlemap djangocms_flash djangocms_file  djangocms_column djangocms-installer  djangocms_text_ckeditor djangocms_style
</code></pre><p>
Через несколько минут операция завершится.</p><p>
7. Сотрите предустановленное приложение по умолчанию и создайте новое для Django CMS.
</p><pre><code class="bash">rm -rf ROOT; djangocms -p . ROOT
</code></pre><p>
8. После выполнения вышеприведенной команды вам зададут несколько дополнительных вопросов по настройке нового приложения. </p><p>
Уделите особое внимание настройке базы данных:
</p><ul>
<li>Если вы выбрали использование отдельной базы данных (MySQL контейнер при создании окружения Jelastic), укажите строку подключения:<br/>
 <b>mysql://mysql-{env_name}.app.jelasticloud.com</b>, где {env_name} – имя контейнера базы данных.</li>
<li>Если вы предпочитаете использовать встроенную базу данных SQLite, введите следующую строку:<br/>
 <b>sqlite://localhost/ROOT/project.db</b></li>
</ul><p>
Завершите оставшиеся шаги мастера установки вводом необходимых параметров или оставив параметры по умолчанию (отображаются в конце строки в квадратных скобках).

</p><img src="https://habrastorage.org/getpro/habr/post_images/f7c/b81/d14/f7cb81d1497f60b0e1eee517d781acbe.png" title="Infobox Jelastic Django hosting" alt="Infobox Jelastic Django hosting"/>
<p>
9. Когда приложение настроено, у вас спросят имя пользователя, пароль и адрес электронной почты для CMS.

</p><img src="https://habrastorage.org/getpro/habr/post_images/b34/945/de3/b34945de3de9b869d3c2a021a5b8d0b1.png" title="Infobox Jelastic Python Django CMS admin credentials" alt="Infobox Jelastic Python Django CMS admin credentials"/><p>
10. Введите следующую команду для создания нового файла и указания точки входа для mod_wsgi модуля:
</p><pre><code class="bash">vim ROOT/application
</code></pre><p>
Нажмите «i» для перехода в режим редактирования и вставьте следующие строки:
</p><pre><code class="python">import os,sys
virtenv = os.environ['OPENSHIFT_PYTHON_DIR'] + '/virtenv/'
virtualenv = os.path.join(virtenv, 'bin/activate_this.py')
try:
        execfile(virtualenv, dict(__file__=virtualenv))
except IOError:
        pass


sys.path.append('/opt/repo')
sys.path.append('/opt/repo/ROOT')

os.environ['DJANGO_SETTINGS_MODULE'] = 'ROOT.settings'

import django.core.handlers.wsgi
application = django.core.handlers.wsgi.WSGIHandler()
</code></pre><p>
Сохраните изменения и закройте Vim, нажав Esc и написав ":wq".
</p><p>
12. Введите команду: 
</p><pre><code class="bash">vim ROOT/settings.py
</code></pre><p>
В открывшемся файле найдите и замените строку:
</p><pre><code class="python">STATICFILES_DIRS = (
        os.path.join(BASE_DIR, ‘ROOT’, ‘static’),
)
</code></pre><p>
следующим содержанием:
</p><pre><code class="python">STATICFILES_DIRS = (
        os.path.join(BASE_DIR, ‘ROOT’, ‘static_local’),
)
</code></pre><p>
Сохраните изменения и закройте Vim.

</p><img src="https://habrastorage.org/getpro/habr/post_images/13c/ea4/392/13cea43920c0d2b637c2b75c3b520e6f.png"/>
<p>
Создайте новую поддиректорию для статического контента:
</p><pre><code class="bash">mkdir ROOT/static_local
</code></pre><p>
и, наконец, запустите синхронизацию ресурсов:
</p><pre><code class="bash">./manage.py collectstatic
</code></pre><p>
Введите «yes», если система запросит подтверждения.
</p><p>
Это все! Теперь вы можете кликнуть «Открыть в браузере» и насладиться Django CMS.

</p><img src="https://habrastorage.org/getpro/habr/post_images/218/39d/f36/21839df364b83345be5a5fc330e87cd1.png"/>
<p>
Вы увидите экран приветствия.

</p><img src="https://habrastorage.org/getpro/habr/post_images/87f/498/883/87f49888393928d346793d523a0b0655.png"/>
<p>
Для доступа к панели администрирования Django CMS добавьте </p><strong>/admin</strong><p> в конец URL окружения. Для доступа используйте введенные вами при установке Django CMS учетные данные суперпользователя.

</p><img src="https://habrastorage.org/getpro/habr/post_images/027/236/fc7/027236fc7fc264451d5e29b233475f85.png"/>

<h5>Развертывание существующего приложения Django</h5><p>
Если вы заранее собрали и упаковали приложение Django, процедура развертывания может быть выполнена всего за несколько шагов, как показано ниже.

</p><em>Не забудьте про необходимость наличия requirements.txt и application файлов в пакете. Пример в предыдущем разделе.</em>
<p>
1. Загрузите пакет с приложением Django в Диспетчер дистрибутивов.

</p><img src="https://habrastorage.org/getpro/habr/post_images/0a1/093/14f/0a109314f5361597e4342ae6dc90ee63.png"/>
<p>
2. Нажмите «Развернуть в...» и выберите необходимое окружение.

</p><img src="https://habrastorage.org/getpro/habr/post_images/0a3/c4a/797/0a3c4a797cbfdd7fe93677a7db1a527c.png"/>
<p>
3. Подождите минутку окончания развертывания и нажмите «Открыть в браузере».

</p><img src="https://habrastorage.org/getpro/habr/post_images/218/39d/f36/21839df364b83345be5a5fc330e87cd1.png"/>
<p>
Это все! Приятной работы с приложением на Django.
</p><img src="https://habrastorage.org/getpro/habr/post_images/45d/76f/db5/45d76fdb5095e6eef20c0d0394d40739.png"/>

<h4>Заключение</h4><p>
Мы очень счастливы представить Вам поддержку Python в Infobox Jelastic с обеспечением возможности гибкого масштабирования приложений и автоматизациями Jelastic. Мы постарались упростить разработку и запуск приложений Python на платформе Infobox Jelastic без Vendor–lock на быстром и надежном оборудовании.
</p><p>
Попробуйте сейчас и получите 300 рублей на счет Infobox Jelastic. </p><a href="http://infobox.ru/hosting/cloud/">Зарегистрируйтесь</a><p> и по окончании триала нажмите кнопку «Перейти на платную версию». Заполните информацию о себе. </p><a href="mailto:trukhinyuri@infoboxcloud.com">Пришлите ваш логин нам</a><p> и мы начислим вам бонус (из статей бонус можно получить 1 раз на 1 аккаунт).
</p><p>
Успешного использования </p><a href="http://infobox.ru/hosting/cloud/">Infobox Jelastic</a><p>!

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>