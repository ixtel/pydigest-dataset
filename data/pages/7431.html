<html><body><div><div class="post-text" itemprop="text">

<p>I'm building C++&lt;-&gt;Python bindings using Cython, and I cannot find how to return a C++ object from a Python method.</p>

<p>More specifically, when compiling <code>peak_detection_.pyx</code>, shown below, I get </p>

<pre><code>peak_detection_.pyx:35:36: Cannot convert 'vector[Peak]' to Python object
</code></pre>

<p>for the last lines</p>

<pre><code>def getPeaks(self,data):
    return self.thisptr.getPeaks(data)
</code></pre>

<p>I understand the error, but I would not mind some help/pointers about how to fix it.</p>

<p><b>peak_detection.hpp</b></p>

<pre><code>#ifndef PEAKDETECTION_H
#define PEAKDETECTION_H

#include &lt;string&gt;
#include &lt;map&gt;
#include &lt;vector&gt;

#include "peak.hpp"


class PeakDetection
{
    public:
        PeakDetection(std::map&lt;std::string, std::string&gt; config);
        std::vector&lt;Peak&gt; getPeaks(std::vector&lt;float&gt; &amp;data);

    private:
        float _threshold;               
};

#endif
</code></pre>

<p><b>peak_detection.cpp</b></p>

<pre><code>#include &lt;iostream&gt;
#include &lt;string&gt;

#include "peak.hpp"
#include "peak_detection.hpp"


using namespace std;


PeakDetection::PeakDetection(map&lt;string, string&gt; config)
{   
    _threshold = stof(config["_threshold"]);
}

vector&lt;Peak&gt; PeakDetection::getPeaks(vector&lt;float&gt; &amp;data){

    Peak peak1 = Peak(10,1);
    Peak peak2 = Peak(20,2);

    vector&lt;Peak&gt; test;
    test.push_back(peak1);
    test.push_back(peak2);

    return test;
}
</code></pre>

<p><b>peak.hpp</b></p>

<pre><code>#ifndef PEAK_H
#define PEAK_H

class Peak {
    public:
        float freq;
        float mag;

        Peak() : freq(), mag() {}
        Peak(float f, float m) : freq(f), mag(m) {}
};

#endif
</code></pre>

<p><b>peak_detection_.pyx</b></p>

<pre><code># distutils: language = c++
# distutils: sources = peak_detection.cpp

from libcpp.vector cimport vector
from libcpp.map cimport map
from libcpp.string cimport string

cdef extern from "peak.hpp":
    cdef cppclass Peak:
        Peak()

cdef class PyPeak:
    cdef Peak *thisptr
    def __cinit__(self):
        self.thisptr = new Peak()
    def __dealloc__(self):
        del self.thisptr

cdef extern from "peak_detection.hpp":
    cdef cppclass PeakDetection:
        PeakDetection(map[string,string])
        vector[Peak] getPeaks(vector[float])

cdef class PyPeakDetection:
    cdef PeakDetection *thisptr
    def __cinit__(self, map[string,string] config):
        self.thisptr = new PeakDetection(config)
    def __dealloc__(self):
        del self.thisptr
    def getPeaks(self, data):
        return self.thisptr.getPeaks(data)
</code></pre>
    </div>
    </div></body></html>