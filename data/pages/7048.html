<html><body><div><div class="entry-content"><p align="right">Рассказывает <a href="http://tutsplus.com/authors/alex-rose" target="_blank">Alex Rose</a></p><hr/><p>В этой статье мы рассмотрим создание динамической 2D воды с простейшей физикой. Мы будем использовать рендер линий, <a href="http://docs.unity3d.com/ru/current/Manual/class-Mesh.html" target="_blank">мешей</a>, триггеры и частицы. Конечный результат с волнами и брызгами вы сможете добавить в какую-нибудь свою игру. Я <a href="https://github.com/tutsplus/unity-2d-water-effect/" target="_blank">выложил</a> то, что получилось у меня на Unity (Unity 3D), но, используя принципы из данной статьи, вы сможете сделать то же самое на любом движке.</p><p><span id="more-8265"/></p><h3>Итак, приступим</h3><p>Мы будем создавать верхний контур воды, используя рендер линий и много узлов, чтобы это выглядело, как волны.</p><p><img src="http://cdn.tproger.ru/wp-content/uploads/2015/08/1.png" alt=""/></p><p>Нам нужно будет хранить позиции, скорости и ускорения для каждого узла, так что мы будем использовать массивы:</p><div id="crayon-56d5b8d5ddf87391740864" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5ddf87391740864-1"><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5ddf87391740864-2"><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5ddf87391740864-3"><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">velocities</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5ddf87391740864-4"><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">accelerations</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5ddf87391740864-5"><span class="crayon-e">LineRenderer </span><span class="crayon-v">Body</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> С помощью <code>LineRenderer</code> мы создадим границу нашей воды, но нам всё ещё нужна сама вода. Для этого мы будем использовать меши. Для их хранения нам также нужен будет массив <code>GameObject</code>:</p><div id="crayon-56d5b8d5ddf97093044132" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5ddf97093044132-1"><span class="crayon-v">GameObject</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">meshobjects</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5ddf97093044132-2"><span class="crayon-v">Mesh</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">meshes</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Ещё нам нужно будет отслеживать столкновения с поверхностью воды:</p><p> Теперь несколько констант:</p><div id="crayon-56d5b8d5ddfab455487140" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5ddfab455487140-1"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">springconstant</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.02f</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5ddfab455487140-2"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">damping</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.04f</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5ddfab455487140-3"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">spread</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05f</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5ddfab455487140-4"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1f</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Здесь <code>springconstant</code> — «коэффициент жёсткости» наших волн (они будут двигаться подобно пружинному маятнику); <code>damping</code> — коэффициент гашения (иначе волна, единожды начав качаться, не остановится никогда); <code>spread</code> — коэффициент, отвечающий за скорость распространения волн. Вы можете играть с этими значениями, стараясь достичь свойств, наиболее напоминающих настоящую воду. Значение <code>z</code> (координату воды по оси Z) вы можете менять в зависимости от того, что должно стоять ближе к переднему плану в вашем приложении.</p><p>Далее, нам нужно хранить местоположение нашей воды:</p><div id="crayon-56d5b8d5ddfb4274339975" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5ddfb4274339975-1"><span class="crayon-st">float</span><span class="crayon-h"> </span><span class="crayon-i">baseheight</span><span class="crayon-c">; //Нормальный уровень воды</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5ddfb4274339975-2"><span class="crayon-st">float</span><span class="crayon-h"> </span><span class="crayon-i">left</span><span class="crayon-c">; //Координата левого края</span></p><p class="crayon-line" id="crayon-56d5b8d5ddfb4274339975-3"><span class="crayon-st">float</span><span class="crayon-h"> </span><span class="crayon-i">bottom</span><span class="crayon-c">; //Координата дна</span></p></div></td></tr></table></div></div><p> …И её внешний вид:</p><div id="crayon-56d5b8d5de014697825250" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de014697825250-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">GameObject </span><span class="crayon-v">splash</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Частицы брызг</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de014697825250-2"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Material </span><span class="crayon-v">mat</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Материал для границы</span></p><p class="crayon-line" id="crayon-56d5b8d5de014697825250-3"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">GameObject </span><span class="crayon-v">watermesh</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Меш для самой воды</span></p></div></td></tr></table></div></div><p> Объект, в котором все эти данные будут храниться — что-то вроде менеджера, он же будет создавать воду. Создадим для этого функцию — <code>SpawnWater()</code>. В неё мы будем передавать координату левого края воды, ширину водного пространства, а также его верхнюю и нижнюю границы:</p><div id="crayon-56d5b8d5de025405884441" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de025405884441-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">SpawnWater</span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">Left</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">Width</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">Top</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">Bottom</span><span class="crayon-sy">)</span></p></div></td></tr></table></div></div><p/><h3>Создаём узлы</h3><p>Посчитаем количество узлов, которое нам потребуется:</p><div id="crayon-56d5b8d5de02e523774291" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de02e523774291-1"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">edgecount</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">RoundToInt</span><span class="crayon-sy">(</span><span class="crayon-v">Width</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de02e523774291-2"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">nodecount</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">edgecount</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Ещё один узел в конце</span></p></div></td></tr></table></div></div><p> Мы будем использовать пять узлов на единицу ширины, но вы можете менять это значение в поисках своего баланса между производительностью и гладкостью воды.</p><p>Теперь самое время настроить наш <code>LineRenderer</code>:</p><div id="crayon-56d5b8d5de038201798387" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de038201798387-1"><span class="crayon-v">Body</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">gameObject</span><span class="crayon-sy">.</span><span class="crayon-v">AddComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">LineRenderer</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de038201798387-2"><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-v">material</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">mat</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de038201798387-3"><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-v">material</span><span class="crayon-sy">.</span><span class="crayon-v">renderQueue</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Назначаем позицию в очереди рендеринга, чтоб граница рисовалась поверх воды</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de038201798387-4"><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">SetVertexCount</span><span class="crayon-sy">(</span><span class="crayon-v">nodecount</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de038201798387-5"><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">SetWidth</span><span class="crayon-sy">(</span><span class="crayon-cn">0.1f</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.1f</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Ширина линии (в начале и в конце)</span></p></div></td></tr></table></div></div><p> После инициализируем переменные, которые мы создавали выше:</p><div id="crayon-56d5b8d5de03f710957079" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de03f710957079-1"><span class="crayon-v">xpositions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-v">nodecount</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de03f710957079-2"><span class="crayon-v">ypositions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-v">nodecount</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de03f710957079-3"><span class="crayon-v">velocities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-v">nodecount</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de03f710957079-4"><span class="crayon-v">accelerations</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-v">nodecount</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de03f710957079-5"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de03f710957079-6"><span class="crayon-v">meshobjects</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">GameObject</span><span class="crayon-sy">[</span><span class="crayon-v">edgecount</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de03f710957079-7"><span class="crayon-v">meshes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Mesh</span><span class="crayon-sy">[</span><span class="crayon-v">edgecount</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de03f710957079-8"><span class="crayon-v">colliders</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">GameObject</span><span class="crayon-sy">[</span><span class="crayon-v">edgecount</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de03f710957079-9"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de03f710957079-10"><span class="crayon-v">baseheight</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Top</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de03f710957079-11"><span class="crayon-v">bottom</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Bottom</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de03f710957079-12"><span class="crayon-v">left</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Left</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> …И заполним их реальными значениями:</p><div id="crayon-56d5b8d5de045289622612" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de045289622612-1"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">nodecount</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de045289622612-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de045289622612-3"><span class="crayon-h">    </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Top</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de045289622612-4"><span class="crayon-h">    </span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Left</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">Width</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">edgecount</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de045289622612-5"><span class="crayon-h">    </span><span class="crayon-v">accelerations</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de045289622612-6"><span class="crayon-h">    </span><span class="crayon-v">velocities</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de045289622612-7"><span class="crayon-h">    </span><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">SetPosition</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de045289622612-8"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> В конце этого участка кода, как вы видите, мы помещаем каждый узел из <code>LineRenderer</code> на его место.</p><h3>Создаём саму воду</h3><p>Здесь начинается самое интересное. Сейчас у нас есть граница воды, но самой воды нет. Поэтому сейчас мы создадим для неё меши:</p><div id="crayon-56d5b8d5de04b378727545" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de04b378727545-1"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">edgecount</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de04b378727545-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de04b378727545-3"><span class="crayon-h">    </span><span class="crayon-v">meshes</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Mesh</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Теперь в меш нужно передать несколько значений. Для начала — координаты его углов.</p><p><img src="http://cdn.tproger.ru/wp-content/uploads/2015/08/unity-water-Firstmesh.png" alt=""/></p><p>На диаграмме отмечены нужные нам углы первого меша. В общем виде это будет выглядеть так:</p><div id="crayon-56d5b8d5de050932353058" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de050932353058-1"><span class="crayon-v">Vector3</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">Vertices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Vector3</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de050932353058-2"><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de050932353058-3"><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de050932353058-4"><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bottom</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de050932353058-5"><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bottom</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Как вы могли заметить, в нулевой ячейке хранится верхняя левая точка, в первой — верхняя правая, во второй — нижняя левая, а в третьей — нижняя правая. Теперь нам нужно выбрать, какую часть текстуры мы хотим использовать для этого меша. Мы хотим использовать всю, а значит нам нужно просто написать:</p><div id="crayon-56d5b8d5de056555725636" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de056555725636-1"><span class="crayon-v">Vector2</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">UVs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Vector2</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de056555725636-2"><span class="crayon-v">UVs</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector2</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Верхний левый угол</span></p><p class="crayon-line" id="crayon-56d5b8d5de056555725636-3"><span class="crayon-v">UVs</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector2</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Верхний правый угол</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de056555725636-4"><span class="crayon-v">UVs</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector2</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Нижний левый угол</span></p><p class="crayon-line" id="crayon-56d5b8d5de056555725636-5"><span class="crayon-v">UVs</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector2</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//Нижний правый угол</span></p></div></td></tr></table></div></div><p> Меши должны состоять из треугольников. К счастью, любой четырёхугольник можно разделить на два треугольника.</p><p><img src="http://cdn.tproger.ru/wp-content/uploads/2015/08/unity-water-Tris.png" alt=""/></p><p>Как вы можете видеть, треугольник <strong>A</strong> состоит из вершин <code>0</code>, <code>1</code>, <code>3</code>, а треугольник <strong>B</strong> — из вершин <code>3</code>, <code>2</code>, <code>0</code>. Эти шесть чисел нам нужно записать в отдельный массив, в этом же порядке:</p><div id="crayon-56d5b8d5de05c080259757" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de05c080259757-1"><span class="crayon-t">int</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">tris</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">[</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Теперь три созданных нами массива нужно передать в меш:</p><div id="crayon-56d5b8d5de061932913499" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de061932913499-1"><span class="crayon-v">meshes</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">vertices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Vertices</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de061932913499-2"><span class="crayon-v">meshes</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">uv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">UVs</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de061932913499-3"><span class="crayon-v">meshes</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">triangles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tris</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Теперь у нас есть меши, но нет <code>GameObject</code>-ов, чтоб их рендерить. Исправим это:</p><div id="crayon-56d5b8d5de066256987117" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de066256987117-1"><span class="crayon-v">meshobjects</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Instantiate</span><span class="crayon-sy">(</span><span class="crayon-v">watermesh</span><span class="crayon-sy">,</span><span class="crayon-v">Vector3</span><span class="crayon-sy">.</span><span class="crayon-v">zero</span><span class="crayon-sy">,</span><span class="crayon-v">Quaternion</span><span class="crayon-sy">.</span><span class="crayon-v">identity</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">GameObject</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de066256987117-2"><span class="crayon-v">meshobjects</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">GetComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">MeshFilter</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">mesh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">meshes</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de066256987117-3"><span class="crayon-v">meshobjects</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">transform</span><span class="crayon-sy">.</span><span class="crayon-v">parent</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">transform</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Все эти меши теперь являются потомками менеджера.</p><h3>Настройка детекторов столкновений</h3><div id="crayon-56d5b8d5de06c701419726" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de06c701419726-1"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">GameObject</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de06c701419726-2"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"Trigger"</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de06c701419726-3"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">AddComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">BoxCollider2D</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de06c701419726-4"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">transform</span><span class="crayon-sy">.</span><span class="crayon-v">parent</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">transform</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de06c701419726-5"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">transform</span><span class="crayon-sy">.</span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">Left</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">Width</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0.5f</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">edgecount</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Top</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0.5f</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de06c701419726-6"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">transform</span><span class="crayon-sy">.</span><span class="crayon-v">localScale</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">Width</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">edgecount</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de06c701419726-7"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">GetComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">BoxCollider2D</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">isTrigger</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de06c701419726-8"><span class="crayon-v">colliders</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">AddComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">WaterDetector</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p>Здесь мы создаём несколько </p><code>BoxCollider</code><p>-ов, назначаем им имена и делаем их потомками менеджера. Также мы назначаем им позиции — посередине между узлами, определяем их размер и добавляем им </p><code>WaterDetector</code><p>.</p><p>Ну и следующая функция будет обновлять позиции наших узлов:</p><div id="crayon-56d5b8d5de072440338853" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de072440338853-1"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">UpdateMeshes</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de072440338853-2"><span class="crayon-h">    </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de072440338853-3"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">meshes</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de072440338853-4"><span class="crayon-h">        </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de072440338853-5"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de072440338853-6"><span class="crayon-h">            </span><span class="crayon-v">Vector3</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">Vertices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Vector3</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de072440338853-7"><span class="crayon-h">            </span><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de072440338853-8"><span class="crayon-h">            </span><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de072440338853-9"><span class="crayon-h">            </span><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bottom</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de072440338853-10"><span class="crayon-h">            </span><span class="crayon-v">Vertices</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bottom</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de072440338853-11"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de072440338853-12"><span class="crayon-h">            </span><span class="crayon-v">meshes</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">vertices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Vertices</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de072440338853-13"><span class="crayon-h">        </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de072440338853-14"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p/><h3>Добавим немного физики</h3><p>Чтобы находить ускорения, скорости и новые позиции узлов, нам нам понадобятся <a href="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BA%D0%BE%D0%BD_%D0%93%D1%83%D0%BA%D0%B0" target="_blank">закон Гука</a> и <a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%AD%D0%B9%D0%BB%D0%B5%D1%80%D0%B0" target="_blank">метод Эйлера</a>.</p><p>Итак, закон Гука гласит, что <strong>F=-k*x</strong>, где <strong>F</strong> — сила, с которой пружина стремится вернуться в начальное состояние (не забывайте, что наши волны будут состоять из множества маленьких пружин); <strong>k</strong> — коэффициент жёсткости (помните, мы записывали его в константах?); <strong>x</strong> — растяжение. По этой формуле мы будем высчитывать ускорение для узлов, значение растяжения будет высчитываться как разница между текущей позицией воды и её базовым уровнем. Ещё к силе мы будем прибавлять скорость, умноженную на коэффициент гашения — чтобы волны не были бесконечными.</p><div id="crayon-56d5b8d5de079360821751" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de079360821751-1"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">FixedUpdate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de079360821751-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de079360821751-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-i">Length</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de079360821751-4"><span class="crayon-h">        </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de079360821751-5"><span class="crayon-h">            </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">force</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">springconstant</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">baseheight</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de079360821751-6"><span class="crayon-h">            </span><span class="crayon-v">accelerations</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">force</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">velocities</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-i">damping</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8d5de079360821751-7"><span class="crayon-h">            </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">velocities</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de079360821751-8"><span class="crayon-h">            </span><span class="crayon-v">velocities</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">accelerations</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de079360821751-9"><span class="crayon-h">            </span><span class="crayon-v">Body</span><span class="crayon-sy">.</span><span class="crayon-e">SetPosition</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de079360821751-10"><span class="crayon-h">        </span><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> Как видите, метод Эйлера очень прост — мы просто каждый раз прибавляем к позиции узла его скорость, а к скорости прибавляем ускорение. Разумеется, для точных вычислений больше бы подошло <a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%92%D0%B5%D1%80%D0%BB%D0%B5" target="_blank">интегрирование Верье</a>, но из-за использования гашения это с трудом представляется возможным. К тому же метод Эйлера на порядок проще.</p><p>Теперь добавим немного распространения волн. Создадим два массива, в которых мы будем хранить разницу между высотами соседних узлов, умноженную на коэффициент распространения:</p><div id="crayon-56d5b8d5de080298245846" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de080298245846-1"><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">leftDeltas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de080298245846-2"><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">rightDeltas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">[</span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> …И заполним их, попутно меняя скорости и высоты:</p><div id="crayon-56d5b8d5de085631610096" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"><div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-2">2</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-4">4</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-6">6</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-8">8</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-10">10</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-12">12</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-14">14</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-16">16</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-18">18</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-20">20</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-22">22</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-24">24</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8d5de085631610096-26">26</p><p class="crayon-num" data-line="crayon-56d5b8d5de085631610096-27">27</p></div></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de085631610096-1"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-3"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-4"><span class="crayon-h">    </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-5"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-6"><span class="crayon-h">        </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-7"><span class="crayon-h">            </span><span class="crayon-v">leftDeltas</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">spread</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-8"><span class="crayon-h">            </span><span class="crayon-v">velocities</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">leftDeltas</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-9"><span class="crayon-h">        </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-10"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-11"><span class="crayon-h">        </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-12"><span class="crayon-h">            </span><span class="crayon-v">rightDeltas</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">spread</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-13"><span class="crayon-h">            </span><span class="crayon-v">velocities</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">rightDeltas</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-14"><span class="crayon-h">        </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-15"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-16"><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-17"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-18"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-19"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-20"><span class="crayon-h">    </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-21"><span class="crayon-h">        </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">leftDeltas</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-22"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-23"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-24"><span class="crayon-h">    </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-25"><span class="crayon-h">        </span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">rightDeltas</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de085631610096-26"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8d5de085631610096-27"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> Как вы заметили, выше мы совершаем действия 8 раз. Это сделано для большей плавности.</p><h3>Добавим столкновения</h3><p>Теперь у нас есть вода, которая может не просто отображаться, но и переливаться. Теперь нам нужна возможность её всколыхнуть!</p><p>Для этого создадим метод <code>Splash()</code>, который будет проверять место и скорость удара по воде:</p><div id="crayon-56d5b8d5de08c224700276" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de08c224700276-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">Splash</span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">xpos</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">velocity</span><span class="crayon-sy">)</span></p></div></td></tr></table></div></div><p> Для начала проверим корректность переданной координаты по иксу:</p><div id="crayon-56d5b8d5de091996466798" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de091996466798-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">xpos</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">xpos</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p></div></td></tr></table></div></div><p> Теперь сделаем так, чтоб хранилась не абсолютная координата, а расстояние от первого узла:</p><p> Теперь нужно вычислить, на который узел приходится удар:</p><div id="crayon-56d5b8d5de09a246626280" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de09a246626280-1"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">RoundToInt</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-v">xpos</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Здесь мы делаем буквально следующее:</p><ul><li>Мы берём координату относительно первого узла — <code>xpos</code>.</li><li>Делим её на разницу между позицей последнего и первого узла.</li><li>Таким образом мы получаем дробное число, которое говорит нам, куда именно пришёлся удар.</li><li>Умножаем полученное число на количество углов и округляем до целого.</li></ul><p>Теперь приравниваем скорость найденного узла к скорости удара:</p><div id="crayon-56d5b8d5de0a0084659662" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de0a0084659662-1"><span class="crayon-v">velocities</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">velocity</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Вы можете поступить иначе, например, прибавить скорость удара к текущей скорости узла или дейсвовать согласно закону сохранения импульса.</p><p>Теперь добавим брызги:</p><div id="crayon-56d5b8d5de0a5261865223" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de0a5261865223-1"><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">lifetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.93f</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">Abs</span><span class="crayon-sy">(</span><span class="crayon-v">velocity</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">0.07f</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0a5261865223-2"><span class="crayon-v">splash</span><span class="crayon-sy">.</span><span class="crayon-v">GetComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">ParticleSystem</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">startSpeed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-o">*</span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">Pow</span><span class="crayon-sy">(</span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">Abs</span><span class="crayon-sy">(</span><span class="crayon-v">velocity</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0.5f</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de0a5261865223-3"><span class="crayon-v">splash</span><span class="crayon-sy">.</span><span class="crayon-v">GetComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">ParticleSystem</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">startSpeed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">Pow</span><span class="crayon-sy">(</span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">Abs</span><span class="crayon-sy">(</span><span class="crayon-v">velocity</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.5f</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0a5261865223-4"><span class="crayon-v">splash</span><span class="crayon-sy">.</span><span class="crayon-v">GetComponent</span><span class="crayon-o">&lt;</span><span class="crayon-v">ParticleSystem</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">startLifetime</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lifetime</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Вы можете удивиться тому, что я назначил стартовую скорость дважды. Причина во встроенной <a href="http://docs.unity3d.com/ru/current/Manual/class-ParticleSystem.html" target="_blank">системе частиц</a>, которая назначает начальную скорость как случайное число между двумя константами. К сожалению, у нас нет особого доступа к ней через скрипты, поэтому приходится действовать так.</p><p>Дальше я добавил одну линию, но вы можете её пропустить:</p><div id="crayon-56d5b8d5de0ab246651110" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de0ab246651110-1"><span class="crayon-e">Vector3 </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-v">ypositions</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-o">-</span><span class="crayon-cn">0.35f</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0ab246651110-2"><span class="crayon-e">Quaternion </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Quaternion</span><span class="crayon-sy">.</span><span class="crayon-e">LookRotation</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Vector3</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">[</span><span class="crayon-v">Mathf</span><span class="crayon-sy">.</span><span class="crayon-e">FloorToInt</span><span class="crayon-sy">(</span><span class="crayon-v">xpositions</span><span class="crayon-sy">.</span><span class="crayon-v">Length</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">baseheight</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> Брызги не уничтожатся при столкновении с другими объектами, поэтому вам стоит либо назначить им Z координату фона (у меня — 5), либо сделать так, чтобы частицы всегда попадали обратно на воду. Я выбрал нечто среднее:</p><div id="crayon-56d5b8d5de0b0430434560" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de0b0430434560-1"><span class="crayon-e">GameObject </span><span class="crayon-v">splish</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Instantiate</span><span class="crayon-sy">(</span><span class="crayon-v">splash</span><span class="crayon-sy">,</span><span class="crayon-v">position</span><span class="crayon-sy">,</span><span class="crayon-v">rotation</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">GameObject</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0b0430434560-2"><span class="crayon-h">        </span><span class="crayon-e">Destroy</span><span class="crayon-sy">(</span><span class="crayon-v">splish</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lifetime</span><span class="crayon-o">+</span><span class="crayon-cn">0.3f</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5b8d5de0b0430434560-3"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0b0430434560-4"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> Вроде бы всё, так?</p><h3>Обнаружение столкновений</h3><p>Нет, не так! Нам нужно отслеживать столкновения объектов с водой, иначе всё это было написано зря. Помните класс <code>WaterDetector</code>, который мы упоминали выше? Сейчас мы займёмся именно им. Всё, что нам нужно от него — лишь один метод:</p><div id="crayon-56d5b8d5de0b5454407930" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8d5de0b5454407930-1"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">OnTriggerEnter2D</span><span class="crayon-sy">(</span><span class="crayon-e">Collider2D </span><span class="crayon-v">Hit</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0b5454407930-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de0b5454407930-3"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Hit</span><span class="crayon-sy">.</span><span class="crayon-v">rigidbody2D</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0b5454407930-4"><span class="crayon-h">    </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8d5de0b5454407930-5"><span class="crayon-h">        </span><span class="crayon-v">transform</span><span class="crayon-sy">.</span><span class="crayon-v">parent</span><span class="crayon-sy">.</span><span class="crayon-e">GetComponent</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Splash</span><span class="crayon-sy">(</span><span class="crayon-v">transform</span><span class="crayon-sy">.</span><span class="crayon-v">position</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Hit</span><span class="crayon-sy">.</span><span class="crayon-v">rigidbody2D</span><span class="crayon-sy">.</span><span class="crayon-v">velocity</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-o">*</span><span class="crayon-v">Hit</span><span class="crayon-sy">.</span><span class="crayon-v">rigidbody2D</span><span class="crayon-sy">.</span><span class="crayon-v">mass</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">40f</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8d5de0b5454407930-6"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8d5de0b5454407930-7"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> Теперь вам осталось лишь вызвать <code>SpawnWater()</code> где-либо в вашем коде и наслаждаться великолепным волнами и брызгами!<br/> <img src="http://cdn.tproger.ru/wp-content/uploads/2015/08/Splash22.png" alt=""/></p><p align="right"><sub>Перевод статьи <a href="http://gamedevelopment.tutsplus.com/tutorials/creating-dynamic-2d-water-effects-in-unity--gamedev-14143" target="_blank">«Creating Dynamic 2D Water Effects in Unity»</a></sub></p><p class="mistape_caption"/><footer class="entry-meta clearfix"><p class="vk_like" id="vk_like_bottom_8265"/></footer></div></div></body></html>