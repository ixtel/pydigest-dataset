<html><body><div><div class="post-meta">
        <p>This post explains how to create and install an SSL certificate obtained for free through <a href="https://www.startssl.com/" title="startssl">StartSSL</a> on a <a href="https://www.pythonanywhere.com" title="pythonanywhere">PythonAnywhere</a> hosted website. </p>
<p>Before we get started you will need the following:</p>
<p><br/></p>
<h5><strong>Requirements</strong></h5>
<ol>
<li>A <a href="https://www.godaddy.com/" title="godaddy">domain name</a> and the ability to edit DNS records.</li>
<li>The ability to receive email sent to <em>postmaster@yourdomain.com</em>.</li>
<li>A <a href="https://www.pythonanywhere.com/pricing/" title="pythonanywhere_paid">paid subscription</a> to PythonAnywhere, starting at $4.00/month.</li>
<li>Trust in the PythonAnywhere support team.</li>
</ol>
<p><br/></p>
<h5><strong>Create Private Key and CSR</strong></h5>
<p>Our first step is to create a Private Key and a Certificate Signing Request (CSR). This process relies on <a href="https://en.wikipedia.org/wiki/Public-key_cryptography" title="public_key_encryption">Public Key Encryption</a> and will link the CSR and the Private Key such that our identity can be mathematically proven. We will later submit this CSR to our Certificate Authority (CA) so that our Public Key can be included in our SSL certificate. We will then install that certificate on our PythonAnywhere server and verify our identity using our Private Key. </p>
<p><br/>
To get started we will create a new folder in our home directory and generate our Private Key and CSR. Open up a bash console in PythonAnywhere and run the following commands, substituting "<em>yourdomain.com</em>" with your actual domain, e.g., <em>doconnor.org</em>:</p>
<div class="codehilite"><pre><span class="nv">$ </span>mkdir certs
<span class="nv">$ </span><span class="nb">cd </span>certs/
<span class="nv">$ </span>openssl req -new -newkey rsa:2048 -nodes -keyout yourdomain.com.key -out yourdomain.com.csr
</pre></div>


<p><br/>
When prompted to enter identification material for the CSR, make sure not to enter a password and to also use your own location and domain name. It is also important to note that you should only use the <em>www</em> subdomain. Here is what my answers looked like:</p>
<p><img alt="csr_creation" src="https://doconnor.s3.amazonaws.com/media/blog_images/csr_creation.png" title="csr_creation"/></p>
<p><br/>
You should now have two new items in your certs folder, a <em>yourdomain.com.csr</em> and a <em>yourdomain.com.key</em>. We can verify the contents of the directory and the directory path using the following commands:</p>
<div class="codehilite"><pre><span class="nv">$ </span>ls yourdomain.com*
yourdomain.com.csr yourdomain.com.key
<span class="nv">$ </span><span class="nb">pwd</span>
/home/yourusername/certs
</pre></div>


<p><br/>
Make note of the path, we will need to navigate to it momentarily. If everything looks good lets jump into submitting the CSR to StartSSL! </p>
<p><br/></p>
<h5><strong>Submit CSR to StartSSL</strong></h5>
<p>In PythonAnywhere switch from Console to Files. Locate your certs folder using the path we found a moment ago and download your CSR. Navigate to <a href="https://www.startssl.com/" title="startssl">StartSSL</a> and sign-up for a free account. Rather than create a username and password, StarSSL authenticates via a certificate. You will be able to export this certificate for backup purposes, but at the moment we are only concerned with creating an account. This process can take a little time, it took about ~45 minutes for my account request to be approved. Eventually you will receive an email from StartSSL approving your request for an account and subsequent instructions on installing the login certificate. </p>
<p>Once you have been approved and have installed the certificate you will be able to sign in and validate ownership of your domain. After you have signed in to StartSSL, you will see a Validations Wizard tab. Click on the tab and you should then be able to select Domain Name Validation, pictured below.</p>
<p><br/>
<img alt="startssl_validate" src="https://doconnor.s3.amazonaws.com/media/blog_images/startssl_validate.png" title="startssl_validate"/></p>
<p>Enter your domain name and choose to continue. Choose to send an email to <em>postmaster@yourdomain.com</em> and after a couple minutes an authentication email will arrive with instructions on verifying the account. If you do not have access to this email address or it does not exist, you should create it before moving forward. After you have successfully authenticated domain ownership we will be able to apply for a free SSL certificate. </p>
<p>It is important to note that this certificate is limited to one domain and must be the same subdomain you entered when creating the CSR, specifically <em>www</em>. Return to StartSSL and select the Certificates Wizard tab. Choose Web Server SSL/TLS Certificate from the dropdown and hit continue:</p>
<p><br/>
<img alt="startssl_request1" src="https://doconnor.s3.amazonaws.com/media/blog_images/startssl_request1.png" title="startssl_request1"/></p>
<p>Skip the Private Key creation, we already have one. In the next screen we will need to enter the contents of our <em>yourdomain.com.csr</em>. There isn't an option to upload the file directly, so instead open it in your favorite text editor, such as Notepad or TextEdit, and copy everything in the file including the -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----. Assuming everything pasted correctly your Public Key will successfully be passed to StartSSL and they will be able to include it on the SSL Certificate. </p>
<p>You will then be asked to specify the subdomain for your website. This should match the FQDN that was used when creating the CSR in PythonAnywhere, namely <em>www</em>. At this point keep clicking Continue until you have the ability to save the certificate. </p>
<p><br/>
<img alt="startssl_request2" src="https://doconnor.s3.amazonaws.com/media/blog_images/startssl_request2.png" title="startssl_request2"/></p>
<p>At this point you should create a new file using your text editor called called <em>yourdomain.com.crt</em>. Be aware that some editors (I'm looking at you TextEdit!) may prepend the document with junk formatting information which will cause issues later on. Copy and paste the contents of your new StartSSL certificate into this file and save it. Awesome, we now have a brand new certificate that is almost ready to be added to our PythonAnywhere website!</p>
<p><br/></p>
<h5><strong>Combine and Upload Certificate Chain</strong></h5>
<p>Our new certificate is for us specifically and cannot currently be validated. If you open up the certificate, at least on a Mac, you will see the the certificate has been signed by an unknown authority. </p>
<p><br/>
<img alt="ssl_invalid" src="https://doconnor.s3.amazonaws.com/media/blog_images/ssl_invalid.png" title="ssl_invalid"/></p>
<p>In order to validate the certificate we will need to append the Intermediate and Root Certificates from StartSSL. For our purposes we will want to append the contents of <em>sub.class1.server.ca.pem</em> to our certificate. Go ahead and <a href="http://www.startssl.com/certs/sub.class1.server.ca.pem" title="startssl_intermediate_cert">download</a> the certificate. Since I am not sure which operating system you are currently using, let's just do everything in a PythonAnywhere console.</p>
<p>Navigate to PythonAnywhere and return to the Files tab. Return to your certs folder and upload <em>sub.class1.server.ca.pem</em> and your new certificate, <em>yourdomain.com.crt</em>. Return to Console, navigate to the certs folder and run the following command, substituting <em>yourdomain.com</em> with your actual domain, to merge the two files into a new file called <em>yourdomain.com.cert</em>:</p>
<div class="codehilite"><pre><span class="nv">$ </span>cat yourdomain.com.crt &gt;&gt; yourdomain.com.combined.cert <span class="p">|</span> cat sub.class1.server.ca.pem &gt;&gt; yourdomain.com.combined.cert
</pre></div>


<p><br/>
You can manually verify the contents of the new cert by running the following commands:</p>
<div class="codehilite"><pre><span class="nv">$ </span>more yourdomain.com.crt
-----BEGIN CERTIFICATE-----
Example_Text_From_CRT
-----END CERTIFICATE-----
<span class="nv">$ </span>more sub.class1.server.ca.pem
-----BEGIN CERTIFICATE-----
Example_Text_From_PEM
-----END CERTIFICATE-----
<span class="nv">$ </span>more yourdomain.com.combined.cert
-----BEGIN CERTIFICATE-----
Example_Text_From_CRT
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
Example_Text_From_PEM
-----END CERTIFICATE-----
</pre></div>


<p><br/>
The contents of each file should start with -----BEGIN CERTIFICATE----- and end with -----END CERTIFICATE-----. If for some reason <em>yourdomain.com.crt</em> starts with anything else, it probably means your text editor added some unnecessary and conflicting formatting information. You will need to manually edit the file to not include this information. If you're familiar with Vim, you can just edit the file right from Console. </p>
<p>If the output from each file looks good and the order of the .crt and the .pem match the order and contents of the .cert then you have just created a SSL certificate! If you are on a Mac and want to be doubly sure that your certificate is valid, navigate back to the Files tab in PythonAnywhere and download the brand new .cert file. Change the file extension to .crt instead of .cert and open the file. You should see something specifically indicating validity if all is well. </p>
<p><br/>
<img alt="ssl_valid" src="https://doconnor.s3.amazonaws.com/media/blog_images/ssl_valid.png" title="ssl_valid"/> </p>
<p>Now we need to involved the guys at PythonAnywhere. Unfortunately we have to trust them with our Private Key in order to complete installation. Navigate back to PythonAnywhere and select Send Feedback in the nav bar. Request that they install your new SSL certificate and that both <em>yourdomain.com.key</em> and <em>yourdomain.com.combined.cert</em> can be found in your certs folder. Be sure to include the full path to the certs folder. This process will take some time depending on when you send your request. I sent mine on a Sunday night and everything was up and running by Monday morning.</p>
<p><br/></p>
<h5><strong>Change DNS to Forward HTTP to HTTPS</strong></h5>
<p>After support emails you back and confirms installation of the new certificate, you should navigate to your DNS provider and verify that you have a CNAME record pointing <em>www</em> to your PythonAnywhere site, see <a href="https://www.pythonanywhere.com/wiki/OwnDomains" title="pythonanywhere_owndomain">Setting up a custom domain on PythonAnywhere</a> for more information. Once that is in place, see if you can implement forwarding so naked domains are captured and redirected to HTTPS too. This will be different for each DNS host, but for GoDaddy you should be able to find Forwarding under Domain Details. Your rule should look something like this:</p>
<p><br/>
<img alt="godaddy_forward" src="https://doconnor.s3.amazonaws.com/media/blog_images/godaddy_forward.png" title="godaddy_forward"/></p>
<p>If you navigate to <em>yourdomain.com</em> or <em>https://www.yourdomain.com</em> now it should redirect to <em>https://www.yourdomain.com</em> and include a valid SSL certificate. Remember, DNS records can take some time to propagate so if it does not work immediately try again in ten minutes. </p>
<p><br/></p>
<h5><strong>Enforce HTTPS in Django</strong></h5>
<p>We have a small problem though. Even though <em>yourdomain.com</em> redirects correctly to <em>https://www.yourdomain.com</em>, <em>www.yourdomain.com</em> still goes to <em>http://www.yourdomain.com</em>. We can fix this through enforcing HTTPS in Django. Just return to your Django installation in PythonAnywhere and setup <a href="https://github.com/rdegges/django-sslify/" title="django-sslify">django-sslify</a>.  </p>
<p>Open up Console and hop onto your virtualenv. Run the following to install the library:</p>
<div class="codehilite"><pre><span class="nv">$ </span>pip install django-sslify
</pre></div>


<p><br/>
Open up your settings.py and update the following:</p>
<div class="codehilite"><pre><span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'.yourdomain.com'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">'sslify.middleware.SSLifyMiddleware'</span><span class="p">,</span>
    <span class="c"># ...</span>
<span class="p">)</span>
</pre></div>


<p><br/>
Reload your site and everything should now correctly redirect to <em>https://www.yourdomain.com</em>.  Way to go, you just helped make the internet a more trustworthy place!</p>
    </div>




               
           </div></body></html>