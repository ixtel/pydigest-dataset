<html><body><div><div id="usage">
<h3>Usage</h3>
<pre>defrost --help
</pre>
<p>First define a set of package requirements in a YAML file, <tt>requirements.yml</tt>.</p>
<pre><span class="nn">---</span>
<span class="l-Scalar-Plain">requirements</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">requirement</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">foobar&gt;=1.0</span>
  <span class="l-Scalar-Plain">reason</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">foobar pre-1.0 is no longer supported, please upgrade to 1.x</span>

<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">requirement</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ordereddict&lt;0.0</span>
  <span class="l-Scalar-Plain">reason</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">OrderedDict is part of Python 2.7 and above. If you are still running Python 2.6, please upgrade!</span>
</pre>
<p>Then you can pipe the output of <tt>pip freeze</tt> to defrost while providing the YAML file.</p>
<pre>$ pip freeze &gt; freeze.out
$ defrost requirements.yml freeze.out
Package(foobar==1.2) does not satisfy Requirement(foobar&gt;=2.0): foobar pre-1.0 is no longer supported, please upgrade to 1.x
</pre>
<p>Defrost can also take the pip freeze output as stdin by passing a dash sign
<tt>-</tt> as argument in place of the pip freeze output file.</p>
<pre>$ pip freeze | defrost requirements.yml -
Package(foobar==1.2) does not satisfy Requirement(foobar&gt;=2.0): foobar pre-1.0 is no longer supported, please upgrade to 1.x
</pre>
<p>You can also check whether the YAML file provided is valid with
<tt><span class="pre">defrost-lint</span></tt>.</p>
<pre>$ defrost-lint requirements.yml
</pre>
</div>
<div id="library">
<h3>Library</h3>
<p>There are 3 fundamental objects available:</p>
<ul>
<li><tt>PipFreeze</tt>: a pythonic container of packages that takes a pip freeze
output as input.</li>
<li><tt>Package</tt>: represents a package instance at an exact version (pinned)
held by a PipFreeze container (e.g. <tt><span class="pre">foo==1.2</span></tt>)</li>
<li><tt>Requirement</tt>: a requirement for a package represents one version
or a range of versions for a given package, e.g. <tt><span class="pre">foo&gt;=2.0</span></tt> is a
requirement for all versions of foo greater or equal to 2.0. <tt>foo</tt> without
a version specifier would mean all versions of <tt>foo</tt>.</li>
</ul>
<div id="pipfreeze">
<h4>PipFreeze</h4>
<p>PipFreeze takes a pip freeze output as input and builds packages internally.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">defrost</span> <span class="kn">import</span> <span class="n">PipFreeze</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">pip_freeze_output</span> <span class="o">=</span> <span class="s2">"""</span><span class="se">\
</span><span class="s2">foo==1.2.3
bar==2.0
"""</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">pip_freeze</span> <span class="o">=</span> <span class="n">PipFreeze</span><span class="p">(</span><span class="n">pip_freeze_output</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pip_freeze</span><span class="p">)</span>
<span class="mi">2</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">pip_freeze</span><span class="p">)</span>
<span class="p">[</span><span class="n">Package</span><span class="p">(</span><span class="n">foo</span><span class="o">==</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">3</span><span class="p">),</span> <span class="n">Package</span><span class="p">(</span><span class="n">bar</span><span class="o">==</span><span class="mf">2.0</span><span class="p">)]</span>

<span class="c1"># test presence of package foo that is less or equal to v2.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s1">'foo&lt;=2.0'</span> <span class="ow">in</span> <span class="n">pip_freeze</span>
<span class="bp">True</span>

<span class="c1"># test presence of any version of package zoo</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s1">'zoo'</span> <span class="ow">in</span> <span class="n">pip_freeze</span>
<span class="bp">False</span>

<span class="c1"># test can also be done with a Package instance</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo==0.1'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pip_freeze</span>
<span class="bp">False</span>

<span class="c1"># ... or with a Requirement</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Requirement</span><span class="p">(</span><span class="s1">'bar&gt;=2.0'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pip_freeze</span>
<span class="bp">True</span>
</pre>
</div>
<div id="package-deprecation">
<h4>Package deprecation</h4>
<p>You can mark packages as deprecated by loading the YAML requirements file and
passing the result of it to <tt>PipFreeze.load_requirements()</tt>. Packages present
in PipFreeze will be marked as deprecated if they donâ€™t satisfy the loaded
requirements. You can also provide an optional reason to why a package is
deprecated.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">pip_freeze</span> <span class="o">=</span> <span class="n">PipFreeze</span><span class="p">(</span><span class="s2">"""</span><span class="se">\
</span><span class="s2">foobar==0.8
bar==2.0
ordereddict==1.1
"""</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">reqs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">'my-reqs.yaml'</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pip_freeze</span><span class="o">.</span><span class="n">load_requirements</span><span class="p">(</span><span class="n">reqs</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pip_freeze</span><span class="o">.</span><span class="n">deprecated</span>
<span class="p">[</span><span class="n">Package</span><span class="p">(</span><span class="n">foobar</span><span class="o">==</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">Package</span><span class="p">(</span><span class="n">ordereddict</span><span class="o">==</span><span class="mf">1.1</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">pip_freeze</span><span class="o">.</span><span class="n">deprecated</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: deprecated=</span><span class="si">%s</span><span class="s2">, deprecated_by=</span><span class="si">%s</span><span class="s2">, reason=</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">package</span><span class="p">,</span> <span class="n">package</span><span class="o">.</span><span class="n">deprecated</span><span class="p">,</span> <span class="n">package</span><span class="o">.</span><span class="n">deprecated_by</span><span class="p">,</span> <span class="n">package</span><span class="o">.</span><span class="n">deprecation_reason</span>
        <span class="p">))</span>
<span class="o">...</span>
<span class="n">Package</span><span class="p">(</span><span class="n">foobar</span><span class="o">==</span><span class="mf">0.8</span><span class="p">):</span> <span class="n">deprecated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">deprecated_by</span><span class="o">=</span><span class="n">Requirement</span><span class="p">(</span><span class="n">foobar</span><span class="o">&gt;=</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="n">foobar</span> <span class="n">pre</span><span class="o">-</span><span class="mf">1.0</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">supported</span><span class="p">,</span> <span class="n">please</span> <span class="n">upgrade</span> <span class="n">to</span> <span class="mf">1.</span><span class="n">x</span>
<span class="n">Package</span><span class="p">(</span><span class="n">ordereddict</span><span class="o">==</span><span class="mf">1.1</span><span class="p">):</span> <span class="n">deprecated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">deprecated_by</span><span class="o">=</span><span class="n">Requirement</span><span class="p">(</span><span class="n">ordereddict</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="n">ordereddict</span> <span class="ow">is</span> <span class="n">part</span> <span class="n">of</span> <span class="n">Python</span> <span class="mf">2.7</span> <span class="ow">and</span> <span class="n">above</span><span class="o">.</span> <span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">still</span> <span class="n">running</span> <span class="n">Python</span> <span class="mf">2.6</span><span class="p">,</span> <span class="n">please</span> <span class="n">upgrade</span><span class="err">!</span>
</pre>
</div>
<div id="package">
<h4>Package</h4>
<p>Packages take an exact package version as input.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">defrost</span> <span class="kn">import</span> <span class="n">Package</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">package</span> <span class="o">=</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo==1.2'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">package</span><span class="o">.</span><span class="n">name</span>
<span class="s1">'foo'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">package</span><span class="o">.</span><span class="n">version</span>
<span class="s1">'1.2'</span>
</pre>
<p>If you donâ€™t pass an exact version in your requirement it will raise a <tt>ValueError</tt>.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">package</span> <span class="o">=</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="o">...</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">foo</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">represent</span> <span class="n">an</span> <span class="n">exact</span> <span class="n">package</span> <span class="n">version</span><span class="p">;</span> <span class="n">the</span> <span class="n">format</span> <span class="n">should</span> <span class="n">be</span> <span class="n">foo</span><span class="o">==</span><span class="mf">1.0</span>
</pre>
<p>You can also manually deprecate packages:</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">package</span> <span class="o">=</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo==1.2'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">package</span><span class="o">.</span><span class="n">deprecated</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">package</span><span class="o">.</span><span class="n">deprecate</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">'because'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">package</span><span class="o">.</span><span class="n">deprecated</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">package</span><span class="o">.</span><span class="n">deprecation_reason</span>
<span class="s1">'because'</span>
</pre>
</div>
<div id="requirement">
<h4>Requirement</h4>
<p>A requirement represents a range of package versions.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">defrost</span> <span class="kn">import</span> <span class="n">Requirement</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">req</span> <span class="o">=</span> <span class="n">Requirement</span><span class="p">(</span><span class="s1">'foo&gt;=1.0,&lt;2.0'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">req</span><span class="o">.</span><span class="n">name</span>
<span class="s1">'foo'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">req</span><span class="o">.</span><span class="n">specifier</span>
<span class="p">[(</span><span class="s1">'&gt;='</span><span class="p">,</span> <span class="s1">'1.0'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'&lt;'</span><span class="p">,</span> <span class="s1">'2.0'</span><span class="p">)]</span>
</pre>
<p>Requirements play well with packages. Using the Python operator <tt>in</tt>, you
can check if a package satifies a requirement.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">req</span> <span class="o">=</span> <span class="n">Requirement</span><span class="p">(</span><span class="s1">'foo&gt;=1.0'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo==1.0'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">req</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo==2.0'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">req</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Package</span><span class="p">(</span><span class="s1">'foo==0.1'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">req</span>
<span class="bp">False</span>
</pre>
</div>
</div>
</div></body></html>