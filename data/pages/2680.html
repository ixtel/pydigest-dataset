<html><body><div><div class="col-md-8 post-inside">
    <header class="post-title">
        <h1>Django with time zone support and MySQL</h1>
    </header>
            <hr class="hr-special"/>
                

             <hr class="hr-special"/>
            <p><a rel="nofollow" href="https://www.djangoproject.com/" target="_blank"><img class="alignright size-full wp-image-27831 alignnone" src="https://www.percona.com/blog/wp-content/uploads/2014/12/Screen-Shot-2014-12-31-at-12.30.42-PM.png" alt="Django"/></a> This is yet another story of Django web-framework with time zone support and pain dealing with python datetimes and MySQL on the backend. In other words, offset-naive vs offset-aware datetimes.</p>
<p>Shortly, more about the problem. After reading the official <a rel="nofollow" href="https://docs.djangoproject.com/en/1.7/topics/i18n/timezones/" target="_blank">documentation</a> about the time zones, it makes clear that in order to reflect python datetime in the necessary time zone you need to make it tz-aware first and than show in that time zone.</p>
<p>Here is the first issue: tz-aware in what time zone? MySQL stores timestamps in UTC and converts for storage/retrieval from/to the current time zone. By default, the current time zone is the server’s time, can be changed on MySQL globally, per connection etc. So it becomes not obvious what was tz of the value initially before stored in UTC. If you change server or session tz further, it will lead to more mess. Unlike MySQL, PostgreSQL has <a rel="nofollow" href="http://www.postgresql.org/docs/9.4/static/datatype-datetime.html" target="_blank">timestamp with time zone</a> data type, so Django can auto-detect tz and make datetimes tz-aware automatically featuring tzinfo attribute.</p>
<p>There are many solutions on the web… for example an extension to detect tz on UI by Javascript and pass back to the backend allowing you to work with tz-aware data, however, I need something simpler but mainly with less changes to the existing code base.</p>
<p>Here is my case. The server and MySQL are on UTC. That’s cool and it cuts off the first barrier. I store python datetimes in MySQL timespamp columns also in UTC per database time. Anyway, it is a best practice to store time in UTC. I have some read-only pages on the web app and want to show datetimes according to user’s tz. Looks to be a simple task but dealing with MySQL on backend, all my data coming from models have a naive datetime type assigned. So I need to find a way to easily make all my DateTimeField fields UTC-aware (add tzinfo attribute) and some convenient method of showing datetimes in user’s tz still having an access to UTC or naive datetimes for calculation on the backned. Therefore, I will be still doing all the calculation in UTC and showing TZ-aware values to users only on UI side.</p>
<p>This is an example of middleware that gets user’s tz from the database and sets in the session, so it can be retrieved anywhere using get_current_timezone():</p>
		<div id="crayon-56d5b72f5aaa6193016746" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-2">2</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-4">4</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-6">6</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-8">8</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-10">10</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-12">12</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-14">14</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-16">16</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-18">18</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-20">20</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-22">22</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aaa6193016746-24">24</p><p class="crayon-num" data-line="crayon-56d5b72f5aaa6193016746-25">25</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">timezone </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">activate</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">myapp</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">UserInfo</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-4"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TimezoneMiddleware</span><span class="crayon-sy">(</span><span class="crayon-k ">object</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-5">    <span class="crayon-s">"""Middleware that is run on each request before the view is executed.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-6"> </p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-7"><span class="crayon-s">    Activate user's timezone for further retrieval by get_current_timezone() or</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-8"><span class="crayon-s">    creating tz-aware datetime objects beforehand.</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-9"><span class="crayon-s">    """</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-10">   <span class="crayon-h"> </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">process_request</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-11">       <span class="crayon-h"> </span><span class="crayon-v">session_tz</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'timezone'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-12"><span class="crayon-h">        </span><span class="crayon-c"># If tz has been already set in session, let's activate it</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-13"><span class="crayon-h">        </span><span class="crayon-c"># and avoid SQL query to retrieve it on each request.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-14">       <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">session_tz</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-15">           <span class="crayon-h"> </span><span class="crayon-e">activate</span><span class="crayon-sy">(</span><span class="crayon-v">session_tz</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-16">       <span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-17">           <span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-18">               <span class="crayon-h"> </span><span class="crayon-c"># Get user's tz from the database.</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-19">               <span class="crayon-h"> </span><span class="crayon-v">uinfo</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">UserInfo</span><span class="crayon-sy">.</span><span class="crayon-v">objects</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">user_id</span><span class="crayon-o">=</span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-k ">user</span><span class="crayon-sy">.</span><span class="crayon-k ">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">user_id__isnull</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-20">               <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">uinfo</span><span class="crayon-sy">.</span><span class="crayon-v">timezone</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-21"><span class="crayon-h">                    </span><span class="crayon-c"># If tz is configured by user, let's set it for the session.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-22">                   <span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">session</span><span class="crayon-sy">[</span><span class="crayon-s">'timezone'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">uinfo</span><span class="crayon-sy">.</span><span class="crayon-i">timezone</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-23">                   <span class="crayon-h"> </span><span class="crayon-e">activate</span><span class="crayon-sy">(</span><span class="crayon-v">uinfo</span><span class="crayon-sy">.</span><span class="crayon-v">timezone</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aaa6193016746-24">           <span class="crayon-h"> </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">UserInfo</span><span class="crayon-sy">.</span><span class="crayon-v">DoesNotExist</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b72f5aaa6193016746-25">               <span class="crayon-h"> </span><span class="crayon-r">pass</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This is an excerpt from models.py:</p>
		<div id="crayon-56d5b72f5aab8031948191" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-2">2</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-4">4</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-6">6</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-8">8</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-10">10</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-12">12</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-14">14</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-16">16</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-18">18</p><p class="crayon-num" data-line="crayon-56d5b72f5aab8031948191-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b72f5aab8031948191-20">20</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">db </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">models</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">timezone </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">get_current_timezone</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">make_aware</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">utc</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-4"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">localize_datetime</span><span class="crayon-sy">(</span><span class="crayon-v">dtime</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-5">   <span class="crayon-h"> </span><span class="crayon-s">"""Makes DateTimeField value UTC-aware and returns datetime string localized</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-6"><span class="crayon-s">    in user's timezone in ISO format.</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-7"><span class="crayon-s">    """</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-8"><span class="crayon-h">  </span> <span class="crayon-h"> </span><span class="crayon-v">tz_aware</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_aware</span><span class="crayon-sy">(</span><span class="crayon-v">dtime</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">utc</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">astimezone</span><span class="crayon-sy">(</span><span class="crayon-e">get_current_timezone</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-9">   <span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-v">tz_aware</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m-%d %H:%M:%S'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-10"> </p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-11"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Messages</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-v">Model</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-12">   <span class="crayon-h"> </span><span class="crayon-k ">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">AutoField</span><span class="crayon-sy">(</span><span class="crayon-v">primary_key</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-13">   <span class="crayon-h"> </span><span class="crayon-v">body</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">CharField</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">=</span><span class="crayon-cn">160L</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-14">   <span class="crayon-h"> </span><span class="crayon-v">created</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">DateTimeField</span><span class="crayon-sy">(</span><span class="crayon-v">auto_now_add</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-15"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-16"><span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-k ">property</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-17">   <span class="crayon-h"> </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">created_tz</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-18"><span class="crayon-h">    </span>   <span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">localize_datetime</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">created</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b72f5aab8031948191-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aab8031948191-20"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>“Messages” model has “created” field (timestamp in MySQL) and a property “created_tz”. That property reflects “created” in user’s tz using the function localize_datetime() which makes naive datetimes tz(UTC)-aware, converts into user’s tz set on the session level and returns a string in ISO format. In my case, I don’t prefer the default RFC format that includes +00:00 tz portion of datetime with tzinfo attribute or even need tz-aware datetimes to operate with. Same way I can have similar properties in all needed models knowing they can be accessed by the same name with “_tz” suffix.</p>
<p>Taking into account the above, I reference “created” for calculations in views or controllers and “created_tz” in templaetes or for JSON-output.  This way I don’t need to change all references of “created” to something like “make_aware(created, utc)” or datetime.datetime.utcnow() to datetime.datetime.utcnow().replace(tzinfo=pytz.utc) across the code. The code changes in my app will be minimal by introducing a custom property in the model and continue operating with UTC on the raw level:</p>
		<div id="crayon-56d5b72f5aac3688594584" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b72f5aac3688594584-1"><span class="crayon-c"># views.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aac3688594584-2"><span class="crayon-c"># Operating UTC</span></p><p class="crayon-line" id="crayon-56d5b72f5aac3688594584-3"><span class="crayon-v">msgs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Messages</span><span class="crayon-sy">.</span><span class="crayon-v">objects</span><span class="crayon-sy">.</span><span class="crayon-k ">filter</span><span class="crayon-sy">(</span><span class="crayon-v">created__gt</span><span class="crayon-o">=</span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">now</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aac3688594584-4"><span class="crayon-h">                               </span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">timedelta</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-o">=</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
		<div id="crayon-56d5b72f5aacb732831553" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b72f5aacb732831553-1"><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">HTML</span><span class="crayon-h"> </span><span class="crayon-e">template</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aacb732831553-2"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">msgs</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b72f5aacb732831553-3"><span class="crayon-h">    </span><span class="crayon-sy">{</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-k ">id</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-i">body</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">added</span><span class="crayon-h"> </span><span class="crayon-e">on</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-v">created</span><span class="crayon-sy">_</span>tz<span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b72f5aacb732831553-4"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">endfor</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b72f5aacb732831553-5"><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-k ">All</span><span class="crayon-h"> </span><span class="crayon-e">times </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">user</span>'<span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-v">tz</span><span class="crayon-sy">.</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>I hope this article may help in your findings.<br/>
Happy New Year across all time zones!</p>

<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p>            <hr class="hr-special"/>
                <div class="co-author-wrap-bottom co-author-number-1"><hr class="hr-special"/><a href="/blog/author/weber/" class="co-author-display-name">Roman Vynar</a><p class="co-author-bio">Roman is a Lead Platform Engineer at Percona. He joined the company to establish and develop Remote DBA service from scratch. Over time the growing service successfully expanded to Managed Services. Roman's duties include the development of monitoring tools, automated scripts, backup solution, notification and incident tracking web system. He has 15+ years of professional experience in IT, engineering and development. Also Roman maintains Percona Monitoring Plugins open source project.</p><hr class="hr-special"/></div>
            <hr class="hr-special"/>
            <h5>Tags:</h5><p> <a href="https://www.percona.com/blog/tag/datetimes/" rel="tag">datetimes</a>, <a href="https://www.percona.com/blog/tag/django/" rel="tag">Django</a>, <a href="https://www.percona.com/blog/tag/mysql/" rel="tag">MySQL</a>, <a href="https://www.percona.com/blog/tag/offset-aware-datetimes/" rel="tag">offset-aware datetimes</a>, <a href="https://www.percona.com/blog/tag/offset-naive-datetimes/" rel="tag">offset-naive datetimes</a>, <a href="https://www.percona.com/blog/tag/postgresql/" rel="tag">PostgreSQL</a>, <a href="https://www.percona.com/blog/tag/primary/" rel="tag">Primary</a>, <a href="https://www.percona.com/blog/tag/python/" rel="tag">Python</a>, <a href="https://www.percona.com/blog/tag/roman-vynar/" rel="tag">Roman Vynar</a>, <a href="https://www.percona.com/blog/tag/time-zone/" rel="tag">Time zone</a>, <a href="https://www.percona.com/blog/tag/tz-aware/" rel="tag">tz-aware</a></p>            <h5>Categories: </h5><a href="https://www.percona.com/blog/category/developer-insight/">Insight for Developers</a><p>,
	</p><a href="https://www.percona.com/blog/category/mysql/" title="Category to track posts in PlanetMySQL">MySQL</a>
            
            
        </div>
                </div></body></html>