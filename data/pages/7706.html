<html><body><div><section class="post-content">
            <p>The Python <a href="http://www.scipy.org/about.html">scientific stack</a> is fairly mature, and there are libraries for a variety of use cases, including <a href="http://scikit-learn.org/">machine learning</a>, and <a href="http://pandas.pydata.org/">data analysis</a>.  Data visualization is an important part of being able to explore data and communicate results, but has lagged a bit behind other tools such as R in the past.</p>

<p>Luckily, many new Python data visualization libraries have been created in the past few years to close the gap.  <a href="http://matplotlib.org/index.html">matplotlib</a> has emerged as the main data visualization library, but there are also libraries such as <a href="http://vispy.org/">vispy</a>, <a href="http://bokeh.pydata.org/en/latest/">bokeh</a>, <a href="http://stanford.edu/~mwaskom/software/seaborn/">seaborn</a>, <a href="https://github.com/Kozea/pygal">pygal</a>, <a href="https://github.com/python-visualization/folium">folium</a>, and <a href="https://github.com/networkx/networkx">networkx</a> that either build on matplotlib or have functionality that it doesn’t support.</p>

<p>In this post, we’ll use a real-world dataset, and use each of these libraries to make visualizations.  As we do that, we’ll discover what areas each library is best in, and how to leverage the Python data visualization ecosystem most effectively.  </p>

<p>At <a href="https://www.dataquest.io">Dataquest</a>, we’ve built an interactive course that teaches you about Python data visualization tools.  If you want to learn in more depth, check it out <a href="https://www.dataquest.io/section/data-visualization">here</a>.</p>

<h2 id="exploring-the-dataset">Exploring the dataset</h2>

<p>Before we dive into visualizing the data, let’s take a quick look at the dataset we’ll be working with.  We’ll be using data from <a href="http://openflights.org/data.html">openflights</a>.  We’ll be using <a href="http://openflights.org/data.html#route">route</a>, <a href="http://openflights.org/data.html#airport">airport</a>, and <a href="http://openflights.org/data.html#airline">airline</a> data.  Each row in the route data corresponds to an airline route between two airports.  Each row in the airport data corresponds to an airport in the world, and has information about it.  Each row in the airline data represents a single airline.</p>

<p>We first read in the data:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Import the pandas library.</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="c"># Read in the airports data.</span>
<span class="n">airports</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"airports.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">airports</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">,</span> <span class="s">"city"</span><span class="p">,</span> <span class="s">"country"</span><span class="p">,</span> <span class="s">"code"</span><span class="p">,</span> <span class="s">"icao"</span><span class="p">,</span> <span class="s">"latitude"</span><span class="p">,</span> <span class="s">"longitude"</span><span class="p">,</span> <span class="s">"altitude"</span><span class="p">,</span> <span class="s">"offset"</span><span class="p">,</span> <span class="s">"dst"</span><span class="p">,</span> <span class="s">"timezone"</span><span class="p">]</span>
<span class="c"># Read in the airlines data.</span>
<span class="n">airlines</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"airlines.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">airlines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">,</span> <span class="s">"alias"</span><span class="p">,</span> <span class="s">"iata"</span><span class="p">,</span> <span class="s">"icao"</span><span class="p">,</span> <span class="s">"callsign"</span><span class="p">,</span> <span class="s">"country"</span><span class="p">,</span> <span class="s">"active"</span><span class="p">]</span>
<span class="c"># Read in the routes data.</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"routes.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">routes</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"airline"</span><span class="p">,</span> <span class="s">"airline_id"</span><span class="p">,</span> <span class="s">"source"</span><span class="p">,</span> <span class="s">"source_id"</span><span class="p">,</span> <span class="s">"dest"</span><span class="p">,</span> <span class="s">"dest_id"</span><span class="p">,</span> <span class="s">"codeshare"</span><span class="p">,</span> <span class="s">"stops"</span><span class="p">,</span> <span class="s">"equipment"</span><span class="p">]</span></code></pre></div>

<p>The data doesn’t have column headers, so we add them in by assigning to the <code>columns</code> attribute.  We want to read every column in as a string – this will make comparing across dataframes easier later, when we want to match rows based on id.  We do this by setting the <code>dtype</code> parameter when reading in the data.</p>

<p>We can take a quick look at each dataframe:</p>



<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th/>
      <th>id</th>
      <th>name</th>
      <th>city</th>
      <th>country</th>
      <th>code</th>
      <th>icao</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>altitude</th>
      <th>offset</th>
      <th>dst</th>
      <th>timezone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 1</td>
      <td>                     Goroka</td>
      <td>       Goroka</td>
      <td> Papua New Guinea</td>
      <td> GKA</td>
      <td> AYGA</td>
      <td>-6.081689</td>
      <td> 145.391881</td>
      <td> 5282</td>
      <td> 10</td>
      <td> U</td>
      <td> Pacific/Port_Moresby</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 2</td>
      <td>                     Madang</td>
      <td>       Madang</td>
      <td> Papua New Guinea</td>
      <td> MAG</td>
      <td> AYMD</td>
      <td>-5.207083</td>
      <td> 145.788700</td>
      <td>   20</td>
      <td> 10</td>
      <td> U</td>
      <td> Pacific/Port_Moresby</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 3</td>
      <td>                Mount Hagen</td>
      <td>  Mount Hagen</td>
      <td> Papua New Guinea</td>
      <td> HGU</td>
      <td> AYMH</td>
      <td>-5.826789</td>
      <td> 144.295861</td>
      <td> 5388</td>
      <td> 10</td>
      <td> U</td>
      <td> Pacific/Port_Moresby</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 4</td>
      <td>                     Nadzab</td>
      <td>       Nadzab</td>
      <td> Papua New Guinea</td>
      <td> LAE</td>
      <td> AYNZ</td>
      <td>-6.569828</td>
      <td> 146.726242</td>
      <td>  239</td>
      <td> 10</td>
      <td> U</td>
      <td> Pacific/Port_Moresby</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 5</td>
      <td> Port Moresby Jacksons Intl</td>
      <td> Port Moresby</td>
      <td> Papua New Guinea</td>
      <td> POM</td>
      <td> AYPY</td>
      <td>-9.443383</td>
      <td> 147.220050</td>
      <td>  146</td>
      <td> 10</td>
      <td> U</td>
      <td> Pacific/Port_Moresby</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th/>
      <th>id</th>
      <th>name</th>
      <th>alias</th>
      <th>iata</th>
      <th>icao</th>
      <th>callsign</th>
      <th>country</th>
      <th>active</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 1</td>
      <td>                               Private flight</td>
      <td> \N</td>
      <td>   -</td>
      <td> NaN</td>
      <td>     NaN</td>
      <td>            NaN</td>
      <td> Y</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 2</td>
      <td>                                  135 Airways</td>
      <td> \N</td>
      <td> NaN</td>
      <td> GNL</td>
      <td> GENERAL</td>
      <td>  United States</td>
      <td> N</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 3</td>
      <td>                                1Time Airline</td>
      <td> \N</td>
      <td>  1T</td>
      <td> RNX</td>
      <td> NEXTIME</td>
      <td>   South Africa</td>
      <td> Y</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 4</td>
      <td> 2 Sqn No 1 Elementary Flying Training School</td>
      <td> \N</td>
      <td> NaN</td>
      <td> WYT</td>
      <td>     NaN</td>
      <td> United Kingdom</td>
      <td> N</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 5</td>
      <td>                              213 Flight Unit</td>
      <td> \N</td>
      <td> NaN</td>
      <td> TFU</td>
      <td>     NaN</td>
      <td>         Russia</td>
      <td> N</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th/>
      <th>airline</th>
      <th>airline_id</th>
      <th>source</th>
      <th>source_id</th>
      <th>dest</th>
      <th>dest_id</th>
      <th>codeshare</th>
      <th>stops</th>
      <th>equipment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 2B</td>
      <td> 410</td>
      <td> AER</td>
      <td> 2965</td>
      <td> KZN</td>
      <td> 2990</td>
      <td> NaN</td>
      <td> 0</td>
      <td> CR2</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 2B</td>
      <td> 410</td>
      <td> ASF</td>
      <td> 2966</td>
      <td> KZN</td>
      <td> 2990</td>
      <td> NaN</td>
      <td> 0</td>
      <td> CR2</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 2B</td>
      <td> 410</td>
      <td> ASF</td>
      <td> 2966</td>
      <td> MRV</td>
      <td> 2962</td>
      <td> NaN</td>
      <td> 0</td>
      <td> CR2</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 2B</td>
      <td> 410</td>
      <td> CEK</td>
      <td> 2968</td>
      <td> KZN</td>
      <td> 2990</td>
      <td> NaN</td>
      <td> 0</td>
      <td> CR2</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 2B</td>
      <td> 410</td>
      <td> CEK</td>
      <td> 2968</td>
      <td> OVB</td>
      <td> 4078</td>
      <td> NaN</td>
      <td> 0</td>
      <td> CR2</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can do a variety of interesting explorations with each dataset individually, but it’s through combining them that we’ll see the most gains.  Pandas will aid us as we do our analysis because it can easily filter matrices or apply functions across them.  We’ll dive into a few interesting metrics, such as analyzing airlines and routes.</p>

<p>Before we can do so, we need to do a bit of data cleaning:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">routes</span> <span class="o">=</span> <span class="n">routes</span><span class="p">[</span><span class="n">routes</span><span class="p">[</span><span class="s">"airline_id"</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"</span><span class="se">\\</span><span class="s">N"</span><span class="p">]</span></code></pre></div>

<p>This line ensures that we have only numeric data in the <code>airline_id</code> column.</p>

<h1 id="making-a-histogram">Making a histogram</h1>

<p>Now that we understand the structure of the data, we can go ahead and start making plots to explore it.  For our first plot, we’ll use matplotlib.  matplotlib is a relatively low-level plotting library in the Python stack, so it generally takes more commands to make nice-looking plots than it does with other libraries.  On the other hand, you can make almost any kind of plot with matplotlib.  It’s very flexible, but that flexibility comes at the cost of verbosity.</p>

<p>We’ll first make a histogram showing the distribution of route lengths by airlines.  A <a href="https://en.wikipedia.org/wiki/Histogram">histogram</a> divides all the route lengths into ranges (or “bins”), and counts how many routes fall into each range.  This can tell us if airlines fly more shorter routes, or more longer ones.</p>

<p>In order to do this, we need to first calculate route lengths.  The first step is a distance formula.  We’ll use haversine distance, which calculates the distance between latitude, longitude pairs.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">haversine</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">):</span>
    <span class="c"># Convert coordinates to floats.</span>
    <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">lon1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lon2</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat2</span><span class="p">)]</span>
    <span class="c"># Convert to radians from degrees.</span>
    <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">,</span> <span class="p">[</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">])</span>
    <span class="c"># Compute distance.</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span> 
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span> 
    <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> 
    <span class="n">km</span> <span class="o">=</span> <span class="mi">6367</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">km</span></code></pre></div>

<p>Then we can make a function that calculates distance between the <code>source</code> and <code>dest</code> airports for a single route.  To do this, we need to get the <code>source_id</code> and <code>dest_id</code> airports from the routes dataframe, then match them up with the <code>id</code> column in the <code>airports</code> dataframe to get the latitude and longitude of those airports.  Then, it’s just a matter of doing the calculation.  Here’s the function:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">calc_dist</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Match source and destination to get coordinates.</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">airports</span><span class="p">[</span><span class="n">airports</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">"source_id"</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">airports</span><span class="p">[</span><span class="n">airports</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">"dest_id"</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># Use coordinates to compute distance.</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">haversine</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">],</span> <span class="n">dest</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">dist</span></code></pre></div>

<p>The function can fail if there’s an invalid value in the <code>source_id</code> or <code>dest_id</code> columns, so we’ll add in a <code>try/except</code> block to catch these.</p>

<p>Finally, we’ll use pandas to apply the distance calculation function across the <code>routes</code> dataframe.  This will give us a pandas series containing all the route lengths.  The route lengths are all in kilometers.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">route_lengths</span> <span class="o">=</span> <span class="n">routes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calc_dist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code></pre></div>

<p>Now that we have a series of route lengths, we can create a histogram, which will bin the values into ranges and count how many routes fall into each range:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">route_lengths</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code></pre></div>



<p>We import the matplotlib plotting functions with <code>import matplotlib.pyplot as plt</code>.  We then setup matplotlib to show plots in an ipython notebook with <code>%matplotlib inline</code>.  Finally, we can make a histogram with <code>plt.hist(route_lengths, bins=20)</code>.  As we can see, airlines fly more short routes than long routes.</p>

<h1 id="using-seaborn">Using Seaborn</h1>

<p>We can make a similar plot with seaborn, a higher-level plotting library for Python.  Seaborn builds on matplotlib and makes certain types of plots, usually having to do with statistical work, simpler.  We can use the <code>distplot</code> function to plot a histogram with a kernel density estimate on top of it.  A kernel density estimate is a curve – essentially a smoothed version of the histogram that’s easier to see patterns in.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">seaborn</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">route_lengths</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code></pre></div>



<p>As you can see, seaborn also has nicer default styles than matplotlib.  Seaborn doesn’t have its own version of all the matplotlib plots, but it’s a nice way to quickly get nice-looking plots that go into more depth than default matplotlib charts.  It’s also a good library if you need to go more into depth and do more statistical work.</p>

<h1 id="bar-charts">Bar charts</h1>

<p>Histograms are great, but maybe we want to see the average route length by airline.  We can instead use a bar chart – this will have an individual bar for each airline, telling us the average length by airline.  This will let us see which carriers are regional, and which are international.  We can use pandas, a python data analysis library, to figure out the average route length per airline.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span>

<span class="c"># Put relevant columns into a dataframe.</span>
<span class="n">route_length_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">"length"</span><span class="p">:</span> <span class="n">route_lengths</span><span class="p">,</span> <span class="s">"id"</span><span class="p">:</span> <span class="n">routes</span><span class="p">[</span><span class="s">"airline_id"</span><span class="p">]})</span>
<span class="c"># Compute the mean route length per airline.</span>
<span class="n">airline_route_lengths</span> <span class="o">=</span> <span class="n">route_length_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="c"># Sort by length so we can make a better chart.</span>
<span class="n">airline_route_lengths</span> <span class="o">=</span> <span class="n">airline_route_lengths</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">"length"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>

<p>We first make a new dataframe with the route lengths and the airline ids.  We split <code>route_length_df</code>  into groups based on the <code>airline_id</code>, essentially making one dataframe per airline.  We then use the pandas <code>aggregate</code> function to take the mean of the <code>length</code> column in each airline dataframe, and recombine each result into a new dataframe.  We then sort the dataframe so that the airlines with the most routes come first.</p>

<p>We can then plot this out with matplotlib:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">airline_route_lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">airline_route_lengths</span><span class="p">[</span><span class="s">"length"</span><span class="p">])</span></code></pre></div>



<p>The matplotlib <code>plt.bar</code> method plots each airline against the average route length each airline flies(<code>airline_route_lengths["length"]</code>).</p>

<p>The problem with the plot above is that we can’t easily see which airline has what route length.  In order to do this, we’ll need to be able to see the axis labels.  This is a bit tough since there are so many airlines.  One way to make this easier to work with is to make the plot interactive, which will allow us to zoom in and out to see the labels.  We can use the bokeh library for this – it makes it simple to make interactive, zoomable plots.</p>

<p>To use bokeh, we’ll need to preprocess our data first:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">lookup_name</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Match the row id to the id in the airlines dataframe so we can get the name.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">airlines</span><span class="p">[</span><span class="s">"name"</span><span class="p">][</span><span class="n">airlines</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">"id"</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">return</span> <span class="n">name</span>

<span class="c"># Add the index (the airline ids) as a column.</span>
<span class="n">airline_route_lengths</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">airline_route_lengths</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c"># Find all the airline names.</span>
<span class="n">airline_route_lengths</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">airline_route_lengths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">lookup_name</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c"># Remove duplicate values in the index.</span>
<span class="n">airline_route_lengths</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">airline_route_lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></code></pre></div>

<p>The code above will get the names for each row in <code>airline_route_lengths</code>, and add in the <code>name</code> column, which contains the name of each airline.  We also add in the <code>id</code> column so we can do this lookup (the apply function doesn’t pass in an index).</p>

<p>Finally, we reset the index column to have all unique values.  Bokeh doesn’t work properly without this.</p>

<p>Now, we can move on to the charting piece:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.charts</span> <span class="kn">import</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">show</span>

<span class="n">output_notebook</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">airline_route_lengths</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s">'length'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"Average airline route lengths"</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code></pre></div>

<p>We call <code>output_notebook</code> to setup bokeh to show a plot in an ipython notebook.  Then, we make a bar plot, using our dataframe and certain columns.  Finally, the <code>show</code> function shows the plot.</p>

<p>The plot isn’t an image – it’s actually a javascript widget.  Because of this, we’re showing a screenshot below instead of the actual chart.</p>



<p>With this, we can zoom in and see which airlines fly the longest routes.  The image above makes the labels looked crunched together, but they are much easier to see as you zoom in.</p>

<h1 id="horizontal-bar-charts">Horizontal bar charts</h1>

<p>Pygal is a python data analysis library that makes attractive charts quickly.  We can use it to make a breakdown of routes by length.  We’ll first divide our routes into short, medium, and long, and calculate the percentage of each in our <code>route_lengths</code>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">long_routes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">route_lengths</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">route_lengths</span><span class="p">)</span>
<span class="n">medium_routes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">route_lengths</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">10000</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">route_lengths</span><span class="p">)</span>
<span class="n">short_routes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">route_lengths</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">route_lengths</span><span class="p">)</span></code></pre></div>

<p>We can then plot each one as a bar in a pygal horizontal bar chart:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pygal</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">pygal</span><span class="o">.</span><span class="n">HorizontalBar</span><span class="p">()</span>
<span class="n">chart</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">'Long, medium, and short routes'</span>
<span class="n">chart</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">'Long'</span><span class="p">,</span> <span class="n">long_routes</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">chart</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">'Medium'</span><span class="p">,</span> <span class="n">medium_routes</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">chart</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">'Short'</span><span class="p">,</span> <span class="n">short_routes</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">chart</span><span class="o">.</span><span class="n">render_to_file</span><span class="p">(</span><span class="s">'routes.svg'</span><span class="p">)</span>
<span class="n">SVG</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">'routes.svg'</span><span class="p">)</span></code></pre></div>



<p>Above, we first create an empty chart.  Then, we add elements, including a title and bars.  Each bar is passed a percentage value (out of <code>100</code>) showing how common that type of route is.</p>

<p>Finally, we render the chart to a file, and use IPython’s SVG display capabilities to load and show the file.  This plot looks quite a bit nicer than the default matplotlib charts, but we did need to write more code to create it.  Pygal may be good for small presentation-quality graphics.</p>

<h1 id="scatter-plots">Scatter plots</h1>

<p>Scatter plots enable us to compare columns of data.  We can make a simple scatter plot to compare airline id number to length of airline names:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">name_lengths</span> <span class="o">=</span> <span class="n">airlines</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">airlines</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">name_lengths</span><span class="p">)</span></code></pre></div>



<p>First we calculate the length of each name by using the pandas <code>apply</code> method.  This will find the number of characters long each airline name is.</p>

<p>We then make a scatter plot comparing the airline ids to the name lengths using matplotlib.  When we plot, we convert the <code>id</code> column of <code>airlines</code> to an integer type.  If we don’t do this, the plot won’t work, as it needs numeric values on the x-axis.  We can see that quite a few of the longer names appear in the earlier ids.  This may mean that airlines founded earlier tend to have longer names.</p>

<p>We can verify this hunch using seaborn.  Seaborn has an augmented version of a scatterplot, a joint plot, that shows how correlated the two variables are, as well as the individual distributions of each.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">"lengths"</span><span class="p">:</span> <span class="n">name_lengths</span><span class="p">,</span> <span class="s">"ids"</span><span class="p">:</span> <span class="n">airlines</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)})</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">"ids"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"lengths"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span></code></pre></div>



<p>The above plot shows that there isn’t any real correlation between the two variables – the r squared value is low.</p>

<h1 id="static-maps">Static maps</h1>

<p>Our data is inherently a good fit for mapping – we have latitude and longitude pairs for airports, and for source and destination airports.</p>

<p>The first map we can make is one that shows all the airports all over the world.  We can do this with the <a href="http://matplotlib.org/basemap/">basemap</a> extension to matplotlib.  This enables drawing world maps and adding points, and is very customizable.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Import the basemap package</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>

<span class="c"># Create a map on which to draw.  We're using a mercator projection, and showing the whole world.</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">'merc'</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">llcrnrlon</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">lat_ts</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="s">'c'</span><span class="p">)</span>
<span class="c"># Draw coastlines, and the edges of the map.</span>
<span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">()</span>
<span class="c"># Convert latitude and longitude to x and y coordinates</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">airports</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">airports</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)))</span>
<span class="c"># Use matplotlib to draw the points onto the map.</span>
<span class="n">m</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">)</span>
<span class="c"># Show the plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

<p>In the above code, we first draw a map of the world, using a <a href="https://en.wikipedia.org/wiki/Mercator_projection">mercator projection</a>.  A mercator projection is a way to project the whole plot of the world onto a 2-d surface.  Then, we draw the airports on top of the map, using red dots.</p>



<p>The problem with the above map is that it’s hard to see where each airport is – they just kind of merge into a red blob in areas with high airport density.</p>

<p>Just like with bokeh, there’s an interactive mapping library, folium, we can use to zoom into the map and help us find individual airports.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">folium</span>

<span class="c"># Get a basic world map.</span>
<span class="n">airports_map</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c"># Draw markers on the map.</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">airports</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c"># For some reason, this one airport causes issues with the map.</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"South Pole Station"</span><span class="p">:</span>
        <span class="n">airports_map</span><span class="o">.</span><span class="n">circle_marker</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]],</span> <span class="n">popup</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">"name"</span><span class="p">])</span>
<span class="c"># Create and show the map.</span>
<span class="n">airports_map</span><span class="o">.</span><span class="n">create_map</span><span class="p">(</span><span class="s">'airports.html'</span><span class="p">)</span>
<span class="n">airports_map</span></code></pre></div>



<p>Folium uses leaflet.js to make a fully interactive map.  You can click on each airport to see the name in the popup.  A screenshot is shown above, but the actual map is much more impressive.  Folium also lets you modify options pretty extensively to make nicer markers, or add more things to the map.</p>

<h1 id="drawing-great-circles">Drawing great circles</h1>

<p>It would be pretty cool to see all the air routes on a map.  Luckily, we can use basemap to do this.  We’ll draw <a href="https://en.wikipedia.org/wiki/Great_circle">great circles</a> connecting source and destination airports.  Each circle will show the route of a single airliner.  Unfortunately, there are so many routes that showing them all would be a mess.  Instead, we’ll show the first <code>3000</code> routes.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Make a base map with a mercator projection.  Draw the coastlines.</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">'merc'</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="o">=-</span><span class="mi">80</span><span class="p">,</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">llcrnrlon</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">lat_ts</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="s">'c'</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>

<span class="c"># Iterate through the first 3000 rows.</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">[:</span><span class="mi">3000</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Get the source and dest airports.</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">airports</span><span class="p">[</span><span class="n">airports</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">"source_id"</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">airports</span><span class="p">[</span><span class="n">airports</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">"dest_id"</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># Don't draw overly long routes.</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">])</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="c"># Draw a great circle between source and dest airports.</span>
            <span class="n">m</span><span class="o">.</span><span class="n">drawgreatcircle</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dest</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]),</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="k">pass</span>
    
<span class="c"># Show the map.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>



<p>The above code will draw a map, then draw the routes on top of it.  We add in some filters to prevent overly long routes from obscuring the others.</p>

<h1 id="drawing-network-diagrams">Drawing network diagrams</h1>

<p>The final exploration we’ll do is drawing a network diagram of airports.  Each airport will be a node in the network, and we’ll draw edges between nodes if there’s a route between the airports.  If there are multiple routes, we’ll add to the edge weight, to show that the airports are more connected.  We’ll use the networkx library to do this.</p>

<p>First, we’ll need to compute the edge weights between airports.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Initialize the weights dictionary.</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c"># Keep track of keys that have been added once -- we only want edges with a weight of more than 1 to keep our network size manageable.</span>
<span class="n">added_keys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c"># Iterate through each route.</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">routes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c"># Extract the source and dest airport ids.</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"source_id"</span><span class="p">]</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"dest_id"</span><span class="p">]</span>
    
    <span class="c"># Create a key for the weights dictionary.</span>
    <span class="c"># This corresponds to one edge, and has the start and end of the route.</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s">"{0}_{1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
    <span class="c"># If the key is already in weights, increment the weight.</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c"># If the key is in added keys, initialize the key in the weights dictionary, with a weight of 2.</span>
    <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">added_keys</span><span class="p">:</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c"># If the key isn't in added_keys yet, append it.</span>
    <span class="c"># This ensures that we aren't adding edges with a weight of 1.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">added_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code></pre></div>

<p>Once the above code finishes running, the weights dictionary contains every edge between two airports that has a weight higher than 2.  So any airports that are connected by 2 or more routes will appear.</p>

<p>Now, we need to draw the graph.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Import networkx and initialize the graph.</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="c"># Keep track of added nodes in this set so we don't add twice.</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="c"># Iterate through each edge.</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Split the source and dest ids and convert to integers.</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dest</span><span class="p">)]</span>
        <span class="c"># Add the source if it isn't in the nodes.</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="c"># Add the dest if it isn't in the nodes.</span>
        <span class="k">if</span> <span class="n">dest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="c"># Add both source and dest to the nodes set.</span>
        <span class="c"># Sets don't allow duplicates.</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        
        <span class="c"># Add the edge to the graph.</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

<span class="c"># Draw the nodes and edges.</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Show the plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>



<h1 id="conclusion">Conclusion</h1>

<p>There has been a proliferation of Python libraries for data visualization, and it’s possible to make almost any kind of visualization.  Most libraries build on matplotlib and make certain use cases simpler.  If you want to learn in more depth how to visualize data using matplotlib, seaborn, and other tools, check out our interactive course <a href="https://www.dataquest.io/section/data-visualization">here</a>.</p>

        </section>

        </div></body></html>