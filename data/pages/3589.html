<html><body><div><div dir="ltr" trbidi="on"><p>
You can read more/ about the generic gotchas associated with closures </p><a href="http://dietbuddha.blogspot.com/2012/03/closures-caveat-scriptor.html" target="_blank">here</a><p>.  The following are specific to closures as they are implemented in Python.

</p><b>Closure variables are read only</b><p>
In Python closures variables are readonly. This means the only way you can keep and modify state is by using an element in a mutable multi-element object like a dict or list. You cannot allocate a whole new list, dict, int, etc. So this won't work.

</p><pre class="brush: python">def mk_closure():
   storage=0
   def adder():
      storage+=1
      return storage
   return adder
</pre>
<p>
It will work if a list is used instead.

</p><pre class="brush: python">def mk_closure():
   storage=[0]
   def adder():
      storage[0]+=1
      return storage[0]
   return adder
</pre>

<b>Looping structures (for, while) do not have there own lexical environments </b><p>
Closures capture values from lexical environments. These are only created by executing a function which means this won't work:

</p><pre class="brush: python">functions=[]
storage=[0] * 5
for i in (1, 2, 3, 4, 5):
   def adder():
      storage[i-1] += i
      return storage[i-1]
   functions.append(adder)
</pre>
<p>
A lexical environment is needs to be created in every iteration that can be closed over.

</p><pre class="brush: python">functions=[]
storage=[0]*5
for i in (1, 2, 3, 4, 5):
   def helper(x):
      def adder():
         storage[x-1] += x
         return storage[0]
      return adder
   functions.append(helper(i))
</pre>
<p>
There is a shortcut in Python that eliminates the need to define the helper function.  This happens to work because the default value is set at definition time of the function which acts similarly to the function execution of helper.

</p><pre class="brush: python">functions=[]
storage=[0] * 5
for i in (1, 2, 3, 4, 5):
   def adder(x=i):
      storage[x-1] += x
      return storage[x-1]
   functions.append(adder)
</pre>

<p>
<b>§</b></p>
</div>
</div></body></html>