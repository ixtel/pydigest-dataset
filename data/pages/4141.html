<html><body><div><table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tr>
        <td id="L1" class="blob-num js-line-number" data-line-number="1"/>
        <td id="LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c">#!/usr/bin/env python</span></td>
      </tr>
      <tr>
        <td id="L2" class="blob-num js-line-number" data-line-number="2"/>
        <td id="LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># coding: utf-8</span></td>
      </tr>
      <tr>
        <td id="L3" class="blob-num js-line-number" data-line-number="3"/>
        <td id="LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># smj7.py | The Simple Media Jukebox, version 7</span></td>
      </tr>
      <tr>
        <td id="L4" class="blob-num js-line-number" data-line-number="4"/>
        <td id="LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Copyright 2010-2015 Sebastian Weigand, sab@sab.systems</span></td>
      </tr>
      <tr>
        <td id="L5" class="blob-num js-line-number" data-line-number="5"/>
        <td id="LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Licensed under the MIT license</span></td>
      </tr>
      <tr>
        <td id="L6" class="blob-num js-line-number" data-line-number="6"/>
        <td id="LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L7" class="blob-num js-line-number" data-line-number="7"/>
        <td id="LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># ==============================================================================</span></td>
      </tr>
      <tr>
        <td id="L8" class="blob-num js-line-number" data-line-number="8"/>
        <td id="LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Imports:</span></td>
      </tr>
      <tr>
        <td id="L9" class="blob-num js-line-number" data-line-number="9"/>
        <td id="LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># ==============================================================================</span></td>
      </tr>
      <tr>
        <td id="L10" class="blob-num js-line-number" data-line-number="10"/>
        <td id="LC10" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L11" class="blob-num js-line-number" data-line-number="11"/>
        <td id="LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Bits needed for basic functionality:</span></td>
      </tr>
      <tr>
        <td id="L12" class="blob-num js-line-number" data-line-number="12"/>
        <td id="LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> os</td>
      </tr>
      <tr>
        <td id="L13" class="blob-num js-line-number" data-line-number="13"/>
        <td id="LC13" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> sys</td>
      </tr>
      <tr>
        <td id="L14" class="blob-num js-line-number" data-line-number="14"/>
        <td id="LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> logging</td>
      </tr>
      <tr>
        <td id="L15" class="blob-num js-line-number" data-line-number="15"/>
        <td id="LC15" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L16" class="blob-num js-line-number" data-line-number="16"/>
        <td id="LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Datastore:</span></td>
      </tr>
      <tr>
        <td id="L17" class="blob-num js-line-number" data-line-number="17"/>
        <td id="LC17" class="blob-code blob-code-inner js-file-line"><span class="pl-k">import</span> sqlite3</td>
      </tr>
      <tr>
        <td id="L18" class="blob-num js-line-number" data-line-number="18"/>
        <td id="LC18" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L19" class="blob-num js-line-number" data-line-number="19"/>
        <td id="LC19" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Standard bits:</span></td>
      </tr>
      <tr>
        <td id="L20" class="blob-num js-line-number" data-line-number="20"/>
        <td id="LC20" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> argparse <span class="pl-k">import</span> ArgumentParser</td>
      </tr>
      <tr>
        <td id="L21" class="blob-num js-line-number" data-line-number="21"/>
        <td id="LC21" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> time <span class="pl-k">import</span> time, sleep</td>
      </tr>
      <tr>
        <td id="L22" class="blob-num js-line-number" data-line-number="22"/>
        <td id="LC22" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> scandir <span class="pl-k">import</span> walk</td>
      </tr>
      <tr>
        <td id="L23" class="blob-num js-line-number" data-line-number="23"/>
        <td id="LC23" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> itertools <span class="pl-k">import</span> imap</td>
      </tr>
      <tr>
        <td id="L24" class="blob-num js-line-number" data-line-number="24"/>
        <td id="LC24" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> math <span class="pl-k">import</span> log10</td>
      </tr>
      <tr>
        <td id="L25" class="blob-num js-line-number" data-line-number="25"/>
        <td id="LC25" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L26" class="blob-num js-line-number" data-line-number="26"/>
        <td id="LC26" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Keep this choice separate, as it conflicts with a named variable:</span></td>
      </tr>
      <tr>
        <td id="L27" class="blob-num js-line-number" data-line-number="27"/>
        <td id="LC27" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> random <span class="pl-k">import</span> choice <span class="pl-k">as</span> random_choice</td>
      </tr>
      <tr>
        <td id="L28" class="blob-num js-line-number" data-line-number="28"/>
        <td id="LC28" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> random <span class="pl-k">import</span> shuffle</td>
      </tr>
      <tr>
        <td id="L29" class="blob-num js-line-number" data-line-number="29"/>
        <td id="LC29" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L30" class="blob-num js-line-number" data-line-number="30"/>
        <td id="LC30" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Sub and multi-processing:</span></td>
      </tr>
      <tr>
        <td id="L31" class="blob-num js-line-number" data-line-number="31"/>
        <td id="LC31" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> subprocess <span class="pl-k">import</span> check_call, CalledProcessError</td>
      </tr>
      <tr>
        <td id="L32" class="blob-num js-line-number" data-line-number="32"/>
        <td id="LC32" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> multiprocessing <span class="pl-k">import</span> Pool</td>
      </tr>
      <tr>
        <td id="L33" class="blob-num js-line-number" data-line-number="33"/>
        <td id="LC33" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L34" class="blob-num js-line-number" data-line-number="34"/>
        <td id="LC34" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Data exporting:</span></td>
      </tr>
      <tr>
        <td id="L35" class="blob-num js-line-number" data-line-number="35"/>
        <td id="LC35" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> json <span class="pl-k">import</span> dumps</td>
      </tr>
      <tr>
        <td id="L36" class="blob-num js-line-number" data-line-number="36"/>
        <td id="LC36" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L37" class="blob-num js-line-number" data-line-number="37"/>
        <td id="LC37" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Metadata handling:</span></td>
      </tr>
      <tr>
        <td id="L38" class="blob-num js-line-number" data-line-number="38"/>
        <td id="LC38" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> mutagen.easymp4 <span class="pl-k">import</span> EasyMP4 <span class="pl-k">as</span> m4</td>
      </tr>
      <tr>
        <td id="L39" class="blob-num js-line-number" data-line-number="39"/>
        <td id="LC39" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> mutagen.easyid3 <span class="pl-k">import</span> EasyID3 <span class="pl-k">as</span> m3</td>
      </tr>
      <tr>
        <td id="L40" class="blob-num js-line-number" data-line-number="40"/>
        <td id="LC40" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> mutagen.flac <span class="pl-k">import</span> <span class="pl-c1">FLAC</span> <span class="pl-k">as</span> fl</td>
      </tr>
      <tr>
        <td id="L41" class="blob-num js-line-number" data-line-number="41"/>
        <td id="LC41" class="blob-code blob-code-inner js-file-line"><span class="pl-k">from</span> mutagen.oggvorbis <span class="pl-k">import</span> OggVorbis <span class="pl-k">as</span> ov</td>
      </tr>
      <tr>
        <td id="L42" class="blob-num js-line-number" data-line-number="42"/>
        <td id="LC42" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L43" class="blob-num js-line-number" data-line-number="43"/>
        <td id="LC43" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># =================================================================================================</span></td>
      </tr>
      <tr>
        <td id="L44" class="blob-num js-line-number" data-line-number="44"/>
        <td id="LC44" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Initialization</span></td>
      </tr>
      <tr>
        <td id="L45" class="blob-num js-line-number" data-line-number="45"/>
        <td id="LC45" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># =================================================================================================</span></td>
      </tr>
      <tr>
        <td id="L46" class="blob-num js-line-number" data-line-number="46"/>
        <td id="LC46" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L47" class="blob-num js-line-number" data-line-number="47"/>
        <td id="LC47" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># This sys reloading is needed to handle logger output of UTF-8 strings:</span></td>
      </tr>
      <tr>
        <td id="L48" class="blob-num js-line-number" data-line-number="48"/>
        <td id="LC48" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">reload</span>(sys)</td>
      </tr>
      <tr>
        <td id="L49" class="blob-num js-line-number" data-line-number="49"/>
        <td id="LC49" class="blob-code blob-code-inner js-file-line">sys.setdefaultencoding(<span class="pl-s"><span class="pl-pds">'</span>utf8<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L50" class="blob-num js-line-number" data-line-number="50"/>
        <td id="LC50" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L51" class="blob-num js-line-number" data-line-number="51"/>
        <td id="LC51" class="blob-code blob-code-inner js-file-line">logger <span class="pl-k">=</span> logging.getLogger(<span class="pl-s"><span class="pl-pds">'</span>smj7<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L52" class="blob-num js-line-number" data-line-number="52"/>
        <td id="LC52" class="blob-code blob-code-inner js-file-line">console <span class="pl-k">=</span> logging.StreamHandler()</td>
      </tr>
      <tr>
        <td id="L53" class="blob-num js-line-number" data-line-number="53"/>
        <td id="LC53" class="blob-code blob-code-inner js-file-line">console.setLevel(logging.<span class="pl-c1">INFO</span>)</td>
      </tr>
      <tr>
        <td id="L54" class="blob-num js-line-number" data-line-number="54"/>
        <td id="LC54" class="blob-code blob-code-inner js-file-line">formatter <span class="pl-k">=</span> logging.Formatter(<span class="pl-s"><span class="pl-pds">'</span>[<span class="pl-c1">%(asctime)s</span>] | <span class="pl-c1">%(levelname)-8s</span> | <span class="pl-c1">%(funcName)20s</span>() | <span class="pl-c1">%(message)s</span><span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L55" class="blob-num js-line-number" data-line-number="55"/>
        <td id="LC55" class="blob-code blob-code-inner js-file-line">console.setFormatter(formatter)</td>
      </tr>
      <tr>
        <td id="L56" class="blob-num js-line-number" data-line-number="56"/>
        <td id="LC56" class="blob-code blob-code-inner js-file-line">logger.addHandler(console)</td>
      </tr>
      <tr>
        <td id="L57" class="blob-num js-line-number" data-line-number="57"/>
        <td id="LC57" class="blob-code blob-code-inner js-file-line">logger.setLevel(logging.<span class="pl-c1">INFO</span>)</td>
      </tr>
      <tr>
        <td id="L58" class="blob-num js-line-number" data-line-number="58"/>
        <td id="LC58" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L59" class="blob-num js-line-number" data-line-number="59"/>
        <td id="LC59" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L60" class="blob-num js-line-number" data-line-number="60"/>
        <td id="LC60" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">true_path</span>(<span class="pl-smi">path</span>):</td>
      </tr>
      <tr>
        <td id="L61" class="blob-num js-line-number" data-line-number="61"/>
        <td id="LC61" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span>Because os.path.realpath doesn't quite work as it should<span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L62" class="blob-num js-line-number" data-line-number="62"/>
        <td id="LC62" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> os.path.realpath(os.path.expanduser(path))</td>
      </tr>
      <tr>
        <td id="L63" class="blob-num js-line-number" data-line-number="63"/>
        <td id="LC63" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L64" class="blob-num js-line-number" data-line-number="64"/>
        <td id="LC64" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L65" class="blob-num js-line-number" data-line-number="65"/>
        <td id="LC65" class="blob-code blob-code-inner js-file-line">parser <span class="pl-k">=</span> ArgumentParser(</td>
      </tr>
      <tr>
        <td id="L66" class="blob-num js-line-number" data-line-number="66"/>
        <td id="LC66" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">description</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>A simple command-line media indexer and jukebox.<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L67" class="blob-num js-line-number" data-line-number="67"/>
        <td id="LC67" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">epilog</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>Note: mplayer is required to play files.<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L68" class="blob-num js-line-number" data-line-number="68"/>
        <td id="LC68" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L69" class="blob-num js-line-number" data-line-number="69"/>
        <td id="LC69" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L70" class="blob-num js-line-number" data-line-number="70"/>
        <td id="LC70" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>-l<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>--location<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L71" class="blob-num js-line-number" data-line-number="71"/>
        <td id="LC71" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span>true_path(<span class="pl-s"><span class="pl-pds">'</span>~/Music/<span class="pl-pds">'</span></span>),</td>
      </tr>
      <tr>
        <td id="L72" class="blob-num js-line-number" data-line-number="72"/>
        <td id="LC72" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-c1">str</span>,</td>
      </tr>
      <tr>
        <td id="L73" class="blob-num js-line-number" data-line-number="73"/>
        <td id="LC73" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>the location to search for media files [~/Music]<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L74" class="blob-num js-line-number" data-line-number="74"/>
        <td id="LC74" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L75" class="blob-num js-line-number" data-line-number="75"/>
        <td id="LC75" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L76" class="blob-num js-line-number" data-line-number="76"/>
        <td id="LC76" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>-q<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>--query<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L77" class="blob-num js-line-number" data-line-number="77"/>
        <td id="LC77" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-c1">str</span>,</td>
      </tr>
      <tr>
        <td id="L78" class="blob-num js-line-number" data-line-number="78"/>
        <td id="LC78" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span></td>
      </tr>
      <tr>
        <td id="L79" class="blob-num js-line-number" data-line-number="79"/>
        <td id="LC79" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>input an SMJ7-style query, followed by playlist commands, and disable interactive mode (see --syntax)<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L80" class="blob-num js-line-number" data-line-number="80"/>
        <td id="LC80" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L81" class="blob-num js-line-number" data-line-number="81"/>
        <td id="LC81" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L82" class="blob-num js-line-number" data-line-number="82"/>
        <td id="LC82" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--database<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L83" class="blob-num js-line-number" data-line-number="83"/>
        <td id="LC83" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span>true_path(<span class="pl-s"><span class="pl-pds">'</span>~/.smj7.sqlite<span class="pl-pds">'</span></span>),</td>
      </tr>
      <tr>
        <td id="L84" class="blob-num js-line-number" data-line-number="84"/>
        <td id="LC84" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-c1">str</span>,</td>
      </tr>
      <tr>
        <td id="L85" class="blob-num js-line-number" data-line-number="85"/>
        <td id="LC85" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>the location to store the media database [~/.smj/smj7.sqlite]<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L86" class="blob-num js-line-number" data-line-number="86"/>
        <td id="LC86" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L87" class="blob-num js-line-number" data-line-number="87"/>
        <td id="LC87" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L88" class="blob-num js-line-number" data-line-number="88"/>
        <td id="LC88" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--freshen<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L89" class="blob-num js-line-number" data-line-number="89"/>
        <td id="LC89" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L90" class="blob-num js-line-number" data-line-number="90"/>
        <td id="LC90" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L91" class="blob-num js-line-number" data-line-number="91"/>
        <td id="LC91" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span></td>
      </tr>
      <tr>
        <td id="L92" class="blob-num js-line-number" data-line-number="92"/>
        <td id="LC92" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>search for new files and scan them, and update existing entries in the database, useful when adding new albums or changing metadata<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L93" class="blob-num js-line-number" data-line-number="93"/>
        <td id="LC93" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L94" class="blob-num js-line-number" data-line-number="94"/>
        <td id="LC94" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L95" class="blob-num js-line-number" data-line-number="95"/>
        <td id="LC95" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--prune<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L96" class="blob-num js-line-number" data-line-number="96"/>
        <td id="LC96" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L97" class="blob-num js-line-number" data-line-number="97"/>
        <td id="LC97" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L98" class="blob-num js-line-number" data-line-number="98"/>
        <td id="LC98" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span></td>
      </tr>
      <tr>
        <td id="L99" class="blob-num js-line-number" data-line-number="99"/>
        <td id="LC99" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>delete entries from the database if the file no longer exists (Note: if you suspect a large amount of files, use --force-rescan instead)<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L100" class="blob-num js-line-number" data-line-number="100"/>
        <td id="LC100" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L101" class="blob-num js-line-number" data-line-number="101"/>
        <td id="LC101" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L102" class="blob-num js-line-number" data-line-number="102"/>
        <td id="LC102" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--force-rescan<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L103" class="blob-num js-line-number" data-line-number="103"/>
        <td id="LC103" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L104" class="blob-num js-line-number" data-line-number="104"/>
        <td id="LC104" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L105" class="blob-num js-line-number" data-line-number="105"/>
        <td id="LC105" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span></td>
      </tr>
      <tr>
        <td id="L106" class="blob-num js-line-number" data-line-number="106"/>
        <td id="LC106" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>nuke the database and start from scratch, useful when a lot has changed since the last scan<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L107" class="blob-num js-line-number" data-line-number="107"/>
        <td id="LC107" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L108" class="blob-num js-line-number" data-line-number="108"/>
        <td id="LC108" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L109" class="blob-num js-line-number" data-line-number="109"/>
        <td id="LC109" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--json<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L110" class="blob-num js-line-number" data-line-number="110"/>
        <td id="LC110" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L111" class="blob-num js-line-number" data-line-number="111"/>
        <td id="LC111" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L112" class="blob-num js-line-number" data-line-number="112"/>
        <td id="LC112" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span></td>
      </tr>
      <tr>
        <td id="L113" class="blob-num js-line-number" data-line-number="113"/>
        <td id="LC113" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>skip playback and interactive selection, just output matching results in JSON<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L114" class="blob-num js-line-number" data-line-number="114"/>
        <td id="LC114" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L115" class="blob-num js-line-number" data-line-number="115"/>
        <td id="LC115" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L116" class="blob-num js-line-number" data-line-number="116"/>
        <td id="LC116" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--show-paths<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L117" class="blob-num js-line-number" data-line-number="117"/>
        <td id="LC117" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L118" class="blob-num js-line-number" data-line-number="118"/>
        <td id="LC118" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L119" class="blob-num js-line-number" data-line-number="119"/>
        <td id="LC119" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>include path information in JSON track output<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L120" class="blob-num js-line-number" data-line-number="120"/>
        <td id="LC120" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L121" class="blob-num js-line-number" data-line-number="121"/>
        <td id="LC121" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L122" class="blob-num js-line-number" data-line-number="122"/>
        <td id="LC122" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>-i<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>--indent<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L123" class="blob-num js-line-number" data-line-number="123"/>
        <td id="LC123" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-c1">int</span>,</td>
      </tr>
      <tr>
        <td id="L124" class="blob-num js-line-number" data-line-number="124"/>
        <td id="LC124" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">2</span>,</td>
      </tr>
      <tr>
        <td id="L125" class="blob-num js-line-number" data-line-number="125"/>
        <td id="LC125" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span></td>
      </tr>
      <tr>
        <td id="L126" class="blob-num js-line-number" data-line-number="126"/>
        <td id="LC126" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>with --json, # of spaces to indent by, set to 0 to dump block of text [2]<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L127" class="blob-num js-line-number" data-line-number="127"/>
        <td id="LC127" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L128" class="blob-num js-line-number" data-line-number="128"/>
        <td id="LC128" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L129" class="blob-num js-line-number" data-line-number="129"/>
        <td id="LC129" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--force-serial<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L130" class="blob-num js-line-number" data-line-number="130"/>
        <td id="LC130" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L131" class="blob-num js-line-number" data-line-number="131"/>
        <td id="LC131" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L132" class="blob-num js-line-number" data-line-number="132"/>
        <td id="LC132" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span></td>
      </tr>
      <tr>
        <td id="L133" class="blob-num js-line-number" data-line-number="133"/>
        <td id="LC133" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>disable parallelized media parsing, useful for slower machines or older mechanical hard disk drives<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L134" class="blob-num js-line-number" data-line-number="134"/>
        <td id="LC134" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L135" class="blob-num js-line-number" data-line-number="135"/>
        <td id="LC135" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L136" class="blob-num js-line-number" data-line-number="136"/>
        <td id="LC136" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>--syntax<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L137" class="blob-num js-line-number" data-line-number="137"/>
        <td id="LC137" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L138" class="blob-num js-line-number" data-line-number="138"/>
        <td id="LC138" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L139" class="blob-num js-line-number" data-line-number="139"/>
        <td id="LC139" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>show SMJ7-sylte syntax guide<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L140" class="blob-num js-line-number" data-line-number="140"/>
        <td id="LC140" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L141" class="blob-num js-line-number" data-line-number="141"/>
        <td id="LC141" class="blob-code blob-code-inner js-file-line">parser.add_argument(</td>
      </tr>
      <tr>
        <td id="L142" class="blob-num js-line-number" data-line-number="142"/>
        <td id="LC142" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'</span>-d<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>--debug<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L143" class="blob-num js-line-number" data-line-number="143"/>
        <td id="LC143" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">action</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>store_true<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="L144" class="blob-num js-line-number" data-line-number="144"/>
        <td id="LC144" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">default</span><span class="pl-k">=</span><span class="pl-c1">False</span>,</td>
      </tr>
      <tr>
        <td id="L145" class="blob-num js-line-number" data-line-number="145"/>
        <td id="LC145" class="blob-code blob-code-inner js-file-line">    <span class="pl-v">help</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>enable debug mode<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L146" class="blob-num js-line-number" data-line-number="146"/>
        <td id="LC146" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L147" class="blob-num js-line-number" data-line-number="147"/>
        <td id="LC147" class="blob-code blob-code-inner js-file-line">args <span class="pl-k">=</span> parser.parse_args()</td>
      </tr>
      <tr>
        <td id="L148" class="blob-num js-line-number" data-line-number="148"/>
        <td id="LC148" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L149" class="blob-num js-line-number" data-line-number="149"/>
        <td id="LC149" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> args.debug:</td>
      </tr>
      <tr>
        <td id="L150" class="blob-num js-line-number" data-line-number="150"/>
        <td id="LC150" class="blob-code blob-code-inner js-file-line">    logger.setLevel(logging.<span class="pl-c1">DEBUG</span>)</td>
      </tr>
      <tr>
        <td id="L151" class="blob-num js-line-number" data-line-number="151"/>
        <td id="LC151" class="blob-code blob-code-inner js-file-line">    console.setLevel(logging.<span class="pl-c1">DEBUG</span>)</td>
      </tr>
      <tr>
        <td id="L152" class="blob-num js-line-number" data-line-number="152"/>
        <td id="LC152" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L153" class="blob-num js-line-number" data-line-number="153"/>
        <td id="LC153" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> args.syntax:</td>
      </tr>
      <tr>
        <td id="L154" class="blob-num js-line-number" data-line-number="154"/>
        <td id="LC154" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L155" class="blob-num js-line-number" data-line-number="155"/>
        <td id="LC155" class="blob-code blob-code-inner js-file-line"><span class="pl-s"># SMJ7-Style Syntax</span></td>
      </tr>
      <tr>
        <td id="L156" class="blob-num js-line-number" data-line-number="156"/>
        <td id="LC156" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L157" class="blob-num js-line-number" data-line-number="157"/>
        <td id="LC157" class="blob-code blob-code-inner js-file-line"><span class="pl-s">SMJ7 supports a new syntax for chaining queries together using single-character notation.</span></td>
      </tr>
      <tr>
        <td id="L158" class="blob-num js-line-number" data-line-number="158"/>
        <td id="LC158" class="blob-code blob-code-inner js-file-line"><span class="pl-s">You can combine multiple parameters; like-type parameters will be logically ORed and</span></td>
      </tr>
      <tr>
        <td id="L159" class="blob-num js-line-number" data-line-number="159"/>
        <td id="LC159" class="blob-code blob-code-inner js-file-line"><span class="pl-s">unlike-type parameters will be logically ANDed together.</span></td>
      </tr>
      <tr>
        <td id="L160" class="blob-num js-line-number" data-line-number="160"/>
        <td id="LC160" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L161" class="blob-num js-line-number" data-line-number="161"/>
        <td id="LC161" class="blob-code blob-code-inner js-file-line"><span class="pl-s">!&lt;some string&gt;                      - Search for genres matching the string</span></td>
      </tr>
      <tr>
        <td id="L162" class="blob-num js-line-number" data-line-number="162"/>
        <td id="LC162" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@&lt;some string&gt;                      - Search for artists matching the string</span></td>
      </tr>
      <tr>
        <td id="L163" class="blob-num js-line-number" data-line-number="163"/>
        <td id="LC163" class="blob-code blob-code-inner js-file-line"><span class="pl-s">#&lt;some string&gt;                      - Search for albums matching the string</span></td>
      </tr>
      <tr>
        <td id="L164" class="blob-num js-line-number" data-line-number="164"/>
        <td id="LC164" class="blob-code blob-code-inner js-file-line"><span class="pl-s">$&lt;some string&gt;                      - Search for tracks matching the string</span></td>
      </tr>
      <tr>
        <td id="L165" class="blob-num js-line-number" data-line-number="165"/>
        <td id="LC165" class="blob-code blob-code-inner js-file-line"><span class="pl-s">&lt;some string&gt;                       - Search for artists, albums, or tracks matching the string</span></td>
      </tr>
      <tr>
        <td id="L166" class="blob-num js-line-number" data-line-number="166"/>
        <td id="LC166" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L167" class="blob-num js-line-number" data-line-number="167"/>
        <td id="LC167" class="blob-code blob-code-inner js-file-line"><span class="pl-s">## Combinations</span></td>
      </tr>
      <tr>
        <td id="L168" class="blob-num js-line-number" data-line-number="168"/>
        <td id="LC168" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L169" class="blob-num js-line-number" data-line-number="169"/>
        <td id="LC169" class="blob-code blob-code-inner js-file-line"><span class="pl-s">Parameters are comma-separated, and combined logically as mentioned above. All strings are</span></td>
      </tr>
      <tr>
        <td id="L170" class="blob-num js-line-number" data-line-number="170"/>
        <td id="LC170" class="blob-code blob-code-inner js-file-line"><span class="pl-s">searched case-insensitively and will match on partial hits.</span></td>
      </tr>
      <tr>
        <td id="L171" class="blob-num js-line-number" data-line-number="171"/>
        <td id="LC171" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L172" class="blob-num js-line-number" data-line-number="172"/>
        <td id="LC172" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@artist1, @artist2                  - Would search for any songs by either artist1 or artist2</span></td>
      </tr>
      <tr>
        <td id="L173" class="blob-num js-line-number" data-line-number="173"/>
        <td id="LC173" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@artist1, #album1                   - Would search for any albums with "albums1" in it by any artist with "artist1" in it.</span></td>
      </tr>
      <tr>
        <td id="L174" class="blob-num js-line-number" data-line-number="174"/>
        <td id="LC174" class="blob-code blob-code-inner js-file-line"><span class="pl-s">something1                          - Would search for anything matching "something1", in any field</span></td>
      </tr>
      <tr>
        <td id="L175" class="blob-num js-line-number" data-line-number="175"/>
        <td id="LC175" class="blob-code blob-code-inner js-file-line"><span class="pl-s">something1, $track1                 - Would search for any tracks matching "track1" that have "something1" related to them</span></td>
      </tr>
      <tr>
        <td id="L176" class="blob-num js-line-number" data-line-number="176"/>
        <td id="LC176" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L177" class="blob-num js-line-number" data-line-number="177"/>
        <td id="LC177" class="blob-code blob-code-inner js-file-line"><span class="pl-s">## Common Uses</span></td>
      </tr>
      <tr>
        <td id="L178" class="blob-num js-line-number" data-line-number="178"/>
        <td id="LC178" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L179" class="blob-num js-line-number" data-line-number="179"/>
        <td id="LC179" class="blob-code blob-code-inner js-file-line"><span class="pl-s">term1, term2, term3                 - Keep searching everything until the additional terms yield the specificity you wish</span></td>
      </tr>
      <tr>
        <td id="L180" class="blob-num js-line-number" data-line-number="180"/>
        <td id="LC180" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@artist1, @artist2, #greatest hits  - Play the "Greatest Hits" albums by both artist1 and artist2</span></td>
      </tr>
      <tr>
        <td id="L181" class="blob-num js-line-number" data-line-number="181"/>
        <td id="LC181" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@artist, #album, $tracknumber       - Play a specific track off of a specific album, useful when live albums exist alongside</span></td>
      </tr>
      <tr>
        <td id="L182" class="blob-num js-line-number" data-line-number="182"/>
        <td id="LC182" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L183" class="blob-num js-line-number" data-line-number="183"/>
        <td id="LC183" class="blob-code blob-code-inner js-file-line"><span class="pl-s">## Examples</span></td>
      </tr>
      <tr>
        <td id="L184" class="blob-num js-line-number" data-line-number="184"/>
        <td id="LC184" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L185" class="blob-num js-line-number" data-line-number="185"/>
        <td id="LC185" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@mingus, @coltrane, @brubeck        - Would play some assorted jazz tracks by these 3 artists</span></td>
      </tr>
      <tr>
        <td id="L186" class="blob-num js-line-number" data-line-number="186"/>
        <td id="LC186" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@rolling stones, #greatest          - Would match "Greatest Hits" by "The Rolling Stones"</span></td>
      </tr>
      <tr>
        <td id="L187" class="blob-num js-line-number" data-line-number="187"/>
        <td id="LC187" class="blob-code blob-code-inner js-file-line"><span class="pl-s">@decemberists, #live, $infanta      - Would play the live version of "Infanta" by "The Decemberists"</span></td>
      </tr>
      <tr>
        <td id="L188" class="blob-num js-line-number" data-line-number="188"/>
        <td id="LC188" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L189" class="blob-num js-line-number" data-line-number="189"/>
        <td id="LC189" class="blob-code blob-code-inner js-file-line"><span class="pl-s">## Playlist post-commands</span></td>
      </tr>
      <tr>
        <td id="L190" class="blob-num js-line-number" data-line-number="190"/>
        <td id="LC190" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L191" class="blob-num js-line-number" data-line-number="191"/>
        <td id="LC191" class="blob-code blob-code-inner js-file-line"><span class="pl-s">When invoking from the command line, you should encapsulate your SMJ7-style query in quotes, so that your shell can pass it here properly.</span></td>
      </tr>
      <tr>
        <td id="L192" class="blob-num js-line-number" data-line-number="192"/>
        <td id="LC192" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L193" class="blob-num js-line-number" data-line-number="193"/>
        <td id="LC193" class="blob-code blob-code-inner js-file-line"><span class="pl-s">To add playlist commands, simply append a semicolon ";" to your query and follow it with one of:</span></td>
      </tr>
      <tr>
        <td id="L194" class="blob-num js-line-number" data-line-number="194"/>
        <td id="LC194" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L195" class="blob-num js-line-number" data-line-number="195"/>
        <td id="LC195" class="blob-code blob-code-inner js-file-line"><span class="pl-s">#                                   - Play the #th song</span></td>
      </tr>
      <tr>
        <td id="L196" class="blob-num js-line-number" data-line-number="196"/>
        <td id="LC196" class="blob-code blob-code-inner js-file-line"><span class="pl-s">a                                   - Play all matching songs</span></td>
      </tr>
      <tr>
        <td id="L197" class="blob-num js-line-number" data-line-number="197"/>
        <td id="LC197" class="blob-code blob-code-inner js-file-line"><span class="pl-s">r                                   - Play a single, random matching song</span></td>
      </tr>
      <tr>
        <td id="L198" class="blob-num js-line-number" data-line-number="198"/>
        <td id="LC198" class="blob-code blob-code-inner js-file-line"><span class="pl-s">s                                   - Play all matching songs, shuffled</span></td>
      </tr>
      <tr>
        <td id="L199" class="blob-num js-line-number" data-line-number="199"/>
        <td id="LC199" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L200" class="blob-num js-line-number" data-line-number="200"/>
        <td id="LC200" class="blob-code blob-code-inner js-file-line"><span class="pl-s">### Examples of SMJ7-style query plus commands:</span></td>
      </tr>
      <tr>
        <td id="L201" class="blob-num js-line-number" data-line-number="201"/>
        <td id="LC201" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L202" class="blob-num js-line-number" data-line-number="202"/>
        <td id="LC202" class="blob-code blob-code-inner js-file-line"><span class="pl-s">./smj7.py -q "@rolling stones, #greatest; a" - Plays all songs matching the query</span></td>
      </tr>
      <tr>
        <td id="L203" class="blob-num js-line-number" data-line-number="203"/>
        <td id="LC203" class="blob-code blob-code-inner js-file-line"><span class="pl-s">./smj7.py -q "@decemberists, #live; s"       - Plays all songs matching the query, in a random order</span></td>
      </tr>
      <tr>
        <td id="L204" class="blob-num js-line-number" data-line-number="204"/>
        <td id="LC204" class="blob-code blob-code-inner js-file-line"><span class="pl-s"/></td>
      </tr>
      <tr>
        <td id="L205" class="blob-num js-line-number" data-line-number="205"/>
        <td id="LC205" class="blob-code blob-code-inner js-file-line"><span class="pl-s"><span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L206" class="blob-num js-line-number" data-line-number="206"/>
        <td id="LC206" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L207" class="blob-num js-line-number" data-line-number="207"/>
        <td id="LC207" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Fix up some parameters:</span></td>
      </tr>
      <tr>
        <td id="L208" class="blob-num js-line-number" data-line-number="208"/>
        <td id="LC208" class="blob-code blob-code-inner js-file-line">args.location <span class="pl-k">=</span> true_path(args.location)</td>
      </tr>
      <tr>
        <td id="L209" class="blob-num js-line-number" data-line-number="209"/>
        <td id="LC209" class="blob-code blob-code-inner js-file-line">args.database <span class="pl-k">=</span> true_path(args.database)</td>
      </tr>
      <tr>
        <td id="L210" class="blob-num js-line-number" data-line-number="210"/>
        <td id="LC210" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L211" class="blob-num js-line-number" data-line-number="211"/>
        <td id="LC211" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># =================================================================================================</span></td>
      </tr>
      <tr>
        <td id="L212" class="blob-num js-line-number" data-line-number="212"/>
        <td id="LC212" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Functions</span></td>
      </tr>
      <tr>
        <td id="L213" class="blob-num js-line-number" data-line-number="213"/>
        <td id="LC213" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># =================================================================================================</span></td>
      </tr>
      <tr>
        <td id="L214" class="blob-num js-line-number" data-line-number="214"/>
        <td id="LC214" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L215" class="blob-num js-line-number" data-line-number="215"/>
        <td id="LC215" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L216" class="blob-num js-line-number" data-line-number="216"/>
        <td id="LC216" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">do_sql</span>(<span class="pl-smi">query</span>, <span class="pl-smi">db_file</span><span class="pl-k">=</span>args.database, <span class="pl-smi">column_data</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-smi">multiple</span><span class="pl-k">=</span><span class="pl-c1">False</span>):</td>
      </tr>
      <tr>
        <td id="L217" class="blob-num js-line-number" data-line-number="217"/>
        <td id="LC217" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> A simple SQLite wrapper which handles multiple execution options. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L218" class="blob-num js-line-number" data-line-number="218"/>
        <td id="LC218" class="blob-code blob-code-inner js-file-line">    conn <span class="pl-k">=</span> sqlite3.connect(db_file)</td>
      </tr>
      <tr>
        <td id="L219" class="blob-num js-line-number" data-line-number="219"/>
        <td id="LC219" class="blob-code blob-code-inner js-file-line">    conn.text_factory <span class="pl-k">=</span> <span class="pl-c1">str</span></td>
      </tr>
      <tr>
        <td id="L220" class="blob-num js-line-number" data-line-number="220"/>
        <td id="LC220" class="blob-code blob-code-inner js-file-line">    conn.row_factory <span class="pl-k">=</span> sqlite3.Row</td>
      </tr>
      <tr>
        <td id="L221" class="blob-num js-line-number" data-line-number="221"/>
        <td id="LC221" class="blob-code blob-code-inner js-file-line">    curs <span class="pl-k">=</span> conn.cursor()</td>
      </tr>
      <tr>
        <td id="L222" class="blob-num js-line-number" data-line-number="222"/>
        <td id="LC222" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L223" class="blob-num js-line-number" data-line-number="223"/>
        <td id="LC223" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">try</span>:</td>
      </tr>
      <tr>
        <td id="L224" class="blob-num js-line-number" data-line-number="224"/>
        <td id="LC224" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> multiple:</td>
      </tr>
      <tr>
        <td id="L225" class="blob-num js-line-number" data-line-number="225"/>
        <td id="LC225" class="blob-code blob-code-inner js-file-line">            logger.debug(</td>
      </tr>
      <tr>
        <td id="L226" class="blob-num js-line-number" data-line-number="226"/>
        <td id="LC226" class="blob-code blob-code-inner js-file-line">                <span class="pl-s"><span class="pl-pds">'</span>Received executemany SQL transaction for "<span class="pl-c1">%s</span>": "<span class="pl-c1">%s</span>" with variables.<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L227" class="blob-num js-line-number" data-line-number="227"/>
        <td id="LC227" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">%</span> (db_file, query))</td>
      </tr>
      <tr>
        <td id="L228" class="blob-num js-line-number" data-line-number="228"/>
        <td id="LC228" class="blob-code blob-code-inner js-file-line">            curs.executemany(query, column_data)</td>
      </tr>
      <tr>
        <td id="L229" class="blob-num js-line-number" data-line-number="229"/>
        <td id="LC229" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L230" class="blob-num js-line-number" data-line-number="230"/>
        <td id="LC230" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">elif</span> column_data <span class="pl-k">is</span> <span class="pl-k">not</span> <span class="pl-c1">None</span>:</td>
      </tr>
      <tr>
        <td id="L231" class="blob-num js-line-number" data-line-number="231"/>
        <td id="LC231" class="blob-code blob-code-inner js-file-line">            logger.debug(</td>
      </tr>
      <tr>
        <td id="L232" class="blob-num js-line-number" data-line-number="232"/>
        <td id="LC232" class="blob-code blob-code-inner js-file-line">                <span class="pl-s"><span class="pl-pds">'</span>Received single variable-based SQL transaction for "<span class="pl-c1">%s</span>": "<span class="pl-c1">%s</span>" with variables.<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L233" class="blob-num js-line-number" data-line-number="233"/>
        <td id="LC233" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">%</span> (db_file, query))</td>
      </tr>
      <tr>
        <td id="L234" class="blob-num js-line-number" data-line-number="234"/>
        <td id="LC234" class="blob-code blob-code-inner js-file-line">            curs.execute(query, column_data)</td>
      </tr>
      <tr>
        <td id="L235" class="blob-num js-line-number" data-line-number="235"/>
        <td id="LC235" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L236" class="blob-num js-line-number" data-line-number="236"/>
        <td id="LC236" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L237" class="blob-num js-line-number" data-line-number="237"/>
        <td id="LC237" class="blob-code blob-code-inner js-file-line">            logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Received single SQL transaction for "<span class="pl-c1">%s</span>": "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span></td>
      </tr>
      <tr>
        <td id="L238" class="blob-num js-line-number" data-line-number="238"/>
        <td id="LC238" class="blob-code blob-code-inner js-file-line">                         (db_file, query))</td>
      </tr>
      <tr>
        <td id="L239" class="blob-num js-line-number" data-line-number="239"/>
        <td id="LC239" class="blob-code blob-code-inner js-file-line">            curs.execute(query)</td>
      </tr>
      <tr>
        <td id="L240" class="blob-num js-line-number" data-line-number="240"/>
        <td id="LC240" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L241" class="blob-num js-line-number" data-line-number="241"/>
        <td id="LC241" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># We don't care about overwriting values within the database:</span></td>
      </tr>
      <tr>
        <td id="L242" class="blob-num js-line-number" data-line-number="242"/>
        <td id="LC242" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">except</span> sqlite3.IntegrityError:</td>
      </tr>
      <tr>
        <td id="L243" class="blob-num js-line-number" data-line-number="243"/>
        <td id="LC243" class="blob-code blob-code-inner js-file-line">        logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Ignoring IntegrityError and overwriting previous values.<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L244" class="blob-num js-line-number" data-line-number="244"/>
        <td id="LC244" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">pass</span></td>
      </tr>
      <tr>
        <td id="L245" class="blob-num js-line-number" data-line-number="245"/>
        <td id="LC245" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L246" class="blob-num js-line-number" data-line-number="246"/>
        <td id="LC246" class="blob-code blob-code-inner js-file-line">    response <span class="pl-k">=</span> curs.fetchall()</td>
      </tr>
      <tr>
        <td id="L247" class="blob-num js-line-number" data-line-number="247"/>
        <td id="LC247" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L248" class="blob-num js-line-number" data-line-number="248"/>
        <td id="LC248" class="blob-code blob-code-inner js-file-line">    conn.commit()</td>
      </tr>
      <tr>
        <td id="L249" class="blob-num js-line-number" data-line-number="249"/>
        <td id="LC249" class="blob-code blob-code-inner js-file-line">    curs.close()</td>
      </tr>
      <tr>
        <td id="L250" class="blob-num js-line-number" data-line-number="250"/>
        <td id="LC250" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L251" class="blob-num js-line-number" data-line-number="251"/>
        <td id="LC251" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> response</td>
      </tr>
      <tr>
        <td id="L252" class="blob-num js-line-number" data-line-number="252"/>
        <td id="LC252" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L253" class="blob-num js-line-number" data-line-number="253"/>
        <td id="LC253" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L254" class="blob-num js-line-number" data-line-number="254"/>
        <td id="LC254" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L255" class="blob-num js-line-number" data-line-number="255"/>
        <td id="LC255" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L256" class="blob-num js-line-number" data-line-number="256"/>
        <td id="LC256" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">make_db</span>():</td>
      </tr>
      <tr>
        <td id="L257" class="blob-num js-line-number" data-line-number="257"/>
        <td id="LC257" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Perform the initial DB creation, update me if metadata columns change. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L258" class="blob-num js-line-number" data-line-number="258"/>
        <td id="LC258" class="blob-code blob-code-inner js-file-line">    sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>create table media(title text, artist text, album text, tracknumber int, discnumber int, genre text, path text unique)<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L259" class="blob-num js-line-number" data-line-number="259"/>
        <td id="LC259" class="blob-code blob-code-inner js-file-line">    logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Creating new SQLite table: "<span class="pl-c1">%s</span>" for database in: "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span></td>
      </tr>
      <tr>
        <td id="L260" class="blob-num js-line-number" data-line-number="260"/>
        <td id="LC260" class="blob-code blob-code-inner js-file-line">                 (sql, args.database))</td>
      </tr>
      <tr>
        <td id="L261" class="blob-num js-line-number" data-line-number="261"/>
        <td id="LC261" class="blob-code blob-code-inner js-file-line">    do_sql(sql)</td>
      </tr>
      <tr>
        <td id="L262" class="blob-num js-line-number" data-line-number="262"/>
        <td id="LC262" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L263" class="blob-num js-line-number" data-line-number="263"/>
        <td id="LC263" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L264" class="blob-num js-line-number" data-line-number="264"/>
        <td id="LC264" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L265" class="blob-num js-line-number" data-line-number="265"/>
        <td id="LC265" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L266" class="blob-num js-line-number" data-line-number="266"/>
        <td id="LC266" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">play</span>(<span class="pl-smi">media_entries</span>):</td>
      </tr>
      <tr>
        <td id="L267" class="blob-num js-line-number" data-line-number="267"/>
        <td id="LC267" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Play given media_entries as a list of dicts as you'd get from searching. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L268" class="blob-num js-line-number" data-line-number="268"/>
        <td id="LC268" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L269" class="blob-num js-line-number" data-line-number="269"/>
        <td id="LC269" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> media <span class="pl-k">in</span> media_entries:</td>
      </tr>
      <tr>
        <td id="L270" class="blob-num js-line-number" data-line-number="270"/>
        <td id="LC270" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>--&gt; Playing "<span class="pl-pds">'</span></span> <span class="pl-k">+</span> media[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>] <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>" off of "<span class="pl-pds">'</span></span> <span class="pl-k">+</span> media[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>] <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>" by "<span class="pl-pds">'</span></span> <span class="pl-k">+</span> media[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>] <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>" --&gt;<span class="pl-cce">\n</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L271" class="blob-num js-line-number" data-line-number="271"/>
        <td id="LC271" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L272" class="blob-num js-line-number" data-line-number="272"/>
        <td id="LC272" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">try</span>:</td>
      </tr>
      <tr>
        <td id="L273" class="blob-num js-line-number" data-line-number="273"/>
        <td id="LC273" class="blob-code blob-code-inner js-file-line">            check_call([<span class="pl-s"><span class="pl-pds">'</span>mplayer<span class="pl-pds">'</span></span>, media[<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>]])</td>
      </tr>
      <tr>
        <td id="L274" class="blob-num js-line-number" data-line-number="274"/>
        <td id="LC274" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L275" class="blob-num js-line-number" data-line-number="275"/>
        <td id="LC275" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">except</span> (<span class="pl-c1">KeyboardInterrupt</span>, CalledProcessError):</td>
      </tr>
      <tr>
        <td id="L276" class="blob-num js-line-number" data-line-number="276"/>
        <td id="LC276" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"># This sleep helps with mplayer printing exiting stuff to stderr after we've printed our prompt:</span></td>
      </tr>
      <tr>
        <td id="L277" class="blob-num js-line-number" data-line-number="277"/>
        <td id="LC277" class="blob-code blob-code-inner js-file-line">            sleep(<span class="pl-c1">0.25</span>)</td>
      </tr>
      <tr>
        <td id="L278" class="blob-num js-line-number" data-line-number="278"/>
        <td id="LC278" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">break</span></td>
      </tr>
      <tr>
        <td id="L279" class="blob-num js-line-number" data-line-number="279"/>
        <td id="LC279" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L280" class="blob-num js-line-number" data-line-number="280"/>
        <td id="LC280" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L281" class="blob-num js-line-number" data-line-number="281"/>
        <td id="LC281" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L282" class="blob-num js-line-number" data-line-number="282"/>
        <td id="LC282" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L283" class="blob-num js-line-number" data-line-number="283"/>
        <td id="LC283" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">get_media_files</span>(<span class="pl-smi">path</span>):</td>
      </tr>
      <tr>
        <td id="L284" class="blob-num js-line-number" data-line-number="284"/>
        <td id="LC284" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Using scandir's optimized walking algorithm, we can discard GNU's `find`. Only catches</span></td>
      </tr>
      <tr>
        <td id="L285" class="blob-num js-line-number" data-line-number="285"/>
        <td id="LC285" class="blob-code blob-code-inner js-file-line"><span class="pl-s">        potential files via filename extension, but we could validate this in the future. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L286" class="blob-num js-line-number" data-line-number="286"/>
        <td id="LC286" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L287" class="blob-num js-line-number" data-line-number="287"/>
        <td id="LC287" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> root, dirs, files <span class="pl-k">in</span> walk(path):</td>
      </tr>
      <tr>
        <td id="L288" class="blob-num js-line-number" data-line-number="288"/>
        <td id="LC288" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">for</span> filename <span class="pl-k">in</span> files:</td>
      </tr>
      <tr>
        <td id="L289" class="blob-num js-line-number" data-line-number="289"/>
        <td id="LC289" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> filename.endswith((<span class="pl-s"><span class="pl-pds">'</span>.m4a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.mp3<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.ogg<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.oga<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.flac<span class="pl-pds">'</span></span>)):</td>
      </tr>
      <tr>
        <td id="L290" class="blob-num js-line-number" data-line-number="290"/>
        <td id="LC290" class="blob-code blob-code-inner js-file-line">                logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Found a potential media file: "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span></td>
      </tr>
      <tr>
        <td id="L291" class="blob-num js-line-number" data-line-number="291"/>
        <td id="LC291" class="blob-code blob-code-inner js-file-line">                             os.path.join(root, filename))</td>
      </tr>
      <tr>
        <td id="L292" class="blob-num js-line-number" data-line-number="292"/>
        <td id="LC292" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">yield</span> os.path.join(root, filename)</td>
      </tr>
      <tr>
        <td id="L293" class="blob-num js-line-number" data-line-number="293"/>
        <td id="LC293" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L294" class="blob-num js-line-number" data-line-number="294"/>
        <td id="LC294" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L295" class="blob-num js-line-number" data-line-number="295"/>
        <td id="LC295" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">get_new_media_files</span>(<span class="pl-smi">path</span>):</td>
      </tr>
      <tr>
        <td id="L296" class="blob-num js-line-number" data-line-number="296"/>
        <td id="LC296" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Using scandir's optimized walking algorithm, we can discard GNU's `find`. Only catches</span></td>
      </tr>
      <tr>
        <td id="L297" class="blob-num js-line-number" data-line-number="297"/>
        <td id="LC297" class="blob-code blob-code-inner js-file-line"><span class="pl-s">        potential files via filename extension, but we could validate this in the future. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L298" class="blob-num js-line-number" data-line-number="298"/>
        <td id="LC298" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L299" class="blob-num js-line-number" data-line-number="299"/>
        <td id="LC299" class="blob-code blob-code-inner js-file-line">    db_time <span class="pl-k">=</span> os.stat(args.database)[<span class="pl-c1">8</span>]</td>
      </tr>
      <tr>
        <td id="L300" class="blob-num js-line-number" data-line-number="300"/>
        <td id="LC300" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L301" class="blob-num js-line-number" data-line-number="301"/>
        <td id="LC301" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> root, dirs, files <span class="pl-k">in</span> walk(path):</td>
      </tr>
      <tr>
        <td id="L302" class="blob-num js-line-number" data-line-number="302"/>
        <td id="LC302" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">for</span> filename <span class="pl-k">in</span> files:</td>
      </tr>
      <tr>
        <td id="L303" class="blob-num js-line-number" data-line-number="303"/>
        <td id="LC303" class="blob-code blob-code-inner js-file-line">            absolute_filename <span class="pl-k">=</span> os.path.join(root, filename)</td>
      </tr>
      <tr>
        <td id="L304" class="blob-num js-line-number" data-line-number="304"/>
        <td id="LC304" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> filename.endswith(</td>
      </tr>
      <tr>
        <td id="L305" class="blob-num js-line-number" data-line-number="305"/>
        <td id="LC305" class="blob-code blob-code-inner js-file-line">                (<span class="pl-s"><span class="pl-pds">'</span>.m4a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.mp3<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.ogg<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.oga<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L306" class="blob-num js-line-number" data-line-number="306"/>
        <td id="LC306" class="blob-code blob-code-inner js-file-line">                 <span class="pl-s"><span class="pl-pds">'</span>.flac<span class="pl-pds">'</span></span>)) <span class="pl-k">and</span> os.stat(absolute_filename)[<span class="pl-c1">8</span>] <span class="pl-k">&gt;</span> db_time:</td>
      </tr>
      <tr>
        <td id="L307" class="blob-num js-line-number" data-line-number="307"/>
        <td id="LC307" class="blob-code blob-code-inner js-file-line">                logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Found a potential newer media file: "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span></td>
      </tr>
      <tr>
        <td id="L308" class="blob-num js-line-number" data-line-number="308"/>
        <td id="LC308" class="blob-code blob-code-inner js-file-line">                             absolute_filename)</td>
      </tr>
      <tr>
        <td id="L309" class="blob-num js-line-number" data-line-number="309"/>
        <td id="LC309" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">yield</span> absolute_filename</td>
      </tr>
      <tr>
        <td id="L310" class="blob-num js-line-number" data-line-number="310"/>
        <td id="LC310" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L311" class="blob-num js-line-number" data-line-number="311"/>
        <td id="LC311" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L312" class="blob-num js-line-number" data-line-number="312"/>
        <td id="LC312" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">get_stale_entries</span>(<span class="pl-smi">db_file</span><span class="pl-k">=</span>args.database):</td>
      </tr>
      <tr>
        <td id="L313" class="blob-num js-line-number" data-line-number="313"/>
        <td id="LC313" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Return entries from the database only if they're not present on-disk. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L314" class="blob-num js-line-number" data-line-number="314"/>
        <td id="LC314" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L315" class="blob-num js-line-number" data-line-number="315"/>
        <td id="LC315" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># We aren't going to use do_sql() as we want an iterator, and don't need the Row type:</span></td>
      </tr>
      <tr>
        <td id="L316" class="blob-num js-line-number" data-line-number="316"/>
        <td id="LC316" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">with</span> sqlite3.connect(db_file) <span class="pl-k">as</span> conn:</td>
      </tr>
      <tr>
        <td id="L317" class="blob-num js-line-number" data-line-number="317"/>
        <td id="LC317" class="blob-code blob-code-inner js-file-line">        conn.text_factory <span class="pl-k">=</span> <span class="pl-c1">str</span></td>
      </tr>
      <tr>
        <td id="L318" class="blob-num js-line-number" data-line-number="318"/>
        <td id="LC318" class="blob-code blob-code-inner js-file-line">        curs <span class="pl-k">=</span> conn.cursor()</td>
      </tr>
      <tr>
        <td id="L319" class="blob-num js-line-number" data-line-number="319"/>
        <td id="LC319" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L320" class="blob-num js-line-number" data-line-number="320"/>
        <td id="LC320" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">for</span> row <span class="pl-k">in</span> curs.execute(<span class="pl-s"><span class="pl-pds">'</span>select path from media<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L321" class="blob-num js-line-number" data-line-number="321"/>
        <td id="LC321" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> <span class="pl-k">not</span> os.path.exists(row[<span class="pl-c1">0</span>]):</td>
      </tr>
      <tr>
        <td id="L322" class="blob-num js-line-number" data-line-number="322"/>
        <td id="LC322" class="blob-code blob-code-inner js-file-line">                logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Got stale entry: "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span> row[<span class="pl-c1">0</span>])</td>
      </tr>
      <tr>
        <td id="L323" class="blob-num js-line-number" data-line-number="323"/>
        <td id="LC323" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">yield</span> row</td>
      </tr>
      <tr>
        <td id="L324" class="blob-num js-line-number" data-line-number="324"/>
        <td id="LC324" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L325" class="blob-num js-line-number" data-line-number="325"/>
        <td id="LC325" class="blob-code blob-code-inner js-file-line">        curs.close()</td>
      </tr>
      <tr>
        <td id="L326" class="blob-num js-line-number" data-line-number="326"/>
        <td id="LC326" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L327" class="blob-num js-line-number" data-line-number="327"/>
        <td id="LC327" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L328" class="blob-num js-line-number" data-line-number="328"/>
        <td id="LC328" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">remove_stale_entries</span>(<span class="pl-smi">db_file</span><span class="pl-k">=</span>args.database):</td>
      </tr>
      <tr>
        <td id="L329" class="blob-num js-line-number" data-line-number="329"/>
        <td id="LC329" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Look up entries in the database and ensure they exist on disk.</span></td>
      </tr>
      <tr>
        <td id="L330" class="blob-num js-line-number" data-line-number="330"/>
        <td id="LC330" class="blob-code blob-code-inner js-file-line"><span class="pl-s">        Note: If metadata was updated after the last scan, get_new_media_files() will</span></td>
      </tr>
      <tr>
        <td id="L331" class="blob-num js-line-number" data-line-number="331"/>
        <td id="LC331" class="blob-code blob-code-inner js-file-line"><span class="pl-s">              automatically rescan the file and update it in the DB. This function is used</span></td>
      </tr>
      <tr>
        <td id="L332" class="blob-num js-line-number" data-line-number="332"/>
        <td id="LC332" class="blob-code blob-code-inner js-file-line"><span class="pl-s">              when entries have been deleted from disk.</span></td>
      </tr>
      <tr>
        <td id="L333" class="blob-num js-line-number" data-line-number="333"/>
        <td id="LC333" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L334" class="blob-num js-line-number" data-line-number="334"/>
        <td id="LC334" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L335" class="blob-num js-line-number" data-line-number="335"/>
        <td id="LC335" class="blob-code blob-code-inner js-file-line">    before_count <span class="pl-k">=</span> do_sql(<span class="pl-s"><span class="pl-pds">'</span>select count(path) from media<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>][<span class="pl-c1">0</span>]</td>
      </tr>
      <tr>
        <td id="L336" class="blob-num js-line-number" data-line-number="336"/>
        <td id="LC336" class="blob-code blob-code-inner js-file-line">    before <span class="pl-k">=</span> time()</td>
      </tr>
      <tr>
        <td id="L337" class="blob-num js-line-number" data-line-number="337"/>
        <td id="LC337" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L338" class="blob-num js-line-number" data-line-number="338"/>
        <td id="LC338" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># We aren't going to use do_sql() as we want an iterator, and don't need the Row type:</span></td>
      </tr>
      <tr>
        <td id="L339" class="blob-num js-line-number" data-line-number="339"/>
        <td id="LC339" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">with</span> sqlite3.connect(db_file) <span class="pl-k">as</span> conn:</td>
      </tr>
      <tr>
        <td id="L340" class="blob-num js-line-number" data-line-number="340"/>
        <td id="LC340" class="blob-code blob-code-inner js-file-line">        conn.text_factory <span class="pl-k">=</span> <span class="pl-c1">str</span></td>
      </tr>
      <tr>
        <td id="L341" class="blob-num js-line-number" data-line-number="341"/>
        <td id="LC341" class="blob-code blob-code-inner js-file-line">        curs <span class="pl-k">=</span> conn.cursor()</td>
      </tr>
      <tr>
        <td id="L342" class="blob-num js-line-number" data-line-number="342"/>
        <td id="LC342" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L343" class="blob-num js-line-number" data-line-number="343"/>
        <td id="LC343" class="blob-code blob-code-inner js-file-line">        curs.executemany(<span class="pl-s"><span class="pl-pds">'</span>delete from media where path = ?<span class="pl-pds">'</span></span>, get_stale_entries())</td>
      </tr>
      <tr>
        <td id="L344" class="blob-num js-line-number" data-line-number="344"/>
        <td id="LC344" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="L345" class="blob-num js-line-number" data-line-number="345"/>
        <td id="LC345" class="blob-code blob-code-inner js-file-line">        conn.commit()</td>
      </tr>
      <tr>
        <td id="L346" class="blob-num js-line-number" data-line-number="346"/>
        <td id="LC346" class="blob-code blob-code-inner js-file-line">        curs.close()</td>
      </tr>
      <tr>
        <td id="L347" class="blob-num js-line-number" data-line-number="347"/>
        <td id="LC347" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L348" class="blob-num js-line-number" data-line-number="348"/>
        <td id="LC348" class="blob-code blob-code-inner js-file-line">    after <span class="pl-k">=</span> time()</td>
      </tr>
      <tr>
        <td id="L349" class="blob-num js-line-number" data-line-number="349"/>
        <td id="LC349" class="blob-code blob-code-inner js-file-line">    after_count <span class="pl-k">=</span> do_sql(<span class="pl-s"><span class="pl-pds">'</span>select count(path) from media<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>][<span class="pl-c1">0</span>]</td>
      </tr>
      <tr>
        <td id="L350" class="blob-num js-line-number" data-line-number="350"/>
        <td id="LC350" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="L351" class="blob-num js-line-number" data-line-number="351"/>
        <td id="LC351" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>Pruner: Removed <span class="pl-c1">%s</span> stale files from the databse in <span class="pl-c1">%s</span> seconds.<span class="pl-pds">'</span></span> <span class="pl-k">%</span> (before_count <span class="pl-k">-</span> after_count, <span class="pl-c1">round</span>(after <span class="pl-k">-</span> before, <span class="pl-c1">2</span>))</td>
      </tr>
      <tr>
        <td id="L352" class="blob-num js-line-number" data-line-number="352"/>
        <td id="LC352" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L353" class="blob-num js-line-number" data-line-number="353"/>
        <td id="LC353" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L354" class="blob-num js-line-number" data-line-number="354"/>
        <td id="LC354" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L355" class="blob-num js-line-number" data-line-number="355"/>
        <td id="LC355" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L356" class="blob-num js-line-number" data-line-number="356"/>
        <td id="LC356" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">parse_media_file</span>(<span class="pl-smi">path</span>):</td>
      </tr>
      <tr>
        <td id="L357" class="blob-num js-line-number" data-line-number="357"/>
        <td id="LC357" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Perform the parsing of media metadata, and clean it up into a more sensible format. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L358" class="blob-num js-line-number" data-line-number="358"/>
        <td id="LC358" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L359" class="blob-num js-line-number" data-line-number="359"/>
        <td id="LC359" class="blob-code blob-code-inner js-file-line">    filename <span class="pl-k">=</span> os.path.split(path)[<span class="pl-c1">1</span>]</td>
      </tr>
      <tr>
        <td id="L360" class="blob-num js-line-number" data-line-number="360"/>
        <td id="LC360" class="blob-code blob-code-inner js-file-line">    filename_split <span class="pl-k">=</span> os.path.splitext(filename)</td>
      </tr>
      <tr>
        <td id="L361" class="blob-num js-line-number" data-line-number="361"/>
        <td id="LC361" class="blob-code blob-code-inner js-file-line">    extension <span class="pl-k">=</span> filename_split[<span class="pl-c1">1</span>]</td>
      </tr>
      <tr>
        <td id="L362" class="blob-num js-line-number" data-line-number="362"/>
        <td id="LC362" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L363" class="blob-num js-line-number" data-line-number="363"/>
        <td id="LC363" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> extension <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>.m4a<span class="pl-pds">'</span></span>:</td>
      </tr>
      <tr>
        <td id="L364" class="blob-num js-line-number" data-line-number="364"/>
        <td id="LC364" class="blob-code blob-code-inner js-file-line">        mutagen_metadata <span class="pl-k">=</span> m4(path)</td>
      </tr>
      <tr>
        <td id="L365" class="blob-num js-line-number" data-line-number="365"/>
        <td id="LC365" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L366" class="blob-num js-line-number" data-line-number="366"/>
        <td id="LC366" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">elif</span> extension <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>.mp3<span class="pl-pds">'</span></span>:</td>
      </tr>
      <tr>
        <td id="L367" class="blob-num js-line-number" data-line-number="367"/>
        <td id="LC367" class="blob-code blob-code-inner js-file-line">        mutagen_metadata <span class="pl-k">=</span> m3(path)</td>
      </tr>
      <tr>
        <td id="L368" class="blob-num js-line-number" data-line-number="368"/>
        <td id="LC368" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L369" class="blob-num js-line-number" data-line-number="369"/>
        <td id="LC369" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">elif</span> extension <span class="pl-k">in</span> (<span class="pl-s"><span class="pl-pds">'</span>.oga<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>.ogg<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L370" class="blob-num js-line-number" data-line-number="370"/>
        <td id="LC370" class="blob-code blob-code-inner js-file-line">        mutagen_metadata <span class="pl-k">=</span> og(path)</td>
      </tr>
      <tr>
        <td id="L371" class="blob-num js-line-number" data-line-number="371"/>
        <td id="LC371" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L372" class="blob-num js-line-number" data-line-number="372"/>
        <td id="LC372" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">elif</span> extension <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>.flac<span class="pl-pds">'</span></span>:</td>
      </tr>
      <tr>
        <td id="L373" class="blob-num js-line-number" data-line-number="373"/>
        <td id="LC373" class="blob-code blob-code-inner js-file-line">        mutagen_metadata <span class="pl-k">=</span> fl(path)</td>
      </tr>
      <tr>
        <td id="L374" class="blob-num js-line-number" data-line-number="374"/>
        <td id="LC374" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L375" class="blob-num js-line-number" data-line-number="375"/>
        <td id="LC375" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># Remember, the Mutagen tag's value is a list:</span></td>
      </tr>
      <tr>
        <td id="L376" class="blob-num js-line-number" data-line-number="376"/>
        <td id="LC376" class="blob-code blob-code-inner js-file-line">    smj_metadata <span class="pl-k">=</span> {</td>
      </tr>
      <tr>
        <td id="L377" class="blob-num js-line-number" data-line-number="377"/>
        <td id="LC377" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>: mutagen_metadata.get(<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>unknown artist<span class="pl-pds">'</span></span>])[<span class="pl-c1">0</span>],</td>
      </tr>
      <tr>
        <td id="L378" class="blob-num js-line-number" data-line-number="378"/>
        <td id="LC378" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>: mutagen_metadata.get(<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>unknown album<span class="pl-pds">'</span></span>])[<span class="pl-c1">0</span>],</td>
      </tr>
      <tr>
        <td id="L379" class="blob-num js-line-number" data-line-number="379"/>
        <td id="LC379" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>: mutagen_metadata.get(<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>, [filename_split[<span class="pl-c1">0</span>]])[<span class="pl-c1">0</span>],</td>
      </tr>
      <tr>
        <td id="L380" class="blob-num js-line-number" data-line-number="380"/>
        <td id="LC380" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">'</span>genre<span class="pl-pds">'</span></span>: mutagen_metadata.get(<span class="pl-s"><span class="pl-pds">'</span>genre<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>unknown genre<span class="pl-pds">'</span></span>])[<span class="pl-c1">0</span>],</td>
      </tr>
      <tr>
        <td id="L381" class="blob-num js-line-number" data-line-number="381"/>
        <td id="LC381" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>: path</td>
      </tr>
      <tr>
        <td id="L382" class="blob-num js-line-number" data-line-number="382"/>
        <td id="LC382" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="L383" class="blob-num js-line-number" data-line-number="383"/>
        <td id="LC383" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L384" class="blob-num js-line-number" data-line-number="384"/>
        <td id="LC384" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># Prefer the "sort" "album artist", which won't include things like "Someone featuring So-and-So":</span></td>
      </tr>
      <tr>
        <td id="L385" class="blob-num js-line-number" data-line-number="385"/>
        <td id="LC385" class="blob-code blob-code-inner js-file-line">    smj_metadata[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> mutagen_metadata.get(<span class="pl-s"><span class="pl-pds">'</span>albumartistsort<span class="pl-pds">'</span></span>,</td>
      </tr>
      <tr>
        <td id="L386" class="blob-num js-line-number" data-line-number="386"/>
        <td id="LC386" class="blob-code blob-code-inner js-file-line">                                                  [smj_metadata[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]])[<span class="pl-c1">0</span>]</td>
      </tr>
      <tr>
        <td id="L387" class="blob-num js-line-number" data-line-number="387"/>
        <td id="LC387" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L388" class="blob-num js-line-number" data-line-number="388"/>
        <td id="LC388" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># Catch very odd cases where the 'tracknumber' field is something other than a digit:</span></td>
      </tr>
      <tr>
        <td id="L389" class="blob-num js-line-number" data-line-number="389"/>
        <td id="LC389" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> number <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">'</span>tracknumber<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>discnumber<span class="pl-pds">'</span></span>]:</td>
      </tr>
      <tr>
        <td id="L390" class="blob-num js-line-number" data-line-number="390"/>
        <td id="LC390" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">try</span>:</td>
      </tr>
      <tr>
        <td id="L391" class="blob-num js-line-number" data-line-number="391"/>
        <td id="LC391" class="blob-code blob-code-inner js-file-line">            smj_metadata[number] <span class="pl-k">=</span> <span class="pl-c1">int</span>(</td>
      </tr>
      <tr>
        <td id="L392" class="blob-num js-line-number" data-line-number="392"/>
        <td id="LC392" class="blob-code blob-code-inner js-file-line">                mutagen_metadata.get(number, [<span class="pl-s"><span class="pl-pds">'</span>0/0<span class="pl-pds">'</span></span>])[<span class="pl-c1">0</span>].split(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>])</td>
      </tr>
      <tr>
        <td id="L393" class="blob-num js-line-number" data-line-number="393"/>
        <td id="LC393" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L394" class="blob-num js-line-number" data-line-number="394"/>
        <td id="LC394" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">except</span> <span class="pl-c1">ValueError</span>:</td>
      </tr>
      <tr>
        <td id="L395" class="blob-num js-line-number" data-line-number="395"/>
        <td id="LC395" class="blob-code blob-code-inner js-file-line">            smj_metadata[number] <span class="pl-k">=</span> <span class="pl-c1">0</span></td>
      </tr>
      <tr>
        <td id="L396" class="blob-num js-line-number" data-line-number="396"/>
        <td id="LC396" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L397" class="blob-num js-line-number" data-line-number="397"/>
        <td id="LC397" class="blob-code blob-code-inner js-file-line">    logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Parsed: <span class="pl-c1">%s</span><span class="pl-pds">'</span></span> <span class="pl-k">%</span> <span class="pl-c1">str</span>(smj_metadata))</td>
      </tr>
      <tr>
        <td id="L398" class="blob-num js-line-number" data-line-number="398"/>
        <td id="LC398" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L399" class="blob-num js-line-number" data-line-number="399"/>
        <td id="LC399" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> smj_metadata</td>
      </tr>
      <tr>
        <td id="L400" class="blob-num js-line-number" data-line-number="400"/>
        <td id="LC400" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L401" class="blob-num js-line-number" data-line-number="401"/>
        <td id="LC401" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L402" class="blob-num js-line-number" data-line-number="402"/>
        <td id="LC402" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L403" class="blob-num js-line-number" data-line-number="403"/>
        <td id="LC403" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Both serial and parallel indexers use this SQL to shove data into SQLite:</span></td>
      </tr>
      <tr>
        <td id="L404" class="blob-num js-line-number" data-line-number="404"/>
        <td id="LC404" class="blob-code blob-code-inner js-file-line">insert_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>insert into media (title, artist, album, tracknumber, discnumber, genre, path) values (:title, :artist, :album, :tracknumber, :discnumber, :genre, :path)<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L405" class="blob-num js-line-number" data-line-number="405"/>
        <td id="LC405" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L406" class="blob-num js-line-number" data-line-number="406"/>
        <td id="LC406" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L407" class="blob-num js-line-number" data-line-number="407"/>
        <td id="LC407" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">index_media</span>(<span class="pl-smi">location</span><span class="pl-k">=</span>args.location, <span class="pl-smi">freshen</span><span class="pl-k">=</span>args.freshen):</td>
      </tr>
      <tr>
        <td id="L408" class="blob-num js-line-number" data-line-number="408"/>
        <td id="LC408" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Link the media file fetcher with the parser, and update the database. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L409" class="blob-num js-line-number" data-line-number="409"/>
        <td id="LC409" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L410" class="blob-num js-line-number" data-line-number="410"/>
        <td id="LC410" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> freshen:</td>
      </tr>
      <tr>
        <td id="L411" class="blob-num js-line-number" data-line-number="411"/>
        <td id="LC411" class="blob-code blob-code-inner js-file-line">        before_count <span class="pl-k">=</span> do_sql(<span class="pl-s"><span class="pl-pds">'</span>select count(path) from media<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>][<span class="pl-c1">0</span>]</td>
      </tr>
      <tr>
        <td id="L412" class="blob-num js-line-number" data-line-number="412"/>
        <td id="LC412" class="blob-code blob-code-inner js-file-line">        file_getter <span class="pl-k">=</span> get_new_media_files</td>
      </tr>
      <tr>
        <td id="L413" class="blob-num js-line-number" data-line-number="413"/>
        <td id="LC413" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L414" class="blob-num js-line-number" data-line-number="414"/>
        <td id="LC414" class="blob-code blob-code-inner js-file-line">        file_getter <span class="pl-k">=</span> get_media_files</td>
      </tr>
      <tr>
        <td id="L415" class="blob-num js-line-number" data-line-number="415"/>
        <td id="LC415" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L416" class="blob-num js-line-number" data-line-number="416"/>
        <td id="LC416" class="blob-code blob-code-inner js-file-line">    before <span class="pl-k">=</span> time()</td>
      </tr>
      <tr>
        <td id="L417" class="blob-num js-line-number" data-line-number="417"/>
        <td id="LC417" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L418" class="blob-num js-line-number" data-line-number="418"/>
        <td id="LC418" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> args.force_serial:</td>
      </tr>
      <tr>
        <td id="L419" class="blob-num js-line-number" data-line-number="419"/>
        <td id="LC419" class="blob-code blob-code-inner js-file-line">        adverb <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Serially<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L420" class="blob-num js-line-number" data-line-number="420"/>
        <td id="LC420" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">try</span>:</td>
      </tr>
      <tr>
        <td id="L421" class="blob-num js-line-number" data-line-number="421"/>
        <td id="LC421" class="blob-code blob-code-inner js-file-line">            do_sql(insert_sql,</td>
      </tr>
      <tr>
        <td id="L422" class="blob-num js-line-number" data-line-number="422"/>
        <td id="LC422" class="blob-code blob-code-inner js-file-line">                   <span class="pl-v">column_data</span><span class="pl-k">=</span>imap(parse_media_file, file_getter(location)),</td>
      </tr>
      <tr>
        <td id="L423" class="blob-num js-line-number" data-line-number="423"/>
        <td id="LC423" class="blob-code blob-code-inner js-file-line">                   <span class="pl-v">multiple</span><span class="pl-k">=</span><span class="pl-c1">True</span>)</td>
      </tr>
      <tr>
        <td id="L424" class="blob-num js-line-number" data-line-number="424"/>
        <td id="LC424" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L425" class="blob-num js-line-number" data-line-number="425"/>
        <td id="LC425" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">except</span> <span class="pl-c1">KeyboardInterrupt</span>:</td>
      </tr>
      <tr>
        <td id="L426" class="blob-num js-line-number" data-line-number="426"/>
        <td id="LC426" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">exit</span>(<span class="pl-c1">1</span>)</td>
      </tr>
      <tr>
        <td id="L427" class="blob-num js-line-number" data-line-number="427"/>
        <td id="LC427" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L428" class="blob-num js-line-number" data-line-number="428"/>
        <td id="LC428" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L429" class="blob-num js-line-number" data-line-number="429"/>
        <td id="LC429" class="blob-code blob-code-inner js-file-line">        adverb <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Parallely<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L430" class="blob-num js-line-number" data-line-number="430"/>
        <td id="LC430" class="blob-code blob-code-inner js-file-line">        pool <span class="pl-k">=</span> Pool()</td>
      </tr>
      <tr>
        <td id="L431" class="blob-num js-line-number" data-line-number="431"/>
        <td id="LC431" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">try</span>:</td>
      </tr>
      <tr>
        <td id="L432" class="blob-num js-line-number" data-line-number="432"/>
        <td id="LC432" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"># Set the chunksize for imap_unordered to a low but doable number that is &gt; 1 for slightly better performance:</span></td>
      </tr>
      <tr>
        <td id="L433" class="blob-num js-line-number" data-line-number="433"/>
        <td id="LC433" class="blob-code blob-code-inner js-file-line">            do_sql(insert_sql,</td>
      </tr>
      <tr>
        <td id="L434" class="blob-num js-line-number" data-line-number="434"/>
        <td id="LC434" class="blob-code blob-code-inner js-file-line">                   <span class="pl-v">column_data</span><span class="pl-k">=</span>pool.imap_unordered(parse_media_file,</td>
      </tr>
      <tr>
        <td id="L435" class="blob-num js-line-number" data-line-number="435"/>
        <td id="LC435" class="blob-code blob-code-inner js-file-line">                                                   file_getter(location), <span class="pl-c1">8</span>),</td>
      </tr>
      <tr>
        <td id="L436" class="blob-num js-line-number" data-line-number="436"/>
        <td id="LC436" class="blob-code blob-code-inner js-file-line">                   <span class="pl-v">multiple</span><span class="pl-k">=</span><span class="pl-c1">True</span>)</td>
      </tr>
      <tr>
        <td id="L437" class="blob-num js-line-number" data-line-number="437"/>
        <td id="LC437" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L438" class="blob-num js-line-number" data-line-number="438"/>
        <td id="LC438" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">except</span> <span class="pl-c1">KeyboardInterrupt</span>:</td>
      </tr>
      <tr>
        <td id="L439" class="blob-num js-line-number" data-line-number="439"/>
        <td id="LC439" class="blob-code blob-code-inner js-file-line">            pool.terminate()</td>
      </tr>
      <tr>
        <td id="L440" class="blob-num js-line-number" data-line-number="440"/>
        <td id="LC440" class="blob-code blob-code-inner js-file-line">            pool.join()</td>
      </tr>
      <tr>
        <td id="L441" class="blob-num js-line-number" data-line-number="441"/>
        <td id="LC441" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">exit</span>(<span class="pl-c1">1</span>)</td>
      </tr>
      <tr>
        <td id="L442" class="blob-num js-line-number" data-line-number="442"/>
        <td id="LC442" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L443" class="blob-num js-line-number" data-line-number="443"/>
        <td id="LC443" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L444" class="blob-num js-line-number" data-line-number="444"/>
        <td id="LC444" class="blob-code blob-code-inner js-file-line">            pool.close()</td>
      </tr>
      <tr>
        <td id="L445" class="blob-num js-line-number" data-line-number="445"/>
        <td id="LC445" class="blob-code blob-code-inner js-file-line">            pool.join()</td>
      </tr>
      <tr>
        <td id="L446" class="blob-num js-line-number" data-line-number="446"/>
        <td id="LC446" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L447" class="blob-num js-line-number" data-line-number="447"/>
        <td id="LC447" class="blob-code blob-code-inner js-file-line">    after <span class="pl-k">=</span> time()</td>
      </tr>
      <tr>
        <td id="L448" class="blob-num js-line-number" data-line-number="448"/>
        <td id="LC448" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L449" class="blob-num js-line-number" data-line-number="449"/>
        <td id="LC449" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> freshen:</td>
      </tr>
      <tr>
        <td id="L450" class="blob-num js-line-number" data-line-number="450"/>
        <td id="LC450" class="blob-code blob-code-inner js-file-line">        after_count <span class="pl-k">=</span> do_sql(<span class="pl-s"><span class="pl-pds">'</span>select count(path) from media<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>][<span class="pl-c1">0</span>]</td>
      </tr>
      <tr>
        <td id="L451" class="blob-num js-line-number" data-line-number="451"/>
        <td id="LC451" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>Indexer: <span class="pl-c1">%s</span> indexed <span class="pl-c1">%s</span> newer files in <span class="pl-c1">%s</span> seconds.<span class="pl-pds">'</span></span> <span class="pl-k">%</span> (</td>
      </tr>
      <tr>
        <td id="L452" class="blob-num js-line-number" data-line-number="452"/>
        <td id="LC452" class="blob-code blob-code-inner js-file-line">            adverb, after_count <span class="pl-k">-</span> before_count, <span class="pl-c1">round</span>(after <span class="pl-k">-</span> before, <span class="pl-c1">2</span>))</td>
      </tr>
      <tr>
        <td id="L453" class="blob-num js-line-number" data-line-number="453"/>
        <td id="LC453" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L454" class="blob-num js-line-number" data-line-number="454"/>
        <td id="LC454" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>Indexer: <span class="pl-c1">%s</span> indexed <span class="pl-c1">%s</span> files in <span class="pl-c1">%s</span> seconds.<span class="pl-pds">'</span></span> <span class="pl-k">%</span> (adverb, do_sql(</td>
      </tr>
      <tr>
        <td id="L455" class="blob-num js-line-number" data-line-number="455"/>
        <td id="LC455" class="blob-code blob-code-inner js-file-line">            <span class="pl-s"><span class="pl-pds">'</span>select count(path) from media<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>][<span class="pl-c1">0</span>], <span class="pl-c1">round</span>(after <span class="pl-k">-</span> before, <span class="pl-c1">2</span>))</td>
      </tr>
      <tr>
        <td id="L456" class="blob-num js-line-number" data-line-number="456"/>
        <td id="LC456" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L457" class="blob-num js-line-number" data-line-number="457"/>
        <td id="LC457" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L458" class="blob-num js-line-number" data-line-number="458"/>
        <td id="LC458" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L459" class="blob-num js-line-number" data-line-number="459"/>
        <td id="LC459" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L460" class="blob-num js-line-number" data-line-number="460"/>
        <td id="LC460" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">search_media</span>(<span class="pl-smi">input_string</span>):</td>
      </tr>
      <tr>
        <td id="L461" class="blob-num js-line-number" data-line-number="461"/>
        <td id="LC461" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Parse the SMJ7-style syntax, create the requisite SQL, and execute it. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L462" class="blob-num js-line-number" data-line-number="462"/>
        <td id="LC462" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L463" class="blob-num js-line-number" data-line-number="463"/>
        <td id="LC463" class="blob-code blob-code-inner js-file-line">    pre_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>select * from media where <span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L464" class="blob-num js-line-number" data-line-number="464"/>
        <td id="LC464" class="blob-code blob-code-inner js-file-line">    sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L465" class="blob-num js-line-number" data-line-number="465"/>
        <td id="LC465" class="blob-code blob-code-inner js-file-line">    post_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span> order by artist, album, discnumber, tracknumber<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L466" class="blob-num js-line-number" data-line-number="466"/>
        <td id="LC466" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L467" class="blob-num js-line-number" data-line-number="467"/>
        <td id="LC467" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># These will store the different columns we'll be searching:</span></td>
      </tr>
      <tr>
        <td id="L468" class="blob-num js-line-number" data-line-number="468"/>
        <td id="LC468" class="blob-code blob-code-inner js-file-line">    genre_params <span class="pl-k">=</span> []</td>
      </tr>
      <tr>
        <td id="L469" class="blob-num js-line-number" data-line-number="469"/>
        <td id="LC469" class="blob-code blob-code-inner js-file-line">    artist_params <span class="pl-k">=</span> []</td>
      </tr>
      <tr>
        <td id="L470" class="blob-num js-line-number" data-line-number="470"/>
        <td id="LC470" class="blob-code blob-code-inner js-file-line">    album_params <span class="pl-k">=</span> []</td>
      </tr>
      <tr>
        <td id="L471" class="blob-num js-line-number" data-line-number="471"/>
        <td id="LC471" class="blob-code blob-code-inner js-file-line">    title_params <span class="pl-k">=</span> []</td>
      </tr>
      <tr>
        <td id="L472" class="blob-num js-line-number" data-line-number="472"/>
        <td id="LC472" class="blob-code blob-code-inner js-file-line">    multi_params <span class="pl-k">=</span> []</td>
      </tr>
      <tr>
        <td id="L473" class="blob-num js-line-number" data-line-number="473"/>
        <td id="LC473" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L474" class="blob-num js-line-number" data-line-number="474"/>
        <td id="LC474" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># Break up the inputted string, get rid of whitespace, and filter it into the above categories:</span></td>
      </tr>
      <tr>
        <td id="L475" class="blob-num js-line-number" data-line-number="475"/>
        <td id="LC475" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> word <span class="pl-k">in</span> input_string.split(<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L476" class="blob-num js-line-number" data-line-number="476"/>
        <td id="LC476" class="blob-code blob-code-inner js-file-line">        word <span class="pl-k">=</span> word.strip()</td>
      </tr>
      <tr>
        <td id="L477" class="blob-num js-line-number" data-line-number="477"/>
        <td id="LC477" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L478" class="blob-num js-line-number" data-line-number="478"/>
        <td id="LC478" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> word.startswith(<span class="pl-s"><span class="pl-pds">'</span>!<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L479" class="blob-num js-line-number" data-line-number="479"/>
        <td id="LC479" class="blob-code blob-code-inner js-file-line">            genre_params.append(word[<span class="pl-c1">1</span>:])</td>
      </tr>
      <tr>
        <td id="L480" class="blob-num js-line-number" data-line-number="480"/>
        <td id="LC480" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L481" class="blob-num js-line-number" data-line-number="481"/>
        <td id="LC481" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">elif</span> word.startswith(<span class="pl-s"><span class="pl-pds">'</span>@<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L482" class="blob-num js-line-number" data-line-number="482"/>
        <td id="LC482" class="blob-code blob-code-inner js-file-line">            artist_params.append(word[<span class="pl-c1">1</span>:])</td>
      </tr>
      <tr>
        <td id="L483" class="blob-num js-line-number" data-line-number="483"/>
        <td id="LC483" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L484" class="blob-num js-line-number" data-line-number="484"/>
        <td id="LC484" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">elif</span> word.startswith(<span class="pl-s"><span class="pl-pds">'</span>#<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L485" class="blob-num js-line-number" data-line-number="485"/>
        <td id="LC485" class="blob-code blob-code-inner js-file-line">            album_params.append(word[<span class="pl-c1">1</span>:])</td>
      </tr>
      <tr>
        <td id="L486" class="blob-num js-line-number" data-line-number="486"/>
        <td id="LC486" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L487" class="blob-num js-line-number" data-line-number="487"/>
        <td id="LC487" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">elif</span> word.startswith(<span class="pl-s"><span class="pl-pds">'</span>$<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L488" class="blob-num js-line-number" data-line-number="488"/>
        <td id="LC488" class="blob-code blob-code-inner js-file-line">            title_params.append(word[<span class="pl-c1">1</span>:])</td>
      </tr>
      <tr>
        <td id="L489" class="blob-num js-line-number" data-line-number="489"/>
        <td id="LC489" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L490" class="blob-num js-line-number" data-line-number="490"/>
        <td id="LC490" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L491" class="blob-num js-line-number" data-line-number="491"/>
        <td id="LC491" class="blob-code blob-code-inner js-file-line">            multi_params.append(word)</td>
      </tr>
      <tr>
        <td id="L492" class="blob-num js-line-number" data-line-number="492"/>
        <td id="LC492" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L493" class="blob-num js-line-number" data-line-number="493"/>
        <td id="LC493" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># These SQL blocks logically OR same-category (same-column) parameters, and group them:</span></td>
      </tr>
      <tr>
        <td id="L494" class="blob-num js-line-number" data-line-number="494"/>
        <td id="LC494" class="blob-code blob-code-inner js-file-line">    genre_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>(<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> or <span class="pl-pds">'</span></span>.join([<span class="pl-s"><span class="pl-pds">'</span>genre like ?<span class="pl-pds">'</span></span>] <span class="pl-k">*</span> <span class="pl-c1">len</span>(genre_params)) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>)<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L495" class="blob-num js-line-number" data-line-number="495"/>
        <td id="LC495" class="blob-code blob-code-inner js-file-line">    artist_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>(<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> or <span class="pl-pds">'</span></span>.join([<span class="pl-s"><span class="pl-pds">'</span>artist like ?<span class="pl-pds">'</span></span>] <span class="pl-k">*</span> <span class="pl-c1">len</span>(artist_params)) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>)<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L496" class="blob-num js-line-number" data-line-number="496"/>
        <td id="LC496" class="blob-code blob-code-inner js-file-line">    album_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>(<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> or <span class="pl-pds">'</span></span>.join([<span class="pl-s"><span class="pl-pds">'</span>album like ?<span class="pl-pds">'</span></span>] <span class="pl-k">*</span> <span class="pl-c1">len</span>(album_params)) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>)<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L497" class="blob-num js-line-number" data-line-number="497"/>
        <td id="LC497" class="blob-code blob-code-inner js-file-line">    title_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>(<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> or <span class="pl-pds">'</span></span>.join([<span class="pl-s"><span class="pl-pds">'</span>title like ?<span class="pl-pds">'</span></span>] <span class="pl-k">*</span> <span class="pl-c1">len</span>(title_params)) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>)<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L498" class="blob-num js-line-number" data-line-number="498"/>
        <td id="LC498" class="blob-code blob-code-inner js-file-line">    multi_sql <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>(<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> or <span class="pl-pds">'</span></span>.join([<span class="pl-s"><span class="pl-pds">'</span>artist like ? or album like ? or title like ?<span class="pl-pds">'</span></span>] <span class="pl-k">*</span> <span class="pl-c1">len</span>(multi_params)) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>)<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L499" class="blob-num js-line-number" data-line-number="499"/>
        <td id="LC499" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L500" class="blob-num js-line-number" data-line-number="500"/>
        <td id="LC500" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># This logically ANDs together the OR blocks from above:</span></td>
      </tr>
      <tr>
        <td id="L501" class="blob-num js-line-number" data-line-number="501"/>
        <td id="LC501" class="blob-code blob-code-inner js-file-line">    sql <span class="pl-k">=</span> pre_sql <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> and <span class="pl-pds">'</span></span>.join(<span class="pl-c1">filter</span>(<span class="pl-k">lambda</span> <span class="pl-smi">x</span>: <span class="pl-c1">len</span>(x) <span class="pl-k">&gt;</span> <span class="pl-c1">2</span>,</td>
      </tr>
      <tr>
        <td id="L502" class="blob-num js-line-number" data-line-number="502"/>
        <td id="LC502" class="blob-code blob-code-inner js-file-line">                                        [genre_sql, artist_sql, album_sql,</td>
      </tr>
      <tr>
        <td id="L503" class="blob-num js-line-number" data-line-number="503"/>
        <td id="LC503" class="blob-code blob-code-inner js-file-line">                                         title_sql, multi_sql])) <span class="pl-k">+</span> post_sql</td>
      </tr>
      <tr>
        <td id="L504" class="blob-num js-line-number" data-line-number="504"/>
        <td id="LC504" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L505" class="blob-num js-line-number" data-line-number="505"/>
        <td id="LC505" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># This creates the actual collection of variables for use with SQLite's "?" substitution:</span></td>
      </tr>
      <tr>
        <td id="L506" class="blob-num js-line-number" data-line-number="506"/>
        <td id="LC506" class="blob-code blob-code-inner js-file-line">    sql_params <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>%<span class="pl-pds">'</span></span> <span class="pl-k">+</span> param <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>%<span class="pl-pds">'</span></span> <span class="pl-k">for</span> param <span class="pl-k">in</span> genre_params <span class="pl-k">+</span> artist_params <span class="pl-k">+</span></td>
      </tr>
      <tr>
        <td id="L507" class="blob-num js-line-number" data-line-number="507"/>
        <td id="LC507" class="blob-code blob-code-inner js-file-line">                  album_params <span class="pl-k">+</span> title_params <span class="pl-k">+</span> multi_params <span class="pl-k">*</span> <span class="pl-c1">3</span>]</td>
      </tr>
      <tr>
        <td id="L508" class="blob-num js-line-number" data-line-number="508"/>
        <td id="LC508" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L509" class="blob-num js-line-number" data-line-number="509"/>
        <td id="LC509" class="blob-code blob-code-inner js-file-line">    logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Crafted SQL statement: "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span> sql)</td>
      </tr>
      <tr>
        <td id="L510" class="blob-num js-line-number" data-line-number="510"/>
        <td id="LC510" class="blob-code blob-code-inner js-file-line">    logger.debug(<span class="pl-s"><span class="pl-pds">'</span>Crafted SQL variables: "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span> sql_params)</td>
      </tr>
      <tr>
        <td id="L511" class="blob-num js-line-number" data-line-number="511"/>
        <td id="LC511" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L512" class="blob-num js-line-number" data-line-number="512"/>
        <td id="LC512" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> do_sql(sql, <span class="pl-v">column_data</span><span class="pl-k">=</span>sql_params)</td>
      </tr>
      <tr>
        <td id="L513" class="blob-num js-line-number" data-line-number="513"/>
        <td id="LC513" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L514" class="blob-num js-line-number" data-line-number="514"/>
        <td id="LC514" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L515" class="blob-num js-line-number" data-line-number="515"/>
        <td id="LC515" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L516" class="blob-num js-line-number" data-line-number="516"/>
        <td id="LC516" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L517" class="blob-num js-line-number" data-line-number="517"/>
        <td id="LC517" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">playlist_handler</span>(<span class="pl-smi">input_string</span>, <span class="pl-smi">media_entries</span>):</td>
      </tr>
      <tr>
        <td id="L518" class="blob-num js-line-number" data-line-number="518"/>
        <td id="LC518" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Handle the commands needed to generate a playlist. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L519" class="blob-num js-line-number" data-line-number="519"/>
        <td id="LC519" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L520" class="blob-num js-line-number" data-line-number="520"/>
        <td id="LC520" class="blob-code blob-code-inner js-file-line">    input_string <span class="pl-k">=</span> input_string.strip()</td>
      </tr>
      <tr>
        <td id="L521" class="blob-num js-line-number" data-line-number="521"/>
        <td id="LC521" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L522" class="blob-num js-line-number" data-line-number="522"/>
        <td id="LC522" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> input_string.isdigit():</td>
      </tr>
      <tr>
        <td id="L523" class="blob-num js-line-number" data-line-number="523"/>
        <td id="LC523" class="blob-code blob-code-inner js-file-line">        input_string <span class="pl-k">=</span> <span class="pl-c1">int</span>(input_string)</td>
      </tr>
      <tr>
        <td id="L524" class="blob-num js-line-number" data-line-number="524"/>
        <td id="LC524" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-c1">0</span> <span class="pl-k">&lt;</span> input_string <span class="pl-k">&lt;=</span> <span class="pl-c1">len</span>(media_entries):</td>
      </tr>
      <tr>
        <td id="L525" class="blob-num js-line-number" data-line-number="525"/>
        <td id="LC525" class="blob-code blob-code-inner js-file-line">            play(media_entries[input_string <span class="pl-k">-</span> <span class="pl-c1">1</span>:])</td>
      </tr>
      <tr>
        <td id="L526" class="blob-num js-line-number" data-line-number="526"/>
        <td id="LC526" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L527" class="blob-num js-line-number" data-line-number="527"/>
        <td id="LC527" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>Enter value from 1 to <span class="pl-c1">%s</span>, try again.<span class="pl-pds">'</span></span> <span class="pl-k">%</span> <span class="pl-c1">len</span>(media_entries)</td>
      </tr>
      <tr>
        <td id="L528" class="blob-num js-line-number" data-line-number="528"/>
        <td id="LC528" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L529" class="blob-num js-line-number" data-line-number="529"/>
        <td id="LC529" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">elif</span> input_string.startswith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>) <span class="pl-k">or</span> input_string <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>:</td>
      </tr>
      <tr>
        <td id="L530" class="blob-num js-line-number" data-line-number="530"/>
        <td id="LC530" class="blob-code blob-code-inner js-file-line">        play(media_entries)</td>
      </tr>
      <tr>
        <td id="L531" class="blob-num js-line-number" data-line-number="531"/>
        <td id="LC531" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L532" class="blob-num js-line-number" data-line-number="532"/>
        <td id="LC532" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">elif</span> input_string.startswith(<span class="pl-s"><span class="pl-pds">'</span>r<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L533" class="blob-num js-line-number" data-line-number="533"/>
        <td id="LC533" class="blob-code blob-code-inner js-file-line">        play([random_choice(media_entries)])</td>
      </tr>
      <tr>
        <td id="L534" class="blob-num js-line-number" data-line-number="534"/>
        <td id="LC534" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L535" class="blob-num js-line-number" data-line-number="535"/>
        <td id="LC535" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">elif</span> input_string.startswith(<span class="pl-s"><span class="pl-pds">'</span>s<span class="pl-pds">'</span></span>):</td>
      </tr>
      <tr>
        <td id="L536" class="blob-num js-line-number" data-line-number="536"/>
        <td id="LC536" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"># random.shuffle does it in-place:</span></td>
      </tr>
      <tr>
        <td id="L537" class="blob-num js-line-number" data-line-number="537"/>
        <td id="LC537" class="blob-code blob-code-inner js-file-line">        shuffle(media_entries)</td>
      </tr>
      <tr>
        <td id="L538" class="blob-num js-line-number" data-line-number="538"/>
        <td id="LC538" class="blob-code blob-code-inner js-file-line">        play(media_entries)</td>
      </tr>
      <tr>
        <td id="L539" class="blob-num js-line-number" data-line-number="539"/>
        <td id="LC539" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L540" class="blob-num js-line-number" data-line-number="540"/>
        <td id="LC540" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L541" class="blob-num js-line-number" data-line-number="541"/>
        <td id="LC541" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">'</span>Not a valid playlist command, try again.<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L542" class="blob-num js-line-number" data-line-number="542"/>
        <td id="LC542" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L543" class="blob-num js-line-number" data-line-number="543"/>
        <td id="LC543" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># -------------------------------------------------------------------------------------------------</span></td>
      </tr>
      <tr>
        <td id="L544" class="blob-num js-line-number" data-line-number="544"/>
        <td id="LC544" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L545" class="blob-num js-line-number" data-line-number="545"/>
        <td id="LC545" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L546" class="blob-num js-line-number" data-line-number="546"/>
        <td id="LC546" class="blob-code blob-code-inner js-file-line"><span class="pl-k">def</span> <span class="pl-en">jsonizer</span>(<span class="pl-smi">media_entries</span>, <span class="pl-smi">show_paths</span><span class="pl-k">=</span>args.show_paths):</td>
      </tr>
      <tr>
        <td id="L547" class="blob-num js-line-number" data-line-number="547"/>
        <td id="LC547" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">'''</span> Convert track-specific media entries to artist: album: track hierarchy, in JSON. <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L548" class="blob-num js-line-number" data-line-number="548"/>
        <td id="LC548" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L549" class="blob-num js-line-number" data-line-number="549"/>
        <td id="LC549" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> args.indent <span class="pl-k">==</span> <span class="pl-c1">0</span>:</td>
      </tr>
      <tr>
        <td id="L550" class="blob-num js-line-number" data-line-number="550"/>
        <td id="LC550" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"># Must be None type to disable newlines:</span></td>
      </tr>
      <tr>
        <td id="L551" class="blob-num js-line-number" data-line-number="551"/>
        <td id="LC551" class="blob-code blob-code-inner js-file-line">        json_indentation_option <span class="pl-k">=</span> <span class="pl-c1">None</span></td>
      </tr>
      <tr>
        <td id="L552" class="blob-num js-line-number" data-line-number="552"/>
        <td id="LC552" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L553" class="blob-num js-line-number" data-line-number="553"/>
        <td id="LC553" class="blob-code blob-code-inner js-file-line">        json_indentation_option <span class="pl-k">=</span> args.indent</td>
      </tr>
      <tr>
        <td id="L554" class="blob-num js-line-number" data-line-number="554"/>
        <td id="LC554" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L555" class="blob-num js-line-number" data-line-number="555"/>
        <td id="LC555" class="blob-code blob-code-inner js-file-line">    hierarchy <span class="pl-k">=</span> {}</td>
      </tr>
      <tr>
        <td id="L556" class="blob-num js-line-number" data-line-number="556"/>
        <td id="LC556" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L557" class="blob-num js-line-number" data-line-number="557"/>
        <td id="LC557" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> media <span class="pl-k">in</span> media_entries:</td>
      </tr>
      <tr>
        <td id="L558" class="blob-num js-line-number" data-line-number="558"/>
        <td id="LC558" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> show_paths:</td>
      </tr>
      <tr>
        <td id="L559" class="blob-num js-line-number" data-line-number="559"/>
        <td id="LC559" class="blob-code blob-code-inner js-file-line">            track <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>: media[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>], <span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>: media[<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>]}</td>
      </tr>
      <tr>
        <td id="L560" class="blob-num js-line-number" data-line-number="560"/>
        <td id="LC560" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L561" class="blob-num js-line-number" data-line-number="561"/>
        <td id="LC561" class="blob-code blob-code-inner js-file-line">            track <span class="pl-k">=</span> media[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L562" class="blob-num js-line-number" data-line-number="562"/>
        <td id="LC562" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L563" class="blob-num js-line-number" data-line-number="563"/>
        <td id="LC563" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> media[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>] <span class="pl-k">in</span> hierarchy:</td>
      </tr>
      <tr>
        <td id="L564" class="blob-num js-line-number" data-line-number="564"/>
        <td id="LC564" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> media[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>] <span class="pl-k">in</span> hierarchy[media[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]]:</td>
      </tr>
      <tr>
        <td id="L565" class="blob-num js-line-number" data-line-number="565"/>
        <td id="LC565" class="blob-code blob-code-inner js-file-line">                hierarchy[media[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]][media[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>]].append(track)</td>
      </tr>
      <tr>
        <td id="L566" class="blob-num js-line-number" data-line-number="566"/>
        <td id="LC566" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L567" class="blob-num js-line-number" data-line-number="567"/>
        <td id="LC567" class="blob-code blob-code-inner js-file-line">                hierarchy[media[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]][media[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>]] <span class="pl-k">=</span> [track]</td>
      </tr>
      <tr>
        <td id="L568" class="blob-num js-line-number" data-line-number="568"/>
        <td id="LC568" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L569" class="blob-num js-line-number" data-line-number="569"/>
        <td id="LC569" class="blob-code blob-code-inner js-file-line">            hierarchy[media[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]] <span class="pl-k">=</span> {media[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>]: [track]}</td>
      </tr>
      <tr>
        <td id="L570" class="blob-num js-line-number" data-line-number="570"/>
        <td id="LC570" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L571" class="blob-num js-line-number" data-line-number="571"/>
        <td id="LC571" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> dumps(hierarchy, <span class="pl-v">indent</span><span class="pl-k">=</span>json_indentation_option)</td>
      </tr>
      <tr>
        <td id="L572" class="blob-num js-line-number" data-line-number="572"/>
        <td id="LC572" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L573" class="blob-num js-line-number" data-line-number="573"/>
        <td id="LC573" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># =================================================================================================</span></td>
      </tr>
      <tr>
        <td id="L574" class="blob-num js-line-number" data-line-number="574"/>
        <td id="LC574" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># Main program logic</span></td>
      </tr>
      <tr>
        <td id="L575" class="blob-num js-line-number" data-line-number="575"/>
        <td id="LC575" class="blob-code blob-code-inner js-file-line"><span class="pl-c"># =================================================================================================</span></td>
      </tr>
      <tr>
        <td id="L576" class="blob-num js-line-number" data-line-number="576"/>
        <td id="LC576" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L577" class="blob-num js-line-number" data-line-number="577"/>
        <td id="LC577" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:</td>
      </tr>
      <tr>
        <td id="L578" class="blob-num js-line-number" data-line-number="578"/>
        <td id="LC578" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L579" class="blob-num js-line-number" data-line-number="579"/>
        <td id="LC579" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-k">not</span> os.path.exists(args.location):</td>
      </tr>
      <tr>
        <td id="L580" class="blob-num js-line-number" data-line-number="580"/>
        <td id="LC580" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">exit</span>(<span class="pl-s"><span class="pl-pds">'</span>Cannot scan a nonexistent path: "<span class="pl-c1">%s</span>"<span class="pl-pds">'</span></span> <span class="pl-k">%</span> args.location)</td>
      </tr>
      <tr>
        <td id="L581" class="blob-num js-line-number" data-line-number="581"/>
        <td id="LC581" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L582" class="blob-num js-line-number" data-line-number="582"/>
        <td id="LC582" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> os.path.exists(args.database):</td>
      </tr>
      <tr>
        <td id="L583" class="blob-num js-line-number" data-line-number="583"/>
        <td id="LC583" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> args.force_rescan:</td>
      </tr>
      <tr>
        <td id="L584" class="blob-num js-line-number" data-line-number="584"/>
        <td id="LC584" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"># SQLite doesn't like truncating:</span></td>
      </tr>
      <tr>
        <td id="L585" class="blob-num js-line-number" data-line-number="585"/>
        <td id="LC585" class="blob-code blob-code-inner js-file-line">            os.remove(args.database)</td>
      </tr>
      <tr>
        <td id="L586" class="blob-num js-line-number" data-line-number="586"/>
        <td id="LC586" class="blob-code blob-code-inner js-file-line">            make_db()</td>
      </tr>
      <tr>
        <td id="L587" class="blob-num js-line-number" data-line-number="587"/>
        <td id="LC587" class="blob-code blob-code-inner js-file-line">            index_media()</td>
      </tr>
      <tr>
        <td id="L588" class="blob-num js-line-number" data-line-number="588"/>
        <td id="LC588" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L589" class="blob-num js-line-number" data-line-number="589"/>
        <td id="LC589" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">elif</span> args.freshen:</td>
      </tr>
      <tr>
        <td id="L590" class="blob-num js-line-number" data-line-number="590"/>
        <td id="LC590" class="blob-code blob-code-inner js-file-line">            index_media()</td>
      </tr>
      <tr>
        <td id="L591" class="blob-num js-line-number" data-line-number="591"/>
        <td id="LC591" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L592" class="blob-num js-line-number" data-line-number="592"/>
        <td id="LC592" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> args.prune:</td>
      </tr>
      <tr>
        <td id="L593" class="blob-num js-line-number" data-line-number="593"/>
        <td id="LC593" class="blob-code blob-code-inner js-file-line">            remove_stale_entries()</td>
      </tr>
      <tr>
        <td id="L594" class="blob-num js-line-number" data-line-number="594"/>
        <td id="LC594" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L595" class="blob-num js-line-number" data-line-number="595"/>
        <td id="LC595" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L596" class="blob-num js-line-number" data-line-number="596"/>
        <td id="LC596" class="blob-code blob-code-inner js-file-line">        make_db()</td>
      </tr>
      <tr>
        <td id="L597" class="blob-num js-line-number" data-line-number="597"/>
        <td id="LC597" class="blob-code blob-code-inner js-file-line">        index_media()</td>
      </tr>
      <tr>
        <td id="L598" class="blob-num js-line-number" data-line-number="598"/>
        <td id="LC598" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L599" class="blob-num js-line-number" data-line-number="599"/>
        <td id="LC599" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># If someone wants a full dump of their music collection:</span></td>
      </tr>
      <tr>
        <td id="L600" class="blob-num js-line-number" data-line-number="600"/>
        <td id="LC600" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> args.json <span class="pl-k">and</span> <span class="pl-k">not</span> args.query:</td>
      </tr>
      <tr>
        <td id="L601" class="blob-num js-line-number" data-line-number="601"/>
        <td id="LC601" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">print</span> jsonizer(do_sql(<span class="pl-s"><span class="pl-pds">'</span>select * from media<span class="pl-pds">'</span></span>))</td>
      </tr>
      <tr>
        <td id="L602" class="blob-num js-line-number" data-line-number="602"/>
        <td id="LC602" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">exit</span>()</td>
      </tr>
      <tr>
        <td id="L603" class="blob-num js-line-number" data-line-number="603"/>
        <td id="LC603" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L604" class="blob-num js-line-number" data-line-number="604"/>
        <td id="LC604" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># For non-interactive searching:</span></td>
      </tr>
      <tr>
        <td id="L605" class="blob-num js-line-number" data-line-number="605"/>
        <td id="LC605" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> args.query:</td>
      </tr>
      <tr>
        <td id="L606" class="blob-num js-line-number" data-line-number="606"/>
        <td id="LC606" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-s"><span class="pl-pds">'</span>;<span class="pl-pds">'</span></span> <span class="pl-k">in</span> args.query:</td>
      </tr>
      <tr>
        <td id="L607" class="blob-num js-line-number" data-line-number="607"/>
        <td id="LC607" class="blob-code blob-code-inner js-file-line">            query, command <span class="pl-k">=</span> args.query.split(<span class="pl-s"><span class="pl-pds">'</span>;<span class="pl-pds">'</span></span>)</td>
      </tr>
      <tr>
        <td id="L608" class="blob-num js-line-number" data-line-number="608"/>
        <td id="LC608" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L609" class="blob-num js-line-number" data-line-number="609"/>
        <td id="LC609" class="blob-code blob-code-inner js-file-line">            query <span class="pl-k">=</span> args.query</td>
      </tr>
      <tr>
        <td id="L610" class="blob-num js-line-number" data-line-number="610"/>
        <td id="LC610" class="blob-code blob-code-inner js-file-line">            command <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L611" class="blob-num js-line-number" data-line-number="611"/>
        <td id="LC611" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L612" class="blob-num js-line-number" data-line-number="612"/>
        <td id="LC612" class="blob-code blob-code-inner js-file-line">        results <span class="pl-k">=</span> search_media(query)</td>
      </tr>
      <tr>
        <td id="L613" class="blob-num js-line-number" data-line-number="613"/>
        <td id="LC613" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L614" class="blob-num js-line-number" data-line-number="614"/>
        <td id="LC614" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> args.json:</td>
      </tr>
      <tr>
        <td id="L615" class="blob-num js-line-number" data-line-number="615"/>
        <td id="LC615" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"># sqlite.Row objects are not JSON serializable, `dict` them here:</span></td>
      </tr>
      <tr>
        <td id="L616" class="blob-num js-line-number" data-line-number="616"/>
        <td id="LC616" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> jsonizer(results)</td>
      </tr>
      <tr>
        <td id="L617" class="blob-num js-line-number" data-line-number="617"/>
        <td id="LC617" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"># Exit as JSON is not intended for playback:</span></td>
      </tr>
      <tr>
        <td id="L618" class="blob-num js-line-number" data-line-number="618"/>
        <td id="LC618" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">exit</span>()</td>
      </tr>
      <tr>
        <td id="L619" class="blob-num js-line-number" data-line-number="619"/>
        <td id="LC619" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L620" class="blob-num js-line-number" data-line-number="620"/>
        <td id="LC620" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"># Finally kick off the results and playlist command for playback:</span></td>
      </tr>
      <tr>
        <td id="L621" class="blob-num js-line-number" data-line-number="621"/>
        <td id="LC621" class="blob-code blob-code-inner js-file-line">        playlist_handler(command, results)</td>
      </tr>
      <tr>
        <td id="L622" class="blob-num js-line-number" data-line-number="622"/>
        <td id="LC622" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"># Exit otherwise we will fall through to interactive mode:</span></td>
      </tr>
      <tr>
        <td id="L623" class="blob-num js-line-number" data-line-number="623"/>
        <td id="LC623" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">exit</span>()</td>
      </tr>
      <tr>
        <td id="L624" class="blob-num js-line-number" data-line-number="624"/>
        <td id="LC624" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L625" class="blob-num js-line-number" data-line-number="625"/>
        <td id="LC625" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># =============================================================================================</span></td>
      </tr>
      <tr>
        <td id="L626" class="blob-num js-line-number" data-line-number="626"/>
        <td id="LC626" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># Interactive loop</span></td>
      </tr>
      <tr>
        <td id="L627" class="blob-num js-line-number" data-line-number="627"/>
        <td id="LC627" class="blob-code blob-code-inner js-file-line">    <span class="pl-c"># =============================================================================================</span></td>
      </tr>
      <tr>
        <td id="L628" class="blob-num js-line-number" data-line-number="628"/>
        <td id="LC628" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L629" class="blob-num js-line-number" data-line-number="629"/>
        <td id="LC629" class="blob-code blob-code-inner js-file-line">    count <span class="pl-k">=</span> do_sql(<span class="pl-s"><span class="pl-pds">'</span>select count(path) from media<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>][<span class="pl-c1">0</span>]</td>
      </tr>
      <tr>
        <td id="L630" class="blob-num js-line-number" data-line-number="630"/>
        <td id="LC630" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L631" class="blob-num js-line-number" data-line-number="631"/>
        <td id="LC631" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>For help with SMJ7-style syntax, use ./smj7.py --syntax<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L632" class="blob-num js-line-number" data-line-number="632"/>
        <td id="LC632" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>Available parameters: !genre, @artist name, #album name, $track name<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L633" class="blob-num js-line-number" data-line-number="633"/>
        <td id="LC633" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L634" class="blob-num js-line-number" data-line-number="634"/>
        <td id="LC634" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">while</span> <span class="pl-c1">True</span>:</td>
      </tr>
      <tr>
        <td id="L635" class="blob-num js-line-number" data-line-number="635"/>
        <td id="LC635" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">try</span>:</td>
      </tr>
      <tr>
        <td id="L636" class="blob-num js-line-number" data-line-number="636"/>
        <td id="LC636" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"># Python 2.7 is required for: '{:,}'.format(&lt;value&gt;) to make it add commas to 1,000s:</span></td>
      </tr>
      <tr>
        <td id="L637" class="blob-num js-line-number" data-line-number="637"/>
        <td id="LC637" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">input</span> <span class="pl-k">=</span> <span class="pl-v">raw_input</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>[SMJ7 | <span class="pl-c1">%s</span> files] &gt; <span class="pl-pds">'</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-c1">{<span class="pl-c1">:,</span>}</span><span class="pl-pds">'</span></span>.format(count))</td>
      </tr>
      <tr>
        <td id="L638" class="blob-num js-line-number" data-line-number="638"/>
        <td id="LC638" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L639" class="blob-num js-line-number" data-line-number="639"/>
        <td id="LC639" class="blob-code blob-code-inner js-file-line">            results <span class="pl-k">=</span> search_media(<span class="pl-c1">input</span>)</td>
      </tr>
      <tr>
        <td id="L640" class="blob-num js-line-number" data-line-number="640"/>
        <td id="LC640" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L641" class="blob-num js-line-number" data-line-number="641"/>
        <td id="LC641" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> <span class="pl-c1">len</span>(results) <span class="pl-k">==</span> <span class="pl-c1">1</span>:</td>
      </tr>
      <tr>
        <td id="L642" class="blob-num js-line-number" data-line-number="642"/>
        <td id="LC642" class="blob-code blob-code-inner js-file-line">                play(results)</td>
      </tr>
      <tr>
        <td id="L643" class="blob-num js-line-number" data-line-number="643"/>
        <td id="LC643" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L644" class="blob-num js-line-number" data-line-number="644"/>
        <td id="LC644" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">elif</span> <span class="pl-c1">len</span>(results) <span class="pl-k">&gt;</span> <span class="pl-c1">1</span>:</td>
      </tr>
      <tr>
        <td id="L645" class="blob-num js-line-number" data-line-number="645"/>
        <td id="LC645" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L646" class="blob-num js-line-number" data-line-number="646"/>
        <td id="LC646" class="blob-code blob-code-inner js-file-line">                <span class="pl-c"># Store the last used artist and album for grouping:</span></td>
      </tr>
      <tr>
        <td id="L647" class="blob-num js-line-number" data-line-number="647"/>
        <td id="LC647" class="blob-code blob-code-inner js-file-line">                artist <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L648" class="blob-num js-line-number" data-line-number="648"/>
        <td id="LC648" class="blob-code blob-code-inner js-file-line">                album <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L649" class="blob-num js-line-number" data-line-number="649"/>
        <td id="LC649" class="blob-code blob-code-inner js-file-line">                <span class="pl-s"><span class="pl-pds">'''</span> Print results in the form of:</span></td>
      </tr>
      <tr>
        <td id="L650" class="blob-num js-line-number" data-line-number="650"/>
        <td id="LC650" class="blob-code blob-code-inner js-file-line"><span class="pl-s">                    # Artist 1</span></td>
      </tr>
      <tr>
        <td id="L651" class="blob-num js-line-number" data-line-number="651"/>
        <td id="LC651" class="blob-code blob-code-inner js-file-line"><span class="pl-s">                     ## Album 1</span></td>
      </tr>
      <tr>
        <td id="L652" class="blob-num js-line-number" data-line-number="652"/>
        <td id="LC652" class="blob-code blob-code-inner js-file-line"><span class="pl-s">                        [1] Track 1</span></td>
      </tr>
      <tr>
        <td id="L653" class="blob-num js-line-number" data-line-number="653"/>
        <td id="LC653" class="blob-code blob-code-inner js-file-line"><span class="pl-s">                        [2] Track 2</span></td>
      </tr>
      <tr>
        <td id="L654" class="blob-num js-line-number" data-line-number="654"/>
        <td id="LC654" class="blob-code blob-code-inner js-file-line"><span class="pl-s">                <span class="pl-pds">'''</span></span></td>
      </tr>
      <tr>
        <td id="L655" class="blob-num js-line-number" data-line-number="655"/>
        <td id="LC655" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L656" class="blob-num js-line-number" data-line-number="656"/>
        <td id="LC656" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">for</span> i, result <span class="pl-k">in</span> <span class="pl-c1">enumerate</span>(results):</td>
      </tr>
      <tr>
        <td id="L657" class="blob-num js-line-number" data-line-number="657"/>
        <td id="LC657" class="blob-code blob-code-inner js-file-line">                    <span class="pl-c"># Pad out the number so all of them line up:</span></td>
      </tr>
      <tr>
        <td id="L658" class="blob-num js-line-number" data-line-number="658"/>
        <td id="LC658" class="blob-code blob-code-inner js-file-line">                    i <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>[ <span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-c1">str</span>(i <span class="pl-k">+</span> <span class="pl-c1">1</span>).rjust(<span class="pl-c1">int</span>(log10(<span class="pl-c1">len</span>(results))) <span class="pl-k">+</span></td>
      </tr>
      <tr>
        <td id="L659" class="blob-num js-line-number" data-line-number="659"/>
        <td id="LC659" class="blob-code blob-code-inner js-file-line">                                                <span class="pl-c1">1</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> ]<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L660" class="blob-num js-line-number" data-line-number="660"/>
        <td id="LC660" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L661" class="blob-num js-line-number" data-line-number="661"/>
        <td id="LC661" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">if</span> artist <span class="pl-k">==</span> result[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]:</td>
      </tr>
      <tr>
        <td id="L662" class="blob-num js-line-number" data-line-number="662"/>
        <td id="LC662" class="blob-code blob-code-inner js-file-line">                        <span class="pl-k">if</span> album <span class="pl-k">==</span> result[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>]:</td>
      </tr>
      <tr>
        <td id="L663" class="blob-num js-line-number" data-line-number="663"/>
        <td id="LC663" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>    <span class="pl-pds">'</span></span>, i, result[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L664" class="blob-num js-line-number" data-line-number="664"/>
        <td id="LC664" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L665" class="blob-num js-line-number" data-line-number="665"/>
        <td id="LC665" class="blob-code blob-code-inner js-file-line">                        <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L666" class="blob-num js-line-number" data-line-number="666"/>
        <td id="LC666" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>  <span class="pl-pds">'</span></span>, result[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L667" class="blob-num js-line-number" data-line-number="667"/>
        <td id="LC667" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>   <span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>-<span class="pl-pds">'</span></span> <span class="pl-k">*</span> <span class="pl-c1">len</span>(result[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="L668" class="blob-num js-line-number" data-line-number="668"/>
        <td id="LC668" class="blob-code blob-code-inner js-file-line">                            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>    <span class="pl-pds">'</span></span>, i, result[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L669" class="blob-num js-line-number" data-line-number="669"/>
        <td id="LC669" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L670" class="blob-num js-line-number" data-line-number="670"/>
        <td id="LC670" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L671" class="blob-num js-line-number" data-line-number="671"/>
        <td id="LC671" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span><span class="pl-pds">'</span></span>, result[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L672" class="blob-num js-line-number" data-line-number="672"/>
        <td id="LC672" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>=<span class="pl-pds">'</span></span> <span class="pl-k">*</span> <span class="pl-c1">len</span>(result[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="L673" class="blob-num js-line-number" data-line-number="673"/>
        <td id="LC673" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>  <span class="pl-pds">'</span></span>, result[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L674" class="blob-num js-line-number" data-line-number="674"/>
        <td id="LC674" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>   <span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>-<span class="pl-pds">'</span></span> <span class="pl-k">*</span> <span class="pl-c1">len</span>(result[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>])</td>
      </tr>
      <tr>
        <td id="L675" class="blob-num js-line-number" data-line-number="675"/>
        <td id="LC675" class="blob-code blob-code-inner js-file-line">                        <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>    <span class="pl-pds">'</span></span>, i, result[<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L676" class="blob-num js-line-number" data-line-number="676"/>
        <td id="LC676" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L677" class="blob-num js-line-number" data-line-number="677"/>
        <td id="LC677" class="blob-code blob-code-inner js-file-line">                    artist <span class="pl-k">=</span> result[<span class="pl-s"><span class="pl-pds">'</span>artist<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L678" class="blob-num js-line-number" data-line-number="678"/>
        <td id="LC678" class="blob-code blob-code-inner js-file-line">                    album <span class="pl-k">=</span> result[<span class="pl-s"><span class="pl-pds">'</span>album<span class="pl-pds">'</span></span>]</td>
      </tr>
      <tr>
        <td id="L679" class="blob-num js-line-number" data-line-number="679"/>
        <td id="LC679" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L680" class="blob-num js-line-number" data-line-number="680"/>
        <td id="LC680" class="blob-code blob-code-inner js-file-line">                <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>Enter # to play, or one of: (A)ll, (R)andom choice, or (S)huffle all<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L681" class="blob-num js-line-number" data-line-number="681"/>
        <td id="LC681" class="blob-code blob-code-inner js-file-line">                choice <span class="pl-k">=</span> <span class="pl-v">raw_input</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>[Play command] &gt; <span class="pl-pds">'</span></span>).lower()</td>
      </tr>
      <tr>
        <td id="L682" class="blob-num js-line-number" data-line-number="682"/>
        <td id="LC682" class="blob-code blob-code-inner js-file-line">                playlist_handler(choice, results)</td>
      </tr>
      <tr>
        <td id="L683" class="blob-num js-line-number" data-line-number="683"/>
        <td id="LC683" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L684" class="blob-num js-line-number" data-line-number="684"/>
        <td id="LC684" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">else</span>:</td>
      </tr>
      <tr>
        <td id="L685" class="blob-num js-line-number" data-line-number="685"/>
        <td id="LC685" class="blob-code blob-code-inner js-file-line">                <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span>No results found.<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L686" class="blob-num js-line-number" data-line-number="686"/>
        <td id="LC686" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L687" class="blob-num js-line-number" data-line-number="687"/>
        <td id="LC687" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">except</span> <span class="pl-c1">KeyboardInterrupt</span>:</td>
      </tr>
      <tr>
        <td id="L688" class="blob-num js-line-number" data-line-number="688"/>
        <td id="LC688" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">'</span> ...<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L689" class="blob-num js-line-number" data-line-number="689"/>
        <td id="LC689" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">continue</span></td>
      </tr>
      <tr>
        <td id="L690" class="blob-num js-line-number" data-line-number="690"/>
        <td id="LC690" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="L691" class="blob-num js-line-number" data-line-number="691"/>
        <td id="LC691" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">except</span> <span class="pl-c1">EOFError</span>:</td>
      </tr>
      <tr>
        <td id="L692" class="blob-num js-line-number" data-line-number="692"/>
        <td id="LC692" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">print</span> <span class="pl-k">&gt;&gt;</span> sys.stderr, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span>Goodbye.<span class="pl-pds">'</span></span></td>
      </tr>
      <tr>
        <td id="L693" class="blob-num js-line-number" data-line-number="693"/>
        <td id="LC693" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">exit</span>(<span class="pl-c1">0</span>)</td>
      </tr>
</table>

  </div></body></html>