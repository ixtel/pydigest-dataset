<html><body><div><div class="content-body" itemprop="text articleBody">
	<div class="section" id="introduction">
<h2>Introduction</h2>
<p>Using python and pandas in the business world can be a very useful alternative
to the pain of manipulating Excel files. While this combination of technologies
is powerful, it can be challenging to convince others to use a python
script - especially when many may be intimidated by using the command line.
In this article I will show an example of how to easily create
an end-user-friendly <span class="caps">GUI</span> using the <a class="reference external" href="https://github.com/chriskiehl/Gooey">Gooey</a> library. This interface is based
on wxWindows so it looks like a “native” application on Windows, Mac and Linux.
Ultimately, I believe that presenting a simple user interface to your scripts can greatly
increase the adoption of python in your place of business.</p>
</div>
<div class="section" id="the-problem">
<h2>The Problem</h2>
<p>I will be basing the example in this article on my prior post - <a class="reference external" href="http://pbpython.com/excel-file-combine.html">Combining Data From Multiple Excel Files</a>.
The basic concept is that there is a periodic need to combine data from multiple
excel files into a “master file” and perform some additional manipulations.</p>
<p>Unfortunately this process is error prone and time consuming when someone tries to
do a lot of manual copying and pasting in Excel. However, it is relatively
straightforward to create python + pandas scripts to perform the
same manipulations in a more repeatable and robust format. However, as soon as
you ask the user to type something like the line below, you will lose them:</p>
<div class="highlight"><pre>python pandas_gui.py c:<span class="se">\U</span>sers<span class="se">\c</span>moffitt<span class="se">\D</span>ocuments<span class="se">\s</span>rc c:<span class="se">\u</span>sers<span class="se">\c</span>moffitt<span class="se">\D</span>ocuments<span class="se">\d</span>est c:<span class="se">\u</span>sers<span class="se">\c</span>moffitt<span class="se">\D</span>ocuments<span class="se">\c</span>ustomer-status.xlsx -d 9/6/2015
</pre></div>
<p>Instead, you could present them with a simple <span class="caps">GUI</span> that looks something like this:</p>

<p>The nice thing about this example is that you have standard windows directory and
file chooser dialogs along with a standard date picker widget. It will be a much
smoother transition for your users to use this <span class="caps">UI</span> than to try to remember how
to use the command line with all the various arguments shown above.</p>
<p>The rest of this article will explain how to create this <span class="caps">UI</span> with very minor
changes to the base code you would build using <code class="code">
argparse</code>
. If you are
not familiar with <code class="code">
argparse</code>
 then <a class="reference external" href="https://realpython.com/blog/python/comparing-python-command-line-parsing-libraries-argparse-docopt-click/">this article</a> might be helpful to reference
before you go much further. As shown in the article, <code class="code">
argparse</code>
 (and friends)
are very sophisticated libraries but I have found that you can create very
meaningful and useful tools with the very basic options I’ll show in this post.</p>
</div>
<div class="section" id="install">
<h2>Install</h2>
<p>Gooey requires <a class="reference external" href="http://www.wxpython.org/">wxPython</a> for its interface. wxPython can be a little
tricky to install but if you are using the <a class="reference external" href="https://store.continuum.io/cshop/anaconda/">Anaconda</a> or <a class="reference external" href="http://conda.pydata.org/miniconda.html">Miniconda</a> distribution
the install is as simple as:</p>

<p>I highly recommend using conda for the install process - especially on Windows.</p>
<p>Gooey can then be installed using pip:</p>

</div>
<div class="section" id="building-the-script">
<h2>Building The Script</h2>
<p>This <a class="reference external" href="https://github.com/chris1610/pbpython/blob/master/notebooks/Combining-Multiple-Excel-File-with-Pandas.ipynb">notebook</a> shows the basic idea for this program. What I will do next is
build a simple version of this using <code class="code">
argparse</code>
 to pass in the source
and destination directories as well as a location for the <strong>customer-status.xlsx</strong> file.</p>
<p>I am going to create a <code class="code">
parse_args</code>
 function to set up the following required inputs:</p>
<ul class="simple">
<li>data_directory</li>
<li>output_directory</li>
<li>Customer account status file</li>
</ul>
<p>I will add an example of an optional date argument as well but for the purposes
of this example, I do not actually use the value. As they say, that is an exercise
left to the reader.</p>
<p>The simplest example of argparse would look something like this:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Create Quarterly Marketing Report'</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Source directory that contains Excel files"</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'output_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Output directory to save summary report"</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'cust_file'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Customer Account Status File'</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Start date to include'</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
<p>When you are ready to access your arguments, you can get them like this:</p>
<div class="highlight"><pre><span class="n">source</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">data_directory</span>
<span class="n">dest</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">output_directory</span>
</pre></div>
<p>One other unique aspect to this code is that I added a simple json dump of the
arguments and restore them as the default next time the script is executed. I
originally did this to streamline the testing process but realize that this would
be helpful in the real world too. Here is the full code sample with the default
values filled in based on the previous execution of the script.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>

<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="sd">""" Use ArgParser to build up the arguments we will use in our script</span>
<span class="sd">    Save the arguments in a default json file so that we can retrieve them</span>
<span class="sd">    every time we run the script.</span>
<span class="sd">    """</span>
    <span class="n">stored_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># get the script name without the extension &amp; use it to build up</span>
    <span class="c"># the json filename</span>
    <span class="n">script_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">__file__</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">args_file</span> <span class="o">=</span> <span class="s">"{}-args.json"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_name</span><span class="p">)</span>
    <span class="c"># Read in the prior arguments as a dictionary</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args_file</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">stored_args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Create Quarterly Marketing Report'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Source directory that contains Excel files"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'output_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'output_directory'</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Output directory to save summary report"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'cust_file'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'cust_file'</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Customer Account Status File'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Start date to include'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'d'</span><span class="p">))</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c"># Store the values of the arguments so we have them next time we run</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
        <span class="c"># Using vars(args) returns the data as a dictionary</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">data_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>
</pre></div>
<p>This code allows us to do a basic command line interface that looks like this:</p>
<div class="highlight"><pre>python pandas_gui_args.py --help

usage: pandas_gui_args.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-d D<span class="o">]</span>
                          data_directory output_directory cust_file

Create Quarterly Marketing Report

positional arguments:
  data_directory    Source directory that contains Excel files
  output_directory  Output directory to save summary report
  cust_file         Customer Account Status File

optional arguments:
  -h, --help        show this <span class="nb">help </span>message and <span class="nb">exit</span>
  -d D              Start date to include
</pre></div>
<p>The main section of the code would look like the section below. The basic flow is:</p>
<ul class="simple">
<li>Get the command line inputs</li>
<li>Pass the appropriate ones to the input and processing functions</li>
<li>Save the data to the desired location</li>
</ul>
<div class="highlight"><pre><span class="k">if</span> <span class="nv">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span>:
    <span class="nv">conf</span> <span class="o">=</span> parse_args<span class="o">()</span>
    print<span class="o">(</span><span class="s2">"Reading sales files"</span><span class="o">)</span>
    <span class="nv">sales_df</span> <span class="o">=</span> combine_files<span class="o">(</span>conf.data_directory<span class="o">)</span>
    print<span class="o">(</span><span class="s2">"Reading customer data and combining with sales"</span><span class="o">)</span>
    <span class="nv">customer_status_sales</span> <span class="o">=</span> add_customer_status<span class="o">(</span>sales_df, conf.cust_file<span class="o">)</span>
    print<span class="o">(</span><span class="s2">"Saving sales and customer summary data"</span><span class="o">)</span>
    save_results<span class="o">(</span>customer_status_sales, conf.output_directory<span class="o">)</span>
    print<span class="o">(</span><span class="s2">"Done"</span><span class="o">)</span>
</pre></div>
</div>
<div class="section" id="add-a-gooey-gui">
<h2>Add a Gooey <span class="caps">GUI</span></h2>
<p>The command line solution shown above is very familiar to many but I imagine there
are people in your organization that would instantly turn away from a solution that
looks something like what I have shown above. However, Gooey makes it as easy as two lines of
code to make a <span class="caps">UI</span> for this script.</p>
<p>The most basic steps are to import Gooey and add the decorator in front of the
function that processes your arguments. Here is what it would look for our example:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">gooey</span> <span class="kn">import</span> <span class="n">Gooey</span>


<span class="nd">@Gooey</span><span class="p">(</span><span class="n">program_name</span><span class="o">=</span><span class="s">"Create Quarterly Marketing Report"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="sd">""" Rest of program below</span>
<span class="sd">    """</span>
</pre></div>
<p>When you run this, you would see a simple <span class="caps">UI</span> like this:</p>

<p>I think we all agree that this is fairly intuitive and would be something you
could easily explain to your most non-technical users. The other nice thing is
that it runs the same on Windows, Mac or Linux (as illustrated above).</p>
<p>The one challenge would be that users would probably expect to have some nice
widgets to allow them to select directories and dates. If you would like to do that
then you can substitute the <code class="code">
GooeyParser</code>
 for your <code class="code">
ArgParser</code>
 and
add the widget information to the parser code.</p>
<p>Change</p>
<div class="highlight"><pre><span class="n">parser</span> <span class="o">=</span> <span class="n">ArgParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Create Quarterly Marketing Report'</span><span class="p">)</span>
</pre></div>
<p>to</p>
<div class="highlight"><pre><span class="n">parser</span> <span class="o">=</span> <span class="n">GooeyParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Create Quarterly Marketing Report'</span><span class="p">)</span>
</pre></div>
<p>And add your <code class="code">
widget</code>
:</p>
<div class="highlight"><pre><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">),</span>
                    <span class="n">widget</span><span class="o">=</span><span class="s">'DirChooser'</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">"Source directory that contains Excel files"</span><span class="p">)</span>
</pre></div>
<p>Here’s what it looks like to use the <code class="code">
DirChooser1</code>
, <code class="code">
FileChooser</code>
 and
<code class="code">
DateChooser</code>
 widgets:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">gooey</span> <span class="kn">import</span> <span class="n">Gooey</span><span class="p">,</span> <span class="n">GooeyParser</span>

<span class="nd">@Gooey</span><span class="p">(</span><span class="n">program_name</span><span class="o">=</span><span class="s">"Create Quarterly Marketing Report"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="sd">""" Use GooeyParser to build up the arguments we will use in our script</span>
<span class="sd">    Save the arguments in a default json file so that we can retrieve them</span>
<span class="sd">    every time we run the script.</span>
<span class="sd">    """</span>
    <span class="n">stored_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># get the script name without the extension &amp; use it to build up</span>
    <span class="c"># the json filename</span>
    <span class="n">script_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">__file__</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">args_file</span> <span class="o">=</span> <span class="s">"{}-args.json"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_name</span><span class="p">)</span>
    <span class="c"># Read in the prior arguments as a dictionary</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args_file</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">stored_args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">GooeyParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Create Quarterly Marketing Report'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">),</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'DirChooser'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Source directory that contains Excel files"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'output_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'DirChooser'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'output_directory'</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Output directory to save summary report"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'cust_file'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'cust_file'</span><span class="p">),</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'FileChooser'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Customer Account Status File'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Start date to include'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'d'</span><span class="p">),</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'DateChooser'</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
<p>Now you have some native widgets the look very customary for the host <span class="caps">OS</span>:</p>

<p>The other nice feature is that when you execute the program you have a simple
wrapper around the display and reasonable error windows if there is an
underlying error in your program.</p>

<p>One other handy component is that there is a “Restart” button at the bottom of the
screen. If you select that button, you can go back to your input screen and adjust any
variables and re-execute the program. This is really nice if you need to run the
program multiple times with different inputs.</p>
<p>Part of what I really like about this solution is that there is very little
additional overhead in your code. A traditional <span class="caps">GUI</span> (tkinter, <span class="caps">QT</span>, wxWindows etc)
would require a lot of code to show this <span class="caps">UI</span>. This example shows
how unobtrusive the solution can be.</p>
</div>
<div class="section" id="the-final-program">
<h2>The Final Program</h2>
<p>I have not gone into the example of the actual pandas code but you can see in the
full sample that it is relatively straightforward to use the arguments as
inputs into your various python function calls. If you would like to see the
code on github, <a class="reference external" href="https://github.com/chris1610/pbpython/blob/master/code/pandas_gui.py">here it is</a>.</p>
<div class="highlight"><pre><span class="sd">"""</span>
<span class="sd">Simple Pandas program to combine Excel files and summarize data.</span>
<span class="sd">This demonstrates the use of Gooey to add a simple UI on top of the script</span>
<span class="sd">"""</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">from</span> <span class="nn">gooey</span> <span class="kn">import</span> <span class="n">Gooey</span><span class="p">,</span> <span class="n">GooeyParser</span>


<span class="nd">@Gooey</span><span class="p">(</span><span class="n">program_name</span><span class="o">=</span><span class="s">"Create Quarterly Marketing Report"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="sd">""" Use GooeyParser to build up the arguments we will use in our script</span>
<span class="sd">    Save the arguments in a default json file so that we can retrieve them</span>
<span class="sd">    every time we run the script.</span>
<span class="sd">    """</span>
    <span class="n">stored_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># get the script name without the extension &amp; use it to build up</span>
    <span class="c"># the json filename</span>
    <span class="n">script_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">__file__</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">args_file</span> <span class="o">=</span> <span class="s">"{}-args.json"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script_name</span><span class="p">)</span>
    <span class="c"># Read in the prior arguments as a dictionary</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args_file</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">stored_args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">GooeyParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Create Quarterly Marketing Report'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'data_directory'</span><span class="p">),</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'DirChooser'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Source directory that contains Excel files"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'output_directory'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'DirChooser'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'output_directory'</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Output directory to save summary report"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'cust_file'</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">'store'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'cust_file'</span><span class="p">),</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'FileChooser'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">'Customer Account Status File'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Start date to include'</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">stored_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'d'</span><span class="p">),</span>
                        <span class="n">widget</span><span class="o">=</span><span class="s">'DateChooser'</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c"># Store the values of the arguments so we have them next time we run</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
        <span class="c"># Using vars(args) returns the data as a dictionary</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">data_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>


<span class="k">def</span> <span class="nf">combine_files</span><span class="p">(</span><span class="n">src_directory</span><span class="p">):</span>
    <span class="sd">""" Read in all of the sales xlsx files and combine into 1</span>
<span class="sd">    combined DataFrame</span>
<span class="sd">    """</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_directory</span><span class="p">,</span> <span class="s">"sales-*.xlsx"</span><span class="p">)):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">all_data</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="s">'date'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">all_data</span>


<span class="k">def</span> <span class="nf">add_customer_status</span><span class="p">(</span><span class="n">sales_data</span><span class="p">,</span> <span class="n">customer_file</span><span class="p">):</span>
    <span class="sd">""" Read in the customer file and combine with the sales data</span>
<span class="sd">    Return the customer with their status as an ordered category</span>
<span class="sd">    """</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">customer_file</span><span class="p">)</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sales_data</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'left'</span><span class="p">)</span>
    <span class="c"># Default everyone to bronze if no data included</span>
    <span class="n">all_data</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s">'bronze'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Convert the status to a category and order it</span>
    <span class="n">all_data</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"category"</span><span class="p">)</span>
    <span class="n">all_data</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">set_categories</span><span class="p">([</span><span class="s">"gold"</span><span class="p">,</span> <span class="s">"silver"</span><span class="p">,</span> <span class="s">"bronze"</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_data</span>


<span class="k">def</span> <span class="nf">save_results</span><span class="p">(</span><span class="n">sales_data</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="sd">""" Perform a summary of the data and save the data as an excel file</span>
<span class="sd">    """</span>
    <span class="n">summarized_sales</span> <span class="o">=</span> <span class="n">sales_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"status"</span><span class="p">])[</span><span class="s">"unit price"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">"sales-report.xlsx"</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s">'xlsxwriter'</span><span class="p">)</span>
    <span class="n">summarized_sales</span> <span class="o">=</span> <span class="n">summarized_sales</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">summarized_sales</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Reading sales files"</span><span class="p">)</span>
    <span class="n">sales_df</span> <span class="o">=</span> <span class="n">combine_files</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">data_directory</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Reading customer data and combining with sales"</span><span class="p">)</span>
    <span class="n">customer_status_sales</span> <span class="o">=</span> <span class="n">add_customer_status</span><span class="p">(</span><span class="n">sales_df</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">cust_file</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Saving sales and customer summary data"</span><span class="p">)</span>
    <span class="n">save_results</span><span class="p">(</span><span class="n">customer_status_sales</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">output_directory</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done"</span><span class="p">)</span>
</pre></div>
<p>I think you will agree that this can be a really useful solution for distributing
small standalone programs to users that are not comfortable running python from the
command line. I have built this example around pandas but it would work for pretty
much any python script using argparse. Obviously if you need a more robust solution
then you’ll need to evaluate other options but I would argue that there is a lot
of power in this potential solution.</p>
<div class="section" id="edit-history">
<h3>Edit History</h3>
<ul class="simple">
<li>9-14-205: Corrected typos</li>
<li>9-17-2015: Updated example code imports to include GooeyParser</li>
</ul>
</div>
</div>

  </div>
  
</div></body></html>