<html><body><div><section class="post-content">
            <p>There have been dozens of articles written comparing Python and R from a subjective standpoint.  We’ll add our own views at some point, but this article aims to look at the languages more objectively.  We’ll analyze a dataset side by side in Python and R, and show what code is needed in both languages to achieve the same result.  This will let us understand the strengths and weaknesses of each language without the conjecture.  At <a href="https://www.dataquest.io">Dataquest</a>, we teach both languages, and think both have a place in a data science toolkit.</p>

<p>We’ll be analyzing a dataset of NBA players and their performance in the 2013-2014 season.  You can download the file <a href="https://www.dropbox.com/s/b3nv38jjo5dxcl6/nba_2013.csv?dl=0">here</a>. For each step in the analysis, we’ll show the Python and R code, along with some explanation and discussion of the different approaches.  Without further ado, let’s get this head to head matchup started!</p>

<h2 id="read-in-a-csv-file">Read in a csv file</h2>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r">nba <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">"nba_2013.csv"</span><span class="p">)</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span>
<span class="n">nba</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"nba_2013.csv"</span><span class="p">)</span></code></pre></div>

    </div>
</div>

<p>The above code will load the csv file <code>nba_2013.csv</code>, which contains data on NBA players from the 2013-2014 season, into the variable <code>nba</code> in both languages.  The only real difference is that in Python, we need to import the <a href="http://pandas.pydata.org/">pandas</a> library to get access to Dataframes.  <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">Dataframes</a> are available in both R and Python, and are two-dimensional arrays (matrices) where each column can be of a different datatype.  At the end of this step, the csv file has been loaded by both languages into a dataframe.</p>

<h2 id="find-the-number-of-players">Find the number of players</h2>




<p>This prints out the number of players and the number of columns in each.  We have <code>481</code> rows, or players, and <code>31</code> columns containing data on the players.</p>

<h2 id="look-at-the-first-row-of-the-data">Look at the first row of the data</h2>


<div class="row">
    <div class="col-md-6">
        <pre>
      player pos age bref_team_id
1 Quincy Acy  SF  23          TOT
[output truncated]
        </pre>
    </div>
    <div class="col-md-6">
        <pre>
       player pos  age bref_team_id
0  Quincy Acy  SF   23          TOT
[output truncated]
        </pre>
    </div>
</div>

<p>This is pretty much identical.  Both print out the first row of the data, and the syntax is very similar.  Python is more object-oriented here, and <code>head</code> is a method on the dataframe object, and R has a separate <code>head</code> function.  This is a common theme you’ll see as you start to do analysis with these languages, where Python is more object-oriented, and R is more functional.</p>

<h2 id="find-the-average-of-each-statistic">Find the average of each statistic</h2>

<p>Let’s find the average value for each statistic.  The columns, as you can see, have names like <code>fg</code> (field goals made), and <code>ast</code> (assists).  These are the season statistics for the player.  If you want a fuller explanation of all the stats, look <a href="http://stats.nba.com/help/glossary">here</a>.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">sapply</span><span class="p">(</span>nba<span class="p">,</span> <span class="kp">mean</span><span class="p">,</span> na.rm<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></code></pre></div>

    </div>
    
</div>
<div class="row">
    <div class="col-md-6">
        <pre>
player NA
pos NA
age 26.5093555093555
bref_team_id NA
[output truncated]
        </pre>
    </div>
    <div class="col-md-6">
        <pre>
age             26.509356
g               53.253638
gs              25.571726
[output truncated]
        </pre>
    </div>
</div>

<p>There are some major differences in approach here.  In both, we’re applying a function across the dataframe columns.  In python, the mean method on dataframes will find the mean of each column by default.</p>

<p>In R, taking the mean of string values will just result in <code>NA</code> – not available.  However, we do need to ignore <code>NA</code> values when we take the mean (requiring us to pass <code>na.rm=TRUE</code> into the <code>mean</code> function).  If we don’t, we end up with <code>NA</code> for the mean of columns like <code>x3p.</code>.  This column is three point percentage.  Some players didn’t take three point shots, so their percentage is missing.  If we try the <code>mean</code> function in R, we get <code>NA</code> as a response, unless we specify <code>na.rm=TRUE</code>, which ignores <code>NA</code> values when taking the mean.  The <code>.mean()</code> method in Python already ignores these values by default.</p>

<h2 id="make-pairwise-scatterplots">Make pairwise scatterplots</h2>

<p>One common way to explore a dataset is to see how different columns correlate to others.  We’ll compare the <code>ast</code>, <code>fg</code>, and <code>trb</code> columns.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>GGally<span class="p">)</span>
ggpairs<span class="p">(</span>nba<span class="p">[,</span><span class="kt">c</span><span class="p">(</span><span class="s">"ast"</span><span class="p">,</span> <span class="s">"fg"</span><span class="p">,</span> <span class="s">"trb"</span><span class="p">)])</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">nba</span><span class="p">[[</span><span class="s">"ast"</span><span class="p">,</span> <span class="s">"fg"</span><span class="p">,</span> <span class="s">"trb"</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

    </div>
</div>


<p>We get very similar plots in the end, but this shows how the R data science ecosystem has many smaller packages (<a href="https://cran.r-project.org/web/packages/GGally/index.html">GGally</a> is a helper package for <a href="http://ggplot2.org/">ggplot2</a>, the most-used R plotting package), and many more visualization packages in general.  In Python, <a href="http://matplotlib.org/">matplotlib</a> is the primary plotting package, and <a href="http://stanford.edu/~mwaskom/software/seaborn/">seaborn</a> is a widely used layer over matplotlib.  With visualization in Python, there is usually one main way to do something, whereas in R, there are many packages supporting different methods of doing things (there are at least a half dozen packages to make pair plots, for instance).</p>

<h2 id="make-clusters-of-the-players">Make clusters of the players</h2>

<p>One good way to explore this kind of data is to generate cluster plots.  These will show which players are most similar.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>cluster<span class="p">)</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
isGoodCol <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="kp">col</span><span class="p">){</span>
   <span class="kp">sum</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span><span class="kp">col</span><span class="p">))</span> <span class="o">==</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> <span class="kp">is.numeric</span><span class="p">(</span><span class="kp">col</span><span class="p">)</span> 
<span class="p">}</span>
goodCols <span class="o">&lt;-</span> <span class="kp">sapply</span><span class="p">(</span>nba<span class="p">,</span> isGoodCol<span class="p">)</span>
clusters <span class="o">&lt;-</span> kmeans<span class="p">(</span>nba<span class="p">[,</span>goodCols<span class="p">],</span> centers<span class="o">=</span><span class="m">5</span><span class="p">)</span>
labels <span class="o">&lt;-</span> clusters<span class="o">$</span>cluster</code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="n">kmeans_model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">good_columns</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">_get_numeric_data</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">kmeans_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">good_columns</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans_model</span><span class="o">.</span><span class="n">labels_</span></code></pre></div>

    </div>
</div>

<p>In order to cluster properly, we remove any non-numeric columns, or columns with missing values (<code>NA</code>, <code>Nan</code>, etc).  In R, we do this by applying a function across each column, and removing it if it has any missing values or isn’t numeric.  We then use the <a href="https://cran.r-project.org/web/packages/cluster/index.html">cluster</a> package to perform <a href="https://en.wikipedia.org/wiki/K-means_clustering">k-means</a> and find <code>5</code> clusters in our data.  We set a random seed using <code>set.seed</code> to be able to reproduce our results.</p>

<p>In Python, we use the main Python machine learning package, <a href="http://scikit-learn.org/">scikit-learn</a>, to fit a k-means clustering model and get our cluster labels.  We perform very similar methods to prepare the data that we used in R, except we use the <code>get_numeric_data</code> and <code>dropna</code> methods to remove non-numeric columns and columns with missing values.</p>

<h2 id="plot-players-by-cluster">Plot players by cluster</h2>

<p>We can now plot out the players by cluster to discover patterns.  One way to do this is to first use <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">PCA</a> to make our data 2-dimensional, then plot it, and shade each point according to cluster association.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r">nba2d <span class="o">&lt;-</span> prcomp<span class="p">(</span>nba<span class="p">[,</span>goodCols<span class="p">],</span> center<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
twoColumns <span class="o">&lt;-</span> nba2d<span class="o">$</span>x<span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span>
clusplot<span class="p">(</span>twoColumns<span class="p">,</span> <span class="kp">labels</span><span class="p">)</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="n">pca_2</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot_columns</span> <span class="o">=</span> <span class="n">pca_2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">good_columns</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">plot_columns</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">plot_columns</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

    </div>
</div>


<p>Made a scatter plot of our data, and shaded or changed the icon of the data according to cluster.  In R, the <code>clusplot</code> function was used, which is part of the cluster library.  We performed PCA via the <code>pccomp</code> function that is builtin to R.</p>

<p>With Python, we used the PCA class in the scikit-learn library.  We used matplotlib to create the plot.</p>

<h2 id="split-into-training-and-testing-sets">Split into training and testing sets</h2>

<p>If we want to do supervised machine learning, it’s a good idea to split the data into training and testing sets so we don’t <a href="https://en.wikipedia.org/wiki/Overfitting">overfit</a>.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r">trainRowCount <span class="o">&lt;-</span> <span class="kp">floor</span><span class="p">(</span><span class="m">0.8</span> <span class="o">*</span> <span class="kp">nrow</span><span class="p">(</span>nba<span class="p">))</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
trainIndex <span class="o">&lt;-</span> <span class="kp">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>nba<span class="p">),</span> trainRowCount<span class="p">)</span>
train <span class="o">&lt;-</span> nba<span class="p">[</span>trainIndex<span class="p">,]</span>
test <span class="o">&lt;-</span> nba<span class="p">[</span><span class="o">-</span>trainIndex<span class="p">,]</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">nba</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span></code></pre></div>

    </div>
</div>

<p>You’ll notice that R has many more data-analysis focused builtins, like <code>floor</code>, <code>sample</code>, and <code>set.seed</code>, whereas these are called via packages in Python (<code>math.floor</code>, <code>random.sample</code>, <code>random.seed</code>).  In Python, the recent version of pandas came with a <code>sample</code> method that returns a certain proportion of rows randomly sampled from a source dataframe – this makes the code much more concise.  In R, there are packages to make sampling simpler, but aren’t much more concise than using the built-in <code>sample</code> function.  In both cases, we set a random seed to make the results reproducible.</p>

<h2 id="univariate-linear-regression">Univariate linear regression</h2>

<p>Let’s say we want to predict number of assists per player from field goals made per player.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r">fit <span class="o">&lt;-</span> lm<span class="p">(</span>ast <span class="o">~</span> fg<span class="p">,</span> data<span class="o">=</span>train<span class="p">)</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>fit<span class="p">,</span> test<span class="p">)</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">[[</span><span class="s">"fg"</span><span class="p">]],</span> <span class="n">train</span><span class="p">[</span><span class="s">"ast"</span><span class="p">])</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">[[</span><span class="s">"fg"</span><span class="p">]])</span></code></pre></div>

    </div>
</div>

<p>Scikit-learn has a linear regression model that we can fit and generate predictions from.  R relies on the built-in <code>lm</code> and <code>predict</code> functions.  <code>predict</code> will behave differently depending on the kind of fitted model that is passed into it – it can be used with a variety of fitted models.</p>

<h2 id="calculate-summary-statistics-for-the-model">Calculate summary statistics for the model</h2>

<div class="row">
    
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">as</span> <span class="nn">sm</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s">'ast ~ fga'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="n">fitted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">fitted</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span></code></pre></div>

    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <pre>
Call:
lm(formula = ast ~ fg, data = train)

Residuals:
    Min      1Q  Median      3Q     Max 
-228.26  -35.38  -11.45   11.99  559.61
[output truncated]
        </pre>
    </div>
    <div class="col-md-6">
        <pre>
OLS Regression Results                            
============================
Dep. Variable:                    ast   
R-squared:                       0.568
Model:                            OLS   
Adj. R-squared:                  0.567
[output truncated]
        </pre>
    </div>
</div>

<p>If we want to get summary statistics about the fit, like <a href="https://en.wikipedia.org/wiki/Coefficient_of_determination">r-squared value</a>, we’ll need to do a bit more in Python than in R.  With R, we can use the builtin <code>summary</code> function to get information on the model.  With Python, we need to use the <a href="http://statsmodels.sourceforge.net/">statsmodels</a> package, which enables many statistical methods to be used in Python.  We get similar results, although generally it’s a bit harder to do statistical analysis in Python, and some statistical methods that exist in R don’t exist in Python.</p>

<h2 id="fit-a-random-forest-model">Fit a random forest model</h2>

<p>Our linear regression worked well in the single variable case, but we suspect there may be <a href="https://en.wikipedia.org/wiki/Nonlinear_system">nonlinearities</a> in the data.  Thus, we want to fit a <a href="https://en.wikipedia.org/wiki/Random_forest">random forest</a> model.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>randomForest<span class="p">)</span>
predictorColumns <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">"age"</span><span class="p">,</span> <span class="s">"mp"</span><span class="p">,</span> <span class="s">"fg"</span><span class="p">,</span> <span class="s">"trb"</span><span class="p">,</span> <span class="s">"stl"</span><span class="p">,</span> <span class="s">"blk"</span><span class="p">)</span>
rf <span class="o">&lt;-</span> randomForest<span class="p">(</span>train<span class="p">[</span>predictorColumns<span class="p">],</span> train<span class="o">$</span>ast<span class="p">,</span> ntree<span class="o">=</span><span class="m">100</span><span class="p">)</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>rf<span class="p">,</span> test<span class="p">[</span>predictorColumns<span class="p">])</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="n">predictor_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"age"</span><span class="p">,</span> <span class="s">"mp"</span><span class="p">,</span> <span class="s">"fg"</span><span class="p">,</span> <span class="s">"trb"</span><span class="p">,</span> <span class="s">"stl"</span><span class="p">,</span> <span class="s">"blk"</span><span class="p">]</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">predictor_columns</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="s">"ast"</span><span class="p">])</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">predictor_columns</span><span class="p">])</span></code></pre></div>

    </div>
</div>

<p>The main difference here is that we needed to use the randomForest library in R to use the algorithm, whereas it was built in to scikit-learn in Python.  scikit-learn has a unified interface for working with many different machine learning algorithms in Python, and there’s usually only one main implementation of each algorithm in Python.  With R, there are many smaller packages containing individual algorithms, often with inconsistent ways to access them.  This results in a greater diversity of algorithms (many have several implementations, and many are fresh out of research labs), but with a bit of a usability hit.</p>

<h2 id="calculate-error">Calculate error</h2>

<p>Now that we’ve fit two models, let’s calculate error.  We’ll use <a href="https://en.wikipedia.org/wiki/Mean_squared_error">MSE</a>.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">mean</span><span class="p">((</span>test<span class="p">[</span><span class="s">"ast"</span><span class="p">]</span> <span class="o">-</span> predictions<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s">"ast"</span><span class="p">],</span> <span class="n">predictions</span><span class="p">)</span></code></pre></div>

    </div>
</div>


<p>In Python, the scikit-learn library has a variety of error metrics that we can use.  In R, there are likely some smaller libraries that calculate MSE, but doing it manually is pretty easy in either language.  There’s a small difference in errors that almost certainly due to parameter tuning, and isn’t a big deal.</p>

<h2 id="download-a-webpage">Download a webpage</h2>

<p>Now that we have data on NBA players from 2013-2014, let’s scrape some additional data to supplement it.  We’ll just look at one box score from the NBA Finals <a href="http://www.basketball-reference.com/boxscores/201506140GSW.html">here</a> to save time.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>RCurl<span class="p">)</span>
url <span class="o">&lt;-</span> <span class="s">"http://www.basketball-reference.com/boxscores/201506140GSW.html"</span>
data <span class="o">&lt;-</span> <span class="kp">readLines</span><span class="p">(</span><span class="kp">url</span><span class="p">)</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.basketball-reference.com/boxscores/201506140GSW.html"</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span></code></pre></div>

    </div>
</div>

<p>In Python, the <a href="http://docs.python-requests.org/en/latest/">requests</a> package makes downloading web pages easy, with a consistent API for all request types.  In R, <a href="https://cran.r-project.org/web/packages/RCurl/index.html">RCurl</a> provides a similarly simple way to make requests.  Both download the webpage to a character datatype.  Note:  this step is unnecessary for the next step in R, but is shown for comparisons’s sake.</p>

<h2 id="extract-player-box-scores">Extract player box scores</h2>

<p>Now that we have the web page, we’ll need to parse it to extract scores for players.</p>

<div class="row">
    <div class="col-md-6">
        <span class="small">R</span>
        
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>rvest<span class="p">)</span>
page <span class="o">&lt;-</span> read_html<span class="p">(</span><span class="kp">url</span><span class="p">)</span>
table <span class="o">&lt;-</span> html_nodes<span class="p">(</span>page<span class="p">,</span> <span class="s">".stats_table"</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span>
rows <span class="o">&lt;-</span> html_nodes<span class="p">(</span><span class="kp">table</span><span class="p">,</span> <span class="s">"tr"</span><span class="p">)</span>
cells <span class="o">&lt;-</span> html_nodes<span class="p">(</span>rows<span class="p">,</span> <span class="s">"td a"</span><span class="p">)</span>
teams <span class="o">&lt;-</span> html_text<span class="p">(</span>cells<span class="p">)</span>

extractRow <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>rows<span class="p">,</span> i<span class="p">){</span>
    <span class="kr">if</span><span class="p">(</span>i <span class="o">==</span> <span class="m">1</span><span class="p">){</span>
        <span class="kr">return</span>
    <span class="p">}</span>
    row <span class="o">&lt;-</span> rows<span class="p">[</span>i<span class="p">]</span>
    tag <span class="o">&lt;-</span> <span class="s">"td"</span>
    <span class="kr">if</span><span class="p">(</span>i <span class="o">==</span> <span class="m">2</span><span class="p">){</span>
        tag <span class="o">&lt;-</span> <span class="s">"th"</span>
    <span class="p">}</span>
    items <span class="o">&lt;-</span> html_nodes<span class="p">(</span><span class="kp">row</span><span class="p">,</span> tag<span class="p">)</span>
    html_text<span class="p">(</span>items<span class="p">)</span>
<span class="p">}</span>

scrapeData <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>team<span class="p">){</span>
    teamData <span class="o">&lt;-</span> html_nodes<span class="p">(</span>page<span class="p">,</span> <span class="kp">paste</span><span class="p">(</span><span class="s">"#"</span><span class="p">,</span>team<span class="p">,</span><span class="s">"_basic"</span><span class="p">,</span> sep<span class="o">=</span><span class="s">""</span><span class="p">))</span>
    rows <span class="o">&lt;-</span> html_nodes<span class="p">(</span>teamData<span class="p">,</span> <span class="s">"tr"</span><span class="p">)</span>
    <span class="kp">lapply</span><span class="p">(</span><span class="kp">seq_along</span><span class="p">(</span>rows<span class="p">),</span> extractRow<span class="p">,</span> rows<span class="o">=</span>rows<span class="p">)</span> 
<span class="p">}</span>

data <span class="o">&lt;-</span> <span class="kp">lapply</span><span class="p">(</span>teams<span class="p">,</span> scrapeData<span class="p">)</span></code></pre></div>

    </div>
    <div class="col-md-6">
        <span class="small">Python</span>
        
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
<span class="n">box_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">"[A-Z]{3,}_basic"</span><span class="p">)):</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">"tr"</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s">"th"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s">"td"</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>
    <span class="n">box_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span></code></pre></div>

    </div>
</div>

<p>This will create a list containing two lists, the first with the box score for <code>CLE</code>, and the second with the box score for <code>GSW</code>.  Both contain the headers, along with each player and their in-game stats.  We won’t turn this into more training data now, but it could easily be transformed into a format that could be added to our <code>nba</code> dataframe.</p>

<p>The R code is more complex than the Python code, because there isn’t a convenient way to use regular expressions to select items, so we have to do additional parsing to get the team names from the HTML.  R also discourages using <code>for</code> loops in favor of applying functions along vectors.  We use <code>lapply</code> to do this, but since we need to treat each row different depending on whether it’s a header or not, we pass the index of the item we want, and the entire <code>rows</code> list into the function.</p>

<p>We use <code>rvest</code>, a new and widely used R web scraping package to extract the data we need.  Note that we can pass a url directly into rvest, so the last step wasn’t needed in R.</p>

<p>In Python, we use <a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/#">BeautifulSoup</a>, the most commonly used web scraping package.  It enables us to loop through the tags and construct a list of lists in a straightforward way.</p>

<h2 id="conclusion">Conclusion</h2>

<p>We’ve taken a look at how to analyze a dataset with R and Python.  There are many tasks we didn’t dive into, such as persisting the results of our analysis, sharing the results with others, testing and making things production-ready, and making more visualizations.  We’ll dive into these at a later date, which will let us make some more definitive conclusions.  For now, here’s what we can say:</p>

<h3 id="r-is-more-functional-python-is-more-object-oriented">R is more functional, Python is more object-oriented</h3>

<p>As we saw from functions like <code>lm</code>, <code>predict</code>, and others, R lets functions do most of the work.  Contrast this to the <code>LinearRegression</code> class in Python, and the <code>sample</code> method on dataframes.</p>

<h3 id="r-has-more-data-analysis-built-ins-python-relies-on-packages">R has more data analysis built-ins, Python relies on packages</h3>

<p>When we looked at summary statistics, we could use the <code>summary</code> built-in function in R, but had to import the <code>statsmodels</code> package in Python.  The dataframe is a built-in construct in R, but must be imported via the <code>pandas</code> package in Python.</p>

<h3 id="python-has-main-packages-for-data-analysis-tasks-r-has-a-larger-ecosystem-of-small-packages">Python has “main” packages for data analysis tasks, R has a larger ecosystem of small packages</h3>

<p>With Python, we can do linear regression, random forests, and more with the scikit-learn package.  It offers a consistent API, and is well-maintained.  In R, we have a greater diversity of packages, but also greater fragmentation and less consistency (linear regression is a builtin, <code>lm</code>, <code>randomForest</code> is a separate package, etc).</p>

<h3 id="r-has-more-statistical-support-in-general">R has more statistical support in general</h3>

<p>R was built as a statistical language, and it shows.  <code>statsmodels</code> in Python and other packages provide decent coverage for statistical methods, but the R ecosystem is far larger.</p>

<h3 id="its-usually-more-straightforward-to-do-non-statistical-tasks-in-python">It’s usually more straightforward to do non-statistical tasks in Python</h3>

<p>With well-maintained libraries like BeautifulSoup and requests, web scraping in Python is far easier than in R.  This applies to other tasks that we didn’t look into closely, like saving to databases, deploying web servers, or running complex workflows.</p>

<h3 id="there-are-many-parallels-between-the-data-analysis-workflow-in-both">There are many parallels between the data analysis workflow in both</h3>

<p>There are clear points of inspiration between both R and Python (pandas Dataframes were inspired by R dataframes, the rvest package was inspired by BeautifulSoup), and both ecosystems continue to grow stronger.  It’s remarkable how similar the syntax and approaches are for many common tasks in both languages.</p>

<h2 id="last-word">Last word</h2>

<p>At <a href="https://www.dataquest.io">Dataquest</a>, we primarily teach Python, but have recently been adding lessons on R.  We see both languages as complementary, and although we think Python is stronger in more areas, R is an effective language.  It can be used either as a complement for Python in areas like data exploration and statistics, or as your sole data analysis tool.  As this walkthrough proves, both languages have a lot of similarities in syntax and approach, and you can’t go wrong with one, the other, or both.</p>

        </section>

        </div></body></html>