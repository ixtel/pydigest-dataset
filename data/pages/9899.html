<html><body><div><div class="post-text" itemprop="text">
<p><sub>
This solution belongs to the <strong>Category B : exit_code or return code of writing function</strong>  </sub></p>

<blockquote>
  <p>...only <code>open()</code> and <code>fopen()</code> need to guarantee that they get a consistent handle to a particular file for reading and writing. <code>stat</code> and friends are not required to retrieve fresh attributes. Thus, for the sake of <strong>close-to-open cache coherence</strong>, only <code>open()</code> and <code>fopen()</code> are considered an "open event" where fresh attributes need to be fetched immediately from the server<sup><a href="http://www.citi.umich.edu/projects/nfs-perf/results/cel/dnlc.html" rel="nofollow">[1]</a></sup>.</p>
</blockquote>

<hr/>

<p>
<sub>
The following solutions belong to the <strong>Category A : NFS clients setting</strong><br/>
<em>i.e. if you do NOT expect cached file/dir entries to be served to the client, disable caching.</em>
</sub></p>

<h3>Setup a shared cache</h3>

<blockquote>
  <p>If the file in the NFS mount (whose existence is being checked) is created by another application on the same client (possibly using another mount point to the same NFS export) the consider using a single shared NFS cache on the client.</p>
</blockquote>

<p>Use the <code>sharecache</code> option to setup the NFS mounts on the client.</p>

<p>This option determines how the client's data-cache and attribute-cache are shared when mounting the same export more than once concurrently. <strong>Using the same cache reduces memory requirements on the client and presents identical file contents to applications when the same remote file is accessed via different mount points.</strong></p>

<hr/>

<h3>Setting-up a NFS-mount without caching</h3>

<blockquote>
  <p>Disable attribute caching. </p>
</blockquote>

<p>Mount the NFS share on the client with the <code>noac</code> option.</p>

<blockquote>
  <p>Alternately, disable cached directory attributes from being served.</p>
</blockquote>

<p>Use <code>acdirmin=0,acdirmax=0</code> to set the cache timeouts to 0 (effectively disabling caching).</p>

<hr/>

<h3>Setting-up a NFS-mount to ignore lookup caches</h3>

<blockquote>
  <p>Use <code>lookupcache=positive</code> OR <code>lookupcache=none</code>  </p>
</blockquote>

<p>(available options : <code>all</code>, <code>positive</code> and <code>none</code>)</p>

<p>When attempting to access a directory entry over a NFS mount,<br/>
if the requested directory entry exists on the server, the result is referred to as <code>positive</code>.<br/>
if the requested directory entry does not exist on the server, the result is referred to as <code>negative</code>. </p>

<p>If the <code>lookupcache</code> option is not specified, or if <code>all</code> is specified, the client assumes both types of directory cache entries are valid until their parent directory's cached attributes expire.</p>

<p>If <code>pos</code> or <code>positive</code> is specified, the client assumes positive entries are valid until their parent directory's cached attributes expire, but always revalidates negative entires before an application can use them.</p>

<p>If <code>none</code> is specified, the client revalidates both types of directory cache entries before an application can use them. This permits quick detection of files that were created or removed by other clients, but can impact application and server performance.</p>

<hr/>

<p><sub>
References:<br/>
<a href="http://www.citi.umich.edu/projects/nfs-perf/results/cel/dnlc.html" rel="nofollow">1. Close-To-Open Cache Consistency in the Linux NFS Client</a><br/>
<a href="http://serverfault.com/a/278380">2. NFS - Detecting remotely created files programmatically?</a><br/>
<a href="http://serverfault.com/a/382728">3. NFS cache : file content not updated on client when modified on server</a><br/>
<a href="http://linux.die.net/man/5/nfs" rel="nofollow">4. NFS man page</a>. Especially the <strong>"Data And Metadata Coherence"</strong> section.<br/>
</sub></p>
    </div>
    </div></body></html>