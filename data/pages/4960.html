<html><body><div><div class="entry-content">
		<h2/>
<h2/>
<p><a href="https://impythonist.files.wordpress.com/2015/06/1666323.png"><img class="aligncenter  wp-image-1029" src="https://impythonist.files.wordpress.com/2015/06/1666323.png?w=460&amp;h=287" alt="1666323"/></a></p>
<h2 id="toc_0">Intro</h2>
<p>We all know that Django is a powerful framework. Many of us deals with posting data from a HTML form to a Django view and process it. You should have never cared of Ajax way of posting the data. Some of you tried AJAX but faced  few painful intros to setup a perfectly running Django-Ajax implementation. So,I came up this time to tell you how to do that.After this tutorial you will feel quite comfortable about implementing ajax posts and also will keep this article as a reference for future. Source code for upcoming tutorial available at following link.</p>

<p> </p>
<h2 id="toc_0">What is AJAX?</h2>
<p>Simply put AJAX is about updating parts of a web page, without reloading the whole page.</p>
<p>Suppose we need to update any parts of our website page ,then we must use Ajax. For posting data back to server ajax is required. Now why we should use it with Django ?. I believe following things will answer you.</p>
<ul>
<li> Using Ajax, we can craft data format that sent back to server.</li>
<li> We can handle the situations like successful post or failure or error.</li>
<li>Drop all burden on client rather than server wherever it is possible.</li>
<li>For implementing progress bars ajax post is the best way.</li>
<li>Drop messages framework to display something ,I hate it. Use JSON response returned from Ajax post to wake up cool notification models etc.</li>
</ul>
<p>If you didn’t understand the above points , cool. I too didn’t once. The simple thing I am gonna show is , how to post something back to server from HTML and collect acknowledgement that returned back.</p>
<h2 id="toc_0">Let us begin the show</h2>
<p>We are going to see the demonstration from scratch. Let us create a Django project for that. Remember we am playing with Django &gt;= 1.7 here.</p>
<pre class="python highlighted_source">$ pip install Django==1.7.3</pre>
<p>This installs Django1.7 on your system.</p>
<pre class="python highlighted_source">$ django-admin startproject ajaxpost
#Now create an app called mainapp inside ajaxpost
$ django-admin startapp mainapp</pre>
<p>Then the directory structure will be in this way.</p>
<p> </p>
<p><a href="https://impythonist.files.wordpress.com/2015/06/selection_049.png"><img class="aligncenter size-full wp-image-1034" src="https://impythonist.files.wordpress.com/2015/06/selection_049.png?w=1000" alt="Selection_049"/></a></p>
<p>Now let us add the superuser to begin with. Default db will be SQilte3. First do a migration for django to create default user tables in db. So do this.</p>
<pre class="python highlighted_source">$ python manage.py migrate</pre>
<p>Now create a super user for admin.</p>
<pre class="python highlighted_source">$ python manage.py createsuperuser</pre>
<p>That’s it. Now we are going to create a home page which has the email field and a password for collecting user data. It is to show data passage from ( client -&gt; server ,server -&gt; client) . Simple,but extremely useful in 100 use-cases.</p>
<p>After creation of superuser ,just create a view for our home page. ajaxpost/urls.py looks like below</p>
<pre class="python highlighted_source">#ajaxpost/urls.py

from django.contrib import admin
from mainapp import views

urlpatterns = patterns('',
 url(r'^admin/', include(admin.site.urls)),
 url(r'^',views.home , name=u'home')
)

</pre>
<p>Now modify the views of mainapp to the following.</p>
<pre class="python highlighted_source">from django.shortcuts import render
from django.http import JsonResponse


def home(request):
     return JsonResponse({"hello":"pythonist"})</pre>
<p>Now just save and do a runserver. Next Go to <a href="http://localhost:8000" rel="nofollow">http://localhost:8000</a> and you will find this thing.</p>
<pre class="python highlighted_source">$ python manage.py runserver</pre>
<p><a href="https://impythonist.files.wordpress.com/2015/06/selection_042.png"><img class="aligncenter size-full wp-image-1011" src="https://impythonist.files.wordpress.com/2015/06/selection_042.png?w=1000" alt="Selection_042"/></a></p>
<p>See how simple it is to send a Json response from a Django1.7 view. Now we are going to crete a HTML file for our home page and try to take data from it to create user. For that create a folder called templates in your project root and make a file called base.html. tree structure of our project looks this.</p>
<p><a href="https://impythonist.files.wordpress.com/2015/06/selection_043.png"><img class="aligncenter size-full wp-image-1014" src="https://impythonist.files.wordpress.com/2015/06/selection_043.png?w=1000" alt="Selection_043"/></a></p>
<p>Ok. Now I am adding  template directories location to settings.py. Add this line to ajaxpost/settings.py</p>
<pre class="python highlighted_source">     TEMPLATE_DIRS = (
        BASE_DIR + '/templates/',
                 )</pre>
<p>Now Django can find template files. So add this HTML content to templates/base.html</p>
<pre class="python highlighted_source"> &lt;html&gt;
     &lt;head&gt;
          &lt;link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"&gt;
          &lt;link href="http://getbootstrap.com/examples/signin/signin.css" rel="stylesheet"&gt;
     &lt;/head&gt;

 &lt;body&gt;

 &lt;div class="container"&gt;

 &lt;form class="form-signin" method="POST"&gt;
    {% csrf_token %}
      &lt;h2 class="form-signin-heading"&gt;Enter Details&lt;/h2&gt;
     &lt;label for="inputEmail" class="sr-only"&gt;Email address&lt;/label&gt;
     &lt;input type="email" id="inputEmail" class="form-control" placeholder="Email               address" required autofocus&gt;
     &lt;label for="inputPassword" class="sr-only"&gt;Password&lt;/label&gt;
     &lt;input type="password" id="inputPassword" class="form-control"  placeholder="Password" required&gt;
     &lt;button id="submit" class="btn btn-lg btn-primary btn-block" type="submit"&gt;Sign in&lt;/button&gt;
 &lt;/form&gt;

 &lt;/div&gt;

 &lt;script src="http://code.jquery.com/jquery-2.1.4.min.js"&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
<p>When you fire runserver and go to <a href="http://localhost:8000" rel="nofollow">http://localhost:8000</a> , you will find a nice bootstrap Enter details form like this.</p>
<p><a href="https://impythonist.files.wordpress.com/2015/06/selection_046.png"><img class="aligncenter wp-image-1017 size-full" src="https://impythonist.files.wordpress.com/2015/06/selection_046.png?w=1000" alt=""/></a></p>
<p>I hope things are clear. Follow from the top , if you are in doubt.</p>
<h2 id="toc_0">Now comes the Ajax part</h2>
<p>Instead of doing a normal submit , let us have an Ajax post block in our HTML file. Django relies on csrf token for the validity of data posted to the server. So in addition to data , we should send csrf-token. In default django submission,it is automatically sent. But in case of Ajax , we need to take care of that.</p>
<p>Take the below JS code as Granted and place it in  a new &lt;script&gt;&lt;/script&gt; tag in base.html</p>
<pre class="python highlighted_source"> 
 &lt;script&gt;

//For getting CSRF token
function getCookie(name) {
          var cookieValue = null;
          if (document.cookie &amp;&amp; document.cookie != '') {
                var cookies = document.cookie.split(';');
          for (var i = 0; i &lt; cookies.length; i++) {
               var cookie = jQuery.trim(cookies[i]);
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) == (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
             }
          }
      }
 return cookieValue;
}


//For doing AJAX post

//When submit is clicked
 $("#submit").click(function(e) {

//Prevent default submit. Must for Ajax post.Beginner's pit.
 e.preventDefault();

//Prepare csrf token
 var csrftoken = getCookie('csrftoken');


//Collect data from fields
 var email = $('#inputEmail').val();
 var password = $('#inputPassword').val();

//This is the Ajax post.Observe carefully. It is nothing but details of where_to_post,what_to_post
//Send data  
 $.ajax({
       url : window.location.href, // the endpoint,commonly same url
       type : "POST", // http method
       data : { csrfmiddlewaretoken : csrftoken, 
       email : email,
       password : password
 }, // data sent with the post request

 // handle a successful response
 success : function(json) {
 console.log(json); // another sanity check
 //On success show the data posted to server as a message
 alert('Hi   '+json['email'] +'!.' + '  You have entered password:'+ json['password']);
 },

 // handle a non-successful response
 error : function(xhr,errmsg,err) {
 console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
 }
 });
});
&lt;/script&gt;</pre>
<p> Now Don’t forget to place {% csrf_token %} next to the form tag in base.html. Let us modify the mainapp/views.py.</p>
<p/>
<div>
<pre class="python highlighted_source">from django.shortcuts import render
from django.http import JsonResponse

def home(request):
    if request.method == 'POST':
        #POST goes here . is_ajax is must to capture ajax requests. Beginner's pit.
        if request.is_ajax():
            #Always use get on request.POST. Correct way of querying a QueryDict.
            email = request.POST.get('email')
            password = request.POST.get('password')
            data = {"email":email , "password" : password}
            #Returning same data back to browser.It is not possible with Normal submit
            return JsonResponse(data)
    #Get goes here
    return render(request,'base.html')</pre>
</div>
<p/>
<p>Now everything for demonstration is built. We need to wrap up things and do a runserver. Before that complete templates/base.html file looks this way.</p>
<p/>
<div>
<pre class="python highlighted_source">   
 &lt;html&gt;
 &lt;head&gt;
 &lt;link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"&gt;
 &lt;link href="http://getbootstrap.com/examples/signin/signin.css" rel="stylesheet"&gt;
 &lt;/head&gt;

 &lt;body&gt;

 &lt;div class="container"&gt;

 &lt;form class="form-signin" method="POST"&gt;
      {% csrf_token %}
      &lt;h2 class="form-signin-heading"&gt;Enter Details&lt;/h2&gt;
      &lt;label for="inputEmail" class="sr-only"&gt;Email address&lt;/label&gt;
      &lt;input type="email" id="inputEmail" class="form-control" placeholder="Email address" required autofocus&gt;
      &lt;label for="inputPassword" class="sr-only"&gt;Password&lt;/label&gt;
      &lt;input type="password" id="inputPassword" class="form-control" placeholder="Password" required&gt;
      &lt;button id="submit" class="btn btn-lg btn-primary btn-block" type="submit"&gt;Sign in&lt;/button&gt;
 &lt;/form&gt;

 &lt;/div&gt;

 &lt;script src="http://code.jquery.com/jquery-2.1.4.min.js"&gt;&lt;/script&gt;
 &lt;script&gt;

//For getting CSRF token
function getCookie(name) {
       var cookieValue = null;
       if (document.cookie &amp;&amp; document.cookie != '') {
         var cookies = document.cookie.split(';');
         for (var i = 0; i &lt; cookies.length; i++) {
         var cookie = jQuery.trim(cookies[i]);
         // Does this cookie string begin with the name we want?
         if (cookie.substring(0, name.length + 1) == (name + '=')) {
             cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
             break;
          }
     }
 }
 return cookieValue;
}


//For doing AJAX post
 $("#submit").click(function(e) {

 e.preventDefault();

 var csrftoken = getCookie('csrftoken');

 var email = $('#inputEmail').val();

 var password = $('#inputPassword').val();

//This is the Ajax post.Observe carefully. It is nothing but details of where_to_post,what_to_post
 
 $.ajax({
         url : window.location.href, // the endpoint,commonly same url
         type : "POST", // http method
         data : { csrfmiddlewaretoken : csrftoken, 
         email : email,
         password : password
 }, // data sent with the post request

 // handle a successful response
 success : function(json) {
      console.log(json); // another sanity check
      //On success show the data posted to server as a message
      alert('Hi '+json['email'] +'!.' + ' You have entered password:'+      json['password']);
 },

 // handle a non-successful response
 error : function(xhr,errmsg,err) {
 console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
 }
 });
});

&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>Ok. Now fire up the server using</p>
<div>
<pre class="python highlighted_source">$ python manage.py runserver</pre>
</div>

<p/>
<p>email : pikachu@pokemon</p>
<p>password: charizard</p>
<p/>
<p>When I click sign in this is what I got.</p>
<p/>

<p/>
<p/>
<p>Hurray. We got it. Data is passed from client to server using Ajax and then server sent same data to client as JSON to display alert message.</p>
<p/>
<p>This is how we pass information to the server using Ajax . Ajax is mainly used for long polling. Long polling is process in which, Ajax sends request from client to server asking the latest information.Then it updates the contents of HTML with data obtained. Here, we  stressed four things. In case of failure of any one, Ajax post may not work.Those things are listed below.</p>
<p/>
<div>
<ul>
<li>{% csrf_token %} just below form tag.</li>
<li>csrfmiddlewaretoken in Ajax POST data.</li>
<li>is_ajax() handler in Django view.</li>
<li>get(‘parameter’) method on request.POST</li>
</ul>
</div>
<p>
<h2 id="toc_0">What is new in Django 1.7?</h2>
</p>
<p> In Django 1.7 ,we have JsonResponse which directly encodes a Python dictionary to JSON object without dumping data .</p>
<div>
<pre class="python highlighted_source">from django.http import JsonResponse

#Usage in view
return JsonResponse({"foo":"bar"})</pre>
</div>
<p> Before you used to do this like</p>
<div>
<pre class="python highlighted_source">import json
return HttpResponse(json.dumps({"foo":"bar"}), content_type="applciation/json")</pre>
</div>
<div>
<h2 id="toc_0">Conclusion</h2>
<p>I hope you got something from this tutorial. I faced problems when I started doing Ajax posts a year back. All tutorials on web misses one or more important things , so things won’t work. That gives us great frustration. I here showed a simple, working example of Ajax post in Django. Use it. source code is available at this link.</p>
</div>

<p/>
		<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-62549587-1001-56d5a79cbe335" data-src="//widgets.wp.com/likes/#blog_id=62549587&amp;post_id=1001&amp;origin=impythonist.wordpress.com&amp;obj_id=62549587-1001-56d5a79cbe335" data-name="like-post-frame-62549587-1001-56d5a79cbe335"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p></div>					</div>

	</div></body></html>