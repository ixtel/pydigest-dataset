<html><body><div><div class="col-sm-12 md-margin-bottom-40">

  <p class="headline"><h2> Build your own Google Analytics Dashboard in Excel for free! </h2></p>
  <div class="post-author"><p>
    By </p><strong>Felix Zumstein</strong><p>, Founder of Zoomer Analytics LLC (January 21, 2016)
 </p><a href="#disqus_thread"> ▼ Comments</a>
  </div>

  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.zoomeranalytics.com/google-analytics/" data-via="ZoomerAnalytics" data-hashtags="xlwings">Tweet</a>


  <p><strong>UPDATE (November 26, 2015):</strong> This blog post has been updated to xlwings v0.5.0</p>

<p>This post is about building a Google Analytics Dashboard in Excel (the place where the data is ending up sooner or later
anyway). To do this, we’ll be using <a href="https://www.python.org">Python</a> with the <a href="http://pandas.pydata.org/">Pandas</a> and
<a href="http://xlwings.org">xlwings</a> packages.</p>

<p>Google Analytics is great and free, but sometimes you wish it had a bit more power. However, the price tag of
$150,000/year for the premium version isn’t exactly what you would call “pocket change”, especially if you are a smaller company.</p>

<p>For example, in the online version of Google Analytics, I miss the behavior chart that can be found in the iPhone version:
A simple heatmap that shows activity per hour and weekday. That’s exactly the thing we’re going to build, only better:
We’re going to split the data in half-hour intervals, taking advantage of the fact that the API delivers data on minute level.
Here is a screenshot of what we’re going to build (<strong>click to enlarge</strong>):</p>

<p><a class="image-center" href="../static/img/ga_blog/dashboard.png" data-lightbox="tool">
    <img class="image-center" src="../static/img/ga_blog/thumb/dashboard.png" alt="image-1"/>
</a></p>

<p>The advantages of building our own dashboard with Python are obvious:</p>

<div class="servive-block servive-block-orange">

  <ul>
    <li><strong>Save time</strong>: Combine all your favorite statistics into a single dashboard. Exactly the way you want them.</li>
    <li><strong>Keep your data safe</strong>: Combine Google Analytics data with your company internal data without the need to upload sensititve data to Google.</li>
    <li><strong>More details</strong>: The API offers data on minute level, not just hour level as the online version does.</li>
    <li><strong>Better accuracy</strong>: Get around the problem of sampling (Google reports are sampling results as soon as a certain amount of data is involved).</li>
    <li><strong>One stop shop</strong>: Python can do it all - you don’t need another add-in for database access, reporting etc.</li>
  </ul>

</div>

<p><strong>If this sounds all good to you but you would like to hire us to help, please
<a href="http://www.zoomeranalytics.com/contact">contact us</a> for more info.</strong></p>

<h3 id="step-1-install-python">Step 1: Install Python</h3>

<p>The fastest way to get off the ground is by installing the <a href="http://continuum.io/downloads">Anaconda</a> distribution.
Since we make use of Excel, our tool will only run on Mac and Windows, so get one of these two versions. Unfortunately,
Google currently offers their API package only for Python 2 (shame on you, Google!), so it is recommended to work with
Python 2.7 (although you might want to try your luck with an unofficial version that supports Python 3). Once Anaconda
is installed, there’s only a few packages that need to be installed additionally:</p>

<pre><code class="language-bash">$ pip install xlwings==0.5.0
$ pip install google-api-python-client==1.3.1
$ pip install python-gflags==2.0
$ pip install oauth2client==1.4.12
</code></pre>

<p>If you don’t go for Anaconda, you additionally need to install <code>numpy</code>, <code>pandas</code> and if you are on Windows also <code>pywin32</code>.</p>

<h3 id="step-2-google-developers-console">Step 2: Google Developers Console</h3>

<p>Now head over to <a href="https://console.developers.google.com/">Google Developers Console</a> and login with the account you use
for Google Analytics.</p>

<h5 id="a-create-project">A) CREATE PROJECT</h5>

<p>After logging in, click on the blue button <code>Create Project</code> and type in a project name, something like “Google Analytics
Dashboard for Excel”. The default for Project ID is just fine. Then click on <code>Create</code>.</p>

<h5 id="b-api">B) API</h5>
<p>Under <code>APIs &amp; auth &gt; APIs</code>, enable <code>Analytics API</code> by clicking on the <code>OFF</code> button. You may want to disable the other APIs
that are already enabled:</p>

<p><a class="image-center" href="../static/img/ga_blog/enableapi.png" data-lightbox="api">
  <img class="image-center" src="../static/img/ga_blog/thumb/enableapi.png" alt="image-1"/>
</a></p>

<h5 id="c-consent-screen">C) CONSENT SCREEN</h5>
<p>Click on <code>APIs &amp; auth &gt; Consent screen</code> and select as a minimum an <code>Email Address</code> and type in a <code>Product Name</code>, again,
something like “Google Analytics Dashboard for Excel” will do. Then click <code>Save</code>.</p>

<h5 id="d-credentials">D) CREDENTIALS</h5>
<p>As last step, go to <code>APIs &amp; auth &gt; Credentials</code> and click <code>Create new Client ID</code> under “OAuth”. Then, select <code>Installed
application</code> as “Application Type” and <code>Other</code> as “Installed Application Type” and hit <code>Create Client ID</code>. Once done, hit the
<code>Download JSON</code> button, and save the downloaded file under the name <code>client_secrets.json</code> in a new directory for the project,
i.e. <code>ga_dashboard</code>. It is important that this file is only downloaded after the API and Consent Screen have been set.</p>

<p><strong>Note: Keep your <code>client_secrets.json</code> file in a safe place and don’t share it with anybody, as they could otherwise use
your quota on Google Analytics.</strong></p>



<p>Now we can turn to Excel and start building our GUI (graphical user interface).</p>

<p><strong>If you want it the easy way, simply download a ready-to-use zip-file
<a href="https://bitbucket.org/zoomeranalytics/xlwings_examples/downloads/ga_dashboard.zip">here</a>. Then unzip it (Mac: double-click,
Windows: right-click and select “Extract all…”) and place the json file from before in that same unzipped folder.</strong></p>

<p>Your folder should now look like this:</p>

<p><a class="image-center" href="../static/img/ga_blog/folder.png" data-lightbox="folder">
  <img class="image-center" src="../static/img/ga_blog/thumb/folder.png" alt="image-1"/>
</a></p>

<p>Fill in the <code>Account</code>, <code>Property</code> and <code>View</code> fields in the Excel sheet. You’ll find the according names when you log into
Google Analytics, under the <code>Admin</code> menu. You may also want to adjust the <code>From</code> and <code>To</code> fields.</p>

<p>Ready to go? Hit the <code>Refresh</code> button! Note that you might have to change the settings according to the
<a href="http://docs.xlwings.org/vba.html#settings">xlwings docs</a>, if you haven’t installed Anaconda with the default settings.</p>

<p>The very first time, a browser window will pop-up, where you’ll have to login with your Google Account and allow access
to the project you created under Step 2:</p>



<p>Once you have granted access, the browser will give you a confirmation (“The authentication flow has completed”) and
Excel will give you a deprecation warning (should be <a href="https://github.com/pydata/pandas/issues/8327">addressed</a> in a
future release of Pandas) along with an “Authentication Successful” message:</p>

<p><a class="image" href="../static/img/ga_blog/deprecation.png" data-lightbox="authenticated">
    <img class="image-center" src="../static/img/ga_blog/thumb/deprecation.png" alt="image-1"/>
</a></p>

<p>That’s it! The next time you hit refresh, you don’t need to re-authenticate (the token <code>analytics.dat</code> will be stored in
the <code>pandas/io</code> directory). If <code>Effective</code> = <code>Max Rows</code>, you should increase <code>Max Rows</code> to get all data for the indicated time period.</p>

<p><strong>If you want to build the Excel tool on your own, follow these steps:</strong></p>

<ul>
  <li>Create a new Workbook called <code>GA_Dashboard.xlsm</code> - make sure to save it as Excel Macro-Enabled Workbook in the <code>ga_dashboard</code>
folder along with the json file you downloaded under Step 2.</li>
  <li>Press <code>Alt-F11</code> to open the VBA Editor. There, go to <code>File &gt; Import File...</code> and select the xlwings VBA module. See the
<a href="http://docs.xlwings.org/vba.html#import-the-xlwings-vba-module-into-excel">xlwings docs</a> for details.</li>
  <li>
    <p>Then, still in the VBA editor, create a new VBA module: <code>Insert &gt; Module</code> and paste the following code:</p>

    <pre><code class="language-vb">Sub Refresh()
    RunPython ("import ga_dashboard;ga_dashboard.refresh()")
End Sub
</code></pre>
  </li>
  <li>
    <p>Save the following code in a file called <code>ga_dashboard.py</code> in the <code>ga_dashboard</code> folder along with the json and xlsm files.</p>

    <pre><code class="language-python">import os
import numpy as np
import pandas as pd
import pandas.io.ga as ga
from datetime import datetime
from xlwings import Workbook, Range

# Worksheets
sheet_dashboard = 'Sheet1'

# Client Secrets file: same dir as this file
client_secrets = os.path.abspath(os.path.join(os.path.dirname(__file__),
                                            'client_secrets.json'))


def behavior(start_date, end_date, account_name, property_name, profile_name, max_results):
  """
  Writes a DataFrame with the number of pageviews per half-hours x weekdays
  to the Range "behavior"
  """
  # Let pandas fetch the data from Google Analytics, returns a generator object
  df_chunks = ga.read_ga(secrets=client_secrets,
                         account_name=account_name,
                         property_name=property_name,
                         profile_name=profile_name,
                         dimensions=['date', 'hour', 'minute'],
                         metrics=['pageviews'],
                         start_date=start_date,
                         end_date=end_date,
                         index_col=0,
                         parse_dates={'datetime': ['date', 'hour', 'minute']},
                         date_parser=lambda x: datetime.strptime(x, '%Y%m%d %H %M'),
                         max_results=max_results,
                         chunksize=10000)

  # Concatenate the chunks into a DataFrame and get number of rows
  df = pd.concat(df_chunks)
  num_rows = df.shape[0]

  # Resample into half-hour buckets
  df = df.resample('30Min', how='sum')

  # Create the behavior table (half-hour x weekday)
  grouped = df.groupby([df.index.time, df.index.weekday])
  behavior = grouped['pageviews'].aggregate(np.sum).unstack()

  # Make sure the table covers all hours and weekdays
  behavior = behavior.reindex(index=pd.date_range("00:00", "23:30", freq="30min").time,
                              columns=range(7))
  behavior.columns = ['MO', 'TU', 'WE', 'TH', 'FR', 'SA', 'SU']

  # Write to Excel.
  # Time-only values are currently a bit of a pain on Windows, so we set index=False.
  Range(sheet_dashboard, 'behavior', index=False).value = behavior
  Range(sheet_dashboard, 'effective').value = num_rows


def refresh():
  """
  Refreshes the tables in Excel given the input parameters.
  """
  # Connect to the Workbook
  wb = Workbook.caller()

  # Read input
  start_date = Range(sheet_dashboard, 'start_date').value
  end_date = Range(sheet_dashboard, 'end_date').value
  account_name = Range(sheet_dashboard, 'account').value
  property_name = Range(sheet_dashboard, 'property').value
  profile_name = Range(sheet_dashboard, 'view').value
  max_results = Range(sheet_dashboard, 'max_rows').value

  # Clear Content
  Range(sheet_dashboard, 'behavior').clear_contents()
  Range(sheet_dashboard, 'effective').clear_contents()

  # Behavior table
  behavior(start_date, end_date, account_name, property_name, profile_name, max_results)


if __name__ == '__main__':
  # To run from Python. Not needed when called from Excel.
  path = os.path.abspath(os.path.join(os.path.dirname(__file__), 'GA_Dashboard.xlsm'))
  Workbook.set_mock_caller(path)
  refresh()
</code></pre>
  </li>
  <li>Insert a button (you may have to enable the <code>Developer</code> tab on the ribbon first) and connect it to the <code>Refresh</code> macro.</li>
  <li>Create the following named ranges: B5: “account”, B6: “property”, B7: “view”, B9: “from”, B10: “to”, B12: “max_rows”,B13: “effective”, D4:J52: “behavior”</li>
  <li>Label the fields accordingly: A5: “ACCOUNT”, A6: “PROPERTY”, A7: “VIEW”, A9: “FROM”, A10: “TO”, A12: “MAX ROWS”, A13: “EFFECTIVE”</li>
  <li>Label C5:C52 with the hour from 0.00 to 23.30 in half hour steps.</li>
  <li>Apply a conditional formatting of your liking to D5:J52.</li>
</ul>

<p>That’s it! Enjoy!</p>



<p id="disqus_thread"/>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


</div>
</div></body></html>