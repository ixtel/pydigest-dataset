<html><body><div><div class="col-xs-9">
                                <div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/migration.PNG" alt="The future of Django Schema Migrations, but at the current release of 1.6.1, we still have to use South as Third Party Application"/>
<p>
The future of Django Schema Migrations, but at the current release of 1.6.1, we still have to use South as a Third Party Application
</p>
</div>
<p align="justify">
To be honest, I believe this article will have a short life. Why? It's simply because migrations is a moving target in Django. As of Django 1.6.x, we still don't have migrations feature built-in. But the good news is, Andrew Godwin, the author of <a href="http://south.readthedocs.org/en/latest/">South</a>, is currently working on <a href="http://www.kickstarter.com/projects/andrewgodwin/schema-migrations-for-django">Kickstarter funded project</a>, to bring migrations feature into the core of Django itself. You can read about it usage <a href="https://docs.djangoproject.com/en/dev/topics/migrations/">here</a>, but you must be aware that it's targeted for Django 1.7. As of now, we still have to use South as a third party Django application. And this is what I try to introduce in this articl.
</p>
<p align="justify"> 
</p>
<h1>What is Schema Migration?</h1>
<p align="justify">
The first time I have a hands-on on schema migration is when I tried <a href="http://guides.rubyonrails.org/migrations.html">Ruby on Rails</a>. Just a glimpse of it, but it's --at that time-- a mind blowing experience for me. The idea of synching database schema with application is truly encouraging : you can be sure that at any given version of our application, it (should) always work with the database. It's because there are migrations code that will gradually change database schema into appropriate state, synched with the application code. Django has this feature also, but as I said previously, through third party Django package called South. But before trying South, let see what will be the case if we don't use a proper migration utility. We will start with creating our first Django application.
</p>
<h1>Creating our First Django Application<br/>
</h1>
<p align="justify">
<a href="http://pythonthusiast.pythonblogs.com/230_pythonthusiast/archive/1336_django_kfimember_tutorial_part_iii-configure_inital_postgresql_database_locally_and_remotely_in_openshift.html">Previously</a>, I already elaborate the differences between Django project and Django application. Here, let's create our first Django application. You can use command line <code>python manage.py startapp &lt;yourappname&gt;</code> to begin creating an app, from within terminal/console at the directory <code>wsgi/kfimember</code>. Because our project name is <code>kfimember</code>, you can't use it again. Try to use the name <code>kfimemberapp</code>. Or, if you use Python Tools for Visual Studio like me, you can right click on <code>kfimember </code>project node, choose Add, and select Django App. You will be presented with Add Django App dialog, and type your application name there.
</p>

<p align="justify">
This command will create a folder name <code>kfimemberapp</code> consisting of four files:
</p>
<ol>
	<li><code>__init__.py</code>  : an empty Python file indicating that this folder is a Python package</li>
	<li><code>models.py</code>  : contains all your models for this application</li>
	<li><code>tests.py</code>  : a unit test that will be run automatically as part of this Django project unit test  </li>
	<li><code>views.py</code>  : contains all your views for this application</li>
</ol>
<p align="justify">
Our next step is to really use this application in our Django project by editing <code>settings.py </code>and add <code>kfimemberapp</code>  into <code>INSTALLED_APPS</code>   section, as follows:
</p>
<p align="justify">
</p>
<table class="python code"><tbody><tr class="li1"><td><pre>1
2
3
4
5
6
7
8
9
</pre></td><td><pre>INSTALLED_APPS <span>=</span> <span>(</span>
    <span>'django.contrib.admin'</span><span>,</span>
    <span>'django.contrib.auth'</span><span>,</span>
    <span>'django.contrib.contenttypes'</span><span>,</span>
    <span>'django.contrib.sessions'</span><span>,</span>
    <span>'django.contrib.messages'</span><span>,</span>
    <span>'django.contrib.staticfiles'</span><span>,</span>
    <span>'kfimemberapp'</span><span>,</span>
<span>)</span></pre></td></tr></tbody></table>
<p> 
</p>
<p align="justify">
As we don't have yet add any code for our application, testing the application right now would not bring any effect. So, let's add our first models. 
</p>
<h2>Adding Application Models</h2>
<p align="justify">
To understand application models developed for this tutorial series, you may want to review our application requirements in the <a href="http://pythonthusiast.pythonblogs.com/230_pythonthusiast/archive/1326_django_kfimember_tutorial_part_i-deciding_application_scope_production_and_technology_stacks.html">first article</a>. I am not going to be fully thorough in this step. Depicted below, I will only show enough detail of the application model for us to get started with using South to manage its schema migration.  
</p>
<div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/modal.PNG" alt="Simplistic view of our application model"/>
<p>
Simplistic view of our application model
</p>
</div>
<p>
 
</p>
<p align="justify">
We will use the existing Users model and hence, using the above simple view of our model, we only need to add a new <code>SertifikatModal</code> (a.k.a Stock Certificate) model in <code>kfimemberapp/models.py</code> , seen below.
</p>
<p>
</p>
<table class="python code"><tbody><tr class="li1"><td><pre>1
2
3
4
5
6
</pre></td><td><pre><span>from</span> django.<span>db</span> <span>import</span> models
<span>from</span> django.<span>contrib</span>.<span>auth</span>.<span>models</span> <span>import</span> User
 
<span>class</span> SertifikatModal<span>(</span>models.<span>Model</span><span>)</span>:
    <span>user</span> <span>=</span> models.<span>ForeignKey</span><span>(</span>User<span>)</span>
    nomor <span>=</span> models.<span>CharField</span><span>(</span>max_length<span>=</span><span>30</span><span>)</span> <span>#a.k.a number</span></pre></td></tr></tbody></table>
<p> 
</p>
<p align="justify">
Because of the above simplicity, you may want to refer to a <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/">complete list of all Django Field class</a> that you can use in your application model.
</p>
<p align="justify">
<em>"Only two attributes?"</em>, you may asked. Yes, as I said previously, we just need the very most basic fields/properties to get started. Later on we can begin detailing its fields. This new model need its own tables in our database. But to no worry, as Django programmer we can left the task of creating this table to our beloved pals, <code>manage.py syncdb</code>. There are great limitations though : it only able to create new tables. It doesn't have the ability to modify existing tables. So, if you plan to add (of course you will) another properties to this models, well, you are out of luck with just a plain <code>manage.py syncdb</code>. For that, we need South.
</p>
<p align="justify">
But let see first how it is done using just plain <code>manage.py syncdb</code>. Open up your terminal/console, and at the path <code>wsgi/kfimember </code>issue this command:<code> manage.py syncdb</code>, as seen below. 
</p>
<div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/kfi10.PNG" alt="Add new table based on new model"/>
<p>
Add new table based on new model
</p>
</div>
<p align="justify">
Have a look on your PostgreSQL database. You will see that a new table has been created for you. But not only that! You can also instruct Django to automatically create back-end administration page for this new model. Simply create a file <code>kfimemberapp/admin.py</code> with the following Python code:
</p>
<p align="justify">
</p>
<table class="python code"><tbody><tr class="li1"><td><pre>1
2
3
4
</pre></td><td><pre><span>from</span> django.<span>contrib</span> <span>import</span> admin
<span>from</span> kfimemberapp.<span>models</span> <span>import</span> SertifikatModal 
 
admin.<span>site</span>.<span>register</span><span>(</span>SertifikatModal<span>)</span></pre></td></tr></tbody></table>
<p> 
</p>
<p align="justify">
Run your Django server with the command <code/><code><code/>manage.py runserver</code>  or simply hit F5 from within Visual Studio, and you will see that<code> SertifikatModal</code> has been added to the list of models in Django admin application. In there, you can do all complete CRUD actions. Cool isn't it? 
</p>
<div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/212-kfi11.PNG" alt="This will serve as a great starting point for back-end admin feature for all  models in your application"/>
<p>
This will serve as a great starting point for back-end administration application for all  models in your application
</p>
</div>
<p align="justify">
Using the currently Django <code>manage.py syncdb </code>to introduce new table to the database may suffice for the moment. But things goes awkward when you start to <em>modify</em> your existing model (hence, the corresponding table). For example, suppose you want to add a new <code>description </code>field to the existing <code>SertifikatModal </code>model. Running <code>manage.py syncdb </code>again will not modify your related tables. You got to add that field manually to the database table. Yes, manually.
</p>
<p align="justify">
The solution? Let use South for this so called <a href="http://en.wikipedia.org/wiki/Schema_migration">schema migrations</a> problem! 
</p>
<h1 align="left">Starting to Use South</h1>
<p align="justify">
There are two ways to use South : 
</p>
<div align="justify">
<ol>
	<li>Early in the beginning of application development step, prior any application models being introduced to the system.</li>
	<li>After you satisfy with the current application models, decide that it's quite good, and afterward would like to manage its migrations using South.
	</li>
</ol>
</div>
<p align="justify">
You can opted to use any ways as you wish, but in my opinion it's better to use South only after a rather stable application models were established. It's rather overkill to use South in the early step of application models development. You can simply drop and recreate your application database before each application testing. Once you satisfied with the application, then you can use any migrations utilities that you wish. I  use this technique in my previous <a href="http://pythonthusiast.pythonblogs.com/230_pythonthusiast/categories/390_flask_biography_tutorial.html">Flask Bio application development tutorial</a>. In there I use <a href="http://pythonthusiast.pythonblogs.com/230_pythonthusiast/archive/1324_flask_biography_tutorial_part_xi__managing_database_migration_in_production_environment_using_alembic.html">Alembic</a> to manage its migrations after the application reach some kind of stable state.
</p>
<p align="justify">
Here, we are going to explore both ways so that you can decide it on your own.
</p>
<h2>Adding South to Django Project </h2>
<p align="justify">
In your local environment, you can simply issue the command : <code>pip install south </code> to install South into your Python <code>site-packages</code>  directory, so that it will available to all your Python application (if it was installed into global Python <code>site-packages</code>) or into specific Python application in their own virtual environment (if you use <a href="http://www.virtualenv.org/en/latest/">virtualenv</a> utility).
</p>
<p align="justify">
For remote environment (your hosting provider), as this tutorial assume that you use Openshift, you can simply add this requirements into file <code>setup.py</code>, as shown below.
</p>
<p align="justify">
</p>
<table class="python code"><tbody><tr class="li1"><td><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td><pre><span>from</span> setuptools <span>import</span> setup
 
setup<span>(</span>name<span>=</span><span>'KFI Member App'</span><span>,</span>
      version<span>=</span><span>'1.0'</span><span>,</span>
      description<span>=</span><span>'Manage membership features in Cooperative organization'</span><span>,</span>
      author<span>=</span><span>'Eko S. Wibowo'</span><span>,</span>
      author_email<span>=</span><span>'swdev.bali@gmail.com'</span><span>,</span>
      url<span>=</span><span>'http://www.python.org/sigs/distutils-sig/'</span><span>,</span>
      install_requires<span>=</span><span>[</span><span>'Django==1.6.1'</span><span>,</span><span>'psycopg2'</span><span>,</span> <span>'south'</span><span>]</span><span>,</span>
     <span>)</span></pre></td></tr></tbody></table>
<p> 
</p>
<p align="justify">
Lastly, of course you have to include South into Django <code>INSTALLED_APPS </code>in the file <code>settings.py</code>, as shown below. 
</p>
<p align="justify">
</p>
<table class="python code"><tbody><tr class="li1"><td><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td><pre>INSTALLED_APPS <span>=</span> <span>(</span>
    <span>'django.contrib.admin'</span><span>,</span>
    <span>'django.contrib.auth'</span><span>,</span>
    <span>'django.contrib.contenttypes'</span><span>,</span>
    <span>'django.contrib.sessions'</span><span>,</span>
    <span>'django.contrib.messages'</span><span>,</span>
    <span>'django.contrib.staticfiles'</span><span>,</span>
    <span>'kfimemberapp'</span><span>,</span>
    <span>'south'</span>
<span>)</span></pre></td></tr></tbody></table>
<p> 
</p>
<h2>Preparing South south_migrationhistory Table</h2>
<p align="justify">
Whether you are using South prior any models introduced or afterward, you still have to create South own table to manage its migrations information : <code>south_migrationhistory</code>. This step was done after South requirement has been added to the Django project. The action needed was as simple as issuing the command <code>python manage.py syncdb</code>, which will create <code>south_migrationhistory </code>table. Depicted below, are our current list of tables in the database up until this step.
</p>
<div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/south.png" alt="Check it using \dt"/>
<p>
After adding South and running manage.py sycndb
</p>
</div>
<p>
After having this South table created, you can begin the next step of using South into your Django project. Pick the method that suit your current situation. 
</p>
<h2>Using South Prior Applications Model's Tables Created<br/>
</h2>
<p align="justify">
If you follow this Django tutorial series as it is, well, what you really need is actually not this step. You can skip this section and go to the next section of "Using South After Creating Applications Model's Tables". It is because you have use <code>manage.py sycndb</code> to create <code>SertifikatModal </code>table. 
</p>
<p align="justify">
If, however, you want to use South prior any application model's tables were created, the steps (including its current application state) are the following:
</p>
<ol>
	<li>
	<p align="justify">
	You have already run <code>python manage.py syncdb </code>command to create Django built-in application's tables.
	</p>
	</li>
	<li>
	<p align="justify">
	You have already included South in <code>INSTALLED_APPS </code>in file <code>setings.py</code> and have already run <code>syncdb </code>afterward to create <code>south_migrationhistory </code>table.<br/>
	</p>
	</li>
	<li>
	<p align="justify">
	You have already created your application models code in the file <code>models.py</code>
	</p>
	</li>
	<li>
	<p align="justify">
	Afterward, run <code>python manage.py schemamigration kfimemberapp --initial</code> to prepare South first initial migration code. It will create <code>migrations </code>directory in your application directory,  read the current state of your applications model and create initial Python migration code in <code>migrations </code>directory, to let you create its required database tables later on. Remember, if you use application name other than <code>kfimemberapp</code>, then use it.
	</p>
	</li>
	<li>The previous step is only creating its initial Python migration code. It didn't actually create those tables for you. To really create it, you can simply use the command : <code>python manage.py migrate kfimemberapp</code>. </li>
</ol>
<p align="justify">
The final result is your application model's tables were created, and you can simply modify your application models easily, knowing that South will be able to modify the related tables for you. Or in other word, after running <code>python manage.py migrate kfimemberapp </code>command,  your database already in synched with your model. Below are its screenshot of this command output:
</p>
<div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/kfi22.PNG" alt="Adding South prior application model's table creation"/>
<p>
Adding South prior application model's table creation
</p>
</div>
<h2>Using South After Creating Applications Model's Table</h2>
<p align="justify">
This step is the correct step if you follow this tutorial series as is, that is, you have code your application models in file <code>kfimemberapp/models.py</code>  and have already created the related table(s) into application database using <code>python manage.py syncdb</code> command. To introduce South in this point of application development, the steps are the following:
</p>
<ol>
	<li>
	<p align="justify">
	You have to make sure that your database schema already in synched with your application models and there is no <code>migrations</code>  directory below <code>wsgi/kfimember/kfimemberapp</code>. In order to do this, you may want to delete (if any) <code>migrations</code> directory, drop your database (or just delete the tables related to your application, namely all tables with the name prefixes with <code>kfimemberapp_</code>), recreate the database and running <code>python manage.py syncdb</code> command to synched the database with your application model.
	</p>
	</li>
	<li>
	<p align="justify">
	Just issue this simple South convert command : <code>python manage.py convert_to_south kfimemberapp</code>.<br/>
	</p>
	</li>
</ol>
<p align="justify">
It will create  <code>migrations</code>  directory, creating initial database migrations code inside it, and running fake migrations command. It's fake, because South only pretend that it runs the migration script, although it's not, because the database already synched with the application model . The final result will be the same like our previous method of introducing South prior application model's tables were created. Below is the screenshot of this command output:
</p>
<div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/kfi20.png" alt="Adding South after application model's table were created with syncdb"/>
<p>
Adding South after application model's table were created with syncdb
</p>
</div>
<h2>Using South to Manage Automatic Migrations<br/>
</h2>
<p align="justify">
If the previous steps seem somewhat of a burden, now is the time to make South shine : automatically manage schema migration. That is, you can concentrate modifying your application model and let South take care of managing its database schema synchronization for you.  For example, suppose that you want to add another field to <code>SertifikatModal</code> model, let say <code>jumlah </code>which is Indonesian word for <code>amount </code>that denote how much is the stock certificate hold for this particular transaction. 
</p>
<p>
</p>
<table class="python code"><tbody><tr class="li1"><td><pre>1
2
3
4
5
6
7
</pre></td><td><pre><span>from</span> django.<span>db</span> <span>import</span> models
<span>from</span> django.<span>contrib</span>.<span>auth</span>.<span>models</span> <span>import</span> User
 
<span>class</span> SertifikatModal<span>(</span>models.<span>Model</span><span>)</span>:
    <span>user</span> <span>=</span> models.<span>ForeignKey</span><span>(</span>User<span>)</span>
    nomor <span>=</span> models.<span>CharField</span><span>(</span>max_length<span>=</span><span>30</span><span>)</span> <span>#a.k.a number</span>
    jumlah <span>=</span> models.<span>FloatField</span><span>(</span>default <span>=</span> <span>0</span><span>)</span> <span>#a.k.a amount</span></pre></td></tr></tbody></table>
<p>  
</p>
<p align="justify">
Now, how do we use South to properly synched our database? Simple. Just issue the command <code>python manage.py schemamigration kfimemberapp --auto </code> to let South create the migration code for your and afterward, simply issue the command <code>python manage.py migrate kfimemberapp</code> to apply the migration. The result? You don't have to manually touch your database to synch all of its related tables and field. Depicted below is the output of this command.
</p>
<div align="center">
<img src="http://pythonthusiast.pythonblogs.com/gallery/230/kfi23.png" alt="Using auto migration feature of South"/>
<p>
Using auto migration feature of South
</p>
</div>
<p align="justify">
Have a check on your database table! You will see that it already have a new <code>amount </code> field inside <code>kfimemberapp_sertifikatmodal </code>table.
</p>
<h1 align="left">Making It Synched with Openshift Database </h1>
<div align="justify"><p>
After having local database schema synched with your application models, if you happened to use Openshift (or any other Cloud computing solution such as Heroku, or a private VPS server) you will have to apply the same series of command into your remote database terminal/console using its SSH connection. Therefore, this step will be the same as in </p><a href="http://pythonthusiast.pythonblogs.com/230_pythonthusiast/archive/1336_django_kfimember_tutorial_part_iii-configure_inital_postgresql_database_locally_and_remotely_in_openshift.html#comments">our previous article</a><p>. 
</p></div>
<h1 align="left">Conclusion</h1>
<p align="justify">
If you have followed this article series until this point, chances are you already know how to properly manage your Django project and its schema migrations using South, although I left out some of South features in this article (such as manual migration). For that, you can read it at South own documentation web <a href="http://south.readthedocs.org/en/latest/index.html">here</a>. 
</p>
<p align="justify">
As always you can download the code for this article here : <a href="https://www.dropbox.com/sh/t4r9zq0a56xxutk/r6XveCj7TE/KFIDjangoTutorial/kfimember-part-4.zip">kfimember-part-4.zip</a>. 
</p>
<p align="justify">
Or, follow its development in Github repo here : <a href="https://github.com/swdevbali/kfimember">kfimember</a>. 
</p>
<p align="justify">
Stay tuned! 
</p>


                

            </div>

            </div></body></html>