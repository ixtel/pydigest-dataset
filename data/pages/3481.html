<html><body><div><header class="entry-header">
<h1 class="entry-title">Concatenate byte strings in Python 3</h1>
<p class="bylinemod"><time class="entry-date updated" datetime="2014-02-25T11:16:07+00:00" pubdate="">February 25, 2014</time> — by Jan-Philip Gehrcke</p> </header> 
<div class="entry-content">
<p>What is the recommended way to concatenate (two or a few) byte strings in Python 3? What is the recommended way to do so if the code should work for <strong>both, Python 2 and 3</strong>?</p>
<p>In Python 2 we can easily concatenate two or more byte strings using string formatting:</p>
<div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="text"><pre class="de1">&gt;&gt;&gt; a = "\x61"
&gt;&gt;&gt; b = "\x62"
&gt;&gt;&gt; "%s%s" % (a, b)
'ab'</pre></div></div></div></div></div></div></div>
<p>It is <a href="http://article.gmane.org/gmane.comp.python.devel/144520">payback time</a> and <code>repr("%s" % b"a")</code> semi-intuitively returns <code>'"b\'a\'"'</code> in Python 3(.3) (and <code>b"%s" % b"a"</code> throws <code>TypeError: unsupported operand type(s) for %: 'bytes' and 'bytes'</code>). This is the result of Python 3’s strict distinction between text (sequence of unicode code points) and bytes (sequence of raw bytes). Eventually, in Python 3 the concatenation of byte strings via string formatting yields something entirely different from what Python 2 does:</p>
<div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="text"><pre class="de1">&gt;&gt;&gt; a = b"\x61"
&gt;&gt;&gt; b = b"\x62"
&gt;&gt;&gt; "%s%s" % (a,b)
"b'a'b'b'"</pre></div></div></div></div></div></div></div>
<p>The outcome is <strong>text</strong> (a sequence of unicode code points) instead of a <strong>byte string</strong> (a sequence of bytes). In Python terminology, the result of this byte string concatenation is the concatenation of the representations (<code>repr()</code> / <code>__repr__()</code>) of these byte strings.</p>
<h3>Concatenating two byte strings</h3>
<p>In Python 3, the <code>__add__</code> operator returns what we want:</p>

<p><code>__add__</code> also works for Python 2:</p>

<h3>Concatenating many byte strings</h3>
<p>The above would be the preferred method if you want to concatenate only two byte strings. In case you have a longer sequence of byte strings that you need to concatenate, the good old <code>join()</code> will work in both, Python 2.7 and 3.x.</p>
<p>Python 3 output:</p>
<div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="text"><pre class="de1">&gt;&gt;&gt; b"".join([a, b])
b'ab'</pre></div></div></div></div></div></div></div>
<p>Python 2.7 output:</p>
<div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="text"><pre class="de1">&gt;&gt;&gt; b"".join([a, b])
'ab'</pre></div></div></div></div></div></div></div>
<p>In Python 3, the <code>'b'</code> separator string prefix is crucial (join a sequence of strings of type <em>bytes</em> with a separator of type <em>bytes</em>). In Python 2.7, the <code>'b'</code> prefix <a href="http://docs.python.org/2/reference/lexical_analysis.html#string-literals">is ignored</a> and string literals are byte strings by default anyway. In older versions of Python 2 the <code>'b'</code> prefix is a syntax error.</p>
<p>For a largish sequence of byte strings, the <code>join()</code>-based concatenation clearly is more efficient than the <code>+</code>-based one.</p>
 </div> 
</div></body></html>