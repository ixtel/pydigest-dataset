<html><body><div><article class="post-content" itemprop="ArticleBody">
    <p>One of the most popular complaints against Python is that its dynamic type system
makes it easy to introduce bugs into your programs. As you probably know
in statically typed languages (e.g. Java, C++, Rust) type of variable is checked at compile time.
In dynamically typed languages (e.g. Python, Ruby) type of variables is interpreted at runtime. 
Proponents of statically typed languages argue that lack of type checking leads
to bugs. If you have statically typed language and you make programming error
of operating on incompatible types you get loud error from compiler. 
Your program is dead and will never go live. Take following “guess my secret number”
game written in Rust for example.</p>

<div class="highlight"><pre><code class="language-rust" data-lang="rust"><span class="k">extern</span> <span class="n">crate</span> <span class="n">rand</span><span class="p">;</span>
<span class="kn">use</span> <span class="n">std</span><span class="o">::</span><span class="n">io</span><span class="p">;</span>
<span class="kn">use</span> <span class="n">std</span><span class="o">::</span><span class="n">cmp</span><span class="o">::</span><span class="nb">Ordering</span><span class="p">;</span>
<span class="kn">use</span> <span class="n">rand</span><span class="o">::</span><span class="n">Rng</span><span class="p">;</span>

<span class="k">fn</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="n">secret</span> <span class="o">=</span> <span class="n">rand</span><span class="o">::</span><span class="n">thread_rng</span><span class="p">().</span><span class="n">gen_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">);</span>
    <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">"Please guess secret number"</span><span class="p">);</span>
    <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">"Hint: secret number is {}"</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
    <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">"Please input your number"</span><span class="p">);</span>
    <span class="kd">let</span> <span class="k">mut</span> <span class="n">guess</span> <span class="o">=</span> <span class="n">String</span><span class="o">::</span><span class="n">new</span><span class="p">();</span>
    <span class="n">io</span><span class="o">::</span><span class="n">stdin</span><span class="p">()</span>
        <span class="p">.</span><span class="n">read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">guess</span><span class="p">)</span>
        <span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"failed to read"</span><span class="p">);</span>
    <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">"your guess is: {}"</span><span class="p">,</span> <span class="n">guess</span><span class="p">);</span>

    <span class="k">match</span> <span class="n">guess</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">secret</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Ordering</span><span class="o">::</span><span class="nb">Less</span> <span class="o">=&gt;</span> <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">"too small"</span><span class="p">),</span>
        <span class="nb">Ordering</span><span class="o">::</span><span class="nb">Greater</span> <span class="o">=&gt;</span> <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">"too big"</span><span class="p">),</span>
        <span class="nb">Ordering</span><span class="o">::</span><span class="nb">Equal</span> <span class="o">=&gt;</span> <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">"you win!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>When you run above code sample Rust won’t compile, it will throw type error
at you.</p>

<div class="highlight"><pre><code class="language-rust" data-lang="rust"><span class="o">~/</span><span class="n">r</span><span class="o">/</span><span class="n">f</span><span class="o">/</span><span class="n">guess</span><span class="o">&gt;</span> <span class="n">cargo</span> <span class="n">run</span>
   <span class="n">Compiling</span> <span class="n">guess</span> <span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span> <span class="p">(</span><span class="n">file</span><span class="o">:</span><span class="c-Doc">///home/pawel/rusty/first_game/guess)</span>
<span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">21</span><span class="o">:</span> <span class="mi">16</span><span class="o">:</span><span class="mi">28</span> <span class="n">error</span><span class="o">:</span> <span class="n">mismatched</span> <span class="n">types</span><span class="o">:</span>
 <span class="n">expected</span> <span class="err">`</span><span class="o">&amp;</span><span class="n">collections</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">String</span><span class="err">`</span><span class="p">,</span>
    <span class="n">found</span> <span class="err">`</span><span class="o">&amp;</span><span class="n">_</span><span class="err">`</span>
<span class="p">(</span><span class="n">expected</span> <span class="k">struct</span> <span class="err">`</span><span class="n">collections</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">String</span><span class="err">`</span><span class="p">,</span>
    <span class="n">found</span> <span class="n">integral</span> <span class="n">variable</span><span class="p">)</span> <span class="p">[</span><span class="n">E0308</span><span class="p">]</span>
<span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="o">:</span><span class="mi">16</span>     <span class="k">match</span> <span class="n">guess</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">secret</span><span class="p">)</span> <span class="p">{</span>
                                   <span class="o">^~~~~~~</span>
<span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">21</span><span class="o">:</span> <span class="mi">16</span><span class="o">:</span><span class="mi">28</span> <span class="n">help</span><span class="o">:</span> <span class="n">run</span> <span class="err">`</span><span class="n">rustc</span> <span class="o">--</span><span class="n">explain</span> <span class="n">E0308</span><span class="err">`</span> <span class="n">to</span> <span class="n">see</span> <span class="n">a</span> <span class="n">detailed</span> <span class="n">explanation</span>
<span class="n">error</span><span class="o">:</span> <span class="n">aborting</span> <span class="n">due</span> <span class="n">to</span> <span class="n">previous</span> <span class="n">error</span>
<span class="n">Could</span> <span class="n">not</span> <span class="n">compile</span> <span class="err">`</span><span class="n">guess</span><span class="err">`</span><span class="p">.</span></code></pre></div>

<p>It may be a pain to see compile errors, but trust me, getting error here is good for you.
You did something stupid you tried to compare string with int and decide which one is equal. 
This does not make any sense to the computer most of the time (nor does it make sense
to human), so you should never be able to run program like this. Computer says “No!”
and you have to cope with that.</p>

<p>Now try doing same idiotic thing in Python.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">random</span>
<span class="c"># use six because input behaves differently in Python 3 and 2</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Guess secret number"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Hint secret number is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secret</span><span class="p">))</span>
    <span class="n">guess</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s">"please input your number"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Your guess is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">guess</span> <span class="o">==</span> <span class="n">secret</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"you win"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">guess</span> <span class="o">&gt;</span> <span class="n">secret</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"too big"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">guess</span> <span class="o">&lt;</span> <span class="n">secret</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"too small"</span><span class="p">)</span>

    <span class="n">compare</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre></div>

<p>No pain here and you may even feel really productive. Your program may look harmless to novice programmer, but bug introduced here is pretty
dangerous and surprisingly common. You are trying to compare string taken from standard input with integer returned by
random.randint(), so you may end up with comparing “12” with 12.</p>

<p>In Python 2 and 3 doing “12” == 12 is allowed and does not break anything it
just always evaluates to False. Python 2 also allows “greater than”, “smaller than” 
comparisons between incompatible types. If you do this kind of comparison between numeric
and non-numeric type (“12” &gt; 12) non-numeric type will always be greater. In contrast
to Rust your Python script will happily compile and run without problems. This is 
bad because it will generate invalid output. This means that your
user always looses the game no matter what he enters.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">~/f/stack&gt; python guess.py 
secret number is 49
please input your number49
Your guess is 49
too big</code></pre></div>

<p>Python 3 behaves in a different (better!) way. When doing
greater than or smaller than comparisons it will explicitly complain
that you are trying to compare incompatible types:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">~/</span><span class="n">f</span><span class="o">/</span><span class="n">stack</span><span class="o">&gt;</span> <span class="n">python3</span> <span class="n">guess</span><span class="o">.</span><span class="n">py</span> 
<span class="n">secret</span> <span class="n">number</span> <span class="ow">is</span> <span class="mi">100</span>
<span class="n">please</span> <span class="nb">input</span> <span class="n">your</span> <span class="n">number100</span>
<span class="n">Your</span> <span class="n">guess</span> <span class="ow">is</span> <span class="mi">100</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"guess.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">21</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">main</span><span class="p">()</span>
  <span class="n">File</span> <span class="s">"guess.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">18</span><span class="p">,</span> <span class="ow">in</span> <span class="n">main</span>
    <span class="n">compare</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"guess.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">13</span><span class="p">,</span> <span class="ow">in</span> <span class="n">compare</span>
    <span class="k">elif</span> <span class="n">guess</span> <span class="o">&gt;</span> <span class="n">secret</span><span class="p">:</span>
  <span class="ne">TypeError</span><span class="p">:</span> <span class="n">unorderable</span> <span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">()</span></code></pre></div>

<p>This is much better - at least you don’t get bad output, your program crashes early
and lets you know you made a mistake. This means you can learn about the problem
from your logs and not from users complaining that they cannot guess their numbers
no matter how hard they try. It is still worse than Rust though, in Rust this would
never launch or run, you’d get error immediately after trying to compile .</p>

<p>Also in Python 3 you can still check incompatible types for equality. 
So imagine you were lazy and wrote your function like this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">guess</span> <span class="o">==</span> <span class="n">secret</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"you win"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"try again loser!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"secret number is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secret</span><span class="p">))</span>

    <span class="n">game_over</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">game_over</span><span class="p">:</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"please input your number"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Your guess is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span>
        <span class="n">game_over</span> <span class="o">=</span> <span class="n">compare</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span></code></pre></div>

<p>Now you have program that relies on equals comparison that will never return True.
Your user is stuck in his game and cannot guess anything, he’s getting frustrated
and angry and you have to fix it. Usually you don’t have this helpful print statement
telling you what is actual secret number, and your program is long and often 
complicated. Not all users are good at communicating their needs so most of 
the time you have to figure out what exactly is the problem. Is the problem real
or is it resulting from users cognitive limitations. Is he really
guessing the right number? Maybe he’s just unlucky all the time? Maybe he enters
something unusual? Finally you have to dig your way through your codebase and find this stupid
trivial error you or someone else made. This is usually not productive and if you
have done this more than once you start to get dislike Python for allowing people
to make errors like this.</p>

<h2 id="static-type-checkers-to-the-rescue">Static type checkers to the rescue</h2>

<p>Luckily Python community is aware of limitations of dynamic typing and there are
attempts to fix the problem.</p>

<p>One really cool attempt to fix this are type annotations. Type annotations allow
you to specify type of function parameters and return values. They are described
in <a href="https://www.python.org/dev/peps/pep-0484/">PEP 0484</a>. Sample syntax looks like this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span>

<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">a</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span></code></pre></div>

<p>This is valid Python, it will work completely fine in Python 3, will fail in Python 2.
By default using type annotations syntax does nothing. Your program will still
compile normally even if it contains invalid type operations. Let’s add type 
annotations to our game and see what happens.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">guess</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">secret</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">guess</span> <span class="o">==</span> <span class="n">secret</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"you win"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"try again loser!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"secret number is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secret</span><span class="p">))</span>

    <span class="n">game_over</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">game_over</span><span class="p">:</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"please input your number"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Your guess is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span>
        <span class="n">game_over</span> <span class="o">=</span> <span class="n">compare</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span></code></pre></div>

<p>Now try to run it and wait. Surprise surprise… Nothing happens. This is by design. Python is dynamically 
typed and it will stay like this. Authors of this PEP dont want to change design
of the language. They just want to make static type checks easier. So they propose
to create static type checker built into the library. Something that could be used
by users optionally. One library is gaining widespread support here, it is called
<a href="https://github.com/JukkaL/mypy">mypy</a> and it’s author Jukka Lehtosalo is also one of the authors of PEP 0484.</p>

<p>MyPy acts same way as linter, it simply checks your program for type errors by
looking at type annotations. So you pass your program to mypy and you get error
saying that you are passing invalid type to your function call.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">~/</span><span class="n">f</span><span class="o">/</span><span class="n">stack</span><span class="o">&gt;</span> <span class="n">mypy</span> <span class="n">guess</span><span class="o">.</span><span class="n">py</span> 

<span class="n">guess</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Argument</span> <span class="mi">1</span> <span class="n">to</span> <span class="s">"compare"</span> <span class="n">has</span> <span class="n">incompatible</span> <span class="nb">type</span> <span class="s">"str"</span><span class="p">;</span> <span class="n">expected</span> <span class="s">"int"</span></code></pre></div>

<p>If MyPy gets mature and is actually built into Standard Library we can get the best
of both worlds. On the one hand people who like static languages can choose to use
static type checkers. Those who prefer benefits of dynamic typing will stick
to dynamic typing.</p>

<p>Probably this will still not be enough for Python enemies though. I’m pretty
sure we’re still going to read rants on Reddit complaining that Python
is not enterprise ready yet because it’s not statically typed.
But I guess at least now every time you hear that you can show them PEP 0484 
and tell them community is working on it.</p>

  </article>

</div></body></html>