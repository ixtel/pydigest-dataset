<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo.jpg"><img class="aligncenter wp-image-3520" src="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo.jpg" alt="videostream_pi_demo" srcset="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo-300x188.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo-1024x640.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo.jpg 1280w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Over the past two weeks on the PyImageSearch blog, we have discussed how to use threading to <em>increase our FPS processing rate</em> on <strong><em>both</em></strong> <a href="http://www.pyimagesearch.com/2015/12/21/increasing-webcam-fps-with-python-and-opencv/" target="_blank">built-in/USB webcams</a>, along with the <a href="http://www.pyimagesearch.com/2015/12/28/increasing-raspberry-pi-fps-with-python-and-opencv/" target="_blank">Raspberry Pi camera module</a>.</p>
<p>By utilizing threading, we learned that we can substantially reduce the affects of I/O latency, leaving the main thread to run without being blocked as it waits for I/O operations to complete (i.e., the reading of the most recent frame from the camera sensor).</p>
<p>Using this threading model, <em>we can dramatically increase our frame processing rate by upwards of 200%.</em></p>
<p>While this increase in FPS processing rate is fantastic, there is still a (somewhat unrelated) problem that has been bothering me for for quite awhile.</p>
<p>You see, there are many times on the PyImageSearch blog where I write posts that are intended for use with a built-in or USB webcam, such as:</p>

<p>All of these posts rely on the 
			<span id="crayon-56d59dc93aaf6836534933" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoCapture</span></span></span>  method.</p>
<p>However, this reliance on 
			<span id="crayon-56d59dc93ab00940897614" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoCapture</span></span></span>  becomes a problem if you want to use the code on our Raspberry Pi. Provided that you are <em>not</em> using a USB camera with the Pi and <em>are in fact using the <a href="https://picamera.readthedocs.org/en/release-1.10/" target="_blank">picamera</a> module</em>, you’ll need to modify the code to be compatible with 
			<span id="crayon-56d59dc93ab04090702878" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span> , as discussed in the <a href="http://www.pyimagesearch.com/2015/03/30/accessing-the-raspberry-pi-camera-with-opencv-and-python/" target="_blank">accessing the Raspberry Pi Camera with Python and OpenCV post</a>.</p>
<p>While there are only a few required changes to the code (i.e., instantiating the 
			<span id="crayon-56d59dc93ab08805198529" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">PiCamera</span></span></span>  class and swapping out the frame read loop), it can still be troublesome, especially if you are just getting started with Python and OpenCV.</p>
<p>Conversely, there are other posts on the PyImageSearch blog which use the 
			<span id="crayon-56d59dc93ab0c650706653" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span>  module <i>instead of</i> 
			<span id="crayon-56d59dc93ab0f719180293" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoCapture</span></span></span> . A great example of such a post is <strong><a href="http://www.pyimagesearch.com/2015/06/01/home-surveillance-and-motion-detection-with-the-raspberry-pi-python-and-opencv/" target="_blank">home surveillance and motion detection with the Raspberry Pi, Python, OpenCV and Dropbox</a></strong>. If you do not own a Raspberry Pi (or want to use a built-in or USB webcam instead of the Raspberry Pi camera module), you would again have to swap out a few lines of code.</p>
<p>Thus, the goal of this post is to a construct a <em><strong>unified interface</strong></em> to both 
			<span id="crayon-56d59dc93ab13307477231" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span>  and 
			<span id="crayon-56d59dc93ab16814661574" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoCapture</span></span></span>  using only a <em><strong>single class</strong></em> named 
			<span id="crayon-56d59dc93ab1a643895859" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span> . This class will call either 
			<span id="crayon-56d59dc93ab1d718351856" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">WebcamVideoStream</span></span></span>  or 
			<span id="crayon-56d59dc93ab20339923394" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">PiVideoStream</span></span></span>  based on the arguments supplied to the constructor.</p>
<p>Most importantly, our implementation of the 
			<span id="crayon-56d59dc93ab24122846558" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  class will allow future video processing posts on the PyImageSearch blog to run on either a <b>built-in webcam</b>, a <strong>USB camera</strong>, or the <strong>Raspberry Pi camera module</strong> — <strong><em>all without changing a single line of code!</em></strong></p>
<p>Read on to find out more.</p>
<p><iframe src="http://www.youtube.com/embed/--90GjhAFH4?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>

<h2>Unifying picamera and cv2.VideoCapture into a single class with OpenCV</h2>
<p>If you recall from <a href="http://www.pyimagesearch.com/2015/12/21/increasing-webcam-fps-with-python-and-opencv/" target="_blank">two weeks ago</a>, we have already defined our threaded 
			<span id="crayon-56d59dc93ab27890312591" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">WebcamVideoStream</span></span></span>  class for built-in/USB webcam access. And <a href="http://www.pyimagesearch.com/2015/12/28/increasing-raspberry-pi-fps-with-python-and-opencv/" target="_blank">last week</a> we defined the 
			<span id="crayon-56d59dc93ab2b885106810" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">PiVideoStream</span></span></span>  class for use with the Raspberry Pi camera module and the 
			<span id="crayon-56d59dc93ab2e028871650" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span>  Python package.</p>
<p>Today we are going to unify these two classes into a single class named 
			<span id="crayon-56d59dc93ab32437869796" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span> .</p>
<p>Depending on the parameters supplied to the 
			<span id="crayon-56d59dc93ab35885566811" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  constructor, the appropriate video stream class (either for the USB camera or 
			<span id="crayon-56d59dc93ab39651655800" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span>  module) will be instantiated. This implementation of 
			<span id="crayon-56d59dc93ab3c079450216" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  will allow us to use the same set of code for all future video processing examples on the PyImageSearch blog.</p>
<p>Readers such as yourselves will only need to supply a <em>single command line argument</em> (or JSON configuration, etc.) to indicate whether they want to use their USB camera or the Raspberry Pi camera module — <em><b>the code itself will not have to change one bit!</b></em></p>
<p>As I’ve mentioned in the previous two blog posts in this series, the functionality detailed here is already implemented inside the <a href="https://github.com/jrosebr1/imutils" target="_blank">imutils</a> package.</p>
<p>If you do not have 
			<span id="crayon-56d59dc93ab40107920568" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">imutils</span></span></span>  already installed on your system, just use 
			<span id="crayon-56d59dc93ab43581012556" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pip</span></span></span>  to install it for you:</p>

		

<p>Otherwise, you can upgrade to the latest version using:</p>

		<div id="crayon-56d59dc93ab4a237606953" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93ab4a237606953-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-v">install</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">upgrade </span><span class="crayon-v">imutils</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Let’s go ahead and get started by defining the 
			<span id="crayon-56d59dc93ab4d989145260" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  class:</p>

		<div id="crayon-56d59dc93ab51818414777" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-2">2</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-4">4</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-6">6</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-8">8</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-10">10</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-12">12</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-14">14</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-16">16</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-18">18</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-20">20</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab51818414777-22">22</p><p class="crayon-num" data-line="crayon-56d59dc93ab51818414777-23">23</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93ab51818414777-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">webcamvideostream </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">WebcamVideoStream</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-4"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">VideoStream</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-5"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usePiCamera</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">resolution</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">320</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">240</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-6"><span class="crayon-h">		</span><span class="crayon-v">framerate</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-7"><span class="crayon-h">		</span><span class="crayon-c"># check to see if the picamera module should be used</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-8"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">usePiCamera</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-9"><span class="crayon-h">			</span><span class="crayon-c"># only import the picamera packages unless we are</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-10"><span class="crayon-h">			</span><span class="crayon-c"># explicity told to do so -- this helps remove the</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-11"><span class="crayon-h">			</span><span class="crayon-c"># requirement of `picamera[array]` from desktops or</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-12"><span class="crayon-h">			</span><span class="crayon-c"># laptops that still want to use the `imutils` package</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-13"><span class="crayon-h">			</span><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">pivideostream </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">PiVideoStream</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-14"> </p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-15"><span class="crayon-h">			</span><span class="crayon-c"># initialize the picamera stream and allow the camera</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-16"><span class="crayon-h">			</span><span class="crayon-c"># sensor to warmup</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-17"><span class="crayon-h">			</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">stream</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PiVideoStream</span><span class="crayon-sy">(</span><span class="crayon-v">resolution</span><span class="crayon-o">=</span><span class="crayon-v">resolution</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-18"><span class="crayon-h">				</span><span class="crayon-v">framerate</span><span class="crayon-o">=</span><span class="crayon-v">framerate</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-20"><span class="crayon-h">		</span><span class="crayon-c"># otherwise, we are using OpenCV so initialize the webcam</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-21"><span class="crayon-h">		</span><span class="crayon-c"># stream</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab51818414777-22"><span class="crayon-h">		</span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59dc93ab51818414777-23"><span class="crayon-h">			</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">stream</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">WebcamVideoStream</span><span class="crayon-sy">(</span><span class="crayon-v">src</span><span class="crayon-o">=</span><span class="crayon-v">src</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On <strong>Line 2</strong> we import our 
			<span id="crayon-56d59dc93ab55917536863" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">WebcamVideoStream</span></span></span>  class that we use for <a href="http://www.pyimagesearch.com/2015/12/21/increasing-webcam-fps-with-python-and-opencv/" target="_blank">accessing built-in/USB web cameras</a>.</p>
<p><strong>Line 5</strong> defines the constructor to our 
			<span id="crayon-56d59dc93ab58982832261" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span> . The 
			<span id="crayon-56d59dc93ab5c737658930" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">src</span></span></span>  keyword argument is only for the 
			<span id="crayon-56d59dc93ab5f621358083" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoCapture</span></span></span>  function (abstracted away by the 
			<span id="crayon-56d59dc93ab62479014542" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">WebcamVideoStream</span></span></span>  class), while 
			<span id="crayon-56d59dc93ab66112023830" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">usePiCamera</span></span></span> , 
			<span id="crayon-56d59dc93ab69846981857" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">resolution</span></span></span> , and 
			<span id="crayon-56d59dc93ab6c705550779" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">framerate</span></span></span>  are for the 
			<span id="crayon-56d59dc93ab6f947769647" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span>  module.</p>
<p>We want to take special care to <em>not make any assumptions</em> about the the type of hardware or the Python packages installed by the end user. If a user is programming on a laptop or a desktop, then it’s <em>extremely unlikely</em> that they will have the 
			<span id="crayon-56d59dc93ab73703334559" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span>  module installed.</p>
<p>Thus, we’ll only import the 
			<span id="crayon-56d59dc93ab76763170133" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">PiVideoStream</span></span></span>  class (which then imports dependencies from 
			<span id="crayon-56d59dc93ab79449311329" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span> ) if the 
			<span id="crayon-56d59dc93ab7d695471578" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">usePiCamera</span></span></span>  boolean indicator is <em><strong>explicitly defined</strong></em> (<strong>Lines 8-18</strong>).</p>
<p>Otherwise, we’ll simply instantiate the 
			<span id="crayon-56d59dc93ab80351589325" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">WebcamVideoStream</span></span></span>  (<strong>Lines 22 and 23</strong>) which requires no dependencies other than a working OpenCV installation.</p>
<p>Let’s define the remainder of the 
			<span id="crayon-56d59dc93ab84297563091" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  class:</p>

		<div id="crayon-56d59dc93ab87840903009" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab87840903009-26">26</p><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab87840903009-28">28</p><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab87840903009-30">30</p><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab87840903009-32">32</p><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab87840903009-34">34</p><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab87840903009-36">36</p><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93ab87840903009-38">38</p><p class="crayon-num" data-line="crayon-56d59dc93ab87840903009-39">39</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93ab87840903009-25"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab87840903009-26"><span class="crayon-h">		</span><span class="crayon-c"># start the threaded video stream</span></p><p class="crayon-line" id="crayon-56d59dc93ab87840903009-27"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">stream</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab87840903009-28"> </p><p class="crayon-line" id="crayon-56d59dc93ab87840903009-29"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab87840903009-30"><span class="crayon-h">		</span><span class="crayon-c"># grab the next frame from the stream</span></p><p class="crayon-line" id="crayon-56d59dc93ab87840903009-31"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">stream</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab87840903009-32"> </p><p class="crayon-line" id="crayon-56d59dc93ab87840903009-33"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab87840903009-34"><span class="crayon-h">		</span><span class="crayon-c"># return the current frame</span></p><p class="crayon-line" id="crayon-56d59dc93ab87840903009-35"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">stream</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab87840903009-36"> </p><p class="crayon-line" id="crayon-56d59dc93ab87840903009-37"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">stop</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93ab87840903009-38"><span class="crayon-h">		</span><span class="crayon-c"># stop the thread and release any resources</span></p><p class="crayon-line" id="crayon-56d59dc93ab87840903009-39"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">stream</span><span class="crayon-sy">.</span><span class="crayon-e">stop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>As we can see, the 
			<span id="crayon-56d59dc93ab8b735648535" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">start</span></span></span> , 
			<span id="crayon-56d59dc93ab8e884153254" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">update</span></span></span> , 
			<span id="crayon-56d59dc93ab91278416045" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">read</span></span></span> , and 
			<span id="crayon-56d59dc93ab95592408258" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">stop</span></span></span>  methods simply call the corresponding methods of the 
			<span id="crayon-56d59dc93ab98136739376" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">stream</span></span></span>  which was instantiated in the constructor.</p>
<p>Now that we have defined the 
			<span id="crayon-56d59dc93ab9b359467233" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  class, let’s put it to work in our 
			<span id="crayon-56d59dc93ab9f481042968" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">videostream_demo</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  driver script:</p>

		<div id="crayon-56d59dc93aba2822507224" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-2">2</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-4">4</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-6">6</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-8">8</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-10">10</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-12">12</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-14">14</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93aba2822507224-16">16</p><p class="crayon-num" data-line="crayon-56d59dc93aba2822507224-17">17</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93aba2822507224-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">video </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">VideoStream</span></p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">imutils</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-8"> </p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-9"><span class="crayon-c"># construct the argument parse and parse the arguments</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-10"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-11"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-p"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--picamera"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">type</span><span class="crayon-o">=</span><span class="crayon-k ">int</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">default</span><span class="crayon-o">=</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-12"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"whether or not the Raspberry Pi camera should be used"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-13"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-14"> </p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-15"><span class="crayon-c"># initialize the video stream and allow the cammera sensor to warmup</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93aba2822507224-16"><span class="crayon-v">vs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">VideoStream</span><span class="crayon-sy">(</span><span class="crayon-v">usePiCamera</span><span class="crayon-o">=</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"picamera"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59dc93aba2822507224-17"><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">2.0</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start off by importing our required Python packages (<strong>Lines 2-7</strong>) and parsing our command line arguments (<strong>Lines 10-13</strong>). We only need a single switch here, 
			<span id="crayon-56d59dc93aba6236905022" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">picamera</span></span></span> , which is used to indicate whether the Raspberry Pi camera module or the built-in/USB webcam should be used. We’ll default to the built-in/USB webcam.</p>
<p><strong>Lines 16 and 17</strong> instantiate our 
			<span id="crayon-56d59dc93aba9917097807" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  and allow the camera sensor to warmup.</p>
<p>At this point, all the hard work is done! We simply need to start looping over frames from the camera sensor:</p>

		<div id="crayon-56d59dc93abad578280807" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-20">20</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-22">22</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-24">24</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-26">26</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-28">28</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-30">30</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-32">32</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-34">34</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-36">36</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-38">38</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-40">40</p><p class="crayon-num" data-line="crayon-56d59dc93abad578280807-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59dc93abad578280807-42">42</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93abad578280807-19"><span class="crayon-c"># loop over the frames from the video stream</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-20"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-21"><span class="crayon-h">	</span><span class="crayon-c"># grab the frame from the threaded video stream and resize it</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-22"><span class="crayon-h">	</span><span class="crayon-c"># to have a maximum width of 400 pixels</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-23"><span class="crayon-h">	</span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vs</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-24"><span class="crayon-h">	</span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">resize</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-cn">400</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-25"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-26"><span class="crayon-h">	</span><span class="crayon-c"># draw the timestamp on the frame</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-27"><span class="crayon-h">	</span><span class="crayon-v">timestamp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">now</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-28"><span class="crayon-h">	</span><span class="crayon-v">ts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">timestamp</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">"%A %d %B %Y %I:%M:%S%p"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-29"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">putText</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">FONT_HERSHEY_SIMPLEX</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-30"><span class="crayon-h">		</span><span class="crayon-cn">0.35</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-31"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-32"><span class="crayon-h">	</span><span class="crayon-c"># show the frame</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-33"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Frame"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-34"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">0xFF</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-35"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-36"><span class="crayon-h">	</span><span class="crayon-c"># if the `q` key was pressed, break from the loop</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-37"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-k ">ord</span><span class="crayon-sy">(</span><span class="crayon-s">"q"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-38"><span class="crayon-h">		</span><span class="crayon-st">break</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-39"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-40"><span class="crayon-c"># do a bit of cleanup</span></p><p class="crayon-line" id="crayon-56d59dc93abad578280807-41"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">destroyAllWindows</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59dc93abad578280807-42"><span class="crayon-v">vs</span><span class="crayon-sy">.</span><span class="crayon-e">stop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On <strong>Line 20</strong> we start an infinite loop that continues until we press the 
			<span id="crayon-56d59dc93abb1751342977" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">q</span></span></span>  key.</p>
<p><strong>Line 23</strong> calls the 
			<span id="crayon-56d59dc93abb5071869999" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">read</span></span></span>  method of 
			<span id="crayon-56d59dc93abb8839197759" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  which returns the most recently read 
			<span id="crayon-56d59dc93abbb191600516" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  from the stream (again, either a USB webcam stream or the Raspberry Pi camera module).</p>
<p>We then resize the frame (<strong>Line 24</strong>), draw the current timestamp on it (<strong>Lines 27-30</strong>), and finally display the frame to our screen (<strong>Lines 33 and 34</strong>).</p>
<p>This is obviously a trivial example of a video processing pipeline, but keep in mind the goal of this post is to simply demonstrate how we can create a unified interface to both the 
			<span id="crayon-56d59dc93abbf258509443" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">picamera</span></span></span>  module and the 
			<span id="crayon-56d59dc93abc2411294676" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoCapture</span></span></span>  function.</p>
<h2>Testing out our unified interface</h2>
<p>To test out our 
			<span id="crayon-56d59dc93abc5022053711" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span> class, I used:</p>

<p>To access the built-in camera on my OSX machine, I executed the following command:</p>

		<div id="crayon-56d59dc93abc9076974153" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93abc9076974153-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">videostream_demo</span><span class="crayon-e">.py</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/><div id="attachment_3521" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_osx_demo.jpg"><img class="wp-image-3521" src="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_osx_demo.jpg" alt="Figure 1: Accessing the built-in camera on my OSX machine with Python and OpenCV." srcset="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_osx_demo-300x193.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_osx_demo.jpg 818w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Accessing the built-in camera on my OSX machine with Python and OpenCV.</p></div>
<p>As you can see, frames are read from my webcam and displayed to my screen.</p>
<p>I then moved over to my Raspberry Pi where I executed the same command to access the USB camera:</p>

		<div id="crayon-56d59dc93abcd504560744" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93abcd504560744-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">videostream_demo</span><span class="crayon-e">.py</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Followed by this command to read frames from the Raspberry Pi camera module:</p>

		<div id="crayon-56d59dc93abd1193351712" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59dc93abd1193351712-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">videostream_demo</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-i">picamera</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The results of executing these commands in two separate terminals can be seen below:</p>
<div id="attachment_3520" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo.jpg"><img class="wp-image-3520" src="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo.jpg" alt="Figure 2: Accessing both the Raspberry Pi camera module and a USB camera on my Raspberry Pi using the exact same Python class." srcset="http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo-300x188.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo-1024x640.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2016/01/videostream_pi_demo.jpg 1280w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Accessing both the Raspberry Pi camera module and a USB camera on my Raspberry Pi using the exact same Python class.</p></div>
<p>As you can see, <em>the only thing that has changed</em> is the command line arguments where I supply 
			<span id="crayon-56d59dc93abd5521461117" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-i">picamera</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></span></span> , indicating that I want to use the Raspberry Pi camera module — <em><strong>not a single line of code needed to be modified!</strong></em></p>
<p>You can see a video demo of both the USB camera and the Raspberry Pi camera module being used simultaneously below:</p>
<p><iframe src="http://www.youtube.com/embed/--90GjhAFH4?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<h2>Summary</h2>
<p>This blog post was the third and final installment in our series on increasing FPS processing rate and decreasing I/O latency on both USB cameras and the Raspberry Pi camera module.</p>
<p>We took our implementations of the (threaded) 
			<span id="crayon-56d59dc93abd8741731185" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">WebcamVideoStream</span></span></span>  and 
			<span id="crayon-56d59dc93abdc881614769" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">PiVideoStream</span></span></span>  classes and unified them into a single 
			<span id="crayon-56d59dc93abdf908883946" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  class, allowing us to seamlessly access <em>either</em> built-in/USB cameras or the Raspberry Pi camera module.</p>
<p>This allows us to construct Python scripts that will run on <em><strong>both</strong></em> laptop/desktop machines along with the the Raspberry Pi <em>without having to modify a single line of code</em> — provided that we supply some sort of method to indicate which camera we would like to use, of course, This can easily be accomplished using command line arguments, JSON configuration files, etc.</p>
<p>In future blog posts where video processing is performed, I’ll be using the 
			<span id="crayon-56d59dc93abe3256544848" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  class to make the code examples compatible with both your USB camera and the Raspberry Pi camera module — <em>no longer will you have to adjust the code based on your setup!</em></p>
<p>Anyway, I hope you enjoyed this series of posts. If you found me doing a <em>series</em> of blog posts (rather than <em>one-off</em> posts on a specific topic) beneficial, please let me know in the comments thread.</p>
<p><strong>And also consider signing up for the PyImageSearch Newsletter using the form below to be notified when new blog posts are published!</strong></p>
<h2 id="post_downloads">Downloads:</h2>

	</section>
	</div></body></html>