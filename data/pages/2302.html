<html><body><div><tr><td class="linenos"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111</pre></td><td class="code"><div class="highlight"><pre><span class="sd">"""Mix-in classes for easy attribute setting and pretty representation</span>

<span class="sd">&gt;&gt;&gt; class T(HasInitableAttributes, HasTypedAttributes, IsCallable):</span>
<span class="sd">...     spam = str</span>
<span class="sd">...     def __init__(self, eggs, ham = 'ham'): pass</span>
<span class="sd">...</span>
<span class="sd">&gt;&gt;&gt; t = T('bacon'); t(ham = 'eggs'); t.spam += 'sausage'; t</span>
<span class="sd">__main__.T('bacon', ham = 'eggs', spam = 'sausage')</span>
<span class="sd">&gt;&gt;&gt; </span>
<span class="sd">"""</span>

<span class="k">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getargspec</span>
<span class="k">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span>


<span class="k">class</span> <span class="nc">HasInitableAttributes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""Initializes attributes automatically</span>

<span class="sd">    &gt;&gt;&gt; class T(HasInitableAttributes):</span>
<span class="sd">    ...     z = 0</span>
<span class="sd">    ...     def __init__(self, x, y=0, **opts): pass</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; t = T(0, a = 1); t</span>
<span class="sd">    __main__.T(0, a = 1)</span>
<span class="sd">    &gt;&gt;&gt; t.x, t.y, t.z = 1, 2, 3; t</span>
<span class="sd">    __main__.T(1, y = 2, a = 1, z = 3)</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    """</span>
    
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="s">"Initialize all attributes in the signature and any other options supplied"</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_argspec</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">parsname</span><span class="p">,</span> <span class="n">optsname</span><span class="p">,</span> <span class="n">defaults</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defaults</span><span class="p">:</span> <span class="n">defaults</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">:</span>
            <span class="n">_s</span><span class="p">,</span> <span class="n">_to</span> <span class="o">=</span> <span class="p">(</span><span class="s">'s'</span><span class="p">,</span> <span class="s">'-</span><span class="si">%d</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mf">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1</span> <span class="k">else</span> <span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
            <span class="n">missing</span> <span class="o">=</span>  <span class="s">"</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> (pos </span><span class="si">%d%s</span><span class="s">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mf">1</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mf">1</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">),</span> <span class="n">_to</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">"Required argument</span><span class="si">%s</span><span class="s"> not found."</span> <span class="o">%</span> <span class="n">missing</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">):],</span> <span class="n">defaults</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mf">1</span><span class="p">:],</span> <span class="n">pars</span><span class="p">),</span> <span class="n">opts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"Show all attributes in the signature and any other public attributes that are changed"</span>
        <span class="n">names</span><span class="p">,</span> <span class="n">parsname</span><span class="p">,</span> <span class="n">optsname</span><span class="p">,</span> <span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_argspec</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defaults</span><span class="p">:</span> <span class="n">defaults</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">optnames</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">):]</span> <span class="k">if</span> <span class="n">defaults</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">optvalues</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">optnames</span><span class="p">)</span>
        <span class="n">othernames</span> <span class="o">=</span> <span class="n">sorted</span><span class="p">(</span><span class="n">set</span><span class="p">((</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'_'</span><span class="p">))</span> <span class="o">-</span> <span class="n">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
        <span class="n">othervalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">othernames</span><span class="p">))</span>
        <span class="n">otherdefaults</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">othernames</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">"</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[</span><span class="mf">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s">"</span><span class="si">%s</span><span class="s"> = </span><span class="si">%r</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">optnames</span><span class="p">,</span> <span class="n">optvalues</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">default</span><span class="p">),</span>
            <span class="p">(</span><span class="s">"</span><span class="si">%s</span><span class="s"> = </span><span class="si">%r</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">othernames</span><span class="p">,</span> <span class="n">othervalues</span><span class="p">,</span> <span class="n">otherdefaults</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">default</span><span class="p">))))</span>


<span class="k">class</span> <span class="nc">HasTypedAttributes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""Objectifies class attributes automatically</span>

<span class="sd">    &gt;&gt;&gt; class T(HasTypedAttributes):</span>
<span class="sd">    ...     spam = str</span>
<span class="sd">    ...     class C(HasTypedAttributes):</span>
<span class="sd">    ...         eggs = list</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; a, b = T(), T(); a.spam += 'ham'; a.C.eggs.append('bacon'); a.spam, b.spam, a.C.eggs, b.C.eggs</span>
<span class="sd">    ('ham', '', ['bacon'], [])</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'_'</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">opts</span> <span class="k">else</span> <span class="n">value</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">"__init__() got</span><span class="si">%s</span><span class="s"> unexpected keyword argument</span><span class="si">%s</span><span class="s"> </span><span class="si">%r</span><span class="s">"</span> <span class="o">%</span> 
                <span class="p">(</span><span class="s">" an"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mf">0</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1</span> <span class="k">else</span> <span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"s"</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">IsCallable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""Update attributes by calling</span>

<span class="sd">    &gt;&gt;&gt; class T(IsCallable):</span>
<span class="sd">    ...     x = 0</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; t = T(); t(x=1, y=2); t.x, t.y</span>
<span class="sd">    (1, 2)</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">pars</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">from</span> <span class="nn">doctest</span> <span class="k">import</span> <span class="n">testmod</span>
    <span class="n">testmod</span><span class="p">()</span>
    <span class="k">class</span> <span class="nc">T</span><span class="p">(</span><span class="n">HasInitableAttributes</span><span class="p">,</span> <span class="n">HasTypedAttributes</span><span class="p">,</span> <span class="n">IsCallable</span><span class="p">):</span>
        <span class="n">spam</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">spam</span> <span class="o">!=</span> <span class="nb">str</span>
</pre></div>
</td></tr></div></body></html>