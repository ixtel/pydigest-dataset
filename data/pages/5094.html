<html><body><div><div class="post-text" itemprop="text">

<p>I was following the tutorial on <a href="https://docs.djangoproject.com/en/1.8/ref/contrib/gis/tutorial/#importing-spatial-data">https://docs.djangoproject.com/en/1.8/ref/contrib/gis/tutorial/#importing-spatial-data</a> for setting up GeoDjango on my machine. But it seems like there is some issue there. While importing data using LayerMapping by running <code>load.run()</code>, I get the following error:</p>

<pre><code>Traceback (most recent call last):
  File "&lt;console&gt;", line 1, in &lt;module&gt;
  File "/home/ubuntu/src/django/world/load.py", line 23, in run
    lm = LayerMapping(WorldBorder, world_shp, world_mapping, transform=False, encoding='iso-8859-1')
  File "/home/ubuntu/Envs/vir-env/local/lib/python2.7/site-packages/django/contrib/gis/utils/layermapping.py", line 105, in __init__
    self.check_layer()
  File "/home/ubuntu/Envs/vir-env/local/lib/python2.7/site-packages/django/contrib/gis/utils/layermapping.py", line 178, in check_layer
    ogr_field_types = self.layer.field_types
  File "/home/ubuntu/Envs/vir-env/local/lib/python2.7/site-packages/django/contrib/gis/gdal/layer.py", line 153, in field_types
    for i in range(self.num_fields)]
KeyError: 12
</code></pre>

<p>Then I found out that, there is no 'MULTIPOLYGON' field in the <code>.shp</code> file:</p>

<pre><code>&gt;&gt;&gt; from django.contrib.gis.gdal import DataSource
&gt;&gt;&gt; ds = DataSource('world/data/TM_WORLD_BORDERS-0.3.shp')
&gt;&gt;&gt; layer = ds[0]
&gt;&gt;&gt; layer.fields
[u'FIPS', u'ISO2', u'ISO3', u'UN', u'NAME', u'AREA', u'POP2005', u'REGION', u'SUBREGION', u'LON', u'LAT']
</code></pre>

<p>But it's there in the <code>WorldBorder</code> model, as type <code>MultiPolygonField</code>.
So, definitely in the world_mapping file, importing will fail for the <code>'mpoly': 'MULTIPOLYGON'</code> mapping. Has anyone else faced this issue? I hope so, as I've followed the tutorial step-by-step. But it doesn't say anything about such issue. What effect it will have, if I load data by removing <code>mpoly</code> mapping?</p>

<p>Here's my load.py file:</p>

<pre><code>  1 import os
  2 from django.contrib.gis.utils import LayerMapping
  3 from models import WorldBorder
  4
  5 world_mapping = {
  6     'fips' : 'FIPS',
  7     'iso2' : 'ISO2',
  8     'iso3' : 'ISO3',
  9     'un' : 'UN',
 10     'name' : 'NAME',
 11     'area' : 'AREA',
 12     'pop2005' : 'POP2005',
 13     'region' : 'REGION',
 14     'subregion' : 'SUBREGION',
 15     'lon' : 'LON',
 16     'lat' : 'LAT',
 17     'mpoly' : 'MULTIPOLYGON',
 18 }
 19
 20 world_shp = os.path.abspath(os.path.join(os.path.dirname(__file__), 'data/TM_WORLD_BORDERS-0.3.shp'))
 21
 22 def run(verbose=True):
 23     lm = LayerMapping(WorldBorder, world_shp, world_mapping, transform=False, encoding='iso-8859-1')
 24
 25     lm.save(strict=True, verbose=verbose)
</code></pre>

<hr/>

<p>Just an update: 
After going through source code, via stack trace, I figured that I'm unable to access <code>field_types</code> propery of <code>layer</code> module. So, from python shell, when I access that property, I get the same error:</p>

<pre><code>&gt;&gt;&gt; from django.contrib.gis.gdal import DataSource
&gt;&gt;&gt; ds = DataSource(wshp)
&gt;&gt;&gt; layer = ds[0]
&gt;&gt;&gt; layer.fields
[u'FIPS', u'ISO2', u'ISO3', u'UN', u'NAME', u'AREA', u'POP2005', u'REGION', u'SUBREGION', u'LON', u'LAT']
&gt;&gt;&gt; layer.field_types
Traceback (most recent call last):
  File "&lt;console&gt;", line 1, in &lt;module&gt;
  File "/home/ubuntu/Envs/rj-venv/local/lib/python2.7/site-packages/django/contrib/gis/gdal/layer.py", line 153, in field_types
    for i in range(self.num_fields)]
KeyError: 12
</code></pre>

<p>Now, this is strange, because now I've also removed <code>mpoly</code> field from <code>WorldBorder</code> model.</p>

<hr/>

<p>Update 2:</p>

<p>After digging through the source code, I found out that, <code>OGDFieldTypes</code> in my version of gdal, might not have the key 12, as in the source code here: <a href="https://github.com/django/django/blob/master/django/contrib/gis/gdal/field.py">https://github.com/django/django/blob/master/django/contrib/gis/gdal/field.py</a>.
But it says that keys 12, and 13 will be available for <code>GDAL 2</code>, and that is what I've installed. Really seems to be some conflict among libraries now.</p>

<p>I've installed the following libraries:</p>

<ul>
<li>geos-3.4.2.tar.bz2</li>
<li>proj-datumgrid-1.5.tar.gz</li>
<li>proj-4.8.0.tar.gz</li>
<li>gdal-2.0.0.tar.gz</li>
</ul>

<p>And PostGIS version 2.1.5 is installed in Amazon RDS instance.</p>
    </div>
    </div></body></html>