<html><body><div><p>A lightweight and pythonic retry helper.</p>
<div id="basic-syntax">
<h3>Basic syntax</h3>
<pre><span class="kn">import</span> <span class="nn">tryagain</span>

<span class="k">def</span> <span class="nf">unstable_function</span><span class="p">():</span>
    <span class="c1"># Attention: This function sometimes fails!</span>
    <span class="o">...</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable_function</span><span class="p">,</span>
                       <span class="n">max_attempts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">=</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                       <span class="n">cleanup_hook</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pre_retry_hook</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre>
<div id="parameters">
<h4>Parameters</h4>
<ul>
<li><tt>func</tt>: The unstable function to call</li>
<li><tt>max_attemps</tt>: Any integer number to limit the maximum number of
attempts. Set to None for unlimited retries.</li>
<li><tt>exceptions</tt>: An iterable of exceptions that should result in a
retry.</li>
<li><tt>wait</tt>: Can be an integer or float value (to specify a waittime in seconds) or a custom function (see Waittime documentation)</li>
<li><tt>cleanup_hook</tt>: Can be set to a callable and will be called after
an exception is raised from calling <tt>func</tt>.</li>
<li><tt>pre_retry_hook</tt>: Can be set to any callable that will be called
before <tt>func</tt> is called.</li>
</ul>
</div>
<div id="result">
<h4>Result</h4>
<p><tt>tryagain.call</tt> will return whatever the unstable function would
return. <tt>tryagain.call</tt> reraises any exception which is:</p>
<ul>
<li>not in the given <tt>exceptions</tt></li>
<li>raised in the <tt>pre_retry_hook</tt> or in <tt>cleanup_hook</tt></li>
<li>raised in the last attempt at calling the unstable function.</li>
</ul>
</div>
</div>
<div id="quickstart">
<h3>Quickstart</h3>
<div id="retry-calling-an-unstable-function">
<h4>Retry calling an unstable function</h4>
<pre><span class="kn">import</span> <span class="nn">tryagain</span>

<span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="o">...</span>

<span class="c1"># retry calling 'unstable' until it returns without raising an exception</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">)</span>

<span class="c1"># limit to maximum 5 attempts</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># only retry after specific exceptions</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">=</span><span class="p">[</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">])</span>
</pre>
</div>
<div id="waittimes">
<h4>Waittimes</h4>
<p>The tryagain library allows fixed wait values as well as custom waittime
functions.</p>
<pre><span class="c1"># wait one second before trying again</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># waittime rises linearly (n is the number of attempts)</span>
<span class="c1"># (will wait 1s, 2s, 3s, ...)</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="p">)</span>

<span class="c1"># waittime rises exponentially with each attempt</span>
<span class="c1"># (will wait 2s, 4s, 8s, ...)</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">n</span><span class="p">)</span>

<span class="c1"># exponentially rising waittime with maximum</span>
<span class="c1"># (will wait 2s, 4s, 5s, 5s, ..., 5s)</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># no waiting time before second attempt, 1.0s afterwards</span>
<span class="k">def</span> <span class="nf">no_first_wait</span><span class="p">(</span><span class="n">attempt</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">no_first_wait</span><span class="p">)</span>
</pre>
</div>
<div id="retry-calling-a-function-with-parameters">
<h4>Retry calling a function with parameters</h4>
<pre><span class="c1"># using a lambda</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">unstable</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="n">some_arg</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">wait</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># using a partial</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="s1">'message'</span><span class="p">,</span> <span class="n">some_arg</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">wait</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># using a separate function</span>
<span class="k">def</span> <span class="nf">call_unstable_function</span><span class="p">():</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">'message'</span>
    <span class="k">return</span> <span class="n">unstable</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">some_arg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">call_unstable_function</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre>
</div>
<div id="function-decorator">
<h4>Function decorator</h4>
<pre><span class="kn">from</span> <span class="nn">tryagain</span> <span class="kn">import</span> <span class="n">retries</span>

<span class="nd">@retries</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unstable</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="c1"># your unstable function here</span>

<span class="n">unstable</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="s1">'bar'</span><span class="p">)</span>
</pre>
</div>
<div id="hooks">
<h4>Hooks</h4>
<p>The tryagain library features two hooks that can be used,
<tt>cleanup_hook</tt> and <tt>pre_retry_hook</tt>.</p>
<pre><span class="k">def</span> <span class="nf">unstable</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'Calling unstable function'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'Exception!'</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span>

<span class="n">tryagain</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">unstable</span><span class="p">,</span> <span class="n">max_attempts</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">wait</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s1">'waiting'</span><span class="p">),</span>
              <span class="n">cleanup_hook</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s1">'cleaning up'</span><span class="p">),</span>
              <span class="n">pre_retry_hook</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s1">'do preparations'</span><span class="p">))</span>
<span class="s1">'Calling unstable function'</span>
<span class="s1">'Exception!'</span>
<span class="s1">'cleaning up'</span>
<span class="s1">'waiting'</span>
<span class="s1">'do preparations'</span>
<span class="s1">'Calling unstable function'</span>
<span class="s1">'Exception!'</span>
<span class="s1">'cleaning up'</span>
<span class="n">Error</span><span class="p">:</span> <span class="ne">Exception</span> <span class="n">raised</span><span class="o">...</span>
</pre>
</div>
</div>
</div></body></html>