<html><body><div><article class="post-content"> <p><em>“He has thirty men’s heft of grasp in the gripe of his hand, the bold-in-battle. Blessed God out of his mercy this man hath sent to Danes of the West, as I ween indeed, against horror of Grendel”</em> - Beowulf</p> <p><br/></p> <div class="row"> <p class="col-md-1"/> <div class="col-md-10"><img src="http://rpiai.com/assets/images/computers.jpg" alt="A selection of the computers in my cluster" class="img-responsive center-block"/> <p>My Beowulf cluster contains two Raspberry Pi’s (Model B and Model B+), two 2004 Mac G4 iBooks loaded with Lubuntu, a Chromebook with crouton, a Intel i7 desktop with VirtualBox hosting Ubuntu, and a Intel Xeon virtual server with Ubuntu.</p></div> <p class="col-md-1"/> </div> <p><br/> <br/> Introduction ============</p> <p>This program is a example of a <a href="http://en.wikipedia.org/wiki/Beowulf_cluster">Beowulf cluster</a> or so-called <a href="http://www.extremelinux.info/stonesoup/">Stone SouperComputer</a> when hooked up with antiquated computers. My program uses Python and SSH and is very simple (&lt; 200 lines). However, there are pretty good libraries like <a href="http://www.open-mpi.org/">MPI</a> out there that can be used instead for more intensive applications. When computers are in clusters they can do cool things, like carry out <a href="http://www.mersenne.org/">the great prime search</a>, or <a href="http://folding.stanford.edu/">solve the protein folding problem</a>. My program is a simple way of doing something similar, using basically any computer that can run at least Lubuntu with very minimal coding.</p> <p>How does it work? Basically, the server connects to any number of client computers via SSH and asks them to help compute some problem. Once a client finishes, the client sends back to the result to the server which stores the result on its own disk. The server then sends that client a new set of computations to finish, and this repeats until all the computations are finished. The client never has to store any information. The server is able to keep track of the client threads, the overall productivity and productivity of each client, and the entirety of the finished results.</p> <p>The following information and code is readily available to download from my <a href="http://github.com/schollz/beowulf_ssh_cluster">Github</a>.</p> <h1 id="uses">Uses</h1> <h2 id="computation">Computation.</h2> <p>Beowulf clusters can be used for computation. My cluster is more of a Stone Soupercomputer - a cluster of antiquated computers - so some of the computers will be exceedingly slow.</p> <p>The example I’ve included here is a computational-use - the computation of the first ten million primes. As an example of the disparity between computers when using a Beowulf cluster of old and new, here is a plot of the rate of prime searching for the computers in my cluster:</p> <p><br/></p>  <p><br/> <br/> As you can see, you’d need about five 10-year-old computers to equivalate a single modern desktop. Its probably just better to buy a desktop if this is what you want. Modern computers are faster and more energy efficient, so using antiquated computers for computation probably is not a wise choice.</p> <h1 id="web-scraping">Web scraping.</h1> <p>A Beowulf cluster is especially suited for scraping, since the bottleneck is mainly the connection time to the website. Thus, the web scraping with a Beowulf cluster will roughly scale with the number of computers (or cores per computers). If you do use this for a web scraper you might like to use <a href="http://www.torproject.org/">Tor</a> so you don’t get blocked - I’ve included a code block that utilizes Tor. Here is a plot of my results from the same computers I used above for scraping a website with and without Tor:</p> <p><br/></p>  <p><br/> <br/> For this purpose, the slowest, older computers are only about two times slower than he fastest, newest computers. And by combining their power, you can basically recover the entirety of their might as shown by the actual sites per minute gathered by the cluster versus the sum of individual components:</p> <p><br/></p>  <p><br/> <br/> Of course, you’ll also see that Tor will slow you down quite a bit if you choose to use that extra security boost.</p> <p><strong>Note, if you do use this as a web scraper, be sure to read the Terms of Service and make sure to follow <code class="highlighter-rouge">robots.txt</code> as some sites do not allow web scraping (and be kind not to overload any servers with thousands of connections per second).</strong></p> <h1 id="the-code">The Code</h1> <h2 id="server">Server</h2> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pickle</span>


<span class="n">cluster</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cluster</span><span class="p">[</span><span class="s">'this computer'</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s">'address'</span><span class="p">:</span><span class="s">'username@127.0.0.1'</span><span class="p">,</span><span class="s">'cores'</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>

<span class="c"># Generic worker thread for sending commands
</span>
<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">i</span><span class="p">,):</span>
    <span class="k">global</span> <span class="n">response</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">err</span><span class="p">)</span><span class="o">=</span><span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">exit_code</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="n">response</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>

<span class="c"># Worker initiation protocol to send a command but wait until all threads are finished
</span>
<span class="k">def</span> <span class="nf">runAndWait</span><span class="p">(</span><span class="n">remote_cmd</span><span class="p">,</span><span class="n">clients</span><span class="p">):</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">"ssh "</span><span class="o">+</span><span class="n">clients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">" '"</span><span class="o">+</span><span class="n">remote_cmd</span><span class="o">+</span><span class="s">"'"</span>
        <span class="k">print</span> <span class="n">cmd</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">i</span><span class="p">,))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)):</span>
            <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>       
    <span class="k">print</span> <span class="s">'['</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">']: DONE'</span>

<span class="c"># Worker initiation protocol to send a file and wait until all files are sent
</span>
<span class="k">def</span> <span class="nf">sendFileAndWait</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">clients</span><span class="p">):</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">"scp "</span> <span class="o">+</span> <span class="nb">file</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">clients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span><span class="n">folder</span><span class="o">+</span><span class="s">"/"</span>
        <span class="k">print</span> <span class="n">cmd</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">i</span><span class="p">,))</span>
        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)):</span>
            <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>       
    <span class="k">print</span> <span class="s">'['</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">']: DONE'</span>


<span class="c"># Generate list of clients (add extra if there are extra cores available)
</span>
<span class="n">clients</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">computer</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cluster</span><span class="p">[</span><span class="n">computer</span><span class="p">][</span><span class="s">'cores'</span><span class="p">])):</span>
        <span class="n">clients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="p">[</span><span class="n">computer</span><span class="p">][</span><span class="s">'address'</span><span class="p">])</span>

<span class="c"># Initialize responses
</span>
<span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clients</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c"># Initialize logging
</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
    <span class="n">format</span><span class="o">=</span><span class="s">'</span><span class="si">%(asctime)</span><span class="s">s </span><span class="si">%(name)-12</span><span class="s">s </span><span class="si">%(levelname)-8</span><span class="s">s </span><span class="si">%(message)</span><span class="s">s'</span><span class="p">,</span>
    <span class="n">datefmt</span><span class="o">=</span><span class="s">'</span><span class="si">%</span><span class="s">y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d </span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S'</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s">'server.log'</span><span class="p">,</span>
    <span class="n">filemode</span><span class="o">=</span><span class="s">'a'</span>
<span class="p">)</span>

<span class="c"># First make the distributed folder if it doesn't exist
</span>
<span class="n">runAndWait</span><span class="p">(</span><span class="s">'mkdir beowulf'</span><span class="p">,</span><span class="n">clients</span><span class="p">)</span>

<span class="c"># Second, send the file to run
</span>
<span class="n">sendFileAndWait</span><span class="p">(</span><span class="s">'client_primes.py'</span><span class="p">,</span><span class="s">'beowulf'</span><span class="p">,</span><span class="n">clients</span><span class="p">)</span>

<span class="c"># Start up tor (if needed)
</span>
<span class="c">#runAndWait('base64 -d ~/pass | sudo -S /etc/init.d/tor restart',clients)
</span>


<span class="c"># Initialize the threads with a simple task
</span>
<span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">clientDiag</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)):</span>
    <span class="n">response</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="s">""</span>
    <span class="n">remote_cmd</span> <span class="o">=</span> <span class="s">'ls -l | tail -n 1'</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">"ssh "</span><span class="o">+</span><span class="n">clients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">" '"</span><span class="o">+</span><span class="n">remote_cmd</span><span class="o">+</span><span class="s">"'"</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">i</span><span class="p">,))</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">clientDiag</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
    <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'server'</span><span class="p">]</span> <span class="o">=</span> <span class="n">clients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'lastSeen'</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'totalIterations'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'timePerIteration'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>


<span class="c"># Start main thread
</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'main'</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">finish</span> <span class="o">=</span> <span class="mi">10000000</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="mi">10000</span> <span class="c"># number of blocks to do each time. Try to block size ~1-5 seconds of computation time to take advantage
</span>
<span class="n">master_index</span> <span class="o">=</span> <span class="n">start</span>
<span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">while</span> <span class="n">master_index</span><span class="o">&lt;</span><span class="n">finish</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
            <span class="c"># Get response
</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">json_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="c"># Save whatever data you want from the response
</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">json_object</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">json_object</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'primes'</span><span class="p">,</span><span class="s">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'n'</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">"No JSON object detected"</span>

            <span class="c"># Update the client meta-data
</span>
            <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'lastSeen'</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'totalIterations'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">blocks</span>
            <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'timePerIteration'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">startTime</span><span class="p">)</span><span class="o">/</span><span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'totalIterations'</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'totalIterations'</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="n">blocks</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">clientDiag</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c"># Send the next set
</span>
            <span class="c"># Firt argument is Tor flag
</span>
            <span class="n">remote_cmd</span> <span class="o">=</span> <span class="s">'python beowulf/client_primes.py 0 '</span> <span class="o">+</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">master_index</span><span class="p">,</span><span class="n">master_index</span><span class="o">+</span><span class="n">blocks</span><span class="p">))</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">"ssh "</span><span class="o">+</span><span class="n">clients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">" '"</span><span class="o">+</span><span class="n">remote_cmd</span><span class="o">+</span><span class="s">"'"</span>
            <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">master_index</span> <span class="o">+=</span> <span class="n">blocks</span>

            <span class="c"># Log every 20 blocks
</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">master_index</span><span class="o">-</span><span class="n">start</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">blocks</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">startTime</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">master_index</span><span class="o">-</span><span class="n">start</span><span class="o">+</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="s">' seconds per iteration (TOTAL)'</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Finished up to '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">master_index</span><span class="p">))</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">05</span><span class="p">)</span></code></pre></figure> <h2 id="client">Client</h2> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">urllib2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">socks</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">"you need to install PySocks for Tor use"</span>
    <span class="kn">import</span> <span class="nn">socket</span>
    <span class="n">socks</span><span class="o">.</span><span class="n">set_default_proxy</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">SOCKS5</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">9050</span><span class="p">)</span>
    <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socks</span><span class="o">.</span><span class="n">socksocket</span>
    <span class="c">#my_ip = urllib2.urlopen('http://icanhazip.com').read()
</span>

<span class="k">def</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="o">*</span><span class="n">nums</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">results</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">is_prime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="k">print</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">worker</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span></code></pre></figure> <h1 id="how-it-works">How it works</h1> <h2 id="server-1">Server</h2> <p>The server computer needs to have SSH access to each of the computers in the cluster using a SSH key (to alleviate having to store passwords in the program). You can setup SSH pretty easily by installing <code class="highlighter-rouge">openssh-client</code> on each of the cluster computers. The cluster computers can be LAN or Public, as long as you have access to them via SSH and they can run Linux. Also make sure to install whatever Python libraries you’ll need on the corresponding computers, as this program doesn’t do that yet.</p> <p>To generate a SSH key on the server computer, simply use</p>  <p>And just press enter/enter/enter.</p> <p>Then copy the ssh key to all your connected computers using</p>  <p>And type in your password. That should be the only time you need to type in your password. Then, if the clients have the right python libraries, you can run the server program <code class="highlighter-rouge">python server_primes.py</code>, to automatically make the directories and transfer the client program and run the client program.</p> <p>The server sends a SSH command to run a command on the client computer. Do not send anything private to the client, because it is run as a command and might be saved in the client history. The client then runs the program and sends back the output as a JSON which I believe is secured through SSH.</p> <h3 id="tor">Tor</h3> <p>I included the ability to add in Tor connections. The client script uses the first argument as a Tor flag. To use Tor you need to install tor <code class="highlighter-rouge">apt-get install tor</code> as well as <a href="https://github.com/Anorov/PySocks">PySocks</a> <code class="highlighter-rouge">pip install PySocks</code> on the client computers.</p> <p>Since Tor needs to run as a super user, you can create store your password on your client. Since its never a good idea to store the plaintext password, I suggest using base64. I.e. Type your password into <code class="highlighter-rouge">~/pass</code> and then</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">base64 ~/pass &gt; ~/pass2
mv ~/pass2 ~/pass</code></pre></figure> <p>The program is then set to use this password for running the Tor connections.</p> <p>Have fun!</p> </article> </div></body></html>