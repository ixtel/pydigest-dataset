<html><body><div><div class="entry-content" itemprop="mainContentOfPage">
<p>Scrapy is a cool Python project that makes it easy to write web scraping bots that extract structured information from normal web pages. You can use it to create an API for a site that doesn’t have one, perform periodic data exports, etc. In this article, we’re going to make a scraper that retrieves the newest articles on <a href="https://news.ycombinator.com" target="_blank">Hacker News</a>. The site already has an API, and there is even a <a href="https://github.com/AnirudhBhat/HackerNewsAPI" target="_blank">wrapper</a> for it, but the goal of this post is to show you how to get the data by scraping it.</p>
<p>Once we have gotten the links and the article titles, we will extract the article itself using <a href="https://pypi.python.org/pypi/goose-extractor/1.0.2" target="_blank">Goose</a>, then do sentiment analysis on the article to figure out if it’s positive or negative in tone. For this last piece, we’ll make use of the awesome <a href="http://textblob.readthedocs.org/en/latest/" target="_blank">TextBlob</a> library.</p>
<h4>A note about screen scraping</h4>
<p>The owners of some sites do not want you to crawl their data and use it for your own purposes. You should respect their wishes. Many sites put information about whether or not they are open to being crawled in robots.txt. Hacker News’ robot.txt indicates that they are open to all crawlers, but that crawlers should wait at least 30 seconds between requests. That’s what we will do.</p>
<h4>Installing dependencies</h4>
<p>We will use pip to install all the libraries that we need.</p> 
<div id="crayon-56d590566d11a716520873" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d11a716520873-1"><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-e">Scrapy</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d11a716520873-2"><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">goose</span><span class="crayon-o">-</span><span class="crayon-e">extractor</span></p><p class="crayon-line" id="crayon-56d590566d11a716520873-3"><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">textblob</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p/>
<h4>Generating a Scrapy project</h4>
<p>Scrapy comes with a command line tool that makes it easy to generate project scaffolding. To generate the initial layout and files for our Hacker News project, go to the directory where you want to store the project and type this command:</p> 
<div id="crayon-56d590566d136759327891" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d136759327891-1"><span class="crayon-e">scrapy </span><span class="crayon-e">startproject </span><span class="crayon-v">hackernews_scrapy</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>Let’s use the
<span id="crayon-56d590566d144844014957" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">tree</span></span></span>  command to see what has been generated:</p> 
<div id="crayon-56d590566d150378346962" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d150378346962-1"><span class="crayon-sy">.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d150378346962-2">└──<span class="crayon-h"> </span><span class="crayon-v">hackernews</span><span class="crayon-sy">_</span>scrapy</p><p class="crayon-line" id="crayon-56d590566d150378346962-3"><span class="crayon-h">    </span>├──<span class="crayon-h"> </span><span class="crayon-v">hackernews</span><span class="crayon-sy">_</span>scrapy</p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d150378346962-4"><span class="crayon-h">    </span>│  <span class="crayon-h"> </span>├──<span class="crayon-h"> </span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line" id="crayon-56d590566d150378346962-5"><span class="crayon-h">    </span>│  <span class="crayon-h"> </span>├──<span class="crayon-h"> </span><span class="crayon-v">items</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d150378346962-6"><span class="crayon-h">    </span>│  <span class="crayon-h"> </span>├──<span class="crayon-h"> </span><span class="crayon-v">pipelines</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line" id="crayon-56d590566d150378346962-7"><span class="crayon-h">    </span>│  <span class="crayon-h"> </span>├──<span class="crayon-h"> </span><span class="crayon-v">settings</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d150378346962-8"><span class="crayon-h">    </span>│  <span class="crayon-h"> </span>└──<span class="crayon-h"> </span><span class="crayon-i">spiders</span></p><p class="crayon-line" id="crayon-56d590566d150378346962-9"><span class="crayon-h">    </span>│  <span class="crayon-h">     </span>└──<span class="crayon-h"> </span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d150378346962-10"><span class="crayon-h">    </span>└──<span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">cfg</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>The best way to get to grips with the project structure is to dive right in and add code to these files, so we’ll go ahead and do that.</p>
<h4>Creating a Hacker News item</h4>
<p>In Scrapy, the output of a crawl is a set of items which have been scraped from a website, processed by a pipeline and output into a certain format. The starting point of any Scrapy project is defining what the items are supposed to look like. We’ll make a new item called
<span id="crayon-56d590566d15d968962307" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">HackerNewsItem</span></span></span>  that represents a post on Hacker News with some associated data.</p>
<p>Open
<span id="crayon-56d590566d169888540621" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">items</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  and change it to this:</p> 
<div id="crayon-56d590566d174210589410" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d174210589410-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">scrapy</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d174210589410-2"> </p><p class="crayon-line" id="crayon-56d590566d174210589410-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d174210589410-4"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">HackerNewsItem</span><span class="crayon-sy">(</span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">Item</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d174210589410-5"><span class="crayon-h">    </span><span class="crayon-v">link_title</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-e">Field</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d174210589410-6"><span class="crayon-h">    </span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-e">Field</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590566d174210589410-7"><span class="crayon-h">    </span><span class="crayon-v">sentiment</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-e">Field</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d174210589410-8"><span class="crayon-h">    </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-e">Field</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>Each Scrapy item is a class that inherits from
<span id="crayon-56d590566d180861507003" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">Item</span></span></span> . Each field on the item is an instance of
<span id="crayon-56d590566d18c403809708" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">Field</span></span></span> .
<span id="crayon-56d590566d198197664815" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">HackerNewsItem</span></span></span>  has four fields:</p>
<ul>
<li>
<span id="crayon-56d590566d1a3940338203" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">link_title</span></span></span>  is the title of the post on HackerNews</li>
<li>
<span id="crayon-56d590566d1ae910325886" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">url</span></span></span>  is the URL pointed to by the post</li>
<li>
<span id="crayon-56d590566d1ba456948100" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">sentiment</span></span></span>  is a sentiment polarity score from -1.0 to 1.0.</li>
<li>
<span id="crayon-56d590566d1c6107119286" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">text</span></span></span>  is the text of the article extracted from the page pointed to by the URL</li>
</ul>
<p>Scrapy is smart enough that we do not have to manually specify the types of these fields, as we have to do in a Django model, for instance.</p>
<h4>Making a spider</h4>
<p>The next step is to define a spider that starts crawling HackerNews from the front page and follows the “More” links at the bottom of the page down to a given depth.</p>
<p>In the
<span id="crayon-56d590566d1d2340158077" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">spiders</span></span></span>  subdirectory of your project, make a file called
<span id="crayon-56d590566d1dd728254630" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">hackernews_spider</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  and change its contents to this:</p> 
<div id="crayon-56d590566d1e9179261288" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-2">2</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-4">4</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-6">6</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-8">8</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-10">10</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-12">12</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-14">14</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-16">16</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-18">18</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-20">20</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-22">22</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-24">24</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590566d1e9179261288-26">26</p><p class="crayon-num" data-line="crayon-56d590566d1e9179261288-27">27</p></div>
</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d1e9179261288-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">contrib</span><span class="crayon-sy">.</span><span class="crayon-e">spiders </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">CrawlSpider</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Rule</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">contrib</span><span class="crayon-sy">.</span><span class="crayon-e">linkextractors </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">LinkExtractor</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">hackernews_scrapy</span><span class="crayon-sy">.</span><span class="crayon-e">items </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">HackerNewsItem</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-4"> </p><p class="crayon-line" id="crayon-56d590566d1e9179261288-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-6"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">HackerNewsSpider</span><span class="crayon-sy">(</span><span class="crayon-v">CrawlSpider</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-7"><span class="crayon-h">    </span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"hackernews"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-8"><span class="crayon-h">    </span><span class="crayon-v">allowed_domains</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">"ycombinator.com"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-9"><span class="crayon-h">    </span><span class="crayon-v">start_urls</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-10"><span class="crayon-h">        </span><span class="crayon-s">"https://news.ycombinator.com/"</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-11"><span class="crayon-h">    </span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-12"> </p><p class="crayon-line" id="crayon-56d590566d1e9179261288-13"><span class="crayon-h">    </span><span class="crayon-v">rules</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-14"><span class="crayon-h">        </span><span class="crayon-e">Rule</span><span class="crayon-sy">(</span><span class="crayon-e">LinkExtractor</span><span class="crayon-sy">(</span><span class="crayon-v">allow</span><span class="crayon-o">=</span><span class="crayon-s">"news.ycombinator.com/newest"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-o">=</span><span class="crayon-s">"parse_item"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">follow</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-15"><span class="crayon-h">    </span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-16"> </p><p class="crayon-line" id="crayon-56d590566d1e9179261288-17"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">parse_item</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-18"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">"Scraping: "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-20"><span class="crayon-h">        </span><span class="crayon-v">articles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">xpath</span><span class="crayon-sy">(</span><span class="crayon-s">'//tr[@class="athing"]'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-21"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-22"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">article </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">articles</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d1e9179261288-23"><span class="crayon-h">            </span><span class="crayon-v">item</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">HackerNewsItem</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-24"><span class="crayon-h">            </span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"link_title"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">article</span><span class="crayon-sy">.</span><span class="crayon-e">xpath</span><span class="crayon-sy">(</span><span class="crayon-s">'td[@class="title"]/a/text()'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">extract</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d1e9179261288-26"> </p><p class="crayon-line" id="crayon-56d590566d1e9179261288-27"><span class="crayon-h">            </span><span class="crayon-r">yield</span><span class="crayon-h"> </span><span class="crayon-v">item</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>Our spider inherits from
<span id="crayon-56d590566d1f8760945311" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">contrib</span><span class="crayon-sy">.</span><span class="crayon-v">spiders</span><span class="crayon-sy">.</span><span class="crayon-v">CrawlSpider</span></span></span> . This type of spider follows links extracted from previously crawled pages in the same manner as a normal web crawler. As you can see, we have defined several attributes at the top of the class.</p> 

 
<p>This specifies the name used for the crawler when using the command line tool to start a crawl. To start a crawl with our crawler now, you can type:</p> 

 
<p>The
<span id="crayon-56d590566d21b836220231" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">allowed_domains</span></span></span>  list holds domains that the crawler will pay attention to. Any links to domains that are not in this list will be ignored.</p>
<p>
<span id="crayon-56d590566d226010160733" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">start_urls</span></span></span>  is a list of URLs to start the crawl at. In our case, only one is necessary: the Hacker News homepage.</p>
<p>The real meat of the implementation is in the
<span id="crayon-56d590566d232924276523" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">rules</span></span></span>  variable and the
<span id="crayon-56d590566d23e605982581" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">parse_item</span></span></span>  method.
<span id="crayon-56d590566d257401807072" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">rules</span></span></span>  is an iterable that contains
<span id="crayon-56d590566d264690130232" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-v">contrib</span><span class="crayon-sy">.</span><span class="crayon-v">spiders</span><span class="crayon-sy">.</span><span class="crayon-v">Rule</span></span></span>  instances. We only have one rule, which indicates that our spider should follow links that match the
<span id="crayon-56d590566d270454126159" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-s">"news.ycombinator.com/newest"</span></span></span>  regex and pass the pages behind those links to the handler defined by the
<span id="crayon-56d590566d27c787592016" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">parse_item</span></span></span>  method.
<span id="crayon-56d590566d288500665091" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">follow</span><span class="crayon-o">=</span><span class="crayon-t">True</span></span></span>  tells the spider that it should recursively follow links found in those pages.</p>
<p>
<span id="crayon-56d590566d294678920285" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">parse_item</span></span></span>  uses <a href="http://www.w3.org/TR/xpath/" target="_blank">XPath</a> to grab a list of the articles on the page. Each article is in a table row element with a class of “athing”. We can grab a sequence of each matching element as follows:</p> 
<div id="crayon-56d590566d29f436833345" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d29f436833345-1"><span class="crayon-v">articles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">xpath</span><span class="crayon-sy">(</span><span class="crayon-s">'//tr[@class="athing"]'</span><span class="crayon-sy">)</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>Then, we iterate over that sequence and, for each article, we grab the title and the URL. For now, we’re not going to fill in the article text or the sentiment. These will be filled in as part of our item processing pipeline.</p>
<p>What we have so far is a complete spider. If you’ve been paying attention, you might realize that it will just keep following the “More” links at the bottom of the page until it runs out of pages. We definitely don’t want that. We only want to scrape the top few pages. Let’s sort that out. Open
<span id="crayon-56d590566d2ac743028338" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">settings</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  and add a line that says:</p> 

 
<p>With the depth limit set to 10, we will only crawl the first ten pages. While you’re in there, you can also specify a download delay so that our spider respects Hacker News’ robots.txt.</p> 

 
<p>Now you can run the spider and output the scraped items into a JSON file like so:</p> 
<div id="crayon-56d590566d2ce575982876" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d2ce575982876-1"><span class="crayon-e">scrapy </span><span class="crayon-e">crawl </span><span class="crayon-v">hackernews</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">o</span><span class="crayon-h"> </span><span class="crayon-v">hackernews</span><span class="crayon-sy">.</span><span class="crayon-v">json</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-v">json</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p/>
<h4 class="p1">The item pipeline</h4>
<p class="p1">So far, we’re not extracting the text of any articles and we are not doing any sentiment analysis. First though, let’s add a filter to the item pipeline so that “self posts” – posts that are just somebody asking a question instead of linking to something –  are filtered out.</p>
<p class="p1">Open
<span id="crayon-56d590566d2da903540559" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pipelines</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  and add this code:</p>
<p/> 
<div id="crayon-56d590566d2e6467765801" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d2e6467765801-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">re</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d2e6467765801-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">scrapy</span><span class="crayon-sy">.</span><span class="crayon-k ">exceptions</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">DropItem</span></p><p class="crayon-line" id="crayon-56d590566d2e6467765801-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d2e6467765801-4"> </p><p class="crayon-line" id="crayon-56d590566d2e6467765801-5"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">DropSelfPostsPipeline</span><span class="crayon-sy">(</span><span class="crayon-k ">object</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d2e6467765801-6"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">process_item</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">spider</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d2e6467765801-7"><span class="crayon-h">        </span><span class="crayon-v">match</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-e">match</span><span class="crayon-sy">(</span><span class="crayon-s">"item\?id=[0-9]+"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"url"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d2e6467765801-8"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">match</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d2e6467765801-9"><span class="crayon-h">            </span><span class="crayon-st">raise</span><span class="crayon-h"> </span><span class="crayon-e">DropItem</span><span class="crayon-sy">(</span><span class="crayon-s">"Excluded self-post: "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"url"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d2e6467765801-10"> </p><p class="crayon-line" id="crayon-56d590566d2e6467765801-11"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">item</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>Scrapy pipeline objects must implement a
<span id="crayon-56d590566d2f2909164535" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">process_item</span></span></span>  method and return the item or raise an exception. Links on Hacker News that point to self posts match the regex
<span id="crayon-56d590566d2fe119465873" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-s">"item\?id=[0-9]+"</span></span></span> . If the URL of the item matches the the regex, we raise a
<span id="crayon-56d590566d309851925803" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">DropItem</span></span></span>  exception. That, obviously enough, causes the item to be dropped from the eventual output of the spider.</p>
<p>Components are not registered with the item pipeline until you add them to the
<span id="crayon-56d590566d315707001923" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ITEM_PIPELINES</span></span></span>  list in the project’s
<span id="crayon-56d590566d32a453945903" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">settings</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> . Add this code to register the
<span id="crayon-56d590566d337614105142" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">DropSelfPostsPipeline</span></span></span>  component.</p> 
<div id="crayon-56d590566d343228113549" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d343228113549-1"><span class="crayon-v">ITEM_PIPELINES</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d343228113549-2"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-s">'hackernews_scrapy.pipelines.DropSelfPostsPipeline'</span></p><p class="crayon-line" id="crayon-56d590566d343228113549-3"><span class="crayon-sy">]</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p/>
<h4>Extracting articles with Goose</h4>
<p>Goose is a library that allows you to extract the main article text from any web page. It is not perfect, but it is the best solution currently available in Python. Here is an example of the basic usage:</p> 
<div id="crayon-56d590566d34f325941046" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d34f325941046-1"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">goose </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Goose</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d34f325941046-2"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Goose</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590566d34f325941046-3"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">article</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">g</span><span class="crayon-sy">.</span><span class="crayon-e">extract</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-s">"http://www.irishtimes.com/news/politics/same-sex-marriage-on-course-to-be-approved-by-ireland-1.2223646"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d34f325941046-4"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">article</span><span class="crayon-sy">.</span><span class="crayon-v">cleaned_text</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">100</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d590566d34f325941046-5"><span class="crayon-i">u</span><span class="crayon-s">'(From left) Anne-Marie Meenagh, Hannah Byrne and Emma Banks join supporters gather in the court yard'</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>We can add a new pipeline component to extract the article text from the scraped link and save it in the
<span id="crayon-56d590566d35c446820484" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">text</span></span></span>  field in the item. Open
<span id="crayon-56d590566d37e513568257" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pipelines</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  again and add this code:</p> 
<div id="crayon-56d590566d38a604128181" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d38a604128181-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">goose </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Goose</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d38a604128181-2"> </p><p class="crayon-line" id="crayon-56d590566d38a604128181-3"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ExtractArticlePipeline</span><span class="crayon-sy">(</span><span class="crayon-k ">object</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d38a604128181-4"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d38a604128181-5"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">goose</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Goose</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d38a604128181-6"> </p><p class="crayon-line" id="crayon-56d590566d38a604128181-7"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">process_item</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">spider</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d38a604128181-8"><span class="crayon-h">        </span><span class="crayon-st">try</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d38a604128181-9"><span class="crayon-h">            </span><span class="crayon-v">article</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">goose</span><span class="crayon-sy">.</span><span class="crayon-e">extract</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-o">=</span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"url"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d38a604128181-10"><span class="crayon-h">            </span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"text"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">article</span><span class="crayon-sy">.</span><span class="crayon-e">cleaned_text</span></p><p class="crayon-line" id="crayon-56d590566d38a604128181-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d38a604128181-12"><span class="crayon-e">        </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-k ">IndexError</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d38a604128181-13"><span class="crayon-h">            </span><span class="crayon-st">raise</span><span class="crayon-h"> </span><span class="crayon-e">DropItem</span><span class="crayon-sy">(</span><span class="crayon-s">"Failed to extract article text from: "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"url"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d38a604128181-14"> </p><p class="crayon-line" id="crayon-56d590566d38a604128181-15"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">item</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>The code here is pretty much the same as the minimal example, except we have wrapped the
<span id="crayon-56d590566d397275359254" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">goose</span><span class="crayon-sy">.</span><span class="crayon-v">extract</span></span></span>  call in a try-except block. There is a bug in the Goose library that can cause it to throw an
<span id="crayon-56d590566d3a3494044949" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-k ">IndexError</span></span></span>  when parsing the titles of certain web pages. There is an open pull request on the Github repository that fixes this, but it hasn’t been merged yet. We’ll just work around it for the moment.</p>
<p>Add this component to the item pipeline by changing the
<span id="crayon-56d590566d3af040836883" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ITEM_PIPELINES</span></span></span>  list in
<span id="crayon-56d590566d3bb849720917" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">settings</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> .</p> 
<div id="crayon-56d590566d3c6947529791" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d3c6947529791-1"><span class="crayon-v">ITEM_PIPELINES</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d3c6947529791-2"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-s">'hackernews_scrapy.pipelines.DropSelfPostsPipeline'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d590566d3c6947529791-3"><span class="crayon-h">    </span><span class="crayon-s">'hackernews_scrapy.pipelines.ExtractArticlePipeline'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d3c6947529791-4"><span class="crayon-sy">]</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p/>
<h4>Analyzing sentiment with TextBlob</h4>
<p>TextBlob is a library that makes it easy to do standard natural language processing tasks in Python. Check out this sentiment analysis example to see just how easy it is:</p> 
<div id="crayon-56d590566d3d3291873271" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d3d3291873271-1"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">textblob </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">TextBlob</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d3d3291873271-2"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TextBlob</span><span class="crayon-sy">(</span><span class="crayon-s">"This is awesome!!!"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590566d3d3291873271-3"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-v">sentiment</span><span class="crayon-sy">.</span><span class="crayon-i">polarity</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d3d3291873271-4"><span class="crayon-cn">1.0</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>Let’s add another item pipeline component to fill in the
<span id="crayon-56d590566d3df255800642" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">sentiment</span></span></span> field on our items:</p> 
<div id="crayon-56d590566d3ea955627673" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d3ea955627673-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">textblob </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TextBlob</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d3ea955627673-2"> </p><p class="crayon-line" id="crayon-56d590566d3ea955627673-3"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">SentimentPipeline</span><span class="crayon-sy">(</span><span class="crayon-k ">object</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d3ea955627673-4"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">process_item</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">spider</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590566d3ea955627673-5"><span class="crayon-h">        </span><span class="crayon-v">blob</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TextBlob</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"text"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d3ea955627673-6"><span class="crayon-h">        </span><span class="crayon-v">item</span><span class="crayon-sy">[</span><span class="crayon-s">"sentiment"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">blob</span><span class="crayon-sy">.</span><span class="crayon-v">sentiment</span><span class="crayon-sy">.</span><span class="crayon-e">polarity</span></p><p class="crayon-line" id="crayon-56d590566d3ea955627673-7"><span class="crayon-e">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">item</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>As before, we must add the
<span id="crayon-56d590566d3f7655050652" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">SentimentPipeline</span></span></span>  component to the
<span id="crayon-56d590566d402649827619" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ITEM_PIPELINES</span></span></span>  list, which now looks like this:</p> 
<div id="crayon-56d590566d40e053361720" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d40e053361720-1"><span class="crayon-v">ITEM_PIPELINES</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d40e053361720-2"><span class="crayon-h">    </span><span class="crayon-s">'hackernews_scrapy.pipelines.DropSelfPostsPipeline'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d590566d40e053361720-3"><span class="crayon-h">    </span><span class="crayon-s">'hackernews_scrapy.pipelines.ExtractArticlePipeline'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590566d40e053361720-4"><span class="crayon-h">    </span><span class="crayon-s">'hackernews_scrapy.pipelines.SentimentPipeline'</span></p><p class="crayon-line" id="crayon-56d590566d40e053361720-5"><span class="crayon-sy">]</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>Now the crawler is complete. Run it using the same command we used before. When it is finished, you will have a file of Hacker News articles, annotated with the sentiment.</p> 
<div id="crayon-56d590566d41b278502055" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590566d41b278502055-1"><span class="crayon-e">scrapy </span><span class="crayon-e">crawl </span><span class="crayon-v">hackernews</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">o</span><span class="crayon-h"> </span><span class="crayon-v">hackernews</span><span class="crayon-sy">.</span><span class="crayon-v">json</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-v">json</span></p></div></td>
</tr>
</table>
</div>
</div>
 
<p>There is much more to Scrapy than we have looked at in this article. One of its most interesting features is the ability to integrate with Django by directly populating Django models with scraped data. There are also lots of options for outputting data and managing how the spider behaves, such as scraping using Firefox (for Javascript-heavy sites) and exporting with FTP and Amazon S3. Check out the <a href="http://doc.scrapy.org/en/latest/index.html" target="_blank">Scrapy docs</a> for more.</p>
 <div class="ck_form ck_vertical_subscription_form"> <div class="ck_form_content"> <h3 class="ck_form_title">Mastering Decorators</h3> <div class="ck_description"> <span class="ck_image"> <img alt="Mastering_decorators_cover" src="//s3.amazonaws.com/convertkit/subscription_forms/images/004/814/305/standard/mastering_decorators_cover.jpg?1435694020"/> </span> <p>Enjoyed this article? Join the newsletter and get <strong>Mastering Decorators</strong> - a gentle 22-page introduction to one of the trickiest parts of Python.</p> </div> </div> <div class="ck_form_fields"> <div id="ck_success_msg"> <p>Thanks! Now check your email.</p> </div>    </div> </div>    </div>
 
</div></body></html>