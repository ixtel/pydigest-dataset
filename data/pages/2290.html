<html><body><div><article class="entry">
<h1>Loading Django FileField and ImageFields from the file system</h1>
    <p class="byline">by Frank Wiles on Dec 3, 2014</p>
    <p>I don’t know about you, but I run into a situation every so often where I need to programmatically push a file from the local file system or remotely via a URL into a Django model. Using a Python shell, a one off script, or a Django management command.</p>

<p>This should be easy, but with a typical web app you do it infrequently. Mostly I find we do it when we’re converting someone’s site from something else to Django and need to associate an image with another Content item for example. </p>

<p>If you start Googling around for answers to how to do this you get the default docs for <a href="https://docs.djangoproject.com/en/dev/topics/http/file-uploads/">File Uploads</a>, <a href="https://docs.djangoproject.com/en/dev/ref/files/file/">File objects</a>, and <a href="https://docs.djangoproject.com/en/dev/topics/files/">Managing Files</a> which are all great. However, they don’t <em>exactly</em> spell out how you’re supposed to do this. </p>

<p>My first inclination is to just assign the model field to a file, but this is missing the relative file path information Django needs. </p>

<p>I took the time to write this post mostly for my own benefit so I don’t have to figure this out yet again in the future, but hopefully you’ll get some use out of it as well. </p>

<h2>Steps for loading Django ImageField with a local file</h2>

<p>Here is a quick example showing you the moving pieces. The steps you need to perform are: </p>

<ol>
<li>Retrieve the file (if remote) and store it locally</li>
<li>Open that file as a normal Python file object</li>
<li>Covert that open file to a Django <a href="https://docs.djangoproject.com/en/dev/ref/files/file/">File</a></li>
<li>Attach it to your model field</li>
</ol>

<h2>Example Model</h2>

<p>Suppose we have a model like this:</p>

<pre><code class="language-python">from django.db import models

class Company(models.Model):
    name = models.CharField(max_length=100)
    logo = models.ImageField()
</code></pre>

<p>Let’s create an entry for RevSys, pulling the logo in with requests: </p>

<pre><code class="language-python">import requests
from django.core.files import File

from .models import Company

r = requests.get(“http://media.revsys.com/img/revsys-logo.png”)

with open(“/tmp/revsys-logo.png”, “wb”) as f:
    f.write(r.content)

reopen = open(“/tmp/revsys-logo.png”, “rb”)
django_file = File(reopen)

revsys = Company()
revsys.name = “Revolution Systems”
revsys.logo.save(“revsys-logo.png”, django_file, save=True)
</code></pre>

<p>The last line here is the important bit. <code>save</code> is given three arguments here:</p>

<ol>
<li>The relative path and filename for inside MEDIA_ROOT</li>
<li>The open file using Django’s File object</li>
<li>Whether or not we want to save the revsys <code>Company</code> instance after the image is saved.</li>
</ol>

<p>Now if you’re doing this for a bunch of images, you’ll want to parse your URLs or filenames to build the paths for you. Something like this would be a good starting point, note this is using Python 3:</p>

<pre><code class="language-python">import os
from urllib.parse import urlparse
# from urlparse import urlparse for Python 2.7

url = “http://media.revsys.com/img/revsys-logo.png”
filename = os.path.basename(urlparse(url).path)
# This returns ‘revsys-logo.png’ from the URL
…

revsys.logo.save(filename, django_file, save=True)
</code></pre>

<p>Hope this helps! </p>

    
    
    
        <p><strong>Tags:</strong> <small>
            
            <a href="/blog/tags/django/">django</a>,
            
            <a href="/blog/tags/programming/">programming</a>
            
        </small></p>
    
</article>





    
    


            </div></body></html>