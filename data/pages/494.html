<html><body><div><div class="grid_12">

<p/><p>В одном проекте я использовал redis для хранения статистики, собираемой из нескольких процессов python на одной машине. Статистика складывалась в redis в hash или словарь. Попробовал заменить место хранения на словарь в питоне и вот, что из этого вышло:</p>
<pre>from multiprocessing import Pool, Manager, Lock

lock = Lock()
manager = Manager()
stats_dict = manager.dict()
</pre>
<p>Проще не получилось, так как в разделяемой памяти (Shared Memory) нету такого класса, как словарь в multiprocessing модуле. Код, демонстрирующий использование:</p>
<pre>def save_stats(x):
    lock.acquire()
    if not stats_dict.has_key('test'):
        stats_dict['test'] = 0
    for i in range(100):
        stats_dict['test'] += 1
    lock.release()

if __name__ == "__main__":
    pool = Pool(processes=4)
    pool.map(save_stats, [1, 2, 4, 5])

    print stats_dict
</pre>
<p>Как видим одновременно запускаются четыре процесса, выполняющие процедуру save_stats. После окончания, в поле 'test' окажется 400. Никаких race conditions. Вот думаю теперь насколько это лучше просто redis. Выглядит примерно одинаково по эффективности.</p>











</div>
</div></body></html>