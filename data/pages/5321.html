<html><body><div><div class="content html_format"><p>
      Всем привет! </p><p>
Сегодня я хочу поделится нашим опытом автоматизации тестирования веб-приложения с использованием Selenium WebDriver и фреймворка Behave.</p><p>
Если интересно добро пожаловать под кат.
</p><a name="habracut"/>
<h2>Перед началом</h2><p>
 Тут я не буду подробно останавливаться на том, как искать элементы, и как взаимодействовать с ними при помощи selenium webdriver, а расскажу только о том, как можно легко и удобно писать и гонять тесты написанные на python с использованием behave.

</p><h2>1. Установка нужностей</h2><p>
Для начала нам понадобится python. Скачать его можно </p><a href="https://www.python.org/downloads/">тут</a><p>. Я буду использовать версию 2.7.6, а вы можете использовать ту, которая вам больше нравится. Кроме python нам еще понадобятся selenium и сам behave. </p><p>
Установить selenium можно с использованием </p><a href="https://pypi.python.org/pypi/pip/7.1.0">pip</a><p>:
</p><code>pip install selenium<br/>
</code>

<p>
Теперь установим behave. Можно с использованием pip: 
</p><code>pip install behave<br/>
</code><p>
А можно скачать тут: </p><a href="https://pypi.python.org/pypi/behave">behave на pypi</a><p>
Что такое behave? Behave — это фрейморк для программирования через поведения в python-стиле(</p><a href="http://habrahabr.ru/post/216923/">Что такое Behavior-driven development?</a><p>).</p><p>
Behave использует тесты написанные на натуральном языке, с логикой на python. </p><p>
Он обладает несколькими серьезными плюсами:
</p><p>
+ Легкая установка</p><p>
+ Отчеты в формате junit</p><p>
+ Тесты может писать любой человек на естественном языке.</p><p>
+ Есть возможность интеграции с jenkins (с другими CI, наверное, тоже)

</p><a href="http://pythonhosted.org/behave/comparison.html">Сравнение behave с похожими инструментами.</a><p>
Когда все необходимое установлено можно приступать к настройке окружения для написания и выполнения тестов.

</p><h2>2. Настройка</h2><p>
Директория откуда будем запускать тесты должна содержать: </p><p>
1. Файлы с расширением .feature — сами тесты.</p><p>
2. Директорию steps, которая содержит файлы .py с описанием шагов, из которых составляются тесты, на python.
</p><p>
Опционально можно добавить в директорию содержащую папку steps файл — environment.py c кодом который надо будет выполнять прежде или после определенных событий в тесте. </p><p>
Подробное описание этого файла </p><a href="http://pythonhosted.org/behave/tutorial.html#environmental-controls">тут</a><p>.</p><p>
Наш пример будет максимально простым, поэтому мы не будем включать этот файл.
</p><p>
Итого, как выглядит наша директория в минимальной комплектации: 
</p><p>
features/ </p><p>
features/everything.feature</p><p>
features/steps/</p><p>
features/steps/steps.py

</p><a href="http://pythonhosted.org/behave/tutorial.html">пример из behave tutorial</a><p>
Вот и вся настройка, можно писать первый тест!

</p><h2>3. Написание и запуск первого теста</h2><p>
Для начала нам понадобится создать в папке steps, файл c расширением .py, в котором мы опишем логику нашего теста.</p><p>
Назовем этот файл first_test.py.</p><p>
Для примера, я решил взять простой кейс тестирования поисковой формы ya.ru.
</p><p>
Итак, скопируйте код ниже в файл firs_test.py.
</p><pre><code class="python"># -*- coding: utf-8 -*-
from behave import *
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

#Откроем главную страницу. Передадим в качестве аргумента адрес страницы.
@given('website "{url}"')
def step(context, url):
#Измените строку, для выполнения теста в другом браузере
    context.browser = webdriver.Firefox()
    context.browser.maximize_window()
    context.browser.get("http://ya.ru")

#Теперь нажмем на кнопку "Найти"
@then("push button with text '{text}'")
def step(context, text):
    WebDriverWait(context.browser, 120).until(
        EC.element_to_be_clickable((By.XPATH, '//button'))
    )
    context.browser.find_element_by_xpath('//button').click()

#Проверим, что мы на странице с результатами поиска, есть некоторый искомый текст
@then("page include text '{text}'")
def step(context, text):
    WebDriverWait(context.browser, 120).until(
        EC.presence_of_element_located((By.XPATH, '//*[contains(text(), "%s")]' % text))
    )
    assert context.browser.find_element_by_xpath('//*[contains(text(), "%s")]' % text)
    context.browser.quit()
</code></pre>
<p>
Если лень смотреть код, то логика такая:</p><p>
1. Открыть ya.ru</p><p>
2. Клацнуть на кнопку «Найти»</p><p>
3. Проверить, что на странице выдачи есть текст: «Задан пустой поисковый запрос»
</p><p>
Теперь когда готова логика теста можно написать сам тест.</p><p>
В папке с директорией steps создадим файл .feature, в котором используем написанные шаги: 

</p><pre><code class="html">#Укажем что это за фича
Feature: Checking search
#Укажем имя сценария (в одной фиче может быть несколько)
Scenario: Сheck some text in search results
#И используем наши шаги.
  Given website "ya.ru"
  Then push button with text 'Найти'
  Then page include text 'Задан пустой поисковый запрос'
</code></pre>
<p>
Шаги из теста, по декораторам свяжутся с python функциями. (Декораторы обозначены знаком @)
</p><p>
Теперь запустим наш тест.</p><p>
Перейдем в папку, где он лежит, и выполним команду: 
</p><pre><code class="html">behave -i first_test.feature
</code></pre><p>
Флаг -i указывает, что необходимо запустить только файлы подходящие под паттерн поиска.</p><p>
Если запустить c флагом --junit то получим отчет в формате junit.
</p><p>
Если все прошло хорошо, то отчет будет, примерно, таким:

</p><pre><code class="html">
Feature: Checking search # first_test.feature:1

  Scenario: Send some text in search box and check some text in search results  # ya.feature:2
    Given website "ya.ru"                                                       # steps/test.py:9 0.662s
    Then push button with text 'Найти'                                          # steps/test.py:14 0.242s
    Then page include text 'Задан пустой поисковый запрос'                      # steps/test.py:22 1.009s

1 feature passed, 0 failed, 0 skipped
1 scenario passed, 0 failed, 0 skipped
3 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m1.913s

</code></pre>

<h2>Заключение</h2><p>
Здесь я привел только самое основное.</p><p>
Фичи selenium неисчислимы, да и behave много чего умеет. В том числе, отчеты в формате junit и интеграцию с jenkis.</p><p>
Спасибо за внимание, и хороших выходных!

</p><h3>Список использованных материалов</h3><p>
Селениум: 
</p><a href="http://habrahabr.ru/post/152653/">habrahabr.ru/post/152653</a>
<a href="http://habrahabr.ru/post/248559/">habrahabr.ru/post/248559</a>
<a href="http://www.seleniumhq.org/docs/">www.seleniumhq.org/docs</a>
<a href="http://selenium2.ru/docs.html">selenium2.ru/docs.html</a>
<a href="http://selenium-python.readthedocs.org/index.html">selenium-python.readthedocs.org/index.html</a>
<a href="http://selenium.googlecode.com/svn/trunk/docs/api/py/index.html">selenium.googlecode.com/svn/trunk/docs/api/py/index.html</a>
<p>
Behave: 
</p><a href="http://pythonhosted.org/behave/">pythonhosted.org/behave</a>
<p>
Python:
</p><a href="https://pypi.python.org">pypi.python.org</a>
<a href="https://python.org">python.org</a>
<p>
UPD: Если что-то в статье не очень хорошо написано, или чего-то не хватает, то можно высказаться в комментариях, или написать в личку мне, и мы вместе улучшим ее.

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>