<html><body><div><div class="post-body entry-content" id="post-body-3209642599766792388" itemprop="description articleBody">
<p>
<span>The more I jump into Python the more I like it. This tutorial is about one of the more basic parts of Python - connecting it to a MySQL database.</span></p>
<p>
<span>The reason I chose MySQL is purely because of ubiquity, I figure this will be the one people will be connecting to the most if they’re using Python especially in a web environment.</span></p>
<p>
</p>
<h3>
<span>
Get The Database Setup</span></h3>
<p>
<span>If you’re following this excersize exactly, you’ll want to create a table on your MySQL database that holds names. This is just a simple dumb table for this excersize.</span></p>

<figure class="code"><figcaption><span>SQL to create the table for this tutorial.</span></figcaption><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</span></pre>
</td><td class="code"><pre><code class="sql"><span class="line"><span class="k">CREATE</span>  <span class="k">TABLE</span> <span class="o">`</span><span class="n">test</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="p">(</span>
</span><span class="line">  <span class="o">`</span><span class="n">nameid</span><span class="o">`</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="p">,</span>
</span><span class="line">  <span class="o">`</span><span class="n">firstname</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span> <span class="k">NULL</span> <span class="p">,</span>
</span><span class="line">  <span class="o">`</span><span class="n">lastname</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span> <span class="k">NULL</span> <span class="p">,</span>
</span><span class="line">  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">nameid</span><span class="o">`</span><span class="p">)</span>
</span><span class="line"><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">test</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">name</span><span class="o">`</span>
</span><span class="line"><span class="p">(</span><span class="o">`</span><span class="n">firstname</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">lastname</span><span class="o">`</span><span class="p">)</span>
</span><span class="line"><span class="k">VALUES</span>
</span><span class="line"><span class="p">(</span><span class="ss">"Cookie"</span><span class="p">,</span><span class="ss">"Monster"</span><span class="p">),</span>
</span><span class="line"><span class="p">(</span><span class="ss">"Guy"</span><span class="p">,</span><span class="ss">"Smiley"</span><span class="p">),</span>
</span><span class="line"><span class="p">(</span><span class="ss">"Big"</span><span class="p">,</span><span class="ss">"Bird"</span><span class="p">),</span>
</span><span class="line"><span class="p">(</span><span class="ss">"Oscar"</span><span class="p">,</span><span class="ss">"Grouch"</span><span class="p">),</span>
</span><span class="line"><span class="p">(</span><span class="ss">"Alastair"</span><span class="p">,</span><span class="ss">"Cookie"</span><span class="p">);</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>Now that you have your highly sophisticated database set up, let’s connect to it and start playing around.</span></p>
<h3>
<span>
Create Your Python Script</span></h3>
<p>
<span>The first step of course is to create your Python Script. Create a file called “datademo.py” (or whatever you want to call it).</span></p>

<figure class="code"><figcaption><span>Your Initial Python Script.</span></figcaption><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c">#!/usr/bin/python</span>
</span><span class="line"><span class="c"># filename: datademo.py </span>
</span><span class="line"><span class="c"># a simple script to pull some data from a MySQL table</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<h3>
<span>
Connect to the Database</span></h3>
<p>
<span>The first thing you’ll need do is import the MySQL modules with the following line:</span></p>

<figure class="code">
</figure>
<p>
<span>This assumes you have MySQLdb installed. If not, don’t worry it’s a quick install.</span></p>

<p>
<span>Now that you have that set up, let’s get connected:</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">"localhost"</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">"root"</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s">"test"</span><span class="p">)</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>With this string you can connect using your MySQL credentials. If you want you can store these credentials in variables elsewhere.</span></p>
<h3>
<span>
The Cursor</span></h3>
<p>
<span>Python uses a “cursor” when dealing with data. A cursor is a simple data structure that transverses the records in the database. Cursors perform CRUD ( Create Read Update Delete ) operations on the database.</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c">#create a cursor for the select</span>
</span><span class="line"><span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>This intializes the cursor so you can use the “cur “object wherever needed. So the next thing we need to do is come up with an SQL command.</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
</span></pre>
</td><td class="code"><pre><code class="sql"><span class="line"><span class="k">SELECT</span> <span class="n">firstname</span><span class="p">,</span><span class="n">lastname</span> <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>This of course selects a first and last name from our database. We want to stuff that SQL command into a parameter for the execute method of the cursor:</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c">#execute an sql query</span>
</span><span class="line"><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT firstname,lastname FROM test.name"</span><span class="p">)</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<h3>
<span>
Iteration and Display</span></h3>
<p>
<span>The next part of this is iterating through the database result and displaying it.</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c"># loop to iterate</span>
</span><span class="line"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span> <span class="p">:</span>
</span><span class="line">      <span class="c">#data from rows</span>
</span><span class="line">        <span class="n">firstname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span class="line">        <span class="n">lastname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class="line">
</span><span class="line">      <span class="c">#print it</span>
</span><span class="line">        <span class="k">print</span> <span class="s">"The first name is "</span> <span class="o">+</span> <span class="n">firstname</span>
</span><span class="line">        <span class="k">print</span> <span class="s">"The last name is "</span> <span class="o">+</span> <span class="n">lastname</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>Pretty simple huh? The for loop iterates through the data and produces an array, in this case it’s “row”. You then select the index of that row to get the data from it.</span></p>
<p>
<span>When you run it you should see this output:</span></p>
<pre><span>The first name is Cookie
The last name is Monster
The first name is Guy
The last name is Smiley
The first name is Big
The last name is Bird
The first name is Oscar
The last name is Grouch
The first name is Alastair
The last name is Cookie
</span></pre>
<p>
<span>This is just a straight dump of the database. Let’s clean it up little.</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c"># loop to iterate</span>
</span><span class="line"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span> <span class="p">:</span>
</span><span class="line">      <span class="c">#data from rows</span>
</span><span class="line">        <span class="n">firstname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span class="line">        <span class="n">lastname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class="line">
</span><span class="line">      <span class="c">#print i</span>
</span><span class="line">        <span class="k">print</span> <span class="s">"This Person's name is "</span> <span class="o">+</span> <span class="n">firstname</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">lastname</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>This obviously is a cleaned up version of the same thing. Just remember, for iterates but the cursor is the important part.</span></p>
<p>
<span>Your output will look like this:</span></p>
<pre><span>This Person's name is Cookie Monster
This Person's name is Guy Smiley
This Person's name is Big Bird
This Person's name is Oscar Grouch
This Person's name is Alastair Cookie
</span></pre>
<p>
<span>You can also simply print out the row and look at the raw data:</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c"># loop to iterate</span>
</span><span class="line"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span> <span class="p">:</span>
</span><span class="line">  <span class="k">print</span> <span class="n">row</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>Your output will look something like this:</span></p>
<pre><span>('Cookie', 'Monster')
('Guy', 'Smiley')
('Big', 'Bird')
('Oscar', 'Grouch')
('Alastair', 'Cookie')
</span></pre>
<p>
<span>This allows you to look at the data structure to determine what you want to grab.</span></p>
<h3>
<span>
Closing it all up</span></h3>
<p>
<span>One quick way to bring down a server is leaving your connections open. Since there are persistent connections, when you end your script that doesn’t mean the database session ends with it, generally it does not. So here is how you close it up:</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c"># close the cursor</span>
</span><span class="line"><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="c"># close the connection</span>
</span><span class="line"><span class="n">db</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>Notice how we call the close() method for both objects. closing them. You are actually closing two things: the cursor and the connection. It’s actually a good thing you have to do them separate, as opposed to one function. There may be a need to close a cursor yet leave the connection open. This is why we do it in two steps.</span></p>
<h3>
<span>
The full script</span></h3>
<p>
<span>Here is the full code for this article, in case you are one of those people who skip down to the code, then download it and play around.</span></p>

<figure class="code"><div class="highlight">
<table><tbody>
<tr><td class="gutter"><pre class="line-numbers"><span><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
</span></pre>
</td><td class="code"><pre><code class="python"><span class="line"><span class="c">#!/usr/bin/python</span>
</span><span class="line"><span class="c"># datademo.py </span>
</span><span class="line"><span class="c"># a simple script to pull some data from MySQL</span>
</span><span class="line">
</span><span class="line"><span class="kn">import</span> <span class="nn">MySQLdb</span>
</span><span class="line">
</span><span class="line"><span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">"localhost"</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">"root"</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s">"test"</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c">#create a cursor for the select</span>
</span><span class="line"><span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="c">#execute an sql query</span>
</span><span class="line"><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT firstname,lastname FROM test.name"</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c">##Iterate </span>
</span><span class="line"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span> <span class="p">:</span>
</span><span class="line">      <span class="c">#data from rows</span>
</span><span class="line">        <span class="n">firstname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span class="line">        <span class="n">lastname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class="line">
</span><span class="line">      <span class="c">#print </span>
</span><span class="line">        <span class="k">print</span> <span class="s">"This Person's name is "</span> <span class="o">+</span> <span class="n">firstname</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">lastname</span>
</span><span class="line">
</span><span class="line"><span class="c"># close the cursor</span>
</span><span class="line"><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="c"># close the connection</span>
</span><span class="line"><span class="n">db</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>
</span></code></pre>
</td></tr>
</tbody></table>
</div>
</figure>
<p>
<span>There it is, easy as that! In the next article I’ll be diving in a little deeper and we’ll build some tests to demonstrate the MySQL usage.</span></p>
<p>
<span>Good luck!</span></p>
<p/>
</div>
</div></body></html>