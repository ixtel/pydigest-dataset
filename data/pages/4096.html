<html><body><div><div class="post-1460 post type-post status-publish format-standard has-post-thumbnail hentry category-flask-framework-tutorials-and-examples category-flask-sqlalchemy-examples-and-tutorials category-postgresql category-python tag-flask-blog-tutorial tag-flask-mysql-tutorial tag-flask-postgresql-tutorial tag-flask-sqlaclchemy-foreign-key tag-flask-sqlalchemy-tutorial tag-flask-sqlalchemy tag-one-to-many-relationships tag-one-to-many-relationships-with-flask-sqlalchemy">
                <p>
                            <a href="" rel="nofollow"><img src="http://techarena51.com/wp-content/uploads/2015/04/flask-sqlalchemy-small.png" alt="One to Many Relationships with Flask-SQLAlchemy" align="left" class="affiliate-image"/></a>
                        </p><p>While building database applications with Flask-SQLAlchemy, you will come across a situation where you need to define a relationship between two database tables. While creating blogging application I came across such a situation where I had to define a One to Many Relationship between a blog post (Post Table) and post comments(Comments Table).</p>
<p>In order to define a One to Many Relationships with Flask-SQLAlchemy you need to first add a Foreign key on the Comments or Child table referencing the Post or Parent table. You can then define the relationship, by adding  the relationship() function on the Parent or Post table, as referencing a collection of comments represented by the Comments table.</p>
<p><strong>Example Code</strong></p>
<pre class="brush: python; title: ; notranslate" title="">
#models.py
#Complete code at https://github.com/Leo-g/flask-blog/blob/master/app/models.py
from flask import Flask
from flask.ext.sqlalchemy import SQLAlchemy

app = Flask(__name__)
db = SQLAlchemy(app)

class Post(db.Model):
  id = db.Column(db.Integer, primary_key=True)
  author = db.Column(db.String(255))
  title = db.Column(db.String(255),nullable=False)
  content = db.Column(db.Text)
#Defining One to Many relationships with the relationship function on the Parent Table
  comments = db.relationship('Comments', backref="post", cascade="all, delete-orphan" , lazy='dynamic')

class Comments(db.Model):
  id = db.Column(db.Integer, primary_key=True)
  author = db.Column(db.String(128),nullable=False)
  website = db.Column(db.String(255))
  content = db.Column(db.Text, nullable=False)
#Defining the Foreign Key on the Child Table
  post_id = db.Column(db.Integer, db.ForeignKey('post.id'))

</pre>
<p>I have given the relationship() function the following arguments:<br/>
‘Comments’ : The referencing Child table<br/>
backref=”post” : This argument adds a post attribute on the <em>Comments</em> table, so you can access a Post via the Comments Class as <em>Comments.post</em>.<br/>
cascade=”all, delete-orphan”: This will delete all comments when a referenced post is deleted.<br/>
“lazy=’dynamic’”: This will return a query object which you can refine further like if you want to add a limit etc.</p>
<p>In order to access the comments for a particular post you need to add the below code to your controller and template respectively.</p>
<pre class="brush: python; title: ; notranslate" title="">
#controller.py
#Complete code at https://github.com/Leo-g/flask-blog/blob/master/app/controller.py
from flask import render_template
from models import Post

@app.route('/post/&lt;id&gt;' )
def single_post(id):
  post = Post.query.get(id)
  if post == None:
     return abort(404)
  return render_template('single_post.html', post=post)

</pre>
<p>Template</p>
<pre class="brush: python; title: ; notranslate" title="">
#single_post.html
&lt;!--POST START --&gt;
{{ post.title }}
{{ post.content|safe }}
&lt;!--POST END --&gt;

&lt;!--COMMENTS START --&gt;
{%for comment in post.comments.all()%}
         {{comment.author}} &lt;/br&gt;
          {{comment.content}}         

        {%endfor%}
&lt;!--COMMENTS END→
</pre>
<p>The object returned by<em> post.comments.all()</em> is a python list. You can add comments to this list as follows:</p>
<pre class="brush: python; title: ; notranslate" title="">
&gt;&gt;&gt;post=Post.query.get(post_id)
comment=Comments(author='Leo',website='flask.com',content='flask-sqlalchemy example',post_id=post_id)
&gt;&gt;&gt; post.comments.append(comment)
&gt;&gt;&gt; db.session.add(post)
&gt;&gt;&gt; db.session.commit()

</pre>
<p>This is just a sample of the code for better understanding the complete code is available at the <a href="https://github.com/Leo-g/flask-blog/blob/master/app/controller.py">https://github.com/Leo-g/flask-blog/</a>.</p>

<p>


</p>

<p>If you need create a Many to Many Relationship then read <a title="Many to Many Relationships with Flask-SQLALchemy" href="http://techarena51.com/index.php/many-to-many-relationships-with-flask-sqlalchemy/" target="_blank">Many to Many relationships with Flask-SQLAlchemy</a>. You can also create a database driven CRUD app  complete with validations and tests  with <a href="https://github.com/Leo-G/Flask-Scaffold" target="_blank">Flask-Scaffold</a><br/>
<strong>Working demo of the code</strong><br/>
<iframe src="https://www.youtube.com/embed/V3htGePCZxM" frameborder="0" allowfullscreen="allowfullscreen">VIDEO</iframe></p>
<p>Feel free to fork or let me know about your suggestions or you.</p>
<p> </p>
<p>For database driven API’s or JSON toke based authentication I recommend you read my latest tutorials at</p>
<p><a title="Buidling a database driven RESTFUL JSON API  in Python 3 with Flask Flask-Restful and  SQLAlchemy" href="http://techarena51.com/index.php/buidling-a-database-driven-restful-json-api-in-python-3-with-flask-flask-restful-and-sqlalchemy/" target="_blank">Building  a Database Driven API with Flask-RestFUl and SQLAlchemy</a></p>
<p><a title="JSON web token authentication with  Flask and Angularjs" href="http://techarena51.com/index.php/json-web-token-authentication-with-flask-and-angularjs/" target="_blank">JSON web Token Authentication with Flask and Angularjs</a></p>
<p>Ref</p>
<p>http://docs.sqlalchemy.org/en/latest/orm/backref.html</p>
<p>http://docs.sqlalchemy.org/en/latest/orm/cascades.html#save-update</p>
<p>http://docs.sqlalchemy.org/en/latest/orm/relationships.html</p>
<p>http://docs.sqlalchemy.org/en/latest/orm/basic_relationships.html
</p>

<p/>
                         <div class="abh_box abh_box_down abh_box_business"><div class="abh_tab_content"><section class="vcard abh_about_tab abh_tab"><div class="abh_text"><p class="abh_job"/><p class="description note abh_description">Is a Technical project manager who through this blog shares his experience building Web Applications with Python, FlaskAngularjs and Linux.His Projects are opensource and available at https://github.com/Leo-g</p></div> </section><section class="abh_posts_tab abh_tab"><div class="abh_text"><h4>Latest posts by Leo G <span class="abh_allposts">(<a href="http://techarena51.com/index.php/author/leo/">see all</a>)</span></h4></div> </section></div> </div>        <p class="clear"/>
                
    </div>
    
    
        
</div></body></html>