<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-python-to-c-14-transpiler" class="anchor" href="#python-to-c-14-transpiler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Python to C++ 14 transpiler</h1>

<p><a href="https://app.wercker.com/project/bykey/faee5da9a0f6981723b39973d3137158"><img src="https://camo.githubusercontent.com/2065e3784a46392745334d9ea5ce7ba2be39416c/68747470733a2f2f696d672e736869656c64732e696f2f776572636b65722f63692f3534633764643936383063373037353232353030333633622e7376673f7374796c653d666c6174" alt="Wercker Status" data-canonical-src="https://img.shields.io/wercker/ci/54c7dd9680c707522500363b.svg?style=flat"/></a>
<a href="https://coveralls.io/r/lukasmartinelli/py14?branch=master"><img src="https://camo.githubusercontent.com/fcf5a95f02588d7bd589bfab0c329dca8d84f490/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6c756b61736d617274696e656c6c692f707931342f62616467652e7376673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/lukasmartinelli/py14/badge.svg?branch=master"/></a>
<a href="https://scrutinizer-ci.com/g/lukasmartinelli/py14/?branch=master"><img src="https://camo.githubusercontent.com/c67a1c534cefb094be2d4cbce0f165619e4431be/68747470733a2f2f696d672e736869656c64732e696f2f7363727574696e697a65722f672f6c756b61736d617274696e656c6c692f707931342e7376673f7374796c653d666c6174" alt="Scrutinizer Code Quality" data-canonical-src="https://img.shields.io/scrutinizer/g/lukasmartinelli/py14.svg?style=flat"/></a>
<a href="https://landscape.io/github/lukasmartinelli/py14/master"><img src="https://camo.githubusercontent.com/df15c432721a97f76c8ce90cab776769797b4cc5/68747470733a2f2f6c616e6473636170652e696f2f6769746875622f6c756b61736d617274696e656c6c692f707931342f6d61737465722f6c616e6473636170652e7376673f7374796c653d666c6174" alt="Code Health" data-canonical-src="https://landscape.io/github/lukasmartinelli/py14/master/landscape.svg?style=flat"/></a>
<a href="https://gemnasium.com/lukasmartinelli/py14"><img src="https://camo.githubusercontent.com/d16a8cb4bed17ac190a52b58d8b46d3892793b2d/68747470733a2f2f67656d6e617369756d2e636f6d2f6c756b61736d617274696e656c6c692f707931342e737667" alt="Dependency Status" data-canonical-src="https://gemnasium.com/lukasmartinelli/py14.svg"/></a></p>

<p>Try it out online: <a href="http://py14.lukasmartinelli.ch/">http://py14.lukasmartinelli.ch/</a></p>

<p>This is a little experiment that shows how far you can go with the
C++ 14 <code>auto</code> return type and templates.
C++14 has such powerful type deduction that it is possible to transpile
Python into C++ without worrying about the missing type annotations in python. Only a small subset of Python is working and you will encounter many bugs. The goal is to showcase the power of C++14 templates and not to create a fully functional transpiler.</p>

<h2><a id="user-content-example" class="anchor" href="#example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example</h2>

<p>Original Python version.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">factorial</span>(<span class="pl-smi">num</span>):
    <span class="pl-k">if</span> num <span class="pl-k">&lt;=</span> <span class="pl-c1">1</span>:
        <span class="pl-k">return</span> num
    <span class="pl-k">return</span> factorial(num<span class="pl-k">-</span><span class="pl-c1">1</span>) <span class="pl-k">*</span> num</pre></div>

<p>Transpiled C++ template.</p>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">template </span>&lt;<span class="pl-k">typename</span> T1&gt; <span class="pl-k">auto</span> <span class="pl-en">factorial</span>(T1 num) {
    <span class="pl-k">if</span> (num &lt;= <span class="pl-c1">1</span>) {
        <span class="pl-k">return</span> num;
    }
    <span class="pl-k">return</span> <span class="pl-c1">factorial</span>(num - <span class="pl-c1">1</span>) * num;
}</pre></div>

<h2><a id="user-content-how-it-works" class="anchor" href="#how-it-works" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How it works</h2>

<p>Consider a <code>map</code> implementation.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-c1">map</span>(<span class="pl-smi">values</span>, <span class="pl-smi">fun</span>):
    results <span class="pl-k">=</span> []
    <span class="pl-k">for</span> v <span class="pl-k">in</span> values:
        results.append(fun(v))
    <span class="pl-k">return</span> results</pre></div>

<p>This can be transpiled into the following C++ template.</p>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">template </span>&lt;<span class="pl-k">typename</span> T1, <span class="pl-k">typename</span> T2&gt;
<span class="pl-k">auto</span> <span class="pl-en">map</span>(T1 values, T2 fun) {
    std::vector&lt;<span class="pl-c1">decltype</span>(
        <span class="pl-c1">fun</span>(std::declval&lt;<span class="pl-k">typename</span> <span class="pl-smi">decltype</span>(values)::value_type&gt;()))&gt; results{};
    <span class="pl-k">for</span> (<span class="pl-k">auto</span> v : values) {
        results.<span class="pl-c1">push_back</span>(<span class="pl-c1">fun</span>(v));
    }
    <span class="pl-k">return</span> results;
}</pre></div>

<p>The parameters and the return types are deduced automatically
In order to define the results vector we need to:</p>

<ol>
<li>Deduce the type for v returned from the values range
<code>using v_type = typename decltype(values)::value_type</code></li>
<li>Deduce the return type of <code>fun</code> for call with parameter v
<code>decltype(fun(v))</code></li>
<li>Because we dont know v at the time of definition we need to fake it
<code>std::declval&lt;v_type&gt;()</code></li>
<li>This results in the fully specified value type of the results vector
<code>decltype(fun(std::declval&lt;typename decltype(values)::value_type&gt;()))</code></li>
</ol>

<h2><a id="user-content-trying-it-out" class="anchor" href="#trying-it-out" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Trying it out</h2>

<p>Requirements:</p>



<p>Transpiling:</p>

<pre><code>./py14.py fib.py &gt; fib.cpp
</code></pre>

<p>Compiling:</p>

<pre><code>clang++ -Wall -Wextra -std=c++14 -Ipy14/runtime fib.cpp
</code></pre>

<p>Run regression tests:</p>

<pre><code>cd regtests
make
</code></pre>

<p>Run tests</p>

<pre><code>pip install -r requirements.txt
py.test --cov=py14
</code></pre>

<h2><a id="user-content-more-examples" class="anchor" href="#more-examples" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>More Examples</h2>

<p><strong>Probability Density Function (PDF)</strong></p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">pdf</span>(<span class="pl-smi">x</span>, <span class="pl-smi">mean</span>, <span class="pl-smi">std_dev</span>):
    term1 <span class="pl-k">=</span> <span class="pl-c1">1.0</span> <span class="pl-k">/</span> ((<span class="pl-c1">2</span> <span class="pl-k">*</span> math.pi) <span class="pl-k">**</span> <span class="pl-c1">0.5</span>)
    term2 <span class="pl-k">=</span> (math.e <span class="pl-k">**</span> (<span class="pl-k">-</span><span class="pl-c1">1.0</span> <span class="pl-k">*</span> (x<span class="pl-k">-</span>mean) <span class="pl-k">**</span> <span class="pl-c1">2.0</span> <span class="pl-k">/</span> <span class="pl-c1">2.0</span> <span class="pl-k">*</span> (std_dev <span class="pl-k">**</span> <span class="pl-c1">2.0</span>)))
    <span class="pl-k">return</span> term1 <span class="pl-k">*</span> term2</pre></div>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">template </span>&lt;<span class="pl-k">typename</span> T1, <span class="pl-k">typename</span> T2, <span class="pl-k">typename</span> T3&gt;
<span class="pl-k">auto</span> <span class="pl-en">pdf</span>(T1 x, T2 mean, T3 std_dev) {
    <span class="pl-k">auto</span> term1 = <span class="pl-c1">1.0</span> / <span class="pl-c1">std::pow</span>(<span class="pl-c1">2</span> * py14::math::pi, <span class="pl-c1">0.5</span>);
    <span class="pl-k">auto</span> term2 = <span class="pl-c1">std::pow</span>(py14::math::e, -<span class="pl-c1">1.0</span> * <span class="pl-c1">std::pow</span>(x - mean, <span class="pl-c1">2.0</span>) / <span class="pl-c1">2.0</span> *
                                                <span class="pl-c1">std::pow</span>(std_dev, <span class="pl-c1">2.0</span>));
    <span class="pl-k">return</span> term1 * term2;
}</pre></div>

<p><strong>Fibonacci</strong></p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">fib</span>(<span class="pl-smi">n</span>):
    <span class="pl-k">if</span> n <span class="pl-k">==</span> <span class="pl-c1">1</span>:
        <span class="pl-k">return</span> <span class="pl-c1">1</span>
    <span class="pl-k">elif</span> n <span class="pl-k">==</span> <span class="pl-c1">0</span>:
        <span class="pl-k">return</span> <span class="pl-c1">0</span>
    <span class="pl-k">else</span>:
        <span class="pl-k">return</span> fib(n<span class="pl-k">-</span><span class="pl-c1">1</span>) <span class="pl-k">+</span> fib(n<span class="pl-k">-</span><span class="pl-c1">2</span>)</pre></div>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">template </span>&lt;<span class="pl-k">typename</span> T1&gt; <span class="pl-k">auto</span> <span class="pl-en">fib</span>(T1 n) {
    <span class="pl-k">if</span> (n == <span class="pl-c1">1</span>) {
        <span class="pl-k">return</span> <span class="pl-c1">1</span>;
    } <span class="pl-k">else</span> {
        <span class="pl-k">if</span> (n == <span class="pl-c1">0</span>) {
            <span class="pl-k">return</span> <span class="pl-c1">0</span>;
        } <span class="pl-k">else</span> {
            <span class="pl-k">return</span> <span class="pl-c1">fib</span>(n - <span class="pl-c1">1</span>) + <span class="pl-c1">fib</span>(n - <span class="pl-c1">2</span>);
        }
    }
}</pre></div>

<p><strong>Bubble Sort</strong></p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">sort</span>(<span class="pl-smi">seq</span>):
    <span class="pl-c1">L</span> <span class="pl-k">=</span> <span class="pl-c1">len</span>(seq)
    <span class="pl-k">for</span> _ <span class="pl-k">in</span> <span class="pl-c1">range</span>(<span class="pl-c1">L</span>):
        <span class="pl-k">for</span> n <span class="pl-k">in</span> <span class="pl-c1">range</span>(<span class="pl-c1">1</span>, <span class="pl-c1">L</span>):
            <span class="pl-k">if</span> seq[n] <span class="pl-k">&lt;</span> seq[n <span class="pl-k">-</span> <span class="pl-c1">1</span>]:
                seq[n <span class="pl-k">-</span> <span class="pl-c1">1</span>], seq[n] <span class="pl-k">=</span> seq[n], seq[n <span class="pl-k">-</span> <span class="pl-c1">1</span>]
    <span class="pl-k">return</span> seq</pre></div>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">template </span>&lt;<span class="pl-k">typename</span> T1&gt; <span class="pl-k">auto</span> <span class="pl-en">sort</span>(T1 seq) {
    <span class="pl-k">auto</span> L = seq.<span class="pl-c1">size</span>();
    <span class="pl-k">for</span> (<span class="pl-k">auto</span> _ : <span class="pl-c1">rangepp::range</span>(L)) {
        <span class="pl-k">for</span> (<span class="pl-k">auto</span> n : <span class="pl-c1">rangepp::range</span>(<span class="pl-c1">1</span>, L)) {
            <span class="pl-k">if</span> (seq[n] &lt; seq[n - <span class="pl-c1">1</span>]) {
                <span class="pl-c1">std::tie</span>(seq[n - <span class="pl-c1">1</span>], seq[n]) = <span class="pl-c1">std::make_tuple</span>(seq[n], seq[n - <span class="pl-c1">1</span>]);
            }
        }
    }
    <span class="pl-k">return</span> seq;
}</pre></div>

<h2><a id="user-content-working-features" class="anchor" href="#working-features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Working Features</h2>

<p>Only bare functions using the basic language features are supported.</p>



<p>Language Keywords</p>

<ul class="task-list">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled"/> global, nonlocal</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"/> while, for, continue, break</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"/> if, elif, else</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled"/> try, except, raise</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"/> def, lambda</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled"/> new, class</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"/> from, import, as</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled"/> pass, assert</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"/> and, or, is, in, not</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"/> return</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled"/> yield</li>
</ul>

<p>Builtins</p>



<p>Data Structures</p>


</article>
  </div></body></html>