<html><body><div><div class="content container">
      




<p class="date">14 Jan 2015</p>


<p align="center">
 <img src="/misc/mo_teaser.png" alt="Molecular orbital"/>
</p>

<p>A molecular orbital is a function that describes an electron in a molecule. Visualizing molecular orbitals helps us understand how the electrons are distributed in the molecule.</p>

<p>In this post, we will learn how to read and visualize molecular orbitals from a quantum chemical calculation, all without leaving the IPython Notebook.</p>

<p>The software stack will be:</p>

<ul>
  <li><a href="http://chemlab.rtfd.org">chemlab</a>: For general utilities</li>
  <li><a href="http://cclib.github.io/">cclib</a>: To parse GAMESS output files</li>
  <li><a href="http://chemview.rtfd.org">chemview</a>: To visualize molecular orbitals in the browser</li>
</ul>

<p>To install the software you can conveniently use the <a href="https://store.continuum.io/cshop/anaconda/">Anaconda</a> scientific python distribution that can be downloaded at the following link: <a href="http://continuum.io/downloads">http://continuum.io/downloads</a></p>

<p>After installing <a href="https://store.continuum.io/cshop/anaconda/">Anaconda</a> you can install the software required by running:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">conda install -c http://conda.binstar.org/gabrielelanaro chemlab chemview</code></pre></figure>



<p>Molecular orbitals are generally produced as a result of some quantum chemical calculation. Typically they are given to the user in the form of a <em>basis set definition</em> and the molecular orbitals <em>coefficients</em>.</p>

<p><em>What is a basis set? And which coefficients do we need?</em></p>

<p>The answer comes straight from <a href="http://en.wikipedia.org/wiki/Basis_set_%28chemistry%29">Wikipedia</a></p>

<blockquote>
  <p>A basis set in theoretical and computational chemistry is a set of functions (called basis functions) which are combined in linear combinations (generally as part of a quantum chemical calculation) to create molecular orbitals.</p>
</blockquote>

<p>In other words, a molecular orbital \(f(x, y, z)\) is commonly expressed as a linear combination of basis functions \(b_i(x, y, z)\):</p>



<p>All we need to calculate the molecular orbital is to evaluate the basis functions and combine them using the coefficients.</p>

<p>To extract the basis set specification and the molecular orbital coefficients we can use <a href="http://chemlab.rtfd.org">chemlab</a> (that internally uses <a href="http://cclib.github.io/">cclib</a>). In the following code, we retrieve a test calculation directly from the <a href="http://cclib.github.io/">cclib</a> distribution and we extract:</p>

<ul>
  <li>the molecule geometry <code class="highlighter-rouge">molecule</code></li>
  <li>the basis set specifcation <code class="highlighter-rouge">gbasis</code></li>
  <li>the coefficients <code class="highlighter-rouge">mocoeffs</code>.</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">chemlab.io</span> <span class="kn">import</span> <span class="n">remotefile</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://raw.githubusercontent.com/cclib/cclib/master/data/GAMESS/basicGAMESS-US2012/water_mp2.out"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">remotefile</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">"gamess"</span><span class="p">)</span>

<span class="n">molecule</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">'molecule'</span><span class="p">)</span>
<span class="n">molecule</span><span class="o">.</span><span class="n">guess_bonds</span><span class="p">()</span>

<span class="n">mocoeffs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">'mocoeffs'</span><span class="p">)</span>
<span class="n">gbasis</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">'gbasis'</span><span class="p">)</span></code></pre></figure>

<div class="tip">
<p>The file is an output file from the program <a href="http://www.msg.ameslab.gov/index.html">GAMESS</a>, performing an energy calculation of a single water molecule using the <a href="http://en.wikipedia.org/wiki/M%C3%B8ller%E2%80%93Plesset_perturbation_theory">mp2</a> method.</p>	
</div>

<p>We won’t go in detail on how the <code class="highlighter-rouge">gbasis</code> format is structured, it’s enough to say that it contains the specifications on how to construct the basis functions. The coefficients are given by <code class="highlighter-rouge">mocoeffs</code>, which is a list containing a single matrix of shape (7, 7).</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="n">mocoeffs</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>[array([[ 0.994203,  0.025916, -0.      ,  0.003993, -0.      , -0.005627, -0.005627],
        [-0.234218,  0.845882, -0.      ,  0.117048, -0.      ,  0.156449,  0.156449],
        [ 0.      ,  0.      ,  0.603305,  0.      ,  0.      ,  0.446377, -0.446377],
        [ 0.100458, -0.521395, -0.      ,  0.774267, -0.      ,  0.289064,  0.289064],
        [ 0.      ,  0.      ,  0.      ,  0.      ,  1.      ,  0.      ,  0.      ],
        [-0.128351,  0.832526,  0.      ,  0.732626,  0.      , -0.775801, -0.775801],
        [ 0.      ,  0.      ,  0.976485,  0.      ,  0.      , -0.808916,  0.808916]])]
</code></pre>
</div>

<p>Each row of the matrix corresponds to the set of coefficients for a given molecular orbital (in this case we have a total of 7 molecular orbitals).</p>

<h2 id="molecular-orbitals-as-functions">Molecular orbitals as functions</h2>

<p>Now we want to transform this specification into a standard function that, given a set of \( (x ,y ,z) \) coordinates, returns a value corresponding to the function at that point. This can be accomplished through the <a href="http://chemlab.readthedocs.org/en/latest/api/chemlab.qc.html#chemlab.qc.molecular_orbital"><code class="highlighter-rouge">chemlab.qc.molecular_orbital</code></a> function.</p>

<p>In the following snippet we create a function representing the 4th molecular orbital and we evaluate it at <code class="highlighter-rouge">(0, 0, 0)</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">chemlab.qc</span> <span class="kn">import</span> <span class="n">molecular_orbital</span>

<span class="n">coefficients</span> <span class="o">=</span> <span class="n">mocoeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="c"># 4th because we start counting from 0</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">molecular_orbital</span><span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">r_array</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">,</span> <span class="n">gbasis</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="c"># 2.67271724871</span></code></pre></figure>

<p>Now that we have an actual function that outputs real numbers, we can plot it using the <a href="http://chemview.rtfd.org">chemview</a> library.</p>

<h2 id="visualizing-the-molecular-orbitals-as-isosurfaces">Visualizing the molecular orbitals as isosurfaces</h2>

<p>One of the most popular ways to visualize a molecular orbital is to plot it as an <em>isosurface</em>. Isosurfaces can give us a feeling of what the shape of the function (or the <em>field</em>) looks like.</p>

<p>Plotting isosurfaces is fairly easy with <a href="http://chemview.rtfd.org">chemview</a>. We first need to do the necessary imports:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">chemview</span> <span class="kn">import</span> <span class="n">enable_notebook</span><span class="p">,</span> <span class="n">MolecularViewer</span>
<span class="n">enable_notebook</span><span class="p">()</span></code></pre></figure>

<p>Next, we want to create a <a href="http://chemview.readthedocs.org/en/latest/api/index.html#MolecularViewer"><code class="highlighter-rouge">chemview.MolecularViewer</code></a> instance and to visualize the molecule as a wireframe:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Initialize molecular viewer</span>
<span class="n">mv</span> <span class="o">=</span> <span class="n">MolecularViewer</span><span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">r_array</span><span class="p">,</span> <span class="p">{</span> <span class="s">'atom_types'</span><span class="p">:</span> <span class="n">molecule</span><span class="o">.</span><span class="n">type_array</span><span class="p">,</span>
                                         <span class="s">'bonds'</span><span class="p">:</span> <span class="n">molecule</span><span class="o">.</span><span class="n">bonds</span> <span class="p">})</span>
<span class="n">mv</span><span class="o">.</span><span class="n">wireframe</span><span class="p">()</span>
<span class="n">mv</span></code></pre></figure>

<p><img src="/misc/water_wireframe.png" alt="Water wireframe"/></p>

<p>Finally, we render the molecular orbital using the <a href="http://chemview.readthedocs.org/en/latest/api/index.html#MolecularViewer.add_isosurface"><code class="highlighter-rouge">MolecularViewer.add_isosurface</code></a> method. We render the surface for which the molecular orbital evaluates to 0.3 (positive sign) in blue, and the surface corresponding to an isovalue of -0.3 (negative sign) in red.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">mv</span><span class="o">.</span><span class="n">add_isosurface</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">isolevel</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mh">0xff0000</span><span class="p">)</span>
<span class="n">mv</span><span class="o">.</span><span class="n">add_isosurface</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">isolevel</span><span class="o">=-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mh">0x0000ff</span><span class="p">)</span>

<span class="n">mv</span></code></pre></figure>

<p><img src="/misc/water_mo04.png" alt="Water MO"/></p>

<p>You can now play around with the output, try different orbitals, changing the isovalue, colors and style of the isosurface.</p>

<p>Hopefully that gave you an idea of the outstanding capabilities of IPython notebook and the available chemistry libraries. Not only making your scripts in the notebook can save you a lot of time, but having this level of control and granularity gives you the possiblity to do a kind of analysis which is impossible with the standard black-box tools commonly used by computational chemists.</p>

<p>By the way, if you’re interested in maintaining a quantum chemistry package in <a href="http://chemlab.rtfd.org">chemlab</a> let me know in an email!</p>


<p class="separator"/>


<h3>Share this Post</h3>





    
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>            </noscript>



    </div>

    </div></body></html>