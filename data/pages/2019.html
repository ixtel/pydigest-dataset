<html><body><div><div class="entry-content" itemprop="text"><p>Search and replace is such a common task that it should be a tool that’s in every command line script author’s toolbox.<br/>
There are probably endless solutions to the problem.<br/>
I’ve put together my standard methods for tackling the problem.<br/>
I’ll also show similar Perl versions, mainly for comparisons.</p>

<p><span id="more-438"/></p>
<h2 id="use_models">use models</h2>
<p>In most of the following discussion, I’m just replacing ‘foo’ with ‘bar’.<br/>
<strong>However ‘foo’ can be ANY regular expression.</strong></p>
<p>The dummy situation I’m going to set up is this.<br/>
I’ve got a file named ‘example.txt’.<br/>
It looks like this:</p>
<p/>

		<div id="crayon-56d5892d2c7b2813769371" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7b2813769371-1"><span class="crayon-e">foo </span><span class="crayon-e">foo </span><span class="crayon-e">fiddle </span><span class="crayon-e">foo </span></p><p class="crayon-line" id="crayon-56d5892d2c7b2813769371-2"><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">baz </span><span class="crayon-v">too</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">well </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-i">foo</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5892d2c7b2813769371-3"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>I realize that I want to replace ‘foo’ with ‘bar’.</p>
<p>I’d like to be able to have a script that runs in a way that I can either pipe the contents of the file into the script, or just give a file name to the script, like this:</p>
<ul>
<li><code>cat example.txt | python search_replace.py</code></li>
<li><code>python search_replace.py example.txt</code></li>
</ul>
<p>Now, I may or may not want to have the script modify the file in place.<br/>
If not, then the second example above would just print the modified contents.<br/>
I also may want to make a backup of example.txt first.<br/>
We can all of those things, as I’ll show below.</p>
<h2 id="in_python">using Python</h2>
<h3>Search and replace as a filter</h3>
<p>I think the most basic form of a search/replace script in python is something like this:</p>
<p/>

		<div id="crayon-56d5892d2c7bf915196374" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7bf915196374-1"><span class="crayon-e">import </span><span class="crayon-e">fileinput</span></p><p class="crayon-line" id="crayon-56d5892d2c7bf915196374-2"><span class="crayon-e">import </span><span class="crayon-e">re</span></p><p class="crayon-line" id="crayon-56d5892d2c7bf915196374-3"> </p><p class="crayon-line" id="crayon-56d5892d2c7bf915196374-4"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">fileinput</span><span class="crayon-sy">.</span><span class="crayon-e">input</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5892d2c7bf915196374-5"><span class="crayon-h">    </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-s">'foo'</span><span class="crayon-sy">,</span><span class="crayon-s">'bar'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">rstrip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5892d2c7bf915196374-6"><span class="crayon-h">    </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5892d2c7bf915196374-7"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>The fileinput module takes care of the stream verses filename input handling.<br/>
The re (regex, regular expression) module has sub which handles the search/replace.<br/>
The ‘rstrip’ is called on the input just to strip the line of it’s newline, since the next ‘print’ statement is going to add a newline by default.</p>
<p>This handles the case where we don’t want to modify the file.</p>
<h3>In place modification of files</h3>
<p>A slightly modified script will allow you to modify files, and optionally copy the original file to a backup.</p>
<p/>

		<div id="crayon-56d5892d2c7c6741799623" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7c6741799623-1"><span class="crayon-e">import </span><span class="crayon-e">fileinput</span></p><p class="crayon-line" id="crayon-56d5892d2c7c6741799623-2"><span class="crayon-e">import </span><span class="crayon-e">re</span></p><p class="crayon-line" id="crayon-56d5892d2c7c6741799623-3"> </p><p class="crayon-line" id="crayon-56d5892d2c7c6741799623-4"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">fileinput</span><span class="crayon-sy">.</span><span class="crayon-e">input</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">backup</span><span class="crayon-o">=</span><span class="crayon-s">'.bak'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5892d2c7c6741799623-5"><span class="crayon-h">    </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-s">'foo'</span><span class="crayon-sy">,</span><span class="crayon-s">'bar'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">rstrip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5892d2c7c6741799623-6"><span class="crayon-h">    </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5892d2c7c6741799623-7"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>If you leave the ‘backup’ flag out, no backup will be made.<br/>
As I’ve shown it with backup=’.bak’, an example.txt.bak file will be created.</p>
<h2 id="more_complex">with a more complex regular expression</h2>
<p>Of course, foo and bar don’t have to be so simple.<br/>
For example, the <a href="http://pythontesting.net/python/command-line-perl/">markdown issue I have with converting a table of contents to a series of h2 tags</a>, can be solved with the following script.</p>
<p/>

		<div id="crayon-56d5892d2c7cd349735194" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7cd349735194-1"><span class="crayon-e">import </span><span class="crayon-e">fileinput</span></p><p class="crayon-line" id="crayon-56d5892d2c7cd349735194-2"><span class="crayon-e">import </span><span class="crayon-e">re</span></p><p class="crayon-line" id="crayon-56d5892d2c7cd349735194-3"> </p><p class="crayon-line" id="crayon-56d5892d2c7cd349735194-4"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">fileinput</span><span class="crayon-sy">.</span><span class="crayon-e">input</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5892d2c7cd349735194-5"><span class="crayon-h">    </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'\* \[(.*)\]<span class="crayon-sy">\</span><span class="crayon-sy">(</span><span class="crayon-o">#</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-o">*</span><span class="crayon-sy">)</span>\)'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-s">'&lt;h2 id="\2"&gt;\1&lt;/h2&gt;'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">rstrip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5892d2c7cd349735194-6"><span class="crayon-h">    </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5892d2c7cd349735194-7"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>Here, I’m looking for things that look like</p>
<p/>

		<div id="crayon-56d5892d2c7d2513290159" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7d2513290159-1"><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">the </span><span class="crayon-v">label</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-p">#the_anchor)</span></p><p class="crayon-line" id="crayon-56d5892d2c7d2513290159-2"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>and replacing it with</p>
<p/>

		<div id="crayon-56d5892d2c7d7016200067" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7d7016200067-1"><span class="crayon-o">&lt;</span><span class="crayon-e">h2 </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"the_anchor"</span><span class="crayon-o">&gt;</span><span class="crayon-e">the </span><span class="crayon-v">link</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h2</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56d5892d2c7d7016200067-2"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h2 id="in_perl">using Perl</h2>
<p>As I’ve mentioned before, I still <a href="http://pythontesting.net/python/command-line-perl/">use Perl sometimes</a>, even though I like to use Python for most of my scripting needs.</p>
<p>Therefore, I’m presenting Perl versions that I’ve used before, mostly as a comparison.</p>
<p>There are lots of ways to implement this in Perl.</p>
<h3>all on the command line</h3>
<p>The following are all roughly equivalent:</p>
<ul>
<li><code>cat example.txt | perl -pe 's/foo/bar/g;'</code></li>
<li><code>cat example.txt | perl -ne 's/foo/bar/g;print'</code></li>
<li><code>cat example.txt | perl -e 'while (){s/foo/bar/g;print;}'</code></li>
<li><code>cat example.txt | perl -e 'while (){$_ =~ s/foo/bar/g;print;}'</code></li>
<li><code>perl -pe 's/foo/bar/g;' example.txt</code></li>
<li><code>perl -ne 's/foo/bar/g;print' example.txt</code></li>
<li><code>perl -e 'while (){s/foo/bar/g;print;}' example.txt</code></li>
<li><code>perl -e 'while (){$_ =~ s/foo/bar/g;print $_;}' example.txt</code></li>
</ul>
<h3>flags used</h3>
<ul>
<li>-e : execute the code on the command line</li>
<li>-n : wrap everything in <code>while (){ [code here] }</code></li>
<li>-p : wrap everything in <code>while (){ [code here]; print; }</code></li>
</ul>
<h3>As a script</h3>
<p>And of course, you don’t have to use the ‘-e’ flag.<br/>
You can stick the script in a file.</p>
<p>The following scripts are equivalent:</p>
<p/>

		<div id="crayon-56d5892d2c7df877996341" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-1">1</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-2">2</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-3">3</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-4">4</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-5">5</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-6">6</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-7">7</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-8">8</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-9">9</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-10">10</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-11">11</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-12">12</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-13">13</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-14">14</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-15">15</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-16">16</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-17">17</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-18">18</p><p class="crayon-num" data-line="crayon-56d5892d2c7df877996341-19">19</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7df877996341-1"><span class="crayon-p">#!/usr/bin/perl </span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-2"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">&lt;&gt;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-3"><span class="crayon-h">  </span><span class="crayon-sy">$</span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">~</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-o">/</span><span class="crayon-v">foo</span><span class="crayon-o">/</span><span class="crayon-v">bar</span><span class="crayon-o">/</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-4"><span class="crayon-h">  </span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-5"><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-6"> </p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-7"><span class="crayon-p">#!/usr/bin/perl </span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-8"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">&lt;&gt;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-9"><span class="crayon-h">  </span><span class="crayon-v">s</span><span class="crayon-o">/</span><span class="crayon-v">foo</span><span class="crayon-o">/</span><span class="crayon-v">bar</span><span class="crayon-o">/</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-10"><span class="crayon-h">  </span><span class="crayon-v">print</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-11"><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-12"> </p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-13"><span class="crayon-p">#!/usr/bin/perl -n</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-14"><span class="crayon-v">s</span><span class="crayon-o">/</span><span class="crayon-v">foo</span><span class="crayon-o">/</span><span class="crayon-v">bar</span><span class="crayon-o">/</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-15"><span class="crayon-v">print</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-16"> </p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-17"><span class="crayon-p">#!/usr/bin/perl -p</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-18"><span class="crayon-v">s</span><span class="crayon-o">/</span><span class="crayon-v">foo</span><span class="crayon-o">/</span><span class="crayon-v">bar</span><span class="crayon-o">/</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5892d2c7df877996341-19"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h3>Changing files in place</h3>
<p>Perl also allows changing the files in place, with the addition of the ‘-i’ flag, usually used as ‘-i.bak’ to make backup copies of the original:</p>
<p/>

		<div id="crayon-56d5892d2c7e5144821282" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5892d2c7e5144821282-1"><span class="crayon-v">perl</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">pi</span><span class="crayon-sy">.</span><span class="crayon-v">bak</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-s">'s/foo/bar/g;'</span><span class="crayon-h"> </span><span class="crayon-v">example</span><span class="crayon-sy">.</span><span class="crayon-i">txt</span></p><p class="crayon-line" id="crayon-56d5892d2c7e5144821282-2"> </p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>

</div></div></body></html>