<html><body><div><div class="entry-content">
		<h1>Introduction</h1>
<p>This is the second post in a three part series on mocking in Python. Check part 1 <a href="https://blog.deltaforce.io/wordpress/mocking-all-over-the-world-part-1-patch-decorators/">here</a>.</p>
<p>The system we’re building consists of many small services, running in Docker containers, which are in constant communication with the other services around them. This introduces some unit testing challenges that mocking can alleviate.</p>
<p>In the last session we looked at asserting calls to the mocked class.</p>
<p><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/This-session.png"><img class="aligncenter wp-image-97 size-large" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/This-session-1024x640.png" alt="This session" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/This-session-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/This-session-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/This-session.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></p>
<p>In this session we wanted to look at mocking return values from the mocked class.</p>
<p><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Last-Session.png"><img class="aligncenter wp-image-96 size-large" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Last-Session-1024x640.png" alt="Last Session" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Last-Session-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Last-Session-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Last-Session.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></p>
<p><b>Part 1 – .return_value</b></p>
<p><b>The problem</b></p>
<p>As we’d learned in the previous sessions, the best way to make a dojo interesting for the class, is to start by exposing them to the pain that the class aims to remove. To that end, we start with this:</p>
<p><strong><strong><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/You-have-10-minutes-to-test-this.png"><img class="aligncenter wp-image-98 size-large" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/You-have-10-minutes-to-test-this-1024x640.png" alt="You have 10 minutes to test this" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/You-have-10-minutes-to-test-this-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/You-have-10-minutes-to-test-this-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/You-have-10-minutes-to-test-this.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></strong></strong></p>
<p>We kept the exercise to 10 minutes because this example is impossible to test without changing the CUT somehow and we wanted to make a point, without annoying people. The point, of course, is that testing non-deterministic inputs is difficult and that mocks can help. We also pointed out that this doesn’t just apply to non-deterministic test inputs but is also helpful when trying to recreate difficult test conditions.</p>
<p>We had assumed that nobody would complete this, but we were pleasantly surprised when some of the team members went ahead and at least tested the return type before admitting defeat. This was a signal that the team were starting to consider what could be tested, in all situations.</p>
<p><b>The Solution</b></p>
<p>We then introduced the .return_value mocking construct.</p>
<p><strong><strong><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-generic.png"><img class="aligncenter wp-image-99 size-large" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-generic-1024x640.png" alt="return_value - generic" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-generic-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-generic-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-generic.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></strong></strong></p>
<p><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-in-details.png"><img class="aligncenter size-large wp-image-101" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-in-details-1024x640.png" alt="return_value - in details" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-in-details-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-in-details-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/return_value-in-details.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></p>
<p>And then let the teams have a go at testing the code with mocks.</p>
<p><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Now-test-this-using-return_value.png"><img class="aligncenter size-large wp-image-102" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Now-test-this-using-return_value-1024x640.png" alt="Now test this using return_value" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Now-test-this-using-return_value-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Now-test-this-using-return_value-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Now-test-this-using-return_value.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></p>
<p><b>Part 2 – .side_effect</b><strong><strong> </strong></strong></p>
<p><b>The Problem</b></p>
<p>Next we wanted the team to think about testing non-deterministic (or difficult to reproduce) test conditions when the state of the CUT is at play. Here’s the challenge:</p>
<p><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Non-Deterministic-with-State.png"><img class="aligncenter size-large wp-image-103" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Non-Deterministic-with-State-1024x640.png" alt="Non-Deterministic with State" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Non-Deterministic-with-State-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Non-Deterministic-with-State-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/Non-Deterministic-with-State.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></p>
<p>Although letting the team fight with the first example for ten minutes had been fruitful, we were also aware of a need to keep the team engaged during our short session. For that reason we introduced the solution to this problem straight away.</p>
<p><b>The Solution</b><strong><strong> </strong></strong></p>
<p>The side_effect function allows one to specify a sequence of return values (or exceptions) to be returned from a function on a mock object. This in turn allows the above example to be easily tested.</p>
<p><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-generic.png"><img class="aligncenter size-large wp-image-104" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-generic-1024x640.png" alt="side_effect - generic" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-generic-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-generic-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-generic.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></p>
<p><a href="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-in-detail.png"><img class="aligncenter size-large wp-image-105" src="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-in-detail-1024x640.png" alt="side_effect - in detail" srcset="https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-in-detail-300x187.png 300w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-in-detail-1024x640.png 1024w, https://blog.deltaforce.io/wordpress/wp-content/uploads/2014/12/side_effect-in-detail.png 1440w" sizes="(max-width: 474px) 100vw, 474px"/></a></p>
<p>For this second challenge we asked the team to work in pairs and since everyone finished early, we introduced returning exceptions via side_effect face to face.</p>
<p><b>Conclusion</b></p>
<p>In terms of timing, this dojo may have been a little too small for the 2 hours available. Everyone was finished in under 2 hours and apart from getting .side_effect to throw exceptions, we hadn’t thought of any more content. What was missed in potential ‘extra learning’ however, was made up for in the feeling of satisfaction from the team. They seemed pleased to have finished the assignments within time. We will test this assumption in the next session when we ask for their feedback on this 3 part series.</p>
<p>Content-wise, the link between the non-deterministic test case example we gave and the ‘difficult to test’ example we referred to felt stretched. It would have been better to find a real example from our own code base, but ultimately this would have taken too long to present in a bite size format. We’ll cover that in the next session also.</p>
<p>This is now the 5th coding dojo that we’ve run in 8-10 weeks and it is starting to show, both in the team’s increasing ability and focus, but also in how smoothly the sessions are going.</p>
<p>Learning to start with the pain, and to also keep the scope of the dojos small and clear has been very valuable.</p>
	</div>
	
	</div></body></html>