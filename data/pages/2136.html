<html><body><div><div class="entry-content" itemprop="text"><p>dnspython provides a detailed interface into DNS. In its simplest form, it’s possible to perform queries in only a couple of lines of code. Here’s a commented example:</p>
<pre class="brush: python; title: ; notranslate" title="">
import dns.resolver #import the module
myResolver = dns.resolver.Resolver() #create a new instance named 'myResolver'
myAnswers = myResolver.query("google.com", "A") #Lookup the 'A' record(s) for google.com
for rdata in myAnswers: #for each response
    print rdata #print the data
</pre>
<p>The results in my case are:</p>
<pre class="brush: plain; title: ; notranslate" title="">
173.194.125.3
173.194.125.7
173.194.125.4
173.194.125.8
173.194.125.9
173.194.125.5
173.194.125.2
173.194.125.0
173.194.125.6
173.194.125.1
173.194.125.14
</pre>
<p><span id="more-2401"/><br/>
In the same way, we can perform MX and NS queries with:</p>
<pre class="brush: python; title: ; notranslate" title="">
myAnswers = myResolver.query("google.com", "MX")
</pre>
<p>and</p>
<pre class="brush: python; title: ; notranslate" title="">
myAnswers = myResolver.query("google.com", "NS")
</pre>
<p>We can easily look up TXT records, which will contain SPF records for a domain if present:</p>
<pre class="brush: python; title: ; notranslate" title="">
myAnswers = myResolver.query("iodigitalsec.com", "TXT")
</pre>
<p>Which results in:</p>
<pre class="brush: plain; title: ; notranslate" title="">
"v=spf1 mx a ptr ip4:148.251.196.144/28 ip4:85.10.227.160/28 ip4:85.10.227.160/28 ~all"
</pre>
<p>These are some of the more common types, however DNS is an expansive protocol and further information on query types can be found <a title="List of DNS Record Types" href="http://en.wikipedia.org/wiki/List_of_DNS_record_types" target="_blank">here</a>.</p>
<p>When it comes to reverse DNS (IP to hostname), it’s not as simple as performing an A record lookup on the IP address. We need to perform a PTR lookup instead, but not just on the IP address. The IP needs to be reversed, and have “.in-addr.arpa” appended to it.</p>
<p>To resolve the IP 173.194.125.3 to a hostname, we use the code:</p>
<pre class="brush: python; title: ; notranslate" title="">
myAnswers = myResolver.query("3.125.194.174.in-addr.arpa", "PTR")
</pre>
<p>We can handle the crafting of the request programatically as follows:</p>
<pre class="brush: python; title: ; notranslate" title="">
ip = "173.194.125.3"
req = '.'.join(reversed(ip.split("."))) + ".in-addr.arpa"
myAnswers = myResolver.query(req, "PTR")
</pre>
<p>The DNS resolver also gives us the option of specifying our own nameservers. This can be achieved by using:</p>
<pre class="brush: python; title: ; notranslate" title="">
myResolver = dns.resolver.Resolver()
myResolver.nameservers = ['8.8.8.8', '8.8.4.4']
</pre>
<p>Including an error catch, we can put the whole thing together with:</p>
<pre class="brush: python; title: ; notranslate" title="">
import dns.resolver

myResolver = dns.resolver.Resolver()
myResolver.nameservers = ['8.8.8.8', '8.8.4.4']

try:
        myAnswers = myResolver.query("google.com", "A")
        for rdata in myAnswers:
                print rdata
except:
        print "Query failed"
</pre>
<p>Now try and put together an application that performs command line DNS queries, i.e.:</p>
<pre class="brush: plain; title: ; notranslate" title="">
./pydnslookup.py A google.com
./pydnslookup.py MX msn.com
./pydnslookup.py PTR 8.8.8.8
</pre>
</div></div></body></html>