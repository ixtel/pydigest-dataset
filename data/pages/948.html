<html><body><div><div class="col-md-12">

            <header class="post-header">
                <h1 class="post-title">Introducing Silk, live profiling for Django</h1>

                <p class="post-meta">Jun 14, 2014</p>
            </header>
            <p>Silk is a live profiling and inspection tool for the Django framework. It:</p>

<ul>
  <li>Intercepts requests and responses, recording:
    <ul>
      <li>SQL Queries</li>
      <li>Response times</li>
      <li>Headers</li>
      <li>Bodies</li>
    </ul>
  </li>
  <li>Allows tracing of SQL queries via Python stack traces</li>
  <li>Profiles blocks of code and functions </li>
  <li>Generates code and commands for replaying requests</li>
</ul>

<p>A <a href="/silk">live demo</a> is actively profiling this site. The<br/>
github readme is currently acting as documentation and is available <a href="https://github.com/mtford90/silk">here</a>.</p>

<p>Silk releases can be downloaded from <a href="https://github.com/mtford90/silk/releases">here</a> or installed via pip into your virtualenv:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="lineno">1</span> pip install django-silk</code></pre></div>

<p>Below is a feature summary:</p>

<h2 id="request-inspection">Request Inspection</h2>

<p>The Silk middleware intercepts and stores requests and responses and stores them in the configured database.<br/>
These requests can then be filtered and inspected using Silk’s UI through the request overview:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/1.png"/></p>

<p>Further details on each request are also available by clicking the relevant request:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/2.png"/></p>

<h2 id="sql-inspection">SQL Inspection</h2>

<p>Silk also intercepts SQL queries that are generated by each request. We can get a summary on things like <br/>
the tables involved, number of joins and execution time:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/3.png"/></p>

<p>Before diving into the stack trace to figure out where this request is coming from:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/5.png"/></p>

<h2 id="profiling">Profiling</h2>

<p>Silk can also be used to profile random blocks of code/functions. It provides a decorator and a context<br/>
manager for this purpose. </p>

<p>For example:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">1</span> <span class="nd">@silk_profile</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'View Blog Post'</span><span class="p">)</span>
<span class="lineno">2</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>
<span class="lineno">3</span>     <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>
<span class="lineno">4</span>     <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">'post.html'</span><span class="p">,</span> <span class="p">{</span>
<span class="lineno">5</span>         <span class="s">'post'</span><span class="p">:</span> <span class="n">p</span>
<span class="lineno">6</span>     <span class="p">})</span></code></pre></div>

<p>Whenever a blog post is viewed we get an entry within the Silk UI:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/7.png"/></p>

<p>Silk profiling not only provides execution time, but also collects SQL queries executed within the block in the same fashion as with requests:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/8.png"/></p>

<p>Note that currently profiling does not occur outside of the request/response cycle.</p>

<h2 id="experimental-features">Experimental Features</h2>

<p>The below features are still in need of thorough testing and should be considered experimental.</p>

<h3 id="dynamic-profiling">Dynamic Profiling</h3>

<p>One of Silk’s more interesting features is dynamic profiling. If for example we wanted to profile a function in a dependency to which we only have read-only access (e.g. system python libraries owned by root) we can add the following to <code>settings.py</code> to apply a decorator at runtime:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">1</span> <span class="n">SILKY_DYNAMIC_PROFILING</span> <span class="o">=</span> <span class="p">[{</span>
<span class="lineno">2</span>     <span class="s">'module'</span><span class="p">:</span> <span class="s">'path.to.module'</span><span class="p">,</span>
<span class="lineno">3</span>     <span class="s">'function'</span><span class="p">:</span> <span class="s">'MyClass.bar'</span>
<span class="lineno">4</span> <span class="p">}]</span></code></pre></div>

<p>which is roughly equivalent to:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno">1</span> <span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">2</span>     <span class="nd">@silk_profile</span><span class="p">()</span>
<span class="lineno">3</span>     <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">4</span>         <span class="k">pass</span></code></pre></div>

<h3 id="code-generation">Code Generation</h3>

<p>Silk currently generates two bits of code per request:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/9.png"/></p>

<p>Both are intended for use in replaying the request. The curl command can be used to replay via command-line and the python code can be used within a Django unit test or simply as a standalone script.</p>

        </div>
    </div></body></html>