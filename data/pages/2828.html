<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_animated.gif"><img class="aligncenter wp-image-1716" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_animated.gif" alt="Find distance from camera to object using Python and OpenCV"/></a></p>
<p>A couple of days ago, Cameron, a PyImageSearch reader emailed in and asked about methods to find the distance from a camera to an object/marker in an image. He had spent some time researching, but hadn’t found an implementation.</p>
<p>I knew exactly how Cameron felt. Years ago I was working on a small project to analyze the movement of a baseball as it left the pitcher’s hand and headed for home plate.</p>
<p>Using motion analysis and trajectory-based tracking I was able to find/estimate the ball location in the frame of the video. And since a baseball has a known size, I was also able to estimate the distance to home plate.</p>
<p>It was an interesting project to work on, although the system was not as accurate as I wanted it to be — the “motion blur” of the ball moving so fast made it hard to obtain highly accurate estimates.</p>
<p>My project was definitely an “outlier” situation, but in general, determining the distance from a camera to a marker is actually a very well studied problem in the computer vision/image processing space. You can find techniques that are very straightforward and succinct like the triangle similarity. And you can find methods that are complex (albeit, more accurate) using the intrinsic parameters of the camera model.</p>
<p>In this blog post I’ll show you how Cameron and I came up with a solution to compute the distance from our camera to a known object or marker.</p>
<p>Definitely give this post a read — you won’t want to miss it!</p>

<p><strong>OpenCV and Python versions:</strong><br/>
This example will run on<strong> Python 2.7/Python 3.4+</strong> and <strong>OpenCV 2.4.X</strong>.</p>
<h1>Triangle Similarity for Object/Marker to Camera Distance</h1>
<p>In order to determine the distance from our camera to a known object or marker, we are going to utilize <em>triangle similarity</em>.</p>
<p>The triangle similarity goes something like this: Let’s say we have a marker or object with a known width <em>W</em>. We then place this marker some distance <em>D</em> from our camera. We take a picture of our object using our camera and then measure the apparent width in pixels <em>P</em>. This allows us to derive the perceived focal length <em>F</em> of our camera:</p>
<p><em>F = (P x  D) / W</em></p>
<p>For example, let’s say I place a standard piece of <em>8.5 x 11in</em> piece of paper (horizontally; <em>W = 11</em>) <em>D = 24 inches</em> in front of my camera and take a photo. When I measure the width of the piece of paper in the image, I notice that the perceived width of the paper is <em>P = 249 pixels</em>.</p>
<p>My focal length <em>F</em> is then:</p>
<p><em>F = (248px x 24in) / 11in = 543.45</em></p>
<p>As I continue to move my camera both closer and farther away from the object/marker, I can apply the triangle similarity to determine the distance of the object to the camera:</p>
<p><em>D’ = (W x F) / P</em></p>
<p>Again, to make this more concrete, let’s say I move my camera <i>3 ft </i>(or 36 inches) away from my marker and take a photo of the same piece of paper. Through automatic image processing I am able to determine that the perceived width of the piece of paper is now <em>170 pixels</em>. Plugging this into the equation we now get:</p>
<p><em>D’ = (11in x 543.45) / 170 = 35in</em></p>
<p>Or roughly 36 inches, which is 3 feet.</p>
<p><em><strong>Note:</strong> When I captured the photos for this example my tape measure had a bit of slack in it and thus the results are off by roughly 1 inch. Furthermore, I also captured the photos hastily and not 100% on top of the feet markers on the tape measure, which added to the 1 inch error. That all said, the triangle similarity still holds and you can use this method to compute the distance from an object or marker to your camera quite easily.</em></p>
<p>Make sense now?</p>
<p>Awesome. Let’s move into some code to see how finding the distance from your camera to an object or marker is done using Python, OpenCV, and image processing and computer vision techniques.</p>
<h1>Finding the distance from your camera to object/marker using Python and OpenCV</h1>
<p>Let’s go ahead and get this project started. Open up a new file, name it 
			<span id="crayon-56d59168863a0283461593" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">distance_to_camera</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and we’ll get to work.</p>

		<div id="crayon-56d59168863ac534866929" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59168863ac534866929-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-2">2</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-4">4</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-6">6</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-8">8</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-10">10</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-12">12</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-14">14</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863ac534866929-16">16</p><p class="crayon-num" data-line="crayon-56d59168863ac534866929-17">17</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59168863ac534866929-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line" id="crayon-56d59168863ac534866929-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-4"> </p><p class="crayon-line" id="crayon-56d59168863ac534866929-5"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">find_marker</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-6"><span class="crayon-h">	</span><span class="crayon-c"># convert the image to grayscale, blur it, and detect edges</span></p><p class="crayon-line" id="crayon-56d59168863ac534866929-7"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-8"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">GaussianBlur</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863ac534866929-9"><span class="crayon-h">	</span><span class="crayon-v">edged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Canny</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">35</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">125</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-10"> </p><p class="crayon-line" id="crayon-56d59168863ac534866929-11"><span class="crayon-h">	</span><span class="crayon-c"># find the contours in the edged image and keep the largest one;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-12"><span class="crayon-h">	</span><span class="crayon-c"># we'll assume that this is our piece of paper in the image</span></p><p class="crayon-line" id="crayon-56d59168863ac534866929-13"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">findContours</span><span class="crayon-sy">(</span><span class="crayon-v">edged</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">RETR_LIST</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CHAIN_APPROX_SIMPLE</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-14"><span class="crayon-h">	</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">max</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">contourArea</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863ac534866929-15"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863ac534866929-16"><span class="crayon-h">	</span><span class="crayon-c"># compute the bounding box of the of the paper region and return it</span></p><p class="crayon-line" id="crayon-56d59168863ac534866929-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">minAreaRect</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The first thing we’ll do is import our necessary packages. We’ll use NumPy for numerical processing and 
			<span id="crayon-56d59168863b1289161520" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span></span></span>  for our OpenCV bindings.</p>
<p>From there we define our 
			<span id="crayon-56d59168863b5068738291" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">find_marker</span></span></span>  function. This function accepts a single argument, 
			<span id="crayon-56d59168863b9749166588" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">image</span></span></span> , and is meant to be utilized to find the object we want to compute the distance to.</p>
<p><strong>In this case we are using a standard piece of 8.5 x 11 inch piece of paper as our marker.</strong></p>
<p>Our first task is to now find this piece of paper in the image.</p>
<p>To to do this, we’ll convert the image to grayscale, blur it slightly to remove high frequency noise, and apply edge detection on <strong>Lines 7-9</strong>.</p>
<p>After applying these steps our image should look something like this:</p>
<div id="attachment_1708" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_edged.jpg"><img class="wp-image-1708" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_edged.jpg" alt="Figure 1: Applying edge detection to find our marker, which in this case is a piece of paper."/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Applying edge detection to find our marker, which in this case is a piece of paper.</p></div>
<p>As you can see, the edges of our marker (the piece of paper) have clearly been reveled. Now all we need to do is find the contour (i.e. outline) that represents the piece of paper.</p>
<p>We find our marker on <strong>Line 13</strong> by using the 
			<span id="crayon-56d59168863bd532924572" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">findContours</span></span></span> function and then determining the contour with the largest area on <strong>Line 14</strong>.</p>
<p><strong>We are making the assumption that the contour with the largest area is our piece of paper.</strong> This assumption works for this particular example, but in reality <em>finding the marker in an image is highly application specific.</em></p>
<p>In our example, simple edge detection and finding the largest contour works well. We could also make this example more robust by applying contour approximation, discarding any contours that do not have 4 points (since a piece of paper is a rectangle and thus has 4 points), and then finding the largest 4-point contour.</p>
<p><em><strong>Note:</strong> More on this methodology can be found in <a title="How to Build a Kick-Ass Mobile Document Scanner in Just 5 Minutes" href="http://www.pyimagesearch.com/2014/09/01/build-kick-ass-mobile-document-scanner-just-5-minutes/" target="_blank">this post</a> on building a kick-ass mobile document scanner.</em></p>
<p>Other alternatives to finding markers in images is to utilize color, such that the color of the marker is substantially different from the rest of the scene in the image. You could also apply methods like keypoint detection, local invariant descriptors, and keypoint matching to find markers; however, these approaches are outside the scope of this article and are again, highly application specific.</p>
<p>Anyway, now that we have the contour that corresponds to our marker, we return the bounding box which contains the <em>(x, y)</em>-coordinates and width and height of the box (in pixels) to the calling function on <strong>Line 17</strong>.</p>
<p>Let’s also quickly to define a function that computes the distance to an object using the triangle similarity detailed above:</p>

		<div id="crayon-56d59168863c2933780758" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59168863c2933780758-19"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">distance_to_camera</span><span class="crayon-sy">(</span><span class="crayon-v">knownWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">focalLength</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">perWidth</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863c2933780758-20"><span class="crayon-h">	</span><span class="crayon-c"># compute and return the distance from the maker to the camera</span></p><p class="crayon-line" id="crayon-56d59168863c2933780758-21"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">knownWidth</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">focalLength</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">perWidth</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This function takes a 
			<span id="crayon-56d59168863c6141368326" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">knownWidth</span></span></span> of the marker, a computed 
			<span id="crayon-56d59168863ca281022444" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">focalLength</span></span></span> , and perceived width of an object in an image (measured in pixels), and applies the triangle similarity detailed above to compute the actual distance to the object.</p>
<p>To see how we utilize these functions, continue reading:</p>

		<div id="crayon-56d59168863cd573453102" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59168863cd573453102-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-2">2</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-4">4</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-6">6</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-8">8</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-10">10</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-12">12</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-14">14</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-16">16</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-18">18</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-20">20</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-22">22</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-24">24</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-26">26</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-28">28</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-30">30</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-32">32</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-34">34</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-36">36</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863cd573453102-38">38</p><p class="crayon-num" data-line="crayon-56d59168863cd573453102-39">39</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59168863cd573453102-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-4"> </p><p class="crayon-line" id="crayon-56d59168863cd573453102-5"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">find_marker</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-6"><span class="crayon-h">	</span><span class="crayon-c"># convert the image to grayscale, blur it, and detect edges</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-7"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-8"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">GaussianBlur</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-9"><span class="crayon-h">	</span><span class="crayon-v">edged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Canny</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">35</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">125</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-10"> </p><p class="crayon-line" id="crayon-56d59168863cd573453102-11"><span class="crayon-h">	</span><span class="crayon-c"># find the contours in the edged image and keep the largest one;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-12"><span class="crayon-h">	</span><span class="crayon-c"># we'll assume that this is our piece of paper in the image</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-13"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">findContours</span><span class="crayon-sy">(</span><span class="crayon-v">edged</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">RETR_LIST</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CHAIN_APPROX_SIMPLE</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-14"><span class="crayon-h">	</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">max</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">contourArea</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-15"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-16"><span class="crayon-h">	</span><span class="crayon-c"># compute the bounding box of the of the paper region and return it</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">minAreaRect</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-18"> </p><p class="crayon-line" id="crayon-56d59168863cd573453102-19"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">distance_to_camera</span><span class="crayon-sy">(</span><span class="crayon-v">knownWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">focalLength</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">perWidth</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-20"><span class="crayon-h">	</span><span class="crayon-c"># compute and return the distance from the maker to the camera</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-21"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">knownWidth</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">focalLength</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">perWidth</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-22"> </p><p class="crayon-line" id="crayon-56d59168863cd573453102-23"><span class="crayon-c"># initialize the known distance from the camera to the object, which</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-24"><span class="crayon-c"># in this case is 24 inches</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-25"><span class="crayon-v">KNOWN_DISTANCE</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">24.0</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-26"> </p><p class="crayon-line" id="crayon-56d59168863cd573453102-27"><span class="crayon-c"># initialize the known object width, which in this case, the piece of</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-28"><span class="crayon-c"># paper is 11 inches wide</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-29"><span class="crayon-v">KNOWN_WIDTH</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">11.0</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-30"> </p><p class="crayon-line" id="crayon-56d59168863cd573453102-31"><span class="crayon-c"># initialize the list of images that we'll be using</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-32"><span class="crayon-v">IMAGE_PATHS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">"images/2ft.png"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"images/3ft.png"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"images/4ft.png"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-33"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-34"><span class="crayon-c"># load the furst image that contains an object that is KNOWN TO BE 2 feet</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-35"><span class="crayon-c"># from our camera, then find the paper marker in the image, and initialize</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-36"><span class="crayon-c"># the focal length</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-37"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">IMAGE_PATHS</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863cd573453102-38"><span class="crayon-v">marker</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">find_marker</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863cd573453102-39"><span class="crayon-v">focalLength</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">marker</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">KNOWN_DISTANCE</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">KNOWN_WIDTH</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The first step to finding the distance to an object or marker in an image is to <i>calibrate</i> and <i>compute the focal length</i>. To do this, we need to know:</p>
<ul>
<li>The distance of the camera from an object.</li>
<li>The width (in units such as inches, meters, etc.) of this object. <em>Note: </em>The height could also be utilized, but this example simply uses the width.</li>
</ul>
<p>Let’s also take a second and mention that what we are doing <em>is not true camera calibration</em>. True camera calibration involves the intrinsic parameters of the camera, which you can read more on <a href="http://www.vision.caltech.edu/bouguetj/calib_doc/htmls/parameters.html" target="_blank">here</a>.</p>
<p>On <strong>Line 25</strong> we initialize our known 
			<span id="crayon-56d59168863d3933635223" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KNOWN_DISTANCE</span></span></span>  from the camera to our object to be 24 inches. And on <strong>Line 29</strong> we initialize the 
			<span id="crayon-56d59168863d6110674124" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KNOWN_WIDTH</span></span></span>  of the object to be 11 inches (i.e. a standard 8.5 x 11 inch piece of paper laid out horizontally).</p>
<p>We then define the paths to our images we are going to use on <strong>Line 32</strong>.</p>
<p>The next step is important: <em><strong>it’s our simple calibration step.</strong></em></p>
<p>We load the first image off disk on <strong>Line 37 </strong>— we’ll be using this image as our calibration image.</p>
<p>Once the image is loaded, we find the piece of paper in the image on <strong>Line 38</strong>, and then compute our 
			<span id="crayon-56d59168863da852754656" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">focalLength</span></span></span>  on <strong>Line 39 </strong>using the triangle similarity.</p>
<p>Now that we have “calibrated” our system and have the 
			<span id="crayon-56d59168863de950329425" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">focalLength</span></span></span> , we can compute the distance from our camera to our marker in subsequent images quite easily.</p>
<p>Let’s see how this is done:</p>

		<div id="crayon-56d59168863e2006717693" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59168863e2006717693-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-42">42</p><p class="crayon-num" data-line="crayon-56d59168863e2006717693-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-44">44</p><p class="crayon-num" data-line="crayon-56d59168863e2006717693-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-46">46</p><p class="crayon-num" data-line="crayon-56d59168863e2006717693-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-48">48</p><p class="crayon-num" data-line="crayon-56d59168863e2006717693-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-50">50</p><p class="crayon-num" data-line="crayon-56d59168863e2006717693-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-52">52</p><p class="crayon-num" data-line="crayon-56d59168863e2006717693-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-54">54</p><p class="crayon-num" data-line="crayon-56d59168863e2006717693-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59168863e2006717693-56">56</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59168863e2006717693-41"><span class="crayon-c"># loop over the images</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-42"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">imagePath </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">IMAGE_PATHS</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59168863e2006717693-43"><span class="crayon-h">	</span><span class="crayon-c"># load the image, find the marker in the image, then compute the</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-44"><span class="crayon-h">	</span><span class="crayon-c"># distance to the marker from the camera</span></p><p class="crayon-line" id="crayon-56d59168863e2006717693-45"><span class="crayon-h">	</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">imagePath</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-46"><span class="crayon-h">	</span><span class="crayon-v">marker</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">find_marker</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863e2006717693-47"><span class="crayon-h">	</span><span class="crayon-v">inches</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">distance_to_camera</span><span class="crayon-sy">(</span><span class="crayon-v">KNOWN_WIDTH</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">focalLength</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-48"> </p><p class="crayon-line" id="crayon-56d59168863e2006717693-49"><span class="crayon-h">	</span><span class="crayon-c"># draw a bounding box around the image and display it</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-50"><span class="crayon-h">	</span><span class="crayon-v">box</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">int0</span><span class="crayon-sy">(</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">cv</span><span class="crayon-sy">.</span><span class="crayon-e">BoxPoints</span><span class="crayon-sy">(</span><span class="crayon-v">marker</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863e2006717693-51"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">drawContours</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">box</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-52"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">putText</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"%.2fft"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">inches</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59168863e2006717693-53"><span class="crayon-h">		</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">FONT_HERSHEY_SIMPLEX</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-54"><span class="crayon-h">		</span><span class="crayon-cn">2.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59168863e2006717693-55"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59168863e2006717693-56"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start looping over our image paths on <strong>Line 42</strong>.</p>
<p>Then, for each image in the list, we load the image off disk on <strong>Line 45</strong>, find the marker in the image on <strong>Line 46,</strong> and then compute the distance of the object to the camera on <strong>Line 47</strong>.</p>
<p>From there, we simply draw the bounding box around our marker and display the distance on <strong>Lines 50-56</strong>.</p>
<h1>Results</h1>
<p>To see our script in action, open up a terminal, navigate to your code directory, and execute the following command:</p>

		<div id="crayon-56d59168863e7274898351" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59168863e7274898351-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">distance_to_camera</span><span class="crayon-e">.py</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>If all goes well you should first see the results of 
			<span id="crayon-56d59168863eb473519810" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-cn">2ft.png</span></span></span> , which is the image we use to “calibrate” our system and compute our initial 
			<span id="crayon-56d59168863ef835758204" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">focalLength</span></span></span> :</p>
<div id="attachment_1709" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_2ft.jpg"><img class="wp-image-1709" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_2ft.jpg" alt="Figure 2: This image is used to compute the initial focal length of the system. We start by utilizing the known width of the object/marker in the image and the known distance to the object."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> This image is used to compute the initial focal length of the system. We start by utilizing the known width of the object/marker in the image and the known distance to the object.</p></div>
<p>From the above image we can see that our focal length is properly determined and the distance to the piece of paper is 2 feet, per the 
			<span id="crayon-56d59168863f3088999636" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KNOWN_DISTANCE</span></span></span>  and 
			<span id="crayon-56d59168863f7670906318" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KNOWN_WIDTH</span></span></span>  variables in the code.</p>
<p>Now that we have our focal length, we can compute the distance to our marker in subsequent images:</p>
<div id="attachment_1710" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_3ft.jpg"><img class="wp-image-1710" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_3ft.jpg" alt="Figure 3: Utilizing the focal length to determine that our piece of paper marker is roughly 3 feet from our camera."/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Utilizing the focal length to determine that our piece of paper marker is roughly 3 feet from our camera.</p></div>
<p>In above example our camera is now approximate 3 feet from the marker.</p>
<p>Let’s try moving back another foot:</p>
<div id="attachment_1711" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_4ft.jpg"><img class="wp-image-1711" src="http://www.pyimagesearch.com/wp-content/uploads/2014/12/distance_to_camera_4ft.jpg" alt="Utilizing the computed focal length to determine w are roughly 4 feet from our marker."/></a><p class="wp-caption-text"><strong>Figure 4:</strong> Utilizing the computed focal length to determine our camera is roughly 4 feet from our marker.</p></div>
<p>Again, it’s important to note that when I captured the photos for this example I did so hastily and left too much slack in the tape measure. Furthermore, I also did not ensure my camera was 100% lined up on the foot markers, so again, there is roughly 1 inch error in these examples.</p>
<p>That all said, the triangle similarity approach detailed in this article will still work and allow you to find the distance from an object or marker in an image to your camera.</p>
<h1>Summary</h1>
<p>In this blog post we learned how to determine the distance from a <em>known object</em> in an image to our camera.</p>
<p>To accomplish this task we utilized the <em>triangle similarity</em>, which requires us to know two important parameters prior to applying our algorithm:</p>
<ol>
<li>The <em>width (or height)</em> in some distance measure, such as inches or meters, of the object we are using as a marker.</li>
<li>The <em>distance</em> (in inches or meters) of the camera to the marker in step 1.</li>
</ol>
<p>Computer vision and image processing algorithms can then be used to automatically determine the perceived width/height of the object in pixels and complete the triangle similarity and give us our focal length.</p>
<p>Then, in subsequent images we simply need to find our marker/object and utilize the computed focal length to determine the distance to the object from the camera.</p>
<h1 id="post_downloads">Downloads:</h1>

	</section>
	</div></body></html>