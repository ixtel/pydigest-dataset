<html><body><div><div class="entry-content">

                

                <p>Для работы с С-библиотеками есть несколько способов:
- Писать программу на С/C++ и подключать DLL (.so) файлы
- Попытаться напрямую запустить C код из нужного языка. </p>
<p>Перед тем как продолжить - зачем нужно запускать C/C++ код?
Все просто - например, работаем с железом, а значит и с драйверами (а их пишут на C). Вот здесь и появляется необходимость взаимодействовать с С кодом.</p>
<p>В Python есть несколько вариантов запуска С/C++ кода (без модификации исходного кода) - ctypes, cliff или даже swig.</p>
<p>Сейчас про SWIG. SWIG (simplified wrapper and interface generator) - это инструмент создания биндингов к различным языкам. </p>
<p>Работа со SWIG  проста и сложна одновременно. SWIG генерирует большинство кода за программиста. Поэтому необходимо сделать 2 основных шага:</p>
<p>1) Создать .i файл, в котором описать структуру C/C++-проекта (заголовочные файлы, файлы исходников, необходимые библиотеки)
2) Скомпилировать</p>
<p>Файл .i выглядит так (пример):</p>
<div class="highlight"><pre><span class="o">%</span><span class="n">module</span> <span class="n">WDMTNKv2</span>

<span class="o">%</span><span class="n">typemap</span><span class="p">(</span><span class="ow">in</span><span class="p">)</span> <span class="n">HANDLE</span> <span class="p">{</span>
<span class="err">$</span><span class="mi">1</span> <span class="o">=</span> <span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">PyInt_AsLong</span><span class="p">(</span><span class="err">$</span><span class="nb">input</span><span class="p">));</span>
<span class="p">}</span>

<span class="o">%</span><span class="n">typemap</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="n">HANDLE</span> <span class="p">{</span>
<span class="err">$</span><span class="n">result</span> <span class="o">=</span> <span class="n">PyInt_FromLong</span><span class="p">((</span><span class="nb">int</span><span class="p">)(</span><span class="err">$</span><span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>

<span class="o">%</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">windows</span><span class="o">.</span><span class="n">i</span><span class="o">&gt;</span>
<span class="o">%</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">carrays</span><span class="o">.</span><span class="n">i</span><span class="o">&gt;</span>
<span class="o">%</span><span class="n">array_class</span><span class="p">(</span><span class="n">unsigned</span> <span class="n">short</span> <span class="nb">int</span><span class="p">,</span> <span class="n">WordBuffer</span><span class="p">);</span>
<span class="o">%</span><span class="n">include</span> <span class="s2">"WDMTMKv2.h"</span>
</pre></div>


<p>А шаг компиляции может выглядеть так:</p>
<p>run.bat:</p>
<div class="highlight"><pre>python setup.py build_ext --inplace -cmingw32
</pre></div>


<p>setup.py:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">distutils</span>
<span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">Extension</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"MIL-STD-1553B"</span><span class="p">,</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">"4.08"</span><span class="p">,</span>
    <span class="n">ext_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">Extension</span><span class="p">(</span>
            <span class="s2">"_WDMTMKv2"</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">"WDMTMKv2.i"</span><span class="p">,</span> <span class="s2">"WDMTMKv2.cpp"</span><span class="p">],</span>
            <span class="n">swig_opts</span><span class="o">=</span><span class="p">[</span><span class="s1">'-py3'</span><span class="p">,</span> <span class="s1">'-c++'</span><span class="p">,</span> <span class="s1">'-module'</span><span class="p">,</span><span class="s1">'WDMTMKv2'</span><span class="p">],</span>
    <span class="p">)]</span>
<span class="p">)</span>
</pre></div>


<p>В результате получится <code>.pyd</code> файл, который используется как обычный python модуль:</p>
<p><code>from WDMTMKv2 import *</code></p>
<iframe src="https://www.youtube.com/embed/mv0kfiepn3s?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe>


            </div>
            
</div></body></html>