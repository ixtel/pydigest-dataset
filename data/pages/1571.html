<html><body><div><div class="content">
      
        <h1 class="content-title">The Case for Peewee: Small, Hackable and Fun</h1>
      
      
      
  <div class="post-info"><p>
    
    
      September 26, 2014 13:40
      </p><span class="separator">/</span>
      <a href="#comments">0 comments</a>
      <span class="separator">/</span>
      
        <a href="/blog/tags/peewee/">peewee</a>
      
        <a href="/blog/tags/python/">python</a>
      
        <a href="/blog/tags/thoughts/">thoughts</a>
      
    
  </div>
  
  
    <p><a href="http://media.charlesleifer.com/blog/photos/rock-crawler.jpg" title="photos/rock-crawler.jpg"><img alt="photos/rock-crawler.jpg" class="img-responsive" src="http://m.charlesleifer.com/t/800x-/blog/photos/rock-crawler.jpg?key=R6TAR1hNy54LG-eCvZfUjQ"/></a></p>
<p>SQLAlchemy is one of those tools that is so powerful and so well-established that it's
hard to imagine a time when it didn't exist. Mike Bayer, the project's primary author, after what
I'm sure was a lot of real-world experience, hit on the right amount of abstraction
and API that pleases both die-hard DBA types as well as more casual users.</p>
<p>So why would anyone use <a href="http://docs.peewee-orm.com/">peewee</a>?</p>
<h2>Solving different problems</h2>
<p>I often mentally compare SQLAlchemy with the relational database Postgresql. Postgresql comes with everything you
could want in an RDBMS, and is even adding features more commonly found in <a href="http://blogs.enterprisedb.com/2014/09/24/postgres-outperforms-mongodb-and-ushers-in-new-developer-reality/">popular non-relational databases</a>, such as the new
<a href="http://www.postgresql.org/docs/9.4/static/functions-json.html">jsonb functions</a> and
HStore. Postgresql is the go-to relational database in the communities I
follow (like <a href="http://reddit.com/r/programming">proggit</a> and <a href="http://news.ycombinator.com">haternews</a>).
And likewise, SQLAlchemy is the database toolkit loved most by serious Python developers.</p>
<p>I also think <a href="/blog/sqlite-small-fast-reliable-choose-any-three-/">SQLite is a fantastic database</a>. I mention SQLite because, on the surface, it seems comparable to Postgresql. After all, they're both
relational databases.</p>
<p>I think the similarity ends there, though. Postgresql is intended to solve a vastly
different set of problems than SQLite. D. Richard Hipp, the author of SQLite, gave
an <a href="https://www.youtube.com/watch?v=ZvmMzI0X7fE">awesome keynote</a>
at PGCon this year which outlines some of the differences between the libraries. Postgresql's
goal is to be the world's most advanced open-source database, while SQLite's goal is
to <a href="https://sqlite.org/whentouse.html">replace fopen()</a>. To put it another way, Postgresql
is like a swiss army knife, with lots of neat tools for various purposes, while SQLite is
like a scalpel. SQLite has a much more limited scope, and my feeling is that it's primary
strength lies in that focus.</p>
<p>SQLAlchemy is, in my mind, the swiss army knife of Python ORMs. I bet SQLAlchemy can handle
any query or relational structure you want to throw at it. Additionally, the unit of work
and identity-mapper patterns provide great performance and solve some problems you might
encounter when using an active-record ORM. Being built from the bottom-up, SQLAlchemy also
provides nice APIs no matter how near or far you want to be from SQL.</p>
<p>Peewee, as it's name indicates, is much (much) smaller in scope. The project's goal is to
provide composable, expressive, and predictable APIs for executing SQL queries and working
with tabular data. Peewee's APIs are very close to their SQL counterparts, and there is
only a thin layer of abstraction between the ORM code you write and the generated SQL. I
think peewee is attractive to developers who already know SQL and want an unobstrusive,
Pythonic way to use a relational database. It is my hope that peewee's simplicity is also
it's strength.</p>
<p>Architecturally, peewee is also different from SQLAlchemy. peewee follows the active-record
pattern which is also used by the Django ORM. Transactions are managed explicitly and by
default each connection runs in autocommit mode. Like Django and SQLAlchemy, peewee uses
declarative model classes with a variety of <a href="http://docs.peewee-orm.com/en/latest/peewee/models.html#field-types-table">field types</a>
exposed as class attributes. Unlike Django, peewee uses operator overloading to create
SQL expressions, e.g. <em>User.username == 'huey'</em>.</p>
<h3>Simplicity encourages hacking</h3>
<p><a href="http://media.charlesleifer.com/blog/photos/p1411744821.14.jpg" title="photos/p1411744821.14.jpg"><img alt="photos/p1411744821.14.jpg" class="img-responsive" src="http://m.charlesleifer.com/t/800x-/blog/photos/p1411744821.14.jpg?key=EekYiEsH39q90qrbaEgyLA"/></a></p>
<p>My father-in-law enjoys working on cars, and among other feats of engineering, he's rebuilt
a sweet 1960's mustang (painted Springtime Yellow). On several occasions I've heard him say
how the complexity of modern vehicles makes it almost impossible for amateur mechanics to
work on them. My brother has worked in the automotive field for about 6 years and he shares
this sentiment. His hobby is to turn old Toyota trucks into monster rock crawlers, and one
of the main reasons he prefers older model-years is because they're just easier to work on.
My step-father always preferred 2-stroke dirtbikes for the same reason.</p>
<p>Peewee tries to be, for developers, what a 1960's mustang is for my father-in-law: aesthetically
pleasing, a pleasure to use, and most importantly, something you can easily hack on.
If you need to look under-the-hood (sorry, horrible pun) at the source code, there is only a
single file to read. I've also worked very hard to create useful documentation for peewee, and
at the time I'm writing this, the <a href="https://readthedocs.org/projects/peewee/downloads/pdf/latest/">PDF version of the docs</a> is over 120 pages long!</p>
<p>The simplicity of peewee has proved itself useful time after time as I've added new features
and debugged problems. Even as the code-base has doubled in size since the 2.0 release two
years ago (which was a complete rewrite), the APIs have, if anything, become more simple.
The call stack is never more than a few calls deep, and the objects interact in predictable
ways. <a href="http://radon.readthedocs.org/en/latest/intro.html">radon</a>, a tool that measures the
cyclomatic complexity of Python code, gave peewee an "A", with an average complexity of 2.43.
Here is the list of functions whose complexity is C or worse (where "C" means <em>moderate - slightly complex block</em>):</p>
<div class="highlight"><pre>$ radon cc peewee.py --total-average -nc
peewee.py
    C 3349:0 BaseModel - D
    M 3353:4 BaseModel.__new__ - D
    M 2004:4 AggregateQueryResultWrapper.iterate - D
    M 1490:4 QueryCompiler.generate_select - C
    C 1796:0 ExtQueryResultWrapper - C
    M 1797:4 ExtQueryResultWrapper.initialize - C
    M 1579:4 QueryCompiler.generate_insert - C
    M 2182:4 Query.filter - C

<span class="m">474</span> blocks <span class="o">(</span>classes, functions, methods<span class="o">)</span> analyzed.
Average complexity: A <span class="o">(</span>2.42616033755<span class="o">)</span>
</pre></div>
<p>I then used <code>radon</code> once more to measure the lines of source code in each project. Peewee
and the playhouse extension modules weighed in at just over 6,000 SLOC, which is hopefully
small enough to allow folks to dive in and come away with an understanding of the library
in an hour or two.</p>
<h2>Have fun out there</h2>
<p>More than anything, I want peewee to be fun to use. Because it's so easy to get up and running with peewee, I've found that I'm much more eager to write little scripts or micro-services to solve day-to-day problems. I've written
a <a href="/blog/saturday-morning-hack-a-little-note-taking-app-with-flask/">note-taking app</a>
that I couldn't function without, a <a href="/blog/saturday-morning-hack-personalized-news-digest-with-boolean-query-parser/">personalized news feed</a>,
a <a href="/blog/creating-a-personal-password-manager/">lastpass-style password manager</a>, and many more
<a href="/blog/dont-sweat-small-stuff-use-flask-blueprints/">fun little apps</a>. Peewee also is great
for doing data analysis -- I've thrown server logs into peewee, <a href="/blog/using-peewee-to-explore-csv-files/">used peewee to explore CSV files</a>,
and other projects. In short, I really enjoy using peewee and hope you will, too.</p>
<h4>Competition encourages innovation</h4>
<p>Even if you never use peewee, it's my hope that the Python community overall benefits from
diversity in the selection of ORM libraries. A little competition forces everyone to step
their game up, and I also think it's good to force the end-users to think critically about
the choice they make in third-party libraries. <a href="http://ponyorm.com/">Pony ORM</a> is another ORM
to come out recently. Pony uses bytecode decompilation to turn Python generator expressions into SQL, an approach that I think is as brilliant as it is crazy! If you're interested in checking
out a comparison of some various Python ORMs, <a href="https://github.com/sloria/PythonORMSleepy">this project</a>
contains the same "Hello world" Flask app written using some of the most popular database libraries.</p>
<h3>Links</h3>
<p>Thanks for taking the time to read this post, please feel free to <a href="#comments">leave a comment</a> or <a href="/contact/">contact me</a>.</p>

<p>Most importantly, <strong>happy hacking!</strong></p>
  
  


<hr/>

  <p>Commenting has been closed, but please feel free to <a href="/contact/">contact me</a></p>


    </div>

    </div></body></html>