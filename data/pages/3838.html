<html><body><div><div class="right_panel">
    <a href="/blog/2015/03/getting-started-with-redis-py/" class="noline"><h1 class="post_title" itemprop="headline">Getting started with redis-py</h1></a>
    
    
      <p/><p>This post explains how to interface with Redis from Python and how to use different Redis commands from Python using redis-py.</p>
<p>What this post is not about</p>
<ul>
<li>Comparing relational and non-relational database</li>
<li>Comparing MySQL and Redis</li>
<li>Introduction to Redis</li>
</ul>
<p>I assume you know the following</p>
<ul>
<li>Basics of Redis</li>
<li>Basic redis commands for working with Strings, Lists and Maps as described at <a href="http://redis.io/topics/data-types-intro" target="_blank">Redis docs</a>.</li>
</ul>
<p>I did not find enough examples of using redis-py provided methods and so wrote this blog post.</p>
<h3>Getting started</h3>
<p>Assuming you have Redis installed and your redis server is running.</p>
<p>We will follow the same sequence as followed in Redis data-types-intro at <a href="http://redis.io/topics/data-types-intro" target="_blank">Redis docs</a></p>
<p>Install redis-py</p>



<p>Start redis-cli on some shell, so we can relate our Python redis commands and plain redis command.</p>
<h4>Redis strings</h4>
<p>For setting a string value, we use the following from redis-cli</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">set</span> <span class="n">mykey</span> <span class="n">myvalue</span>
</pre></div>


<p>And you can get it using</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">mykey</span>
<span class="s">"myvalue"</span>
</pre></div>


<p>Now we want to do the same from Python. Do the following from Python shell.</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">import</span> <span class="n">redis</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">StrictRedis</span><span class="p">()</span>
</pre></div>


<p>We created an instance of <strong>StrictRedis</strong>. This is required for communication with redis-server.</p>
<p>Try getting "mykey", which was set using redis-cli, from Python</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"mykey"</span><span class="p">)</span>
<span class="err">'</span><span class="n">myvalue</span><span class="err">'</span>   <span class="err">#</span><span class="n">output</span>
</pre></div>


<p>So we are able to communicate properly with redis-server. Things which were inserted into redis using redis-cli can be read using Python.</p>
<p>Try setting a value into Redis from Python shell.</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">"anotherkey"</span><span class="p">,</span> <span class="s">"anothervalue"</span><span class="p">)</span>
<span class="n">True</span>       <span class="err">#</span><span class="n">output</span>
</pre></div>


<p>Check from redis-cli if this key was set properly.</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">anotherkey</span>
<span class="s">"anothervalue"</span>
</pre></div>


<p>So it seems Python is able to insert values into Redis properly.</p>
<p>You can read the same value using Python again.</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"anotherkey"</span><span class="p">)</span>
<span class="err">'</span><span class="n">anothervalue</span><span class="err">'</span>
</pre></div>


<h4>INCR and INCRBY</h4>
<p>Redis provides <strong>incr</strong> and <strong>incrby</strong> on integer values.</p>
<p>So let's set an integer value first which we will try to increment.</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">"num"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"num"</span><span class="p">)</span>
<span class="err">'</span><span class="mi">10</span><span class="err">'</span>
</pre></div>


<p>redis-py's equivalent of Redis' <strong>incr</strong> is</p>



<p>Get it to verify that num has been incremented</p>



<p>You should verify it using redis-cli too.</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">num</span>
<span class="s">"11"</span>
</pre></div>


<p>Python's equivalent of <strong>incrby</strong> is</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">incrby</span><span class="p">(</span><span class="s">"num"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">21</span>
</pre></div>


<p>Verify again using redis-cli</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">num</span>
<span class="s">"21"</span>
</pre></div>


<h4>MSET and MGET</h4>
<p>redis-cli's mset equivalent in Python</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">mset</span><span class="p">(</span><span class="n">first_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">second_num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">third_num</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">True</span>
</pre></div>


<p>Verify these keys are set from redis-cli</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">first_num</span>
<span class="s">"1"</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">second_num</span>
<span class="s">"2"</span>
</pre></div>


<p>reidis' mget equivalent</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">mget</span><span class="p">([</span><span class="s">"first_num"</span><span class="p">,</span> <span class="s">"second_num"</span><span class="p">])</span>
<span class="p">[</span><span class="sc">'1'</span><span class="p">,</span> <span class="sc">'2'</span><span class="p">]</span>
</pre></div>


<h4>EXISTS</h4>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">"first_num"</span><span class="p">)</span>
<span class="n">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">"fourth_num"</span><span class="p">)</span>
<span class="n">False</span>
</pre></div>


<h4>DEL</h4>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="s">"first_num"</span><span class="p">)</span>
<span class="mi">1</span>
</pre></div>


<p>As this key is deleted now, you will get "nil" and "None" if you try to retrieve it.</p>
<p>From redis-cli</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">first_num</span>
<span class="p">(</span><span class="n">nil</span><span class="p">)</span>
</pre></div>


<p>From Python shell</p>



<h4>EXPIRE</h4>
<p>Mark key <strong>second_num</strong> to expire after 10 seconds</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">expire</span><span class="p">(</span><span class="s">"second_num"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">True</span>
</pre></div>


<p>Check this immediately</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"second_num"</span><span class="p">)</span>
<span class="sc">'2'</span>     <span class="err">#</span><span class="n">output</span>
</pre></div>


<p>Check after 10 seconds</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"second_num"</span><span class="p">)</span>
<span class="n">It</span> <span class="n">returns</span> <span class="n">None</span> <span class="n">after</span> <span class="mi">10</span> <span class="n">seconds</span> <span class="n">meaning</span> <span class="n">this</span> <span class="n">key</span> <span class="n">doesn</span><span class="err">'</span><span class="n">t</span> <span class="n">exist</span> <span class="n">in</span> <span class="n">redis</span> <span class="n">anymore</span>
</pre></div>


<h4>Redis Lists</h4>
<p>reidis' lpush equivalent in Python</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">lpush</span><span class="p">(</span><span class="s">"mylist"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="mi">1L</span>
</pre></div>


<p>Verify from redis-cli that a list is created in redis</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">lrange</span> <span class="n">mylist</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">"1"</span>
</pre></div>


<p>Pushing multiple values to list</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">lpush</span><span class="p">(</span><span class="s">"mylist"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>Check the new list from redis-cli</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">lrange</span> <span class="n">mylist</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">"3"</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">"2"</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">"1"</span>
</pre></div>


<p>redis-cli's lrange equivalent in Python</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">lrange</span><span class="p">(</span><span class="s">"mylist"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="sc">'3'</span><span class="p">,</span> <span class="sc">'2'</span><span class="p">,</span> <span class="sc">'1'</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">lrange</span><span class="p">(</span><span class="s">"mylist"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="sc">'3'</span><span class="p">,</span> <span class="sc">'2'</span><span class="p">]</span>
</pre></div>


<p>rpush</p>



<p>Check that element is pushed on right</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">lrange</span><span class="p">(</span><span class="s">"mylist"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="sc">'3'</span><span class="p">,</span> <span class="sc">'2'</span><span class="p">,</span> <span class="sc">'1'</span><span class="p">,</span> <span class="sc">'4'</span><span class="p">]</span>
</pre></div>


<h4>Redis hashes</h4>
<p>hmset allows saving of dictionary as values. You should already be knowing this from redis docs.</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">hmset</span> <span class="n">user</span> <span class="n">name</span> <span class="n">ned</span> <span class="n">age</span> <span class="mi">31</span>
<span class="n">OK</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">hgetall</span> <span class="n">user</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">"name"</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">"ned"</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">"age"</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">"31"</span>
</pre></div>


<p>redis-py way of achieving the same would be</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">hmset</span><span class="p">(</span><span class="s">"another_user"</span><span class="p">,</span> <span class="p">{</span><span class="err">'</span><span class="n">name</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="n">robert</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">age</span><span class="err">'</span><span class="o">:</span> <span class="mi">32</span><span class="p">})</span>
<span class="n">True</span>
</pre></div>


<p>Try reading this using redis-cli</p>
<div class="highlight"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">hgetall</span> <span class="n">another_user</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">"age"</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">"32"</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">"name"</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">"robert"</span>
</pre></div>


<p>Try reading this using redis-py</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">hgetall</span><span class="p">(</span><span class="s">"another_user"</span><span class="p">)</span>
<span class="p">{</span><span class="err">'</span><span class="n">age</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="mi">32</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">name</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="n">robert</span><span class="err">'</span><span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">hget</span><span class="p">(</span><span class="s">"another_user"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">)</span>
<span class="err">'</span><span class="n">robert</span><span class="err">'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">hget</span><span class="p">(</span><span class="s">"another_user"</span><span class="p">,</span> <span class="s">"age"</span><span class="p">)</span>
<span class="err">'</span><span class="mi">32</span><span class="err">'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">hgetall</span><span class="p">(</span><span class="s">"user"</span><span class="p">)</span>
<span class="p">{</span><span class="err">'</span><span class="n">age</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="mi">31</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">name</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="n">ned</span><span class="err">'</span><span class="p">}</span>
</pre></div>


<p>There are several other methods provided by redis-py too and now you should be in a good position to related redis' commands with redis-py methods.</p>

      
          <hr/>
          
      

      
      
        <h4>Related Posts</h4>
        
      

      <hr/>
      <p>Can we help you build amazing apps? <a href="/contactus">Contact us today.</a>
    
    </p> 


  </div>
</div></body></html>