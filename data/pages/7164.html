<html><body><div><div>
<p><a href="http://www.sympy.org/en/">SymPy</a> - это обширный Python модуль реализующий <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D0%BC%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%B2%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F">символные вычисления</a>. В качестве примера будет разобрана реальная математическая задача.
<a name="more"/>
</p><p>Суть задачи:
</p><p class="python">
Дана окружность радиусом <i>r</i> с координатами центра в точке (<i>x<sub>0</sub></i>, <i>y<sub>0</sub></i>). Также дана точка с координатами (<i>x<sub>1</sub></i>, <i>y<sub>1</sub></i>). Необходимо провести лучи из центра окружности, проходящие через точку пересечения окружности и касательных. Все элементы задачи находятся на одной плоскости.
</p>
<p>Задача составная, поэтому разделим ее на логически отделенные части, решающие наиболее важные асппекты: 1) нахождение касательных 2)нахождение точек пересечения касательной и окружности. После каждой части будет приведен фрагмент кода, подкрепленный комментариями.
</p><h2>Часть 1. Нахождение касательных</h2>
<p>Для начала решим задачу в общем виде. Запишем математическое выражение окружности и касательной в виде системы уравнений:

</p>

<p>На два уравнения приходится три неизвестных (<i>x</i>,<i>y</i>,<i>k</i>), с математической точки зрения система имеет множество решений, однако далее мы введем условие, которое разрешит данное положение. Из уравнения прямой выразим <i>y</i>:

</p>

<p>И подставим в уравнение окружности, далее, обобщив, получим квадратное уравнение:

</p>

<p>По определению касательная и окружность имеют только одну точку пересечения. Это возможно только в случае, если квадратное уравнение имеет 1  корень. По определению квадратного уравнения оно имеет 1 корень в случае, если дискриминант равен нулю:

</p>

<p>Решая полученное уравнение получаем несколько значений <i>k<sub>1</sub></i>, <i>k<sub>2</sub></i>. Подставляем значения в общее уравнение прямой и получаем пару уравнений касательных проведенных из точки (<i>x<sub>1</sub></i>, <i>y<sub>1</sub></i>) к окружности

</p>

<p/><p>Для демонстрации численного решения воспользуемся следующими начальными данными: окружность радиусом 4 с центром в точке (-5, 1) и точка касательной с координатами (10, 15).
</p><p/><p>Код с комментариями:
</p><div class="python">
<div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># точка центра окружности</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c"># радиус окружности</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c"># точка вершины прямой</span>
<span class="n">x1</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">y1</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c"># Определяем переменные</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">'x y k'</span><span class="p">)</span>

<span class="c"># Выражаем y из уравнения касательной</span>
<span class="n">exp_2</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>

<span class="c"># решаем полученное выражение относительно y</span>
<span class="c"># функция solve всегда возвращает список решений, но поскольку мы заранее знаем, что </span>
<span class="c"># решений может быть только одно, явно извлекаем нулевой элемент</span>
<span class="n">ny</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">exp_2</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">'y='</span><span class="p">,</span> <span class="n">ny</span>

<span class="c"># Выражаем x из уравнений окружности, подставляя ранее полученное</span>
<span class="c"># выражение y</span>
<span class="n">exp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c"># приводим выражение к общему виду относительно переменной x функцией collect,</span>
<span class="c"># метод cancel позволяет "упростить" выражение, преобразовав подобные элементы</span>
<span class="n">ne</span> <span class="o">=</span> <span class="n">collect</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">cancel</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span>

<span class="c"># преобразуем выражения в объект полинома</span>
<span class="n">po</span> <span class="o">=</span> <span class="n">poly_from_expr</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c"># выделяем коэфициенты квадратного уравнения</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">coeff_monomial</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">coeff_monomial</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">coeff_monomial</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="s">'alpha ='</span><span class="p">,</span> <span class="n">alpha</span>
<span class="k">print</span> <span class="s">'beta ='</span><span class="p">,</span> <span class="n">beta</span>
<span class="k">print</span> <span class="s">'gamma ='</span><span class="p">,</span> <span class="n">gamma</span>

<span class="c"># Касательная и окружность пересекаются в одной точке, поэтому уравнение</span>
<span class="c"># должно иметь только 1 корень, это происходит в случае когда дискриминант</span>
<span class="c"># равен нулю. Решаем уравнение и находим значения углового коэффициента</span>
<span class="n">D_exp</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">gamma</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">D_exp</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

<span class="c"># evalf метод вычисляет выражение в численной форме</span>
<span class="c"># здесь мы его используем что бы получить более наглядное представление </span>
<span class="k">print</span> <span class="s">'k ='</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="s">'~~&gt;'</span><span class="p">,</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>

<span class="c"># Подставляем полученные значения k и получаем уравнения касательных.</span>
<span class="n">tangents_lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
    <span class="c"># метод subs осуществляет подстановку значений в переменные и возвращает </span>
    <span class="c"># новое выражение</span>
    <span class="n">tangents_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ny</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">item</span><span class="p">}))</span>
    <span class="k">print</span> <span class="s">'y_tangent ='</span><span class="p">,</span> <span class="n">tangents_lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="s">'~~&gt;'</span><span class="p">,</span> <span class="n">tangents_lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
</pre></div>

</div><p>

Вывод данного фрагмента кода будет следующим:
</p><p class="python">
y= k*x - 10*k + 15<br/>
alpha = k**2 + 1<br/>
beta = -20*k**2 + 28*k + 10<br/>
gamma = 100*k**2 - 280*k + 205<br/>
k = [-36*sqrt(5)/209 + 210/209, 36*sqrt(5)/209 + 210/209] ~~&gt; [0.619624654593338, 1.38994472339709]<br/>
y_tangent = x*(-36*sqrt(5)/209 + 210/209) + 360*sqrt(5)/209 + 1035/209 ~~&gt; 0.619624654593337*x + 8.80375345406662<br/>
y_tangent = x*(36*sqrt(5)/209 + 210/209) - 360*sqrt(5)/209 + 1035/209 ~~&gt; 1.38994472339709*x + 1.10055276602907<br/>
</p>

<h2>Часть 2. Поиск точек пересечений касательных и окружности</h2><p>
Библиотека SymPy для задач аналитической геометрии предоставляет геометрические объекты и различного рода функции для работы с ними. В продолжение прошлой части кода, зададим такие объекты и найдем их точки пересечений, которыми воспользуемся для определения других геометрических объектов.
</p><div class="python">
<div class="highlight"><pre><span class="c"># список в котором будут храниться точки пересечений</span>
<span class="n">intersections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c"># задаем объект окружности</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>
<span class="c"># задаем точку из которой будем строить касательную</span>
<span class="n">main_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>

<span class="c"># для каждой касательной ищем пересечение с окружностью</span>
<span class="k">for</span> <span class="n">tangent</span> <span class="ow">in</span> <span class="n">tangents_lines</span><span class="p">:</span>
    
    <span class="c"># задаем вторую точку касательной</span>
    <span class="n">new_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">tangent</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">x0</span><span class="p">}))</span>
    
    <span class="c"># если вдруг так получилось что точки совпали, то зададим небольшое смещение</span>
    <span class="c"># и пересчитаем координаты точки</span>
    <span class="k">if</span> <span class="n">main_point</span> <span class="o">==</span> <span class="n">new_point</span><span class="p">:</span>
        <span class="n">new_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tangent</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">x0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}))</span>
    
    <span class="c"># задаем объект линию, проходящую через заданные ранее точки</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">main_point</span><span class="p">,</span> <span class="n">new_point</span><span class="p">)</span>
    
    <span class="c"># находим пересечение двух геометрических объектов с помощью </span>
    <span class="c"># функции intersection, которая вернет список точек пересечений</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">intersection</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    
    <span class="c"># если список tmp не пуст, значит пересечения были найдены</span>
    <span class="k">if</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="c"># если длина списка равна единице, то значит все хорошо</span>
        <span class="c"># для данного случая - мы нашли одну единственну точку пересечения</span>
        <span class="c"># что соответсвует определению касательной к окружности</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">intersections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c"># если вдруг нашлось более одного пересечения, то в каком то уголке вселенной </span>
        <span class="c"># нерадивый ученик разделил на ноль, извлек корень из минус единицы </span>
        <span class="c"># и определил последнее число Пи после запятой. </span>
        <span class="k">else</span><span class="p">:</span>
     <span class="k">print</span> <span class="s">'I don</span><span class="se">\'</span><span class="s">t know how it was, but this is your points: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">'Circle "{}" and line "{}" have no intersection'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="c">#</span>
<span class="c">#</span>
<span class="c"># Строим лучи с вершиной в центре окружности, проходящие через точки пересечения с касательной</span>
<span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="n">intersections</span><span class="p">:</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ray</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">),</span> <span class="n">inter</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">'Ray'</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s">'pretty views points of ray'</span><span class="p">,</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
</pre></div>
</div>
</div>

<p class="python">
Ray Ray(Point(-5, 1), Point(-1865/421 - 504*sqrt(5)/421, 645/421 + 540*sqrt(5)/421)) pretty views points of ray [Point(-5.00000000000000, 1.00000000000000), Point(-7.10683672365771, 4.40018220391897)]<br/>
Ray Ray(Point(-5, 1), Point(-1865/421 + 504*sqrt(5)/421, -540*sqrt(5)/421 + 645/421)) pretty views points of ray [Point(-5.00000000000000, 1.00000000000000), Point(-1.75302075852757, -1.33604918729189)]
</p>

<p>На рисунке ниже графически представлены некоторые результаты вычислений. Черным цветом нарисованы исходные положения - окружность и точка. Красными оттенками нарисованы две касательные, построенные по вычиленным уравнениям. Зеленым цветом отмечены лучи, исходящие из центра окружности, и, проходящие через точки пересечений касательной и окружности, которые были расчитаны во второй части этого сообщения.
</p><p>Поставленная задача успешно решена с помощью возможностей предоставляемой библиотекой SymPy.
</p></div></body></html>