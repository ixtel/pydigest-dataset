<html><body><div><p>A remote shell for working with MicroPython boards.</p>








<div id="rshell">
<h2>rshell</h2>
<p>Remote MicroPytyhon shell.</p>
<p>This is a simple shell which runs on the host and uses MicroPython’s
raw-REPL to send python snippets to the pyboard in order to get
filesystem information, and to copy files to and from MicroPython’s
filesystem.</p>
<p>It also has the ability to invoke the regular REPL, so rshell can be
used as a terminal emulator as well.</p>
<p>Note: With rshell you can disable USB Mass Storage and still copy files
into and out of your pyboard.</p>
<p>When using the commands, the /flash directory, and the /sdcard directory
(if an sdcard is inserted) are considered to be on the pyboard, and all
other directories are considered to be on the host.</p>
<p>NOTE: rshell requires a fairly recent version of the MicroPython
firmware, specifically one which contains the ubinascii.unhexlify
command which was added May 19, 2015 (v1.4.3-28-ga3a14b9 or newer).</p>
<p>If your verion of the firmware isn’t new enough, then you’ll see an
error message something like this:</p>
<pre>&gt;./rshell.py
rshell needs MicroPython firmware with ubinascii.unhexlify
</pre>
</div>
<div id="installation">
<h2>Installation</h2>
<p>You can install rshell using the command:</p>
<pre>sudo pip3 install rshell
</pre>
<p>If you use a virtualenv, then you don’t need the sudo. rshell needs Python3.
All of my testing was done using version 3.4.0.</p>
</div>
<div id="sample-session">
<h2>Sample Session</h2>
<p>This shows a pyboard in its default state, copying a hello.py and then
entering the repl and importing it.</p>
<pre>&gt;rshell
Welcome to rshell. Use Control-D to exit.
/home/dhylands/Dropbox/micropython/rshell&gt; ls -l /flash
   529 May 21 17:34 README.txt
   286 May 21 17:34 boot.py
    34 May 21 17:34 main.py
  2436 May 21 17:34 pybcdc.inf
/home/dhylands/Dropbox/micropython/rshell&gt; cp hello.py /flash
/home/dhylands/Dropbox/micropython/rshell&gt; ls -l /flash
   529 May 21 17:34 README.txt
   286 May 21 17:34 boot.py
    21 May 21 17:35 hello.py
    34 May 21 17:34 main.py
  2436 May 21 17:34 pybcdc.inf
/home/dhylands/Dropbox/micropython/rshell&gt; cat /flash/hello.py
print('Hello World')
/home/dhylands/Dropbox/micropython/rshell&gt; repl
Entering REPL. Use Control-X to exit.

Micro Python v1.4.3-28-ga3a14b9 on 2015-05-21; PYBv1.0 with STM32F405RG
Type "help()" for more information.
&gt;&gt;&gt;
&gt;&gt;&gt; import hello
Hello World
&gt;&gt;&gt;
/home/dhylands/Dropbox/micropython/rshell&gt;
</pre>
</div>
<div id="command-line-options">
<h2>Command Line Options</h2>
<div id="h-help">
<h3>-h, –help</h3>
<p>Displays a lit of the valid options. You should get something like the
following displayed:</p>
<pre>usage: rshell [options] [command]

Remote Shell for a MicroPython board.

positional arguments:
  cmd                   Optional command to execute

optional arguments:
  -h, --help            show this help message and exit
  -b BAUD, --baud BAUD  Set the baudrate used (default = 115200)
  --buffer-size BUFFER_SIZE
                        Set the buffer size used for transfers (default = 512)
  -p PORT, --port PORT  Set the serial port to use (default '/dev/ttyACM0')
  -u USER, --user USER  Set username to use (default 'micro')
  -w PASSWORD, --password PASSWORD
                        Set password to use (default 'python')
  -e EDITOR, --editor EDITOR
                        Set the editor to use (default 'vi')
  -f FILENAME, --file FILENAME
                        Specifies a file of commands to process.
  -d, --debug           Enable debug features
  -n, --nocolor         Turn off colorized output
  --nowait              Don't wait for serial port
  --timing              Print timing information about each command
  --quiet               Turns off some output (useful for testing)

You can specify the default serial port using the RSHELL_PORT environment
variable.
</pre>
</div>
<div id="b-baud-baud-baud">
<h3>-b BAUD, –baud BAUD</h3>
<p>Sets the baud rate to use when talking to the pyboard over a serial port. If
no baud is specified, then the baudrate from the RSHELL_BAUD enviroinment
variable is used. If the RSHELL_BAUD environment variable is not defined then
the default baudrate of 115200 is used.</p>
</div>
<div id="buffer-size">
<h3>–buffer-size</h3>
<p>Sets the buffer size used when transferring files betweem the host and the
pyboard. If no buffer size is specified, then the value from the
RSHELL_BUFFER_SIZE environment variable is used. If the RSHELL_BUFFER_SIZE
environment variable is not defined, then the default of 512 is used.</p>
</div>
<div id="d-debug">
<h3>-d, –debug</h3>
<p>Turns on debugging. This allows you to see the script which is sent over
the raw REPL and the response received.</p>
</div>
<div id="e-editor-editor">
<h3>-e EDITOR, –editor</h3>
<p>Specifies the editor to use with the edit command. If no editor is specified,
then the following environment variables will be searched: RSHELL_EDITOR,
VISUAL, and EDITOR. If none of those environment variables is set then vi will
be used.</p>
</div>
<div id="f-filename-file-filename">
<h3>-f FILENAME, –file FILENAME</h3>
<p>Specifies a file of rshell commands to process. This allows you to
create a script which executes any valid rshell commands.</p>
</div>
<div id="n-nocolor">
<h3>-n, –nocolor</h3>
<p>By default, rshell uses ANSI color escape codes when displaying the
prompt and ls output. This option allows colorized output to be
disabled.</p>
</div>
<div id="nowait">
<h3>–nowait</h3>
<p>If a port is specified, then rshell will wait for the serial port to exist
before continuing. With the –nowait option, rshell will not wait for the
serial port to exist.</p>
</div>
<div id="p-port-port-port">
<h3>-p PORT, –port PORT</h3>
<p>Specifies the serial port which should be used to talk to the
MicroPython board. You can set the RSHELL_PORT environment variable to
specify the default port to be used, if –port is not specified on the
command line.</p>
</div>
<div id="quiet">
<h3>–quiet</h3>
<p>This option causes the Connecting messages printed when rshell starts to be
suppressed. This is mostly useful the test scripts.</p>
</div>
<div id="timing">
<h3>–timing</h3>
<p>If the timing option is specified then rshell will print the amount of time
that each command takes to execute.</p>
</div>
<div id="u-user-user-user">
<h3>-u USER, –user USER</h3>
<p>Specifies the username to use when logging into a WiPy over telent. If no
username is specified, then the username from the RSHELL_USER environment
variable is used. If the RSHELL_USER environment variable doesn’t exist
then the default username ‘micro’ is used.</p>
</div>
<div id="w-password-password-password">
<h3>-w PASSWORD, –password PASSWORD</h3>
<p>Specified the password to use when logging into a WiPy over telnet. If no
password is specified, then the password from the RSHELL_PASSWORD environment
variable is used. If the RSHELL_PASSWORD environment variable doesn’t exist
then the default password ‘python’ is used.</p>
</div>
<div id="cmd">
<h3>cmd</h3>
<p>If a command is specified, then that command will be executed and rshell will
exit. Examples:</p>
<pre>rshell cp somefile.py /flash
rshell repl ~ pyb.bootloader() ~
</pre>
</div>
</div>
<div id="file-system">
<h2>File System</h2>
<p>rshell can be connected to multiple pyboards simultaneously. If the
board module exists on the pyboard (i.e. a file named board.py somewhere
in the module search path) and it contains an attribute called name then
the pyboard will use that name. If the board module can’t be imported
then the board will be named, pyboard or wipy. Names will have -1 (or
some other number) to make the board name unique.</p>
<p>You can access the internal flash on the first board connected using
/flash and the sd card on the first board connected can be accessed
using /sd.</p>
<p>For all other connected pyboards, you can use /board-name/flash or
/board-name/sd (you can see the board names using the boards command).</p>
<p>The boards command will show all of the connected pyboards, along with all of
the directories which map onto that pyboard.</p>
</div>
<div id="commands">
<h2>Commands</h2>
<div id="args">
<h3>args</h3>
<pre>args [arguments...]
</pre>
<p>Debug function for verifying argument parsing. This function just prints
out each argument that it receives.</p>
</div>
<div id="boards">
<h3>boards</h3>
<pre>boards
</pre>
<p>Lists all of the boards that rshell is currently connected to, their
names, and the connection.</p>
</div>
<div id="cat">
<h3>cat</h3>
<pre>cat FILENAME...
</pre>
<p>Concatinates files and sends to stdout.</p>
</div>
<div id="cd">
<h3>cd</h3>
<pre>cd DIRECTORY
</pre>
<p>Changes the current directory. ~ expansion is supported, and cd - goes
to the previous directory.</p>
</div>
<div id="connect">
<h3>connect</h3>
<pre>connect TYPE TYPE_PARAMS
connect serial port [baud]
connect telnet ip-address-or-name
</pre>
<p>Connects a pyboard to rshell. rshell can be connected to multiple
pyboards simultaneously.</p>
</div>
<div id="cp">
<h3>cp</h3>
<pre>cp SOURCE DEST
cp SOURCE... DIRECTORY
</pre>
<p>Copies the SOURCE file to DEST. DEST may be a filename or a directory
name. If more than one source file is specified, then the destination
should be a directory.</p>
</div>
<div id="echo">
<h3>echo</h3>
<pre>echo TEXT...
</pre>
<p>Display a line of text.</p>
</div>
<div id="edit">
<h3>edit</h3>
<pre>edit filename
</pre>
<p>If the file is on a pyboard, it copies the file to host, invokes an
editor and if any changes were made to the file, it copies it back to
the pyboard.</p>
<p>The editor which is used defaults to vi, but can be overridem using
either the –editor command line option when rshell.py is invoked, or by
using the RSHELL_EDITOR, VISUAL or EDITOR environment variables (they
are tried in the order listed).</p>
</div>
<div id="filesize">
<h3>filesize</h3>
<pre>filesize FILE
</pre>
<p>Prints the size of the file, in bytes. This function is primarily
testing.</p>
</div>
<div id="filetype">
<h3>filetype</h3>
<pre>filetype FILE
</pre>
<p>Prints the type of file (dir or file). This function is primarily for
testing.</p>
</div>
<div id="help">
<h3>help</h3>
<pre>help [COMMAND]
</pre>
<p>List available commands with no arguments, or detailed help when a
command is provided.</p>
</div>
<div id="ls">
<h3>ls</h3>
<pre>usage: ls [-a] [-l] FILE...

List directory contents.

positional arguments:
  FILE        Files or directories to list

optional arguments:
  -h, --help  show this help message and exit
  -a, --all   do not ignore hidden files
  -l, --long  use a long listing format
</pre>
</div>
<div id="mkdir">
<h3>mkdir</h3>
<pre>mkdir DIRECTORY...
</pre>
<p>Creates one or more directories.</p>
</div>
<div id="repl">
<h3>repl</h3>
<pre>repl [board-name] [~ line][ ~]
</pre>
<p>Enters into the regular REPL with the MicroPython board. Use Control-X
to exit REPL mode and return the shell. It may take a second or two
before the REPL exits.</p>
<p>If you provide a board-name then rshell will connect to that board,
otherwise it will connect to the default board (first connected board).</p>
<p>If you provide a tilde followed by a space (~ ) then anything after the
tilde will be entered as if you typed it on the command line.</p>
<p>If you want the repl to exit, end the line with the ~ character.</p>
<p>For example, you could use:</p>
<pre>rshell.py repl ~ pyb.bootloader()~
</pre>
<p>and it will boot the pyboard into DFU.</p>
</div>
<div id="rm">
<h3>rm</h3>
<pre>usage: rm [-r|--recursive][-f|--force] FILE...

Removes files or directories (directories must be empty).

positional arguments:
  FILE             File to remove

optional arguments:
  -h, --help       show this help message and exit
  -r, --recursive  remove directories and their contents recursively
  -f, --force      ignore nonexistant files and arguments
</pre>
</div>
<div id="shell">
<h3>shell</h3>
<p>The shell command can also be abbreviated using the exclamation point.</p>
<pre>shell some-command
!some-command
</pre>
<p>This will invoke a command, and return back to rshell. Example:</p>
<pre>!make deploy
</pre>
<p>will flash the pyboard.</p>
</div>
</div>


</div></body></html>