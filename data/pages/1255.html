<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-notice-this-code-and-the-corresponding-google-api-have-changed-several-times-since-this-was-first-published-it-is-currently-not-stable-so-do-not-rely-on-this-being-reliable-or-even-working-i-will-try-and-remedy-the-stability-of-it-but-currently-this-is-low-on-my-list-of-priorities" class="anchor" href="#notice-this-code-and-the-corresponding-google-api-have-changed-several-times-since-this-was-first-published-it-is-currently-not-stable-so-do-not-rely-on-this-being-reliable-or-even-working-i-will-try-and-remedy-the-stability-of-it-but-currently-this-is-low-on-my-list-of-priorities" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Notice: This code and the corresponding google API have changed several times since this was first published. It is currently not stable, so do not rely on this being reliable or even working. I will try and remedy the stability of it, but currently this is low on my list of priorities.</h1>

<h2><a id="user-content-get-on-the-bus" class="anchor" href="#get-on-the-bus" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Get on the bus</h2>

<blockquote>
<p>Google calendar makes sweet love to your alarm clock</p>
</blockquote>

<p>(Inspired from <a href="http://www.esologic.com/?p=634">Raspberry Pi as a Google Calender Alarm Clock</a>)</p>

<p>This year, my kids started riding the school bus, which is super convenient and means I don't have to spend extra time getting them to school. That is, if they make the bus. Sometimes they lose track of time, and I wanted a pretty reliable way of reminding them when it's time to go outside to wait for the big yellow limousine to escort them to school. </p>

<p>Since I am lazy, I decided to have this automated, which uses (ideally) a Raspberry Pi and Google Calendar to check for events that start with 'say' or have corresponding mp3 titles.</p>

<p>For example:</p>

<ol>
<li>An event titled <code>say Don't forget to brush your teeth</code> will announce the phrase 'Don't forget to brush your teeth'.</li>
<li>An event with the title <code>Get on the bus</code> fires an appropriately annoying song snippet from the mp3s folder by The Doodlebops called <code>get_on_the_bus.mp3</code>.</li>
</ol>

<p>It's dynamic in the sense that it will try and play any mp3 with the event title, and falls back to a default mp3 (my default.mp3 is an old school Nokia ringtone-- of course, you can make yours anything you wish).</p>

<p>Pre-requisite: <code>mpg123</code></p>

<ul>
<li><p>If you're on Linux, you can install <code>mpg123</code> via apt-get:</p>

<div class="highlight highlight-source-shell"><pre>sudo apt-get install mpg123</pre></div></li>
<li><p>If you're on OS X, you can install <code>mpg123</code> via <a href="http://brew.sh">Homebrew</a>:</p>

</li>
<li><p>Or you can download the <a href="http://sourceforge.net/projects/mpg123/files/">source</a> and run:</p>

<div class="highlight highlight-source-shell"><pre>./configure
make
make install</pre></div></li>
</ul>

<p>Pre-requisite for Linux text to speech: <code>espeak</code></p>

<pre><code>sudo apt-get install espeak
</code></pre>

<ol>
<li><p>Install the requirements:</p>

<pre><code>pip install -r requirements.txt
</code></pre></li>
<li><p>Create a new project on the <a href="https://console.developers.google.com">Google Developers Console</a></p></li>
<li>Enable the Calendars API</li>
<li>Create the file <code>config.py</code></li>
<li>Create new Client ID for standalone application and download the JSON as <code>client_secrets.json</code> and set <code>CLIENT_SECRET_FILE = 'client_secrets.json'</code> in <code>config.py</code></li>
<li>Create a new key for browser application and set the <code>API KEY</code> value as <code>API_KEY = xxx</code> in <code>config.py</code></li>
<li>Create a new Google calendar and set the ID as <code>CALENDAR_ID = xxx</code> in <code>config.py</code> (Click drop-down arrow by calendar name; choose 'Calendar Settings'; find ID by 'Calendar Address' section)</li>
<li>Add <code>FREQUENCY_CHECK</code> (in seconds) and <code>MP3_FOLDER</code> location in <code>config.py</code>.</li>
<li>Run the program: <code>python alarm.py</code></li>
</ol>

<p>All new events will try to play the name of the event as an mp3 file in the <code>mp3s</code> folder with spaces converted to underscores, i.e.:  </p>

<p><code>Get on the bus</code> == <code>mp3s/get_on_the_bus.mp3</code>  </p>

<p>If the event has no corresponding mp3 file, <code>default.mp3</code> will play. To have the sound play repeatedly until the event's time expires, enter <code>repeat</code> as the event's description.</p>

<p>Example <code>config.py</code> file:</p>

<pre><code>API_KEY = '123456789qwertyuiop987654321asdfghjkl54321'
CALENDAR_ID = 'mnbvcxzlkjhgfdsa123@group.calendar.google.com'
CLIENT_SECRET_FILE = 'client_secrets.json'
FREQUENCY_CHECK = 5 # in seconds
MP3_FOLDER = 'mp3s'
</code></pre>
</article>
  </div></body></html>