<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/batcountry_fal_header_animated.gif"><img class="aligncenter wp-image-2735" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/batcountry_fal_header_animated.gif" alt="batcountry_fal_header_animated"/></a></p>
<blockquote><p>We can’t stop here, this is bat country.</p></blockquote>
<p>Just a few days ago, the <a href="http://googleresearch.blogspot.com/2015/06/inceptionism-going-deeper-into-neural.html" target="_blank">Google Research blog published a post</a> demonstrating a unique, interesting, and perhaps even disturbing method to visualize what’s going inside the layers of a Convolutional Neural Network (CNN).</p>
<p><em><strong>Note: </strong>Before you go, <a href="#show_and_tell">I suggest taking a look at the images generated using bat-country</a> — most of them came out fantastic, especially the Jurassic Park images.</em></p>
<p>Their approach works by turning the CNN upside down, inputting an image, and gradually tweaking the image to what the network “thinks” a particular object or class looks like.</p>
<p><em>The results are breathtaking to say the least.</em> Lower levels reveal edge-like regions in the images. Intermediate layers are able to represent basic shapes and components of objects (doorknob, eye, nose, etc.). And lastly, the final layers are able to form the complete interpretation (dog, cat, tree, etc.) — <em>and often in a psychedelic, spaced out manner.</em></p>
<p>Along with their results, Google also published an <a href="https://github.com/google/deepdream" target="_blank">excellent IPython Notebook</a> allowing you to play around and create some trippy images of your own.</p>
<p>The IPython Notebook is indeed fantastic. It’s fun to play around with. And since it’s an IPython Notebook, it’s fairly easy to get started with. <em>But I wanted to take it a step further</em>. Make it <strong>modular</strong>. More <strong>customizable</strong>. More like a Python modules that acts and behaves like one. And of course, it has to be <strong>pip-installable</strong> (you’ll need to bring your own Caffe installation).</p>
<p><strong>That’s why I put together <a href="https://github.com/jrosebr1/bat-country" target="_blank">bat-country</a>, an easy to use, highly extendible, lightweight Python module for inceptionism and deep dreaming with Convolutional Neural Networks and Caffe.</strong></p>
<p>Comparatively, my contributions here are honestly pretty minimal. All the real research has been done by Google — I’m simply taking the IPython Notebook, turning it into a Python module, while keeping in mind the importance of extensibility, <em>such as custom step functions</em>.</p>
<p>Before we dive into the rest of this post, I would like to take a second and call attention to Justin Johnson’s <a href="https://github.com/jcjohnson/cnn-vis" target="_blank">cnn-vis</a>, a command line tool for generating inceptionism images. His tool is quite powerful and more like what Google is (probably) using for their own research publications. If you’re looking for a more advanced, complete package, definitely go take a look at cnn-vis. You also might be interested in Vision.ai’s co-founder Tomasz Malisiewicz’s <a href="https://github.com/VISIONAI/clouddream" target="_blank">clouddream</a> docker image to quickly get Caffe up and running.</p>
<p>But in the meantime, if you’re interested in playing around with a simple, easy to use Python package, go <a href="https://github.com/jrosebr1/bat-country" target="_blank">grab the source from GitHub</a> or install it via 
			<span id="crayon-56d59e0633dab010747187" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span></p>
<p><strong>The rest of this blog post is organized as follows:</strong></p>
<ul>
<li><strong>A simple example.</strong> 3 lines of code to generate your own deep dream/inceptionism images.</li>
<li><strong>Requirements.</strong> Libraries and packages required to run 
			<span id="crayon-56d59e0633db6462991398" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span>  (mostly just Caffe and its associated dependencies).</li>
<li><strong>What’s going on under the hood?</strong> The anatomy of 
			<span id="crayon-56d59e0633dbb160921033" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span>  and how to extend it.</li>
<li><strong>Show and tell.</strong> If there is any section of this post that you don’t want to miss, <em><strong>it’s this one</strong></em>. I have put together a gallery of some really awesome images generated I generated over the weekend using 
			<span id="crayon-56d59e0633dbe757050893" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span> . The results are quite surreal, to say the least.</li>
</ul>
<h1>bat-country: an extendible, lightweight Python package for deep dreaming with Caffe and CNNs</h1>
<p>Again, I want make it clear that the code for <a href="https://github.com/jrosebr1/bat-country">bat-country</a> is heavily based on the work from the <a href="http://googleresearch.blogspot.com/2015/06/inceptionism-going-deeper-into-neural.html">Google Research Team</a>. My contributions here are mainly refactoring the code into a usable Python package, making the package easily extendible via custom preprocessing, deprocessing, step functions, etc., and ensuring that the package is pip-installable. With that said, let’s go ahead and get our first look at <a href="https://github.com/jrosebr1/bat-country">bat-country</a>.</p>
<h2>A simple example.</h2>
<p>As I mentioned, one of the goals of 
			<span id="crayon-56d59e0633dc3275428600" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span>  is simplicity. Provided you have already installed Caffe and 
			<span id="crayon-56d59e0633dc6561001188" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span>  on your system, it only takes 3 lines of Python code to generate a deep dream/inceptionism image:</p>

		<div id="crayon-56d59e0633dca235641689" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633dca235641689-1"><span class="crayon-c"># we can't stop here...</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633dca235641689-2"><span class="crayon-v">bc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BatCountry</span><span class="crayon-sy">(</span><span class="crayon-s">"caffe/models/bvlc_googlenet"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e0633dca235641689-3"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">bc</span><span class="crayon-sy">.</span><span class="crayon-e">dream</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">float32</span><span class="crayon-sy">(</span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">"/path/to/image.jpg"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633dca235641689-4"><span class="crayon-v">bc</span><span class="crayon-sy">.</span><span class="crayon-e">cleanup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>After executing this code, you can then take the 
			<span id="crayon-56d59e0633dce580418400" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">image</span></span></span>  returned by the 
			<span id="crayon-56d59e0633dd1802243538" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">dream</span></span></span>  method and write it to file:</p>

		<div id="crayon-56d59e0633dd5675121737" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633dd5675121737-1"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-e">fromarray</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">uint8</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633dd5675121737-2"><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">save</span><span class="crayon-sy">(</span><span class="crayon-s">"/path/to/output.jpg"</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>And that’s it! You can see the view source code of 
			<span id="crayon-56d59e0633dd8611008881" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">demo</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  <a href="https://github.com/jrosebr1/bat-country/blob/master/demo.py" target="_blank">here on GitHub</a>.</p>
<h2>Requirements.</h2>
<p>The bat-country packages requires <a href="http://caffe.berkeleyvision.org/" target="_blank">Caffe, an open-source CNN implementation from Berkeley</a>, to be already installed on your system. This section will detail the basic steps to get Caffe setup on your system. However, an excellent alternative is to use the <a href="https://github.com/VISIONAI/clouddream" target="_blank">Docker image provided by Tomasz of Vision.ai</a>. Using the Docker image will get you up and running quite painlessly. But for those who would like their own install, keep reading.</p>
<h3>Step 1: Install Caffe</h3>
<p>Take a look at the <a href="http://caffe.berkeleyvision.org/installation.html" target="_blank">official installation instructions</a> to get Caffe up and running. Instead of installing Caffe on your own system, I recommend spinning up an <a href="http://www.pyimagesearch.com/2014/10/13/deep-learning-amazon-ec2-gpu-python-nolearn/" target="_blank">Amazon EC2 g2.2xlarge instance</a> (so you have access to the GPU) and working from there.</p>
<h3>Step 2: Compile Python bindings for Caffe</h3>
<p>Again, use the <a href="http://caffe.berkeleyvision.org/installation.html#prerequisites" target="_blank">official install instructions from Caffe</a>. Creating a separate virtual environment for all the packages from 
			<span id="crayon-56d59e0633ddc735512481" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">requirements</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span></span></span>  is a good idea, but certainly not required.</p>
<p>An important step to do here is update your 
			<span id="crayon-56d59e0633de0777459868" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-sy">$</span><span class="crayon-v">PYTHONPATH</span></span></span>  to include your Caffe installation directory:</p>

		<div id="crayon-56d59e0633de3858334809" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633de3858334809-1"><span class="crayon-e">export </span><span class="crayon-v">PYTHONPATH</span><span class="crayon-o">=</span><span class="crayon-o">/</span><span class="crayon-v">path</span><span class="crayon-o">/</span><span class="crayon-st">to</span><span class="crayon-o">/</span><span class="crayon-v">caffe</span><span class="crayon-o">/</span><span class="crayon-v">python</span><span class="crayon-o">:</span><span class="crayon-v">$PYTHONPATH</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On Ubuntu, I also like to but this export in my 
			<span id="crayon-56d59e0633de7105209680" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-sy">.</span><span class="crayon-v">bashrc</span></span></span>  file so that it’s loaded each time I login or open up a new terminal, but that’s up to you.</p>
<h3>Step 3: Optionally install cuDNN</h3>
<p>Caffe works fine out of the box on the CPU. But if you really want to make Caffe scream, you should be using the GPU. <a href="https://developer.nvidia.com/cudnn" target="_blank">Installing cuDNN</a> isn’t too difficult of a process, but if you’ve never done it before, be prepared to spend some time working through this step.</p>
<h3>Step 4: Set your $CAFFE_ROOT</h3>
<p>The 
			<span id="crayon-56d59e0633deb582162516" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-sy">$</span><span class="crayon-v">CAFFE_ROOT</span></span></span>  directory is the base directory of your Caffe install:</p>

		<div id="crayon-56d59e0633dee765118817" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633dee765118817-1"><span class="crayon-e">export </span><span class="crayon-v">CAFEE_ROOT</span><span class="crayon-o">=</span><span class="crayon-o">/</span><span class="crayon-v">path</span><span class="crayon-o">/</span><span class="crayon-st">to</span><span class="crayon-o">/</span><span class="crayon-v">caffe</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Here’s what my 
			<span id="crayon-56d59e0633df5039729424" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-sy">$</span><span class="crayon-v">CAFFE_ROOT</span></span></span>  looks like:</p>

		<div id="crayon-56d59e0633df9134220383" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633df9134220383-1"><span class="crayon-e">export </span><span class="crayon-v">CAFFE_ROOT</span><span class="crayon-o">=</span><span class="crayon-o">/</span><span class="crayon-v">home</span><span class="crayon-o">/</span><span class="crayon-v">ubuntu</span><span class="crayon-o">/</span><span class="crayon-v">libraries</span><span class="crayon-o">/</span><span class="crayon-v">caffe</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Again, I would suggest putting this in your 
			<span id="crayon-56d59e0633dfd341587664" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-sy">.</span><span class="crayon-v">bashrc</span></span></span>  file so it’s loaded each time you login.</p>
<h3>Step 5: Download the pre-trained GoogLeNet model</h3>
<p>You’ll need a pre-trained model to generate deep dream images. Let’s go ahead and use the GoogLeNet model which Google used in their blog post. The Caffe package provides a script that downloads the model for you:</p>

		<div id="crayon-56d59e0633e00051000351" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633e00051000351-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-r">cd</span><span class="crayon-h"> </span><span class="crayon-v">$CAFFE_ROOT</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e00051000351-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-v">scripts</span><span class="crayon-o">/</span><span class="crayon-v">download_model_binary</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-o">/</span><span class="crayon-v">bvlc_googlenet</span><span class="crayon-o">/</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h3>Step 6: Install bat-country</h3>
<p>The 
			<span id="crayon-56d59e0633e04972427396" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span>  package is dead simple to install. The easiest way is to use pip:</p>

		<div id="crayon-56d59e0633e07436546739" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633e07436546739-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>But you can also pull down the <a href="https://github.com/jrosebr1/bat-country" target="_blank">source from GitHub</a> if you want to do some hacking:</p>

		<div id="crayon-56d59e0633e0b309158580" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633e0b309158580-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">git </span><span class="crayon-r">clone</span><span class="crayon-h"> </span><span class="crayon-v">https</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-v">github</span><span class="crayon-e">.com</span><span class="crayon-o">/</span><span class="crayon-v">jrosebr1</span><span class="crayon-o">/</span><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span><span class="crayon-e">.git</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e0b309158580-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-r">cd</span><span class="crayon-h"> </span><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-i">country</span></p><p class="crayon-line" id="crayon-56d59e0633e0b309158580-3"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-st">do</span><span class="crayon-h"> </span><span class="crayon-e">some </span><span class="crayon-i">hacking</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e0b309158580-4"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">setup</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-v">install</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h2>What’s going on under the hood — and how to extend bat-country</h2>
<p>The vast majority of the 
			<span id="crayon-56d59e0633e0e875488143" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span>  code is from Google’s IPython Notebook. My contributions are pretty minimal, just re-factoring the code to make it act and behave like a Python module — and to facilitate easy modifications and customizability.</p>
<p>The first important method to consider is the 
			<span id="crayon-56d59e0633e12101267518" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">BatCountry</span></span></span>  constructor which allows you to pass in custom CNNs like GoogLeNet, MIT Places, or other models from the <a href="https://github.com/BVLC/caffe/wiki/Model-Zoo" target="_blank">Caffe Model Zoo</a>. All you need to do is modify the 
			<span id="crayon-56d59e0633e16326366901" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">base_path</span></span></span> , 
			<span id="crayon-56d59e0633e19030216021" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">deploy_path</span></span></span> , 
			<span id="crayon-56d59e0633e1d195363802" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">model_path</span></span></span> , and image 
			<span id="crayon-56d59e0633e20419753083" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">mean</span></span></span> . The 
			<span id="crayon-56d59e0633e23704518170" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">mean</span></span></span>  itself will have to be computed from the original training set. Take a look at the <a href="https://github.com/jrosebr1/bat-country/blob/master/batcountry/batcountry.py" target="_blank">BatCountry constructor</a> for more details.</p>
<p>The internals of 
			<span id="crayon-56d59e0633e27267835287" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">BatCountry</span></span></span>  take care of patching the model to compute gradients, along with loading the network itself.</p>
<p>Now, let’s say you wanted to override the standard gradient ascent function for maximizing the L2-norm activations for a given layer. All you would need to do is provide your custom function to the 
			<span id="crayon-56d59e0633e2b995108879" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">dream</span></span></span>  method. Here’s a trivial example of overriding the default behavior of the gradient ascent function to use a smaller 
			<span id="crayon-56d59e0633e2e223744140" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">step</span></span></span> , and larger 
			<span id="crayon-56d59e0633e32951200739" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">jitter</span></span></span> :</p>

		<div id="crayon-56d59e0633e35075022359" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-2">2</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-4">4</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-6">6</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-8">8</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-10">10</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-12">12</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-14">14</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-16">16</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-18">18</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-20">20</p><p class="crayon-num" data-line="crayon-56d59e0633e35075022359-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e0633e35075022359-22">22</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633e35075022359-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">custom_step</span><span class="crayon-sy">(</span><span class="crayon-v">net</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">step_size</span><span class="crayon-o">=</span><span class="crayon-cn">1.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">end</span><span class="crayon-o">=</span><span class="crayon-s">"inception_4c/output"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-2"><span class="crayon-h">	</span><span class="crayon-v">jitter</span><span class="crayon-o">=</span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clip</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59e0633e35075022359-3"><span class="crayon-h">	</span><span class="crayon-v">src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">net</span><span class="crayon-sy">.</span><span class="crayon-v">blobs</span><span class="crayon-sy">[</span><span class="crayon-s">"data"</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-4"><span class="crayon-h">	</span><span class="crayon-v">dst</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">net</span><span class="crayon-sy">.</span><span class="crayon-v">blobs</span><span class="crayon-sy">[</span><span class="crayon-v">end</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59e0633e35075022359-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-6"><span class="crayon-h">	</span><span class="crayon-v">ox</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">oy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">jitter</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">jitter</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e0633e35075022359-7"><span class="crayon-h">	</span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">roll</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">roll</span><span class="crayon-sy">(</span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ox</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">oy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-8"> </p><p class="crayon-line" id="crayon-56d59e0633e35075022359-9"><span class="crayon-h">	</span><span class="crayon-v">net</span><span class="crayon-sy">.</span><span class="crayon-e">forward</span><span class="crayon-sy">(</span><span class="crayon-v">end</span><span class="crayon-o">=</span><span class="crayon-v">end</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-10"><span class="crayon-h">	</span><span class="crayon-v">dst</span><span class="crayon-sy">.</span><span class="crayon-v">diff</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dst</span><span class="crayon-sy">.</span><span class="crayon-e">data</span></p><p class="crayon-line" id="crayon-56d59e0633e35075022359-11"><span class="crayon-e">	</span><span class="crayon-v">net</span><span class="crayon-sy">.</span><span class="crayon-e">backward</span><span class="crayon-sy">(</span><span class="crayon-v">start</span><span class="crayon-o">=</span><span class="crayon-v">end</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-12"><span class="crayon-h">	</span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">diff</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59e0633e35075022359-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-14"><span class="crayon-h">	</span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">step_size</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">abs</span><span class="crayon-sy">(</span><span class="crayon-v">g</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-i">g</span></p><p class="crayon-line" id="crayon-56d59e0633e35075022359-15"><span class="crayon-h">	</span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">roll</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">roll</span><span class="crayon-sy">(</span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">ox</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">oy</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-16"> </p><p class="crayon-line" id="crayon-56d59e0633e35075022359-17"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">clip</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-18"><span class="crayon-h">		</span><span class="crayon-v">bias</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">net</span><span class="crayon-sy">.</span><span class="crayon-v">transformer</span><span class="crayon-sy">.</span><span class="crayon-v">mean</span><span class="crayon-sy">[</span><span class="crayon-s">"data"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59e0633e35075022359-19"><span class="crayon-h">		</span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">clip</span><span class="crayon-sy">(</span><span class="crayon-v">src</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">bias</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">bias</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-20"> </p><p class="crayon-line" id="crayon-56d59e0633e35075022359-21"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">bc</span><span class="crayon-sy">.</span><span class="crayon-e">dream</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">float32</span><span class="crayon-sy">(</span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">"image.jpg"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e35075022359-22"><span class="crayon-h">	</span><span class="crayon-v">step_fn</span><span class="crayon-o">=</span><span class="crayon-v">custom_step</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Again, this is just a demonstration of implementing a custom step function and not meant to be anything too exciting.</p>
<p>You can also override the default 
			<span id="crayon-56d59e0633e3a665007275" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">preprocess</span></span></span>  and 
			<span id="crayon-56d59e0633e3d440415878" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">deprocess</span></span></span>  functions by passing in a custom 
			<span id="crayon-56d59e0633e41608763394" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">preprocess_fn</span></span></span>  and 
			<span id="crayon-56d59e0633e44279064412" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">deprocess_fn</span></span></span>  to 
			<span id="crayon-56d59e0633e47192260319" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">dream</span></span></span> :</p>

		<div id="crayon-56d59e0633e4b339547882" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633e4b339547882-1"><span class="crayon-e">def </span><span class="crayon-e">custom_preprocess</span><span class="crayon-sy">(</span><span class="crayon-v">net</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">img</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4b339547882-2"><span class="crayon-h">	</span><span class="crayon-c"># do something interesting here...</span></p><p class="crayon-line" id="crayon-56d59e0633e4b339547882-3"><span class="crayon-h">	</span><span class="crayon-e">pass</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4b339547882-4"> </p><p class="crayon-line" id="crayon-56d59e0633e4b339547882-5"><span class="crayon-e">def </span><span class="crayon-e">custom_deprocess</span><span class="crayon-sy">(</span><span class="crayon-v">net</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">img</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4b339547882-6"><span class="crayon-h">	</span><span class="crayon-c"># do something interesting here...</span></p><p class="crayon-line" id="crayon-56d59e0633e4b339547882-7"><span class="crayon-h">	</span><span class="crayon-e">pass</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4b339547882-8"> </p><p class="crayon-line" id="crayon-56d59e0633e4b339547882-9"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">bc</span><span class="crayon-e">.dream</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-e">.float32</span><span class="crayon-sy">(</span><span class="crayon-v">Image</span><span class="crayon-e">.open</span><span class="crayon-sy">(</span><span class="crayon-s">"image.jpg"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4b339547882-10"><span class="crayon-h">	</span><span class="crayon-v">preprocess_fn</span><span class="crayon-o">=</span><span class="crayon-v">custom_preocess</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">deprocess_fn</span><span class="crayon-o">=</span><span class="crayon-v">custom_deprocess</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Finally, bat-country also supports visualizing each octave, iteration, and layer of the network:</p>

		<div id="crayon-56d59e0633e4e948709834" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e0633e4e948709834-1"><span class="crayon-v">bc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BatCountry</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">base_model</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4e948709834-2"><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">visualizations</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">bc</span><span class="crayon-sy">.</span><span class="crayon-e">dream</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">float32</span><span class="crayon-sy">(</span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59e0633e4e948709834-3"><span class="crayon-h">	</span><span class="crayon-v">end</span><span class="crayon-o">=</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">layer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">visualize</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4e948709834-4"><span class="crayon-v">bc</span><span class="crayon-sy">.</span><span class="crayon-e">cleanup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e0633e4e948709834-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4e948709834-6"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vis</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">visualizations</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59e0633e4e948709834-7"><span class="crayon-h">	</span><span class="crayon-v">outputPath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"{}/{}.jpg"</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">.</span><span class="crayon-v">vis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e0633e4e948709834-8"><span class="crayon-h">	</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-e">fromarray</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">uint8</span><span class="crayon-sy">(</span><span class="crayon-v">vis</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e0633e4e948709834-9"><span class="crayon-h">	</span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">save</span><span class="crayon-sy">(</span><span class="crayon-v">outputPath</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>To see the full 
			<span id="crayon-56d59e0633e52995968654" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">demo_vis</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  script on GitHub, <a href="https://github.com/jrosebr1/bat-country/blob/master/demo_vis.py" target="_blank">just click here</a>.<br/>
<a name="show_and_tell"/></p>
<h2>Show and tell.</h2>
<p>I had a lot of fun playing with 
			<span id="crayon-56d59e0633e56056994049" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span>  over the weekend, specifically with images from <em>Fear and Loathing in Las Vegas</em>, <em>The Matrix</em>, and <em>Jurassic Park</em>. I also included a few of my favorite desktop wallpapers and photos from my recent vacation on the western part of the United States for fun.</p>
<p>For each of the original images <em>(top)</em>, I have generated a “deep dream” using the 
			<span id="crayon-56d59e0633e59722888040" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">conv2</span><span class="crayon-o">/</span><span class="crayon-cn">3x3</span></span></span> , 
			<span id="crayon-56d59e0633e5d987406545" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">inception_3b</span><span class="crayon-o">/</span><span class="crayon-cn">5x5_reduce</span></span></span> , 
			<span id="crayon-56d59e0633e60169726632" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">inception_4c</span><span class="crayon-o">/</span><span class="crayon-v">output</span></span></span>  layers, respectively.</p>
<p>The 
			<span id="crayon-56d59e0633e64521205038" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">conv2</span><span class="crayon-o">/</span><span class="crayon-cn">3x3</span></span></span>  and 
			<span id="crayon-56d59e0633e67531711054" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">inception_3b</span><span class="crayon-o">/</span><span class="crayon-cn">5x5_reduce</span></span></span>  layers are lower level layers in the network that give more “edge-like” features. The 
			<span id="crayon-56d59e0633e6b893089622" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">inception_4c</span><span class="crayon-o">/</span><span class="crayon-v">output</span></span></span>  layer is the final output that generates trippy hallucinations of dogs, snails, birds, and fish.</p>
<h3>Fear and Loathing in Las Vegas</h3>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_01.jpg"><img class="aligncenter wp-image-2727" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_01.jpg" alt="output_fal_01" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_01-167x300.jpg 167w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_01-570x1024.jpg 570w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_01.jpg 790w" sizes="(max-width: 600px) 100vw, 600px"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_02.jpg"><img class="aligncenter wp-image-2728" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_02.jpg" alt="output_fal_02" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_02-167x300.jpg 167w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_02-570x1024.jpg 570w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_02.jpg 1075w" sizes="(max-width: 600px) 100vw, 600px"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_03.jpg"><img class="aligncenter wp-image-2729" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_03.jpg" alt="output_fal_03" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_03-589x1024.jpg 589w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_03.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_04.jpg"><img class="aligncenter wp-image-2730" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_04.jpg" alt="output_fal_04" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_04-172x300.jpg 172w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_04-587x1024.jpg 587w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_fal_04.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h3>Jurassic Park</h3>
<div id="attachment_2726" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_06.jpg"><img class="wp-image-2726" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_06.jpg" alt="output_jp_06" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_06-131x300.jpg 131w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_06-447x1024.jpg 447w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_06.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>This is DEFINITELY my personal favorite.</strong></p></div>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_01.jpg"><img class="aligncenter wp-image-2721" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_01.jpg" alt="output_jp_01" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_01-147x300.jpg 147w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_01-502x1024.jpg 502w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_01.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_02.jpg"><img class="aligncenter wp-image-2722" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_02.jpg" alt="output_jp_02" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_02-465x1024.jpg 465w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_02.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_03.jpg"><img class="aligncenter wp-image-2723" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_03.jpg" alt="output_jp_03" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_03-131x300.jpg 131w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_03-447x1024.jpg 447w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_03.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_04.jpg"><img class="aligncenter wp-image-2724" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_04.jpg" alt="output_jp_04"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_05.jpg"><img class="aligncenter wp-image-2725" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_05.jpg" alt="output_jp_05" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_05-375x1024.jpg 375w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_jp_05.jpg 630w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h3>The Matrix</h3>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_01.jpg"><img class="aligncenter wp-image-2716" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_01.jpg" alt="output_matrix_01" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_01-605x1024.jpg 605w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_01.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_02.jpg"><img class="aligncenter size-full wp-image-2717" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_02.jpg" alt="output_matrix_02"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_03.jpg"><img class="aligncenter wp-image-2718" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_03.jpg" alt="output_matrix_03" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_03-131x300.jpg 131w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_03-447x1024.jpg 447w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_03.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a> <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_04.jpg"><img class="aligncenter wp-image-2719" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_04.jpg" alt="output_matrix_04" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_04-605x1024.jpg 605w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/output_matrix_04.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h3>Antelope Canyon (Page, AZ)</h3>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_01.jpg"><img class="aligncenter wp-image-2714" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_01.jpg" alt="antelope_canyon_01" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_01-300x111.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_01-1024x380.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_01.jpg 1940w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p> </p>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_02.jpg"><img class="aligncenter wp-image-2715" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_02.jpg" alt="antelope_canyon_02" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_02-300x197.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_02-1024x673.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/antelope_canyon_02.jpg 1460w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h3>Angels Landing (Zion Canyon; Springdale, UT)</h3>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_01.jpg"><img class="aligncenter wp-image-2712" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_01.jpg" alt="angels_landing_01" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_01-300x197.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_01-1024x673.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_01.jpg 1460w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p> </p>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_02.jpg"><img class="aligncenter wp-image-2713" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_02.jpg" alt="angels_landing_02" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_02-300x111.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_02-1024x380.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/angels_landing_02.jpg 1940w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h3>Zoo (Phoenix, AZ)</h3>
<p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/07/giraffe.jpg"><img class="aligncenter wp-image-2711" src="http://www.pyimagesearch.com/wp-content/uploads/2015/07/giraffe.jpg" alt="giraffe" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/07/giraffe-300x111.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/giraffe-1024x380.jpg 1024w, http://www.pyimagesearch.com/wp-content/uploads/2015/07/giraffe.jpg 1940w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<h1>Summary</h1>
<p>In this blog post I introduced <a href="https://github.com/jrosebr1/bat-country" target="_blank">bat-country</a>, an easy to use, highly extendible, lightweight Python module for inceptionism and deep dreaming with Convolutional Neural Networks and Caffe.</p>
<p>The vast majority of the code is based on the <a href="http://nbviewer.ipython.org/github/google/deepdream/blob/master/dream.ipynb" target="_blank">IPython Notebook</a> published by the <a href="http://googleresearch.blogspot.com/2015/06/inceptionism-going-deeper-into-neural.html" target="_blank">Google Research blog</a>. My own contribution isn’t too exciting, I have simply (1) wrapped the code in a Python class, (2) made it easier to extend and customize, and (3) pushed it to PyPI to make it pip-installable.</p>
<p>If you are looking for a more robust deep dreaming tool using Caffe, I really suggest taking a look at Justin Johnson’s <a href="https://github.com/jcjohnson/cnn-vis" target="_blank">cnn-vis</a>. And if you want to get your own Caffe installation up and running quickly (not to mention, one that has a web interface for deep dreaming), take a look a <a href="https://github.com/VISIONAI/clouddream" target="_blank">Tomasz’s docker instance</a>.</p>
<p>Anyway, I hope you enjoy the 
			<span id="crayon-56d59e0633e72584095503" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bat</span><span class="crayon-o">-</span><span class="crayon-v">country</span></span></span> ! Feel free to comment on this post with your own images generated using the package.</p>
	</section>
	</div></body></html>