<html><body><div><div class="entry-content">
		<p>In <a title="Simple Python Facebook Scraper: Part 1" href="http://simplebeautifuldata.com/2014/08/25/simple-python-facebook-scraper-part-1/">Simple Python Facebook Scraper: Part 1</a>, we wrote a very basic web scraper that grabbed data from 4 company pages and printed them to console. In Part 2 of this tutorial, we will create a database and add a way to load data into our database from our simple website scraper script.</p>
<p><strong>Step 1: Run the Database Creation Script</strong></p>
<p>First we will need to run our database creation script. To do this we will need to open up a session with MySQL, and run the below script. Please note that if you are running anything less than MySQL 5.6, you will receive an error associated with the creation of column <em>time_collected</em>. If you receive this error, here are some good resource on how to upgrade your MySQL installation. <a title="Upgrade MySQL" href="http://xmodulo.com/2013/12/upgrade-mysql-server-debian-ubuntu.html">Ubuntu/Linux </a>and <a title="Upgrade MySQL" href="http://dev.mysql.com/doc/refman/5.6/en/windows-upgrading.html">Windows</a>.</p>

		<div id="crayon-56d5c6d1ea4d3083024967" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c6d1ea4d3083024967-1"><span class="crayon-c">--create our database to store Facebook Data</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4d3083024967-2"><span class="crayon-k">CREATE</span><span class="crayon-h"> </span><span class="crayon-k">DATABASE</span><span class="crayon-h"> </span><span class="crayon-i">facebook_data</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4d3083024967-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4d3083024967-4"><span class="crayon-c">--create our table to store the data</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4d3083024967-5"><span class="crayon-k">USE</span><span class="crayon-h"> </span><span class="crayon-i">facebook_data</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4d3083024967-6"><span class="crayon-k">CREATE</span><span class="crayon-h"> </span><span class="crayon-k">TABLE</span><span class="crayon-h"> </span><span class="crayon-e">page_info</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4d3083024967-7"><span class="crayon-h">    </span><span class="crayon-i">id</span><span class="crayon-h"> </span><span class="crayon-k">INT</span><span class="crayon-h"> </span><span class="crayon-k ">NOT</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-h"> </span><span class="crayon-k">PRIMARY</span><span class="crayon-h"> </span><span class="crayon-k">KEY</span><span class="crayon-h"> </span><span class="crayon-i">AUTO_INCREMENT</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4d3083024967-8"><span class="crayon-h">    </span><span class="crayon-i">fb_id</span><span class="crayon-h"> </span><span class="crayon-t">BIGINT</span><span class="crayon-h"> </span><span class="crayon-i">UNSIGNED</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4d3083024967-9"><span class="crayon-h">    </span><span class="crayon-i">likes</span><span class="crayon-h"> </span><span class="crayon-t">BIGINT</span><span class="crayon-h"> </span><span class="crayon-i">UNSIGNED</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4d3083024967-10"><span class="crayon-h">    </span><span class="crayon-i">talking_about</span><span class="crayon-h"> </span><span class="crayon-t">BIGINT</span><span class="crayon-h"> </span><span class="crayon-i">UNSIGNED</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4d3083024967-11"><span class="crayon-h">    </span><span class="crayon-i">username</span><span class="crayon-h"> </span><span class="crayon-k">VARCHAR</span><span class="crayon-sy">(</span><span class="crayon-cn">40</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4d3083024967-12"><span class="crayon-h">    </span><span class="crayon-i">time_collected</span><span class="crayon-h"> </span><span class="crayon-t">datetime</span><span class="crayon-h"> </span><span class="crayon-k ">NOT</span><span class="crayon-h"> </span><span class="crayon-k ">NULL</span><span class="crayon-h"> </span><span class="crayon-k">DEFAULT</span><span class="crayon-h"> </span><span class="crayon-e">NOW</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4d3083024967-13"><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Let’s go through this short SQL snippet. The first part is simply creating our database facebook_data. Nothing too special.</p>
<p>The second part is creating our only table that we will be inserting our page data into. The first column, id, will be an auto-incremented primary key.  This key will increment for every time we pull data from our pages. A singular page of interest will have many of these ids.</p>
<p>Columns fb_id through username, all correspond to the specific elements of the JSON object we were interested in from Part 1 of our simple website scraper. Please note, if you changed the data that we were pulling in Part 1 you will need to change these fields to match accordingly.</p>
<p>Finally, we will add a column that will log the time stamp for when our data is collected. Every time we add a new record to the database, we want to have an understanding of when the data was captured. This will be important if we want to look at a trend of likes or talking about for a specific page over time.</p>
<p><strong>Step 2: Add the Database Connection</strong></p>
<p>Now that we have the database facebook_data created, we need to add a database connection to our MySQL database from our simple website scraper. Add the import for mysql.connector. If you are having trouble with this import, or do not have the Python MySQL connector installed, check <a title="MySQL Python Connector" href="http://dev.mysql.com/downloads/connector/python/">here</a>. Next copy the below snippet and paste it above your main function. You should already have imported libraries urllib2 and json.</p>

		<div id="crayon-56d5c6d1ea4e4976482201" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c6d1ea4e4976482201-1"><span class="crayon-e">import </span><span class="crayon-e">urllib2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4e4976482201-2"><span class="crayon-e">import </span><span class="crayon-e">json</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4e4976482201-3"><span class="crayon-e">import </span><span class="crayon-v">mysql</span><span class="crayon-sy">.</span><span class="crayon-e">connector</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4e4976482201-4"> </p><p class="crayon-line" id="crayon-56d5c6d1ea4e4976482201-5"><span class="crayon-e">def </span><span class="crayon-e">connect_db</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4e4976482201-6">  <span class="crayon-h"> </span> <span class="crayon-p">#fill this out with your db connection info</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4e4976482201-7">  <span class="crayon-h"> </span> <span class="crayon-v">connection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">mysql</span><span class="crayon-sy">.</span><span class="crayon-v">connector</span><span class="crayon-sy">.</span><span class="crayon-e">connect</span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-o">=</span><span class="crayon-s">'JohnDoe'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-o">=</span><span class="crayon-s">'abc123'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4e4976482201-8">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">host</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'127.0.0.1'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4e4976482201-9">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">database</span><span class="crayon-o">=</span><span class="crayon-s">'facebook_data'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4e4976482201-10">  <span class="crayon-h"> </span> <span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">connection</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>In the above code, simply edit the user and password to be your own. Variables <em>host</em> and <em>database</em> should stay the same, provided you are running MySQL locally.</p>
<p>Now let’s use our connect_db function in our main function. Paste the following code that creates our database connection:</p>

		<div id="crayon-56d5c6d1ea4eb114406788" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c6d1ea4eb114406788-1"><span class="crayon-e">def </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4eb114406788-2"> </p><p class="crayon-line" id="crayon-56d5c6d1ea4eb114406788-3"><span class="crayon-h">    </span><span class="crayon-p">#e.g. http://facebook.com/walmart, walmart is the username</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4eb114406788-4"><span class="crayon-h">    </span><span class="crayon-v">list_companies</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">"walmart"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"cisco"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"Target"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"facebook"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4eb114406788-5"><span class="crayon-h">    </span><span class="crayon-v">graph_url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"http://graph.facebook.com/"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4eb114406788-6"><span class="crayon-h">    </span></p><p class="crayon-line" id="crayon-56d5c6d1ea4eb114406788-7"><span class="crayon-h">    </span><span class="crayon-p">#create db connection</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4eb114406788-8"><span class="crayon-h">    </span><span class="crayon-v">connection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">connect_db</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4eb114406788-9"><span class="crayon-h">    </span><span class="crayon-v">cursor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">cursor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Now we have established a connection to our database and are ready to move to the next step of inserting data.</p>
<p><strong>Step 3: Inserting Data into the Database</strong></p>
<p>To start, we will need to add an insert statement. Above our for loop, let’s add the following variable assignment of <em>add_fb_info</em>:</p>

		<div id="crayon-56d5c6d1ea4f0700465867" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c6d1ea4f0700465867-1">   <span class="crayon-h"> </span><span class="crayon-c">#SQL statement for adding Facebook database</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f0700465867-2">  <span class="crayon-h"> </span> <span class="crayon-v">insert_info</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">"INSERT INTO page_info "</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4f0700465867-3">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span><span class="crayon-s">"(fb_id, likes, talking_about, username)"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f0700465867-4">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span><span class="crayon-s">"VALUES (%s, %s, %s, %s)"</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This statement takes 4 variables, that we will pass in later, and inserts them into our fb_id, likes, talking_about and username columns of our database. But what about the data for id and timestamp columns? Don’t worry, the id and time stamp column will be inserted auto-magically when we insert our data from the Facebook page.</p>
<p>Now let’s actually use the above statement to insert the data that our website scraper collects. In our for loop, under our print out of our JSON object, lets add the following code:</p>

		<div id="crayon-56d5c6d1ea4f6477717719" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-1"><span class="crayon-h">        </span><span class="crayon-c">#gather our JSON Data</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f6477717719-2"><span class="crayon-h">        </span><span class="crayon-v">page_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"likes"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-3"><span class="crayon-h">                     </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"talking_about_count"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f6477717719-4"><span class="crayon-h">                     </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"username"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-5"><span class="crayon-h">                     </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f6477717719-6"><span class="crayon-h">        </span><span class="crayon-c">#insert the data we pulled into db</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-7"><span class="crayon-h">        </span><span class="crayon-v">cursor</span><span class="crayon-sy">.</span><span class="crayon-e">execute</span><span class="crayon-sy">(</span><span class="crayon-v">insert_info</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">page_data</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f6477717719-8"> </p><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-9"><span class="crayon-h">        </span><span class="crayon-c">#commit the data to the db</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f6477717719-10"><span class="crayon-h">        </span><span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">commit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-11"><span class="crayon-h">        </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f6477717719-12"><span class="crayon-h">    </span><span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4f6477717719-14"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"__main__"</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4f6477717719-15"><span class="crayon-h">    </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Above you can see that we create a tuple called <em>page_data</em>. In our tuple <em>page_data</em>, there are 4 values, each of these will correspond to the variables from our SQL statement.  Similar to how we can see the values change in our console when it is printed, the values of our tuple will also change as we iterate through our list of companies.</p>
<p>Next, we use the cursor object to execute our SQL statement and pass in the values of our tuple <em>page_data</em>. Once the page data is inserted we then use the connection commit method to save the data to the database.</p>
<p>Finally, we jump out of the for loop and we close the connection of our database. This closes the session our simple Facebook scraper script has with our database.</p>
<p><strong>Step 4: Putting it all Together</strong></p>
<p>Altogether, our code should look something similar to the following:</p>

		<div id="crayon-56d5c6d1ea4fc760306238" class="crayon-syntax crayon-theme-familiar crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-2">2</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-4">4</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-6">6</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-8">8</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-10">10</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-12">12</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-14">14</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-16">16</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-18">18</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-20">20</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-22">22</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-24">24</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-26">26</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-28">28</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-30">30</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-32">32</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-34">34</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-36">36</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-38">38</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-40">40</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-42">42</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-44">44</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-46">46</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-48">48</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-50">50</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-52">52</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-54">54</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-56">56</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-58">58</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-60">60</p><p class="crayon-num" data-line="crayon-56d5c6d1ea4fc760306238-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5c6d1ea4fc760306238-62">62</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-1"><span class="crayon-e">import </span><span class="crayon-e">urllib2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-2"><span class="crayon-e">import </span><span class="crayon-e">json</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-3"><span class="crayon-e">import </span><span class="crayon-v">mysql</span><span class="crayon-sy">.</span><span class="crayon-e">connector</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-4"> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-5"><span class="crayon-e">def </span><span class="crayon-e">connect_db</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-6">  <span class="crayon-h"> </span> <span class="crayon-p">#fill this out with your db connection info</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-7">  <span class="crayon-h"> </span> <span class="crayon-v">connection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">mysql</span><span class="crayon-sy">.</span><span class="crayon-v">connector</span><span class="crayon-sy">.</span><span class="crayon-e">connect</span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-o">=</span><span class="crayon-s">'JohnDoe'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-o">=</span><span class="crayon-s">'abc123'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-8">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">host</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'127.0.0.1'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-9">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-v">database</span><span class="crayon-o">=</span><span class="crayon-s">'facebook_data'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-10">  <span class="crayon-h"> </span> <span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">connection</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-12"> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-13"><span class="crayon-e">def </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-14">  <span class="crayon-h"> </span> <span class="crayon-p">#to find go to page's FB page, at the end of URL find username</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-15">  <span class="crayon-h"> </span> <span class="crayon-p">#e.g. http://facebook.com/walmart, walmart is the username</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-16">  <span class="crayon-h"> </span> <span class="crayon-v">list_companies</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">"walmart"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"cisco"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"pepsi"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"facebook"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-17">  <span class="crayon-h"> </span> <span class="crayon-v">graph_url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"http://graph.facebook.com/"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-18"> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-19">  <span class="crayon-h"> </span> <span class="crayon-p">#create db connection</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-20">  <span class="crayon-h"> </span> <span class="crayon-v">connection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">connect_db</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-21">  <span class="crayon-h"> </span> <span class="crayon-v">cursor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">cursor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-22">  <span class="crayon-h"> </span> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-23">  <span class="crayon-h"> </span> <span class="crayon-p">#SQL statement for adding info to database</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-24">  <span class="crayon-h"> </span> <span class="crayon-v">insert_info</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">"INSERT INTO page_info "</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-25">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span><span class="crayon-s">"(fb_id, likes, talking_about, username)"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-26">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span><span class="crayon-s">"VALUES (%s, %s, %s, %s)"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-27"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-28">  <span class="crayon-h"> </span> <span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">company </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">list_companies</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-29">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-p">#make graph api url with company username</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-30">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-v">current_page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">graph_url</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">company</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-31">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-32">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-p">#open public page in facebook graph api</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-33">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-v">web_response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">urlopen</span><span class="crayon-sy">(</span><span class="crayon-v">current_page</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-34">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-v">readable_page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">web_response</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-35">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-v">json_fbpage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">loads</span><span class="crayon-sy">(</span><span class="crayon-v">readable_page</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-36">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-37">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-p">#print page data to console</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-38">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-e">print </span><span class="crayon-v">company</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">" page"</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-39">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-e">print </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-40">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-e">print </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"likes"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-41">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-e">print </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"talking_about_count"</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-42">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-e">print </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"link"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-43">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-e">print </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"username"</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-44">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-e">print </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"website"</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-45">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"            "</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-46">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-47"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-48">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-p">#gather our JSON Data</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-49">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-v">page_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"id"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"likes"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-50">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>     <span class="crayon-h"> </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"talking_about_count"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-51">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>     <span class="crayon-h"> </span><span class="crayon-v">json_fbpage</span><span class="crayon-sy">[</span><span class="crayon-s">"username"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-52">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>   <span class="crayon-h"> </span>    <span class="crayon-h"> </span> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-53">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-p">#insert the data we pulled into db</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-54">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-v">cursor</span><span class="crayon-sy">.</span><span class="crayon-e">execute</span><span class="crayon-sy">(</span><span class="crayon-v">insert_info</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">page_data</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-55"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-56">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-p">#commit the data to the db</span></p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-57">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> <span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">commit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-58">  <span class="crayon-h"> </span>   <span class="crayon-h"> </span> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-59">  <span class="crayon-h"> </span> <span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-60"> </p><p class="crayon-line" id="crayon-56d5c6d1ea4fc760306238-61"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"__main__"</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5c6d1ea4fc760306238-62">  <span class="crayon-h"> </span> <span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Now, let’s save and run the code. If all goes well you should see no errors :). If we open up a session with MySQL, and run a ( <em>SELECT * FROM page_info; ) </em>we should see the rows of the data that we have collected. Run our simple Facebook scraper script again, and we should see more rows in our database.</p>
<p><strong class="lang:python decode:true ">Summary</strong></p>
<p>In this tutorial we learned how to scrape public data from a Facebook page and insert it into a database. This data can be used to monitor both your page or competitors’ pages on Facebook.</p>
<p>I hope you enjoyed this example. In our next set of tutorials, we build upon Part 1 and Part 2 of our Simple Python Facebook Scraper, and will go through how to authenticate and collect post information. We will then use NLTK to run some simple semantic analysis on these posts.</p>
<p> </p>

<p class="chitika-adspace below">


</p>			</div>

	</div></body></html>