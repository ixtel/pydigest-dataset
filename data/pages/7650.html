<html><body><div><p>PyBankID is a client for performing BankID signing.</p>
<p>The Swedish BankID solution for digital signing uses a SOAP
connection solution, and this module aims at providing a simplifying
client for making authentication, signing and collect requests to
the BankID servers.</p>
<div id="usage">
<h2>Usage</h2>
<p>First, create a BankIDClient:</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">bankid</span> <span class="kn">import</span> <span class="n">BankIDClient</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span> <span class="o">=</span> <span class="n">BankIDClient</span><span class="p">(</span><span class="n">certificates</span><span class="o">=</span><span class="p">(</span><span class="s1">'path/to/certificate.pem'</span><span class="p">,</span>
                                        <span class="s1">'path/to/key.pem'</span><span class="p">))</span>
</pre>
<p>Connection to production server is the default in the client. If test
server is desired, send in the <tt>test_server=True</tt> keyword in the init
of the client.</p>
<p>A sign order is then placed by</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">user_visible_data</span><span class="o">=</span><span class="s2">"The information to sign."</span><span class="p">,</span>
                <span class="n">personal_number</span><span class="o">=</span><span class="s2">"YYYYMMDDXXXX"</span><span class="p">)</span>
<span class="p">{</span><span class="s1">u'autoStartToken'</span><span class="p">:</span> <span class="s1">u'798c1ea1-e67a-4df6-a2f6-164ac223fd52'</span><span class="p">,</span>
 <span class="s1">u'orderRef'</span><span class="p">:</span> <span class="s1">u'a9b791c3-459f-492b-bf61-23027876140b'</span><span class="p">}</span>
</pre>
<p>and an authentication order is initiated by</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">personal_number</span><span class="o">=</span><span class="s2">"YYYYMMDDXXXX"</span><span class="p">)</span>
<span class="p">{</span><span class="s1">u'autoStartToken'</span><span class="p">:</span> <span class="s1">u'798c1ea1-e67a-4df6-a2f6-164ac223fd52'</span><span class="p">,</span>
 <span class="s1">u'orderRef'</span><span class="p">:</span> <span class="s1">u'a9b791c3-459f-492b-bf61-23027876140b'</span><span class="p">}</span>
</pre>
<p>The status of an order can then be studied by polling
with the <tt>collect</tt> method using the received <tt>orderRef</tt>:</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">order_ref</span><span class="o">=</span><span class="s2">"a9b791c3-459f-492b-bf61-23027876140b"</span><span class="p">)</span>
<span class="p">{</span><span class="s1">u'progressStatus'</span><span class="p">:</span> <span class="s1">u'OUTSTANDING_TRANSACTION'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">order_ref</span><span class="o">=</span><span class="s2">"a9b791c3-459f-492b-bf61-23027876140b"</span><span class="p">)</span>
<span class="p">{</span><span class="s1">u'progressStatus'</span><span class="p">:</span> <span class="s1">u'USER_SIGN'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">order_ref</span><span class="o">=</span><span class="s2">"a9b791c3-459f-492b-bf61-23027876140b"</span><span class="p">)</span>
<span class="p">{</span><span class="s1">u'ocspResponse'</span><span class="p">:</span> <span class="s1">u'MIIHfgoBAKCCB3cw[...]'</span><span class="p">,</span>
 <span class="s1">u'progressStatus'</span><span class="p">:</span> <span class="s1">u'COMPLETE'</span><span class="p">,</span>
 <span class="s1">u'signature'</span><span class="p">:</span> <span class="s1">u'PD94bWwgdmVyc2lvbj0[...]'</span><span class="p">,</span>
 <span class="s1">u'userInfo'</span><span class="p">:</span> <span class="p">{</span><span class="s1">u'givenName'</span><span class="p">:</span> <span class="s1">u'Namn'</span><span class="p">,</span>
              <span class="s1">u'ipAddress'</span><span class="p">:</span> <span class="s1">u'195.84.248.212'</span><span class="p">,</span>
              <span class="s1">u'name'</span><span class="p">:</span> <span class="s1">u'Namn Namsson'</span><span class="p">,</span>
              <span class="s1">u'notAfter'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">),</span>
              <span class="s1">u'notBefore'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
              <span class="s1">u'personalNumber'</span><span class="p">:</span> <span class="s1">u'YYYYMMDDXXXX'</span><span class="p">,</span>
              <span class="s1">u'surname'</span><span class="p">:</span> <span class="s1">u'Namnsson'</span><span class="p">}}</span>
</pre>
<p>The <tt>collect</tt> should be used sparingly, as not to burden the server unnecessarily.</p>
<div id="python-2-urllib3-and-certificate-verification">
<h3>Python 2, urllib3 and certificate verification</h3>
<p>An <cite>InsecurePlatformWarning</cite> is issued when using the client in Python 2 (See
<a href="https://urllib3.readthedocs.org/en/latest/security.html#insecureplatformwarning" rel="nofollow">urllib3 documentation</a>).
This can be remedied by installing pyopenssl according to
<a href="https://github.com/kennethreitz/requests/issues/749" rel="nofollow">this issue</a> and
<a href="https://github.com/kennethreitz/requests/blob/master/requests/packages/urllib3/contrib/pyopenssl.py" rel="nofollow">docstrings in requests</a>.</p>
<p>Optionally, the environment variable <cite>PYBANKID_DISABLE_WARNINGS</cite> can be set to disable these warnings.</p>
</div>
</div>
</div></body></html>