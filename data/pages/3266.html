<html><body><div><div class="entry-content">
                    <p>I can never remember the syntax for writing <a class="reference external" href="http://en.wikipedia.org/wiki/Python_syntax_and_semantics#Decorators">decorators</a>. I always have to look it up. Worse, I always have to remember where to look to find references. Hence the reason for this article. I'll never lose this reference: It's on my laptop and the internet.</p>
<p>Each type will include a basic version, a <tt class="docutils literal">functools.wraps</tt> version, and a <a class="reference external" href="https://github.com/GrahamDumpleton/wrapt">wrapt</a> version.</p>
<div class="section" id="decorators-without-arguments">
<h2>Decorators Without Arguments</h2>
<p>These are decorators that do not accept arguments.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">functools</span>  <span class="c"># Part of Python standard library</span>

<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># do something before the function call</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># do something after the function call</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">_wrapper</span>

<span class="c"># decorator with functools.wraps added</span>
<span class="k">def</span> <span class="nf">decorator_with_wraps</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">):</span>
    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># do something before the function call</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># do something after the function call</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">_wrapper</span>

<span class="kn">import</span> <span class="nn">wrapt</span>  <span class="c"># Requires installing the 'wrapt' library</span>

<span class="c"># decorator powered by wrapt</span>
<span class="nd">@wrapt.decorator</span>
<span class="k">def</span> <span class="nf">decorator_with_wrapt</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="c"># do something before the function call</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c"># do something after the function call</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">test_decorators</span><span class="p">():</span>

    <span class="nd">@decorator</span>
    <span class="k">def</span> <span class="nf">func1</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">'I'</span>

    <span class="nd">@decorator_with_wraps</span>
    <span class="k">def</span> <span class="nf">func2</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">'code'</span>

    <span class="nd">@decorator_with_wrapt</span>
    <span class="k">def</span> <span class="nf">func3</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">'python'</span>

    <span class="k">assert</span> <span class="n">func1</span><span class="p">()</span> <span class="o">==</span> <span class="s">'I'</span>
    <span class="k">assert</span> <span class="n">func2</span><span class="p">()</span> <span class="o">==</span> <span class="s">'code'</span>
    <span class="k">assert</span> <span class="n">func3</span><span class="p">()</span> <span class="o">==</span> <span class="s">'python'</span>
</pre></div>
</div>
<div class="section" id="decorators-with-arguments">
<h2>Decorators With Arguments</h2>
<p>These are decorators that accept arguments.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">arguments_decorator</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_outer_wrapper</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c"># do something before the function call</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c"># do something after the function call</span>

            <span class="c"># Demonstrating what you can do with decorator arguments</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">arg1</span> <span class="o">*</span> <span class="n">arg2</span>

            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">_wrapper</span>
    <span class="k">return</span> <span class="n">_outer_wrapper</span>

<span class="k">def</span> <span class="nf">arguments_decorator_with_wraps</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_outer_wrapper</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">):</span>
        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c"># do something before the function call</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c"># do something after the function call</span>

            <span class="c"># Demonstrating what you can do with decorator arguments</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">arg1</span> <span class="o">*</span> <span class="n">arg2</span>

            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">_wrapper</span>
    <span class="k">return</span> <span class="n">_outer_wrapper</span>

<span class="k">def</span> <span class="nf">arguments_decorator_with_wrapt</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="nd">@wrapt.decorator</span>
    <span class="k">def</span> <span class="nf">_wrapper</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># do something before the function call</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># do something after the function call</span>

        <span class="c"># Demonstrating what you can do with decorator arguments</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">arg1</span> <span class="o">*</span> <span class="n">arg2</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">_wrapper</span>


<span class="k">def</span> <span class="nf">test_arguments_decorators</span><span class="p">():</span>

    <span class="nd">@arguments_decorator</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">func4</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">'We'</span>

    <span class="nd">@arguments_decorator_with_wraps</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">func5</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">'code'</span>

    <span class="nd">@arguments_decorator_with_wrapt</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">func6</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">'python'</span>

    <span class="k">assert</span> <span class="n">func4</span><span class="p">()</span> <span class="o">==</span> <span class="s">'WeWeWeWeWeWe'</span>
    <span class="k">assert</span> <span class="n">func5</span><span class="p">()</span> <span class="o">==</span> <span class="s">'codecodecodecode'</span>
    <span class="k">assert</span> <span class="n">func6</span><span class="p">()</span> <span class="o">==</span> <span class="s">'pythonpythonpythonpythonpythonpython'</span>
</pre></div>
</div>
<div class="section" id="summary">
<h2>Summary</h2>
<p>This article is a cheatsheet, not a tutorial.</p>
<p>Instead of explaining why Python has <a class="reference external" href="http://en.wikipedia.org/wiki/Python_syntax_and_semantics#Decorators">decorators</a>, how to use them, how they work, or why to use them, this article is a reference. Nothing more.</p>
<p>References:</p>

<img alt="http://pydanny.com/static/sample-rst.png" class="align-center" id="packages" src="http://pydanny.com/static/sample-rst.png"/>
</div>

                    
                </div>
                                </div></body></html>