<html><body><div><div class="pf-content"><p>Recently I’ve started learning about Kivy, a Python Natural User Interface (NUI) toolkit. As I understand it, Kivy is kind of a spiritual successor to <a href="http://pymt.eu/" target="_blank">pyMT</a>, which you can read more about <a href="http://kivy.org/docs/faq.html#how-is-kivy-related-to-pymt" target="_blank">here</a>. In this article, we will be learning how Kivy handles layout management. While you can position widgets using x/y coordinates, in every GUI toolkit I’ve used, it’s almost always better to use some kind of layout management that the toolkit provides. This allows the widgets to resize and move appropriately as the user changes the window’s size. In Kivy, these things <strong>Layouts</strong>. If you’ve used wxPython, they are analogous to wxPython’s sizers.</p>
<p>I should also note that Kivy can do layouts in two different ways. The first way is to do Layouts with Python code only. The second way is to use a mixture of Python and Kv language. This is to promote the model-view-controller way of doing things. It looks kind of like CSS and reminds me a little of wxPython and XRC. We will look at how to use both methods in this article. While Kivy supports multiple types of Layouts, this article will be focusing only on the <strong>BoxLayout</strong>. We will show how to nest BoxLayouts.<span id="more-3543"/></p>
<h3>Kivy, Python and BoxLayout</h3>
<p>
</p><p><a href="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_hboxlayout.png"><img src="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_hboxlayout-300x236.png" alt="kivy_hboxlayout" class="aligncenter size-medium wp-image-3559" srcset="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_hboxlayout-300x236.png 300w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_hboxlayout-150x118.png 150w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_hboxlayout.png 818w" sizes="(max-width: 300px) 100vw, 300px"/></a></p>
<p>Creating a BoxLayout in Kivy using Python is actually pretty easy and quite intuitive. We’ll start out with a code example and then follow the code with an explanation. Let’s get started!</p>
<pre class="python"><span>import</span> kivy
<span>import</span> <span>random</span>
 
<span>from</span> kivy.<span>app</span> <span>import</span> App
<span>from</span> kivy.<span>uix</span>.<span>button</span> <span>import</span> Button
<span>from</span> kivy.<span>uix</span>.<span>boxlayout</span> <span>import</span> BoxLayout
 
red = <span>[</span><span>1</span>,<span>0</span>,<span>0</span>,<span>1</span><span>]</span>
green = <span>[</span><span>0</span>,<span>1</span>,<span>0</span>,<span>1</span><span>]</span>
blue =  <span>[</span><span>0</span>,<span>0</span>,<span>1</span>,<span>1</span><span>]</span>
purple = <span>[</span><span>1</span>,<span>0</span>,<span>1</span>,<span>1</span><span>]</span>
 
<span>########################################################################</span>
<span>class</span> HBoxLayoutExample<span>(</span>App<span>)</span>:
    <span>""</span><span>"
    Horizontally oriented BoxLayout example class
    "</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> build<span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>"
        Horizontal BoxLayout example
        "</span><span>""</span>
        layout = BoxLayout<span>(</span>padding=<span>10</span><span>)</span>
        colors = <span>[</span>red, green, blue, purple<span>]</span>
 
        <span>for</span> i <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span>:
            btn = Button<span>(</span>text=<span>"Button #%s"</span> <span>%</span> <span>(</span>i<span>+1</span><span>)</span>,
                         background_color=<span>random</span>.<span>choice</span><span>(</span>colors<span>)</span>
                         <span>)</span>
 
            layout.<span>add_widget</span><span>(</span>btn<span>)</span>
        <span>return</span> layout
 
<span>########################################################################</span>
<span>class</span> VBoxLayoutExample<span>(</span>App<span>)</span>:
    <span>""</span><span>"
    Vertical oriented BoxLayout example class
    "</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> setOrientation<span>(</span><span>self</span>, orient<span>)</span>:
        <span>""</span><span>""</span><span>""</span>
        <span>self</span>.<span>orient</span> = orient
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> build<span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>""</span><span>""</span>
        layout = BoxLayout<span>(</span>padding=<span>10</span>, orientation=<span>self</span>.<span>orient</span><span>)</span>
 
        <span>for</span> i <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span>:
            btn = Button<span>(</span>text=<span>"Button #%s"</span> <span>%</span> <span>(</span>i<span>+1</span><span>)</span> <span>)</span>
            layout.<span>add_widget</span><span>(</span>btn<span>)</span>
        <span>return</span> layout
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    app = HBoxLayoutExample<span>(</span><span>)</span>
    <span>#app = VBoxLayoutExample()</span>
    <span>#app.setOrientation(orient="vertical")</span>
    app.<span>run</span><span>(</span><span>)</span></pre>
<p>Here we have created a vertically oriented BoxLayout class and a horizontally oriented BoxLayout class. Each class contains 5 buttons with random background colors. The colors follow RGBA, but can have individual values that are between zero and one. Oddly enough, if you use numbers greater than one, the color becomes brighter. I happened to use 255 instead of 1 when I created the screenshot above, so if you happen to run this code and see a more muted set of colors, that’s why.</p>
<p>To make the examples extremely simple, we only import Kivy’s App, Button and BoxLayout classes. The BoxLayout class accepts several arguments, but we’ll focus on the following 3: orientation, padding and spacing. Because BoxLayout is a sub-class of Layout and Widget, it inherits many other methods and keyword arguments that are not covered here. But back to the arguments we currently care about. The <strong>padding</strong> argument tells Kivy how much space there should be between the Layout and its children, whereas the <strong>spacing</strong> arguments tells it how much spacing there should be between the children.</p>
<p>To create the buttons, we use a simple loop that loops over a small range of numbers. Each iteration creates a button with a random background color and adds that button to the Layout instance. Then we return the layout at the end.</p>
<p>The vertical BoxLayout example in the <strong>VBoxLayoutExample</strong> class is slightly different in that I thought it would be fun to be able to set the orientation programmatically. The code is pretty much the same except that I added a <strong>setOrientation</strong> method. Note that if you call setOrientation again, it will have no effect. As one of my commenters so kindly pointed out, you would need to bind the orientation to the App orient property or use the Kv language to achieve this.</p>
<p>If you comment out the call to <strong>HBoxLayoutExample</strong> at the end of the script and un-comment out the other two lines, then you should end up seeing something like this:</p>
<p><a href="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox.png"><img src="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox-300x236.png" alt="kivy_vbox" class="aligncenter size-medium wp-image-3566" srcset="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox-300x236.png 300w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox-150x118.png 150w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox.png 818w" sizes="(max-width: 300px) 100vw, 300px"/></a></p>
<p>Notice that when you don’t set a background color, Kivy defaults to a dark grey. Kivy does not try to look like a native application. This may or may not be a big deal to you depending on what sort of program you’re trying to achieve, but it should be noted. Now we’re ready to learn about nesting!</p>
<h3>Nesting BoxLayouts</h3>
<p>
</p><p><a href="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_nested_boxlayout.png"><img src="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_nested_boxlayout-300x236.png" alt="kivy_nested_boxlayout" class="aligncenter size-medium wp-image-3561" srcset="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_nested_boxlayout-300x236.png 300w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_nested_boxlayout-150x118.png 150w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_nested_boxlayout.png 818w" sizes="(max-width: 300px) 100vw, 300px"/></a></p>
<p>Nesting BoxLayouts inside of each other is pretty easy with Kivy too. Whenever you go to create an application with a complicated interface that will need nested sizers, you should take some time to sketch the layout out with pencil and paper. Then you can draw boxes around the widgets in different ways to help you visualize which Layouts you’ll need and how to nest them in each other. I have found this quite helpful with wxPython and I think it applies to any other GUI toolkit that doesn’t have a WYSIWYG editor. By the way, BoxLayouts are very powerful. If you know what you’re doing, you can make just about any interface with them alone just be using clever nesting.</p>
<p>Enough talk, let’s look at some code!</p>
<pre class="python"><span>import</span> kivy
<span>import</span> <span>random</span>
 
<span>from</span> kivy.<span>app</span> <span>import</span> App
<span>from</span> kivy.<span>uix</span>.<span>button</span> <span>import</span> Button
<span>from</span> kivy.<span>uix</span>.<span>boxlayout</span> <span>import</span> BoxLayout
 
red = <span>[</span><span>1</span>,<span>0</span>,<span>0</span>,<span>1</span><span>]</span>
green = <span>[</span><span>0</span>,<span>1</span>,<span>0</span>,<span>1</span><span>]</span>
blue =  <span>[</span><span>0</span>,<span>0</span>,<span>1</span>,<span>1</span><span>]</span>
purple = <span>[</span><span>1</span>,<span>0</span>,<span>1</span>,<span>1</span><span>]</span>
 
<span>########################################################################</span>
<span>class</span> NestedLayoutExample<span>(</span>App<span>)</span>:
    <span>""</span><span>"
    An example of nesting three horizontally oriented BoxLayouts inside
    of one vertically oriented BoxLayout
    "</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> build<span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>"
        Horizontal BoxLayout example
        "</span><span>""</span>
        main_layout = BoxLayout<span>(</span>padding=<span>10</span>, orientation=<span>"vertical"</span><span>)</span>
 
        colors = <span>[</span>red, green, blue, purple<span>]</span>
 
        <span>for</span> i <span>in</span> <span>range</span><span>(</span><span>3</span><span>)</span>:
            h_layout = BoxLayout<span>(</span>padding=<span>10</span><span>)</span>
            <span>for</span> i <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span>:
                btn = Button<span>(</span>text=<span>"Button #%s"</span> <span>%</span> <span>(</span>i<span>+1</span><span>)</span>,
                             background_color=<span>random</span>.<span>choice</span><span>(</span>colors<span>)</span>
                             <span>)</span>
 
                h_layout.<span>add_widget</span><span>(</span>btn<span>)</span>
            main_layout.<span>add_widget</span><span>(</span>h_layout<span>)</span>
 
        <span>return</span> main_layout
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    app = NestedLayoutExample<span>(</span><span>)</span>
    app.<span>run</span><span>(</span><span>)</span></pre>
<p>This example is very similar to the last one. The devil is in the details though. Here we have a nested for loop that creates 3 BoxLayouts that contain 5 buttons a piece. Each Layout is then inserted into the top level Layout at the end of each iteration in the outside loop. In case you missed it, scroll back up to see how it turned out. The trick is to create one top-level or main Layout and add other Layouts to it. Now let’s turn our attention to learning how to do these things with the Kv language.</p>
<h3>Kv+Python and BoxLayout</h3>
<p>
</p><p><a href="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox.png"><img src="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox-300x236.png" alt="kivy_vbox" class="aligncenter size-medium wp-image-3566" srcset="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox-300x236.png 300w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox-150x118.png 150w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kivy_vbox.png 818w" sizes="(max-width: 300px) 100vw, 300px"/></a></p>
<p>It’s almost always a little painful to learn a new language. Fortunately, the Kv language actually follows Python pretty closely, including Python’s requirement of using indentation levels to denote when a section of code begins and ends. You may want to spend a few minutes reading about the Kv language on the <a href="http://kivy.org/docs/guide/lang.html" target="_blank">Kivy website</a>. Whenever you’re ready, we can continue. First we’ll start off with the Python code:</p>
<pre class="python"><span># kvboxlayout.py</span>
 
<span>from</span> kivy.<span>app</span> <span>import</span> App
<span>from</span> kivy.<span>uix</span>.<span>boxlayout</span> <span>import</span> BoxLayout
 
<span>########################################################################</span>
<span>class</span> KVMyHBoxLayout<span>(</span>BoxLayout<span>)</span>:
    <span>pass</span>
 
<span>########################################################################</span>
<span>class</span> KVBoxLayoutApp<span>(</span>App<span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> build<span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>""</span><span>""</span>
        <span>return</span> KVMyHBoxLayout<span>(</span><span>)</span>
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    app = KVBoxLayoutApp<span>(</span><span>)</span>
    app.<span>run</span><span>(</span><span>)</span></pre>
<p>This code is much simpler than our previous examples, but it’s also rather mysterious. First of all, we create an empty sub-class of BoxLayout. Then we create our App class which has a <strong>build</strong> method that just returns an instance of the empty BoxLayout class. What’s going on here? Well we have to look at the Kv file to find out!</p>
<pre class="python"><span>&lt;</span>MyButton@Button<span>&gt;</span>:
    color: .<span>8</span>,.<span>9</span>,<span>0</span>,<span>1</span>
    font_size: <span>32</span>
 
<span>&lt;</span>BoxLayout<span>&gt;</span>:
    orientation: <span>'horizontal'</span>
    MyButton:
        text: <span>"Btn1"</span>
        background_color: <span>1</span>,<span>0</span>,<span>0</span>,<span>1</span>
    MyButton:
        text: <span>"Btn2"</span>
        background_color: <span>0</span>,<span>1</span>,<span>0</span>,<span>1</span>
    MyButton:
        text: <span>"Btn3"</span>
        background_color: <span>0</span>,<span>0</span>,<span>1</span>,<span>1</span>
    MyButton:
        text: <span>"Btn4"</span>
        background_color: <span>1</span>,<span>0</span>,<span>1</span>,<span>1</span>
    MyButton:
        text: <span>"Btn5"</span>
        background_color: <span>1</span>,<span>0</span>,<span>0</span>,<span>1</span></pre>
<p>When you save the code above, you’ll have to name it to be the same as the App class, but with a .kv instead of a .py and in lowercase. That means the name of this Kv file needs to be <strong>kvboxlayout.kv</strong>. You will note that you also need to strip off the App part of the class name such that KVBoxLayoutApp becomes kvboxlayout. Yes, it’s a little confusing. If you don’t follow the naming conventions correctly, the file will run but you will have an empty black window.</p>
<p>Anyway, first off in the Kv file, we have a section that starts with <strong><mybutton>:</mybutton></strong>. This tells Kivy that we are sub-classing the Button class and calling our sub-class <strong>MyButton</strong>. Then we indent the required four spaces and set the button’s label color and font size. Next we create a BoxLayout section. Notice that we didn’t create a sub-class this time. Then we tell it what orientation it should be and add 5 MyButton instances, each one having its own individual label and color. </p>
<p>One of the core Kivy developers pointed out that by creating the BoxLayout in this manner, I am redefining the BoxLayout for all usages. This is <strong>not</strong> a good thing, even if it does make the example simpler. Thus in the next example, we’ll stop doing that and do it the right way instead!</p>
<h4>Nesting BoxLayouts with Kv</h4>
<p>
</p><p><a href="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kv_nested_boxlayout.png"><img src="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kv_nested_boxlayout-300x236.png" alt="kv_nested_boxlayout" class="aligncenter size-medium wp-image-3568" srcset="http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kv_nested_boxlayout-300x236.png 300w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kv_nested_boxlayout-150x118.png 150w, http://www.blog.pythonlibrary.org/wp-content/uploads/2013/11/kv_nested_boxlayout.png 818w" sizes="(max-width: 300px) 100vw, 300px"/></a></p>
<p>Nesting BoxLayouts in Kv is a little confusing at first, but once you get the hang of it, you’ll find that it’s really quite easy. We’ll start out with the Python code, take a look at how it works and then look at the Kv code. </p>
<pre class="python"><span>from</span> kivy.<span>app</span> <span>import</span> App
<span>from</span> kivy.<span>uix</span>.<span>boxlayout</span> <span>import</span> BoxLayout
<span>from</span> kivy.<span>uix</span>.<span>widget</span> <span>import</span> Widget
 
<span>########################################################################</span>
<span>class</span> HBoxWidget<span>(</span>Widget<span>)</span>:
    <span>pass</span>
 
<span>########################################################################</span>
<span>class</span> VBoxWidget<span>(</span>Widget<span>)</span>:
    <span>pass</span>
 
<span>########################################################################</span>
<span>class</span> KVNestedBoxLayoutApp<span>(</span>App<span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> build<span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>""</span><span>""</span>
        <span>return</span> VBoxWidget<span>(</span><span>)</span>
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    app = KVNestedBoxLayoutApp<span>(</span><span>)</span>
    app.<span>run</span><span>(</span><span>)</span></pre>
<p>This time around, we need to create two generic Widget classes: HBoxWidget and VBoxWidget. These are actually dummy classes that become BoxLayouts in the Kv code. Speaking of which, let’s take a look at that now. Note that you’ll need to name the Kv file <strong>kvnestedboxlayout.kv</strong>, which you’ll note, is a lowercase version of <strong>KVNestedBoxLayoutApp</strong>.</p>
<pre class="python"><span>&lt;</span>MyButton@Button<span>&gt;</span>:
    color: .<span>8</span>,.<span>9</span>,<span>0</span>,<span>1</span>
    font_size: <span>32</span>
 
<span>&lt;</span>HBoxWidget<span>&gt;</span>:
    BoxLayout:
        size: root.<span>size</span>
        pos: root.<span>pos</span>
        orientation: <span>'horizontal'</span>
        MyButton:
            text: <span>"Btn1"</span>
            background_color: <span>1</span>,<span>1</span>,<span>1</span>,<span>1</span>
        MyButton:
            text: <span>"Btn2"</span>
            background_color: <span>0</span>,<span>1</span>,<span>0</span>,<span>1</span>
        MyButton:
            text: <span>"Btn3"</span>
            background_color: <span>0</span>,<span>0</span>,<span>1</span>,<span>1</span>
        MyButton:
            text: <span>"Btn4"</span>
            background_color: <span>1</span>,<span>0</span>,<span>1</span>,<span>1</span>
        MyButton:
            text: <span>"Btn2"</span>
            background_color: <span>1</span>,<span>0</span>,<span>0</span>,<span>1</span>
 
<span>&lt;</span>VBoxWidget<span>&gt;</span>:
    BoxLayout:
        size: root.<span>size</span>
        pos: root.<span>pos</span>
        <span>id</span>: foo_bar
        orientation: <span>'vertical'</span>
        HBoxWidget:
        HBoxWidget:</pre>
<p>The button code is the same as before. Next we have the <strong>HBoxWidget</strong> which we define as a horizontal BoxLayout with 5 buttons in it. Then we create an instance of <strong>VBoxWidget</strong> that is a vertical BoxLayout, but this Layout contains two instances of the HBoxWidget. You’ll note that in the Python code’s build method, we are returning the VBoxWidget, so that’s where the action is. If you remove those two HBoxWidget calls, the result will be an empty black window. </p>
<p>There is another way to use Kv files in Kivy. It is through the kivy.lang.Builder.load_file (or load_string) API, which gives you the ability to load Kv files without needing to remember to name the Kv file in some special way. You can read about the API on their <a href="http://kivy.org/docs/api-kivy.lang.html#kivy.lang.Builder" target="_blank">website</a> and see an example of it in action in the Kivy <a href="https://github.com/kivy/kivy/blob/master/examples/widgets/screenmanager.py" target="_blank">examples on github</a>. The only caveat to using this method is that you need to be careful not to load the same file twice or your UI may get messed up.</p>
<h3>Wrapping Up</h3>
<p>
</p><p>This just scratches the surface of Kivy’s Layout system. There are 6 other Layout types available. However, I think you’ll find that the examples in this article will get you started down the road of successfully creating cool Kivy applications of your very own. If you need help learning Kivy, there’s a pretty good set of documentation on their website. They also have a <a href="https://groups.google.com/forum/#!forum/kivy-users" target="_blank">Google Group</a> and a <a href="irc://freenode.net/kivy" target="_blank">#kivy channel</a> on freenode.</p>
<h3>Related Readings</h3>
<p>
</p>
<h3>Download the Source</h3>
<p>
</p>
</div>	</div></body></html>