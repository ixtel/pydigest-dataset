<html><body><div><div class="entry-content clearfix">







<p><a href="https://www.docker.com/">Docker</a> is a containerization tool used for spinning up isolated, reproducible application environments. <strong>This piece details how to containerize a Django Project, Postgres, and Redis for local development along with delivering the stack to the cloud via <a href="https://docs.docker.com/compose/">Docker Compose</a> and <a href="http://docs.docker.com/machine/">Docker Machine</a>.</strong></p>




<p>In the end, the stack will include a separate container for each service:</p>

<ul>
<li>1 web/Django container</li>
<li>1 nginx container</li>
<li>1 Postgres container</li>
<li>1 Redis container</li>
<li>1 data container</li>
</ul>















<p><em>Updates:</em></p>

<ul>
<li>12/27/2015: Updated to the latest versions of Docker – Docker client (v1.9.1), Docker compose (v1.5.2), and Docker Machine (v0.5.4) – and Python (v3.5)</li>
</ul>


<blockquote><p>Interested in creating a similar environment for Flask? Check out <a href="https://realpython.com/blog/python/dockerizing-flask-with-compose-and-machine-from-localhost-to-the-cloud/">this</a> blog post.</p></blockquote>

<a name="Local.Setup"/>
<h2>Local Setup</h2>

<p>Along with Docker (v1.9.1) we will be using –</p>

<ul>
<li><em><a href="https://docs.docker.com/compose/">Docker Compose</a></em> (v1.5.2) for orchestrating a multi-container application into a single app, and</li>
<li><em><a href="https://docs.docker.com/machine/">Docker Machine</a></em> (v0.5.4) for creating Docker hosts both locally and in the cloud.</li>
</ul>


<p>Follow the directions <a href="http://docs.docker.com/compose/install/">here</a> and <a href="https://docs.docker.com/machine/#installation">here</a> to install Docker Compose and Machine, respectively.</p>

<blockquote><p>Running either Mac OS X or Windows, then your best bet is to install <a href="https://www.docker.com/docker-toolbox">Docker Toolbox</a>.</p></blockquote>

<p>Test out the installs:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine --version
</span><span class="line">docker-machine version 0.5.4, build 6643d0e
</span><span class="line"><span class="nv">$ </span>docker-compose --version
</span><span class="line">docker-compose version 1.5.2, build 7240ff3
</span></code></pre></td></tr></table></div></figure>


<p>Next clone the project from the <a href="https://github.com/realpython/dockerizing-django">repository</a> or create your own project based on the project structure found on the repo:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">├── docker-compose.yml
</span><span class="line">├── nginx
</span><span class="line">│   ├── Dockerfile
</span><span class="line">│   └── sites-enabled
</span><span class="line">│       └── django_project
</span><span class="line">├── production.yml
</span><span class="line">└── web
</span><span class="line">    ├── Dockerfile
</span><span class="line">    ├── docker_django
</span><span class="line">    │   ├── __init__.py
</span><span class="line">    │   ├── apps
</span><span class="line">    │   │   ├── __init__.py
</span><span class="line">    │   │   └── todo
</span><span class="line">    │   │       ├── __init__.py
</span><span class="line">    │   │       ├── admin.py
</span><span class="line">    │   │       ├── models.py
</span><span class="line">    │   │       ├── templates
</span><span class="line">    │   │       │   ├── _base.html
</span><span class="line">    │   │       │   └── home.html
</span><span class="line">    │   │       ├── tests.py
</span><span class="line">    │   │       ├── urls.py
</span><span class="line">    │   │       └── views.py
</span><span class="line">    │   ├── settings.py
</span><span class="line">    │   ├── urls.py
</span><span class="line">    │   └── wsgi.py
</span><span class="line">    ├── manage.py
</span><span class="line">    ├── requirements.txt
</span><span class="line">    └── static
</span><span class="line">        └── main.css
</span></code></pre></td></tr></table></div></figure>


<p>We’re now ready to get the containers up and running…</p>

<a name="Docker.Machine"/>
<h2>Docker Machine</h2>

<p>To start Docker Machine, simply navigate to the project root and then run:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine create -d virtualbox dev<span class="p">;</span>
</span><span class="line">Running pre-create checks...
</span><span class="line">Creating machine...
</span><span class="line"><span class="o">(</span>dev<span class="o">)</span> Creating VirtualBox VM...
</span><span class="line"><span class="o">(</span>dev<span class="o">)</span> Creating SSH key...
</span><span class="line"><span class="o">(</span>dev<span class="o">)</span> Starting VM...
</span><span class="line">Waiting <span class="k">for </span>machine to be running, this may take a few minutes...
</span><span class="line">Machine is running, waiting <span class="k">for </span>SSH to be available...
</span><span class="line">Detecting operating system of created instance...
</span><span class="line">Detecting the provisioner...
</span><span class="line">Provisioning with boot2docker...
</span><span class="line">Copying certs to the <span class="nb">local </span>machine directory...
</span><span class="line">Copying certs to the remote machine...
</span><span class="line">Setting Docker configuration on the remote daemon...
</span><span class="line">Checking connection to Docker...
</span><span class="line">Docker is up and running!
</span><span class="line">To see how to connect Docker to this machine, run: docker-machine env dev
</span></code></pre></td></tr></table></div></figure>


<p>The <code>create</code> command set up a new “Machine” (called <em>dev</em>) for Docker development. In essence, it started a VM with Docker running. Now just point Docker at the <em>dev</em> machine:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span><span class="nb">eval</span> <span class="s2">"$(docker-machine env dev)"</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the following command to view the currently running Machines:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine ls
</span><span class="line">NAME   ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER   ERRORS
</span><span class="line">dev    *        virtualbox   Running   tcp://192.168.99.100:2376           v1.9.1
</span></code></pre></td></tr></table></div></figure>


<p>Next, let’s fire up the containers with Docker Compose and get Django, Postgres, and Redis up and running.</p>

<a name="Docker.Compose"/>
<h2>Docker Compose</h2>

<p>Let’s take a look at the <em>docker-compose.yml</em> file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span class="l-Scalar-Plain">web</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
</span><span class="line">  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">./web</span>
</span><span class="line">  <span class="l-Scalar-Plain">expose</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="s">"8000"</span>
</span><span class="line">  <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">postgres:postgres</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">redis:redis</span>
</span><span class="line">  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./web:/usr/src/app</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./web/static:/usr/src/app/static</span>
</span><span class="line">  <span class="l-Scalar-Plain">env_file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.env</span>
</span><span class="line">  <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/usr/local/bin/gunicorn docker_django.wsgi:application -w 2 -b :8000 --reload</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
</span><span class="line">  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">./nginx/</span>
</span><span class="line">  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="s">"80:80"</span>
</span><span class="line">  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/www/static</span>
</span><span class="line">  <span class="l-Scalar-Plain">volumes_from</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">web</span>
</span><span class="line">  <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">web:web</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">postgres</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
</span><span class="line">  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgres:latest</span>
</span><span class="line">  <span class="l-Scalar-Plain">volumes_from</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">data</span>
</span><span class="line">  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="s">"5432:5432"</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">redis</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
</span><span class="line">  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">redis:latest</span>
</span><span class="line">  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="s">"6379:6379"</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">data</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
</span><span class="line">  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgres:latest</span>
</span><span class="line">  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/var/lib/postgresql</span>
</span><span class="line">  <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="s">"true"</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, we’re defining five services – <em>web</em>, <em>nginx</em>, <em>postgres</em>, <em>redis</em>, and <em>data</em>.</p>

<ol>
<li>First, the <em>web</em> service is built via the instructions in the <em>Dockerfile</em> within the “web” directory – where the Python environment is setup, requirements are installed, and the Django application is fired up on port 8000. That port is then forwarded to port 80 on the host environment – e.g., the Docker Machine. This service also adds environment variables to the container that are defined in the <em>.env</em> file.</li>
<li>The <em>nginx</em> service is used for reverse proxy to forward requests either to Django or the static file directory.</li>
<li>Next, the <em>postgres</em> service is built from the the official <a href="https://registry.hub.docker.com/_/postgres/">PostgreSQL image</a> from <a href="https://hub.docker.com/">Docker Hub</a>, which installs Postgres and runs the server on the default port 5432.</li>
<li>Likewise, the <em>redis</em> service uses the official <a href="https://registry.hub.docker.com/u/library/redis/">Redis image</a> to install, well, Redis and then the service is ran on port 6379.</li>
<li>Finally, notice how there is a separate <a href="https://docs.docker.com/userguide/dockervolumes/">volume</a> container that’s used to store the database data – called <em>data</em>. This helps ensure that the data persists even if the Postgres container is completely destroyed.</li>
</ol>


<p>Now, to get the containers running, build the images and then start the services:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose build
</span><span class="line"><span class="nv">$ </span>docker-compose up -d
</span></code></pre></td></tr></table></div></figure>


<p>Grab a cup of coffee. Or go for a <em>long</em> walk. This will take a while the first time you run it. Subsequent builds run much quicker since Docker <a href="https://docs.docker.com/articles/dockerfile_best-practices/#build-cache">caches</a> the results from the first build.</p>

<p>Once the services are running, we need to create the database migrations:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose run web /usr/local/bin/python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Grab the IP associated with Docker Machine – <code>docker-machine ip dev</code> – and then navigate to that IP in your browser:</p>









<p>Nice!</p>

<p>Try refreshing. You should see the counter update. Essentially, we’re using the <a href="http://redis.io/commands/incr">Redis INCR</a> to increment after each handled request. Check out the code in <em>web/docker_django/apps/todo/views.py</em> for more info.</p>

<p>Again, this created five services, all running in different containers:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose ps
</span><span class="line">            Name                          Command               State           Ports
</span><span class="line">----------------------------------------------------------------------------------------------
</span><span class="line">dockerizingdjango_data_1       /docker-entrypoint.sh <span class="nb">true       </span>Up      5432/tcp
</span><span class="line">dockerizingdjango_nginx_1      /usr/sbin/nginx                  Up      0.0.0.0:80-&gt;80/tcp
</span><span class="line">dockerizingdjango_postgres_1   /docker-entrypoint.sh postgres   Up      0.0.0.0:5432-&gt;5432/tcp
</span><span class="line">dockerizingdjango_redis_1      /entrypoint.sh redis-server      Up      0.0.0.0:6379-&gt;6379/tcp
</span><span class="line">dockerizingdjango_web_1        /usr/local/bin/gunicorn <span class="k">do</span> ...   Up      8000/tcp
</span></code></pre></td></tr></table></div></figure>


<p>To see which environment variables are available to the <em>web</em> service, run:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose run web env
</span></code></pre></td></tr></table></div></figure>


<p>To view the logs:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>You can also enter the Postgres Shell – since we forwarded the port to the host environment in the <em>docker-compose.yml</em> file – to add users/roles as well as databases via:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>psql -h 192.168.99.100 -p 5432 -U postgres --password
</span></code></pre></td></tr></table></div></figure>


<p>Ready to deploy? Stop the processes via <code>docker-compose stop</code> and let’s get the app up in the cloud!</p>

<a name="Deployment"/>
<h2>Deployment</h2>

<p>So, with our app running locally, we can now push this exact same environment to a cloud hosting provider with Docker Machine. Let’s deploy to a <a href="https://www.digitalocean.com/?refcode=d8f211a4b4c2">Digital Ocean</a> box.</p>

<p>After you <a href="https://www.digitalocean.com/?refcode=d8f211a4b4c2">sign up</a> for Digital Ocean, generate a <a href="https://www.digitalocean.com/community/tutorials/how-to-use-the-digitalocean-api-v2">Personal Access Token</a>, and then run the following command:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine create <span class="se">\</span>
</span><span class="line">-d digitalocean <span class="se">\</span>
</span><span class="line">--digitalocean-access-token<span class="o">=</span>ADD_YOUR_TOKEN_HERE <span class="se">\</span>
</span><span class="line">production
</span></code></pre></td></tr></table></div></figure>


<p>This will take a few minutes to provision the droplet and setup a new Docker Machine called <em>production</em>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">Running pre-create checks...
</span><span class="line">Creating machine...
</span><span class="line"><span class="o">(</span>production<span class="o">)</span> Creating SSH key...
</span><span class="line"><span class="o">(</span>production<span class="o">)</span> Creating Digital Ocean droplet...
</span><span class="line"><span class="o">(</span>production<span class="o">)</span> Waiting <span class="k">for </span>IP address to be assigned to the Droplet...
</span><span class="line">Waiting <span class="k">for </span>machine to be running, this may take a few minutes...
</span><span class="line">Machine is running, waiting <span class="k">for </span>SSH to be available...
</span><span class="line">Detecting operating system of created instance...
</span><span class="line">Detecting the provisioner...
</span><span class="line">Provisioning with ubuntu<span class="o">(</span>systemd<span class="o">)</span>...
</span><span class="line">Installing Docker...
</span><span class="line">Copying certs to the <span class="nb">local </span>machine directory...
</span><span class="line">Copying certs to the remote machine...
</span><span class="line">Setting Docker configuration on the remote daemon...
</span><span class="line">Checking connection to Docker...
</span><span class="line">Docker is up and running!
</span><span class="line">To see how to connect Docker to this machine, run: docker-machine env production
</span></code></pre></td></tr></table></div></figure>


<p>Now we have two Machines running, one locally and one on Digital Ocean:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine ls
</span><span class="line">NAME         ACTIVE   DRIVER         STATE     URL                         SWARM   DOCKER   ERRORS
</span><span class="line">dev          *        virtualbox     Running   tcp://192.168.99.100:2376           v1.9.1
</span><span class="line">production   -        digitalocean   Running   tcp://45.55.35.188:2376             v1.9.1
</span></code></pre></td></tr></table></div></figure>


<p>Set <em>production</em> as the active machine and load the Docker environment into the shell:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span><span class="nb">eval</span> <span class="s2">"$(docker-machine env production)"</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, let’s build the Django app again in the cloud. This time we need to use a slightly different Docker Compose file that does not mount a <a href="https://docs.docker.com/userguide/dockervolumes/#mount-a-host-directory-as-a-data-volume">volume</a> in the container. Why? Well, the volume is perfect for local development since we can update our local code in the “web” directory and the changes will immediately take affect in the container. In production, there’s no need for this, obviously.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose build
</span><span class="line"><span class="nv">$ </span>docker-compose -f production.yml up -d
</span><span class="line"><span class="nv">$ </span>docker-compose run web /usr/local/bin/python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Did you notice how we specified a different config file for production? What if you wanted to also run <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/staticfiles/#collectstatic">collectstatic</a>? See this <a href="https://github.com/realpython/dockerizing-django/issues/13">issue</a>.</p></blockquote>

<p>Grab the IP address associated with that Digital Ocean account and view it in the browser. If all went well, you should see your app running, as it should.</p>

<a name="Conclusion"/>
<h2>Conclusion</h2>

<ul>
<li>Grab the code from the <a href="https://github.com/realpython/dockerizing-django">repo</a> (star it too… my self-esteem depends on it!).</li>
<li>Comment below with questions.</li>
<li>Need a challenge? Try using <a href="https://docs.docker.com/compose/extends/">extends</a> to clean up the repetitive code in the two Docker Compose configuration files. Keep it DRY!</li>
<li>Have a great day!</li>
</ul>

</div>


      </div></body></html>