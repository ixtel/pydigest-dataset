<html><body><div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p><em>This post was featured on <a href="http://us4.campaign-archive2.com/?u=9735795484d2e4c204da82a29&amp;id=cf56544e52">PyCoders Weekly #157</a>.</em></p>

<p>Recently I played with <a href="https://www.twilio.com/">Twilio</a> API. Their service is mind-blowingly simple - it took me about 50 lines of Python code to set up a MVP. No, I’m not going to start a Twitter-meets-audio kind of startup - you can <a href="http://bubbly.net/">steal the idea</a>. Basically I just have to call a specific number, tell my message and the audio goes to my website. You can find the humblingly minimal audioblogging platform here: <a href="https://twog.herokuapp.com/">https://twog.herokuapp.com/</a>.</p>

<h2 id="okay-how-can-i-get-this-to-work">Okay, how can I get this to work?</h2>
<p>The shortest way is to follow the instructions on my <a href="https://github.com/techstonia/twog">Github repository</a>, which I’m copying here as well.</p>

<ol>
  <li>Create a free <a href="https://www.twilio.com">Twilio</a> account and buy a <a href="https://www.twilio.com/user/account/phone-numbers/incoming">voice number</a>.</li>
  <li>Clone <a href="https://github.com/techstonia/twog">this repository</a>.</li>
  <li>Change <code>AUTH_TOKEN</code> and <code>ACCOUNT_SID</code> in <code>config.py</code>. You can find them under your <a href="https://www.twilio.com/user/account/settings">account settings</a></li>
  <li>Create a <a href="https://heroku.com">Heroku</a> app and push your code into the app. If you’re not familiar with Heroku I suggest starting <a href="https://devcenter.heroku.com/articles/getting-started-with-python#introduction">here</a>.</li>
  <li>Change the request url in your <a href="https://www.twilio.com/user/account/phone-numbers/incoming">manage number</a> page. This should be in the form of yourappname.herokuapp.com/new.</li>
  <li>Call the number in <a href="https://www.twilio.com/user/account/phone-numbers/incoming">manage number</a> to record your first post.</li>
  <li>Yay! You have a voice blog!</li>
</ol>

<p>P.S. Twilio service is not free, but there is an initial 30$ credit, which should be enough for playing with their service. You can also delete posts from Twilio website.</p>

<h2 id="whats-under-the-hood">What’s under the hood?</h2>
<p>It’s built with Flask and Bootstrap and all the logic is in <code>app.py</code>. When we call our magic number Twilio accesses the <a href="yourappname.herokuapp.com/new">yourappname.herokuapp.com/new</a> and get’s instructions in TwiML, which is a Twilio’s markup language. Basically the view checks if the call is made from your number and after you have pressed 1, the <a href="yourappname.herokuapp.com/handle-key">yourappname.herokuapp.com/handle-key</a> is accessed.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">"/new"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">new_post</span><span class="p">():</span>
    <span class="n">from_number</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'From'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">twilio</span><span class="o">.</span><span class="n">twiml</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">from_number</span> <span class="o">==</span> <span class="n">MY_NR</span><span class="p">:</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Hi!"</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">resp</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">numDigits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">"/handle-key"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"POST"</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"To record a post, press 1."</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Go away intruder!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span></code></pre></div>

<p>In handle-key Twilio gets instructions of what to say to you and what to do after the call has finished.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">"/handle-key"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">handle_key</span><span class="p">():</span>
    <span class="n">digit_pressed</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'Digits'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">digit_pressed</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">twilio</span><span class="o">.</span><span class="n">twiml</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Record your post after the tone."</span><span class="p">)</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">maxLength</span><span class="o">=</span><span class="s">"10"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">"/handle-recording"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/new"</span><span class="p">)</span></code></pre></div>

<p>If your call reaches 10 seconds, you’re redirected to <code>/handle-recording</code>, and informed that your post is now live.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">"/handle-recording"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">handle_recording</span><span class="p">():</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">twilio</span><span class="o">.</span><span class="n">twiml</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Your post is now live! Goodbye"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span></code></pre></div>

<p>Now we only need a view for displaying the posts:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TwilioRestClient</span><span class="p">(</span><span class="n">ACCOUNT_SID</span><span class="p">,</span> <span class="n">AUTH_TOKEN</span><span class="p">)</span>
    <span class="n">recordings</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">recordings</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">,</span> <span class="n">posts</span><span class="o">=</span><span class="n">recordings</span><span class="p">)</span></code></pre></div>

<p>It’s very straightforward - we fetch recordings and pass them into <code>render_template</code> function, which then produces the necessary html for displaying all the posts we have created. So that’s that. Simple, huh?</p>

<p><a href="https://twog.herokuapp.com/">https://twog.herokuapp.com/</a></p>

<p><a href="https://github.com/techstonia/twog">https://github.com/techstonia/twog</a></p>


                
                
                
            
                <hr/>
                <p id="disqus_thread"/>
                
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div></body></html>