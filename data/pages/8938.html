<html><body><div><div class="entry-content">

                

                <p>Начинаем новую рубрику - "Примеры кода". В данной категории постов мы будем публиковать небольшие(или большие) куски кода. Это могут быть как решение определенных задач/вопросов так и небольшие примеры кода с применением инструментов.</p>
<p>Сегодня модуль <code>click</code>.
Модуль click (<a href="http://click.pocoo.org/5/">http://click.pocoo.org/5/</a>) - позволяет упростить создание консольных приложений.
Инструмент имеет подробное описание возможностей - <a href="http://click.pocoo.org/5/quickstart/">http://click.pocoo.org/5/quickstart/</a></p>
<p>В качестве примера кода рассмотрим задачку - написать консольное приложение, которое позволяет определять день недели для указанной даты, а также считать дельту дней между двумя датами.</p>
<p>Код - <a href="https://gist.github.com/PyNSK/8de42eddbc4c13e633fe">https://gist.github.com/PyNSK/8de42eddbc4c13e633fe</a></p>
<div class="highlight"><pre><span class="c1"># coding=utf-8</span>

<span class="c1"># requirements.txt</span>
<span class="c1"># click</span>

<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="nd">@click.group</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cli</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">'--date'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'now'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'The date format "yyyy-mm-dd"'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_weekday</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="s1">'now'</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span>

    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%A'</span><span class="p">))</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">'--date1'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'The date format "yyyy-mm-dd"'</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">'--date2'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'The date format "yyyy-mm-dd"'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">delta_day</span><span class="p">(</span><span class="n">date1</span><span class="p">,</span> <span class="n">date2</span><span class="p">):</span>
    <span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date1</span><span class="p">,</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">date2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date2</span><span class="p">,</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">date1</span> <span class="o">-</span> <span class="n">date2</span> <span class="k">if</span> <span class="n">date1</span> <span class="o">&gt;</span> <span class="n">date2</span> <span class="k">else</span> <span class="n">date2</span> <span class="o">-</span> <span class="n">date1</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>

<span class="n">cli</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">get_weekday</span><span class="p">)</span>
<span class="n">cli</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">delta_day</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">cli</span><span class="p">()</span>
</pre></div>


<p>Использование:</p>
<div class="highlight"><pre>(v)➜ ~ python d.py
Usage: d.py [OPTIONS] COMMAND [ARGS]...

Options:
--help Show this message and exit.

Commands:
delta_day
get_weekday
(v)➜ ~ python d.py get_weekday --date 2013-05-31
Friday
(v)➜ ~ python d.py delta_day --date1 2013-12-27 --date2 2011-05-04
968
</pre></div>
            </div>
            
</div></body></html>