<html><body><div><div id="usage">
<h2>Usage</h2>
<pre>s3logs config.conf
</pre>
<p>Where config.conf can use that structure:</p>
<pre><span class="k">[S3]</span>
<span class="na">access_key</span> <span class="o">=</span> <span class="s">&lt;S3_KEY&gt;</span>
<span class="na">secret_key</span> <span class="o">=</span> <span class="s">&lt;S3_SECRET_KEY&gt;</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">&lt;s3.example.com&gt;</span>
<span class="na">bucket</span> <span class="o">=</span> <span class="s">&lt;bucket_name&gt;</span>
<span class="na">chunk_size</span> <span class="o">=</span> <span class="s">&lt;bytes, default=52428800&gt;</span>

<span class="k">[logs]</span>

<span class="na">suffix</span> <span class="o">=</span> <span class="s">.gz</span>
<span class="na">key_suffix</span> <span class="o">=</span> <span class="s">.gz</span>
<span class="na">directory</span> <span class="o">=</span> <span class="s">/var/log/nginx/</span>
<span class="na">depth</span> <span class="o">=</span> <span class="s">30</span>

<span class="k">[map]</span>

<span class="na">example.com-access.log</span> <span class="o">=</span> <span class="s">example/access</span>
<span class="na">example.com-error.log</span> <span class="o">=</span> <span class="s">example/error</span>
<span class="na">mysite.me.access.log</span> <span class="o">=</span> <span class="s">mysite/access</span>
</pre>
<p>When it used with that config, script takes all files in directory <cite>/var/log/nginx/</cite>, filter only those, which ends with <cite>.gz</cite> and send it to S3, according to map.</p>
<p>For example, /var/log/nginx now consists of:</p>
<pre>example.com-access.log
example.com-access.log.0.gz
example.com-access.log.1.gz
example.com-error.log
example.com-error.log.0.gz
example.com-error.log.1.gz
mysite.me.access.log
mysite.me.access.log.0.gz
mysite.me.error.log
mysite.me.error.log.0.gz
</pre>
<p>So, if today is 9 December 2015, and your hostname is node1, on your S3 <cite>&lt;bucket_name&gt;</cite> would be those keys:</p>
<pre>node1/example/access/2015-12-09.gz
node1/example/access/2015-12-08.gz
node1/example/error/2015-12-09.gz
node1/example/error/2015-12-08.gz
node1/mysite/access/2015-12-09.gz
</pre>
<p>Because we have not explain how maps mysite.me.error.log.0.gz - it would be skipped.</p>
<p>Script also checks whether file exists in S3 and push only those, which are not.</p>
<p>Parameter <cite>depth</cite> stops pushing, if filename is older, than <cite>.&lt;depth&gt;.gz</cite></p>
</div>


</div></body></html>