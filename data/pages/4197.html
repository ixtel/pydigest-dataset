<html><body><div><div class="content html_format">
      <img src="https://habrastorage.org/getpro/habr/comment_images/e9d/d58/7ba/e9dd587ba517b19c47fc4116ce925f31.png"/>

<h2>Интро</h2><p>
Столкнулся с тем, что youtube.com «забывает» видео, которые я просмотрел. </p><p>
Приходится смотреть много образовательных каналов, а потом вспоминать, видел я это или нет.</p><p>
Посмотрел какую-нибудь лекцию и через несколько дней (месяцев, лет) статус "</p><b>просмотрено</b><p>" пропадает.</p><p>
Или, наоборот, посмотришь 2 минуты какой-нибудь лекции, ляжешь спать, а на утро лекция имеет статус «просмотрено». 
</p><p>
Вот и решил взять под контроль информацию о просмотрах на youtube в свои руки. </p><p>
И хранить эту информацию вне зависимости от ютюба. </p><p>
Если у кого-нибудь есть нужда в такого рода запоминании просмотров, то добро пожаловать под кат.
</p><a name="habracut"/>
<h2>Скриншоты</h2><p>
Иногда скриншоты лучше объясняют, чем сама статья. </p><p>
Поэтому привожу их в первую очередь:

</p><img src="https://habrastorage.org/files/0ca/80f/b1a/0ca80fb1a71e4760a8021bd21760af45.png"/>
<i>Можно добавить каналы, которые вам интересны. </i>

<img src="https://habrastorage.org/files/861/84b/e14/86184be14b1d4e6ebd7acbe78f0dbd99.png"/>

<img src="https://habrastorage.org/files/d1f/e5d/ea5/d1fe5dea554241719f1b733a88cb7580.png"/>

<h2>Реализация на любом языке веб-программирования</h2><p>
Итак, пишем свой youtube с возможностью запоминания просмотров и с прекрасными лекторшами.</p><p>
«Наш ютюб» будет получать информацию от google API и будет своего рода прослойкой между вами и ютюбом. </p><p>
И будет хранить информацию о просмотрах в нашей базе данных. 
</p><p>
Я написал это на python и фреймворке flask, получилось 70 строк, ссылка на гитхаб внизу статьи. </p><p>
Но так как это можно воссоздать и на php, и на perl и на других языках для веб, то сначала общие принципы…

</p><h2>Работа с google API</h2><p>
Получить ключ google API к youtube. Можно </p><a href="https://code.google.com/apis/console/?pli=1">здесь</a><p>.

</p><b>Информация о канале</b><p>
Для создания сайта нам понадобится получать информацию о канале. </p><p>
Возьмем для примера вот такую ссылку:
</p><a href="https://www.youtube.com/channel/UC640y4UvDAlya_WOj5U4pfA">www.youtube.com/channel/UC640y4UvDAlya_WOj5U4pfA</a><p>
UC640y4UvDAlya_WOj5U4pfA — это ID канала. </p><p>
Обращаемся к API:

</p><pre><code class="bash">curl 'https://www.googleapis.com/youtube/v3/channels?part=snippet&amp;id=UC640y4UvDAlya_WOj5U4pfA&amp;key=ВАШ_КЛЮЧ_API'
</code></pre>
<div class="spoiler"><b class="spoiler_title">И получаем вот такой ответ в формате JSON</b><div class="spoiler_text"><pre><code class="bash">{
 "kind": "youtube#channelListResponse",
 "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/YqjVAeQ4_JORc2ijoBKla3hrDXE\"",
 "pageInfo": {
  "totalResults": 1,
  "resultsPerPage": 1
 },
 "items": [
  {
   "kind": "youtube#channel",
   "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/OE6leaeClJlkthEEiPP5KVJQZPQ\"",
   "id": "UC640y4UvDAlya_WOj5U4pfA",
   "snippet": {
    "title": "nptelhrd",
    "description": "Your favorite courses available for certification! study, write an exam and get a certificate from the IITs! Check http://nptel.ac.in/noc\n\nThis channel provides technical lectures from seven Indian Institutes of Technology (IITs) and Indian Institute of Science (IISc) Bangalore.\n\nPlease visit the NPTEL Channel List below to view the complete list of courses. (24 Channels)",
    "publishedAt": "2007-11-28T04:54:13.000Z",
    "thumbnails": {
     "default": {
      "url": "https://yt3.ggpht.com/-VO_A5Tys4WY/AAAAAAAAAAI/AAAAAAAAAAA/mBvvbUvh0A8/s88-c-k-no/photo.jpg"
     },
     "medium": {
      "url": "https://yt3.ggpht.com/-VO_A5Tys4WY/AAAAAAAAAAI/AAAAAAAAAAA/mBvvbUvh0A8/s240-c-k-no/photo.jpg"
     },
     "high": {
      "url": "https://yt3.ggpht.com/-VO_A5Tys4WY/AAAAAAAAAAI/AAAAAAAAAAA/mBvvbUvh0A8/s240-c-k-no/photo.jpg"
     }
    },
    "localized": {
     "title": "nptelhrd",
     "description": "Your favorite courses available for certification! study, write an exam and get a certificate from the IITs! Check http://nptel.ac.in/noc\n\nThis channel provides technical lectures from seven Indian Institutes of Technology (IITs) and Indian Institute of Science (IISc) Bangalore.\n\nPlease visit the NPTEL Channel List below to view the complete list of courses. (24 Channels)"
    }
   }
  }
 ]
}
</code></pre>

</div></div><p>
Отсюда можно дернуть поле 'title' и использовать как название канала. 

</p><b>Получаем список видео с канала</b>
<pre><code class="bash">curl 'https://www.googleapis.com/youtube/v3/search?part=snippet&amp;channelId=UCEBb1b_L6zDS3xTUrIALZOw&amp;order=date&amp;key=ВАШ_КЛЮЧ_API'
</code></pre>

<div class="spoiler"><b class="spoiler_title">И получаем вот такой ответ в формате JSON</b><div class="spoiler_text"><pre><code class="bash">{
 "kind": "youtube#searchListResponse",
 "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/vGlosUUKRoHE50sX08btNSJuUT0\"",
 "nextPageToken": "CAUQAA",
 "pageInfo": {
  "totalResults": 3493,
  "resultsPerPage": 5
 },
 "items": [
  {
   "kind": "youtube#searchResult",
   "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/f-Aj24y6ay5s_ofPTa82fwx3hP0\"",
   "id": {
    "kind": "youtube#video",
    "videoId": "NtMOab_nhs0"
   },
   "snippet": {
    "publishedAt": "2015-04-02T00:35:45.000Z",
    "channelId": "UCEBb1b_L6zDS3xTUrIALZOw",
    "title": "Octave/MATLAB® for Beginners, Part 2: Fitting Data and Plotting",
    "description": "MIT 22.15 Essential Numerical Methods, Fall 2014 View the complete course: http://ocw.mit.edu/22-15F14 Instructor: Ian Hutchinson Plotting the line that results ...",
    "thumbnails": {
     "default": {
      "url": "https://i.ytimg.com/vi/NtMOab_nhs0/default.jpg"
     },
     "medium": {
      "url": "https://i.ytimg.com/vi/NtMOab_nhs0/mqdefault.jpg"
     },
     "high": {
      "url": "https://i.ytimg.com/vi/NtMOab_nhs0/hqdefault.jpg"
     }
    },
    "channelTitle": "MIT",
    "liveBroadcastContent": "none"
   }
  },
  {
   "kind": "youtube#searchResult",
   "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/qLJGwF303RMmdl03IbivB2VkIQ4\"",
   "id": {
    "kind": "youtube#video",
    "videoId": "WUxImdA7k8E"
   },
   "snippet": {
    "publishedAt": "2015-04-02T00:35:45.000Z",
    "channelId": "UCEBb1b_L6zDS3xTUrIALZOw",
    "title": "Octave/MATLAB® for Beginners, Part 3: Cleaning Up &amp; Saving Plots",
    "description": "MIT 22.15 Essential Numerical Methods, Fall 2014 View the complete course: http://ocw.mit.edu/22-15F14 Instructor: Ian Hutchinson Cleaning up and saving ...",
    "thumbnails": {
     "default": {
      "url": "https://i.ytimg.com/vi/WUxImdA7k8E/default.jpg"
     },
     "medium": {
      "url": "https://i.ytimg.com/vi/WUxImdA7k8E/mqdefault.jpg"
     },
     "high": {
      "url": "https://i.ytimg.com/vi/WUxImdA7k8E/hqdefault.jpg"
     }
    },
    "channelTitle": "MIT",
    "liveBroadcastContent": "none"
   }
  },
  {
   "kind": "youtube#searchResult",
   "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/mKjnuWcbJIZE_fKn12kg7B-lrN0\"",
   "id": {
    "kind": "youtube#video",
    "videoId": "LhPZwdhutgU"
   },
   "snippet": {
    "publishedAt": "2015-04-02T00:35:45.000Z",
    "channelId": "UCEBb1b_L6zDS3xTUrIALZOw",
    "title": "Octave/MATLAB® for Beginners, Part 1: Starting from Scratch",
    "description": "MIT 22.15 Essential Numerical Methods, Fall 2014 View the complete course: http://ocw.mit.edu/22-15F14 Instructor: Ian Hutchinson Create adjacent windows ...",
    "thumbnails": {
     "default": {
      "url": "https://i.ytimg.com/vi/LhPZwdhutgU/default.jpg"
     },
     "medium": {
      "url": "https://i.ytimg.com/vi/LhPZwdhutgU/mqdefault.jpg"
     },
     "high": {
      "url": "https://i.ytimg.com/vi/LhPZwdhutgU/hqdefault.jpg"
     }
    },
    "channelTitle": "MIT",
    "liveBroadcastContent": "none"
   }
  },
  {
   "kind": "youtube#searchResult",
   "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/EteK6EKK5CG4IAAX3JjzWUD0oAQ\"",
   "id": {
    "kind": "youtube#playlist",
    "playlistId": "PLUl4u3cNGP63_OOz8w5qDEoqErZ8Hj-fc"
   },
   "snippet": {
    "publishedAt": "2015-04-02T00:34:03.000Z",
    "channelId": "UCEBb1b_L6zDS3xTUrIALZOw",
    "title": "MIT 22.15 Essential Numerical Methods, Fall 2014",
    "description": "View the complete course: http://ocw.mit.edu/22-15F14 Instructor: Ian Hutchinson Three short tutorial videos which demonstrate basic operation of Octave software, used in this graduate-level...",
    "thumbnails": {
     "default": {
      "url": "https://i.ytimg.com/vi/LhPZwdhutgU/default.jpg"
     },
     "medium": {
      "url": "https://i.ytimg.com/vi/LhPZwdhutgU/mqdefault.jpg"
     },
     "high": {
      "url": "https://i.ytimg.com/vi/LhPZwdhutgU/hqdefault.jpg"
     }
    },
    "channelTitle": "MIT",
    "liveBroadcastContent": "none"
   }
  },
  {
   "kind": "youtube#searchResult",
   "etag": "\"kYnGHzMaBhcGeLrcKRx6PAIUosY/jI4Bwr7emgpt45cnFetFPewI7qU\"",
   "id": {
    "kind": "youtube#playlist",
    "playlistId": "PLUl4u3cNGP62FPGcyFJkzhqq9c5cHCK32"
   },
   "snippet": {
    "publishedAt": "2015-03-23T21:38:55.000Z",
    "channelId": "UCEBb1b_L6zDS3xTUrIALZOw",
    "title": "MIT 8.421 Atomic and Optical Physics I, Spring 2014",
    "description": "MIT 8.421 Atomic and Optical Physics I, Spring 2014 View the complete course: http://ocw.mit.edu/8-421S14 Instructor: Wolfgang Ketterle This is the first of a ...",
    "thumbnails": {
     "default": {
      "url": "https://i.ytimg.com/vi/iwQ49oG-DO8/default.jpg"
     },
     "medium": {
      "url": "https://i.ytimg.com/vi/iwQ49oG-DO8/mqdefault.jpg"
     },
     "high": {
      "url": "https://i.ytimg.com/vi/iwQ49oG-DO8/hqdefault.jpg"
     }
    },
    "channelTitle": "MIT",
    "liveBroadcastContent": "none"
   }
  }
 ]
}
</code></pre>
</div></div><p>
По умолчанию он будет выводить за один раз 5 последних видео с канала. </p><p>
Чтобы это изменить, можно добавить параметр &amp;maxResults=10, например. </p><p>
Для навигации по страницам канала в JSON выдаются следующие значения:</p><p>
 «nextPageToken» и «prevPageToken».</p><p>
Если нужно перейти на следующую или предыдущую страницу, то вводим дополнительный параметр &amp;pageToken=</p><p>
и подставляем сюда значение «nextPageToken» или «prevPageToken».

</p><b>Информация об отдельно взятом видео</b><p>
Вообще я этот запрос не использовал в своем сайте, но может пригодиться.</p><p>
Поэтому привожу его:
</p><pre><code class="bash">curl 'https://ww.googleapis.com/youtube/v3/videos?part=snippet&amp;id=EhNWzcUwqGbI&amp;key=ВАШ_КЛЮЧ_API'
</code></pre>

<div class="spoiler"><b class="spoiler_title">И получаем вот такой ответ в формате JSON</b><div class="spoiler_text"><pre><code class="bash">{
 "kind": "youtube#videoListResponse",
 "etag": "\"IHLB7Mi__JPvvG2zLQWAg8l36UU/2kAxpYyny-CEVVbQ2cOjO-XSscQ\"",
 "pageInfo": {
  "totalResults": 1,
  "resultsPerPage": 1
 },
 "items": [
  {
   "kind": "youtube#video",
   "etag": "\"IHLB7Mi__JPvvG2zLQWAg8l36UU/vAIAewyN9KKpNPERU4b4tOjuPL4\"",
   "id": "EhNWzcUqGbI",
   "snippet": {
    "publishedAt": "2013-03-16T06:58:52.000Z",
    "channelId": "UCuLLf8HBxpa-RV1sf9CRmDg",
    "title": "50 MPH 52v Electric Mountain Bike",
    "description": "http://voltbicycles.com This is our Alite 1000 Electric Mountain bike powered by a black lighting brushless rear hub electric motor with a 52v battery system. This electric bike will do around 50 MPH and will run 30+ miles on a single charge. \n\nGOING GREEN DOESN'T HAVE TO BE BORING",
    "thumbnails": {
     "default": {
      "url": "https://i.ytimg.com/vi/EhNWzcUqGbI/default.jpg",
      "width": 120,
      "height": 90
     },
     "medium": {
      "url": "https://i.ytimg.com/vi/EhNWzcUqGbI/mqdefault.jpg",
      "width": 320,
      "height": 180
     },
     "high": {
      "url": "https://i.ytimg.com/vi/EhNWzcUqGbI/hqdefault.jpg",
      "width": 480,
      "height": 360
     },
     "standard": {
      "url": "https://i.ytimg.com/vi/EhNWzcUqGbI/sddefault.jpg",
      "width": 640,
      "height": 480
     },
     "maxres": {
      "url": "https://i.ytimg.com/vi/EhNWzcUqGbI/maxresdefault.jpg",
      "width": 1280,
      "height": 720
     }
    },
    "channelTitle": "bradscottphotography",
    "categoryId": "28",
    "liveBroadcastContent": "none",
    "localized": {
     "title": "50 MPH 52v Electric Mountain Bike",
     "description": "http://voltbicycles.com This is our Alite 1000 Electric Mountain bike powered by a black lighting brushless rear hub electric motor with a 52v battery system. This electric bike will do around 50 MPH and will run 30+ miles on a single charge. \n\nGOING GREEN DOESN'T HAVE TO BE BORING"
    }
   }
  }
 ]
}
</code></pre>
</div></div>

<h2>Как быть с текущей историей просмотров?</h2><p>
Текущая история просмотров хранится здесь:
</p><a href="https://www.youtube.com/feed/history">www.youtube.com/feed/history</a><p>
Нажимаете до победного конца на кнопку «Еще», пока не загрузится вся история, которая там хранится. </p><p>
Далее сохраняем в html файл. </p><p>
Я набросал небольшой парсер на perl, который выдергивает ID всех видео из сохраненного файла с историей. 
</p><pre><code class="perl">use strict;
use warnings;
use utf8;
use Mojo::DOM;
use File::Slurp;
use feature 'say';

my $body = read_file( 'youtube_history.html', binmode =&gt; ':utf8' );
my $dom = Mojo::DOM-&gt;new($body);

for my $e ( $dom-&gt;find('div.yt-uix-tile')-&gt;each ) {
    say  $e-&gt;{'data-context-item-id'};

}
</code></pre>
<p>
На выходе получаем список всех ID на ютюбе, которые были в youtube_history.html.</p><p>
Можно загрузить его в нашу локальную базу и таким образом отметить видео, как просмотренное.

</p><h2>Немного о реализации на фреймворке flask</h2><p>
Ссылка на github:
</p><a href="https://github.com/Alexmod/memtube">github.com/Alexmod/memtube</a><p>
На хабре была целая </p><a href="http://habrahabr.ru/post/193242/">серия статей о flask</a><p>, так что подробно не буду останавливаться. </p><p>
Но если хотите запустить данный файл, то ставьте виртуальное окружение, устанавливайте все модули, которые нужны для старта,</p><p>
и запускайте командой:
</p><pre><code class="bash">python main.py 
</code></pre><p>
Если все ок, то увидете следующее:
</p><pre><code class="bash"> * Running on http://0.0.0.0:5000/
 * Restarting with reloader
</code></pre><p>
Локальная версия youtube.com готова.</p><p>
После первого запуска будет создан файл video.db в этой же директории, в котором и будет храниться информация о просмотрах.

</p><h2>P.S.</h2><p>
Чтобы смотреть видео на ютюбе с разных устройств и быть не привязанным к локальному компу, я выложил flask-сайт в онлайн:
</p><a href="http://memtube.com">http://memtube.com</a><p>
И смотрю все оттуда. </p><p>
У кого есть желание, пожалуйста, присоединяйтесь. На сайте в любой момент можно скачать Excel файл с историей просмотров:
</p><img src="https://habrastorage.org/files/6b9/b45/11b/6b9b4511ba284656b7ce3b381967d990.png"/>

      
      <p class="clear"/>
    </div>

    
  </div></body></html>