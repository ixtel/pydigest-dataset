<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-bankapi" class="anchor" href="#bankapi" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>BankAPI</h1>

<h2><a id="user-content-what-is-it" class="anchor" href="#what-is-it" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>What is it?</h2>

<p>BankAPI is a secure decentralized messaging system to send files/messages between banks and other types of financial institutions.</p>

<p>There is a reference implementation of the protocol which can be used off-the-shelf, which is production grade quality and is not only for testing and demonstration, although it fulfils those two roles as well.</p>

<p>The BankAPI protocol relies on OpenPGP (RFC 4880) + SHA512 + HTTPS. That's it, there is nothing more to it.</p>

<p>BankAPI is only a transmission protocol, and makes no assumptions of what kind of messages or file types banks will want to transfer.</p>

<h2><a id="user-content-key-exchange" class="anchor" href="#key-exchange" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Key exchange</h2>

<p><a href="https://raw.githubusercontent.com/trustly/bankapi/master/doc/BankAPI%20Key%20Exchange.png" target="_blank"><img src="https://raw.githubusercontent.com/trustly/bankapi/master/doc/BankAPI%20Key%20Exchange.png" alt="layout"/></a></p>

<h2><a id="user-content-protocol-design" class="anchor" href="#protocol-design" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Protocol design</h2>

<p><a href="https://raw.githubusercontent.com/trustly/bankapi/master/doc/BankAPI%20Protocol%20Design.png" target="_blank"><img src="https://raw.githubusercontent.com/trustly/bankapi/master/doc/BankAPI%20Protocol%20Design.png" alt="layout"/></a></p>

<p>The protocol imposes certain restrictions on the details and choices of
algorithms used for generating the OpenPGP messages.  The terminology used here
conforms to the one specified in <a href="http://tools.ietf.org/html/rfc2119">RFC2119</a>.
The details specific to OpenPGP are documented in
<a href="http://tools.ietf.org/html/rfc4880">RFC4880</a>.</p>

<ol>
<li><p>All OpenPGP messages <strong>MUST</strong> be symmetrically encrypted messages, where the
session key is public-key encrypted.  The <em>session key packet</em> <strong>MUST</strong>
contain the <em>Key ID</em> of the key used to encrypt the message.  All messages
<strong>MUST</strong> contain a signature packet.  Implementations <strong>MAY</strong> choose to
generate one-pass signatures.</p></li>
<li><p>All parties <strong>MUST</strong> use a key length of at least 2048 bits for their RSA
keys.  Implementations <strong>SHOULD</strong> accept key sizes of 2048, 3072 and 4096
bits.  Using 4096-bit keys is <strong>RECOMMENDED</strong>.  DSA and Elgamal <strong>MUST NOT</strong>
be used.</p></li>
<li><p>The cipher algorithm <strong>MUST</strong> be one of AES128, AES192 and AES256.</p></li>
<li><p>If the OpenPGP message is a <em>compressed message</em>, the compression algorithm
<strong>MUST</strong> be ZIP or ZLIB.</p></li>
<li><p>The OpenPGP message <strong>MAY</strong> be <em>integrity protected</em> via the <em>Modification
Detection Code packet</em>.</p></li>
<li><p>The <em>literal data</em> inside the OpenPGP message <strong>MUST</strong> be marked to contain
binary data.  If a text or UTF-8 message is received, an implementation
<strong>MAY</strong> choose to accept the message.  An implementation <strong>MUST NOT</strong>
convert any <em>canonical line endings</em> to their local counterpart.</p></li>
<li><p>The signature packet and (if present) the one-pass signature packet <strong>MUST</strong>
contain the <em>Key ID</em> of the key used to sign the message.  Implementations
<strong>SHOULD</strong> only sign a message using a single key.  The hash algorithm used
for signatures <strong>MUST</strong> be SHA-512.</p></li>
<li><p>The <em>ASCII Armor</em>, including <em>Armor Headers</em>, <strong>MUST</strong> be valid UTF-8.</p></li>
<li><p>The <em>Armor Header</em> "Comment", <strong>MUST</strong> be set to the message type.</p></li>
</ol>

<h2><a id="user-content-system-design" class="anchor" href="#system-design" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>System design</h2>

<p><a href="https://raw.githubusercontent.com/trustly/bankapi/master/doc/BankAPI%20System%20Design.png" target="_blank"><img src="https://raw.githubusercontent.com/trustly/bankapi/master/doc/BankAPI%20System%20Design.png" alt="layout"/></a></p>

<p>The system is built on top of PostgreSQL and uses its pgcrypto contrib module.</p>

<p>Messages are encrypted and signed using RSA public-key cryptography.</p>

<p>Each bank generates a RSA key-pair consisting of a public and a secret key.</p>

<p>The public keys and API URLs are exchanged between the banks.</p>

<p>The task of exchanging public keys and API URLs is preferrably done over the
SWIFT network, by sending them in a normal MT999 SWIFT FIN-message.  This
allows banks to trust the validity of the public key and API URL, as the origin
of SWIFT messages can be trusted.</p>

<h2><a id="user-content-highlights" class="anchor" href="#highlights" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Highlights</h2>

<ul>
<li>RSA-encryption</li>
<li>SHA512</li>
<li>JSON-RPC / HTTPS</li>
<li>Linux / PostgreSQL / Apache</li>
<li>Open source / MIT-license</li>
<li>Real-time request/response</li>
<li>Instant delivery receipt</li>
<li>Local archiving of files in PostgreSQL</li>
</ul>

<h2><a id="user-content-overview-of-the-interface" class="anchor" href="#overview-of-the-interface" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Overview of the interface</h2>

<p>To send a message, the sending bank encrypts and signs a message using
Create_Message(), and calls Get_Message() to get the actual ciphertext
content of the message.  The ciphertext is then delivered to the receiving bank
by calling its Receive_Message() API method, accessible at the API URL
provided by the receiving bank.  The API implementation must adhere to the
JSON-RPC standard and accept HTTPS POST.</p>

<p>The Receive_Message() function returns a <em>delivery receipt</em>, which is a
cryptographic proof of the fact that the sender was able to verify the
signature contained within the message against the receiving bank's public key.
This allows the sender to be certain that the message was delivered and
decrypted successfully by the recipient.</p>

<p>The sending bank calls Decode_Delivery_Receipt() with the <em>delivery receipt</em>
as input to verify its validity.</p>

<h2><a id="user-content-database-tables-and-columns" class="anchor" href="#database-tables-and-columns" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Database tables and columns</h2>

<h3><a id="user-content-banks" class="anchor" href="#banks" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Banks</h3>

<ul>
<li>BankID : Unique identifier for the bank, preferrably the SWIFT BIC (PRIMARY KEY)</li>
<li>Protocol : API procotol, example "https"</li>
<li>Host : API host, Internet domain name, example "bank.com"</li>
<li>Port : API port, Internet network port, example 443</li>
<li>Path : API path, example "/api"</li>
<li>Datestamp : Date/time when added to the table</li>
</ul>

<h3><a id="user-content-files" class="anchor" href="#files" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Files</h3>

<ul>
<li>FileID : SHA512 hash of the Plaintext (PRIMARY KEY)</li>
<li>Plaintext : The content of the file (UTF8)</li>
<li>Datestamp : Date/time when added to the table</li>
</ul>

<h3><a id="user-content-keys" class="anchor" href="#keys" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Keys</h3>

<ul>
<li>MainKeyID : Signature key (PRIMARY KEY)</li>
<li>SubKeyID : Encryption key</li>
<li>PublicKeyring : Contains public keys</li>
<li>SecretKeyring : Contains secret keys (only set for your own bank, NULL for others)</li>
<li>BankID : The BankID which the keys belong to</li>
<li>Datestamp : Date/time when added to the table</li>
<li>PrimaryKey : Only set to TRUE for one row per BankID, other keys are still valid, but this key is used when creating new messages</li>
</ul>

<h3><a id="user-content-messages" class="anchor" href="#messages" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Messages</h3>

<ul>
<li>MessageID : SHA512 hash of the Cipherdata (PRIMARY KEY)</li>
<li>FileID : The hash of the file send in the message</li>
<li>FromBankID : The bank who sent the message</li>
<li>ToBankID : The bank who received the message</li>
<li>Cipherdata : The encrypted and signed message</li>
<li>DeliveryReceipt : The encrypted and signed delivery receipt</li>
<li>Datestamp : The date/time when the message was created</li>
<li>Delivered : The date/time when the message was delivered</li>
</ul>

<h2><a id="user-content-database-functions" class="anchor" href="#database-functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Database functions</h2>

<h3><a id="user-content-create_messageplaintext-frombankid-tobankid" class="anchor" href="#create_messageplaintext-frombankid-tobankid" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Create_Message(Plaintext, FromBankID, ToBankID)</h3>

<p>Create_Message() takes the plaintext context of a file as input and prepares
an encrypted <em>message</em> signed by <strong>FromBankID</strong> which can be only decrypted by
<strong>ToBankID</strong>.  If the <em>message</em> already exists, the existing data is reused.
An error is returned if the <em>secret key</em> of <strong>FromBankID</strong> or the <em>public key</em>
of <strong>ToBankID</strong> can not be located in the database.</p>

<p>The return value is the <em>message id</em> of the message.</p>

<h3><a id="user-content-get_messagemessageid" class="anchor" href="#get_messagemessageid" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Get_Message(MessageID)</h3>

<p>Given a <em>message id</em> as input, Get_Message() returns the ASCII armored PGP
message.  This data can then be HTTPS POSTed to the Receive_Message API method
of <strong>ToBank</strong>.</p>

<h3><a id="user-content-receive_messageciphertext-text" class="anchor" href="#receive_messageciphertext-text" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Receive_Message(Ciphertext text)</h3>

<p>Receive_Message() decrypts and verifies the signature of the input <em>message</em>.
The message's details are written to the <em>Messages</em> table, and information
about the file and its plaintext contents are written into the <em>Files</em> table.
This function will raise an error if:</p>

<ol>
<li><p>The <em>secret key</em> counterpart of the <em>public key</em> used to encrypt the
message is not present in the table <em>Keys</em>.</p></li>
<li><p>The <em>public key</em> counterpart of the <em>secret key</em> used to sign the message
is not present in the table <em>Keys</em>.</p></li>
<li><p>The message is corrupt or the signature can not be verified.</p></li>
</ol>

<p>The return value is a <em>delivery receipt</em>, which should be then used as the
contents of the response to the caller of the Receive_Message API method.</p>

<h3><a id="user-content-decode_delivery_receiptdeliveryreceipt-text" class="anchor" href="#decode_delivery_receiptdeliveryreceipt-text" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Decode_Delivery_Receipt(DeliveryReceipt text)</h3>

<p>Decode_Delivery_Receipt() decrypts and verifies the given <em>delivery receipt</em>,
where the keys involved and the plaintext should match a row in Messages.  If
so, the Message has been successfully delivered, and the
Messages.DeliveryReceipt and Messages.Delivered columns are set.</p>

<h2><a id="user-content-installing-and-building-deb-packages-for-installation" class="anchor" href="#installing-and-building-deb-packages-for-installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installing and building .deb packages for installation</h2>

<p>The repository includes scripts for building debian/ubuntu packages for the
bankapi and the required pgcrypto extensions (in PostgreSQL) in order to run
the code.</p>

<p>If you are running a different version of PostgreSQL then 9.3 then replace the
version in the commands below with the appropriate version. If you are running
the default version in Debian you can omit the version extension of the
packages names.</p>

<ul>
<li>sudo apt-get -y build-dep postgresql-9.3</li>
<li>sudo apt-get -y install postgresql-server-dev-9.3 postgresql-9.3 apache2 python-psycopg2 python-requests</li>
<li>make</li>
</ul>

<p>This should produce two deb files, one for bankapi and one for the pgcrypto
extension.</p>

<h3><a id="user-content-bankapi-10deb" class="anchor" href="#bankapi-10deb" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>bankapi-1.0.deb</h3>

<p>Package contains the command line tools for sending messages
(/usr/bin/bankapi), SQL needed for creating the bankapi in postgres and
installes a CGI as an endpoint for receving incoming communication messages.</p>

<p>The installation of the module installs and activates the CGI script. It will
be available under http://localhost/bankapi .</p>

<p>The installation does not finish the installation of the database but leaves
this as a manual task. Follow the following steps for a default database
installation:</p>

<ul>
<li>cd /usr/share/bankapi</li>
<li>sudo -u postgres createdb bankapi</li>
<li>sudo -u postgres psql --dbname=bankapi --single-transaction --no-psqlrc --file=install.sql</li>
<li>Make sure www-data user can connect to the bankapi database, this can for
instance be done by adding the following line where appropriate in the active
pg_hba.conf file: local bankapi www-data peer</li>
<li>To optionally install the test bank data: sudo -u postgres psql --dbname=bankapi --single-transaction --no-psqlrc --file=testdata/index.sql</li>
</ul>

<h3><a id="user-content-postgresql-pgcrypto-openpgp-93deb" class="anchor" href="#postgresql-pgcrypto-openpgp-93deb" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>postgresql-pgcrypto-openpgp-9.3.deb</h3>

<p>This is an extension to the pgcrypto PostgreSQL extension. The extension only
installs with the extended functions, all functions normally in pgcrypto is
still accessed from the standard pgcrypto extension. The extension is called
pgcrypto_openpgp.</p>
</article>
  </div></body></html>