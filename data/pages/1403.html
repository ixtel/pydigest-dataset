<html><body><div><div>
<p>What's <a class="reference external" href="http://morepath.readthedocs.org">Morepath</a>? Morepath is your friendly neighborhood web framework
with super powers. It lets you easily create links between resources,
and offers a range of mechanisms that allow you to better organize and
reuse code. Morepath is geared towards this modern age of the web
where more and more UI logic is moving into JavaScript, into the
browser -- it does this by being great at creating RESTful hypermedia
APIs.</p>
<p>Besides a few documentation fixes, <a class="reference external" href="http://morepath.readthedocs.org/en/0.6/changes.html">Morepath 0.6</a> has a minor
improvement and a major improvement.</p>
<p>Both improvements have to do with a relatively obscure use case that I
ran into lately. Application composition <em>should</em> be an important
feature in a modern web framework, and so does linking, but we only
rarely see things like this. That we run into use cases like this goes
to show just how far Morepath is ahead in exploring this area. See
<a class="reference external" href="http://morepath.readthedocs.org/en/latest/app_reuse.html#nesting-applications">nesting applications</a> and <a class="reference external" href="http://morepath.readthedocs.org/en/latest/app_reuse.html#linking-to-other-mounted-apps">linking to things in other apps</a> for
more information on these subsystems of Morepath.</p>
<p>The major improvement is the ability to link to other applications by
the <em>name</em> under which they've been mounted into their parent. By
default the name is the <em>path</em> under which they were mounted. Imagine
you have the following URL space:</p>
<pre class="literal-block">
/v1/
/v1/a
/v2/a
</pre>
<p>You can model this as two applications, <tt class="docutils literal">A</tt> and <tt class="docutils literal">B</tt> that are
mounted under a core application mounted at <tt class="docutils literal">v1</tt>. That would look
like this in Morepath:</p>
<pre class="code python literal-block">
<span class="k">class</span> <span class="nc">V1</span><span class="p">(</span><span class="n">morepath</span><span class="o">.</span><span class="n">App</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c"># makes a root object exist under /v1</span>
<span class="nd">@app.path</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">'/v1'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Root</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">morepath</span><span class="o">.</span><span class="n">App</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">morepath</span><span class="o">.</span><span class="n">App</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="o">//</span> <span class="n">mounts</span> <span class="n">everything</span> <span class="ow">in</span> <span class="n">app</span> <span class="n">A</span> <span class="n">under</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">a</span>
<span class="nd">@V1.mount</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">'a'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">a_context</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="o">//</span> <span class="n">mounts</span> <span class="n">everything</span> <span class="ow">in</span> <span class="n">app</span> <span class="n">B</span> <span class="n">under</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">b</span>
<span class="nd">@V1.mount</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">b_context</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{}</span>
</pre>
<p>Consider how you'd make a link from app <tt class="docutils literal">A</tt> to a resource in app
<tt class="docutils literal">B</tt> given this setup. In Morepath before 0.6, you'd have to write:</p>
<pre class="code python literal-block">
<span class="n">request</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre>
<p>This would create a link to whatever <tt class="docutils literal">obj</tt> is (which depends on its
path), for instance:</p>
<pre class="literal-block">
/v1/b/items/3
</pre>
<p>The minor improvement is that we realized the <tt class="docutils literal">.parent.child</tt>
combination happens a lot and we've introduced a new <a class="reference external" href="http://morepath.readthedocs.org/en/latest/api.html#morepath.Request.sibling">sibling</a> method
to combine them in one step:</p>
<pre class="code python literal-block">
<span class="n">request</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre>
<p>Now considers what happens when a new incompatible version of your
overall API arises, because you've changed something fundamentally in
app <tt class="docutils literal">B</tt>. Perhaps items appear on a <tt class="docutils literal">/foos</tt> path instead of an
<tt class="docutils literal">/items</tt> path, like:</p>
<pre class="literal-block">
/v2/b/foos/3
</pre>
<p>You've not changed anything in app <tt class="docutils literal">A</tt> though. What
you'd like to do is mount the new <tt class="docutils literal">B</tt> and the old <tt class="docutils literal">A</tt> into a
<tt class="docutils literal">V2</tt> app and have everything work as expected:</p>
<pre class="code python literal-block">
<span class="k">class</span> <span class="nc">V2</span><span class="p">(</span><span class="n">morepath</span><span class="o">.</span><span class="n">App</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="o">//</span> <span class="n">mounts</span> <span class="n">everything</span> <span class="ow">in</span> <span class="n">app</span> <span class="n">A</span> <span class="n">under</span> <span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="n">a</span>
<span class="nd">@V2.mount</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">'a'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">a_context</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="o">//</span> <span class="n">mounts</span> <span class="n">everything</span> <span class="ow">in</span> <span class="n">app</span> <span class="n">NewB</span> <span class="n">under</span> <span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="n">b</span>
<span class="nd">@V2.mount</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">NewB</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">b_context</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{}</span>
</pre>
<p>But this is problematic, as we have a hardcoded dependency on app
<tt class="docutils literal">B</tt> in app <tt class="docutils literal">A</tt> in the link generation code. Now we'd like to link
to app <tt class="docutils literal">NewB</tt> instead of <tt class="docutils literal">B</tt>. But we'd want the original <tt class="docutils literal">v1</tt>
URLs to still work as before, so we can't just modify app <tt class="docutils literal">A</tt> so to
include a link to <tt class="docutils literal">NewB</tt>. So in <tt class="docutils literal">/v1/a</tt> we'd like links to look
like this:</p>
<pre class="literal-block">
/v1/b/items/3
</pre>
<p>But in <tt class="docutils literal">/v2/a</tt> we'd like links to go to the new place in <tt class="docutils literal">NewB</tt>:</p>
<pre class="literal-block">
/v2/b/foos/3
</pre>
<p>The solution is the new ability to find mount applications by <em>name</em>
instead of by class. By the default the name is the same as the
<tt class="docutils literal">path</tt> argument you give in the <tt class="docutils literal">mount</tt> directive.</p>
<p>If you write linking code in app <tt class="docutils literal">A</tt> to read like this:</p>
<pre class="code python literal-block">
<span class="n">request</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="s">'b'</span><span class="p">)</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre>
<p>there is no more hardcoded dependency on app <tt class="docutils literal">B</tt>. Instead the system
now relies on the sibling app mounted under <tt class="docutils literal">b</tt> to create the link,
whatever it may be. And if <tt class="docutils literal">A</tt> is mounted under <tt class="docutils literal">/v1</tt> the sibling
will be <tt class="docutils literal">B</tt>, but if it's mounted under <tt class="docutils literal">/v2</tt> the sibling will be
<tt class="docutils literal">NewB</tt>. So the links will be correct in both cases, and we're saved!</p>
</div>
    </div></body></html>