<html><body><div><div class="content html_format"><p>
      Всем привет.</p>

<img src="https://habrastorage.org/files/642/d01/fc6/642d01fc6f6143bda8cd7c31b6353e46.png"/>
<p>
В данном примере я покажу один из способов запуска актуальной версии Django под свежим Python.

</p><a href="https://www.python.org/downloads/release/python-342/">Python 3.4.2 | Release Date: 2014-10-13</a>
<a href="https://docs.djangoproject.com/en/1.7/releases/1.7.4/">Django 1.7.4 | January 27, 2015</a>
<p>
Будут использованы </p><a href="https://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper</a><p> и </p><a href="https://github.com/yyuu/pyenv">pyenv</a><p>:</p><p>
 — virtualenvwrapper будет работать с «системным» python2</p><p>
 — используем pyenv для установки последней версии Python</p><p>
 — используем virtualenvwrapper для создания виртуального окружения с последней версей Python «внутри»
</p><a name="habracut"/>
<h2>Информация про систему</h2><p>
Запуск будет производится на Ubuntu 14.04.1 LTS:

</p><pre><code class="bash">devel787@vbox64:~$ uname -a
Linux vbox64 3.13.0-45-generic #74-Ubuntu SMP Tue Jan 13 19:36:28 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux

devel787@vbox64:~$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 14.04.1 LTS
Release:        14.04
Codename:       trusty
</code></pre>
<p>
После установки Ubuntu по умолчанию доступен bash:

</p><pre><code class="bash">devel787@vbox64:~$ echo $SHELL
/bin/bash

devel787@vbox64:~$ bash --version
GNU bash, version 4.3.11(1)-release (x86_64-pc-linux-gnu)
</code></pre>
<p>
Также по умолчанию сразу предустановлены 2 версии Python:

</p><pre><code class="bash">devel787@vbox64:~$ python --version
Python 2.7.6

devel787@vbox64:~$ python3 --version
Python 3.4.0
</code></pre>

<h2>Установка virtualenvwrapper</h2><p>
virtualenvwrapper представляет из себя удобную обёртку вокруг virtualenv.
</p><p>
Для установки virtualenvwrapper необходимо выполнить некоторые действия.
</p><p>
Получаем новые списки пакетов Ubuntu:

</p><pre><code class="bash">devel787@vbox64:~$ sudo apt-get update
</code></pre>
<p>
Устанавливаем pip:

</p><pre><code class="bash">devel787@vbox64:~$ sudo apt-get install python-pip
</code></pre>
<p>
Устанавливаем virtualenvwrapper:

</p><pre><code class="bash">devel787@vbox64:~$ sudo pip install virtualenvwrapper
</code></pre>
<p>
Настраиваем virtualenvwrapper:

</p><pre><code class="bash">devel787@vbox64:~$ echo '' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo '# virtualenvwrapper' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo 'export WORKON_HOME=$HOME/.virtualenvs' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo 'export PROJECT_HOME=$HOME/vwrapperhome' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo 'source /usr/local/bin/virtualenvwrapper.sh' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo '' &gt;&gt; ~/.bashrc
</code></pre>
<p>
Создаём папку для PROJECT_HOME из настроек выше:

</p><pre><code class="bash">devel787@vbox64:~$ mkdir ~/vwrapperhome
</code></pre>
<p>
Применяем настройки:

</p><pre><code class="bash">devel787@vbox64:~$ source ~/.bashrc
</code></pre>
<p>
Теперь у нас должны быть доступны команды virtualenvwrapper, например:

</p><pre><code class="bash">devel787@vbox64:~$ workon

devel787@vbox64:~$ virtualenvwrapper
</code></pre>

<h2>Установка pyenv</h2><p>
pyenv представляет из себя удобную утилиту для управления версиями Python.
</p><p>
Для установки pyenv необходимо выполнить некоторые действия.
</p><p>
Устанавливаем нужные зависимости:

</p><pre><code class="bash">devel787@vbox64:~$ sudo apt-get install make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm
</code></pre>
<p>
Устанавливаем git:

</p><pre><code class="bash">devel787@vbox64:~$ sudo apt-get install git
</code></pre>
<p>
Устанавливаем pyenv:

</p><pre><code class="bash">devel787@vbox64:~$ cd

devel787@vbox64:~$ git clone git://github.com/yyuu/pyenv.git .pyenv
</code></pre>
<p>
Настраиваем pyenv:

</p><pre><code class="bash">devel787@vbox64:~$ echo '' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo '# pyenv' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo 'export PYENV_ROOT="$HOME/.pyenv"' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo 'export PATH="$PYENV_ROOT/bin:$PATH"' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo 'eval "$(pyenv init -)"' &gt;&gt; ~/.bashrc

devel787@vbox64:~$ echo '' &gt;&gt; ~/.bashrc
</code></pre>
<p>
Применяем настройки:

</p><pre><code class="bash">devel787@vbox64:~$ exec $SHELL
</code></pre>
<p>
Теперь у нас должны быть доступны команды pyenv, например можно посмотреть версию утилиты:

</p><pre><code class="bash">devel787@vbox64:~$ pyenv --version
pyenv 20150204
</code></pre>

<h2>Установка Python 3.4.2</h2><p>
pyenv предоставляет возможность установить много разных версий Python.

</p><div class="spoiler"><b class="spoiler_title">Для просмотра всех доступных версий необходимо выполнить:</b><div class="spoiler_text"><pre><code class="bash">devel787@vbox64:~$ pyenv install --list
Available versions:
  2.1.3
  2.2.3
  2.3.7
  2.4
  2.4.1
  2.4.2
  2.4.3
  2.4.4
  2.4.5
  2.4.6
  2.5
  2.5.1
  2.5.2
  2.5.3
  2.5.4
  2.5.5
  2.5.6
  2.6.6
  2.6.7
  2.6.8
  2.6.9
  2.7-dev
  2.7
  2.7.1
  2.7.2
  2.7.3
  2.7.4
  2.7.5
  2.7.6
  2.7.7
  2.7.8
  2.7.9
  3.0.1
  3.1-dev
  3.1.3
  3.1.4
  3.1.5
  3.2-dev
  3.2
  3.2.1
  3.2.2
  3.2.3
  3.2.4
  3.2.5
  3.2.6
  3.3.0
  3.3-dev
  3.3.1
  3.3.2
  3.3.3
  3.3.4
  3.3.5
  3.3.6
  3.4.0
  3.4-dev
  3.4.1
  3.4.2
  3.5-dev
  anaconda-1.4.0
  anaconda-1.5.0
  anaconda-1.5.1
  anaconda-1.6.0
  anaconda-1.6.1
  anaconda-1.7.0
  anaconda-1.8.0
  anaconda-1.9.0
  anaconda-1.9.1
  anaconda-1.9.2
  anaconda-2.0.0
  anaconda-2.0.1
  anaconda-2.1.0
  anaconda3-2.0.0
  anaconda3-2.0.1
  anaconda3-2.1.0
  ironpython-dev
  ironpython-2.7.4
  ironpython-2.7.5
  jython-dev
  jython-2.5.0
  jython-2.5-dev
  jython-2.5.1
  jython-2.5.2
  jython-2.5.3
  jython-2.5.4-rc1
  jython-2.7-beta1
  jython-2.7-beta2
  jython-2.7-beta3
  miniconda-2.2.2
  miniconda-3.0.0
  miniconda-3.0.4
  miniconda-3.0.5
  miniconda-3.3.0
  miniconda-3.4.2
  miniconda-3.7.0
  miniconda3-2.2.2
  miniconda3-3.0.0
  miniconda3-3.0.4
  miniconda3-3.0.5
  miniconda3-3.3.0
  miniconda3-3.4.2
  miniconda3-3.7.0
  pypy-c-jit-latest
  pypy-c-nojit-latest
  pypy-dev
  pypy-1.5-src
  pypy-1.5
  pypy-1.6
  pypy-1.7-dev
  pypy-1.7
  pypy-1.8-dev
  pypy-1.8
  pypy-1.9-dev
  pypy-1.9
  pypy-2.0-dev
  pypy-2.0-src
  pypy-2.0
  pypy-2.0.1-src
  pypy-2.0.1
  pypy-2.0.2-src
  pypy-2.0.2
  pypy-2.1-src
  pypy-2.1
  pypy-2.2-src
  pypy-2.2
  pypy-2.2.1-src
  pypy-2.2.1
  pypy-2.3-src
  pypy-2.3
  pypy-2.3.1-src
  pypy-2.3.1
  pypy-2.4.0-src
  pypy-2.4.0
  pypy-2.4-beta1-src
  pypy-2.4-beta1
  pypy-2.5.0-src
  pypy-2.5.0
  pypy3-dev
  pypy3-2.3.1-src
  pypy3-2.3.1
  pypy3-2.4.0-src
  pypy3-2.4.0
  stackless-dev
  stackless-2.7-dev
  stackless-2.7.2
  stackless-2.7.3
  stackless-2.7.4
  stackless-2.7.5
  stackless-2.7.6
  stackless-2.7.7
  stackless-2.7.8
  stackless-3.2-dev
  stackless-3.2.2
  stackless-3.2.5
  stackless-3.3-dev
  stackless-3.3.5
  stackless-3.4.1
</code></pre>

</div></div>
<p>
Устанавливаем Python 3.4.2:

</p><pre><code class="bash">devel787@vbox64:~$ pyenv install 3.4.2 -v
</code></pre>
<p>
Выполняем 'rehash' (Rebuild the shim binaries. You should do this any time you install a new Python binary):

</p><pre><code class="bash">devel787@vbox64:~$ pyenv rehash
</code></pre>
<p>
Для просмотра установленных версий Python необходимо выполнить:

</p><pre><code class="bash">devel787@vbox64:~$ pyenv versions
* system (set by /home/devel787/.pyenv/version)
  3.4.2
</code></pre>

<h2>Создание виртуального окружения</h2><p>
Теперь можно создать виртуальное окружение на базе Python 3.4.2.
</p><p>
По умолчанию бинарный файл Python 3.4.2 будет доступен в '~/.pyenv/versions/':

</p><pre><code class="bash">devel787@vbox64:~$ ls -lahF ~/.pyenv/versions/3.4.2/bin/python
lrwxrwxrwx 1 devel787 devel787 9 Feb 10 16:24 /home/devel787/.pyenv/versions/3.4.2/bin/python -&gt; python3.4*
</code></pre>
<p>
Создаём виртуальное окружение (и сразу оказываемся “внутри” него):

</p><pre><code class="bash">devel787@vbox64:~$ mkvirtualenv -p ~/.pyenv/versions/3.4.2/bin/python polls174-py342-venv
</code></pre>
<p>
Проверяем версию Python:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~$ python --version
Python 3.4.2
</code></pre>
<p>
Для выхода из виртуального окружения необходимо выполнить:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~$ deactivate
</code></pre>
<p>
Для просмотра всех виртуальных окружений необходимо выполнить:

</p><pre><code class="bash">devel787@vbox64:~$ workon
polls174-py342-venv
</code></pre>
<p>
Попасть “обратно” в виртуальное окружение можно выполнив:

</p><pre><code class="bash">devel787@vbox64:~$ workon polls174-py342-venv
</code></pre>

<h2>Запуск Django 'polls' app</h2><p>
Для демонстрации работоспособности Django 1.7.4 под Python 3.4.2 запустим Django 'polls' app из </p><a href="https://docs.djangoproject.com/en/1.7/intro/tutorial01/">Django Tutorial</a><p>.
</p><p>
Я создал репозиторий, который содержит выполненный Django Tutorial и файл 'requirements.txt'.
</p><p>
Перейдём в папку для PROJECT_HOME из настроек выше:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~$ cd ~/vwrapperhome/
</code></pre>
<p>
«Склонируем» себе репозиторий, который содержит выполненный Django Tutorial:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~/vwrapperhome$ git clone https://github.com/devel787/polls174.git
</code></pre>
<p>
Перейдём в папку с проектом:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~/vwrapperhome$ cd polls174/
</code></pre>
<p>
«Закрепим» папку проекта за нашим виртуальным окружением (при активации окружения мы будем попадать в эту папку):

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~/vwrapperhome/polls174$ setvirtualenvproject
Setting project for polls174-py342-venv to /home/devel787/vwrapperhome/polls174
</code></pre>
<p>
Установим Django 1.7.4:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~/vwrapperhome/polls174$ pip install -r requirements.txt
</code></pre>
<p>
Запустим тесты:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~/vwrapperhome/polls174$ python manage.py test
</code></pre>
<p>
Запустим сервер для разработки:

</p><pre><code class="bash">(polls174-py342-venv)devel787@vbox64:~/vwrapperhome/polls174$ python manage.py runserver
</code></pre>
<p>
Теперь можно перейти по ссылке
</p><a href="http://127.0.0.1:8000/polls/">http://127.0.0.1:8000/polls/</a> <p>
и увидеть результаты работы данного примера.</p><p>
Для /admin/ Username == Password == 'admin'.

</p><h2>Литература</h2>
<a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">Virtual Environments | The Hitchhiker's Guide to Python</a>
<a href="http://virtualenvwrapper.readthedocs.org/en/latest/install.html">virtualenvwrapper | Installation</a>
<a href="https://github.com/yyuu/pyenv#installation">pyenv | Installation</a>

<a href="http://oblalex.blogspot.com/2014/09/blast-into-pyenv.html">Blast into PyEnv [18 сентября 2014]</a>
<a href="http://davebehnke.com/python-pyenv-ubuntu.html">Building Python on Ubuntu with pyenv [02 марта 2014]</a>
<a href="http://habrahabr.ru/post/203516/">Менеджер версий python [25 ноября 2013]</a>
<a href="http://habrahabr.ru/post/179831/">Мульти-хостинг django приложений с помощью nginx + uwsgi + virtualenv [15 мая 2013]</a>

<a href="https://docs.djangoproject.com/en/1.7/intro/tutorial01/">Writing your first Django app, part 1</a>
      <p class="clear"/>
    </div>

    
  </div></body></html>