<html><body><div><div itemprop="articleBody" class="article-body"><p>When I started learning Python, there's a few things I wish I had known about.  It took a while to learn them all.  This is my attempt to compile the highlights into a single post.  This post is targeted towards experienced programmers just getting started with Python who want to skip the first few months of researching the Python equivalents of tools they are already used to.  The sections on package management and standard tools will be helpful to beginners as well.</p>
<p>My experience is mainly with Python 2.7, but many of the same tools should work with newer versions.</p>
<p>If you have never used Python before, I strongly suggest reading the <a href="https://docs.python.org/2/tutorial/introduction.html" target="_blank">Python introduction</a>, as you'll need to know basic syntax and types.</p>
<h2>Package Management</h2>
<p>One great part of the Python universe is the sheer number of third party packages.  It's also very easy to manage these packages.  By convention, a project lists the packages it needs in a <code>requirements.txt</code> file.  You'll see 1 package per line, generally including a version.  Here's a sample from this blog, which uses <a href="http://blog.getpelican.com/" target="_blank">Pelican</a>:</p>
<div class="highlight"><pre>pelican==3.3
Markdown
pelican-extended-sitemap==1.0.0
</pre></div>


<p>One drawback to Python's packages is that by default they are globally installed.  We're going to use a tool that lets us have an environment for each project call virtualenv.  We'll also set up a more advanced package management tool called pip that works well with virtualenv.</p>
<p>First, we should install pip.  Most python installations already have <code>easy_install</code> (the default Python package manager), so we simply <code>easy_install pip</code>.  This should be one of the last times you'll use easy_install.  If you don't have easy_install already, on linux it seems to be available in the <code>python-setuptools</code> package. </p>
<p><em>If you're using Python &gt;= 3.3, Virtualenv is part of the standard library, so installing it is unnecessary.</em></p>
<p>Next up, you'll want to install <a href="http://virtualenv.readthedocs.org/en/latest/" target="_blank">virtualenv</a> and <a href="http://virtualenvwrapper.readthedocs.org/en/latest/" target="_blank">virtualenvwrapper</a>.  Virtualenv lets you create an isolated environment for each project.  Especially useful when you use different versions of packages in different projects.  Virtualenv wrapper provides a few nice scripts to make things a little easier.</p>
<div class="highlight"><pre>sudo pip install virtualenvwrapper
</pre></div>


<p>When virtualenvwrapper is installed, it lists virtualenv as a dependency, so it's automatically installed.</p>
<p>Open a new shell, and type <code>mkvirtualenv test</code>.  If you open another shell, you won't be in the virtualenv, and can activate it using <code>workon test</code>.  If you're done, you can simply <code>deactivate</code>.</p>
<p><img alt="virtualenv" src="../../../images/virtualenv.png"/> </p>
<h2>IPython</h2>
<p>IPython is an alternative to the standard Python REPL that allows for auto complete, quick access to docs, and a slew of other features that really should have been in the standard REPL.  </p>
<p>Simply <code>pip install ipython</code> while you're in a virtual environment.  Start it on the command line with  <code>ipython</code>. </p>
<p><img alt="ipython repl" src="../../../images/ipython_cli.png"/> </p>
<p>Also nice is the "notebook" feature, which requires additional components.  After installing, you'll be able to <code>ipython notebook</code> and get a nice web UI where you can build out notebooks.  It's very popular in scientific computing.</p>
<p><img src="http://ipython.org/_images/9_home_fperez_prof_grants_1207-sloan-ipython_proposal_fig_ipython-notebook-specgram.png"/></p>
<h2>Testing</h2>
<p>I recommend getting <a href="https://nose.readthedocs.org/en/latest/" target="_blank">nose</a> or <a href="http://pytest.org/latest/">py.test</a>.  I've used nose mostly.  Getting started with either is roughly the same amount of work.  I'll give details on nose.</p>
<p>Here's a ridiculously contrived example of a test in nose.  Anything function that starts with test_ in a file that starts with test_ will be called:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="bp">True</span> <span class="o">==</span> <span class="bp">False</span>
</pre></div>


<p>As expected, our test will fail when we tell nose to run:</p>
<div class="highlight"><pre>(test)jhaddad@jons-mac-pro ~VIRTUAL_ENV/src$ nosetests                                                                                                                                      
F
======================================================================
FAIL: test_nose_example.test_equality
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/jhaddad/.virtualenvs/test/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/Users/jhaddad/.virtualenvs/test/src/test_nose_example.py", line 3, in test_equality
    assert True == False
AssertionError

----------------------------------------------------------------------
</pre></div>


<p>There's also some convenience methods in <code>nose.tools</code>:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="n">assert_true</span>
<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="n">assert_true</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p>If you're more comfortable using an approach similar to JUnit, that's fine too:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="n">assert_true</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="k">class</span> <span class="nc">ExampleTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># setUp &amp; tearDown are both available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blah</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">test_blah</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blah</span><span class="p">)</span>
</pre></div>


<p>Running the tests:</p>
<div class="highlight"><pre>(test)jhaddad@jons-mac-pro ~VIRTUAL_ENV/src$ nosetests                                                                                                                                      
F
======================================================================
FAIL: test_blah (test_nose_example.ExampleTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/jhaddad/.virtualenvs/test/src/test_nose_example.py", line 11, in test_blah
    self.assertTrue(self.blah)
AssertionError: False is not true

----------------------------------------------------------------------
Ran 1 test in 0.003s

FAILED (failures=1)
</pre></div>


<p>The excellent <a href="http://www.voidspace.org.uk/python/mock/" target="_blank">Mock</a> library is included with Python 3, but if you're using Python 2 it's available through pypi.  Here's a test that makes a remote call, but that call takes 10 seconds.  The example is obviously contrived.  We use a mock to return sample data rather than actually make the call.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">mock</span>

<span class="kn">from</span> <span class="nn">mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">class</span> <span class="nc">Sweetness</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">slow_remote_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">"some_data"</span> <span class="c"># lets pretend we get this back from our remote api call</span>

<span class="k">def</span> <span class="nf">test_long_call</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sweetness</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">slow_remote_call</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s">"some_data"</span>
</pre></div>


<p>Of course, our tests take forever.  </p>
<div class="highlight"><pre>(test)jhaddad@jons-mac-pro ~VIRTUAL_ENV/src$ nosetests test_mock.py                                                                                                                         

Ran 1 test in 10.001s

OK
</pre></div>


<p>Ack, too slow!  So we ask ourselves, what are we testing?  Do we need to test that the remote call works, or do we need to test what we do with the data once we get it back?  In most cases, it's the latter.  Let's mock away that silly remote call:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">mock</span>

<span class="kn">from</span> <span class="nn">mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">class</span> <span class="nc">Sweetness</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">slow_remote_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">"some_data"</span> <span class="c"># lets pretend we get this back from our remote api call</span>

<span class="k">def</span> <span class="nf">test_long_call</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sweetness</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"slow_remote_call"</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s">"some_data"</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">slow_remote_call</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s">"some_data"</span>
</pre></div>


<p>Alright, let's try again:</p>
<div class="highlight"><pre>(test)jhaddad@jons-mac-pro ~VIRTUAL_ENV/src$ nosetests test_mock.py                                                                                                                         
.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</pre></div>


<p>Much better.  Keep in mind this example is ridiculously simplified.  Personally, I only mock calls to remote systems, not to my database.</p>
<p>nose-progressive is a great module that improves the output of nose to show you errors as they happen rather than hide them till the end.  This is nice if you've got tests that take a while. <code>pip install nose-progressive</code> and add <code>--with-progressive</code> to your <code>nosetests</code> command.</p>
<h2>Debugging</h2>
<p>iPDB is an excellent tool that I've used to figure out some weird bugs.  <code>pip install ipdb</code>, then add the line <code>import ipdb; ipdb.set_trace()</code> somewhere in your code, and you get a nice interactive prompt in your running program.  It's each to step through a program one line at a time and inspect variables.</p>
<p><img alt="ipdb" src="../../../images/ipdb.png"/> </p>
<p>There's a nice <a href="https://docs.python.org/2/library/trace.html" target="_blank">tracing module</a> built into python that's helped me figure out exactly what's going on.  Here's a trivial python program:</p>



<p>And our trace of that program:</p>
<div class="highlight"><pre>(test)jhaddad@jons-mac-pro ~VIRTUAL_ENV/src$ python -m trace --trace tracing.py                                                                                                        1 âľ  
 --- modulename: tracing, funcname: &lt;module&gt;
tracing.py(1): a = 1
tracing.py(2): b = 2
tracing.py(3): a = b
 --- modulename: trace, funcname: _unsettrace
trace.py(80):         sys.settrace(None)
</pre></div>


<p>This is very useful when you're trying to figure out the internals of some other program.  If you've used strace before, this works similarly.</p>
<p>I've used <a href="http://pycallgraph.slowchop.com/en/master/" target="_blank">pycallgraph</a> to track down performance issues on several occasions.  It builds a nice graph of your call times and call count.</p>
<p><img src="http://pycallgraph.slowchop.com/en/master/_downloads/basic.png"/></p>
<p>Lastly, <a href="http://mg.pov.lt/objgraph/" target="_blank">objgraph</a> is very useful for hunting down memory leaks.  Here's a <a target="_blank" href="http://mg.pov.lt/blog/hunting-python-memleaks.html">great blog post on how to use it to hunt down memory leaks</a>.</p>
<h2>Gevent</h2>
<p>Gevent is a great library that wraps Greenlets, which add the ability to do async calls in Python.  Yes, it's awesome.  My favorite feature is the <a href="http://www.gevent.org/gevent.pool.html" target="_blank">Pool</a>, which abstracts away the async part and gives us something easier to work with, an async map():</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">gevent</span> <span class="kn">import</span> <span class="n">monkey</span>
<span class="n">monkey</span><span class="o">.</span><span class="n">patch_all</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">time</span>

<span class="k">def</span> <span class="nf">fetch_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">"Fetching </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="n">url</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">"Done fetching </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="n">url</span>

<span class="kn">from</span> <span class="nn">gevent.pool</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">"http://test.com"</span><span class="p">,</span> <span class="s">"http://bacon.com"</span><span class="p">,</span> <span class="s">"http://eggs.com"</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fetch_url</span><span class="p">,</span> <span class="n">urls</span><span class="p">)</span>
<span class="k">print</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</pre></div>


<p>It's important to note the gevent monkey patching at the top, without it, this won't work correctly.  If we called fetch_url 3 times in a row with Python we'd normally expect this to take 30 seconds.  With gevent:</p>
<div class="highlight"><pre>(test)jhaddad@jons-mac-pro ~VIRTUAL_ENV/src$ python g.py                                                                                                                                    
Fetching http://test.com
Fetching http://bacon.com
Fetching http://eggs.com
Done fetching http://test.com
Done fetching http://bacon.com
Done fetching http://eggs.com
10.001791954
</pre></div>


<p>Useful if you've got lots of database calls or fetching from remote URLs.  I'm not a big fan of callbacks so this abstraction works well for me.</p>
<h2>Conclusion</h2>
<p>Alright, if you've made it this far, there's a good chance you've learned something new.  These are the tools that made the biggest impact on me over the last few years.  It took a while to track them all down, so hopefully this reduces the effort other people have to make to get used to this excellent language.  </p></div>
	</div></body></html>