<html><body><div><div class="content html_format">
      <img src="https://habrastorage.org/files/746/307/ba4/746307ba4a0440b2b342d8c30fe2de49.png" alt="image" align="left"/><p> Думаю, все знают, что такое сессии в Django, не так ли? Без них довольно сложно представить разработку приложений. В них обычно хранят ID пользователя и какие-нибудь промежуточные данные. Ими пользуются чаще, чем задумываются о настройке способа их хранения. Конечно, настроек «по умолчанию», как правило, бывает достаточно для того, чтобы запустить практически любой проект. Однако пытливый ум требует узнать, какая из возможных конфигураций </p><b>работает быстрее</b><p>…
</p><p>
В документации Django очень подробно описывается, как работают различные </p><a href="https://docs.djangoproject.com/en/1.7/topics/http/sessions/">Session Engine</a><p> и как их настроить. В этой статье пойдёт речь о том, как я тестировал различные конфигурации развёртывания </p><a href="https://github.com/mnach/django_sessionengine_benchmark">гипотетического проекта</a><p>.
</p><a name="habracut"/>
<h4>Исходные данные</h4><p>
Тестирование проводилось на 2-х виртуальных машинах под управлением debian wheezy. Машины расположены в рамках одной подсети.
</p><ul>
<li>model name: Intel Xeon CPU E7- 4830 @ 2.13GHz</li>
<li>RAM: 8GB</li>
<li>Linux Kernel Version: 3.2.0-4-amd64</li>
</ul><p>
Первая — для сохранения данных сессии в базах данных. Вторая для запуска приложения.</p><p>
В рамках тестирования использовалось 2 БД:
</p><ul>
<li>PostgreSQL – 9.1.15 </li>
<li>Redis — 2.4.14-1 </li>
</ul><p>
Приложение запущено на
</p><ul>
<li>Python — 3.4.3 </li>
<li>Django — 1.7.7</li>
</ul><p>
Выбран сервер приложений gunicorn с асинхронными рабочими (eventlet):
</p><ul>
<li>Gunicorn — 19.3.0 </li>
<li>Eventlet — 0.17.3 </li>
<li>libevent — 1.4-2 </li>
</ul><p>
Для оценки производительности использовался Apache Bench. 
</p><ul>
<li>Число запросов = 4000 </li>
<li>Паралельных соединений = 20 </li>
<li>В рамках одного идентификатора сессии (sessionid)</li>
</ul>
<h4>Задача</h4><p>
Протестировать входящие в фреймворк бэкенды для хранения данных сессий
</p><ol>
<li>database-backed — postgresql </li>
<li>cached — redis </li>
<li>file-based — файловая система ext2 </li>
<li>cookie-based — для данных до 4K </li>
</ol><p>
Документацию по ним можно найти </p><a href="https://docs.djangoproject.com/en/1.7/topics/http/sessions/#configuring-the-session-engine">тут</a><p>.

</p><h4>Тестирование</h4><p>
Я решил провести тестирование в двух конфигурациях: «только чтение» и «чтение и запись». При этом также сформировать не очень сложную страничку с использованием django-темплейтов, чтобы это походило на хоть и очень простое, но всё же реальное приложение.

</p><h5>Чтение</h5>
<img src="https://habrastorage.org/files/518/fae/151/518fae1519b34e40ae4732266912ba51.png"/>

<h5>Запись</h5>
<img src="https://habrastorage.org/files/e54/e8c/fb9/e54e8cfb9a5746e6abdfd9239c8083ee.png"/>

<h4>Выводы</h4><p>
Из графиков видно, что при хранении большого количества данных в сессии существенно падает скорость загрузки страниц приложения. Зависимость между количеством данных и скоростью загрузки приобретает логарифмический характер после 16К.
</p><p>
Также сложно не заменить, что сохранение сессии в базе данных существенно отстаёт по производительности от остальных конфигураций. Впрочем, это было довольно предсказуемо. Довольно необычным для меня было поведение файлового хранилища сессий. В частности, скорость доступа к файлу оказалась выше, чем у БД redis в рамках одной подсети при объёме сессии меньше ~ 64K. Возможно, это как-то связано с конфигурацией виртуальных машин, не знаю…
</p><p>
По результатам тестов сформировал следующие правила в использовании хранилищами:

</p><img src="https://habrastorage.org/files/7f8/00f/e9d/7f800fe9da584165b7f3bf143bd500d7.png"/>
<p>
Спасибо за внимание!
      </p><p class="clear"/>
    </div>

    
  </div></body></html>