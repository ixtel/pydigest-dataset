<html><body><div><div class="entry">
    <p>Someone recently asked me if there's a way to translate a 2 letter country code (i.e. US) to a country name (i.e. United States), and similarly, if there's a way to translate a 3 letter country code (i.e. CAN) to a country name (i.e. Canada).</p>

<p>Wikipedia has a <a href="https://en.wikipedia.org/wiki/Country_code">page</a> that lists different data properties for each country. This data include country codes, mobile country code, country top level domain, etc. </p>

<p>In this tutorial we will scrape Wikipedia for the information about each country, and then translate between the different possible country names. We will perform the following steps:</p>

<ol>
<li>The countries are listed in different pages on Wikipedia, so we will first get the urls for all these pages automatically</li>
<li>We will iterate over all of these urls and extract the listed details for each country</li>
<li>Save the results in a file</li>
<li>Load the data from the file and create an object that translates a country code to a full country name</li>
</ol>

<p>The code for this tutorial can be found on <a href="https://github.com/kazuar/country_data_codes">Github</a>.</p>

<h1>Requirements</h1>

<p>The code uses the following packages (can be found in the <a href="https://github.com/kazuar/country_data_codes/blob/master/requirements.txt">requirements.txt</a>):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">bs4
json
requests
argparse</code></pre></div>

<h1>Step 1: Get urls for all countries</h1>

<p>First, we will extract all the urls for the countries' data.</p>

<p>In order to do that we will fetch the Wikipedia page using the <a href="http://www.python-requests.org/en/latest/">requests</a> module.
After that we will use <a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> to create a soup object from the content of the page. The soup object will help us to easily retrieve the data that we want from the HTML.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">url</span> <span class="o">=</span> <span class="s">"https://en.wikipedia.org/wiki/Country_code"</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">"html.parser"</span><span class="p">)</span></code></pre></div>

<p>Next, we will want to extract the country pages urls from the <a href="https://en.wikipedia.org/wiki/Country_code#Lists_of_country_codes_by_country">"Lists of country codes by country"</a> section of the page.</p>

<p><img src="/images/scrape_wikipedia_tutorial/country_pages.png" alt="country_pages"/></p>

<p>In the <a href="view-source:https://en.wikipedia.org/wiki/Country_code#Lists_of_country_codes_by_country">page source</a>, the data that we want to extract looks like this:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_A"</span> <span class="na">title=</span><span class="s">"Country codes: A"</span><span class="nt">&gt;</span>A<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_B"</span> <span class="na">title=</span><span class="s">"Country codes: B"</span><span class="nt">&gt;</span>B<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_C"</span> <span class="na">title=</span><span class="s">"Country codes: C"</span><span class="nt">&gt;</span>C<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_D%E2%80%93E"</span> <span class="na">title=</span><span class="s">"Country codes: D–E"</span><span class="nt">&gt;</span>D–E<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_F"</span> <span class="na">title=</span><span class="s">"Country codes: F"</span><span class="nt">&gt;</span>F<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_G"</span> <span class="na">title=</span><span class="s">"Country codes: G"</span><span class="nt">&gt;</span>G<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_H%E2%80%93I"</span> <span class="na">title=</span><span class="s">"Country codes: H–I"</span><span class="nt">&gt;</span>H–I<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_J%E2%80%93K"</span> <span class="na">title=</span><span class="s">"Country codes: J–K"</span><span class="nt">&gt;</span>J–K<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_L"</span> <span class="na">title=</span><span class="s">"Country codes: L"</span><span class="nt">&gt;</span>L<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_M"</span> <span class="na">title=</span><span class="s">"Country codes: M"</span><span class="nt">&gt;</span>M<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_N"</span> <span class="na">title=</span><span class="s">"Country codes: N"</span><span class="nt">&gt;</span>N<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_O%E2%80%93Q"</span> <span class="na">title=</span><span class="s">"Country codes: O–Q"</span><span class="nt">&gt;</span>O–Q<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_R"</span> <span class="na">title=</span><span class="s">"Country codes: R"</span><span class="nt">&gt;</span>R<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_S"</span> <span class="na">title=</span><span class="s">"Country codes: S"</span><span class="nt">&gt;</span>S<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_T"</span> <span class="na">title=</span><span class="s">"Country codes: T"</span><span class="nt">&gt;</span>T<span class="nt">&lt;/a&gt;</span> - 
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/wiki/Country_codes:_U%E2%80%93Z"</span> <span class="na">title=</span><span class="s">"Country codes: U–Z"</span><span class="nt">&gt;</span>U–Z<span class="nt">&lt;/a&gt;&lt;/p&gt;</span></code></pre></div>

<p>We can see that for each letter we have an <strong><code>&lt;a&gt;</code></strong> tag with <strong>"href"</strong> that has the following template <strong><code>"/wiki/Country_codes:_&lt;LETTER / LETTER RANGE&gt;"</code></strong>. We want the <strong>"href"</strong> values of these <strong><code>&lt;a&gt;</code></strong> tags, they will lead us to the country data.</p>

<p>In the next one liner we perform the following actions:</p>

<ol>
<li><strong>soup.findAll('a')</strong> - extracts all the <strong><code>&lt;a&gt;</code></strong> tags from the page.</li>
<li><strong><code>a_elem</code>.attrs.get('href', '').startswith(<code>'/wiki/Country_codes'</code>)</strong> - we check for each <strong><code>a_elem</code></strong> that the has a <strong>"href"</strong> attribute and starts with <strong><code>"/wiki/Country_codes"</code></strong>.</li>
<li>Save the <strong>"href"</strong> of the <strong><code>a_elem</code></strong> that fulfills the required condition in <strong><code>countries_urls</code></strong>.</li>
</ol>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">countries_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_elem</span><span class="p">[</span><span class="s">'href'</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_elem</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span> <span class="k">if</span> <span class="n">a_elem</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'href'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'/wiki/Country_codes'</span><span class="p">)]</span></code></pre></div>

<p>After running this line, <strong><code>"countries_urls"</code></strong> should have the following values:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">countries_urls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"/wiki/Country_codes:_A"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_B"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_C"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_D</span><span class="si">%E</span><span class="s">2</span><span class="si">%80%</span><span class="s">93E"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_F"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_G"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_H</span><span class="si">%E</span><span class="s">2</span><span class="si">%80%</span><span class="s">93I"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_J</span><span class="si">%E</span><span class="s">2</span><span class="si">%80%</span><span class="s">93K"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_L"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_M"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_N"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_O</span><span class="si">%E</span><span class="s">2</span><span class="si">%80%</span><span class="s">93Q"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_R"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_S"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_T"</span><span class="p">,</span>
    <span class="s">"/wiki/Country_codes:_U</span><span class="si">%E</span><span class="s">2</span><span class="si">%80%</span><span class="s">93Z"</span>
<span class="p">]</span></code></pre></div>

<h1>Step 2: Get the details for each country</h1>

<p>Now that we have all the urls for the country data saved in <strong>"<code>countries_urls</code>"</strong>, we will extract the data that we actually want from these urls.</p>

<p>Each url holds a list of countries and information about them.
You can see examples of how this data looks in the following <a href="https://en.wikipedia.org/wiki/Country_codes:_C">page</a> or in the following image:</p>

<p><img src="/images/scrape_wikipedia_tutorial/country_data.png" alt="country_data"/></p>

<p>In the code we'll create a new function called <strong>"<code>scrape_countries_details</code>"</strong>.
This function will help us collect the data for all of the countries from each url.
We will use the function as we iterate on the urls that we fetched in <strong>step 1</strong>.
The <strong>"<code>scrape_countries_details</code>"</strong> function will return a list of country data from the url.
We will save these results in the <strong>"<code>all_countries_details</code>"</strong> list.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">all_countries_details</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">countries_url</span> <span class="ow">in</span> <span class="n">countries_urls</span><span class="p">:</span>
    <span class="n">countries_data</span> <span class="o">=</span> <span class="n">scrape_countries_details</span><span class="p">(</span><span class="n">BASE_URL</span> <span class="o">+</span> <span class="n">countries_url</span><span class="p">)</span>
    <span class="n">all_countries_details</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">countries_data</span><span class="p">)</span></code></pre></div>

<p>The <strong><code>"scrape_countries_details"</code></strong> function will work in the following way:</p>

<p>1) Get the url content and convert it to a soup object</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get remote page</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c"># Create soup object from page content</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">"html.parser"</span><span class="p">)</span></code></pre></div>

<p>2) Fetch all elements that hold country names</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Fetch all elements that hold country names</span>
<span class="n">country_names_elems</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="s">'mw-headline'</span><span class="p">)</span></code></pre></div>

<p>3) Iterate over <strong><code>"country_names_elems"</code></strong> and for each <strong><code>"country_name_elem"</code></strong> retrieve the relevant table of contents</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Find the next table element after country name while holds</span>
<span class="c"># the country's data</span>
<span class="n">country_table</span> <span class="o">=</span> <span class="n">country_name_elem</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">findNext</span><span class="p">(</span><span class="s">"table"</span><span class="p">)</span></code></pre></div>

<p>4) From the country's data table, retrieve all the cells and create a dictionary, <strong>"country_data"</strong>, from the keys (cell names) and values (cell values) in the table</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Fetch all the cells in the table</span>
<span class="n">tds</span> <span class="o">=</span> <span class="n">country_table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">"td"</span><span class="p">)</span>

<span class="c"># Each cell holds the cell name and the value </span>
<span class="c"># so we can create a dict by reading each cell</span>
<span class="c"># with the cell name as the key and the cell data as the value</span>
<span class="n">country_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">td</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">td</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"span"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">}</span></code></pre></div>

<p>5) Add the country name and Wikipedia page url for the country to <strong><code>"country_data"</code></strong> dictionary from the <strong><code>"country_name_elem"</code></strong> object</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">country_a_elem</span> <span class="o">=</span> <span class="n">country_name_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
<span class="n">country_data</span><span class="p">[</span><span class="s">"country_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">country_a_elem</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">country_data</span><span class="p">[</span><span class="s">"country_url"</span><span class="p">]</span> <span class="o">=</span> <span class="n">BASE_URL</span> <span class="o">+</span> <span class="n">country_a_elem</span><span class="p">[</span><span class="s">'href'</span><span class="p">]</span></code></pre></div>

<p>6) Add the <strong><code>"country_data"</code></strong> to the <strong><code>"countries_data"</code></strong> list that will contain all the countries and their data from the page. This list will be the output of the function.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">countries_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">country_data</span><span class="p">)</span></code></pre></div>

<p>A full resolution of the function's code:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">scrape_countries_details</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="c"># Get remote page</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c"># Create soup object from page content</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">"html.parser"</span><span class="p">)</span>

    <span class="n">countries_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># Fetch all elements that holds country name</span>
    <span class="n">country_names_elems</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="s">'mw-headline'</span><span class="p">)</span>

    <span class="c"># For each country element retrieve all the relevant data</span>
    <span class="k">for</span> <span class="n">country_name_elem</span> <span class="ow">in</span> <span class="n">country_names_elems</span><span class="p">:</span>
        <span class="c"># Find the next table element after country name while holds</span>
        <span class="c"># the country's data</span>
        <span class="n">country_table</span> <span class="o">=</span> <span class="n">country_name_elem</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">findNext</span><span class="p">(</span><span class="s">"table"</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">country_table</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c"># Fetch all the cells in the table</span>
        <span class="n">tds</span> <span class="o">=</span> <span class="n">country_table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">"td"</span><span class="p">)</span>

        <span class="c"># Each cell holds the column name and the value </span>
        <span class="c"># so we can create a dict by reading each cell</span>
        <span class="c"># with the column name as the key and the cell data as the value</span>
        <span class="n">country_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">td</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">td</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">"span"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">}</span>

        <span class="c"># Add the country name and wikipedia page url for the country</span>
        <span class="n">country_a_elem</span> <span class="o">=</span> <span class="n">country_name_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
        <span class="n">country_data</span><span class="p">[</span><span class="s">"country_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">country_a_elem</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">country_data</span><span class="p">[</span><span class="s">"country_url"</span><span class="p">]</span> <span class="o">=</span> <span class="n">BASE_URL</span> <span class="o">+</span> <span class="n">country_a_elem</span><span class="p">[</span><span class="s">'href'</span><span class="p">]</span>
        <span class="n">countries_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">country_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">countries_data</span></code></pre></div>

<p>In the end we will want to save our data in a file so we can use it later.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">all_countries_details</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span></code></pre></div>

<p>Code for this part can be found <a href="https://github.com/kazuar/country_data_codes/blob/master/country_codes_scraper.py">here</a></p>

<h1>Step 3: Create country code translator</h1>

<p>Once we have a file with all the country data, we can create our country code translator.
We want to create an object that will resolve every type of country code to the country name.
For example, we want to be to do the following translations:</p>

<ol>
<li>"US" =&gt; "United States"</li>
<li>"USA" = &gt; "United States"</li>
<li>"ca" =&gt; "Canada"</li>
<li>"can" =&gt; "Canada" </li>
</ol>

<p>In order to do that, we'll create an object that gets a file path and loads the data from the file:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">CountryDataCodes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_countries_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span></code></pre></div>

<p>The next code is for creating dictionaries that will allow us to do the following: </p>

<ol>
<li>Translate between 2 letter country code to country name (using the 'ISO 3166-1 alpha-2' values from each country)</li>
<li>Translate between 3 letter country code to country name (using the 'ISO 3166-1 alpha-3' values from each country)</li>
<li>Translate country name to country details.</li>
</ol>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">_countries_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">country_data</span><span class="p">[</span><span class="s">"country_name"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">country_data</span> <span class="k">for</span> <span class="n">country_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_countries_data</span><span class="p">}</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_alpha_two_to_country_name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_alpha_three_to_country_name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">country_name</span><span class="p">,</span> <span class="n">country_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_countries_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">alpha_two</span> <span class="o">=</span> <span class="n">country_data</span><span class="p">[</span><span class="s">'ISO 3166-1 alpha-2'</span><span class="p">]</span>
    <span class="n">alpha_three</span> <span class="o">=</span> <span class="n">country_data</span><span class="p">[</span><span class="s">'ISO 3166-1 alpha-3'</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_two_to_country_name</span><span class="p">[</span><span class="n">alpha_two</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">country_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_three_to_country_name</span><span class="p">[</span><span class="n">alpha_three</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">country_name</span></code></pre></div>

<p>We will also create a function for retrieving country details no matter what type of country name we choose:</p>

<ol>
<li>2 letter country code</li>
<li>3 letter country code</li>
<li>country name </li>
</ol>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_country_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">country_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_two_to_country_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">country_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_three_to_country_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">country_name</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_countries_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">country_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">country_data</span></code></pre></div>

<p>Code for this part can be found <a href="https://github.com/kazuar/country_data_codes/blob/master/country_data_codes.py">here</a></p>

<p>That's it!</p>

<p>Full code sample can be found on <a href="https://github.com/kazuar/country_data_codes">Github</a>.</p>

  </div>

  </div></body></html>