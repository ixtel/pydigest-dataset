<html><body><div><section class="entry-content "><pre><span><em>This article covers an older version of the source code linked below. A few additional options, like filtering
spam-tweets, came in but the base functionality remained the same. If you experience any problems using the 
newer versions, please, leave a comment.</em></span></pre><p>Â </p><p>I am a <strong>Twitter-Addict</strong>. Most of my coding-related stuff comes from links and suggestions via Twitter. And of course Iâ€™m using it everywhere, from desktop to smartphone, while travelling, or at work. My carefully defined feeds are always fresh &amp; flowing. However, sometimes I justÂ want to have all the interesting tweets collected in one place without any external complexities,Â whistles &amp; bells.</p><p>It should be <em>configurable</em> via JSON and I want to collect the incoming dataÂ for later processing because these days no data is useless.</p><p>Well, what about an <em>easily configurable</em>,<em>Â <a href="https://github.com/brakmic/TwitterClient" target="_blank">console-based</a></em><a href="https://github.com/brakmic/TwitterClient" target="_blank"> Twitter Client</a> with <em>colorized output</em> that can <em>persist tweets to a database?</em></p><p>In this article weâ€™ll develop such a client withÂ <strong>Python v.2.7</strong></p><h4><strong>Accessing the Twitter APIÂ </strong></h4><p>Probably most of you already know that Twitter expects an app to have a number of keys generated before it can connect their API. The creation and management of these keys is done via <a href="https://apps.twitter.com/" target="_blank">Application Management</a>. Â To create a new app click on the button <em>Create New App</em> and fill in the details:</p><p>Â </p><p><a href="http://blog.brakmic.com/wp-content/uploads/2015/10/create_twitter_app.png" class="grouped_elements" rel="tc-fancybox-group101"><img class="alignnone wp-image-102" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://blog.brakmic.com/wp-content/uploads/2015/10/create_twitter_app.png" alt="create_twitter_app" data-srcset="http://blog.brakmic.com/wp-content/uploads/2015/10/create_twitter_app-287x300.png 287w, http://blog.brakmic.com/wp-content/uploads/2015/10/create_twitter_app.png 902w" sizes="(max-width: 740px) 100vw, 740px"/></a></p><p>After clicking on <em>Create your Twitter application</em> you should see a window like this.</p><p><a href="http://blog.brakmic.com/wp-content/uploads/2015/10/twitter_client_api_01.png" class="grouped_elements" rel="tc-fancybox-group101"><img class="alignnone wp-image-103" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://blog.brakmic.com/wp-content/uploads/2015/10/twitter_client_api_01.png" alt="twitter_client_api_01" data-srcset="http://blog.brakmic.com/wp-content/uploads/2015/10/twitter_client_api_01-274x300.png 274w, http://blog.brakmic.com/wp-content/uploads/2015/10/twitter_client_api_01.png 787w" sizes="(max-width: 739px) 100vw, 739px"/></a></p><p>The important parts are the Consumer Key (API Key) and the <em>Keys and Access tokens</em> in the third tab. These youâ€™ll use to create a JSON config file for this application.</p><h4><b>Communicating with Twitter API</b></h4><p>OAuth is pervert. Period! I never liked it. Of course, it does all the nice things and doing nothing regarding communication security is outright stupid but in this case all we want is a simple Twitter Client. Therefore weâ€™ll use the <a href="https://github.com/tweepy/tweepy" target="_blank">Tweepy Library</a>Â to properly connect with the Twitter API. The installation is easy and depends on your preference: <em>pip, manual install</em> etc. From tweepy weâ€™ll import <span><em>Stream</em></span>, <span><em>OAuthHandler</em> </span>and <span><em>StreamListener</em></span>. To setup a connection we have to instantiate an <strong><span>OAuthHandler</span> </strong>with our <span>Consumer Key</span> and <span>Consumer Secret</span> (from the <em>third tab</em> in the application configuration). Then we set the <span>Access Key</span> and <span>Access Token</span> by invoking a certain method from the same <strong><span>OAuthHandler</span> </strong>instance.</p><p><a href="http://blog.brakmic.com/wp-content/uploads/2015/10/connect_to_twitter1.png" class="grouped_elements" rel="tc-fancybox-group101"><img class="alignnone wp-image-111" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://blog.brakmic.com/wp-content/uploads/2015/10/connect_to_twitter1.png" alt="connect_to_twitter" data-srcset="http://blog.brakmic.com/wp-content/uploads/2015/10/connect_to_twitter1-300x89.png 300w, http://blog.brakmic.com/wp-content/uploads/2015/10/connect_to_twitter1.png 732w" sizes="(max-width: 594px) 100vw, 594px"/></a></p><p>Now we need a proper implementation of the <strong><span>StreamListener</span> </strong>from Tweepy. This object must implementÂ <em>a set of methods</em> which will be called by the <strong><span>Stream</span> </strong>instance when new tweets arrive. In this article weâ€™ll implement only two of them: <strong>on_data </strong>and <strong>on_error</strong>. But there are <a href="https://github.com/tweepy/tweepy/blob/master/tweepy/streaming.py" target="_blank">many more available.</a></p><p>And finally our Stream instance will only track tweet-streams which contain certain termsÂ (<em>hash_tags</em>).</p><h4><strong>Implementing a Listener</strong></h4><p>Tweepy Stream class expects an object that implements a certain set of methods. Our Listener implementation defines <strong>on_data</strong> (for new tweets) and <strong>on_error</strong> (when something goes wrong). Additionally, we can persist incoming tweets to a database. This, of course, could have been done separately in some other class or via event handlers but I didnâ€™t want to create an overly complex twitter client. I know, I know, it is way better to <em>separate concernsÂ </em>and creating <a href="https://en.wikipedia.org/wiki/God_object" target="_blank">God objects</a>Â isnâ€™t a very good idea. Feel free to refactor it, or simply laugh at me and let Twitter know how bad Iâ€™m at software engineering.Â  ğŸ˜³</p><p><a href="http://blog.brakmic.com/wp-content/uploads/2015/10/on_data.png" class="grouped_elements" rel="tc-fancybox-group101"><img class="alignnone wp-image-112" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://blog.brakmic.com/wp-content/uploads/2015/10/on_data.png" alt="on_data" data-srcset="http://blog.brakmic.com/wp-content/uploads/2015/10/on_data-300x111.png 300w, http://blog.brakmic.com/wp-content/uploads/2015/10/on_data.png 916w" sizes="(max-width: 697px) 100vw, 697px"/></a></p><p>In <strong>on_data</strong>Â method we load the tweets as JSON strings and extract their <em>text</em> and <em>user data</em>. payloads. SubsequentlyÂ we create a simple transportation object <strong><span>TweetEntry</span></strong><span><span>. Tweets belonging to blocked users are being ignored and neither show upÂ in the console nor get persisted. Saving to a DB is done via checking theÂ <strong>_persist</strong> flag forÂ <strong><span>True</span></strong>.</span></span></p><p><strong>Persisting Tweets</strong></p><p>Here Iâ€™m using <strong>MS SQL</strong> to save my tweets but any other <strong>ODBC</strong>-capable database would do it. Just create a proper DSN entry and let theÂ <a href="https://pypi.python.org/pypi/pyodbc/2.1.9" target="_blank"><span><strong>PyODBC</strong> </span></a>library know about it.</p><p><a href="http://blog.brakmic.com/wp-content/uploads/2015/10/dbconnector.png" class="grouped_elements" rel="tc-fancybox-group101"><img class="alignnone wp-image-113" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://blog.brakmic.com/wp-content/uploads/2015/10/dbconnector.png" alt="dbconnector" data-srcset="http://blog.brakmic.com/wp-content/uploads/2015/10/dbconnector-300x220.png 300w, http://blog.brakmic.com/wp-content/uploads/2015/10/dbconnector.png 953w" sizes="(max-width: 733px) 100vw, 733px"/></a></p><p>The table where the tweets will land contains five fields:<span><em> Id, ScreenName, Message, CreatedAt and Hashtags</em>.</span></p><p>This isÂ the CREATE script for MSSQL:</p><pre><span>CREATE TABLE</span> [dbo].[Tweets](
 [Id] [bigint] <span>IDENTITY</span>(1,1) <span>NOT NULL</span>,
 [ScreenName] [nvarchar](50) <span>NULL</span>,
 [Message] [nvarchar](500) <span>NULL</span>,
 [CreatedAt] [datetime2](7) <span>NULL</span>,
 [Hashtags] [nvarchar](<span>max</span>) <span>NULL</span>,
 <span>CONSTRAINT</span> [PK_Tweets] <span>PRIMARY KEY CLUSTERED</span>
 (
 [Id] <span>ASC</span>
 )<span>WITH</span> (<span>PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON</span>) <span>ON</span> [PRIMARY]
 ) <span>ON</span> [PRIMARY] <span>TEXTIMAGE_ON</span> [PRIMARY]</pre><p>The method <strong><span>insert</span></strong>Â of <strong><span>DbConnector</span> </strong>is used inside the method <strong><span>on_data</span> </strong>in the <strong><span>Listener </span></strong>instance to persist incoming tweets.</p><h4><strong>Colorizing the Output</strong></h4><p>Writing large amounts of data to the console can quickly become a very messy â€œreading experienceâ€. To raise the recognition level for a bit Iâ€™ve used the nice <a href="https://pypi.python.org/pypi/colorama" target="_blank">Colorama </a>library to colorize certain parts of incoming tweets. The result looks like this:</p><p><a href="http://blog.brakmic.com/wp-content/uploads/2015/10/colorful_console1.png" class="grouped_elements" rel="tc-fancybox-group101"><img class="alignnone size-full wp-image-115" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://blog.brakmic.com/wp-content/uploads/2015/10/colorful_console1.png" alt="colorful_console" data-srcset="http://blog.brakmic.com/wp-content/uploads/2015/10/colorful_console1-300x209.png 300w, http://blog.brakmic.com/wp-content/uploads/2015/10/colorful_console1.png 666w" sizes="(max-width: 666px) 100vw, 666px"/></a></p><p>Here Iâ€™m colorizing my preferred hashtags.</p><p>The whole logic is located in a single method <strong>print_colorized</strong>:</p><p><a href="http://blog.brakmic.com/wp-content/uploads/2015/10/colorizing_output.png" class="grouped_elements" rel="tc-fancybox-group101"><img class="alignnone wp-image-116" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="http://blog.brakmic.com/wp-content/uploads/2015/10/colorizing_output.png" alt="colorizing_output" data-srcset="http://blog.brakmic.com/wp-content/uploads/2015/10/colorizing_output-300x68.png 300w, http://blog.brakmic.com/wp-content/uploads/2015/10/colorizing_output.png 967w" sizes="(max-width: 679px) 100vw, 679px"/></a></p><p>Iâ€™m using a simple <a href="https://docs.python.org/2/library/re.html" target="_blank">regex</a>Â to locate the term inside the tweet and set the color commands before and after it. Basically, it works like a simple switch.</p><h4><strong>Configuration via JSON</strong></h4><p>The original version of this client offered a bunch of console parameters but this proved to be too rigid and not very scalable. Therefore I switched to JSON which can now be easily expanded according to any changes in the app. The JSON configuration file comprises of following parts:</p><ul><li>Main <strong><span>config</span> </strong>object</li><li><strong><span>services</span></strong> with <strong><span>db</span> </strong>and <strong><span>twitter</span> </strong>entries</li><li><strong><span>ignore</span> </strong>array</li><li><strong><span>filter</span> </strong>array</li></ul><p>All config settings must be located inside the <strong><span>config</span> </strong>object. The Twitter-API Keys and Tokens are in <strong><span>services.twitter</span></strong><span>. If database is used then its DSN settings must be put in the <span><strong>connectionstring </strong></span>entry.<span> To disable writing to <strong><span>db</span> </strong>just set <span><strong>active</strong> </span>to <strong><span>false</span></strong>. To avoid <em>twitter spam</em>Â put its â€œscreen nameâ€ in the <strong><span>ignore</span> </strong>array. The screen names look like those in the screenshot above. Just copy/paste the spammerâ€™s name to let him jump intoÂ <a href="https://de.wikipedia.org/wiki//dev/null" target="_blank">/dev/null</a>. If you want only to receive tweets containing certain terms then expand the <span>filter</span> array with your preferred entries.</span></span></p><h4><strong>Starting theÂ Client</strong></h4><p>Just type in <strong><span>python twitter_client.py â€“config=YOUR_CONFIG_FILE</span></strong> and soon the tweets willÂ flow into your console.</p><p>Have fun!</p><p><a href="https://github.com/brakmic/TwitterClient" target="_blank">Source code</a></p> </section> </div></body></html>