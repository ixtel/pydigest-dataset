<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-queries-postgresql-simplified" class="anchor" href="#queries-postgresql-simplified" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Queries: PostgreSQL Simplified</h1>
<p><em>Queries</em> is a BSD licensed opinionated wrapper of the <a href="https://pypi.python.org/pypi/psycopg2">psycopg2</a> library for
interacting with PostgreSQL.</p>
<p>The popular <a href="https://pypi.python.org/pypi/psycopg2">psycopg2</a> package is a full-featured python client. Unfortunately
as a developer, you're often repeating the same steps to get started with your
applications that use it. Queries aims to reduce the complexity of psycopg2
while adding additional features to make writing PostgreSQL client applications
both fast and easy. Check out the <a href="#usage">Usage</a> section below to see how easy it can be.</p>
<p>Key features include:</p>
<ul>
<li>Simplified API</li>
<li>Support of Python 2.6+ and 3.3+</li>
<li>PyPy support via <a href="https://pypi.python.org/pypi/psycopg2cffi">psycopg2cffi</a></li>
<li>Asynchronous support for <a href="http://tornadoweb.org">Tornado</a></li>
<li>Connection information provided by URI</li>
<li>Query results delivered as a generator based iterators</li>
<li>Automatically registered data-type support for UUIDs, Unicode and Unicode Arrays</li>
<li>Ability to directly access psycopg2 <code>connection</code> and <code>cursor</code> objects</li>
<li>Internal connection pooling</li>
</ul>
<p><a href="https://pypi.python.org/pypi/queries"><img alt="Version" src="https://camo.githubusercontent.com/346ae3f58cb73c104be30d14803ec6cf5421903f/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f717565726965732e7376673f" data-canonical-src="https://img.shields.io/pypi/v/queries.svg?"/></a> <a href="https://pypi.python.org/pypi/queries"><img alt="Downloads" src="https://camo.githubusercontent.com/981fd72065cb4dd79f5525a9d9c61ebf7443ecd7/68747470733a2f2f696d672e736869656c64732e696f2f707970692f646d2f717565726965732e7376673f" data-canonical-src="https://img.shields.io/pypi/dm/queries.svg?"/></a> <a href="https://travis-ci.org/gmr/queries"><img alt="Status" src="https://camo.githubusercontent.com/b2dcedd615dd9b7cc2386b0708737aae66e11fc7/68747470733a2f2f696d672e736869656c64732e696f2f7472617669732f676d722f717565726965732e7376673f" data-canonical-src="https://img.shields.io/travis/gmr/queries.svg?"/></a> <a href="https://codecov.io/github/gmr/queries?branch=master"><img alt="Coverage" src="https://camo.githubusercontent.com/6789fc2d43fcba5681a6b5b10e0429e17bb5210b/68747470733a2f2f696d672e736869656c64732e696f2f636f6465636f762f632f6769746875622f676d722f717565726965732e7376673f" data-canonical-src="https://img.shields.io/codecov/c/github/gmr/queries.svg?"/></a> <a href="https://codeclimate.com/github/gmr/queries"><img alt="CodeClimate" src="https://camo.githubusercontent.com/1d09f2d27dc28698f93a68604b5d706a1632eeea/68747470733a2f2f696d672e736869656c64732e696f2f636f6465636c696d6174652f6769746875622f676d722f717565726965732e7376673f" data-canonical-src="https://img.shields.io/codeclimate/github/gmr/queries.svg?"/></a> <a href="https://github.com/gmr/queries"><img alt="License" src="https://camo.githubusercontent.com/7ced110cb4127cc87a55b622cae5814d497384fe/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f676d722f717565726965732e7376673f" data-canonical-src="https://img.shields.io/github/license/gmr/queries.svg?"/></a> <a href="https://github.com/gmr/queries"><img alt="PythonVersions" src="https://camo.githubusercontent.com/9cf2481152d5d691533ef3cc79b07a75e9fd2ccf/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f717565726965732e7376673f" data-canonical-src="https://img.shields.io/pypi/pyversions/queries.svg?"/></a></p>
<a name="user-content-documentation"/>
<h2><a id="user-content-documentation" class="anchor" href="#documentation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Documentation</h2>
<p>Documentation is available at <a href="https://queries.readthedocs.org">https://queries.readthedocs.org</a></p>
<a name="user-content-installation"/>
<h2><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h2>
<p>Queries is available via <a href="https://pypi.python.org/pypi/queries">pypi</a> and can be installed with easy_install or pip:</p>

<a name="user-content-usage"/>
<h2><a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage</h2>
<p>Queries provides a session based API for interacting with PostgreSQL.
Simply pass in the <a href="http://www.postgresql.org/docs/9.3/static/libpq-connect.html#LIBPQ-CONNSTRING">URI</a> of the PostgreSQL server to connect to when creating
a session:</p>
<div class="highlight highlight-source-python"><pre>session <span class="pl-k">=</span> queries.Session(<span class="pl-s"><span class="pl-pds">"</span>postgresql://postgres@localhost:5432/postgres<span class="pl-pds">"</span></span>)</pre></div>
<p>Queries built-in connection pooling will re-use connections when possible,
lowering the overhead of connecting and reconnecting.</p>
<p>When specifying a URI, if you omit the username and database name to connect
with, Queries will use the current OS username for both. You can also omit the
URI when connecting to connect to localhost on port 5432 as the current OS user,
connecting to a database named for the current user. For example, if your
username is <code>fred</code> and you omit the URI when issuing <code>queries.query</code> the URI
that is constructed would be <code>postgresql://fred@localhost:5432/fred</code>.</p>
<p>If you'd rather use individual values for the connection, the queries.uri()
method provides a quick and easy way to create a URI to pass into the various
methods.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> queries.uri(<span class="pl-s"><span class="pl-pds">"</span>server-name<span class="pl-pds">"</span></span>, <span class="pl-c1">5432</span>, <span class="pl-s"><span class="pl-pds">"</span>dbname<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>pass<span class="pl-pds">"</span></span>)
<span class="pl-s"><span class="pl-pds">'</span>postgresql://user:pass@server-name:5432/dbname<span class="pl-pds">'</span></span></pre></div>
<a name="user-content-environment-variables"/>
<h3><a id="user-content-environment-variables" class="anchor" href="#environment-variables" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Environment Variables</h3>
<p>Currently Queries uses the following environment variables for tweaking various
configuration values.  The supported ones are:</p>
<ul>
<li><code>QUERIES_MAX_POOL_SIZE</code> - Modify the maximum size of the connection pool (default: 1)</li>
</ul>
<a name="user-content-using-the-queries-session-class"/>
<h3><a id="user-content-using-the-queriessession-class" class="anchor" href="#using-the-queriessession-class" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Using the queries.Session class</h3>
<p>To execute queries or call stored procedures, you start by creating an instance of the
<code>queries.Session</code> class. It can act as a context manager, meaning you can
use it with the <code>with</code> keyword and it will take care of cleaning up after itself. For
more information on the <code>with</code> keyword and context managers, see <a href="http://legacy.python.org/dev/peps/pep-0343/">PEP343</a>.</p>
<p>In addition to both the <code>queries.Session.query</code> and <code>queries.Session.callproc</code>
methods that are similar to the simple API methods, the <code>queries.Session</code> class
provides access to the psycopg2 connection and cursor objects.</p>
<p><strong>Using queries.Session.query</strong></p>
<p>The following example shows how a <code>queries.Session</code> object can be used
as a context manager to query the database table:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> pprint
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> queries
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">with</span> queries.Session() <span class="pl-k">as</span> session:
<span class="pl-c1">...</span>     <span class="pl-k">for</span> row <span class="pl-k">in</span> session.query(<span class="pl-s"><span class="pl-pds">'</span>SELECT * FROM names<span class="pl-pds">'</span></span>):
<span class="pl-c1">...</span>         pprint.pprint(row)
<span class="pl-c1">...</span>
{<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>: <span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-k">u</span><span class="pl-pds">'</span>Jacob<span class="pl-pds">'</span></span>}
{<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>: <span class="pl-c1">2</span>, <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-k">u</span><span class="pl-pds">'</span>Mason<span class="pl-pds">'</span></span>}
{<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>: <span class="pl-c1">3</span>, <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-k">u</span><span class="pl-pds">'</span>Ethan<span class="pl-pds">'</span></span>}</pre></div>
<p><strong>Using queries.Session.callproc</strong></p>
<p>This example uses <code>queries.Session.callproc</code> to execute a stored
procedure and then pretty-prints the single row results as a dictionary:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> pprint
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> queries
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">with</span> queries.Session() <span class="pl-k">as</span> session:
<span class="pl-c1">...</span>   results <span class="pl-k">=</span> session.callproc(<span class="pl-s"><span class="pl-pds">'</span>chr<span class="pl-pds">'</span></span>, [<span class="pl-c1">65</span>])
<span class="pl-c1">...</span>   pprint.pprint(results.as_dict())
<span class="pl-c1">...</span>
{<span class="pl-s"><span class="pl-pds">'</span>chr<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-k">u</span><span class="pl-pds">'</span>A<span class="pl-pds">'</span></span>}</pre></div>
<p><strong>Asynchronous Queries with Tornado</strong></p>
<p>In addition to providing a Pythonic, synchronous client API for PostgreSQL,
Queries provides a very similar asynchronous API for use with Tornado.
The only major difference API difference between <code>queries.TornadoSession</code> and
<code>queries.Session</code> is the <code>TornadoSession.query</code> and <code>TornadoSession.callproc</code>
methods return the entire result set instead of acting as an iterator over
the results. The following example uses <code>TornadoSession.query</code> in an asynchronous
<a href="http://tornadoweb.org">Tornado</a> web application to send a JSON payload with the query result set.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> tornado <span class="pl-k">import</span> gen, ioloop, web
<span class="pl-k">import</span> queries

<span class="pl-k">class</span> <span class="pl-en">MainHandler</span>(<span class="pl-e">web</span>.<span class="pl-e">RequestHandler</span>):

    <span class="pl-k">def</span> <span class="pl-en">initialize</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        <span class="pl-v">self</span>.session <span class="pl-k">=</span> queries.TornadoSession()

    <span class="pl-en">@gen.coroutine</span>
    <span class="pl-k">def</span> <span class="pl-en">get</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        results <span class="pl-k">=</span> <span class="pl-k">yield</span> <span class="pl-v">self</span>.session.query(<span class="pl-s"><span class="pl-pds">'</span>SELECT * FROM names<span class="pl-pds">'</span></span>)
        <span class="pl-v">self</span>.finish({<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>: results.items()})
        results.free()

application <span class="pl-k">=</span> web.Application([
    (<span class="pl-sr"><span class="pl-k">r</span><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, MainHandler),
])

<span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>__main__<span class="pl-pds">"</span></span>:
    application.listen(<span class="pl-c1">8888</span>)
    ioloop.IOLoop.instance().start()</pre></div>
<a name="user-content-inspiration"/>
<h2><a id="user-content-inspiration" class="anchor" href="#inspiration" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Inspiration</h2>
<p>Queries is inspired by <a href="https://github.com/kennethreitz/">Kenneth Reitz's</a> awesome
work on <a href="http://docs.python-requests.org/en/latest/">requests</a>.</p>
<a name="user-content-history"/>
<h2><a id="user-content-history" class="anchor" href="#history" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>History</h2>
<p>Queries is a fork and enhancement of <a href="https://pypi.python.org/pypi/pgsql_wrapper">pgsql_wrapper</a>, which can be found in the
main GitHub repository of Queries as tags prior to version 1.2.0.</p>

</article>
  </div></body></html>