<html><body><div><div class="content html_format"><p>
      Иногда полезно держать несколько версий python на одной машине. Допустим для разработки двух проектов нам необходима вторая и третья ветка python. Или вы поддерживаете проект который использует старую версию python.</p>
<p>
Обычно для этого мы используем виртуальное окружение </p><a href="http://www.virtualenv.org/">virtualenv</a><p> или же обертку для него </p><a href="https://github.com/yyuu/pyenv-virtualenvwrapper">virtualenvwrapper</a><p>. Об этом я рассказывать не буду, так как есть уже много подобных статей, да и в документациях к самим утилитам все очень хорошо объяснено. Достаточно только забить </p><em>virtualenv</em><p> или </p><em>virtualenvwrapper</em><p> в поисковик.</p><p>
Но в дополнение к ним я хочу рассказать в этой статье про менеджер версий python. Кому любопытно прошу под кат.
</p><a name="habracut"/><p>
Чтобы использовать несколько версий python, можно установить их вручную или воспользоваться менеджер версий. Таких есть два: </p><a href="https://github.com/utahta/pythonbrew">pythonbrew</a><p>(который </p><a href="https://github.com/utahta/pythonbrew#deprecated">более не развивается</a><p>) и </p><a href="https://github.com/yyuu/pyenv">pyenv</a><p>. Оба менеджера не поддерживают windows(</p><a href="https://github.com/utahta/pythonbrew/issues/6">pythonbrew</a><p>, </p><a href="https://github.com/yyuu/pyenv/issues/62">pyenv</a><p>) так что питонистам пишущим на этой платформе, придется пока разруливать все руками, либо сделать свою утилиту для смены путей до нужных версий. Кто как справляется с данной ситуацией можете оставлять в комментариях.</p><p>
Так как </p><em>pythonbrew</em><p> более не поддерживается в этой статье он рассмотрен не будет.
</p><p>
P.S. В статье приведены примеры проверенные для </p><a href="http://ru.wikipedia.org/wiki/Ubuntu">OS Ubuntu</a><p> 12.04. При попытке повторить их, делайте поправки относительно своего дистрибутива.

</p><h4>Ручной способ</h4><p>
Для того чтобы работать с несколькими версиями питона, можно установить необходимые версии в указанный префикс. Например чтобы не мудрить с правами, установим дополнительно 2 версии python(2.7.6 и 3.3.2) в директорию пользователю:
</p><strong>2.7.6</strong>
<pre><code class="bash">$ mkdir -p ~/python/src/ &amp;&amp; cd ~/python/src/
$ wget http://www.python.org/ftp/python/2.7.6/Python-2.7.6.tar.xz
$ tar -xf ~/python/src/Python-2.7.6.tar.xz &amp;&amp; cd ./Python-2.7.6
$ ./configure --prefix=$HOME/python/2.7.6/
$ make &amp;&amp; make install
</code></pre><p>
для </p><strong>3.3.2</strong><p> делаем аналогичные операции:
</p><pre><code class="bash">$ wget http://www.python.org/ftp/python/3.3.2/Python-3.3.2.tar.xz ~/python/src/
$ tar -xf ~/python/src/Python-3.3.2.tar.xz &amp;&amp; cd ./Python-3.3.2
$ ./configure --prefix=$HOME/python/3.3.2/
$ make &amp;&amp; make install
</code></pre><p>
Теперь можно создать виртуальное окружение чтобы использовать эти версии:
</p><pre><code class="bash">$ virtualenv -p ~/python/2.7.6/bin/python env &amp;&amp; . ./env/bin/activate
</code></pre><p>
или через virtualenvwrapper:
</p><pre><code class="bash">$ mkvirtualenv -p ~/python/2.7.6/bin/python evnwrapper
</code></pre><p>
Собственно на основании такого способа описана статья по </p><a href="http://habrahabr.ru/post/179831/">созданию мультихостинга</a><p>.</p><p>
Далее если вам необходимо использовать какую-то из этих версий как python по умолчанию, то вам необходимо добавить в переменную окружения путь до интерпретатора python.
</p><pre><code class="bash">$ echo 'export PATH=~/python/2.7.6/bin/' &gt;&gt; ~/.bashrc
</code></pre><p>
Соответственно вместо bashrc вы ставите bash_profile, zshrc, kshrc, profile в зависимости от вашей командной оболочки.
</p><pre><code class="bash">$ . ~/.bashrc
</code></pre><p>
И по необходимости можно </p><a href="http://www.pip-installer.org/en/latest/installing.html">установить pip</a><p>, предварительно установив </p><a href="https://pypi.python.org/pypi/setuptools#installation-instructions">setuptools</a><p>.
</p><pre><code class="bash">$ wget https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py -O - | python
$ wget https://raw.github.com/pypa/pip/master/contrib/get-pip.py -O - | python
</code></pre><p>
 Фух, ну вроде бы все. А теперь о том как можно сделать это проще использую менеджер версий python.

</p><h4>PyEnv</h4><p>
В общем если вы достаточно ленивы, то можно не делать всего того что описано выше а воспользоваться утилитой pyenv, которая упростит вам данное взаимодействие с окружением и путями.
</p><p>
Так в чем же заключается особенность этой утилиты? Вот что она может со слов автора проекта:
</p><ul>
<li>Let you <strong>change the global Python version</strong> on a per-user basis.</li>
<li>Provide support for <strong>per-project Python versions</strong>.</li>
<li>Allow you to <strong>override the Python version</strong> with an environment variable.</li>
<li>Search commands from <strong>multiple versions of Python at a time</strong>. This may be helpful to test across Python versions with <a href="http://pypi.python.org/pypi/tox">tox</a>.</li>
</ul><p>
По умолчанию все версии Python будут доступны в </p><code>~/.pyenv/versions/</code><p>. Изменять версии Python можно как в глобальном контексте так и в локальном(например под конкретный проект).
</p><p>
Как ставить pyenv хорошо описывается в </p><a href="https://github.com/yyuu/pyenv#installation">инструкции</a><p>. Так же у автора есть </p><a href="https://github.com/yyuu/pyenv-installer/blob/master/bin/pyenv-installer">скрипт</a><p> который по мимо самой pyenv ставит еще и дополнительные плагины, в том числе и для </p><a href="https://github.com/yyuu/pyenv-virtualenv">virtualenv</a><p>. Есть возможность установить плагин и для </p><a href="https://github.com/yyuu/pyenv-virtualenvwrapper">virtualenvwrapper</a><p>.
</p><p>
Перед установкой необходимо </p><a href="https://github.com/yyuu/pyenv/wiki/Common-build-problems#requirements">поставить некоторые зависимости</a><p>:
</p><pre><code class="bash"># apt-get install make libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev
</code></pre><p>
Прежде чем начать установку, убедитесь, что у вас установлен git:
</p><pre><code class="bash"># apt-get install git
</code></pre><p>
Далее устанавливаем по </p><a href="https://github.com/yyuu/pyenv#installation">инструкции</a><p>:
</p><pre><code class="bash">$ git clone git://github.com/yyuu/pyenv.git ~/.pyenv
</code></pre><p>
Или так:
</p><pre><code class="bash">$ curl https://raw.github.com/yyuu/pyenv-installer/master/bin/pyenv-installer | bash
</code></pre><p>
Во втором случае установка произойдет с дополнительными плагинами.</p><p>
Далее, для того чтобы все заработало, дополним наш bashrc и перезагрузим оболочку:
</p><pre><code class="bash">$ echo 'export PYENV_ROOT="$HOME/.pyenv"' &gt;&gt; ~/.bashrc
$ echo 'export PATH="$PYENV_ROOT/bin:$PATH"' &gt;&gt; ~/.bashrc
$ echo 'eval "$(pyenv init -)"' &gt;&gt; ~/.bashrc
$ . ~/.bashrc
</code></pre><p>
Для обновления утилиты или смены ее версии используем git.
</p><div class="spoiler"><b class="spoiler_title">Инструкция</b><div class="spoiler_text"><p>Для управления версиями </p><em>pyenv</em><p> необходимо перейти в директорию с утилитой:
</p><pre><code class="bash">$ cd ~/.pyenv
</code></pre><p>
Для просмотра доступных версий:
</p><pre><code class="bash">$ git tag
</code></pre><p>
для смены версии
</p><pre><code class="bash">$ git checkout &lt;version&gt;
</code></pre><p>
для обновления
</p><pre><code class="bash">$ git pull
</code></pre>
</div></div>
<h5>Пример использования</h5>
<pre><code class="bash">~ $ pyenv install 2.7.5
~ $ pyenv install 3.3.2
~ $ pyenv rehash
~ $ pyenv versions
* system
  2.7.5
  3.3.2
~ $ pyenv global 2.7.5
~ $ python --version
Python 2.7.5
~ $ cd projects/
~/projects $ pyenv local 3.3.2
~/projects $ python --version
Python 3.3.2
~/projects $ cd test_prj/
~/projects/test_prj $ python --version
Python 3.3.2
~/projects/test_prj $ cd ..
~/projects $ pyenv local --unset
~/projects $ python --version
Python 2.7.5
</code></pre>
<p>
В добавок ко всему все довольно подробно и детально расписано у автора проекта в его </p><a href="https://github.com/yyuu/">репозиториях на github</a><p>.

</p><h4>Виртуальное окружение</h4><p>
Все, а дальше как хотите. Если вы используете 3 ветку python то для создания виртуального окружения можно воспользоваться утилитой </p><a href="http://docs.python.org/dev/library/venv.html">venv</a><p> которая работает из коробки. Про это есть </p><a href="http://habrahabr.ru/post/157287/">статья</a><p> на хабре. Если вы больше привыкли к </p><a href="http://www.virtualenv.org/en/latest/">virtualenv</a><p> или ее обертке </p><a href="http://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper</a><p> то тут есть два варианта: либо поставить плагин к </p><em>pyenv</em><p>, или использовать их к той версии python c которой вы работаете. Соответственно если выбрать первый вариант, то созданные вами окружения будут добавлены к вашим версиям python и доступны через команду:
</p><pre><code class="bash">$ pyenv versions
</code></pre><p>
Добавить плагин легко, просто клонируем его из репозитория </p><a href="https://github.com/yyuu/pyenv-virtualenv">pyenv-virtualenv</a><p> или </p><a href="https://github.com/yyuu/pyenv-virtualenvwrapper">pyenv-virtualenvwrapper</a><p>:
</p><pre><code class="bash">$ mkdir -p ~/.pyenv/plugins
$ git clone git://github.com/yyuu/pyenv-virtualenv.git ~/.pyenv/plugins/pyenv-virtualenv
$ git clone git://github.com/yyuu/pyenv-virtualenvwrapper.git ~/.pyenv/plugins/pyenv-virtualenvwrapper
</code></pre><p>
Пример использования можно посмотреть в документации для </p><a href="https://github.com/yyuu/pyenv-virtualenv#usage">pyenv-virtualenv</a><p> и </p><a href="https://github.com/yyuu/pyenv-virtualenvwrapper#usage">pyenv-virtualenvwrapper</a><p>.</p><p>
Все, а дальше пользуйтесь, как вам привычнее.

</p><h5>Пример использования</h5>
<pre><code class="bash">$ pyenv versions
* system
  2.7.5
  3.3.2

$ mkdir -p ~/test_project/prj_for_2.7.5 &amp;&amp; cd ~/test_project/prj_for_2.7.5
$ pyenv virtualenv 2.7.5 my-virtualenv-2.7.5
$ pyenv local my-virtualenv-2.7.5
$ pip install django==1.4
$ pip freeze
Django==1.4
wsgiref==0.1.2
$ python --version
Python 2.7.5

$ mkdir -p ~/test_project/test_project &amp;&amp; cd ~/test_project/test_project
$ pyenv virtualenv 3.3.2 my-virtualenv-3.3.2
$ pyenv local my-virtualenv-3.3.2
$ pip install django==1.5
$ pip freeze
Django==1.5
$ python --version
Python 3.3.2
</code></pre><p>
Теперь находясь в директории проекта можно запускать скрипт от нужной версии python не прилагая никаких действий. </p><em>pyenv</em><p> создает в директории файл </p><em>.python-version</em><p> который содержит в себе информацию о том какую версию python с каким окружение использовать для данного проекта.

</p><h4>Полезные ссылки</h4>
<a href="https://github.com/utahta/pythonbrew">github.com/utahta/pythonbrew</a>
<a href="https://github.com/yyuu/pyenv">github.com/yyuu/pyenv</a>
<a href="https://github.com/yyuu/pyenv-installer">github.com/yyuu/pyenv-installer</a>
<a href="https://github.com/yyuu/pyenv-virtualenv">github.com/yyuu/pyenv-virtualenv</a>
<a href="https://github.com/yyuu/pyenv-virtualenvwrapper">github.com/yyuu/pyenv-virtualenvwrapper</a>
<a href="http://docs.python.org/dev/library/venv.html">docs.python.org/dev/library/venv.html</a>
<a href="http://www.virtualenv.org/en/latest/">www.virtualenv.org/en/latest</a>
<a href="http://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper.readthedocs.org/en/latest</a>
      <p class="clear"/>
    </div>

    
  </div></body></html>