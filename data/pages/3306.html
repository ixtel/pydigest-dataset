<html><body><div><section class="post-content">
            <p>Clustering is a powerful way to split up datasets into groups based on similarity.  A very popular clustering algorithm is <a href="http://en.wikipedia.org/wiki/K-means_clustering">k-means</a>.  In k-means clustering, we divide data up into a fixed number of clusters while trying to ensure that the items in each cluster are as similar as possible.</p>

<p>In this post, we’ll explore cluster US Senators using an interactive python environment.  We’ll use the voting history from the <a href="http://en.wikipedia.org/wiki/114th_United_States_Congress">114th Congress</a> to split Senators into clusters.  </p>

<h2 id="loading-in-the-data">Loading in the data</h2>

<p>We have a csv file that contains all the votes from the <em>114th Senate</em>.  You can download the file <a href="https://www.dropbox.com/s/uzkv79ecxccz36h/114_congress.csv?dl=0">here</a>.</p>

<p>Each row contains the votes of an individual senator. Votes are coded as <code>0</code><br/>
for “No”, <code>1</code> for “Yes”, and <code>0.5</code> for “Abstain”.</p>

<p>Here are the first three rows of the data:</p>

<pre><code class="language-python">name,party,state,00001,00004,00005,00006,00007,00008,00009,00010,00020,00026,00032,00038,00039,00044,00047
Alexander,R,TN,0,1,1,1,1,0,0,1,1,1,0,0,0,0,0
Ayotte,R,NH,0,1,1,1,1,0,0,1,0,1,0,1,0,1,0
</code></pre>

<p>We can read the csv file into python using <code>pandas</code>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="c"># Read in the csv file</span>
<span class="n">votes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"114_congress.csv"</span><span class="p">)</span>

<span class="c"># As you can see, there are 100 senators, and they voted on 15 bills (we subtract 3 because the first 3 columns aren't bills).</span>
<span class="k">print</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c"># We have more "Yes" votes than "No" votes overall</span>
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span></code></pre></div>

<pre><code>(100, 18)
1.0    803
0.0    669
0.5     28
dtype: int64
</code></pre>

<h2 id="initial-clustering">Initial clustering</h2>

<p><em>k-means</em> clustering will try to make clusters out of the senators.</p>

<p>Each cluster will contain senators whose votes are as similar to each other as<br/>
possible.</p>

<p>We’ll need to specify the number of clusters we want upfront.</p>

<p>Let’s try <code>2</code> to see how that looks.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="c"># The kmeans algorithm is implemented in the scikits-learn library</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="c"># Create a kmeans model on our data, using 2 clusters.  random_state helps ensure that the algorithm returns the same results each time.</span>
<span class="n">kmeans_model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:])</span>

<span class="c"># These are our fitted labels for clusters -- the first cluster has label 0, and the second has label 1.</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans_model</span><span class="o">.</span><span class="n">labels_</span>

<span class="c"># The clustering looks pretty good!</span>
<span class="c"># It's separated everyone into parties just based on voting history</span>
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">votes</span><span class="p">[</span><span class="s">"party"</span><span class="p">]))</span></code></pre></div>

<pre><code>party   D  I   R
row_0           
0      41  2   0
1       3  0  54
</code></pre>

<h2 id="exploring-people-in-the-wrong-cluster">Exploring people in the wrong cluster</h2>

<p>We can now find out which senators are in the “wrong” cluster.</p>

<p>These senators are in the cluster associated with the opposite party.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Let's call these types of voters "oddballs" (why not?)</span>
<span class="c"># There aren't any republican oddballs</span>
<span class="n">democratic_oddballs</span> <span class="o">=</span> <span class="n">votes</span><span class="p">[(</span><span class="n">votes</span><span class="p">[</span><span class="s">"label"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">votes</span><span class="p">[</span><span class="s">"party"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"D"</span><span class="p">)]</span>

<span class="c"># It looks like Reid has abstained a lot, which changed his cluster.</span>
<span class="c"># Manchin seems like a genuine oddball voter.</span>
<span class="k">print</span><span class="p">(</span><span class="n">democratic_oddballs</span><span class="p">[</span><span class="s">"name"</span><span class="p">])</span></code></pre></div>

<pre><code>42    Heitkamp
56     Manchin
74        Reid
Name: name, dtype: object
</code></pre>

<h2 id="plotting-out-the-clusters">Plotting out the clusters</h2>

<p>Let’s explore our clusters a little more by plotting them out.</p>

<p>Each column of data is a dimension on a plot, and we can’t visualize 15<br/>
dimensions.</p>

<p>We’ll use <em>principal component analysis</em> to compress the vote columns into<br/>
two.</p>

<p>Then, we can plot out all of our senators according to their votes, and shade<br/>
them by their cluster.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="n">pca_2</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c"># Turn the vote data into two columns with PCA</span>
<span class="n">plot_columns</span> <span class="o">=</span> <span class="n">pca_2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">3</span><span class="p">:</span><span class="mi">18</span><span class="p">])</span>

<span class="c"># Plot senators based on the two dimensions, and shade by cluster label</span>
<span class="c"># You can see the plot by clicking "plots" to the bottom right</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">plot_columns</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">plot_columns</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">votes</span><span class="p">[</span><span class="s">"label"</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>

<p><img src="/blog/images/Mission26_8_0.png" alt="png"/></p>

<h2 id="trying-even-more-clusters">Trying even more clusters</h2>

<p>While two clusters is interesting, it didn’t tell us anything we don’t already<br/>
know.</p>

<p>More clusters could show wings of each party, or cross-party groups.</p>

<p>Let’s try using 5 clusters to see what happens.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="n">kmeans_model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">votes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans_model</span><span class="o">.</span><span class="n">labels_</span>

<span class="c"># The republicans are still pretty solid, but it looks like there are two democratic "factions"</span>
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">votes</span><span class="p">[</span><span class="s">"party"</span><span class="p">]))</span></code></pre></div>

<pre><code>party   D  I   R
row_0           
0       6  0   0
1       0  0  52
2      31  1   0
3       0  0   2
4       7  1   0
</code></pre>

        </section>

        </div></body></html>