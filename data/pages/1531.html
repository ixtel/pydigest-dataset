<html><body><div><div class="page">
                        
<h1 class="title article">Getting started with Graphviz and Python</h1>
<p><br/></p>
<h3>About the <code>graphviz</code> module</h3>
<p>There are several Python modules for dealing with Graphviz. The most popular one seems to be <code>pygraphviz</code>. Unfortunately it isn't available for Python 3. So we will use the <code>graphviz</code> module instead.</p>
<p>Installation is simple:</p>



<h3>Hello Graphviz</h3>
<p>First we need to import the graphviz module:</p>



<p>Now we can create the graph object <code>g1</code> and add two nodes <code>A</code> and <code>B</code> as well as an edge to connect the two.</p>
<div class="codehilite"><pre><span class="n">g1</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">'svg'</span><span class="p">)</span>
<span class="n">g1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s">'A'</span><span class="p">)</span>
<span class="n">g1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s">'B'</span><span class="p">)</span>
<span class="n">g1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">)</span>
</pre></div>


<p>Let's have a look at the the <code>dot</code> code that this will generate behind the scenes:</p>





<p>That looks about right. Now it's time to save the graph to disk:</p>
<div class="codehilite"><pre><span class="n">filename</span> <span class="o">=</span> <span class="n">g1</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">'img/g1'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">filename</span>
</pre></div>




<p>As you can see, the graphviz module takes care of appending the correct file extension.</p>
<p>Let's have a look at the result:</p>
<p><img alt="svg" src="/assets/img/articles/graphviz/g1.svg"/></p>
<h3>Directed Graphs</h3>
<p>To create a directed version of the previous graph we only need to replace the <code>Graph</code> object with a <code>Digraph</code>.</p>
<div class="codehilite"><pre><span class="n">g2</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">Digraph</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">'svg'</span><span class="p">)</span>
<span class="n">g2</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s">'A'</span><span class="p">)</span>
<span class="n">g2</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s">'B'</span><span class="p">)</span>
<span class="n">g2</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">)</span>
<span class="n">g2</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">'img/g2'</span><span class="p">)</span>
</pre></div>


<p><img alt="svg" src="/assets/img/articles/graphviz/g2.svg"/></p>
<h3>A more concise approach</h3>
<p>The above approach is fine for small graphs but for larger ones we should create a few helper functions.
Since we will stick to SVG as our output format there is no need to explicity specifiy it for every graph.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">functools</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">gv</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">'svg'</span><span class="p">)</span>
<span class="n">digraph</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">gv</span><span class="o">.</span><span class="n">Digraph</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">'svg'</span><span class="p">)</span>
</pre></div>


<p>Now creating a new graph is as easy as calling <code>graph()</code></p>



<p>Next, we would like to specify the nodes and edges as simple data structures instead typing loads of method calls.</p>
<div class="codehilite"><pre><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">,</span> <span class="p">(</span><span class="s">'C'</span><span class="p">,</span> <span class="p">{})]</span>
</pre></div>


<p>Every node is represented by either a string or a tuple. In the latter case the second element of the tuple holds all attributes of that node as we will see later.
The represenation of edges is quite similar:</p>
<div class="codehilite"><pre><span class="n">edges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">),</span>
    <span class="p">((</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">),</span> <span class="p">{}),</span>
<span class="p">]</span>
</pre></div>


<p>To actually create nodes and edges from these data structures we implement the functions <code>add_nodes</code> and <code>add_edges</code>. Note that both functions return the updated graph which will come in handy in just a second.</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span>

<span class="k">def</span> <span class="nf">add_edges</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span>
</pre></div>


<p>Now we can create graphs in a much more concise way:</p>
<div class="codehilite"><pre><span class="n">add_edges</span><span class="p">(</span>
    <span class="n">add_nodes</span><span class="p">(</span><span class="n">digraph</span><span class="p">(),</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">]),</span>
    <span class="p">[(</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">),</span> <span class="p">(</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">),</span> <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">'img/g4'</span><span class="p">)</span>
</pre></div>


<p><img alt="svg" src="/assets/img/articles/graphviz/g4.svg"/></p>
<h3>Labels</h3>
<p>Labeling nodes and edges is as easy as adding an entry to their dictionaries of attributes.</p>
<div class="codehilite"><pre><span class="n">add_edges</span><span class="p">(</span>
    <span class="n">add_nodes</span><span class="p">(</span><span class="n">digraph</span><span class="p">(),</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node A'</span><span class="p">}),</span>
        <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node B'</span><span class="p">}),</span>
        <span class="s">'C'</span>
    <span class="p">]),</span>
    <span class="p">[</span>
        <span class="p">((</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 1'</span><span class="p">}),</span>
        <span class="p">((</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 2'</span><span class="p">}),</span>
        <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">'img/g5'</span><span class="p">)</span>
</pre></div>


<p><img alt="svg" src="/assets/img/articles/graphviz/g5.svg"/></p>
<h3>Styling</h3>
<p>Graphviz let's you style graphs extensively by setting specific attributes. The following example will showcase a few of these attributes. </p>
<p>For a complete list of attributes please refer to <a href="http://www.graphviz.org/doc/info/attrs.html">http://www.graphviz.org/doc/info/attrs.html</a>.</p>
<p>First, let's create an unstyled graph:</p>
<div class="codehilite"><pre><span class="n">g6</span> <span class="o">=</span> <span class="n">add_edges</span><span class="p">(</span>
    <span class="n">add_nodes</span><span class="p">(</span><span class="n">digraph</span><span class="p">(),</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node A'</span><span class="p">}),</span>
        <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node B'</span><span class="p">}),</span>
        <span class="s">'C'</span>
    <span class="p">]),</span>
    <span class="p">[</span>
        <span class="p">((</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 1'</span><span class="p">}),</span>
        <span class="p">((</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 2'</span><span class="p">}),</span>
        <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>


<p>We will use a simple dictionary to specifiy the attributes that we want to change:</p>
<div class="codehilite"><pre><span class="n">styles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'graph'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'label'</span><span class="p">:</span> <span class="s">'A Fancy Graph'</span><span class="p">,</span>
        <span class="s">'fontsize'</span><span class="p">:</span> <span class="s">'16'</span><span class="p">,</span>
        <span class="s">'fontcolor'</span><span class="p">:</span> <span class="s">'white'</span><span class="p">,</span>
        <span class="s">'bgcolor'</span><span class="p">:</span> <span class="s">'#333333'</span><span class="p">,</span>
        <span class="s">'rankdir'</span><span class="p">:</span> <span class="s">'BT'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s">'nodes'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'fontname'</span><span class="p">:</span> <span class="s">'Helvetica'</span><span class="p">,</span>
        <span class="s">'shape'</span><span class="p">:</span> <span class="s">'hexagon'</span><span class="p">,</span>
        <span class="s">'fontcolor'</span><span class="p">:</span> <span class="s">'white'</span><span class="p">,</span>
        <span class="s">'color'</span><span class="p">:</span> <span class="s">'white'</span><span class="p">,</span>
        <span class="s">'style'</span><span class="p">:</span> <span class="s">'filled'</span><span class="p">,</span>
        <span class="s">'fillcolor'</span><span class="p">:</span> <span class="s">'#006699'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s">'edges'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'style'</span><span class="p">:</span> <span class="s">'dashed'</span><span class="p">,</span>
        <span class="s">'color'</span><span class="p">:</span> <span class="s">'white'</span><span class="p">,</span>
        <span class="s">'arrowhead'</span><span class="p">:</span> <span class="s">'open'</span><span class="p">,</span>
        <span class="s">'fontname'</span><span class="p">:</span> <span class="s">'Courier'</span><span class="p">,</span>
        <span class="s">'fontsize'</span><span class="p">:</span> <span class="s">'12'</span><span class="p">,</span>
        <span class="s">'fontcolor'</span><span class="p">:</span> <span class="s">'white'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Now we need another helper function <code>apply_styles</code> to actually apply those attributes to the graph:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">apply_styles</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">styles</span><span class="p">):</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">graph_attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">(</span><span class="s">'graph'</span> <span class="ow">in</span> <span class="n">styles</span> <span class="ow">and</span> <span class="n">styles</span><span class="p">[</span><span class="s">'graph'</span><span class="p">])</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">node_attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">(</span><span class="s">'nodes'</span> <span class="ow">in</span> <span class="n">styles</span> <span class="ow">and</span> <span class="n">styles</span><span class="p">[</span><span class="s">'nodes'</span><span class="p">])</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">edge_attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">(</span><span class="s">'edges'</span> <span class="ow">in</span> <span class="n">styles</span> <span class="ow">and</span> <span class="n">styles</span><span class="p">[</span><span class="s">'edges'</span><span class="p">])</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span>
</pre></div>


<p>Let's try it out!</p>
<div class="codehilite"><pre><span class="n">g6</span> <span class="o">=</span> <span class="n">apply_styles</span><span class="p">(</span><span class="n">g6</span><span class="p">,</span> <span class="n">styles</span><span class="p">)</span>
<span class="n">g6</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">'img/g6'</span><span class="p">)</span>
</pre></div>


<p><img alt="svg" src="/assets/img/articles/graphviz/g6.svg"/></p>
<h3>Subgraphs</h3>
<p>Lastly, we will have a look a subgraphs. First, let's create two seperate graphs <code>g7</code> and <code>g8</code>, each with their own styling.</p>
<div class="codehilite"><pre><span class="n">g7</span> <span class="o">=</span> <span class="n">add_edges</span><span class="p">(</span>
    <span class="n">add_nodes</span><span class="p">(</span><span class="n">digraph</span><span class="p">(),</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node A'</span><span class="p">}),</span>
        <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node B'</span><span class="p">}),</span>
        <span class="s">'C'</span>
    <span class="p">]),</span>
    <span class="p">[</span>
        <span class="p">((</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 1'</span><span class="p">}),</span>
        <span class="p">((</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 2'</span><span class="p">}),</span>
        <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">g8</span> <span class="o">=</span> <span class="n">apply_styles</span><span class="p">(</span>
    <span class="n">add_edges</span><span class="p">(</span>
        <span class="n">add_nodes</span><span class="p">(</span><span class="n">digraph</span><span class="p">(),</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">'D'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node D'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">'E'</span><span class="p">,</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Node E'</span><span class="p">}),</span>
            <span class="s">'F'</span>
        <span class="p">]),</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="s">'D'</span><span class="p">,</span> <span class="s">'E'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 3'</span><span class="p">}),</span>
            <span class="p">((</span><span class="s">'D'</span><span class="p">,</span> <span class="s">'F'</span><span class="p">),</span> <span class="p">{</span><span class="s">'label'</span><span class="p">:</span> <span class="s">'Edge 4'</span><span class="p">}),</span>
            <span class="p">(</span><span class="s">'E'</span><span class="p">,</span> <span class="s">'F'</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">),</span>
    <span class="p">{</span>
        <span class="s">'nodes'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'shape'</span><span class="p">:</span> <span class="s">'square'</span><span class="p">,</span>
            <span class="s">'style'</span><span class="p">:</span> <span class="s">'filled'</span><span class="p">,</span>
            <span class="s">'fillcolor'</span><span class="p">:</span> <span class="s">'#cccccc'</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<p>Now we combine the two graphs by making <code>g8</code> a subgraph of <code>g7</code> and adding an extra edge to connect the two:</p>
<div class="codehilite"><pre><span class="n">g7</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">g8</span><span class="p">)</span>
<span class="n">g7</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'E'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">'2'</span><span class="p">)</span>
</pre></div>


<p>Let's have a look at the result:</p>



<p><img alt="svg" src="/assets/img/articles/graphviz/g7.svg"/></p>
<h3>What's next?</h3>


                <footer class="article">
					© 2014 by <a href="/">matthiaseisen.com</a>
				</footer>
            </div>
        </div></body></html>