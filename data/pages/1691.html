<html><body><div><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a012a72a7336638458-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">shutil</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">re</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-4"><span class="crayon-c">#Define variables</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-5"><span class="crayon-v">bind_conf_path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"/etc/bind/"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-6"><span class="crayon-v">named_src_slave</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">bind_conf_path</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-s">"named.conf"</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-7"><span class="crayon-v">named_bkp_slave</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">bind_conf_path</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-s">"named.conf-secondary"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-8"><span class="crayon-v">named_dst_mastr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">bind_conf_path</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-s">"named.conf-master"</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-10"><span class="crayon-k ">shutil</span><span class="crayon-sy">.</span><span class="crayon-e">copyfile</span><span class="crayon-sy">(</span><span class="crayon-v">named_src_slave</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">named_bkp_slave</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-12"><span class="crayon-c">#Regex to get the lines containing the master ip address for the zone</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-13"><span class="crayon-v">regexp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'masters { \d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}; };'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-14"> </p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-15"><span class="crayon-v">outfile</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-v">named_dst_mastr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'w'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-16"> </p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-17"><span class="crayon-c">#Create a new named.conf with master zone instead of slave zone</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-18"><span class="crayon-st">with</span><span class="crayon-h"> </span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-v">named_bkp_slave</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-19"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-20"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"type slave;"</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-21"><span class="crayon-h">                </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"\ttype master;\n"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-22"><span class="crayon-h">        </span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">regexp</span><span class="crayon-sy">.</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-23"><span class="crayon-h">                </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-24"><span class="crayon-h">        </span><span class="crayon-v">outfile</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-25"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-26"><span class="crayon-v">outfile</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-27"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-28"><span class="crayon-c">#Replace the named.conf with the new one that contains the dns zone configured as master</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-29"><span class="crayon-k ">shutil</span><span class="crayon-sy">.</span><span class="crayon-e">copyfile</span><span class="crayon-sy">(</span><span class="crayon-v">named_dst_mastr</span><span class="crayon-sy">,</span><span class="crayon-v">named_src_slave</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-30"> </p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-31"><span class="crayon-c">#Reload Bind zone file</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a012a72a7336638458-32"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">subprocess</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">call</span></p><p class="crayon-line" id="crayon-56d5a012a72a7336638458-33"><span class="crayon-e">call</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">"rndc"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"reload"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p></div></div></body></html>