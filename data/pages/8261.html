<html><body><div><p>Library for using callbacks to resume your code.</p>








<p>A Python library for using callbacks to resume your code.</p>
<div id="usage">
<h2>Usage</h2>
<p><tt>resumeback.send_self</tt>’s mechanic of sending a generator function
a handle to itself
is what allows for better flow control
using callback-based interfaces.
Essentially, it enables <em>a single line of execution</em>.</p>
<p>Following is a function that uses an asynchronous callback mechanism
to signal that user input has been made:</p>
<pre><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>

<span class="k">def</span> <span class="nf">ask_for_user_input</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">on_done</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">watcher</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
        <span class="n">on_done</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">watcher</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre>
<p>The <em>traditional</em> way of using a function like <tt>ask_for_user_input</tt> would be
to define a function of some way,
either as a closure or using <tt>functools.partial</tt> so that we can preserve
the state we already accumulated prior to executing said function.</p>
<p>For example like so:</p>
<pre><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">arbitrary_value</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">on_done</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Result:"</span><span class="p">,</span> <span class="n">number</span> <span class="o">*</span> <span class="n">arbitrary_value</span><span class="p">)</span>

    <span class="n">ask_for_user_input</span><span class="p">(</span><span class="s2">"Please enter a number"</span><span class="p">,</span> <span class="n">on_done</span><span class="p">)</span>
</pre>
<p>Because Python does not have multi-line inline functions,
this is rather awkward,
because we are jumping from the function call of <tt>ask_for_user_input</tt>
back to our previously defined function <tt>on_done</tt>
– which is only ever going to be called once in this context.</p>
<p>However, using <tt>resumeback.send_self</tt>,
we can do something to <em>flatten our line of execution</em>
by passing a callback to resume execution in our original function:</p>
<pre><span class="kn">from</span> <span class="nn">resumeback</span> <span class="kn">import</span> <span class="n">send_self</span>

<span class="nd">@send_self</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">this</span> <span class="o">=</span> <span class="k">yield</span>  <span class="c1"># "this" is now a reference to the just-created generator</span>
    <span class="n">arbitrary_value</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># Yield pauses execution until one of the generator methods is called,</span>
    <span class="c1"># such as `.send`, which we provide as the callback parameter.</span>
    <span class="n">number</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">ask_for_user_input</span><span class="p">(</span><span class="s2">"Please enter a number"</span><span class="p">,</span> <span class="n">this</span><span class="o">.</span><span class="n">send</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Result:"</span><span class="p">,</span> <span class="n">number</span> <span class="o">*</span> <span class="n">arbitrary_value</span><span class="p">)</span>
</pre>
</div>
</div></body></html>