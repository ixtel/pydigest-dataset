<html><body><div><section class="article-body" id="article-body">
				<div typeof="schema:BlogPosting"><p>Poblar una base de datos de manera automática es algo necesario en el desarrollo de cualquier webApp. Nos ahorra tiempo de trabajo y nos permite generar de manera casi inmediata muchos elementos para procesar en nuestras aplicaciones.</p>
<p>Desde que descubrí <a href="http://flask-script.readthedocs.org/en/latest/" target="_blank">Flask-Script</a> se ha convertido en una herramienta indispensable para mis proyectos de <a href="http://flask.pocoo.org/" target="_blank">Flask</a>.</p>
<p>Les voy a mostrar como lo integro con <a href="http://mixer.readthedocs.org/en/latest/" target="_blank">Mixer</a> para poblar una base de datos de manera eficiente desde la línea de comandos.</p>
<p>Si no conocer Mixer, es una librería que se basa en <a href="http://fake-factory.readthedocs.org/en/v0.4/" target="_blank">Faker</a> para producir data de manera aleatoria, pero lleva su capacidad bastante más allá. Mixer toma el <strong>modelo</strong> creado  con un <strong>ORM</strong> y genera data para todos sus campos <strong>requeridos </strong>según el tipo de campo definido.</p>
<p>Esto significa que si tenemos un campo <strong>name, </strong>Mixer automáticamente lo reconoce como tal y generará un <strong>Nombre</strong>, no un string aleatorio.</p>
<p><strong>Mixer</strong> reconoce los siguientes sistemas de modelado:</p>
<ul>
<li>Django ORM</li>
<li>SQLAlchemy</li>
<li>Flask-SQLAlchemy</li>
<li>Mongoengine</li>
<li>PonyORM</li>
<li>PeeWee</li>
<li>Custom Schemas</li>
</ul>
<p>Casi todos los <strong>ORM </strong>de Python y además Mongoengine! Además es muy sencillo implementarlo.</p>
<h3>1. Utilizando Mixer desde Flask-Script</h3>
<p>Generaremos una opción de <strong>Flask-Script</strong> que nos permita generar la cantidad de objetos que queramos para el modelo que elijamos.<br/>
En este ejemplo utilizaré <a href="http://mongoengine.org/" target="_blank">Mongoengine</a> como mi ORM.</p>
<p>El archivo final se encuentra en un <a href="https://gist.github.com/ondoheer/954fbdd38157c0687133" target="_blank">Gist</a>.</p>
<p>Lo primero es crear nuestro archivo <strong>manager.py</strong> en la raíz de nuestro proyecto.</p>
<p>agregamos los contenidos estándar de inicialización de Flask-Script:</p>
<pre><code class="language-python">


# coding: utf-8
 
# Native Libraries
from __future__ import print_function
import os
 
# Flask imports
from flask.ext.script import Manager
 
# Project imports
from app import app
 
 
manager = Manager(app)
@manager.shell
def make_shell_context():
return dict(app=app)
 
 
if __name__ == '__main__':
manager.run()

</code></pre>
<p>Una vez hecho esto importamos nuestros modelos y <b>Mixer</b></p>
<pre><code class="language-python">
# Project imports
from app.models import User, Band, Event
from app import app
 
# Mixer data faker
from mixer.backend.mongoengine import mixer
</code></pre>
<p/>
<h3>2. Agregando populate a las opciones de la línea de comandos</h3>
<p/>
<pre><code class="language-python">

@manager.option('-m', '--model', default='User') # Elegimos un modelo como default 
@manager.option('-n', '--number', default='1') # El número de elementos que debe crear el comando
def populate(number, model):
    """
    Populates n number of events, they must be passed as 
    unix shell arguments. It defaults to 1.
    """
    # Creamos un diccionario con los modelos que queremos utilizar
    models = {
        "User": User,
        "Event": Event,
        "Band": Band
 
    }
    try:
        for item in xrange(int(number)):
            item = mixer.blend(models[model])
            item.save()
            print("{} created with property: {}".format(model, item.name))
    except KeyError:
        raise KeyError("The defined model doesn't exist or hasnt been imported to this file")

</code></pre>
<p>Y ya está!<br/>
Esto nos permite ahora ir a nuestra línea de comandos y poblar nuestra base de datos de la siguiente manera:</p>
<pre><code class="language-bash">

python manager.py populate -n 10 -m User
User Created
User Created
User Created
User Created
User Created
User Created
User Created
User Created
User Created
User Created

</code></pre>
<h4>el resultado</h4>
<p>Si se dirigen a su administrados de base de datos o a su aplicación, verán que 10 nuevos usuarios han sido creados cumpliendo los requisitos que el modelo había definido.</p>
<p>Esto es solo el principio de lo que se puede realizar combinando estas dos librerías!</p>
<p> </p>
</div>			</section>
			</div></body></html>