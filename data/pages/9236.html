<html><body><div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        <p>
 I take the bus everyday.  It's terrific.  There's nothing better than
getting a full sixty minutes everyday to close your eyes, drink coffee,
and get lost in a podcast before work.
</p>
<p>
 I wish I could say that
 <em>
  purchasing
 </em>
 bus passes from Madison's website
was just as relaxing.  Because my wife picks me up from work in the
afternoon, it is most cost effective for me to buy a new Adult 10 Ride
voucher every two weeks.  Every two weeks, I have to dig through
their crusty  website to find their purchase form.  All in all, there
are about six pages across two different domains - each loaded with
their own set of over-crowded menus and repetitive forms.
</p>
<p>
 I am sure I was using the site wrong.  At one point I tried to make a
persistent account.  I bailed half way through, fearing I was
 <em>
  actually
 </em>
 about to sign up for a miracle pill or a magazine
subscription.
</p>
<h1>
 The Year of Automation
</h1>
<p>
 There had to be another way!  Sure, perhaps the old 2015 Alex would
have just endured this bi-weekly punishment.  But this is 2016, damnit.
Even typing those numbers in this blog post makes me feel like I am
living in a science fiction novel.
</p>
<p>
 This year, I decided
 <em>
  not
 </em>
 to put up with this chore.  I decided to adapt,
survive, and make a
 <em>
  Selenium script
 </em>
 that would traverse this
awful website for me.
</p>
<h1>
 Selenium
</h1>
<p>
 Selenium is a terrific little service that allows you to
programatically navigate web pages.  It is a great choice for
integration testing and end-to-end testing when you need more granular control
over your browser.
</p>
<p>
 Selenium is available in most languages.  I went with the
 <a href="http://selenium-python.readthedocs.org/">
  python wrapper
 </a>
 .
</p>
<p>
 As a warning, this is essentially a web-scraper.  Scripts that
programatically navigate websites work best with plainly-named ID tags
and simple, native HTML widgets.  The fewer bells and whistles, the
better.  This makes a municipal website like
 <a href="http://www.cityofmadison.com">
  www.cityofmadison.com
 </a>
 a great
candidate for Selenium automation.
</p>
<h1>
 Building
 <code>
  busbot
 </code>
</h1>
<p>
 Let's walk through
 <code>
  busbot
 </code>
 .  Here is the basic skeleton of the
script.
</p>
<p>
 
</p>
<p>
 Running this script (after installing the
 <code>
  selenium
 </code>
 pip package) will
open Firefox to the Google homepage.
</p>
<p>
 Instead of the Google homepage, let's go to the first page of the
ordering process -
 <a href="https://www.cityofmadison.com/epayment/metro/busPass/index.cfm">
  this url
 </a>
 .
Here we see our first obstacle - the dreaded "Terms and Conditions".
</p>
<p>
 <figure class="image">
  <img alt="To their credit, this is much better than the iTunes one" src="http://i.imgur.com/PN2pW6U.png"/>
  <figcaption>
   To their credit, this is much better than the iTunes one
  </figcaption>
 </figure>
</p>
<p>
 This is easy enough with Selenium.  We can select the
element by ID, click it, then do the same with the "confirm" button.
</p>

<p>
 Works like a charm.  The program passes the confirmation and follows a
redirection to the next page.
</p>
<p>
 <figure class="image">
  <img alt="" src="http://i.imgur.com/PoWlFd9.png"/>
  <figcaption>
  </figcaption>
 </figure>
</p>
<p>
 Now we need to enter the quantity of tickets.  We can grab the "Adult
10-Ride" quantity input by its unique ID and send text input.
</p>

<p>
 Further down on the page, we find our first contact information form.
</p>
<p>
 <figure class="image">
  <img alt="" src="http://i.imgur.com/waynzCG.png"/>
  <figcaption>
  </figcaption>
 </figure>
</p>
<p>
 These fields are missing ID's.  Do we slink away in defeat?  Of course
not.  Selenium's API has ample methods for retrieving elements from
the DOM.  As it happens, each input has a unique
 <code>
  name
 </code>
 attribute.
</p>
<p>
 We simply need to retrieve each input by its
 <code>
  name
 </code>
 attribute and
send it text, just as we did before.  But the iterative nature of this
form gives us a chance to be fancy.  I chose to put each value in a
name/value
 <code>
  dict
 </code>
 and iterate over each pair.
</p>
<p>
 
</p>
<p>
 What about "State"?  This isn't a text field on the page, so sending
input via the keyboard will not get it to select "WI".  We need to
treat the dropdown differently.  We can select the element, then
search for child elements by tag name, which we expect to be
 <code>
  option
 </code>
 elements.  Selenium will return a list, allowing us to iteratively
inspect and click a qualifying option.
</p>
<p>
 We can now add "State" to the dict and add a small special case to
handle this.
</p>
<p>
 
</p>
<p>
 Next, we tick the "Shipping information same as Contact Information"
option and submit the form.
</p>
<p>
 
</p>
<p>
 The rest of the code is rinse and repeat.  I've
 <a href="https://github.com/arecker/busbot">
  cleaned up the project
 </a>
 and
modified it to read personal data out of a YAML file before
execution - just in any fellow public transit warriors want to use it
themselves.
</p>
<h1>
 Look, Mah - No Hands
</h1>
<p>
 Here is a demo of the whole run through using fake data.  The last
page throws a payment validation error.  Call me a miser, but I
didn't feel like giving away my
 <em>
  real
 </em>
 credit card number just for the
sake of a demo.
</p>
<video autoplay="" class="share-video" id="share-video" loop="" muted="" poster="https://thumbs.gfycat.com/ImpossibleIncredibleAnchovy-poster.jpg">
 <source id="webmSource" src="https://zippy.gfycat.com/ImpossibleIncredibleAnchovy.webm" type="video/webm">
  <source id="mp4Source" src="https://zippy.gfycat.com/ImpossibleIncredibleAnchovy.mp4" type="video/mp4">
   Sorry, your browser doesn't support HTML5 video.
  </source>
 </source>
</video>
<h1>
 Taking it Further
</h1>
<p>
 Looking
 <a href="http://selenium-python.readthedocs.org/">
  Selenium's python API
 </a>
 , it's
not hard to imagine how to take this further.
</p>
<ul>
 <li>
  Validating payment information before submit with
  <code>
   assert
  </code>
  and exceptions
 </li>
 <li>
  Custom configs to purchase with different options (card or check)
 </li>
 <li>
  Hooking into
  <code>
   crontab
  </code>
  for a truly automated experience
 </li>
</ul>
<p>
 Next time you find yourself wrestling with a website that should have
died decades ago, consider putting Selenium to work and getting on the
automation bus.
</p>
        
      </div>
    </div></body></html>