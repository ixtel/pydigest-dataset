<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor.jpg"><img class="aligncenter wp-image-2028" src="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor.jpg" alt="Capturing mouse click events with Python and OpenCV" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor-300x131.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor.jpg 759w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Being raised on the east coast of the United States I guess I should be used to the snow by now — but I’m not. As a kid, I loved the snow. I loved sledding, snowboarding, and snowball fights.</p>
<p>But now, as an adult, snow just means an inconvenience. It means travel is going to be terrible. It means not being able to drive to the gym. And it means being stuck in the apartment.</p>
<p>That said, I’m taking this snow day on the east coast and writing a blog post on capturing mouse click events with Python and OpenCV.</p>
<p><iframe src="http://www.youtube.com/embed/OzxT3tsp1pI?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p>In this example we’ll click and drag a rectangular Region of Interest (ROI) and crop it from our image. This technique is especially helpful if you are labeling data as <a title="Histogram of Oriented Gradients and Object Detection" href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">input to an image classification algorithm</a>.</p>
<p>So if you’re trying to understand how mouse click events work with Python and OpenCV, then look no further! This blog post will show you exactly that!</p>

<p><strong>OpenCV and Python versions:</strong><br/>
In order to run this example, you’ll need <strong>Python 2.7</strong> and <strong>OpenCV 2.4.X</strong>.</p>
<h1>Capturing mouse click events with Python and OpenCV</h1>
<p>Let’s go ahead and get this example started. Open up a new file, name it 
			<span id="crayon-56d59e07ce392220523814" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">click_and_crop</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and we’ll get to work:</p>

		<div id="crayon-56d59e07ce39d574286191" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-2">2</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-4">4</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-6">6</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-8">8</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-10">10</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-12">12</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-14">14</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-16">16</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-18">18</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-20">20</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-22">22</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-24">24</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-26">26</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-28">28</p><p class="crayon-num" data-line="crayon-56d59e07ce39d574286191-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce39d574286191-30">30</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e07ce39d574286191-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-4"> </p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-5"><span class="crayon-c"># initialize the list of reference points and boolean indicating</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-6"><span class="crayon-c"># whether cropping is being performed or not</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-7"><span class="crayon-v">refPt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-8"><span class="crayon-v">cropping</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">False</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-10"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">click_and_crop</span><span class="crayon-sy">(</span><span class="crayon-v">event</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">param</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-11"><span class="crayon-h">	</span><span class="crayon-c"># grab references to the global variables</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-12"><span class="crayon-h">	</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">refPt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cropping</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-14"><span class="crayon-h">	</span><span class="crayon-c"># if the left mouse button was clicked, record the starting</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-15"><span class="crayon-h">	</span><span class="crayon-c"># (x, y) coordinates and indicate that cropping is being</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-16"><span class="crayon-h">	</span><span class="crayon-c"># performed</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-17"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">event</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">EVENT_LBUTTONDOWN</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-18"><span class="crayon-h">		</span><span class="crayon-v">refPt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-19"><span class="crayon-h">		</span><span class="crayon-v">cropping</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-20"> </p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-21"><span class="crayon-h">	</span><span class="crayon-c"># check to see if the left mouse button was released</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-22"><span class="crayon-h">	</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">event</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">EVENT_LBUTTONUP</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-23"><span class="crayon-h">		</span><span class="crayon-c"># record the ending (x, y) coordinates and indicate that</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-24"><span class="crayon-h">		</span><span class="crayon-c"># the cropping operation is finished</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-25"><span class="crayon-h">		</span><span class="crayon-v">refPt</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-26"><span class="crayon-h">		</span><span class="crayon-v">cropping</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">False</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-27"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-28"><span class="crayon-h">		</span><span class="crayon-c"># draw a rectangle around the region of interest</span></p><p class="crayon-line" id="crayon-56d59e07ce39d574286191-29"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">rectangle</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">refPt</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">refPt</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce39d574286191-30"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We’ll start by importing our two necessary packages: 
			<span id="crayon-56d59e07ce3a3418753699" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">argparse</span></span></span>  for parsing command line arguments and 
			<span id="crayon-56d59e07ce3a7152913849" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span></span></span>  for our OpenCV bindings.</p>
<p>We also define two global variables on <strong>Lines 7 and 8</strong>: 
			<span id="crayon-56d59e07ce3aa711221412" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">refPt</span></span></span> , which is a list of two <em>(x, y)</em>-coordinates specifying  the rectangular region we are going to crop from our image, and 
			<span id="crayon-56d59e07ce3ae991125333" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cropping</span></span></span> , a boolean indicating whether we are in cropping mode or not.</p>
<p>To process the mouse click events we define the 
			<span id="crayon-56d59e07ce3b2911157280" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">click_and_crop</span></span></span>  callback function on <strong>Line 10</strong>. Anytime a mouse event happens, OpenCV will relay the pertinent details to our 
			<span id="crayon-56d59e07ce3b5594046280" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">click_and_crop</span></span></span>  function.</p>
<p>In order for our function to handle the relay, we need to accept 5 arguments:</p>
<ul>
<li><strong>event:</strong> The event that took place (left mouse button pressed, left mouse button released, mouse movement, etc).</li>
<li><strong>x:</strong> The <i>x</i>-coordinate of the event.</li>
<li><strong>y:</strong> The <em>y</em>-coordinate of the event.</li>
<li><strong>flags:</strong> Any relevant flags passed by OpenCV.</li>
<li><strong>params:</strong> Any extra parameters supplied by OpenCV.</li>
</ul>
<p>From there we grab reference to our 
			<span id="crayon-56d59e07ce3b9746401194" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">refPt</span></span></span>  list and 
			<span id="crayon-56d59e07ce3bd879550468" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cropping</span></span></span>  flag on <strong>Line 12</strong>.</p>
<p>We then make a check on <strong>Line 17</strong> to see if our left mouse button was pressed. If it was, we record the <em>(x, y)</em>-coordinates of the event and indicate that we are now in “cropping mode”.</p>
<p>At this point we would drag out the rectangular region of the image that we want to crop. After we are done dragging out the region, we release the left mouse button — <strong>Line 22</strong> handles when the left mouse button is released and updates the list of points containing our ROI. We also draw the rectangle representing the ROI on <strong>Lines 29 and 30</strong>.</p>
<p>Now, let’s see how we can use this function to crop an image:</p>

		<div id="crayon-56d59e07ce3c1553360191" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-32">32</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-34">34</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-36">36</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-38">38</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-40">40</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-42">42</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-44">44</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-46">46</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-48">48</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-50">50</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-52">52</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-54">54</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-56">56</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-58">58</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-60">60</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-62">62</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-63">63</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59e07ce3c1553360191-64">64</p><p class="crayon-num" data-line="crayon-56d59e07ce3c1553360191-65">65</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-32"><span class="crayon-c"># construct the argument parser and parse the arguments</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-33"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-34"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-i"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"Path to the image"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-35"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-36"> </p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-37"><span class="crayon-c"># load the image, clone it, and setup the mouse callback function</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-38"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"image"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-39"><span class="crayon-v">clone</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-40"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">namedWindow</span><span class="crayon-sy">(</span><span class="crayon-s">"image"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-41"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">setMouseCallback</span><span class="crayon-sy">(</span><span class="crayon-s">"image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">click_and_crop</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-42"> </p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-43"><span class="crayon-c"># keep looping until the 'q' key is pressed</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-44"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-45"><span class="crayon-h">	</span><span class="crayon-c"># display the image and wait for a keypress</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-46"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-47"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">0xFF</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-48"> </p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-49"><span class="crayon-h">	</span><span class="crayon-c"># if the 'r' key is pressed, reset the cropping region</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-50"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-k ">ord</span><span class="crayon-sy">(</span><span class="crayon-s">"r"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-51"><span class="crayon-h">		</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">clone</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-52"> </p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-53"><span class="crayon-h">	</span><span class="crayon-c"># if the 'c' key is pressed, break from the loop</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-54"><span class="crayon-h">	</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-k ">ord</span><span class="crayon-sy">(</span><span class="crayon-s">"c"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-55"><span class="crayon-h">		</span><span class="crayon-st">break</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-56"> </p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-57"><span class="crayon-c"># if there are two reference points, then crop the region of interest</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-58"><span class="crayon-c"># from teh image and display it</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-59"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">refPt</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-60"><span class="crayon-h">	</span><span class="crayon-v">roi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">clone</span><span class="crayon-sy">[</span><span class="crayon-v">refPt</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">:</span><span class="crayon-v">refPt</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">refPt</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">:</span><span class="crayon-v">refPt</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-61"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"ROI"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">roi</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-62"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-63"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59e07ce3c1553360191-64"><span class="crayon-c"># close all open windows</span></p><p class="crayon-line" id="crayon-56d59e07ce3c1553360191-65"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">destroyAllWindows</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start by parsing our command line arguments on <strong>Lines 33-35</strong>. We need only a single switch here, 
			<span id="crayon-56d59e07ce3c7146998169" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">image</span></span></span> , which is the path to the image we want to crop. This image is then loaded and cloned on <strong>Lines 38 and 39</strong>. We make a deep copy of the image so we can draw the rectangular bounding box on <strong>Line 29</strong> without destroying the original image.</p>
<p><strong>Lines 40 and 41</strong> handle registering our 
			<span id="crayon-56d59e07ce3cb849975463" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">click_and_crop</span></span></span>  callback function. We first call 
			<span id="crayon-56d59e07ce3cf745038806" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">namedWindow</span></span></span>  to create a window named “image”. And we then set the mouse callback by calling 
			<span id="crayon-56d59e07ce3d2670326801" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">setMouseCallback</span></span></span> , supplying our named “image” window and our 
			<span id="crayon-56d59e07ce3d6075726000" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">click_and_crop</span></span></span>  callback function.</p>
<p>From here, the rest of this example just ties the pieces together.</p>
<p>We start a loop on <strong>Line 44</strong> which (1) displays our image on screen and (2) waits for a keypress.</p>
<p><strong><em>This is the point where we select the rectangular region we want to crop from the image.</em></strong></p>
<p>If we press the 
			<span id="crayon-56d59e07ce3db876112449" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">r</span></span></span>  key after selecting the region to crop, we reset our cropping</p>
<p>And if we press the 
			<span id="crayon-56d59e07ce3de068835256" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">c</span></span></span>  key, then we break from the loop and perform the actual cropping on <strong>Lines 59-62</strong>.</p>
<p>Finally, we cleanup and close all open windows on <strong>Line 65</strong>.</p>
<h1>OpenCV mouse events in action</h1>
<p>Now that we have our example coded up, let’s try it out. Open up a terminal and execute the following command:</p>

		<div id="crayon-56d59e07ce3e3815341317" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59e07ce3e3815341317-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">click_and_crop</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">image </span><span class="crayon-v">jurassic_park_kitchen</span><span class="crayon-e">.jpg</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>You’ll first be presented with the image on your screen:</p>
<div id="attachment_2031" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-original.jpg"><img class="wp-image-2031" src="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-original.jpg" alt="Figure 1: Our original image displayed on screen." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-original-300x199.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-original.jpg 614w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Our original image displayed on screen.</p></div>
<p>Select the region you want to crop by clicking, dragging, and releasing:</p>
<div id="attachment_2032" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-select.jpg"><img class="wp-image-2032" src="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-select.jpg" alt="Figure 2: Clicking and dragging the region of the image we want to crop." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-select-300x199.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-select.jpg 614w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Clicking and dragging the region of the image we want to crop.</p></div>
<p>And finally press the 
			<span id="crayon-56d59e07ce3e7116694006" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">c</span></span></span>  key to perform the crop:</p>
<div id="attachment_2033" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-tim.jpg"><img class="wp-image-2033" src="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-tim.jpg" alt="Figure 3: Cropping the actual image." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-tim-300x134.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-tim.jpg 757w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text">Figure 3: Cropping the actual image.</p></div>
<p>As you can see, we have successfully cropped Tim’s face from the image.</p>
<p>Here is another example where we crop the Velociraptor:</p>
<div id="attachment_2034" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor1.jpg"><img class="wp-image-2034" src="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor1.jpg" alt="Figure 4: Another example of cropping our image, this time extracting the Velociraptor head from the image." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor1-300x131.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/01/mouse-event-crop-raptor1.jpg 759w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 4:</strong> Another example of cropping our image, this time extracting the Velociraptor head from the image.</p></div>
<p>So there you have it — a simple method to capture mouse events to crop an image using Python and OpenCV.</p>
<h1>Summary</h1>
<p>In this blog post we learned how to capture mouse events using OpenCV and Python. While this post did not provide a complete and exhaustive overview of <em>all</em> the mouse events you can capture, it laid the groundwork for what is possible.</p>
<p>This post also demonstrated how you can quickly crop and extract regions of an image, which is especially useful when creating training data for <a title="Histogram of Oriented Gradients and Object Detection" href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">your own custom object detectors</a>.</p>
<h1 id="post_downloads">Downloads:</h1>

	</section>
	</div></body></html>