<html><body><div><div class="entry-content"><p><a href="https://www.python.org/dev/peps/pep-0318/">Decorators</a> and <a href="https://docs.python.org/2/howto/descriptor.html">Descriptor</a> are two independent features of Python programming language, but they gel together very well, below is a descriptor decorator ;)</p>
<p>Say, we have a simple <code>Greet</code> class:</p>
<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">Greet</span><span class="p">():</span>
</span><span class="line">    <span class="n">msg</span> <span class="o">=</span> <span class="s">"meow"</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">yo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="s">"Yo!"</span>
</span></code></pre></td></tr></table></div></figure>
<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">Greet</span><span class="p">()</span>
</span><span class="line"><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Greet</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10046ea90</span><span class="o">&gt;</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">greetThem</span> <span class="o">=</span> <span class="n">Greet</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">greetThem</span><span class="o">.</span><span class="n">yo</span>
</span><span class="line"><span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">Greet</span><span class="o">.</span><span class="n">yo</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Greet</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10046eb50</span><span class="o">&gt;&gt;</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">greetThem</span><span class="o">.</span><span class="n">msg</span>
</span><span class="line"><span class="s">"meow"</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">greetThem</span><span class="o">.</span><span class="n">yo</span><span class="p">()</span>
</span><span class="line"><span class="s">"Yo!"</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">Greet</span><span class="o">.</span><span class="n">msg</span>
</span><span class="line"><span class="s">"meow"</span>
</span></code></pre></td></tr></table></div></figure>
<p>Nothing special so far, everything is as expected...</p>
<p>Now, let's add some magic, first lets create an <code>Accessor</code> descriptor:</p>
<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">Accessor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fget</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="o">=</span> <span class="n">fget</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</span><span class="line">        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="line">            <span class="k">return</span> <span class="bp">self</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>
<p>Now that we have a descriptor, let's decorate our <code>Greet</code> class with it.</p>
<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">Greet</span><span class="p">():</span>
</span><span class="line">    <span class="n">msg</span> <span class="o">=</span> <span class="s">"meow"</span>
</span><span class="line">    <span class="nd">@Accessor</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">yo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="s">"Yo!"</span>
</span></code></pre></td></tr></table></div></figure>
<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">Greet</span><span class="p">()</span>
</span><span class="line"><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Greet</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10056eb50</span><span class="o">&gt;</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">greetThem</span> <span class="o">=</span> <span class="n">Greet</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">greetThem</span><span class="o">.</span><span class="n">yo</span>
</span><span class="line"><span class="s">"Yo!"</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">greetThem</span><span class="o">.</span><span class="n">msg</span>
</span><span class="line"><span class="s">"meow"</span>
</span><span class="line">
</span><span class="line"><span class="o">&gt;&gt;&gt;</span> <span class="n">Greet</span><span class="o">.</span><span class="n">msg</span>
</span><span class="line"><span class="s">"meow"</span>
</span></code></pre></td></tr></table></div></figure>
<p>Notice <code>greetThem.yo</code> vs <code>greetThem.yo()</code> :)</p>
<p><strong>So what was the trick behind the magic?:</strong></p>
<p>Dotted access to look up a member will result in:</p>
<ul>
<li><p>Look up for the member in the instance dictionary.</p></li>
<li><p>If it's not found, the look up happens in the class dictionary.</p></li>
<li><p>If found it in the class dictionary and it has a descriptor protocol implemented, instead of just returning it, Python executes it!</p></li>
</ul>
<p>Clearly the much more concise term of art should be Desecrator, says coriolinus on reddit.</p>
</div>
</div></body></html>