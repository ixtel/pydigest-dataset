<html><body><div><div class="entry-content"><p><em>Editor’s Note: Meet Armando Roggio at Ignite 2015, our conference on Sept. 16 and 17 in Dallas, where he’ll co-present three sessions: <a href="http://www.practicalecommerce.com/ignite#three-thirty-pm">“How to Build an Ecommerce Brand (and Reduce Reliance on Paid Traffic),”</a> <a href="http://www.practicalecommerce.com/ignite?d=2#eleven-am">“Content Marketing Essentials: Attracting and Engaging Shoppers, for Higher Conversions,”</a> and <a href="http://www.practicalecommerce.com/ignite?d=2#one-thirty-pm">“Ecommerce Opportunities for Brick-and-mortar Merchants.”</a></em></p><p>Monitoring competitors’ prices and product lineups can help online retailers win pricing battles; optimize sales and special offers; and track product trends over time. For many small ecommerce businesses, however, keeping tabs on the competition is a painful, manual process.</p><p>Fortunately, thanks to an easy-to-use application framework called <a href="http://scrapy.org/">Scrapy</a> almost anyone can create a web spider to crawl competitors’ websites and collect pricing data. If you can read HTML and CSS, you can make Scrapy work.</p><p>Before diving into a demonstration of how you can use Scrapy, it is worth mentioning that there are certainly plenty of good services that will help online sellers track competitors or even develop winning, dynamic pricing strategies — examples include <a href="http://www.wiser.com/">Wiser</a>, <a href="http://www.pricetrakker.com/">Price Trakker</a>, and <a href="http://upstreamcommerce.com/">Upstream Commerce</a>, to name a few.</p><p>If you can afford one of these services, your business may not need to build your own price monitoring bot. But for relatively small retailers that find these services expensive, Scrapy is a good, easy-to-employ option.</p><h3>The Scrapy Application Framework Is Easy</h3><p>Although using Scrapy requires you to write code, building web scraping bots is actually a lot easier than many other common web development tasks. A beginner with a willingness to try should be able to use Scrapy successfully.</p><div id="attachment_90939" class="wp-caption alignnone"><img class="size-large wp-image-90939" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072715-scrapy-home-570x286.jpg" alt="Scrapy is an application framework for creating web spiders."/><p class="wp-caption-text">Scrapy is an application framework for creating web spiders.</p></div><p>In fact, the most difficult part will be identifying the elements on the page that you want to scrape. For this you will need to be familiar with HTML structures and CSS selectors.</p><p>Finally, Scrapy is relatively easy for at least three more reasons: (a) It uses Python, a very common and easy to write programming language; (b) it will run on Mac OS X, Linux, and Windows, so you won’t need to bring up a server, and (c) it is a framework, so there is relatively little code to write.</p><h3>Seeking Comic Prices</h3><p>To demonstrate how to use Scrapy, consider the hypothetical case of Al, a comic book retailer. The comic book trade is very competitive, and while new comics have cover prices that generally represent the going rate for the first couple of months after publication, the price of a back issue or collectable comic can change fast.</p><p>Al wants to ensure that his back issues and collectable comics, which he sells in his own brick-and-click store and on eBay, have current, market-right prices. Al also buys lots of comics, so it is important for him to track prices over time, so he can discover trends.</p><p>One of the sites that Al wants to monitor is <a href="http://www.tfaw.com/Companies/Dark-Horse/Series?series_name=Mass+Effect">Things From Another World</a> (TFAW), a popular comic retailer. On TFAW, Scrapy will collect prices for Dark Horse Comics’ Mass Effect series.</p><p>The Scrapy spider we will build will first locate the product links on TFAW’s Mass Effect page (a product category page) and follow those links to each Mass Effect comic’s product detail page, where it will collect the pricing information.</p><div id="attachment_90943" class="wp-caption alignnone"><img class="size-large wp-image-90943" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072715-tfaw-570x386.jpg" alt="The spider will start crawling on one of TFAW's product category pages."/><p class="wp-caption-text">The spider will start crawling on one of TFAW’s product category pages.</p></div><h3>Install Python and Scrapy</h3><p>To use the Python-powered Scrapy application framework, you need to ensure that you have the following services, packages, and software loaded on your computer or server.</p><p>If you’re using a computer running OS X or Linux, the process could hardly be easier.</p><p>For example, on a Mac, Python is already be installed. So you simply need to download the pip package manager, open a terminal, and type a few commands.</p><p>You’ll find a copy of the pip package manager at <a href="https://bootstrap.pypa.io/get-pip.py">https://bootstrap.pypa.io/get-pip.py</a>.</p><p>Once downloaded, open your Mac’s terminal, navigate to the directory you downloaded the get-pip.py file to, and run the following command.</p><pre>sudo python get-pip.py</pre><p>You should be asked to enter your password. This is the same password you use to log into your Mac. This should get you both the pip package manager and the Python setup tools.</p><p>Next, run the command below to update a package called six. This is to a avoid a known issue with six and Scrapy.</p><pre>sudo pip install --upgrade six</pre><p>Finally, install Scrapy.</p><pre>sudo pip install Scrapy</pre><p>Windows requires a couple of extra steps, which are outlined on the Scrapy website at <a href="http://doc.scrapy.org/en/1.0/intro/install.html">http://doc.scrapy.org/en/1.0/intro/install.html</a>.</p><h3>Create a Scrapy Project</h3><p>In your computer’s terminal navigate to the directory where you want to keep your Scrapy web crawlers, and create a new Scrapy project with the frameworks <i>startproject</i> command.</p><pre>scrapy startproject tfaw</pre><p>This command has three parts. The word <i>scrapy</i> tells your computer that you want to use the Scrapy framework. As one might expect, <i>startproject</i> indicates that you want to create a new Scrapy project. Finally, in the example, <i>tfaw</i> is the name of the project. You may, of course, name your Scrapy project almost anything you want.</p><p>The framework will automatically generate a few directories and files, so that you should have a project structure that looks something like this one.</p><pre>tfaw/</pre><pre>    scrapy.cfg</pre><pre>    tfaw/</pre><pre>        __init__.py</pre><pre>        __init__.pyc</pre><pre>        items.py</pre><pre>        pipelines.py</pre><pre>        settings.py</pre><pre>        settings.pyc</pre><pre>        spiders/</pre><h3>Create Item Definitions</h3><p>In the example project files shown above, notice the file <i>items.py</i>. This file is used to describe the things you want to collect from a target web page. When you first open <i>items.py</i>, it should look like the following.</p><pre># -*- coding: utf-8 -*-

# Define here the models for your scraped items
#
# See documentation in:
# http://doc.scrapy.org/en/latest/topics/items.html

import scrapy


class TfawItem(scrapy.Item):
    # define the fields for your item here like:
    # name = scrapy.Field()
   pass

</pre><p>As you look at this code, notice first that Scrapy named your new item class after the project name (“tfaw” was our project name), capitalizing the first letter to follow a convention for naming classes.</p><pre>class TfawItem(scrapy.Item):
</pre><p>Next, notice that Scrapy gives you instructions about how to define items for your web spider. Remember these items are essentially a list of the information you want to collect from the product detail page.</p><pre># define the fields for your item here like:
# name = scrapy.Field()
</pre><p>To decide what to put here, our hypothetical comic book seller, Al, visits one of the product detail pages on the TFAW website. He decides that he wants the product’s title, UPC, and, of course, price. These items can be added in the items.py file — like the following.</p><pre>class TfawItem(scrapy.Item):
    # define the fields for your item here like:
    # name = scrapy.Field()
    title = scrapy.Field()
    price = scrapy.Field()
    upc = scrapy.Field()
</pre><div id="attachment_90942" class="wp-caption alignnone"><img class="size-large wp-image-90942" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072715-tfaw-with-arrows-570x221.jpg" alt="An important step is to decide what you want to scrape from the page."/><p class="wp-caption-text">An important step is to decide what you want to scrape from the page.</p></div><p>For our project, we also want to grab the product detail page’s URL. This way, if there is ever an error with our pricing bot, we can go to the source.</p><p>The completed items.py file looks like this.</p><pre># -*- coding: utf-8 -*-

# Define here the models for your scraped items
#
# See documentation in:
# http://doc.scrapy.org/en/latest/topics/items.html

import scrapy


class TfawItem(scrapy.Item):
    # define the fields for your item here like:
    # name = scrapy.Field()
    title = scrapy.Field()
    price = scrapy.Field()
    upc = scrapy.Field()
    url = scrapy.Field()

</pre><p>As an aside, space has meaning in Python. So try to stay lined up with the same indents and spacing shown. Also, you will want to use a code editor or basic text editor to modify your <em>items.py</em> file. Never use a word processor like Microsoft Word.</p><h3>Create Your Scrapy Spider</h3><p>Return to your computer’s terminal and create a new Scrapy spider.</p><pre>scrapy genspider massEffect tfaw.com</pre><p>This command has four parts.</p><p>First, <em>scrapy</em> tells your computer to use the Scrapy framework. As one might expect, <em>genspider</em> tells your computer that you want to generate a new spider.</p><p>The next option is the unique name that you want to give your spider. In our example, we will be getting the prices for the Mass Effect comic book series, so the spider is named, <em>massEffect</em>. You can give your spider almost any meaningful name you want. Finally, we specify which domain the spider will crawl. In our example, this is <em>tfaw.com</em>.</p><p>This command will create the code for a new Scrapy spider and place it in your project’s spider’s directory. The filename for your new spider will be the same as the name you gave it in your <em>genspider</em> command, so for our project the spider’s filename is <em>massEffect.py</em>.</p><p>When you open this file in your code editor, it should look just like this.</p><pre># -*- coding: utf-8 -*-
import scrapy

class MasseffectSpider(scrapy.Spider):
    name = "massEffect"
    allowed_domains = ["tfaw.com"]
    start_urls = (
        'http://www.tfaw.com/',
    )

    def parse(self, response):
        pass

</pre><h3>Target Your Start URL</h3><p>The first step toward customizing your Scrapy spider is to identify the URL where the spider will start crawling. By default, Scrapy made the start URL the same as the allowed domain.</p><pre>start_urls = (
        'http://www.tfaw.com/',
    )
</pre><p>Since in our example, Al, the hypothetical comic store owner, wants to scrawl the Mass Effect category page, we’ll set the start URL to http://www.tfaw.com/Companies/Dark-Horse/Series?series_name=Mass+Effect.</p><pre>start_urls = (
        'http://www.tfaw.com/Companies/Dark-Horse/Series?series_name=Mass+Effect',
    )
</pre><p>Next, change the parentheses to brackets.</p><pre>start_urls = [
        'http://www.tfaw.com/Companies/Dark-Horse/Series?series_name=Mass+Effect',
    ]
</pre><h3>Parse the Product Category Page</h3><p>Later when we command the spider to crawl, it will look at the <em>parse</em> function for instructions. In our example, we are going to start by collecting the URLs for the individual Mass Effect comics, so we need to add some instructions in the parse function.</p><p>As a reminder, you should be starting with an empty parse function.</p><pre>def parse(self, response):
        pass
</pre><p>If we take a look at the Mass Effect category page on the TFAW site, we notice that the product titles are links to specific product detail pages. So we want our spider to follow these, but we need to give this Scrapy spider a way to identify them.</p><div id="attachment_90940" class="wp-caption alignnone"><img class="size-large wp-image-90940" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072715-tfaw-category-links-570x382.jpg" alt="On the TFAW category page, the comic book titles are links to specific product detail pages."/><p class="wp-caption-text">On the TFAW category page, the comic book titles are links to specific product detail pages.</p></div><p>Scrapy allows us to do this in a couple of ways. We can use CSS selectors, so the same selectors we use to add style to a web page, or we can use XPath, a query language for selecting nodes in a document (selecting the HTML tags). Don’t worry, both of these are easier than you might think.</p><p>To help explain, take a look at the updated parse function I created using a CSS selector.</p><pre>def parse(self, response):
        for href in response.css('div a.boldlink::attr(href)'):
        	url = response.urljoin(href.extract())
        	yield scrapy.Request(url, callback=self.parse_detail_page)

</pre><p>The first line that I added creates an iterator. The important words are <em>for</em> and <em>in</em>.</p><pre>for href in response.css('div a.boldlink::attr(href)'):
</pre><p>This line says that “<strong><em>for</em> </strong>each individual thing <strong><em>in</em></strong> a group of things, do what comes on the following lines.”</p><p>As a shorthand, the individual thing is represented by a variable called <em>href</em> in the example, and the group of things is called <em>response</em>. We could have named the individual things just about anything, like <em>link</em>, <em>selection</em>, or even <em>Fred</em>, but descriptive names are better.</p><p>The group of things, <em>response.css()</em>, is a list, if you will, of elements that the spider found on the product category page. In this case, CSS is being used as the means of identification.</p><p>Effectively, we are telling the spider to locate all of the <em>a</em> tags with a class of <em>boldlink</em> which are inside of a <em>div</em> element and get their <em>href</em> attribute.</p><p>If you have seen CSS before this should be familiar. In fact, the only difference between this CSS selector and what you would see in a simple CSS file is <em>::attr()</em> — which Scrapy uses to indicate that we want an attribute of the selected element.</p><pre>div a.boldlink::attr(href)
</pre><p>Let’s take some time and go over how Scrapy finds the links.</p><p>With this command Scrapy will go to the TFAW website and find all of the <em>div</em> elements.</p><p>For each of the div elements, it will look for a child anchor or <em>a</em> element, so that it will have a collection of <em>div</em> elements that contain an <em>a</em> elements.</p><p>Continuing further, the spider will check to see if the <em>a</em> elements it has collected have a class (. is an indicator of class in CSS) of <em>boldlink</em>.</p><p>If the <em>a</em> element has the <em>boldlink</em> class, the spider will look for and capture its <em>href</em> attribute. If not, it will ignore the element.</p><p>A look at the code from the TFAW site may help. I used ellipses for the URL to make the code fit a bit better. Notice the parent child relationship between the <em>div</em> and the <em>a</em> elements.</p><pre>&lt;div style="margin-bottom: 3px; margin-top: 0px;"&gt;
    &lt;a class="boldlink" href="..." name="427354"&gt;Mass Effect: Foundation #1&lt;/a&gt;
&lt;/div&gt;</pre><p>To identify this relationship, I used Chrome’s developer tools. In Chrome, right click (alternate click) on the TFAW title. A menu should appear. Select “Inspect Element” and you should see the underlying code.</p><div id="attachment_90941" class="wp-caption alignnone"><img class="size-large wp-image-90941" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072715-tfaw-inspect-element-570x302.jpg" alt="Web browsers frequently include development tools that will help you identify the elements on the page. In Google Chrome right click on the element you want to inspect."/><p class="wp-caption-text">Web browsers frequently include development tools that will help you identify the elements on the page. In Google Chrome, right click on the element you want to inspect.</p></div><p>Let’s stop for a moment and run a little test to see if we are, in fact, getting the elements that we want.</p><p>Take the parse function code from above, and comment out the next two lines, adding a # in from of each.</p><pre>def parse(self, response):
        for href in response.css('div a.boldlink::attr(href)'):
        	#url = response.urljoin(href.extract())
        	#yield scrapy.Request(url, callback=self.parse_detail_page)
</pre><p>After these lines add the following.</p><pre>print href</pre><p>Now, go back to your computer’s terminal and navigate to your Scrapy project. Once you are in the project directory, enter the following command.</p><pre>scrapy crawl massEffect</pre><p>As you might expect, this will send the <em>massEffect</em> spider to crawl its target. Your terminal will display information about the crawl, including something like the following for each of the links it encountered.</p><pre>&lt;Selector 
    xpath=u"descendant-or-self::div/...@href" 
    data=u'/Companies/Dark-Horse-Series/Profile/Mas'&gt;</pre><p>Notice that in the data section, we have part of the URL path. We know that we are getting the proper elements. As long as we did not get any other elements, our spider is working so far.</p><p>Return to the parse function code.</p><pre>def parse(self, response):
        for href in response.css('div a.boldlink::attr(href)'):
        	url = response.urljoin(href.extract())
        	yield scrapy.Request(url, callback=self.parse_detail_page)

</pre><p>The next line is indented, indicating that it is one of the things the spider should do <em>for</em> each of the individuals <em>in</em> the group.</p><pre>url = response.urljoin(href.extract())
</pre><p>This command has two parts. First, there is a variable, url, which will be used to store some information. Like all variables, this can be just about any name that you want, but something meaningful is usually better.</p><p>Second, there is a response object, which represents the groups of links that scrapy got back when it crawled the TFAW site using the CSS selector. This response object has a special method called <em>urljoin</em>.</p><pre>response.urljoin()</pre><p>The <em>urljoin</em> method has a special job. It concatenates (chains together) the allowed domain and the value of the parameter we pass to it. We need this because the TFAW site uses relative URLs.</p><p>When our spider crawled the site and got the links, the URL that came back looked like the following.</p><pre>/Companies/Dark-Horse-Series/Profile/MassEffect...</pre><p>Notice that it does not start with an <em>http</em> or the TFAW domain name.</p><p>In web development, relative URLs are generally a good idea. Web browsers are smart enough to know that the full URL should really start with the protocol and the domain name. But our spider does not make those sorts of assumptions. It does only what it is told. So we need to let it know to add the <em>tfaw.com</em> domain in front of the link information it retrieved. The <em>urljoin</em> method does just that when we pass it an individual link stored in the variable <em>href</em>.</p><pre>url = response.urljoin(href.extract())</pre><p>For this line, the last thing to notice is that we added another method, <em>extract()</em>, to our <em>href</em> object to tell Scrapy that we want just the value of the data not the entire object to be concatenated.</p><p>The next line in <em>parse</em> takes the URL for the individual product detail page and tells Scrapy to go crawl that page. When it is done, Scrapy should look for another function, which we have not yet created, named <em>parse_detail_page</em> and do what that function tells it to do.</p><pre>yield scrapy.Request(url, callback=self.parse_detail_page)</pre><p>This command can be divided into a few parts.</p><p>First, we have the Python <em>yield</em> keyword. This is a special Python feature that returns what’s called a generator. For our purposes, you simply need to know that <em>yield</em> gets the result of what follows, which in this case is a Scrapy crawl.</p><p>The next part is a Scrapy request.</p><pre>scrapy.Request()</pre><p>Scrapy uses <em>Request</em> and <em>Response</em> objects when it crawls a web page. The <em>Request</em> object sends the spider out to get data, which is returned as a <em>Response</em> object.</p><p>We are passing the Scrapy request two parameters. First the URL of the product detail page that we collected earlier and, second, the name of a new function that we want Scrapy to run once it has a response. As a matter of convention, functions called after a response or action are referred to as callbacks or a callback.</p><pre>yield scrapy.Request(url, callback=self.parse_detail_page)</pre><h3>Parse the Product Detail Page</h3><p>The Scrapy spider we’ve been building is already pretty amazing. It will:</p><ul><li>Visit a product category page on the TFAW site;</li><li>Find all of the individual links to product detail pages;</li><li>Modify the URL to each product detail page so that page can be crawled, too;</li><li>Pass each individual URL to a new function.</li></ul><p>The next step then is to write the <em>parse_detail_page</em> function and start collection the pricing data. Here is the finished function.</p><pre>def parse_detail_page(self, response):
    	comic = TfawItem()
    	comic['title'] = response.css('div.iconistan + b span.blackheader::text').extract()
    	comic['price'] = response.css('span.blackheader ~ span.redheader::text').re('[$]\d+\.\d+')
    	comic['upc'] = response.xpath(‘...’).extract()
    	comic['url'] = response.url
    	yield comic

</pre><p>The first line in this section of code defines the function. It uses the <em>def</em> keyword to declare that we will be creating a new function. It defines the name of the function, <em>parse_detail_page</em>, and it passes to parameters, including our response from the last Request. The colon at the end is required.</p><pre>def parse_detail_page(self, response):</pre><p>The first line inside of the function associates the variable <em>comic</em> with the item class that we created earlier.</p><pre>comic = TfawItem()</pre><p>The next four lines are a series of declarations or associations, if you will.</p><p>In each case, we added information to <em>comic</em>. You should notice that the first two declarations are using CSS to identify the parts of the TFAW product detail page that Al, our comic storeowner, wanted to capture.</p><pre>comic['title'] = response.css('div.iconistan + b span.blackheader::text').extract()
comic['price'] = response.css('span.blackheader ~ span.redheader::text').re('[$]\d+\.\d+')
</pre><p>Let’s take a moment and examine the CSS selectors used. In the first of these two, notice that I have added <em>::text</em> to the end. This is an important distinction for Scrapy. If I had not used <em>::text</em> the Scrapy spider would have grabbed the element, which in this case is a <em>span </em>with the class, <em>blackheader</em>. When I add <em>::text</em>, I am in effect telling the spider that I want the text inside of the <em>span</em> rather than the <em>span</em> itself.</p><pre>comic['title'] = response.css('div.iconistan + b span.blackheader::text').extract()</pre><p>Using <em>extract()</em> at the end retrieves the data rather than the object, as described above.</p><p>The next line is a bit different in that it does not end with <em>extract()</em> rather we have <em>re()</em>, with a rather odd-looking parameter <em>[$]\d+\.\d+</em>.</p><pre>comic['price'] = response.css('span.blackheader ~ span.redheader::text').re('[$]\d+\.\d+')</pre><p>In this case, we are getting the price from the TFAW product detail pages, but the text for the price includes a phrase, “Your Price:,” followed by the actually price. For our price monitoring, Al is not going to need that phrase, so I used what is called a regular expression to remove the words and return just the price.</p><p>The<em> re()</em> method first does what the <em>extract()</em> method does (gets the text from the element), but then it filters the result based on the regular expression.</p><div id="attachment_90956" class="wp-caption alignnone"><img class="wp-image-90956 size-large" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072815-regexpal-570x207.jpg" alt="Regular expressions can define selections within text."/><p class="wp-caption-text">Regular expressions can define selections within text.</p></div><p>I used an online tool called RegexPal to help define the regular expression. Without going into too much detail about how regular expressions work, know that you can use them to select a part of a string of text.</p><pre>[$]\d+\.\d+</pre><p>So in this case the <em>[$]</em> looks for a<em> $</em> in the text. The <em>\d+</em> selects one or more digits. The<em> \.</em> allows for the decimal in the price, and again <em>\d+</em> selects one or more digits.</p><p>In your spiders, you can use regular expressions this way too.</p><p>The next line of the function introduces us to an XPath selector. In the example, I am using an ellipse as a placeholder, but don’t worry, I will show you what is in there.</p><pre>comic['upc'] = response.xpath(‘...’).extract()</pre><p>XPath is expressed as a list of elements with slashes in between. So the XPath <em>table/tr/td</em> would select the all of the <em>td</em> elements that had a <em>tr</em> element as a parent and a <em>table</em> element as a grandparent.</p><p>You can usually identify an XPath by looking at the code, and recognizing the relationship between elements.</p><p>Here is an example. Again, the XPath for the <em>td</em> would be <em>table/tr/td</em>.</p><pre>&lt;table&gt;</pre><pre>&lt;tr&gt;</pre><pre>        &lt;td valign="top"&gt;Availability:&amp;nbsp;&amp;nbsp;&lt;/td&gt;</pre><pre>        &lt;td valign="top"&gt;Released&lt;/td&gt;</pre><pre>    &lt;/tr&gt;</pre><pre>&lt;/table&gt;</pre><p>A browser web development tool will often show you an XPath. Just be careful. Some web development tools will include elements that should be there but are not.</p><div id="attachment_90938" class="wp-caption alignnone"><img class="size-large wp-image-90938" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072715-show-chrome-xpath-570x346.jpg" alt="A web browser's development tools will often show the XPath."/><p class="wp-caption-text">A web browser’s development tools will often show the XPath or a list of elements from which the XPath can be identified..</p></div><p>For example, Chrome shows tbody elements in the XPath even though they are not actually there. The TFAW website uses a very ugly table structure, so ultimately the XPath ended up looking like this.</p><pre>/html/body/table[1]/tr/td[4]/
table[3]/tr/td/table/tr/td[contains(., "UPC:")]
/following-sibling::td[1]/text()
</pre><p>For further information about XPath, Scrapy has <a href="http://doc.scrapy.org/en/1.0/intro/tutorial.html">some good examples</a> on its site. <a href="http://zvon.org/comp/r/tut-XPath_1.html">ZVON.or</a>g also has a great explanation of how to use XPath.</p><p>The last of the four declarations is the simplest.</p><pre>comic['url'] = response.url</pre><p>It simply captures the URL that we passed from the <em>parse</em> function to this <em>parse_detail_page</em> function.</p><p>The last line in the spider yields the results of the spider’s efforts.</p><pre>yield comic</pre><h3>Start Monitoring Prices</h3><p>The spider is complete. While it certainly took me a lot of words and examples to describe it, I hope it did not seem too complicated.</p><p>The only thing that remains is to crawl the TFAW site and get the price data that Al wanted. To do this, go back to your computer’s terminal, navigate to the Scrapy project directory and run the following command to get the price data as a comma separated value (CSV) that you can read with Google Sheets, Microsoft Excel, or really any spreadsheet software.</p><pre>scrapy crawl massEffect -o results.csv</pre><p>The first part of this command should look familiar since we used it before. It tells Scrapy to send the spider out to crawl its target pages.</p><pre>scrapy crawl massEffect</pre><p>The next bit outputs (-o) the results of the crawl to a file named <em>results.csv</em>. I could have called this file just about anything I wanted and so long as I added the <em>.csv</em> extension, I would get the spreadsheet I am looking for.</p><p>If you open <em>results.csv</em> in a text editor, it should look something like the example below.</p><pre>url,price,upc,title
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-4___433370,$2.39,76156820462900411,Mass Effect: Foundation #4
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-12___450605,$2.39,76156820462901211,Mass Effect: Foundation #12
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-2___429269,$2.39,76156820462900211,Mass Effect: Foundation #2
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-7___440094,$2.39,76156820462900711,Mass Effect: Foundation #7
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-3___431314,$2.39,76156820462900311,Mass Effect: Foundation #3
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-13___452713,$2.39,76156820462901311,Mass Effect: Foundation #13
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-8___442437,$2.39,76156820462900811,Mass Effect: Foundation #8
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-1___427354,$2.39,76156820462900111,Mass Effect: Foundation #1
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-11___448663,$2.39,76156820462901111,Mass Effect: Foundation #11
http://www.tfaw.com/Companies/Dark-Horse-Series/Profile/Mass-Effect%3A-Foundation-10___446357,$2.39,76156820462901011,Mass Effect: Foundation #10

</pre><p>If we open this same file in Google Sheets, it is easy to see that we have successfully crawled the site and captured prices.</p><div id="attachment_90937" class="wp-caption alignnone"><img class="size-large wp-image-90937" src="http://www.practicalecommerce.com/wp-content/uploads/2015/07/072715-results-csv-570x245.jpg" alt="The resulting CSV file can be opened as a spreadsheet."/><p class="wp-caption-text">The resulting CSV file can be opened as a spreadsheet.</p></div><h3>Summing Up</h3><p>Even the smallest of ecommerce businesses can write a web spider using Scrapy and collect pricing information.</p><p>Our hypothetical storeowner, Al, will need to run his bot weekly, and actually use the data he collects. If TFAW changes its page layout, Al will need to update the spider, but this should be a lot easier than manually visiting the page every week.</p><p>Building a series of these spiders is a lot faster and more efficient than manually checking prices.</p></div></div></body></html>