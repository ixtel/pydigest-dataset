<html><body><div><div class="content html_format"><p>
      Для ленивых и не желающих возиться, сдувать пыль с бубна по настройке exim4/postfix/sendmail предлагается простейший сборщик почты написанный на Python</p><sup><a href="#link1">[1]</a></sup><p>. 
</p><p>
Его работа заключается в сборе всей почты, посылаемой этому фейковому smtp серверу и складывании её в указанную папку /tmp/mails в виде файлов писем nobody@mail.local.1 с порядковым номером.

</p><a name="habracut"/>
<h2>Шаг №1: установка nullmailer</h2><p>
В стандартных репах должен быть nullmailer. Если нет, то </p><a href="https://github.com/bruceg/nullmailer">качаем</a><p>, а есть то устанавливаем:
</p><pre><code>sudo apt-get install nullmailer</code></pre>
<p>
Идём в /etc/nullmailer и в файле remotes добавляем:
</p><pre><code>localhost smtp</code></pre>
<p>
Перезапускаем:
</p><pre><code>service nullmailer restart</code></pre>

<i>В Debian-подобных линуксах очередь писем находится в /var/spool/nullmailer/queue/</i>

<h2>Шаг №2: установка fakemail</h2><p>
Качаем скрипт </p><a href="http://sourceforge.net/projects/fakemail/">fakemail</a><p>, распаковываем. Если стандартно, то запускаем </p><pre><code>python setup.py install</code></pre><p> или копируем файл fakemail.py куда надо.
</p><p>
Теперь хотелось бы его сделать запускаемым как сервис, а не просто висящим в консоли.</p><p>
Для этого создаём файл </p><i>/etc/init.d/fakemail</i><p> и вставляем в него следующий код:
</p><div class="spoiler"><b class="spoiler_title">Скрытый текст</b><div class="spoiler_text"><pre><code class="bash">#!/bin/sh

set -e

NAME=fakemail
DAEMON=/usr/local/bin/$NAME.py
DOPTIONS="--path=/tmp/mails"

test -x "$DAEMON" || exit 0

PIDDIR=/var/run
PIDFILE=$PIDDIR/$NAME.pid

LANG=C
export LANG

. /lib/lsb/init-functions


start_fakemail()
{
    start-stop-daemon --start --quiet --pidfile $PIDFILE --make-pidfile --exec $DAEMON -- $DOPTIONS &gt;/dev/null 2&gt;&amp;1 &amp;
}

stop_fakemail()
{
    if [ -f "$PIDFILE" ]; then
        PID=`cat $PIDFILE`
        kill -2 $PID
        rm -f "$PIDFILE"
    fi
}

case "$1" in
    start)
        log_daemon_msg "Starting MTA"
        start_fakemail
        ;;
    stop)
        log_daemon_msg "Stopping MTA"
        stop_fakemail
        ;;
    restart)
        stop_fakemail
        start_fakemail
        ;;
esac

exit 0
</code></pre>
</div></div>
<p>
Если вы копировали руками файл, то, возможно, стоит отредактировать файл и в 6 строке, где DAEMON, заменить путь к нашему питоновскому файлу.
</p><p>
Делаем запускаемым:
</p><pre><code>sudo chmod +x /etc/init.d/fakemail</code></pre>
<p>
Теперь надо создать (под рутом) папку mails в /tmp</p><sup><a href="http://link2">[2]</a></sup>
<pre><code>sudo mkdir /tmp/mails</code></pre>
<p>
И добавить ссылкы на сервис во время завершения работы системы:
</p><pre><code>sudo ln -s /etc/init.d/fakemail /etc/rc0.d/K20fakemail
sudo ln -s /etc/init.d/fakemail /etc/rc1.d/K20fakemail
sudo ln -s /etc/init.d/fakemail /etc/rc6.d/K20fakemail</code></pre>
<p>
Если вам нужно, чтобы он так же автоматически стартовал, то добавьте следующее:
</p><div class="spoiler"><b class="spoiler_title">код для добавления в автозапуск</b><div class="spoiler_text"><pre><code>sudo ln -s /etc/init.d/fakemail /etc/rc2.d/S20fakemail
sudo ln -s /etc/init.d/fakemail /etc/rc3.d/S20fakemail
sudo ln -s /etc/init.d/fakemail /etc/rc4.d/S20fakemail
sudo ln -s /etc/init.d/fakemail /etc/rc5.d/S20fakemail
</code></pre></div></div>
<p>
Запускаем сервис:
</p><pre><code>service fakemail start</code></pre>

<a name="link1"/><p>[1] основной материал был найден по </p><a href="http://distinctplace.com/2013/06/20/nullmailer-and-fake-mail---two-little-tools-for-every-developer/">ссылке</a><p>, я лишь дописал сервис.

</p><a name="link2"/><p>[2] можно и любую другую папку, но тогда надо внутри </p><i>/etc/init.d/fakemail</i><p> где </p><i>DOPTIONS=</i><p> изменить ваш путь </p><i>--path=/path/to/folder</i>

      
      <p class="clear"/>
    </div>

    
  </div></body></html>