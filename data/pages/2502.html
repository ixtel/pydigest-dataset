<html><body><div><div class="post-text" itemprop="text">

<p>In <a href="https://github.com/uwescience/myria-python">myria-python</a>, we use setuptools with <code>install_requires</code> to configure which packages are needed. In our particular <a href="https://github.com/uwescience/myria-python/blob/master/setup.py">setup file</a>, we include <code>requests-toolbelt</code> and <code>requests</code> in that list.</p>

<p>When we create a new virtual environment and then run <code>python setup.py install</code>, it fails the first time with <code>Cannot find required distribution requests</code>. This happens seemingly because <code>pip</code> identifies <code>requests toolbelt-0.3.1</code> (note the space) as the right match for package <code>requests</code>.</p>

<p>Running <code>python setup.py install</code> again seems to install <code>requests</code> after all.</p>

<p>Here is <a href="https://github.com/uwescience/myria-python/issues/16">a GitHub issue</a> with a full log of the install process.</p>

<p>Steps to reproduce:</p>

<ul>
<li><code>git clone https://github.com/uwescience/myria-python.git</code></li>
<li><code>cd myria-python</code></li>
<li><code>mkvirtualenv myria-python</code></li>
<li><code>python setup.py</code></li>
</ul>

<p>The entire lab seems to have this issue, however all of us use Mac OS X with either 10.9 or 10.10 installed. Here are my machine's specs:</p>

<ul>
<li>OS X 10.10.1</li>
<li>Python 2.7.9 (default, Dec 10 2014, 23:46:04) </li>
<li>pip 1.5.6</li>
<li>mkvirtualenv 1.11.6</li>
</ul>

<p>I was also able to duplicate it on one of our Ubuntu servers:</p>

<ul>
<li>Ubuntu 14.04.1 LTS \n \l</li>
<li>Python 2.7.6</li>
<li>pip 1.5.4</li>
<li>mkvirtualenv 1.11.4</li>
</ul>

<p>Here is the tail of the error log:</p>

<pre><code>Searching for requests-toolbelt
Reading https://pypi.python.org/simple/requests_toolbelt/
Best match: requests-toolbelt 0.3.1
Downloading https://pypi.python.org/packages/source/r/requests-toolbelt/requests-toolbelt-0.3.1.tar.gz#md5=e563377e46cd0be8c7b3ac144a65844c
Processing requests-toolbelt-0.3.1.tar.gz
Writing /var/folders/m_/qltd_g_13qd1v5tvr4l6q2rc0000gn/T/easy_install-2lqn7g/requests-toolbelt-0.3.1/setup.cfg
Running requests-toolbelt-0.3.1/setup.py -q bdist_egg --dist-dir /var/folders/m_/qltd_g_13qd1v5tvr4l6q2rc0000gn/T/easy_install-2lqn7g/requests-toolbelt-0.3.1/egg-dist-tmp-riz25e
no previously-included directories found matching '*.pyc'
warning: manifest_maker: MANIFEST.in, line 6: 'recursive-include' expects &lt;dir&gt; &lt;pattern1&gt; &lt;pattern2&gt; ...

warning: manifest_maker: MANIFEST.in, line 7: 'recursive-include' expects &lt;dir&gt; &lt;pattern1&gt; &lt;pattern2&gt; ...

no previously-included directories found matching 'docs/_build'
zip_safe flag not set; analyzing archive contents...
Adding requests-toolbelt 0.3.1 to easy-install.pth file

Installed /Users/dhalperi/Envs/myria-python2/lib/python2.7/site-packages/requests_toolbelt-0.3.1-py2.7.egg
Searching for requests
Best match: requests toolbelt-0.3.1
Downloading https://pypi.python.org/packages/source/r/requests-toolbelt/requests-toolbelt-0.3.1.tar.gz#md5=e563377e46cd0be8c7b3ac144a65844c
Processing requests-toolbelt-0.3.1.tar.gz
Writing /var/folders/m_/qltd_g_13qd1v5tvr4l6q2rc0000gn/T/easy_install-LKxX9E/requests-toolbelt-0.3.1/setup.cfg
Running requests-toolbelt-0.3.1/setup.py -q bdist_egg --dist-dir /var/folders/m_/qltd_g_13qd1v5tvr4l6q2rc0000gn/T/easy_install-LKxX9E/requests-toolbelt-0.3.1/egg-dist-tmp-3tgz5e
no previously-included directories found matching '*.pyc'
warning: manifest_maker: MANIFEST.in, line 6: 'recursive-include' expects &lt;dir&gt; &lt;pattern1&gt; &lt;pattern2&gt; ...

warning: manifest_maker: MANIFEST.in, line 7: 'recursive-include' expects &lt;dir&gt; &lt;pattern1&gt; &lt;pattern2&gt; ...

no previously-included directories found matching 'docs/_build'
zip_safe flag not set; analyzing archive contents...
requests-toolbelt 0.3.1 is already the active version in easy-install.pth

Installed /Users/dhalperi/Envs/myria-python2/lib/python2.7/site-packages/requests_toolbelt-0.3.1-py2.7.egg
error: Could not find required distribution requests
</code></pre>

<p>How can I fix this so that the package installs without running setup.py twice?</p>
    </div>
    </div></body></html>