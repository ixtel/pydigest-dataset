<html><body><div><p>Игра Тетрис – одна из самых популярных компьютерных игр. Оригинальная игра была разработана и запрограммирована русским программистом Алексеем Пажитновым в 1985 году. С тех пор, Тетрис доступен на почти каждой компьютерной платформе в множестве вариаций.</p><p>Создание простой компьютерной игры на PyQt5 – отличный способ повышения навыков программирования.</p><p>Тетрисом называется игра-головоломка с падающими блоками. В этой игре, мы имеем 7 разных фигур, называемых так: S-фигура, Z-фигура, T-фигура, L-фигура, фигура-линия, фигура "Г", и квадрат. Каждая из этих фигур формируется с помощью четырёх квадратиков. Фигуры падают вниз на доску. Цель игры Тетрис – перемещать и вращать фигуры так, чтобы их приземлилось как можно больше. Если мы сумеем сформировать ряд, ряд разрушается и мы получаем очки. Мы играем в Тетрис до тех пор, пока не достигнем верха.</p><div class="section" id="id1"><h2>Разработка</h2><p>У нас нет изображений для нашего Тетриса, мы рисуем тетромино, используя доступное в программном инструментарии PyQt5 инструменты <a href="http://pythonworld.ru/gui/pyqt5-painting.html" target="_blank">рисования</a>. У каждой компьютерной игры имеется математическая модель. Также и в Тетрисе.</p><p>Некоторые идеи, применяющиеся в игре:</p><ul><li>Мы используем <i>QtCore.QBasicTimer</i>(), чтобы создать игровой цикл.</li><li>Тетромино рисуются.</li><li>Фигуры перемещаются по принципу "кубик за кубиком" (не "пиксель за пикселем").</li><li>Математически, доска – это просто список чисел.</li></ul><p>Код содержит четыре класса: Tetris, Board, Tetrominoe и Shape. Класс Tetris организовывает игру. Board – это то, где пишется игровая логика. Класс Tetrominoe содержит имена всех частей тетриса и класс Shape содержит код для частей тетриса.</p><p>Код игры Тетрис:</p><pre class="code python3"><span class="ch">#!/usr/bin/python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QFrame</span><span class="p">,</span> <span class="n">QDesktopWidget</span><span class="p">,</span> <span class="n">QApplication</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QBasicTimer</span><span class="p">,</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QPainter</span><span class="p">,</span> <span class="n">QColor</span>


<span class="k">class</span> <span class="nc">Tetris</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tboard</span> <span class="o">=</span> <span class="n">Board</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tboard</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tboard</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statusbar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tboard</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">380</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">'Tetris'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">screen</span> <span class="o">=</span> <span class="n">QDesktopWidget</span><span class="p">()</span><span class="o">.</span><span class="n">screenGeometry</span><span class="p">()</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="n">screen</span><span class="o">.</span><span class="n">width</span><span class="p">()</span><span class="o">-</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="n">screen</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">-</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="n">QFrame</span><span class="p">):</span>

    <span class="n">msg2Statusbar</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">BoardWidth</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">BoardHeight</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">Speed</span> <span class="o">=</span> <span class="mi">300</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initBoard</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">initBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">QBasicTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">StrongFocus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isStarted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearBoard</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">shapeAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[(</span><span class="n">y</span> <span class="o">*</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">setShapeAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[(</span><span class="n">y</span> <span class="o">*</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span>


    <span class="k">def</span> <span class="nf">squareWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentsRect</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">//</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span>


    <span class="k">def</span> <span class="nf">squareHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentsRect</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">//</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span>


    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">isStarted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearBoard</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newPiece</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">Speed</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isStarted</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">"paused"</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">Speed</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">paintEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="n">painter</span> <span class="o">=</span> <span class="n">QPainter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentsRect</span><span class="p">()</span>

        <span class="n">boardTop</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">shape</span> <span class="o">!=</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drawSquare</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span>
                        <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">(),</span>
                        <span class="n">boardTop</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">(),</span> <span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drawSquare</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">(),</span>
                    <span class="n">boardTop</span> <span class="o">+</span> <span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isStarted</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span> <span class="o">==</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_P</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPaused</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Left</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Right</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Down</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">rotateRight</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Up</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">rotateLeft</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Space</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropDown</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_D</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oneLineDown</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">timerEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">timerId</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timerId</span><span class="p">():</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">newPiece</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">oneLineDown</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">timerEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">clearBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">*</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">dropDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">newY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span>

        <span class="k">while</span> <span class="n">newY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span><span class="p">,</span> <span class="n">newY</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">newY</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pieceDropped</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">oneLineDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pieceDropped</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">pieceDropped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setShapeAt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">removeFullLines</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newPiece</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">removeFullLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">numFullLines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">rowsToRemove</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">):</span>

            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">rowsToRemove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">rowsToRemove</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>


        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rowsToRemove</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setShapeAt</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">numFullLines</span> <span class="o">=</span> <span class="n">numFullLines</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">rowsToRemove</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">numFullLines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span> <span class="o">+</span> <span class="n">numFullLines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">setShape</span><span class="p">(</span><span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">newPiece</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">setRandomShape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">minY</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">setShape</span><span class="p">(</span><span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isStarted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">"Game over"</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPiece</span><span class="p">,</span> <span class="n">newX</span><span class="p">,</span> <span class="n">newY</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">newX</span> <span class="o">+</span> <span class="n">newPiece</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">newY</span> <span class="o">-</span> <span class="n">newPiece</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span> <span class="o">=</span> <span class="n">newPiece</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">=</span> <span class="n">newX</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">=</span> <span class="n">newY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span>


    <span class="k">def</span> <span class="nf">drawSquare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">painter</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>

        <span class="n">colorTable</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x000000</span><span class="p">,</span> <span class="mh">0xCC6666</span><span class="p">,</span> <span class="mh">0x66CC66</span><span class="p">,</span> <span class="mh">0x6666CC</span><span class="p">,</span>
                      <span class="mh">0xCCCC66</span><span class="p">,</span> <span class="mh">0xCC66CC</span><span class="p">,</span> <span class="mh">0x66CCCC</span><span class="p">,</span> <span class="mh">0xDAAA00</span><span class="p">]</span>

        <span class="n">color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="n">colorTable</span><span class="p">[</span><span class="n">shape</span><span class="p">])</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">fillRect</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

        <span class="n">painter</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">lighter</span><span class="p">())</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">painter</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">darker</span><span class="p">())</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Tetrominoe</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">NoShape</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ZShape</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SShape</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">LineShape</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">TShape</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">SquareShape</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">LShape</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">MirroredLShape</span> <span class="o">=</span> <span class="mi">7</span>


<span class="k">class</span> <span class="nc">Shape</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">coordsTable</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>   <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">=</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setShape</span><span class="p">(</span><span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span>


    <span class="k">def</span> <span class="nf">setShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">coordsTable</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">=</span> <span class="n">shape</span>


    <span class="k">def</span> <span class="nf">setRandomShape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setShape</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">setX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>


    <span class="k">def</span> <span class="nf">setY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>


    <span class="k">def</span> <span class="nf">minX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">m</span>


    <span class="k">def</span> <span class="nf">maxX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">m</span>


    <span class="k">def</span> <span class="nf">minY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">m</span>


    <span class="k">def</span> <span class="nf">maxY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">m</span>


    <span class="k">def</span> <span class="nf">rotateLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">==</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">SquareShape</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

            <span class="n">result</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="nf">rotateRight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">==</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">SquareShape</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

            <span class="n">result</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
    <span class="n">tetris</span> <span class="o">=</span> <span class="n">Tetris</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span></pre><p>Игра немного упрощена для более легкого понимания. Игра начинается сразу же после её запуска. Мы можем приостановить игру, нажав клавишу p. Клавиша Space будет немедленно бросать блок тетриса вниз. Игра идёт на постоянной скорости, ускорение не реализуется. Очки – это число линий, который мы удалили.</p><pre class="code python3"><span class="bp">self</span><span class="o">.</span><span class="n">tboard</span> <span class="o">=</span> <span class="n">Board</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tboard</span><span class="p">)</span></pre><p>Экземпляр класса Board создаётся и устанавливается центральным виджетом приложения.</p><pre class="code python3"><span class="bp">self</span><span class="o">.</span><span class="n">statusbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">tboard</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statusbar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">)</span></pre><p>Мы создаём <a href="http://pythonworld.ru/gui/pyqt5-menustoolbars.html" target="_blank">строку состояния</a>, где мы будем отображать сообщения. Мы будем отображать три возможных сообщения: количество уже удалённых линий, сообщение паузы, или сообщение «Игра окончена». msgStatusbar – это пользовательский <a href="http://pythonworld.ru/gui/pyqt5-eventssignals.html" target="_blank">сигнал</a>, который реализуется в классе Board. showMessage() – это встроенный метод, который отображает сообщение в строке состояния.</p><pre class="code python3"><span class="bp">self</span><span class="o">.</span><span class="n">tboard</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></pre><p>Эта строка инициирует игру.</p><pre class="code python3"><span class="k">class</span> <span class="nc">Board</span><span class="p">(</span><span class="n">QFrame</span><span class="p">):</span>

    <span class="n">msg2Statusbar</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="o">...</span></pre><p>Создаётся пользовательский сигнал. msgStatusbar – это сигнал, который срабатывает, когда мы хотим написать сообщение или количество очков в строку состояния.</p><pre class="code python3"><span class="n">BoardWidth</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">BoardHeight</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">Speed</span> <span class="o">=</span> <span class="mi">300</span></pre><p>Это переменные класса Board. BoardWidth и BoardHeight определяют размер доски в блоках. Speed определяет скорость игры. Каждые 300 мс будет начинаться цикл новой игры.</p><pre class="code python3"><span class="o">...</span>
<span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">=</span> <span class="mi">0</span>
<span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">=</span> <span class="mi">0</span>
<span class="bp">self</span><span class="o">.</span><span class="n">numLinesRemoved</span> <span class="o">=</span> <span class="mi">0</span>
<span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">...</span></pre><p>В методе initBoard() мы инициализируем несколько важных переменных. Переменная self.board – это список чисел от 0 до 7. Она представляет местоположение различных фигур и оставляет фигуры на доске.</p><pre class="code python3"><span class="k">def</span> <span class="nf">shapeAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[(</span><span class="n">y</span> <span class="o">*</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span></pre><p>Метод shapeAt() определяет тип фигуры в данном блоке.</p><pre class="code python3"><span class="k">def</span> <span class="nf">squareWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentsRect</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">//</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span></pre><p>Доска может динамически менять размер (например, при изменении размера окна). Как следствие, размер блока может меняться. squareWidth() вычисляет ширину простого квадратика в пикселях и возвращает её. Board.BoardWidth – это размер доски в блоках.</p><pre class="code python3"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shape</span> <span class="o">!=</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawSquare</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span>
                <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">(),</span>
                <span class="n">boardTop</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">(),</span> <span class="n">shape</span><span class="p">)</span></pre><p>Рисование игры разделяется на два шага. Первым шагом, мы рисуем все фигуры, или оставляем фигуры, которые были сброшены вниз доски. Все квадратики запоминаются в списке переменных self.board. Доступ к переменной получают, используя метод shapeAt().</p><pre class="code python3"><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawSquare</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareWidth</span><span class="p">(),</span>
            <span class="n">boardTop</span> <span class="o">+</span> <span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">squareHeight</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span></pre><p>Следующий шаг – это рисование упавших вниз частей.</p><pre class="code python3"><span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Right</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">)</span></pre><p>В методе keyPressEvent(), мы проверяем нажатые клавиши. Если мы нажали клавишу правой стрелки, мы пробуем передвинуть часть вправо. Мы говорим "пробуем", поскольку часть может быть на правом крае.</p><pre class="code python3"><span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Up</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">rotateLeft</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">)</span></pre><p>Клавиша стрелки вверх будет поворачивать падающую часть влево.</p><pre class="code python3"><span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_Space</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropDown</span><span class="p">()</span></pre><p>Клавиша «Пробел» будет немедленно бросать падающую часть.</p><pre class="code python3"><span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_D</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">oneLineDown</span><span class="p">()</span></pre><p>Нажимая клавишу «d», часть спустится вниз на один блок. Это может быть использовано, чтобы слегка ускорить падение части.</p><pre class="code python3"><span class="k">def</span> <span class="nf">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPiece</span><span class="p">,</span> <span class="n">newX</span><span class="p">,</span> <span class="n">newY</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">newX</span> <span class="o">+</span> <span class="n">newPiece</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">newY</span> <span class="o">-</span> <span class="n">newPiece</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span> <span class="o">=</span> <span class="n">newPiece</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">=</span> <span class="n">newX</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">=</span> <span class="n">newY</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">True</span></pre><p>В методе tryMove(), мы пробуем переместить наши фигуры. Если фигура находится на краю доски или примыкает к некоторой другой части, мы возвращаем значение "Ложь". В противном случае, мы перемещаем текущую падающую часть в новую позицию.</p><pre class="code python3"><span class="k">def</span> <span class="nf">timerEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">timerId</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timerId</span><span class="p">():</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isWaitingAfterLine</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newPiece</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oneLineDown</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Board</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">timerEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></pre><p>В timerEvent (событии таймера), мы либо создаём новую фигуру после предыдущей, которая упала, либо мы передвигаем падающую часть на одну линию вниз.</p><pre class="code python3"><span class="k">def</span> <span class="nf">clearBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">*</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">)</span></pre><p>Метод clearBoard() очищает доску путём установки Tetrominoe.Noshape на каждый блок доски.</p><pre class="code python3"><span class="k">def</span> <span class="nf">removeFullLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">numFullLines</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rowsToRemove</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">rowsToRemove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">rowsToRemove</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>


    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rowsToRemove</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setShapeAt</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeAt</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">numFullLines</span> <span class="o">=</span> <span class="n">numFullLines</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">rowsToRemove</span><span class="p">)</span>
    <span class="o">...</span></pre><p>Когда фигура падает, мы вызываем метод removeFullLines(). Мы обнаруживаем все полные линии и удаляем их. Обратите внимание, что мы развернули порядок удаляемых линий. В противном случае, это не будет работать правильно. В нашем случае, мы используем "никакую" гравитацию. Это означает, что части могут парить над пустыми промежутками.</p><pre class="code python3"><span class="k">def</span> <span class="nf">newPiece</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">setRandomShape</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curX</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardWidth</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curY</span> <span class="o">=</span> <span class="n">Board</span><span class="o">.</span><span class="n">BoardHeight</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">minY</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tryMove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curY</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">curPiece</span><span class="o">.</span><span class="n">setShape</span><span class="p">(</span><span class="n">Tetrominoe</span><span class="o">.</span><span class="n">NoShape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isStarted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg2Statusbar</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">"Game over"</span><span class="p">)</span></pre><p>Метод newPiece() случайным образом создаёт новую часть тетриса. Если часть не может прийти в свою начальную позицию, игра заканчивается.</p><pre class="code python3"><span class="k">class</span> <span class="nc">Tetrominoe</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">NoShape</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ZShape</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SShape</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">LineShape</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">TShape</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">SquareShape</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">LShape</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">MirroredLShape</span> <span class="o">=</span> <span class="mi">7</span></pre><p>Класс Tetrominoe содержит в себе имена всех возможных фигур. Мы также имеем NoShape для пустого пространства.</p><pre class="code python3"><span class="k">class</span> <span class="nc">Shape</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">coordsTable</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="o">...</span>
    <span class="p">)</span>
    <span class="o">...</span></pre><p>Класс Shape хранит информацию о частях тетриса.</p><p>Набор coordsTable содержит в себе всевозможные значения координат наших частей тетриса. Это шаблон, из которого все части берут свои значения координат.</p><p>self.coords = [[0,0] for i in range(4)]</p><p>После создания, мы создаём пустой список координат. Список будет хранить координаты частей тетриса.</p><p><img alt="Координаты" src="/uploads/gui/pyqt5/coordinates.png"/></p><p>Изображение выше поможет понять значения координат. Для примера, набор (0, -1), (0, 0), (-1, 0), (-1, -1) представляет S-фигуру. Схема иллюстрирует фигуру.</p><pre class="code python3"><span class="k">def</span> <span class="nf">rotateLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">==</span> <span class="n">Tetrominoe</span><span class="o">.</span><span class="n">SquareShape</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">()</span>
    <span class="n">result</span><span class="o">.</span><span class="n">pieceShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pieceShape</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

        <span class="n">result</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span></pre><p>Метод rotateLeft() поворачивает часть влево. Квадрат не должен поворачиваться. Вот почему мы просто возвращаем ссылку на текущий объект. Новая часть создаётся и её координаты устанавливаются в одну из повернутых частей.</p><p><img alt="Тетрис" src="/uploads/gui/pyqt5/tetris.png"/></p><p>Это была игра Тетрис в PyQt5 (а также перевод последней части туториала от zetcode).</p></div></div></body></html>