<html><body><div><p>uModbus or (μModbus) is a pure Python implementation of the Modbus protocol as
described in the <a href="http://modbus.org/docs/Modbus_Application_Protocol_V1_1b3.pdf" rel="nofollow">MODBUS Application Protocol Specification V1.1b3</a>. uModbus
implements both a Modbus client (or master in Modbus language) and a Modbus
server (or slave). The “u” or “μ” in the name comes from the the SI prefix
“micro-“. uModbus is very small and lightweight. The source can be found on
<a href="https://github.com/AdvancedClimateSystems/uModbus/" rel="nofollow">GitHub</a>. Documentation is available at <a href="http://umodbus.readthedocs.org/en/latest/" rel="nofollow">Read the Docs</a>.</p>
<div id="quickstart">
<h3>Quickstart</h3>
<p>Creating a Modbus server is easy:</p>
<pre><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># scripts/examples/simple_data_store.py</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">socketserver</span> <span class="kn">import</span> <span class="n">TCPServer</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">from</span> <span class="nn">umodbus</span> <span class="kn">import</span> <span class="n">get_server</span><span class="p">,</span> <span class="n">RequestHandler</span><span class="p">,</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">umodbus.utils</span> <span class="kn">import</span> <span class="n">log_to_stream</span>

<span class="c1"># Add stream handler to logger 'uModbus'.</span>
<span class="n">log_to_stream</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># A very simple data store which maps addresss against their values.</span>
<span class="n">data_store</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Enable values to be signed (default is False).</span>
<span class="n">conf</span><span class="o">.</span><span class="n">SIGNED_VALUES</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">TCPServer</span><span class="o">.</span><span class="n">allow_reuse_address</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">get_server</span><span class="p">(</span><span class="n">TCPServer</span><span class="p">,</span> <span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">502</span><span class="p">),</span> <span class="n">RequestHandler</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="n">slave_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">function_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">addresses</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">read_data_store</span><span class="p">(</span><span class="n">slave_id</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
    <span class="sd">"""" Return value of address. """</span>
    <span class="k">return</span> <span class="n">data_store</span><span class="p">[</span><span class="n">address</span><span class="p">]</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="n">slave_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">function_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span> <span class="n">addresses</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">write_data_store</span><span class="p">(</span><span class="n">slave_id</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""" Set value for address. """</span>
    <span class="n">data_store</span><span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">server_close</span><span class="p">()</span>
</pre>
<p>Doing a Modbus request requires even less code:</p>
<pre><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># scripts/examples/simple_client.py</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">from</span> <span class="nn">umodbus</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">umodbus.client</span> <span class="kn">import</span> <span class="n">tcp</span>

<span class="c1"># Enable values to be signed (default is False).</span>
<span class="n">conf</span><span class="o">.</span><span class="n">SIGNED_VALUES</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">502</span><span class="p">))</span>

<span class="c1"># Returns a message or Application Data Unit (ADU) specific for doing</span>
<span class="c1"># Modbus TCP/IP.</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">tcp</span><span class="o">.</span><span class="n">write_multiple_coils</span><span class="p">(</span><span class="n">slave_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># Response depends on Modbus function code. This particular returns the</span>
<span class="c1"># amount of coils written, in this case it isr3.</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">tcp</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>

<span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
</div>
</div></body></html>