<html><body><div><div class="entry-content">
		<p>I was using <a href="https://github.com/ansible/ansible">Ansible</a> to set up a bunch of <a href="https://www.scientificlinux.org/">Scientific Linux 6.6</a> servers running <a href="https://www.djangoproject.com/">Django</a> and I wanted to use a specific version of Django, version 1.6.5, on all servers.</p>
<p>Ansible makes this easy with the “pip” module:</p>
<pre>  - name: Install pip package from yum
    yum: name={{ item }} state=present
    with_items:
    - python-pip
    - python-setuptools

  - name: Install Django 1.6.5
    pip: name=django version=1.6.5 state=present</pre>
<p>This works great if you’re installing on a clean, empty server, but if you’re upgrading a server that had an older version of Django on it (1.6.4 in my case) Ansible will act as if it’s installing 1.6.5, but when it’s done I still had version 1.6.4.</p>
<p>If I try using straight PIP commands I get this:</p>
<pre>$ pip install django==1.6.5
Downloading/unpacking django==1.6.5
  Running setup.py egg_info for package django
    warning: no previously-included files matching '__pycache__' found under directory '*'
    warning: no previously-included files matching '*.py[co]' found under directory '*'
  Requested django==1.6.5, but installing version 1.6.4
Installing collected packages: django
  Found existing installation: Django 1.6.4
    Uninstalling Django:
      Successfully uninstalled Django
  Running setup.py install for django
    warning: no previously-included files matching '__pycache__' found under directory '*'
    warning: no previously-included files matching '*.py[co]' found under directory '*'
    changing mode of /usr/bin/django-admin.py to 755
Successfully installed django
Cleaning up...</pre>
<p>Note the line “Requested django==1.6.5, but installing version 1.6.4”. Thanks PIP! </p>
<p>It turned out to be a bug in PIP versions earlier than PIP 1.4, not Ansible. A little Googling turned up a page on <a href="http://stackoverflow.com/questions/14617136/why-is-pip-installing-an-old-version-of-my-package">Stackoverflow</a> that pointed the finger at an old cached copy of 1.6.4 in the build directory, which I found in /tmp/pip-build-root.</p>
<p>I updated my Ansible YAML file to get rid of the temporary directory and now it works fine:</p>
<pre>  - name: Install pip package from yum
    yum: name={{ item }} state=present
    with_items:
    - python-pip
    - python-setuptools

  - name: Remove PIP temp directory
    file: path=/tmp/pip-build-root state=absent

  - name: Install Django 1.6.5
    pip: name=django version=1.6.5 state=present</pre>
<p>Hope you find this useful.</p>
<a href="https://twitter.com/earlruby" class="twitter-follow-button" data-show-count="false" data-size="small">Follow earlruby</a>
			</div>
	
	</div></body></html>