<html><body><div><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-1"><span class="crayon-s">''</span><span class="crayon-s">'</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-2"><span class="crayon-s">Implements one form of delayed assertions.</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-3"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-4"><span class="crayon-s">Interface is 2 functions:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-5"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-6"><span class="crayon-s">  expect(expr, msg=None)  </span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-7"><span class="crayon-s">  : Evaluate '</span><span class="crayon-i">expr</span><span class="crayon-s">' as a boolean, and keeps track of failures</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-8"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-9"><span class="crayon-s">  assert_expectations()        </span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-10"><span class="crayon-s">  : raises an assert if an expect() calls failed  </span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-11"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-12"><span class="crayon-s">Usage Example:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-13"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-14"><span class="crayon-s">    from expectations import expect, assert_expectations</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-15"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-16"><span class="crayon-s">    def test_should_pass():</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-17"><span class="crayon-s">        expect(1 == 1, '</span><span class="crayon-e">one </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">one</span><span class="crayon-s">')</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-18"><span class="crayon-s">        assert_expectations()</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-19"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-20"><span class="crayon-s">    def test_should_fail():</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-21"><span class="crayon-s">        expect(1 == 2, '</span><span class="crayon-e">one </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">two</span><span class="crayon-s">')</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-22"><span class="crayon-s">        expect(1 == 3, '</span><span class="crayon-e">one </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">three</span><span class="crayon-s">')</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-23"><span class="crayon-s">        assert_expectations() </span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-24"><span class="crayon-s">'</span><span class="crayon-s">''</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-25"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-26"><span class="crayon-p"># ---------------------------------------------------</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-27"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-28"><span class="crayon-e">def </span><span class="crayon-e">expect</span><span class="crayon-sy">(</span><span class="crayon-v">expr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-29"><span class="crayon-h">    </span><span class="crayon-s">'keeps track of failed expectations'</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-30"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">expr</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-31"><span class="crayon-h">        </span><span class="crayon-e">_log_failure</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-32"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-33"><span class="crayon-e">def </span><span class="crayon-e">assert_expectations</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-34"><span class="crayon-h">    </span><span class="crayon-s">'raise an assert if there are any failed expectations'</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-35"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">_failed_expectations</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-36"><span class="crayon-h">        </span><span class="crayon-st">assert</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">_report_failures</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-37"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-38"><span class="crayon-p"># ---------------------------------------------------</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-39"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-40"><span class="crayon-e">import </span><span class="crayon-e">inspect</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-41"><span class="crayon-e">import </span><span class="crayon-v">os</span><span class="crayon-sy">.</span><span class="crayon-e">path</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-42"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-43"><span class="crayon-v">_failed_expectations</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-44"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-45"><span class="crayon-e">def </span><span class="crayon-e">_log_failure</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-o">=</span><span class="crayon-v">None</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-46"><span class="crayon-h">    </span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">funcname</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">contextlist</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">  </span><span class="crayon-v">inspect</span><span class="crayon-sy">.</span><span class="crayon-e">stack</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-47"><span class="crayon-h">    </span><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">os</span><span class="crayon-sy">.</span><span class="crayon-v">path</span><span class="crayon-sy">.</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-48"><span class="crayon-h">    </span><span class="crayon-v">context</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">contextlist</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-49"><span class="crayon-h">    </span><span class="crayon-v">_failed_expectations</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">'file "%s", line %s, in %s()%s\n%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-50"><span class="crayon-h">        </span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">funcname</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'\n%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">msg </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">context</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-51"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-52"><span class="crayon-e">def </span><span class="crayon-e">_report_failures</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-53"><span class="crayon-h">    </span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-e">_failed_expectations</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-54"><span class="crayon-e">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">_failed_expectations</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-55"><span class="crayon-h">        </span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">funcname</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">  </span><span class="crayon-v">inspect</span><span class="crayon-sy">.</span><span class="crayon-e">stack</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-56"><span class="crayon-h">        </span><span class="crayon-v">report</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-57"><span class="crayon-h">            </span><span class="crayon-s">'\n\nassert_expectations() called from'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-58"><span class="crayon-h">            </span><span class="crayon-s">'"%s" line %s, in %s()\n'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">os</span><span class="crayon-sy">.</span><span class="crayon-v">path</span><span class="crayon-sy">.</span><span class="crayon-e">basename</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">funcname</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-59"><span class="crayon-h">            </span><span class="crayon-s">'Failed Expectations:%s\n'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">_failed_expectations</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-60"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-e">failure </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">_failed_expectations</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-61"><span class="crayon-h">            </span><span class="crayon-v">report</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">'%d: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">failure</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-62"><span class="crayon-h">        </span><span class="crayon-v">_failed_expectations</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-63"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'\n'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">report</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-64"> </p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-65"><span class="crayon-p"># ---------------------------------------------------</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-66"><span class="crayon-p"># _log_failure() notes</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-67"><span class="crayon-p">#</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-68"><span class="crayon-p"># stack() returns a list of frame records</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-69"><span class="crayon-p">#   0 is the _log_failure() function</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-70"><span class="crayon-p">#   1 is the expect() function </span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-71"><span class="crayon-p">#   2 is the function that called expect(), that's what we want</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-72"><span class="crayon-p">#</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-73"><span class="crayon-p"># a frame record is a tuple like this:</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-74"><span class="crayon-p">#   (frame, filename, line, funcname, contextlist, index)</span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-75"><span class="crayon-p"># we're mainly interested in the middle 4, </span></p><p class="crayon-line" id="crayon-56d5aa675ff3f430228432-76"><span class="crayon-p"># ---------------------------------------------------</span></p></div></div></body></html>