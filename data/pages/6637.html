<html><body><div><div class="post-text" itemprop="text">
<p>First of all, it is not a bug but a feature <a href="https://docs.python.org/2/library/re.html#regular-expression-syntax" rel="nofollow">well documented in the docs</a>:</p>

<blockquote>
  <p><strong>[]</strong></p>
  
  <p>Used to indicate a set of characters. In a set:</p>
  
  <p>Ranges of characters can be indicated by giving two characters and separating them by a '-', for example [a-z] will match any lowercase ASCII letter, [0-5][0-9] will match all the two-digits numbers from 00 to 59, and [0-9A-Fa-f] will match any hexadecimal digit. <strong>If - is escaped (e.g. [a-z]) or if itâ€™s placed as the first or last character (e.g. [a-]), it will match a literal '-'</strong>.</p>
</blockquote>

<p>So, using <code>-</code> between two literals will evaluate that regex as a character range:</p>

<pre><code>re.compile("[a-0]+")
&gt;&gt; error: bad character range
re.findall("[.-_]+", "asdasd-asdasdad._?asdasd-")
&gt;&gt; ['._?']
</code></pre>

<p>As you see, python will always interperet <code>-</code> as a range indicator when used between characters in character sets. </p>

<p>As it is (also) stated in the docs, avoiding a range declaration is done by escaping the <code>-</code> with <code>\-</code> or placing it as the first or the last literal in the character set <code>[]</code></p>

<p>If you want to capture that character range including <code>-</code>, then try:</p>

<pre><code>re.findall("[.-_\-]+", "asdasd-asdasdad._?asdasd-")
&gt;&gt; ['-', '._?', '-']
</code></pre>

<p><em>Note:</em> <code>\w</code> is equal to <code>[a-zA-Z0-9_]</code> when LOCALE and UNICODE flags are not set. So you do not need to declare <code>_</code> again</p>

<p>And in your situation:</p>

<pre><code>url(r'^user/(?P&lt;username&gt;[-.\w]+)/foo', 'myapp.views.foo')
url(r'^user/(?P&lt;username&gt;[.\w-]+)/foo', 'myapp.views.foo')
url(r'^user/(?P&lt;username&gt;[.\-\w]+)/foo', 'myapp.views.foo')
</code></pre>

<p>Beyond the <code>-</code> usage, if you are using default Django Username styling, then @navneet35371 is right about the valid character set. You may alter your regex character set to include <code>@</code> and <code>+</code> and use </p>

<pre><code>url(r'^user/(?P&lt;username&gt;[\w.@+-]+)/foo', 'myapp.views.foo')
</code></pre>
    </div>
    </div></body></html>