<html><body><div><div class="all_external_links">
          <p>Discrete events pervade our daily lives. These include phone calls, online transactions, and heartbeats. Despite the simplicity of discrete event data, it’s hard to visualize many events over a long time period without hiding details about shorter timescales.</p>

<p>The plot below illustrates this problem. It shows the number of website visits made by a certain IP address over the course of 7 months. It was built from discrete event data. The height of each bar is the number of events that occurred in each time bin.</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/45e212e8-e3fa-456b-b1d4-c2f0fe58378d/bot_histo_N_medium.png"/></p>

<p>While the plot displays the overall behavior, details about the timing of events within each time bin are completely lost. One can always zoom into a certain portion of the histogram and re-bin the data, but what zoom level should we choose, and what timespan should we examine? For example, if we want to zoom into individual days, we would have roughly 210 days to look at. Searching for patterns and outliers at various zoom levels would be very time consuming.</p>

<p>In this blog post, I’ll describe a technique for visualizing many events across multiple timescales in a single image, where little or no zooming is required. It allows the viewer to quickly identify critical features, whether they occur on a timescale of milliseconds or months. It is adopted from the field of chaotic systems, and was originally conceived to study the timing of water drops from a <a href="http://amzn.to/1JKcRtu">dripping faucet.</a> The visualization has gone by various names: return map, return-time map, and time vs. time plot. For conciseness, I will call them “time maps.” Though time maps have been used to visualize chaotic systems, they have not been applied to information technology. I will show how time maps can provide valuable insights into the behavior of Twitter accounts and the activity of a certain type of online entity, known as a bot.</p>

<p>This blog post is a shorter version of a <a href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=7363824">paper</a> I recently wrote, but with slightly different examples. The paper was accepted to the <a href="http://cci.drexel.edu/bigdata/bigdata2015/">2015 IEEE Big Data Conference</a>. The end of the blog also contains sample Python code for creating time maps.</p>

<p>Building a time map is easy. First, imagine a series of events as dots along a time axis. The time intervals between each event are labeled as t1, t2, t3, t4, ...</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/1d49f6bc-2830-4398-a2ca-67b89cfd462a/build1_N_medium.png"/></p>

<p>A time map is simply a two-dimensional scatterplot, where the xy coordinates of the events are: (t1,t2), (t2, t3), (t3, t4), and so on. On a time map, the purple dot would be plotted like this:</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/89fd96ce-a5f7-4235-966b-9f0a01d731e4/build2_N_medium.png"/></p>

<p>In other words, each point in the scatterplot represents an event. The x-coordinate of an event is the time between the event itself and the preceding event. An event’s y-coordinate is the time between the event itself and the subsequent event. The only points that are not displayed in a time map are the first and last events of the dataset.</p>

<p>Below are two simple examples:</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/b23572a7-fe5f-4be0-a384-c356a204ee7b/time_map_cases_N_medium.png"/></p>

<p>For the sequence of evenly spaced events (A), the time map is effectively a single point, since the xy coordinates of the events are all identical. Sequence B is the same as A, except the timing of one event is slightly shifted. The resulting time map consists of effectively 4 points, making the shift easy to notice. Unless a very small bin size is chosen, the histogram over time for the two sequences would be exactly the same, concealing the changes in timing.</p>

<p>To get a more intuitive feel for time maps, here’s a heuristic diagram, which is divided into quadrants:</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/67209e8c-aa87-4e94-9948-dc33954b4fe8/quadrants_N_medium.png"/></p>

<p>Within each quadrant is a picture of events along a time axis. The upper-right and lower-left quadrants contain events that are equally spaced between preceding and subsequent events. So both of these quadrants are “steady.” Since there is less time between events in the lower-left quadrant, it’s called “fast and steady.” The upper-right has more time between events, so it’s “slow and steady.” In the lower-right, an event occurs, there is a long waiting time, and then two events happen in rapid succession. So that process is “speeding up.” In the upper-left, two events quickly occur, followed by a long waiting time. In this case, the events are “slowing-down.” Viewing a time map is a bit like reading a map of a new city. While unfamiliar at first, it eventually becomes second nature.</p>

<p>The beauty of time maps is that long timelines are no longer an issue, since only the times between events are plotted. In cases where inter-event timing varies by orders of magnitude, we can scale the axes <a href="https://en.wikipedia.org/wiki/Logarithmic_scale">logarithmically.</a> This allows the viewer to see time intervals that range from milliseconds to months in a single picture. Let's see some real-world examples!</p>

<h2 id="toc_0">@WhiteHouse Tweets</h2>

<p>Twitter API allows you to gather the 3,200 most recent tweets written by a user. Using <a href="http://www.pythoncentral.io/how-to-use-the-twython-twitter-python-library/">Twython</a>, I downloaded  <a href="https://twitter.com/WhiteHouse">tweets</a> from the @WhiteHouse, which are mostly written by the president's staff. Here is the time map for tweets written between January and September 2015:</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/ef1d7277-8022-448c-aac5-1a68bf830fde/obama_pts_N_large.png"/></p>

<p>Each tweet is color-coded based on the time of day, and the time axes are scaled logarithmically. Two clusters correspond to the beginning and end of the workday, at least in terms of tweets. The first tweet of the day usually occurs between 9 AM and noon. The last tweet of the day can take place over a much wider time window.</p>

<p>Interestingly, there are two clusters that represent different modes of behavior. In the cluster I call “business as usual”, tweets are written roughly once per hour. The tweets in the lower left occur in rapid succession, and correspond to major events. </p>

<p>Since it’s hard to count the number of points in each cluster, a “heated time map” can be useful to show higher densities of points in red.</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/9bda6696-5f79-4d32-aa77-e545d36629a9/obama_heat_N_medium.png"/></p>

<p>In a heated time map, we can still see isolated points. The added benefit is that we can also see densities when points are close together. It looks like the “business as usual” cluster has the most tweets, which justifies calling it “usual.”</p>

<h2 id="toc_1">Tweets from a personal account</h2>

<p>A public relations staff manages the Twitter account of the @WhiteHouse. What do the tweets from a personal Twitter account look like? <a href="http://feltron.com/">Nicholas Felton</a> is a graphic designer who specializes in information visualization. His work includes <a href="http://feltron.com/FAR13.html">annual reports</a> that compile graphics based on data about his life. Below is a heated time map of his <a href="https://twitter.com/feltron">tweets:</a></p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/32eaa220-8995-4d8c-9e96-dc539d423145/feltron_heat_medium.jpg"/></p>

<p>It does not contain the distinct clusters exhibited by the @WhiteHouse. Unlike a public relations account, tweets from personal accounts often do not adhere to a strict schedule. However, the time map still captures overall trends. Many tweets are written before and following 24-hour lulls. Also, a large number of points follow a “slow and steady” pattern, in which tweets are written roughly once per day.</p>

<h2 id="toc_2">Internet bot</h2>

<p>Internet bots are computer programs that execute automated tasks on the web. Bots are<br/>
unwittingly installed on millions of personal computers when users click on certain links. A bot could even be operating from your computer as you read this sentence! I analyzed data from a company that provides monitoring services for various websites. This brings us back to the plot shown at the beginning of this blog:</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/45e212e8-e3fa-456b-b1d4-c2f0fe58378d/bot_histo_N_medium.png"/></p>

<p>It shows the number of website visits originating from a specific IP address (this IP address is different from the IP examined in my <a href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=7363824">paper</a>). While the histogram does contain important information about overall behavior, here is what the time map reveals:</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/e05842d7-d312-4b5b-8161-1521ca02d4ed/bot_pts_labels_N_medium.png"/></p>

<p>These patterns of activity cannot be achieved by a mere mortal. A few prominent features immediately jump out: a block of “fast and steady” points, bars of points that correspond to “speeding up” and “slowing down,” and finally, some sparse points beyond them.</p>

<p>The sparse points in the lower-right and upper-left represent long dormant periods between high levels of activity. This is consistent with the long gaps seen in the histogram. The bars of points correspond to 8-minute lulls between bursts of rapid activity. The bursts themselves are represented by the large block in the lower left, in which websites are visited in quick succession. The presence of bursts can be confirmed by examining an extremely zoomed-in histogram of the data:</p>

<p><img alt="Silvrback blog image" src="https://silvrback.s3.amazonaws.com/uploads/d01a1faf-ba8b-48ed-8b89-ecfd50563147/bot_histo_zoom_N_medium.png"/></p>

<p>Just as expected, there are bursts of activity separated by roughly 8-minute lulls. Though the information contained in the zoomed in histogram is consistent with the time map, who would have thought to zoom in at this level?! The time map immediately revealed the bot’s regular bursting behavior, and unlike the histogram, no zooming was needed.</p>

<h2 id="toc_3">Creating Time Maps with Python</h2>

<p>Below is a simple Python program for creating a time map. It's based on randomly generated data.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c"># a sample array containing the timings of events in order: [1, 2.1, 2.9, 3.1...]</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)))</span>

<span class="c"># calculate time differences:</span>
<span class="n">diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">))])</span>

<span class="n">xcoords</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c"># all differences except the last</span>
<span class="n">ycoords</span> <span class="o">=</span> <span class="n">diffs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c"># all differences except the first</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xcoords</span><span class="p">,</span> <span class="n">ycoords</span><span class="p">,</span> <span class="s">'b.'</span><span class="p">)</span> <span class="c"># make scatter plot with blue dots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<p>Now let's create a heated time map. It builds off the program from above. Basically, a two-dimensional histogram is made, which counts the number of events within each grid-square of the time map. The histogram is treated like an image. <a href="https://en.wikipedia.org/wiki/Gaussian_blur">Gaussian blur</a> is then applied to the image, which smoothens out abrupt changes.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="kn">as</span> <span class="nn">ndi</span>

<span class="n">Nside</span><span class="o">=</span><span class="mi">256</span> <span class="c"># this is the number of bins along x and y for the histogram</span>
<span class="n">width</span><span class="o">=</span><span class="mi">8</span> <span class="c"># the width of the Gaussian function along x and y when applying the blur operation</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nside</span><span class="p">,</span><span class="n">Nside</span><span class="p">))</span> <span class="c"># a 'histogram' matrix that counts the number of points in each grid-square</span>

<span class="n">max_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span> <span class="c"># maximum time difference</span>

<span class="n">x_heat</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nside</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xcoords</span><span class="o">/</span><span class="n">max_diff</span> <span class="c"># the xy coordinates scaled to the size of the matrix</span>
<span class="n">y_heat</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nside</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ycoords</span><span class="o">/</span><span class="n">max_diff</span> <span class="c"># subtract 1 since Python starts counting at 0, unlike Fortran and R</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xcoords</span><span class="p">)):</span> <span class="c"># loop over all points to calculate the population of each bin</span>
    <span class="n">H</span><span class="p">[</span><span class="n">x_heat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_heat</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># Increase count by 1</span>
    <span class="c">#here, the integer part of x/y_heat[i] is automatically taken</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">width</span><span class="p">)</span> <span class="c"># apply Gaussian blur</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="c"># so that the orientation is the same as the scatter plot</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">'lower'</span><span class="p">)</span> <span class="c"># display H as an image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<p>Python files for downloading tweets and creating time maps can also be found on my <a href="https://github.com/maxcw/time-maps">github page</a>.</p>

<h2 id="toc_4">Conclusion</h2>

<p>I’ve given three examples that demonstrate the exploratory value of time maps. In<br/>
all cases, they immediately revealed underlying patterns which would be extremely time-consuming to discover with histograms. Nevertheless, time maps certainly do not replace other time visualizations; they augment them. The best visual explorations will involve time maps and other graphics as well. For instance, both the time map and the histogram display important aspects of the data, and should be used in concert with each other.</p>

<p>Picasso captured the full extent of an object by displaying it from <a href="http://www.visual-arts-cork.com/history-of-art/analytical-cubism.htm#perspective">multiple perspectives</a><br/>
within the same painting. Similarly, time maps distill a dataset across multiple timescales within a single image. Given their easy implementation and ability to reveal hidden structure, time maps should become an invaluable tool in our increasingly data-driven world.</p>

<p>If you found this post useful, please go to the <a href="http://districtdatalabs.silvrback.com/">blog home page</a> and click the <strong>Subscribe</strong> button so that you don't miss any of our future content. And if you decide to create time maps of your own, make sure to share them on Twitter using the hashtag #time_map_viz</p>

<h2 id="toc_5">Additional Readings</h2>



        </div>
        </div></body></html>