<html><body><div><div class="post-text" itemprop="text">

<p>Factory Boy deprecated set_creation_function (see <a href="http://factoryboy.readthedocs.org/en/latest/changelog.html">ChangeLog 2.6.1</a>) and recommends that developers </p>

<blockquote>
  <p>Replace factory.set_creation_function(SomeFactory, creation_function)
  with an override of the _create() method of SomeFactory</p>
</blockquote>

<p>I have i) a number of derivative factory classes and ii) my db session instantiated in another module so I tried replacing the working example from <a href="https://github.com/mattupstate/overholt">https://github.com/mattupstate/overholt</a> with the second code block below. PyCharm is warning me that the "db" import is not being used, so I suspect it might not be being dereferenced properly when I set <a href="http://factoryboy.readthedocs.org/en/latest/orms.html#factory.alchemy.SQLAlchemyOptions.sqlalchemy_session">sqlalchemy_session</a>? </p>

<h3>Working with nosetests 1.3.7 (but FactoryBoy's set_creation_function is now deprecated):</h3>

<pre><code>from myapp.core import db

def create_sqlalchemy_model_function(class_to_create, *args, **kwargs):
    entity = class_to_create(**kwargs)
    db.session.add(entity)
    db.session.commit()
    return entity

Factory.set_creation_function(create_sqlalchemy_model_function)
</code></pre>

<h3>Not working with nosetests 2.x  (looking like db is not being referenced properly?)</h3>

<pre><code>from factory.alchemy import SQLAlchemyModelFactory as Factory
from myapp.core import db

class Factory():
    class Meta:
        sqlalchemy_session = db.session

    def _create(cls, model_class, *args, **kwargs):
        entity = model_class(*args, **kwargs)
        db.session.add(entity)
        db.session.commit()
        return entity
</code></pre>
    </div>
    </div></body></html>