<html><body><div><div class="post-content">
            <img class="post-hero-image" src="/blog/content/images/2015/04/python-script.png" alt="Verify Shipping Addresses in Python for Free"/>
            <p>So you've got a huge spreadsheet full of addresses that you need to verify before using. Don't worry, I've got you covered. Today I'm going to walk you through how to use a simple Python script and Lob's <a href="https://lob.com/verification/address">Shipping Address Verification API</a> to validate, cleanse, and remove invalid addresses. We will be taking a standard, comma separated CSV as the input file. We'll then output a CSV with the valid addresses and another with the invalid addresses. The API is free to use for domestic address validation and only $0.15/address for international addresses.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>Minimal Python experience. Don't worry if you don't know Python that well. This is a super simple script.</li>
<li>CSV (Comma Separated Values) file containing the mailing addresses you want to verify.</li>
<li>A Lob API Key. <a href="https://dashboard.lob.com/#/register">Sign up</a> for free if you don't have one already.</li>
</ul>

<h2 id="thecode">The Code</h2>

<p>If you're the type who doesn't like to read the directions, then go ahead and create a file called <code>verify.py</code> with the code below and start verifying your addresses. Otherwise keep reading for a step by step breakdown.</p>

<blockquote>
  <p>Check out the <a href="https://lob.com/docs#verify">full documentation</a> on how to <a href="https://lob.com/verification/address">verify addresses</a> for more details and options. Also, this example is available in our <a href="https://github.com/lob/lob-python/tree/master/examples">Python GitHub Repository</a> for you to download and tweak.</p>
</blockquote>

<pre><code class="language-python"># Usage
# python verify.py input.csv

import lob  
import csv  
import sys

lob.api_key = 'test_0dc8d51e0acffcb1880e0f19c79b2f5b0cc'

skipFirstLine  = True

# Column indices in CSV
address1    = 0;  
address2    = 1;  
city        = 2;  
state       = 3;  
postcode    = 4;  
country     = 'US'

try:  
  sys.argv[1]
except IndexError:  
  print "Please provide an input CSV file as an argument."
  sys.exit()

# Open input files
inputFile = open(sys.argv[1], 'rU')  
csvInput = csv.reader(inputFile)

# Create output files
errors = open('errors.csv', 'w')  
verified = open('verified.csv', 'w')

# Loop through input CSV rows
for idx, row in enumerate(csvInput):  
  if skipFirstLine and idx == 0:
    continue

  # Sanity check
  sys.stdout.write('.')
  sys.stdout.flush()

  try:
    verifiedAddress = lob.Verification.create(
      address_line1 = row[address1],
      address_line2 = row[address2],
      address_city = row[city],
      address_state = row[state],
      address_zip = row[postcode],
      address_country = country
    )
  except Exception, e:
    outputRow = ",".join(row) + "," + str(e)+ "\n"
    errors.write(outputRow)
  else:
    outputRow = verifiedAddress.address.address_line1 + ","
    outputRow += verifiedAddress.address.address_line2 + ","
    outputRow += verifiedAddress.address.address_city + ","
    outputRow += verifiedAddress.address.address_state + ","
    outputRow += verifiedAddress.address.address_zip + "\n"
    verified.write(outputRow)

errors.close()  
verified.close()  
print "\n"  
</code></pre>

<h2 id="gettingstarted">Getting Started</h2>

<p>The first thing that we need to do is install the Python Wrapper for the Address Verification API. You can use <code>pip</code> or <code>easy_install</code> for installing the package.</p>

<pre><code class="language-markup">pip install lob  
easy_install lob  
</code></pre>

<p>Once this is done, go ahead and create a file called <code>verify.py</code> and paste in the code from above.</p>

<h2 id="thesetup">The Setup</h2>

<p>Next, we need to import our required libraries, including the Lob wrapper we just installed. Make sure to set your API key here with the one provided when you signed up. </p>

<pre><code class="language-python">import lob  
import csv  
import sys

lob.api_key = 'test_0dc8d51e0acffcb1880e0f19c79b2f5b0cc'  
</code></pre>

<p>Here is where we map the address components to the columns in our spreadsheet. You will most likely need to change these to match your address spreadsheet. Remember that the first column in your spreadsheet will be column 0.</p>

<pre><code class="language-python"># Column indices in CSV
address1    = 0;  
address2    = 1;  
city        = 2;  
state       = 3;  
postcode    = 4;  
country     = 'US'  
</code></pre>

<p>Open up the input CSV spreadsheet for reading: </p>

<pre><code class="language-python"># Open input files
inputFile = open(sys.argv[1], 'rU')  
csvInput = csv.reader(inputFile)  
</code></pre>

<p>Now we open up two output CSV files for writing. One for the succesfully verified addresses, and one for the errors we might get. </p>

<pre><code class="language-python"># Create Output Files
errors = open('errors.csv', 'w')  
verified = open('verified.csv', 'w')  
</code></pre>

<h2 id="theloop">The Loop</h2>

<p>This portion takes the input file and iterates through each row in the spreadsheet. </p>

<pre><code class="language-python"># Loop Through input CSV rows
for idx, row in enumerate(csvInput):  
  if skipFirstLine and idx == 0:
    continue
</code></pre>

<h2 id="verifyingtheaddress">Verifying the Address</h2>

<p>Here is where all the magic happens. For each row in the spreadsheet, we make a call to the Address Verification API inside a try block. </p>

<pre><code class="language-python">  try:
    verifiedAddress = lob.Verification.create(
      address_line1 = row[address1],
      address_line2 = row[address2],
      address_city = row[city],
      address_state = row[state],
      address_zip = row[postcode],
      address_country = country
    )
</code></pre>

<p>If the address verifcation throws an error, we will catch it and write it to our <code>errors.csv</code> file.</p>

<pre><code class="language-python">  except Exception, e:
    outputRow = ",".join(row) + "," + str(e)+ "\n"
    errors.write(outputRow)
</code></pre>

<p>Otherwise, if the mailing address is valid, we will write the cleansed address to the <code>verified.csv</code> file.</p>

<pre><code class="language-python">  else:
    outputRow = verifiedAddress.address.address_line1 + ","
    outputRow += verifiedAddress.address.address_line2 + ","
    outputRow += verifiedAddress.address.address_city + ","
    outputRow += verifiedAddress.address.address_state + ","
    outputRow += verifiedAddress.address.address_zip + "\n"
    verified.write(outputRow)
</code></pre>

<h2 id="usage">Usage</h2>

<p>To run the Python script do the following from your terminal:</p>

<pre><code class="language-bash">python verify.py &lt;/path/to/input/file.csv&gt;  
</code></pre>

<p>If everything was setup correctly, you should now see your verified shipping addresses in the output files. </p>
        </div>

        </div></body></html>