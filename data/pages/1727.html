<html><body><div><div class="post-body entry-content" id="post-body-3654701483404378116" itemprop="description articleBody">
<p><b>TL;DR</b> by returning X-Accel-Redirects and using multiple tornado processes you can use python as an async plugin language for nginx.</p>

<p>I've been using an architecture at work for building video streaming servers that I've not seen anybody else describe. I'm combining the ease of writing, reading and testing python with the performance of nginx. I've been pretty happy with the maintainability of the result. It's been taken from separate cache and origin to cache+origin and from Smooth Streaming to HLS; and I can hit 1000 qps and 8 Gbps of video with it (with pretty beefy hardware though).</p>

<p>See <a href="http://www2.linuxfiddle.net/f/5f96743c-3d62-40f7-89ef-f64460e904c1">http://linuxfiddle.net/f/5f96743c-3d62-40f7-89ef-f64460e904c1</a></p>

<p>This setup wouldn't serve 1000 qps, missing are:</p>
<ul>
<li>You'd want to use more tornado front-end processes so that python isn't the bottleneck</li>
<li>If there is any cache of any kind (e.g., vfs) in the backend, you want to use content-aware backend selection</li>
<li>You'd cache the mysql results rather than getting them out of the db every time</li>
<li>In the front-end, you'd want to merge all simultaneous requests for the same URL into one</li>
<li>Nginx should cache the service responses</li>
</ul>
<p/>
</div>
</div></body></html>