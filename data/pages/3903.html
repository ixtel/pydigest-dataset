<html><body><div><article class="post-content">
    <p>Many functional programming articles teach abstract functional techniques. That is, composition, pipelining, higher order functions. This one is different. It shows examples of imperative, unfunctional code that people write every day and translates these examples to a functional style.</p>

<p>The first section of the article takes short, data transforming loops and translates them into functional maps and reduces. The second section takes longer loops, breaks them up into units and makes each unit functional. The third section takes a loop that is a long series of successive data transformations and decomposes it into a functional pipeline.</p>

<p>The examples are in Python, because many people find Python easy to read. A number of the examples eschew pythonicity in order to demonstrate functional techniques common to many languages: map, reduce, pipeline.</p>

<h2 id="a-guide-rope">A guide rope</h2>

<p>When people talk about functional programming, they mention a dizzying number of “functional” characteristics. They mention immutable data<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, first class functions<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> and tail call optimisation<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>. These are language features that aid functional programming. They mention mapping, reducing, pipelining, recursing, currying<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup> and the use of higher order functions. These are programming techniques used to write functional code. They mention parallelization<sup id="fnref:5"><a href="#fn:5" class="footnote">5</a></sup>, lazy evaluation<sup id="fnref:6"><a href="#fn:6" class="footnote">6</a></sup> and determinism<sup id="fnref:7"><a href="#fn:7" class="footnote">7</a></sup>. These are advantageous properties of functional programs.</p>

<p>Ignore all that. Functional code is characterised by one thing: the absence of side effects. It doesn’t rely on data outside the current function, and it doesn’t change data that exists outside the current function. Every other “functional” thing can be derived from this property. Use it as a guide rope as you learn.</p>

<p>This is an unfunctional function:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">increment1</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">a</span>
    <span class="n">a</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
<p>This is a functional function:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">increment2</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div>
<h2 id="dont-iterate-over-lists-use-map-and-reduce">Don’t iterate over lists. Use map and reduce.</h2>

<h3 id="map">Map</h3>

<p>Map takes a function and a collection of items. It makes a new, empty collection, runs the function on each item in the original collection and inserts each return value into the new collection. It returns the new collection.</p>

<p>This is a simple map that takes a list of names and returns a list of the lengths of those names:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">name_lengths</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="p">[</span><span class="s">"Mary"</span><span class="p">,</span> <span class="s">"Isla"</span><span class="p">,</span> <span class="s">"Sam"</span><span class="p">])</span>

<span class="k">print</span> <span class="n">name_lengths</span>
<span class="c"># =&gt; [4, 4, 3]</span>
</code></pre></div>
<p>This is a map that squares every number in the passed collection:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">squares</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="k">print</span> <span class="n">squares</span>
<span class="c"># =&gt; [0, 1, 4, 9, 16]</span>
</code></pre></div>
<p>This map doesn’t take a named function. It takes an anonymous, inlined function defined with lambda. The parameters of the lambda are defined to the left of the colon. The function body is defined to the right of the colon. The result of running the function body is (implicitly) returned.</p>

<p>The unfunctional code below takes a list of real names and replaces them with randomly assigned code names.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">random</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mary'</span><span class="p">,</span> <span class="s">'Isla'</span><span class="p">,</span> <span class="s">'Sam'</span><span class="p">]</span>
<span class="n">code_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mr. Pink'</span><span class="p">,</span> <span class="s">'Mr. Orange'</span><span class="p">,</span> <span class="s">'Mr. Blonde'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
    <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">code_names</span><span class="p">)</span>

<span class="k">print</span> <span class="n">names</span>
<span class="c"># =&gt; ['Mr. Blonde', 'Mr. Blonde', 'Mr. Blonde']</span>
</code></pre></div>
<p>(As you can see, this algorithm can potentially assign the same secret code name to multiple secret agents. Hopefully, this won’t be a source of confusion during the secret mission.)</p>

<p>This can be rewritten as a map:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">random</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mary'</span><span class="p">,</span> <span class="s">'Isla'</span><span class="p">,</span> <span class="s">'Sam'</span><span class="p">]</span>

<span class="n">secret_names</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s">'Mr. Pink'</span><span class="p">,</span>
                                            <span class="s">'Mr. Orange'</span><span class="p">,</span>
                                            <span class="s">'Mr. Blonde'</span><span class="p">]),</span>
                   <span class="n">names</span><span class="p">)</span>
</code></pre></div>
<p><strong>Exercise 1.</strong> Try rewriting the code below as a map. It takes a list of real names and replaces them with code names produced using a more robust strategy.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mary'</span><span class="p">,</span> <span class="s">'Isla'</span><span class="p">,</span> <span class="s">'Sam'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
    <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="k">print</span> <span class="n">names</span>
<span class="c"># =&gt; [6306819796133686941, 8135353348168144921, -1228887169324443034]</span>
</code></pre></div>
<p>(Hopefully, the secret agents will have good memories and won’t forget each other’s secret code names during the secret mission.)</p>

<p>My solution:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mary'</span><span class="p">,</span> <span class="s">'Isla'</span><span class="p">,</span> <span class="s">'Sam'</span><span class="p">]</span>

<span class="n">secret_names</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
</code></pre></div>
<h3 id="reduce">Reduce</h3>

<p>Reduce takes a function and a collection of items. It returns a value that is created by combining the items.</p>

<p>This is a simple reduce. It returns the sum of all the items in the collection.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">sum</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="k">print</span> <span class="nb">sum</span>
<span class="c"># =&gt; 10</span>
</code></pre></div>
<p><code>x</code> is the current item being iterated over. <code>a</code> is the accumulator. It is the value returned by the execution of the lambda on the previous item. <code>reduce()</code> walks through the items. For each one, it runs the lambda on the current <code>a</code> and <code>x</code> and returns the result as the <code>a</code> of the next iteration.</p>

<p>What is <code>a</code> in the first iteration? There is no previous iteration result for it to pass along. <code>reduce()</code> uses the first item in the collection for <code>a</code> in the first iteration and starts iterating at the second item. That is, the first <code>x</code> is the second item.</p>

<p>This code counts how often the word ‘Sam’ appears in a list of strings:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mary read a story to Sam and Isla.'</span><span class="p">,</span>
             <span class="s">'Isla cuddled Sam.'</span><span class="p">,</span>
             <span class="s">'Sam chortled.'</span><span class="p">]</span>

<span class="n">sam_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
    <span class="n">sam_count</span> <span class="o">+=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'Sam'</span><span class="p">)</span>

<span class="k">print</span> <span class="n">sam_count</span>
<span class="c"># =&gt; 3</span>
</code></pre></div>
<p>This is the same code written as a reduce:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mary read a story to Sam and Isla.'</span><span class="p">,</span>
             <span class="s">'Isla cuddled Sam.'</span><span class="p">,</span>
             <span class="s">'Sam chortled.'</span><span class="p">]</span>

<span class="n">sam_count</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'Sam'</span><span class="p">),</span>
                   <span class="n">sentences</span><span class="p">,</span>
                   <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p>How does this code come up with its initial <code>a</code>? The starting point for the number of incidences of ‘Sam’ cannot be ‘Mary read a story to Sam and Isla.’ The initial accumulator is specified with the third argument to <code>reduce()</code>. This allows the use of a value of a different type from the items in the collection.</p>

<p><strong>Why are map and reduce better?</strong></p>

<p>First, they are often one-liners.</p>

<p>Second, the important parts of the iteration – the collection, the operation and the return value – are always in the same places in every map and reduce.</p>

<p>Third, the code in a loop may affect variables defined before it or code that runs after it. By convention, maps and reduces are functional.</p>

<p>Fourth, map and reduce are elemental operations. Every time a person reads a for loop, they have to work through the logic line by line. There are few structural regularities they can use to create a scaffolding on which to hang their understanding of the code. In contrast, map and reduce are at once building blocks that can be combined into complex algorithms, and elements that the code reader can instantly understand and abstract in their mind. “Ah, this code is transforming each item in this collection. It’s throwing some of the transformations away. It’s combining the remainder into a single output.”</p>

<p>Fifth, map and reduce have many friends that provide useful, tweaked versions of their basic behaviour. For example: filter, all, any and find.</p>

<hr/>

<p><strong>Exercise 2.</strong> Try rewriting the code below using map, reduce and filter. Filter takes a function and a collection. It returns a collection of every item for which the function returned <code>True</code>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">people</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Mary'</span><span class="p">,</span> <span class="s">'height'</span><span class="p">:</span> <span class="mi">160</span><span class="p">},</span>
    <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Isla'</span><span class="p">,</span> <span class="s">'height'</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span>
    <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Sam'</span><span class="p">}]</span>

<span class="n">height_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">height_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">people</span><span class="p">:</span>
    <span class="k">if</span> <span class="s">'height'</span> <span class="ow">in</span> <span class="n">person</span><span class="p">:</span>
        <span class="n">height_total</span> <span class="o">+=</span> <span class="n">person</span><span class="p">[</span><span class="s">'height'</span><span class="p">]</span>
        <span class="n">height_count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">if</span> <span class="n">height_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">average_height</span> <span class="o">=</span> <span class="n">height_total</span> <span class="o">/</span> <span class="n">height_count</span>

    <span class="k">print</span> <span class="n">average_height</span>
    <span class="c"># =&gt; 120</span>
</code></pre></div>
<p>If this seems tricky, try not thinking about the operations on the data. Think of the states the data will go through, from the list of people dictionaries to the average height. Don’t try and bundle multiple transformations together. Put each on a separate line and assign the result to a descriptively-named variable. Once the code works, condense it.</p>

<p>My solution:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">people</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Mary'</span><span class="p">,</span> <span class="s">'height'</span><span class="p">:</span> <span class="mi">160</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Isla'</span><span class="p">,</span> <span class="s">'height'</span><span class="p">:</span> <span class="mi">80</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'Sam'</span><span class="p">}]</span>

<span class="n">heights</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">'height'</span><span class="p">],</span>
              <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'height'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span> <span class="n">people</span><span class="p">))</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>
    <span class="n">average_height</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">heights</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span>
</code></pre></div>
<h2 id="write-declaratively-not-imperatively">Write declaratively, not imperatively</h2>

<p>The program below runs a race between three cars. At each time step, each car may move forwards or it may stall. At each time step, the program prints out the paths of the cars so far. After five time steps, the race is over.</p>

<p>This is some sample output:</p>

<div class="highlight"><pre><code> -
 - -
 - -

 - -
 - -
 - - -

 - - -
 - -
 - - -

 - - - -
 - - -
 - - - -

 - - - -
 - - - -
 - - - - -
</code></pre></div>
<p>This is the program:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>

<span class="n">time</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">car_positions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">while</span> <span class="n">time</span><span class="p">:</span>
    <span class="c"># decrease time</span>
    <span class="n">time</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">print</span> <span class="s">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">car_positions</span><span class="p">)):</span>
        <span class="c"># move car</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="n">car_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># draw car</span>
        <span class="k">print</span> <span class="s">'-'</span> <span class="o">*</span> <span class="n">car_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div>
<p>The code is written imperatively. A functional version would be declarative. It would describe what to do, rather than how to do it.</p>

<h2 id="use-functions">Use functions</h2>

<p>A program can be made more declarative by bundling pieces of the code into functions.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">move_cars</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">car_positions</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="n">car_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">draw_car</span><span class="p">(</span><span class="n">car_position</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">'-'</span> <span class="o">*</span> <span class="n">car_position</span>

<span class="k">def</span> <span class="nf">run_step_of_race</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">time</span>
    <span class="n">time</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">move_cars</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">draw</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">''</span>
    <span class="k">for</span> <span class="n">car_position</span> <span class="ow">in</span> <span class="n">car_positions</span><span class="p">:</span>
        <span class="n">draw_car</span><span class="p">(</span><span class="n">car_position</span><span class="p">)</span>

<span class="n">time</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">car_positions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">while</span> <span class="n">time</span><span class="p">:</span>
    <span class="n">run_step_of_race</span><span class="p">()</span>
    <span class="n">draw</span><span class="p">()</span>
</code></pre></div>
<p>To understand this program, the reader just reads the main loop. “If there is time left, run a step of the race and draw. Check the time again.” If the reader wants to understand more about what it means to run a step of the race, or draw, they can read the code in those functions.</p>

<p>There are no comments any more. The code describes itself.</p>

<p>Splitting code into functions is a great, low brain power way to make code more readable. This technique uses functions, but it uses them as sub-routines. They parcel up code. The code is not functional in the sense of the guide rope. The functions in the code use state that was not passed as arguments. They affect the code around them by changing external variables, rather than by returning values. To check what a function really does, the reader must read each line carefully. If they find an external variable, they must find its origin. They must see what other functions change that variable.</p>

<h2 id="remove-state">Remove state</h2>

<p>This is a functional version of the car race code:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">move_cars</span><span class="p">(</span><span class="n">car_positions</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
               <span class="n">car_positions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">output_car</span><span class="p">(</span><span class="n">car_position</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">'-'</span> <span class="o">*</span> <span class="n">car_position</span>

<span class="k">def</span> <span class="nf">run_step_of_race</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">'time'</span><span class="p">:</span> <span class="n">state</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">'car_positions'</span><span class="p">:</span> <span class="n">move_cars</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s">'car_positions'</span><span class="p">])}</span>

<span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">''</span>
    <span class="k">print</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">output_car</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s">'car_positions'</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">race</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="n">draw</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="s">'time'</span><span class="p">]:</span>
        <span class="n">race</span><span class="p">(</span><span class="n">run_step_of_race</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>

<span class="n">race</span><span class="p">({</span><span class="s">'time'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s">'car_positions'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
</code></pre></div>
<p>The code is still split into functions, but the functions are functional. There are three signs of this. First, there are no longer any shared variables. <code>time</code> and <code>car_positions</code> get passed straight into <code>race()</code>. Second, functions take parameters. Third, no variables are instantiated inside functions. All data changes are done with return values. <code>race()</code> recurses with the result of <code>run_step_of_race()</code>. Each time a step generates a new state, it is passed immediately into the next step.</p>

<p>Now, here are two functions, <code>zero()</code> and <code>one()</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"0"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">one</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</code></pre></div>
<p><code>zero()</code> takes a string, <code>s</code>. If the first character is <code>'0'</code>, it returns the rest of the string. If it is not, it returns <code>None</code>, the default return value of Python functions. <code>one()</code> does the same, but for a first character of <code>'1'</code>.</p>

<p>Imagine a function called <code>rule_sequence()</code>. It takes a string and a list of rule functions of the form of <code>zero()</code> and <code>one()</code>. It calls the first rule on the string. Unless <code>None</code> is returned, it takes the return value and calls the second rule on it. Unless <code>None</code> is returned, it takes the return value and calls the third rule on it. And so forth. If any rule returns <code>None</code>, <code>rule_sequence()</code> stops and returns <code>None</code>. Otherwise, it returns the return value of the final rule.</p>

<p>This is some sample input and output:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="n">rule_sequence</span><span class="p">(</span><span class="s">'0101'</span><span class="p">,</span> <span class="p">[</span><span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">])</span>
<span class="c"># =&gt; 1</span>

<span class="k">print</span> <span class="n">rule_sequence</span><span class="p">(</span><span class="s">'0101'</span><span class="p">,</span> <span class="p">[</span><span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">])</span>
<span class="c"># =&gt; None</span>
</code></pre></div>
<p>This is the imperative version of <code>rule_sequence()</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">rule_sequence</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">s</span>
</code></pre></div>
<p><strong>Exercise 3.</strong> The code above uses a loop to do its work. Make it more declarative by rewriting it as a recursion.</p>

<p>My solution:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">rule_sequence</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rule_sequence</span><span class="p">(</span><span class="n">rules</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">s</span><span class="p">),</span> <span class="n">rules</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</code></pre></div>
<h2 id="use-pipelines">Use pipelines</h2>

<p>In the previous section, some imperative loops were rewritten as recursions that called out to auxiliary functions. In this section, a different type of imperative loop will be rewritten using a technique called pipelining.</p>

<p>The loop below performs transformations on dictionaries that hold the name, incorrect country of origin and active status of some bands.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">bands</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'sunset rubdown'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">:</span> <span class="s">'UK'</span><span class="p">,</span> <span class="s">'active'</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span>
         <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'women'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">:</span> <span class="s">'Germany'</span><span class="p">,</span> <span class="s">'active'</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span>
         <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'a silver mt. zion'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">:</span> <span class="s">'Spain'</span><span class="p">,</span> <span class="s">'active'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}]</span>

<span class="k">def</span> <span class="nf">format_bands</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
        <span class="n">band</span><span class="p">[</span><span class="s">'country'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Canada'</span>
        <span class="n">band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
        <span class="n">band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

<span class="n">format_bands</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>

<span class="k">print</span> <span class="n">bands</span>
<span class="c"># =&gt; [{'name': 'Sunset Rubdown', 'active': False, 'country': 'Canada'},</span>
<span class="c">#     {'name': 'Women', 'active': False, 'country': 'Canada' },</span>
<span class="c">#     {'name': 'A Silver Mt Zion', 'active': True, 'country': 'Canada'}]</span>
</code></pre></div>
<p>Worries are stirred by the name of the function. “format” is very vague. Upon closer inspection of the code, these worries begin to claw. Three things happen in the same loop. The value at the <code>'country'</code> key gets set to <code>'Canada'</code>. Punctuation is removed from the band name. The band name gets capitalized. It is hard to tell what the code is intended to do and hard to tell if it does what it appears to do. The code is hard to reuse, hard to test and hard to parallelize.</p>

<p>Compare it with this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="n">pipeline_each</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="p">[</span><span class="n">set_canada_as_country</span><span class="p">,</span>
                            <span class="n">strip_punctuation_from_name</span><span class="p">,</span>
                            <span class="n">capitalize_names</span><span class="p">])</span>
</code></pre></div>
<p>This code is easy to understand. It gives the impression that the auxiliary functions are functional because they seem to be chained together. The output from the previous one comprises the input to the next. If they are functional, they are easy to verify. They are also easy to reuse, easy to test and easy to parallelize.</p>

<p>The job of <code>pipeline_each()</code> is to pass the bands, one at a time, to a transformation function, like <code>set_canada_as_country()</code>. After the function has been applied to all the bands, <code>pipeline_each()</code> bundles up the transformed bands. Then, it passes each one to the next function.</p>

<p>Let’s look at the transformation functions.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">assoc</span><span class="p">(</span><span class="n">_d</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">set_canada_as_country</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">assoc</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="s">'country'</span><span class="p">,</span> <span class="s">"Canada"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">strip_punctuation_from_name</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">assoc</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="n">band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">capitalize_names</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">assoc</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="n">band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
</code></pre></div>
<p>Each one associates a key on a band with a new value. There is no easy way to do this without mutating the original band. <code>assoc()</code> solves this problem by using <code>deepcopy()</code> to produce a copy of the passed dictionary. Each transformation function makes its modification to the copy and returns that copy.</p>

<p>Everything seems fine. Band dictionary originals are protected from mutation when a key is associated with a new value. But there are two other potential mutations in the code above. In <code>strip_punctuation_from_name()</code>, the unpunctuated name is generated by calling <code>replace()</code> on the original name. In <code>capitalize_names()</code>, the capitalized name is generated by calling <code>title()</code> on the original name. If <code>replace()</code> and <code>title()</code> are not functional, <code>strip_punctuation_from_name()</code> and <code>capitalize_names()</code> are not functional.</p>

<p>Fortunately, <code>replace()</code> and <code>title()</code> do not mutate the strings they operate on. This is because strings are immutable in Python. When, for example, <code>replace()</code> operates on a band name string, the original band name is copied and <code>replace()</code> is called on the copy. Phew.</p>

<p>This contrast between the mutability of strings and dictionaries in Python illustrates the appeal of languages like Clojure. The programmer need never think about whether they are mutating data. They aren’t.</p>

<hr/>

<p><strong>Exercise 4.</strong> Try and write the <code>pipeline_each</code> function. Think about the order of operations. The bands in the array are passed, one band at a time, to the first transformation function. The bands in the resulting array are passed, one band at a time, to the second transformation function. And so forth.</p>

<p>My solution:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">pipeline_each</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fns</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span>
                  <span class="n">fns</span><span class="p">,</span>
                  <span class="n">data</span><span class="p">)</span>
</code></pre></div>
<p>All three transformation functions boil down to making a change to a particular field on the passed band. <code>call()</code> can be used to abstract that. It takes a function to apply and the key of the value to apply it to.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">set_canada_as_country</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'Canada'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">)</span>
<span class="n">strip_punctuation_from_name</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span> <span class="s">'name'</span><span class="p">)</span>
<span class="n">capitalize_names</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">'name'</span><span class="p">)</span>

<span class="k">print</span> <span class="n">pipeline_each</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="p">[</span><span class="n">set_canada_as_country</span><span class="p">,</span>
                            <span class="n">strip_punctuation_from_name</span><span class="p">,</span>
                            <span class="n">capitalize_names</span><span class="p">])</span>
</code></pre></div>
<p>Or, if we are willing to sacrifice readability for conciseness, just:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="n">pipeline_each</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="p">[</span><span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'Canada'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">),</span>
                            <span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span> <span class="s">'name'</span><span class="p">),</span>
                            <span class="n">call</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">'name'</span><span class="p">)])</span>
</code></pre></div>
<p>The code for <code>call()</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">assoc</span><span class="p">(</span><span class="n">_d</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">apply_fn</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">assoc</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fn</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">apply_fn</span>
</code></pre></div>
<p><strong>There is a lot going on here. Let’s take it piece by piece.</strong></p>

<p>One. <code>call()</code> is a higher order function. A higher order function takes a function as an argument, or returns a function. Or, like <code>call()</code>, it does both.</p>

<p>Two. <code>apply_fn()</code> looks very similar to the three transformation functions. It takes a record (a band). It looks up the value at <code>record[key]</code>. It calls <code>fn</code> on that value. It assigns the result back to a copy of the record. It returns the copy.</p>

<p>Three. <code>call()</code> does not do any actual work. <code>apply_fn()</code>, when called, will do the work. In the example of using <code>pipeline_each()</code> above, one instance of <code>apply_fn()</code> will set <code>'country'</code> to <code>'Canada'</code> on a passed band. Another instance will capitalize the name of a passed band.</p>

<p>Four. When an <code>apply_fn()</code> instance is run, <code>fn</code> and <code>key</code> will not be in scope. They are neither arguments to <code>apply_fn()</code>, nor locals inside it. But they will still be accessible. When a function is defined, it saves references to the variables it closes over: those that were defined in a scope outside the function and that are used inside the function. When the function is run and its code references a variable, Python looks up the variable in the locals and in the arguments. If it doesn’t find it there, it looks in the saved references to closed over variables. This is where it will find <code>fn</code> and <code>key</code>.</p>

<p>Five. There is no mention of bands in the <code>call()</code> code. That is because <code>call()</code> could be used to generate pipeline functions for any program, regardless of topic. Functional programming is partly about building up a library of generic, reusable, composable functions.</p>

<p>Good job. Closures, higher order functions and variable scope all covered in the space of a few paragraphs. Have a nice glass of lemonade.</p>

<hr/>

<p>There is one more piece of band processing to do. That is to remove everything but the name and country. <code>extract_name_and_country()</code> can pull that information out:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">extract_name_and_country</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="n">plucked_band</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">plucked_band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span>
    <span class="n">plucked_band</span><span class="p">[</span><span class="s">'country'</span><span class="p">]</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="s">'country'</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">plucked_band</span>

<span class="k">print</span> <span class="n">pipeline_each</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="p">[</span><span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'Canada'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">),</span>
                            <span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span> <span class="s">'name'</span><span class="p">),</span>
                            <span class="n">call</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">'name'</span><span class="p">),</span>
                            <span class="n">extract_name_and_country</span><span class="p">])</span>

<span class="c"># =&gt; [{'name': 'Sunset Rubdown', 'country': 'Canada'},</span>
<span class="c">#     {'name': 'Women', 'country': 'Canada'},</span>
<span class="c">#     {'name': 'A Silver Mt Zion', 'country': 'Canada'}]</span>
</code></pre></div>
<p><code>extract_name_and_country()</code> could have been written as a generic function called <code>pluck()</code>.</p>

<p><code>pluck()</code> would be used like this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="n">pipeline_each</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="p">[</span><span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'Canada'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">),</span>
                            <span class="n">call</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span> <span class="s">'name'</span><span class="p">),</span>
                            <span class="n">call</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">'name'</span><span class="p">),</span>
                            <span class="n">pluck</span><span class="p">([</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">])])</span>
</code></pre></div>
<p><strong>Exercise 5.</strong> <code>pluck()</code> takes a list of keys to extract from each record. Try and write it. It will need to be a higher order function.</p>

<p>My solution:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">pluck</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pluck_fn</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">assoc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span>
                      <span class="n">keys</span><span class="p">,</span>
                      <span class="p">{})</span>
    <span class="k">return</span> <span class="n">pluck_fn</span>
</code></pre></div>
<h2 id="what-now">What now?</h2>

<p>Functional code co-exists very well with code written in other styles. The transformations in this article can be applied to any code base in any language. Try applying them to your own code.</p>

<p>Think of Mary, Isla and Sam. Turn iterations of lists into maps and reduces.</p>

<p>Think of the race. Break code into functions. Make those functions functional. Turn a loop that repeats a process into a recursion.</p>

<p>Think of the bands. Turn a sequence of operations into a pipeline.</p>



  </article>

  

  </div></body></html>