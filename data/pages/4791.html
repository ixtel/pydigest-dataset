<html><body><div><div class="content html_format"><p>
      Был у меня как-то сайт по поиску твинков в World of Warcraft. Любой мог ввести ник и получить список персонажей, находящихся на той же записи (если данные имелись в базе сайта, конечно). </p>
<p>
И вот однажды ко мне зашел посетитель из Blizzard:

</p><img src="https://habrastorage.org/getpro/habr/post_images/a63/53d/0ab/a6353d0ab566660f791daf3d98d1505a.png" alt="image"/>
<p>
99% людей во время первого посещения ищут себя и своих друзей. Посетитель из Франции не стал исключением и оставил в логе просмотров несколько персонажей, скорее всего принадлежащих работникам близзард (что было видно по активности на форуме и другим признакам). Конечно, мне стало интересно, чем же отличаются персонажи гейммастеров от персонажей обычных смертных и отличаются ли вообще. 
</p><a name="habracut"/><p>
После просмотра ачивок этих персонажей стало ясно, что при поступлении на службу новоиспеченному ГМу выдают набор коллекционных изданий всех игр близзард. После более пристального изучения вскрылась одна деталь: </p><b>все коллекционки получены в один день</b><p> (видимо, примерная дата поступления на работу).

</p><img src="https://habrastorage.org/files/359/83c/697/35983c69719c4172939c42c379d8a0a4.png" alt="image"/>

<h2>Используем API Battle.net</h2><p>
Гмы получают все существующие (на дату получения) коллекционки — а значит, и самую первую, «ванильную». Она была выпущена больше 10 лет назад и сегодня достать ее можно разве что на ebay за 2-3 тысячи евро. Её-то и будем использовать для поиска других персонажей.
</p><p>
Искать будем персонажей, у которых есть такой пет (его дают бонусом за активацию ванильной коллекционки):

</p><img src="https://habrastorage.org/files/4f8/cd7/898/4f8cd7898f8b4521971881e449f88d55.png" alt="image"/>
<p>
Так как прямого доступа к спискам персонажей API не предоставляет, будем искать персонажей через аукцион.

</p><pre><code class="python">realm = "гордунни"  # реалм, на котором будем искать персонажей

# Получаем ссылку на дамп аукциона
r = requests.get("http://eu.battle.net/api/wow/auction/data/%s" % realm)
auction_dump_url = json.loads(r.text)["files"][0]["url"]

# Загружаем данные по лотам на аукционе
auc_data = json.loads(requests.get(auction_dump_url).text)

# Составляем список имен/реалмов персонажей
chars = {(lot["owner"], lot["ownerRealm"]) for lot in auc_data["auctions"]["auctions"]}
</code></pre><p>
В этой функции определяем, является ли персонаж потенциальным гмом:

</p><pre><code class="python">def is_gm(name, realm):
    r = requests.get(CHAR_API_URL.format(name=name, realm=realm))
    if r.text.find("Panda Cub") != -1:
        return True
</code></pre><p>
Запускаем проверку:

</p><pre><code class="python">for name, realm in chars:
    if is_gm(name, realm):
        print("Возможно ГМ: %s %s" % (name, realm))
    time.sleep(1)
</code></pre>
<div class="spoiler"><b class="spoiler_title">Код скрипта целиком</b><div class="spoiler_text"><pre><code class="python">import json
import requests
import time


CHAR_API_URL = "http://eu.battle.net/api/wow/character/{realm}/{name}?fields=pets,guild"

# В этой функции определяем, является ли персонаж потенциальным гмом
def is_gm(name, realm):
    r = requests.get(CHAR_API_URL.format(name=name, realm=realm))
    if r.text.find("Panda Cub") != -1:
        return True


realm = "гордунни"  # реалм, на котором будем искать персонажей

# Получаем ссылку на дамп аукциона
r = requests.get("http://eu.battle.net/api/wow/auction/data/%s" % realm)
auction_dump_url = json.loads(r.text)["files"][0]["url"]

# Загружаем данные по лотам на аукционе
auc_data = json.loads(requests.get(auction_dump_url).text)

# Составляем список имен/реалмов персонажей
chars = {(lot["owner"], lot["ownerRealm"]) for lot in auc_data["auctions"]["auctions"]}

# Запускаем проверку
for name, realm in chars:
    if is_gm(name, realm):
        print("Возможно ГМ: %s %s" % (name, realm))
    time.sleep(1)
</code></pre>
</div></div>
<i>Примечание: скрипт ищет только персонажей, выставляющих лоты на аукционе. Для более широкого охвата можно также сканировать согильдийцев каждого владельца лота.</i>
<p>
Дальше нужно смотреть другие признаки — сколько получено коллекционок за один день, их общее кол-во и так далее.</p><p>
Конечно, не каждый персонаж, который соответствует критериям, принадлежит ГМу. Это может быть и просто коллекционер, например.
</p><p>
Для отображения результатов скрипта создал простенький сайт: </p><a href="http://wow-gm-track.website/">http://wow-gm-track.website</a>
<p>
Из интересностей: в процессе сканирования выявились целые гнезда — гильдии, в которых сразу несколько </p><i>разных</i><p> аккаунтов, принадлежащих (предположительно) ГМам. Например: </p><a href="http://eu.battle.net/wow/ru/guild/%D0%B0%D0%B7%D1%83%D1%80%D0%B5%D0%B3%D0%BE%D1%81/%D0%97%D0%BE%D0%B2_%D0%94%D1%80%D0%B5%D0%B2%D0%BD%D0%B8%D1%85/roster?sort=rank&amp;dir=a">Зов древних</a><p> (6 штук, в том числе глава гильдии).
</p><p>
И немного статистики: на сегодняшний день просканировано 1,7 миллиона персонажей на русскоязычных реалмах, ванильную коллекционку имеют 1306 персонажей (0,07%), из них только 380 персонажей получили хотя бы 4 коллекционки в один день (0,02% от общего числа).
      </p><p class="clear"/>
    </div>

    
  </div></body></html>