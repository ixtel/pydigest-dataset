<html><body><div><div class="pf-content"><p>The lxml.objectify sub-package is extremely handy for parsing and creating XML. In this article, we will show how to create XML using the lxml package. We’ll start with some simple XML and then try to replicate it. Let’s get started!<span id="more-3991"/></p>
<p>In past <a href="http://www.blog.pythonlibrary.org/2012/06/06/parsing-xml-with-python-using-lxml-objectify/" target="_blank">articles</a>, I have used the following silly example XML for demonstration purposes:</p>
<pre class="xml"><span><span>&lt;?xml</span> <span>version</span>=<span>"1.0"</span> <span>?&gt;</span></span>
<span><span>&lt;zAppointments</span> <span>reminder</span>=<span>"15"</span><span>&gt;</span></span>
    <span><span>&lt;appointment<span>&gt;</span></span></span>
        <span><span>&lt;begin<span>&gt;</span></span></span>1181251680<span><span>&lt;/begin<span>&gt;</span></span></span>
        <span><span>&lt;uid<span>&gt;</span></span></span>040000008200E000<span><span>&lt;/uid<span>&gt;</span></span></span>
        <span><span>&lt;alarmTime<span>&gt;</span></span></span>1181572063<span><span>&lt;/alarmTime<span>&gt;</span></span></span>
        <span><span>&lt;state<span>&gt;</span></span></span><span><span>&lt;/state<span>&gt;</span></span></span>
        <span><span>&lt;location<span>&gt;</span></span></span><span><span>&lt;/location<span>&gt;</span></span></span>
        <span><span>&lt;duration<span>&gt;</span></span></span>1800<span><span>&lt;/duration<span>&gt;</span></span></span>
        <span><span>&lt;subject<span>&gt;</span></span></span>Bring pizza home<span><span>&lt;/subject<span>&gt;</span></span></span>
    <span><span>&lt;/appointment<span>&gt;</span></span></span>
    <span><span>&lt;appointment<span>&gt;</span></span></span>
        <span><span>&lt;begin<span>&gt;</span></span></span>1234360800<span><span>&lt;/begin<span>&gt;</span></span></span>
        <span><span>&lt;duration<span>&gt;</span></span></span>1800<span><span>&lt;/duration<span>&gt;</span></span></span>
        <span><span>&lt;subject<span>&gt;</span></span></span>Check MS Office website for updates<span><span>&lt;/subject<span>&gt;</span></span></span>
        <span><span>&lt;location<span>&gt;</span></span></span><span><span>&lt;/location<span>&gt;</span></span></span>
        <span><span>&lt;uid<span>&gt;</span></span></span>604f4792-eb89-478b-a14f-dd34d3cc6c21-1234360800<span><span>&lt;/uid<span>&gt;</span></span></span>
        <span><span>&lt;state<span>&gt;</span></span></span>dismissed<span><span>&lt;/state<span>&gt;</span></span></span>
  <span><span>&lt;/appointment<span>&gt;</span></span></span>
<span><span>&lt;/zAppointments<span>&gt;</span></span></span></pre>
<p>Let’s see how we can use lxml.objectify to recreate this XML:</p>
<pre class="python"><span>from</span> lxml <span>import</span> etree, objectify
 
<span>#----------------------------------------------------------------------</span>
<span>def</span> create_appt<span>(</span>data<span>)</span>:
    <span>""</span><span>"
    Create an appointment XML element
    "</span><span>""</span>
    appt = objectify.<span>Element</span><span>(</span><span>"appointment"</span><span>)</span>
    appt.<span>begin</span> = data<span>[</span><span>"begin"</span><span>]</span>
    appt.<span>uid</span> = data<span>[</span><span>"uid"</span><span>]</span>
    appt.<span>alarmTime</span> = data<span>[</span><span>"alarmTime"</span><span>]</span>
    appt.<span>state</span> = data<span>[</span><span>"state"</span><span>]</span>
    appt.<span>location</span> = data<span>[</span><span>"location"</span><span>]</span>
    appt.<span>duration</span> = data<span>[</span><span>"duration"</span><span>]</span>
    appt.<span>subject</span> = data<span>[</span><span>"subject"</span><span>]</span>
    <span>return</span> appt
 
<span>#----------------------------------------------------------------------</span>
<span>def</span> create_xml<span>(</span><span>)</span>:
    <span>""</span><span>"
    Create an XML file
    "</span><span>""</span>
 
    <span>xml</span> = <span>''</span><span>'&lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;zAppointments&gt;
    &lt;/zAppointments&gt;
    '</span><span>''</span>
 
    root = objectify.<span>fromstring</span><span>(</span><span>xml</span><span>)</span>
    root.<span>set</span><span>(</span><span>"reminder"</span>, <span>"15"</span><span>)</span>
 
    appt = create_appt<span>(</span><span>{</span><span>"begin"</span>:<span>1181251680</span>,
                        <span>"uid"</span>:<span>"040000008200E000"</span>,
                        <span>"alarmTime"</span>:<span>1181572063</span>,
                        <span>"state"</span>:<span>""</span>,
                        <span>"location"</span>:<span>""</span>,
                        <span>"duration"</span>:<span>1800</span>,
                        <span>"subject"</span>:<span>"Bring pizza home"</span><span>}</span>
                       <span>)</span>
    root.<span>append</span><span>(</span>appt<span>)</span>
 
    uid = <span>"604f4792-eb89-478b-a14f-dd34d3cc6c21-1234360800"</span>
    appt = create_appt<span>(</span><span>{</span><span>"begin"</span>:<span>1234360800</span>,
                        <span>"uid"</span>:uid,
                        <span>"alarmTime"</span>:<span>1181572063</span>,
                        <span>"state"</span>:<span>"dismissed"</span>,
                        <span>"location"</span>:<span>""</span>,
                        <span>"duration"</span>:<span>1800</span>,
                        <span>"subject"</span>:<span>"Check MS Office website for updates"</span><span>}</span>
                       <span>)</span>
    root.<span>append</span><span>(</span>appt<span>)</span>
 
    <span># remove lxml annotation</span>
    objectify.<span>deannotate</span><span>(</span>root<span>)</span>
    etree.<span>cleanup_namespaces</span><span>(</span>root<span>)</span>
 
    <span># create the xml string</span>
    obj_xml = etree.<span>tostring</span><span>(</span>root,
                             pretty_print=<span>True</span>,
                             xml_declaration=<span>True</span><span>)</span>
 
    <span>try</span>:
        with <span>open</span><span>(</span><span>"example.xml"</span>, <span>"wb"</span><span>)</span> as xml_writer:
            xml_writer.<span>write</span><span>(</span>obj_xml<span>)</span>
    <span>except</span> <span>IOError</span>:
        <span>pass</span>
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    create_xml<span>(</span><span>)</span></pre>
<p>Let’s break this down a bit. We will start with the <strong>create_xml</strong> function. In it we create an XML root object using the objectify module’s <strong>fromstring</strong> function. The root object will contain <strong>zAppointment</strong> as its tag. We set the root’s <strong>reminder</strong> attribute and then we call our <strong>create_appt</strong> function using a dictionary for its argument. In the <strong>create_appt</strong> function, we create an instance of an Element (technically, it’s an <strong>ObjectifiedElement</strong>) that we assign to our <strong>appt</strong> variable. Here we use dot-notation to create the tags for this element. Finally we return the appt element back and append it to our <strong>root</strong> object. We repeat the process for the second appointment instance. </p>
<p>The next section of the <strong>create_xml</strong> function will remove the lxml annotation. If you do not do this, you’re XML will end up looking like the following:</p>
<pre class="xml"><span><span>&lt;zAppointments</span> <span>py:pytype</span>=<span>"TREE"</span> <span>reminder</span>=<span>"15"</span><span>&gt;</span></span>
    <span><span>&lt;appointment</span> <span>py:pytype</span>=<span>"TREE"</span><span>&gt;</span></span>
        <span><span>&lt;begin</span> <span>py:pytype</span>=<span>"int"</span><span>&gt;</span></span>1181251680<span><span>&lt;/begin<span>&gt;</span></span></span>
        <span><span>&lt;uid</span> <span>py:pytype</span>=<span>"str"</span><span>&gt;</span></span>040000008200E000<span><span>&lt;/uid<span>&gt;</span></span></span>
        <span><span>&lt;alarmTime</span> <span>py:pytype</span>=<span>"int"</span><span>&gt;</span></span>1181572063<span><span>&lt;/alarmTime<span>&gt;</span></span></span>
        <span><span>&lt;state</span> <span>py:pytype</span>=<span>"str"</span><span>/&gt;</span></span>
        <span><span>&lt;location</span> <span>py:pytype</span>=<span>"str"</span><span>/&gt;</span></span>
        <span><span>&lt;duration</span> <span>py:pytype</span>=<span>"int"</span><span>&gt;</span></span>1800<span><span>&lt;/duration<span>&gt;</span></span></span>
        <span><span>&lt;subject</span> <span>py:pytype</span>=<span>"str"</span><span>&gt;</span></span>Bring pizza home<span><span>&lt;/subject<span>&gt;</span></span></span>
    <span><span>&lt;/appointment<span>&gt;</span></span></span><span><span>&lt;appointment</span> <span>py:pytype</span>=<span>"TREE"</span><span>&gt;</span></span>
        <span><span>&lt;begin</span> <span>py:pytype</span>=<span>"int"</span><span>&gt;</span></span>1234360800<span><span>&lt;/begin<span>&gt;</span></span></span>
        <span><span>&lt;uid</span> <span>py:pytype</span>=<span>"str"</span><span>&gt;</span></span>604f4792-eb89-478b-a14f-dd34d3cc6c21-1234360800<span><span>&lt;/uid<span>&gt;</span></span></span>
        <span><span>&lt;alarmTime</span> <span>py:pytype</span>=<span>"int"</span><span>&gt;</span></span>1181572063<span><span>&lt;/alarmTime<span>&gt;</span></span></span>
        <span><span>&lt;state</span> <span>py:pytype</span>=<span>"str"</span><span>&gt;</span></span>dismissed<span><span>&lt;/state<span>&gt;</span></span></span>
        <span><span>&lt;location</span> <span>py:pytype</span>=<span>"str"</span><span>/&gt;</span></span>
        <span><span>&lt;duration</span> <span>py:pytype</span>=<span>"int"</span><span>&gt;</span></span>1800<span><span>&lt;/duration<span>&gt;</span></span></span>
        <span><span>&lt;subject</span> <span>py:pytype</span>=<span>"str"</span><span>&gt;</span></span>Check MS Office website for updates<span><span>&lt;/subject<span>&gt;</span></span></span>
    <span><span>&lt;/appointment<span>&gt;</span></span></span>
<span><span>&lt;/zAppointments<span>&gt;</span></span></span></pre>
<p>To remove all that unwanted annotation, we call the following two functions:</p>
<pre class="python">objectify.<span>deannotate</span><span>(</span>root<span>)</span>
etree.<span>cleanup_namespaces</span><span>(</span>root<span>)</span></pre>
<p>The last piece of the puzzle is to get lxml to generate the the XML itself. Here we use lxml’s etree module to do the hard work:</p>
<pre class="python">obj_xml = etree.<span>tostring</span><span>(</span>root, pretty_print=<span>True</span><span>)</span></pre>
<p>The <strong>tostring</strong> function will return a nice string of the XML and if you set <strong>pretty_print</strong> to True, it will usually return the XML in a nice format too. </p>
<hr/>
<h3>Wrapping Up</h3>
<p>
</p><p>Now you know how to use lxml’s objectify module to create XML. It’s a pretty handy interface and quite Pythonic for the most part. </p>
<hr/>
<h3>Related Reading</h3>
<p>
</p>
</div>	</div></body></html>