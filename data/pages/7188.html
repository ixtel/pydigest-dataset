<html><body><div><div><p>When testing your application, you'll often come across the need to test that
your application behaves correct across a range of inputs or conditions.
Instead of repetitively defining the same test scaffolding, let's use some
meta-programming to build our tests methods from a list of parameters.
<a href="https://nose.readthedocs.org/en/latest/">Nose</a> has support for <a href="https://nose.readthedocs.org/en/latest/writing_tests.html#test-generators">Generator Tests</a>, but they don't
work with python's <code>unittest</code> framework.  Let's walk-through how to build our
own test generator that does.</p>

<h1 id="our-test-case">Our Test Case</h1>
<p>So let's write a simple application for demonstration.  We want to see if our
input string is alphabetized.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">is_alphabetized</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">==</span> <span class="n">value</span>
</pre></div>
<p>Now let's write a unit test case to check our implementation:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">IsAlphabetizedTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_is_alphabetized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="s">'abcd'</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_is_not_alphabetized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="s">'zyxw'</span><span class="p">))</span>
</pre></div>
<p>We can go ahead and run these tests and they should pass:</p>
<div class="highlight"><pre>&gt; nosetests example
..
----------------------------------------------------------------------
Ran <span class="m">2</span> tests in 0.000s

OK
</pre></div>
<p>But as you can see, our two test methods only tested simple examples.  What we
really want to test is our function over a wide range of inputs to ensure our
implementation is robust.</p>
<p>At this point, your thought is usually to iterate over a range of cases in your method, and assert that each of them works as desired:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">IsAlphabetizedTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_is_alphabetized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">''</span><span class="p">,</span>
            <span class="s">'a'</span><span class="p">,</span>
            <span class="s">'aaaaa'</span><span class="p">,</span>
            <span class="s">'ab'</span><span class="p">,</span>
            <span class="s">'abcd'</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
</pre></div>
<p>But you lose the benefit of having a single assertion in your test.  You can't
isolate your test run to a single input.  What if your test requires a setup
or teardown after each case?  You can't use all the advantages of the test
framework.</p>
<p>Let's say you have this setup and you get bug report that our naive
implementation above doesn't work correctly for <code>A-Cert</code> as well as one for <code>iOS</code>.  Since we're big fans
of TDD, we'll plug that in our test case of expected inputs:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">.alphabetical</span> <span class="kn">import</span> <span class="n">is_alphabetized</span>

<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">IsAlphabetizedTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_is_alphabetized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">''</span><span class="p">,</span>
            <span class="s">'a'</span><span class="p">,</span>
            <span class="s">'aaaaa'</span><span class="p">,</span>
            <span class="s">'ab'</span><span class="p">,</span>
            <span class="s">'abcd'</span><span class="p">,</span>
            <span class="s">'A-Cert'</span><span class="p">,</span>
            <span class="s">'iOS'</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
</pre></div>
<p>And give it a run:</p>
<div class="highlight"><pre><span class="o">======================================================================</span>
FAIL: test_is_alphabetized <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 34, in test_is_alphabetized
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">))</span>
AssertionError: False is not <span class="nb">true</span>

----------------------------------------------------------------------
</pre></div>
<p>But as you can see, we don't know which test failed.  We should update our
test case to indicate which word failed:</p>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_is_alphabetized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">''</span><span class="p">,</span>
            <span class="s">'a'</span><span class="p">,</span>
            <span class="s">'aaaaa'</span><span class="p">,</span>
            <span class="s">'ab'</span><span class="p">,</span>
            <span class="s">'abcd'</span><span class="p">,</span>
            <span class="s">'A-Cert'</span><span class="p">,</span>
            <span class="s">'iOS'</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="s">u'{} was not considered alphabetized'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
</pre></div>
<div class="highlight"><pre><span class="o">======================================================================</span>
FAIL: test_is_alphabetized <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 46, in test_is_alphabetized
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: A-Cert was not considered alphabetized

----------------------------------------------------------------------
</pre></div>
<p>Now we at least know which word failed.  But what about <code>iOS</code>?  Because the
test exits on the first failure, we're unsure if that bug report was valid or
not.</p>
<p>Before we go fixing our <code>is_alphabetical</code> implementation to handle the
punctuation and capitalization, let's figure out how to get both inputs to
fail.</p>
<p>Instead of looping in our test method, we could instead write separate test methods for each input:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">IsAlphabetizedTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_is_alphabetized_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="s">''</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_is_alphabetized_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="s">'a'</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_is_alphabetized_aaaaa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="s">'aaaaa'</span><span class="p">))</span>

    <span class="o">...</span>
</pre></div>
<p>But boy is that exhausting having to repeat ourselves for each test.  Instead,
we'd like to provide the list of inputs as before, but have individual test
methods generated for us.  Nose actually supports this out of the box with
<a href="https://nose.readthedocs.org/en/latest/writing_tests.html#test-generators">Generator Tests</a>, but you can't use them with python
<code>unittest.TestCase</code> and we'd lose any of help we get using the framework.</p>
<p>But we can work around that limitation.  We just need to define a new test
method on our test class for each input and nose will run them just like any
other test method.</p>
<p>What we need to do is transform that list of inputs into individual test
methods.  Instead of us manually writing all those test methods, what if we
wrote a function that wrote the test class for us?</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">IsAlphabetizedTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">add_methods</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Take a TestCase and add a test method for each input</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">test_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="s">u'{} was not considered alphabetized'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>

        <span class="n">klass</span><span class="o">.</span><span class="n">test_input</span> <span class="o">=</span> <span class="n">test_input</span>


<span class="n">add_methods</span><span class="p">(</span>
    <span class="n">IsAlphabetizedTestCase</span><span class="p">,</span>
    <span class="s">''</span><span class="p">,</span>
    <span class="s">'a'</span><span class="p">,</span>
    <span class="s">'aaaaa'</span><span class="p">,</span>
    <span class="s">'ab'</span><span class="p">,</span>
    <span class="s">'abcd'</span><span class="p">,</span>
    <span class="s">'A-Cert'</span><span class="p">,</span>
    <span class="s">'iOS'</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
<p>Running those tests, we see:</p>
<div class="highlight"><pre><span class="o">======================================================================</span>
FAIL: test_input <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 16, in test_input
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: iOS was not considered alphabetized

----------------------------------------------------------------------
Ran <span class="m">2</span> tests in 0.001s

FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1, <span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</pre></div>
<p>What happened?  Shouldn't there be more tests?  Well, we kept clobbering our
test in the klass.  The trick is to give each test a unique name.</p>
<p>Let's assign the test to the class using <code>setattr</code> with a custom name:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">add_methods</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Take a TestCase and add a test method for each input</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
        <span class="n">test_name</span> <span class="o">=</span> <span class="s">'test_alphabetical_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="s">u'{} was not considered alphabetized'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span>
</pre></div>
<p>Now running the tests:</p>
<div class="highlight"><pre><span class="o">======================================================================</span>
FAIL: test_alphabetical_ <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 18, in test_input
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: iOS was not considered <span class="nv">alphabetized</span>

<span class="o">======================================================================</span>
FAIL: test_alphabetical_A-Cert <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 18, in test_input
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: iOS was not considered alphabetized

<span class="o">[</span>...<span class="o">]</span>

----------------------------------------------------------------------
Ran <span class="m">7</span> tests in 0.001s

FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>7<span class="o">)</span>
</pre></div>
<p>Why are all tests failing with <code>iOS</code>?  It should be running with each variant
of our input.  Turns out this is due to variable scoping in python.  In
python2, there's only two levels of scoping: function and global.  So as we
loop and define <code>test_input</code>, the value of <code>input</code> is being updated.  When our
test methods are actually evaluated, it's always equal to the last value
(<code>iOS</code>).</p>
<p>To fix that, we'll define yet another function to capture the value of input
(remember there's function scoping):</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">make_method</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="n">test_name</span> <span class="o">=</span> <span class="s">'test_alphabetical_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="s">u'{} was not considered alphabetized'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_input</span>


<span class="k">def</span> <span class="nf">add_methods</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Take a TestCase and add a test method for each input</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
        <span class="n">test_name</span><span class="p">,</span> <span class="n">test_input</span> <span class="o">=</span> <span class="n">make_method</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span>
</pre></div>
<p>With these changes, we finally get the results we expected:</p>
<div class="highlight"><pre><span class="o">======================================================================</span>
FAIL: test_alphabetical_A-Cert <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 14, in test_input
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: A-Cert was not considered <span class="nv">alphabetized</span>

<span class="o">======================================================================</span>
FAIL: test_alphabetical_iOS <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 14, in test_input
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: iOS was not considered alphabetized

----------------------------------------------------------------------
Ran <span class="m">7</span> tests in 0.001s

FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>2<span class="o">)</span>
</pre></div>
<p>There you go, we are able to generate N test methods to validate our
alphabetical function.  Adding a new test is as simple as extending the list
of inputs.</p>
<h1 id="improving-the-test-generation">Improving the Test Generation</h1>
<p>So we now have the ability to generate tests from an input list, but it
involves a few methods and our test is now deeply nested in a helper factory.
Let's improve this so we can use this more universally.</p>
<p>First thing to notice is that <code>add_methods</code> takes a class as the first
argument.  That looks awfully like a decorator.  Let's make a few tweaks so we
can use it to decorate our test class:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">add_methods</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Take a TestCase and add a test method for each input</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">test_name</span><span class="p">,</span> <span class="n">test_input</span> <span class="o">=</span> <span class="n">make_method</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">klass</span>

    <span class="k">return</span> <span class="n">decorator</span>


<span class="nd">@add_methods</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'aaaaa'</span><span class="p">,</span> <span class="s">'ab'</span><span class="p">,</span> <span class="s">'abcd'</span><span class="p">,</span> <span class="s">'A-Cert'</span><span class="p">,</span> <span class="s">'iOS'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">IsAlphabetizedTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>All we did was wrap our method generation in a <code>decorator</code> function that takes
an input class, adds the method and returns the class.</p>
<h2 id="naming-the-test-functions">Naming the Test Functions</h2>
<p>if you inspect the test class, even though we have methods under unique names
based on the input (like <code>test_input_iOS</code>), we can't reference those class
names when using nose because they all are still just named <code>test_input</code>:</p>
<div class="highlight"><pre><span class="n">ipdb</span><span class="o">&gt;</span> <span class="n">pp</span> <span class="n">IsAlphabetizedTestCase</span><span class="o">.</span><span class="n">test_alphabetical_iOS</span>
<span class="o">&lt;</span><span class="n">unbound</span> <span class="n">method</span> <span class="n">IsAlphabetizedTestCase</span><span class="o">.</span><span class="n">test_input</span><span class="o">&gt;</span>
</pre></div>
<p>To fix this, we need to set the <code>__name__</code> attribute on the function when
generating it.  This has the extra benefit of not needing to return a name for
the assignment, we can just use the same:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">make_method</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="s">u'{} was not considered alphabetized'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>

    <span class="n">test_input</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="s">'test_alphabetical_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_input</span>


<span class="k">def</span> <span class="nf">add_methods</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Take a TestCase and add a test method for each input</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">test_input</span> <span class="o">=</span> <span class="n">make_method</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">test_input</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">klass</span>

    <span class="k">return</span> <span class="n">decorator</span>
</pre></div>
<p>Now with the function named accurately, we can specify a single test method to run:</p>
<div class="highlight"><pre>nosetests example/test_alphabetical.py:IsAlphabetizedTestCase.test_alphabetical_iOS
<span class="nv">F</span>
<span class="o">======================================================================</span>
FAIL: test_alphabetical_iOS <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 8, in test_input
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: iOS was not considered alphabetized

----------------------------------------------------------------------
Ran <span class="m">1</span> <span class="nb">test </span>in 0.001s

FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</pre></div>
<h1 id="generalize-the-test-method-factory">Generalize the Test Method Factory</h1>
<p>So our class decorator works well for our single test method generator.  But
what if we have multiple test methods we want to generate?  Remember our
initial example also included expected False results?  Let's make it so we can
pass in the test method:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">.alphabetical</span> <span class="kn">import</span> <span class="n">is_alphabetized</span>

<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">def</span> <span class="nf">assert_is_alphabetized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="s">u'{} was not considered alphabetized'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">assert_is_not_alphabetized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">is_alphabetized</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="s">u'{} was considered alphabetized'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">make_method</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>

    <span class="n">test_input</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="s">'test_{func}_{input}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_input</span>


<span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Take a TestCase and add a test method for each input</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">test_input</span> <span class="o">=</span> <span class="n">make_method</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">test_input</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">test_input</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">klass</span>

    <span class="k">return</span> <span class="n">decorator</span>


<span class="nd">@generate</span><span class="p">(</span><span class="n">assert_is_alphabetized</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'aaaaa'</span><span class="p">,</span> <span class="s">'ab'</span><span class="p">,</span> <span class="s">'abcd'</span><span class="p">,</span> <span class="s">'A-Cert'</span><span class="p">,</span> <span class="s">'iOS'</span><span class="p">)</span>
<span class="nd">@generate</span><span class="p">(</span><span class="n">assert_is_not_alphabetized</span><span class="p">,</span> <span class="s">'ba'</span><span class="p">,</span> <span class="s">'aba'</span><span class="p">,</span> <span class="s">'bob'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">IsAlphabetizedTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Now we can run all </p>
<div class="highlight"><pre><span class="o">======================================================================</span>
FAIL: test_assert_is_alphabetized_A-Cert <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 17, in test_input
    func<span class="o">(</span>self, input<span class="o">)</span>
  File <span class="s2">"example/test_alphabetical.py"</span>, line 7, in assert_is_alphabetized
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: A-Cert was not considered <span class="nv">alphabetized</span>

<span class="o">======================================================================</span>
FAIL: test_assert_is_alphabetized_iOS <span class="o">(</span>example.test_alphabetical.IsAlphabetizedTestCase<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"example/test_alphabetical.py"</span>, line 17, in test_input
    func<span class="o">(</span>self, input<span class="o">)</span>
  File <span class="s2">"example/test_alphabetical.py"</span>, line 7, in assert_is_alphabetized
    self.assertTrue<span class="o">(</span>is_alphabetized<span class="o">(</span>input<span class="o">)</span>, u<span class="s1">'{} was not considered alphabetized'</span>.format<span class="o">(</span>input<span class="o">))</span>
AssertionError: iOS was not considered alphabetized

----------------------------------------------------------------------
Ran <span class="m">10</span> tests in 0.001s

FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>2<span class="o">)</span>
</pre></div>
<h1 id="conclusion">Conclusion</h1>
<p>Now with these handy generated test methods, we can make the necessary fixes
to our <code>is_alphabetical</code> function:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">is_alphabetized</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r'[^a-z]'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">==</span> <span class="n">value</span>
</pre></div>
<div class="highlight"><pre>----------------------------------------------------------------------
Ran <span class="m">10</span> tests in 0.001s

OK
</pre></div>
<p>Ah, so satisfying....</p></div>

    </div></body></html>