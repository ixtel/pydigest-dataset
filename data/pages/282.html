<html><body><div><div class="entry-content clearfix"><a name="Last.Updated:"/>
<h3>Last Updated:</h3>

<ol>
<li>01/29/2014 – updated code for the form (thanks vic!)</li>
<li>12/29/2013 – restructured entire blog post</li>
</ol>


<hr/>


<p>Test Driven Development (TDD) is an iterative development cycle that emphasizes writing automated tests before writing the actual code.</p>

<p>The process is simple:</p>

<ol>
<li>Write your tests first.</li>
<li>Watch them fail.</li>
<li>Write just enough code to make those tests pass.</li>
<li>Test again.</li>
<li>Refactor.</li>
<li>Repeat.</li>
</ol>


<p><img src="https://raw.github.com/mjhea0/flaskr-tdd/master/static/tdd.png" alt="tdd-process"/></p>

<a name="Why.TDD."/>
<h2>Why TDD?</h2>

<p>With TDD, you’ll learn to break code up into logical, easily understandable pieces, helping ensure the correctness of code.</p>

<p>This is important because it’s hard to-</p>

<ol>
<li>Solve complex problems all at once in our heads;</li>
<li>Know when and where to start working on a problem;</li>
<li>Increase the complexity of a codebase without introducing errors and bugs; and</li>
<li>Recognize when code breaks occur.</li>
</ol>


<p>TDD helps address these issues. It in no way guarantees that your code will be error free; however, you will write better code, which results in a better understanding of the code. This in itself will help with eliminating errors and at the very least, you will be able to address errors much easier.</p>

<p>TDD is practically an industry standard as well.</p>

<p>Enough talk. Let’s get to the code.</p>

<p>For this tutorial, we’ll be creating an app to store user contacts.</p>

<blockquote><p>Please note: This tutorial assumes you are running a Unix-based environment – e.g, Mac OSX, straight Linux, or Linux VM through Windows. I will also be using Sublime 2 as my text editor. Also, make sure you you’ve completed the official Django <a href="https://docs.djangoproject.com/en/1.6/intro/tutorial01/">tutorial</a> and have a basic understanding of the Python language. <strong>Also, in this first post, we will not yet get into some of the new tools available in Django 1.6. This post sets the foundation for subsequent posts that deal with different forms of testing.</strong></p></blockquote>

<a name="First.Test"/>
<h2>First Test</h2>

<p>Before we do anything we need to first setup a test. For this test we just want to make that Django is properly setup. We’re going to be using a functional test for this – which we’ll be explained further down.</p>

<p>Create a new directory to hold your project:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>mkdir django-tdd
</span><span class="line"><span class="nv">$ </span><span class="nb">cd </span>django-tdd
</span></code></pre></td></tr></table></div></figure>


<p>Now setup a new directory to hold your functional tests:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>Create a new file called “tests.py” and add the following code:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span><span class="line">
</span><span class="line"><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
</span><span class="line"><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://localhost:8000/'</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">body</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line"><span class="k">assert</span> <span class="s">'Django'</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span>
</span><span class="line">
</span><span class="line"><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now run the test:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<blockquote><p>Make sure you have selenium installed – <code>pip install selenium</code></p></blockquote>

<p>You should see FireFox pop up and attempt to navigate to <a href="http://localhost:8000/.">http://localhost:8000/.</a> In your terminal you should see:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class="line">File <span class="s2">"tests.py"</span>, line 7, in &lt;module&gt;
</span><span class="line">  assert <span class="s1">'Django'</span> in body.text
</span><span class="line">AssertionError
</span></code></pre></td></tr></table></div></figure>


<p>Congrats! You wrote your first failing test.</p>

<p>Now let’s write just enough code to make it pass, which simply amounts to setting up a Django development environment.</p>

<a name="Setup.Django"/>
<h2>Setup Django</h2>

<p>Activate a virtualenv:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span><span class="nb">cd</span> ..
</span><span class="line"><span class="nv">$ </span>virtualenv --no-site-packages env
</span><span class="line"><span class="nv">$ </span><span class="nb">source </span>env/bin/activate
</span></code></pre></td></tr></table></div></figure>


<p>Install Django and setup a Project:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>pip install <span class="nv">django</span><span class="o">==</span>1.6.1
</span><span class="line"><span class="nv">$ </span>django-admin.py startproject contacts
</span></code></pre></td></tr></table></div></figure>


<p>Your current project structure should look like this:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">├── contacts
</span><span class="line">│   ├── contacts
</span><span class="line">│   │   ├── __init__.py
</span><span class="line">│   │   ├── settings.py
</span><span class="line">│   │   ├── urls.py
</span><span class="line">│   │   └── wsgi.py
</span><span class="line">│   └── manage.py
</span><span class="line">└── ft
</span><span class="line">    └── tests.py
</span></code></pre></td></tr></table></div></figure>


<p>Install Selenium:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">pip install <span class="nv">selenium</span><span class="o">==</span>2.39.0
</span></code></pre></td></tr></table></div></figure>


<p>Run the server:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span><span class="nb">cd </span>contacts
</span><span class="line"><span class="nv">$ </span>python manage.py runserver
</span></code></pre></td></tr></table></div></figure>


<p>Next, open up a new window in your terminal, navigate to the “ft” directory, then run the test again:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>You should see the FireFox window navigate to <a href="http://localhost:8000/">http://localhost:8000/</a> again. This time there should be no errors. Nice. You just passed your first test!</p>

<p>Now, let’s finish setting up our dev environment.</p>

<a name="Version.Control"/>
<h2>Version Control</h2>

<p>First, add a “.gitignore” and include the following code in the file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">.Python
</span><span class="line">env
</span><span class="line">bin
</span><span class="line">lib
</span><span class="line">include
</span><span class="line">.DS_Store
</span><span class="line">.pyc
</span></code></pre></td></tr></table></div></figure>


<p>Now create a Git repository and commit:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>git init
</span><span class="line"><span class="nv">$ </span>git add .
</span><span class="line"><span class="nv">$ </span>git commit -am <span class="s2">"initial"</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the project setup, let’s take a step back and discuss functional tests.</p>

<a name="Functional.Tests"/>
<h2>Functional Tests</h2>

<p>We approached the first test through Selenium via Functional tests. Such tests let us drive the web browser as if we were the end user, to see how the application actually <em>functions</em>. Since these tests follow the behavior of the end user – also called a User Story – it involves the testing of a number of features, rather than just a single function – which is more appropriate for Unit tests. <strong>It’s important to note that when testing code you have not written, you should begin with functional tests.</strong> Since we are essentially testing Django code, functional tests are the right way to go.</p>

<blockquote><p>Another way to think about functional vs unit tests is that Functional tests focus on testing the app from the outside, from the user’s perspective, while unit tests focus on the app from the inside, from the developer’s perspective.</p></blockquote>

<p>This will make much more sense in practice.</p>

<p>Before moving on, let’s restructure our testing environment to make testing easier.</p>

<p>First, let’s re-write the first test in the “tests.py” file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">LiveServerTestCase</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_admin_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="c"># user opens web browser, navigates to admin page</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/admin/'</span><span class="p">)</span>
</span><span class="line">        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Django administration'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then run it:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python manage.py <span class="nb">test </span>ft
</span></code></pre></td></tr></table></div></figure>


<p>It should pass:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">----------------------------------------------------------------------
</span><span class="line">Ran 1 <span class="nb">test </span>in 3.304s
</span><span class="line">
</span><span class="line">OK
</span></code></pre></td></tr></table></div></figure>


<p>Congrats!</p>

<p> Before moving on, let’s see what’s going on here. If all went well it should pass. You should also see FireFox open and go through the process we indicated in the test with the <code>setUp()</code> and <code>tearDown()</code> functions. The test itself is simply testing whether the “/admin” (<code>self.browser.get(self.live_server_url + '/admin/'</code>) page can be found and that the words “Django administration” are present in the body tag.</p>

<p> Let’s confirm this.</p>

<p>Run the server:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python manage.py runserver
</span></code></pre></td></tr></table></div></figure>


<p>Then navigate to <a href="http://localhost:8000/admin/">http://localhost:8000/admin/</a> in your browser and you should see:</p>

<p><img src="https://raw.github.com/mjhea0/django-tdd/master/admin.png" alt="admin-page"/></p>

<p>We can confirm that the test is working correctly by simply testing for the wrong thing. Update the last line in the test to:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'administration Django'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run it again. You should see the following error (which is expected, of course):</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">AssertionError: <span class="s1">'administration Django'</span> not found in u<span class="s1">'Django administration\nUsername:\nPassword:\n '</span>
</span></code></pre></td></tr></table></div></figure>


<p>Correct the test. Test it again. Commit the code.</p>

<p>Finally, did you notice that we started the function name for the actual test began with <code>test_</code>. This is so that the Django test runner can find the test. In other words, any function that begins with <code>test_</code> will be treated as a test by the test runner.</p>

<a name="Admin.Login"/>
<h3>Admin Login</h3>

<p>Next, let’s test to make sure the user can login to the admin site.</p>

<p>Update <code>test_admin_site</code> the function in “tests.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">test_admin_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">    <span class="c"># user opens web browser, navigates to admin page</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/admin/'</span><span class="p">)</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Django administration'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">    <span class="c"># users types in username and passwords and presses enter</span>
</span><span class="line">    <span class="n">username_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
</span><span class="line">    <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span class="line">    <span class="c"># login credentials are correct, and the user is redirected to the main admin page</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Site administration'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>So –</p>

<ul>
<li><code>find_element_by_name</code> – is used for locating the input fields</li>
<li><code>send_keys</code> – sends keystrokes</li>
</ul>


<p>Run the test. You should see this error:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">AssertionError: <span class="s1">'Site administration'</span> not found in u<span class="s1">'Django administration\nPlease enter the correct username and password for a staff account. Note that both fields may be case-sensitive.\nUsername:\nPassword:\n '</span>
</span></code></pre></td></tr></table></div></figure>


<p>This failed because we don’t have an admin user setup. This is an expected failure, which is good. In other words, we knew it would fail – which makes it much easier to fix.</p>

<p>Sync the database:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python manage.py syncdb
</span></code></pre></td></tr></table></div></figure>


<p>Setup an admin user.</p>

<p>Test again. It should fail again. Why? Django creates a copy of our database when tests are ran so that way tests do not affect the production database.</p>

<p>We need to setup a Fixture, which is a file containing data we want loaded into the test database: the login credentials. To do that, run these commands to dump the admin user info from the database to the Fixture:</p>

<p> <code>sh
 $ mkdir ft/fixtures
 $ python manage.py dumpdata auth.User --indent=2 &gt; ft/fixtures/admin.json
</code></p>

<p> Now update the <code>AdminTest</code> class:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="c"># load fixtures</span>
</span><span class="line">    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">'admin.json'</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_admin_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="c"># user opens web browser, navigates to admin page</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/admin/'</span><span class="p">)</span>
</span><span class="line">        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Django administration'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">        <span class="c"># users types in username and passwords and presses enter</span>
</span><span class="line">        <span class="n">username_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
</span><span class="line">        <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">        <span class="n">password_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
</span><span class="line">        <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">        <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span class="line">        <span class="c"># login credentials are correct, and the user is redirected to the main admin page</span>
</span><span class="line">        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Site administration'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the test. It should pass.</p>

<blockquote><p>Each time a test is ran, Django dumps the test database. Then all the Fixtures specified in the “test.py” file are loaded into the database.</p></blockquote>

<p>Let’s add one more assert. Update the test again:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">test_admin_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">    <span class="c"># user opens web browser, navigates to admin page</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/admin/'</span><span class="p">)</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Django administration'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">    <span class="c"># users types in username and passwords and presses enter</span>
</span><span class="line">    <span class="n">username_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
</span><span class="line">    <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span class="line">    <span class="c"># login credentials are correct, and the user is redirected to the main admin page</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Site administration'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">    <span class="c"># user clicks on the Users link</span>
</span><span class="line">    <span class="n">user_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_link_text</span><span class="p">(</span><span class="s">'Users'</span><span class="p">)</span>
</span><span class="line">    <span class="n">user_link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">    <span class="c"># user verifies that user live@forever.com is present</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'live@forever.com'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run it. It should fail, because we need to and another user to the fixture file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">[</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">  <span class="s2">"pk"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class="line">  <span class="s2">"model"</span><span class="o">:</span> <span class="s2">"auth.user"</span><span class="p">,</span>
</span><span class="line">  <span class="s2">"fields"</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">    <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"admin"</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"first_name"</span><span class="o">:</span> <span class="s2">""</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"last_name"</span><span class="o">:</span> <span class="s2">""</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"is_active"</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"is_superuser"</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"is_staff"</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"last_login"</span><span class="o">:</span> <span class="s2">"2013-12-29T03:49:13.545Z"</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"groups"</span><span class="o">:</span> <span class="p">[],</span>
</span><span class="line">    <span class="s2">"user_permissions"</span><span class="o">:</span> <span class="p">[],</span>
</span><span class="line">    <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"pbkdf2_sha256$12000$VtsgwjQ1BZ6u$zwnG+5E5cl8zOnghahArLHiMC6wGk06HXrlAijFFpSA="</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"email"</span><span class="o">:</span> <span class="s2">"ad@min.com"</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"date_joined"</span><span class="o">:</span> <span class="s2">"2013-12-29T03:49:13.545Z"</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">},</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">  <span class="s2">"pk"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class="line">  <span class="s2">"model"</span><span class="o">:</span> <span class="s2">"auth.user"</span><span class="p">,</span>
</span><span class="line">  <span class="s2">"fields"</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">    <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"live"</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"first_name"</span><span class="o">:</span> <span class="s2">""</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"last_name"</span><span class="o">:</span> <span class="s2">""</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"is_active"</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"is_superuser"</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"is_staff"</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"last_login"</span><span class="o">:</span> <span class="s2">"2013-12-29T03:49:13.545Z"</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"groups"</span><span class="o">:</span> <span class="p">[],</span>
</span><span class="line">    <span class="s2">"user_permissions"</span><span class="o">:</span> <span class="p">[],</span>
</span><span class="line">    <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"pbkdf2_sha256$12000$VtsgwjQ1BZ6u$zwnG+5E5cl8zOnghahArLHiMC6wGk06HXrlAijFFpSA="</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"email"</span><span class="o">:</span> <span class="s2">"live@forever.com"</span><span class="p">,</span>
</span><span class="line">    <span class="s2">"date_joined"</span><span class="o">:</span> <span class="s2">"2013-12-29T03:49:13.545Z"</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run it again. Make sure it passes. Refactor the test if needed. Now think about what else you could test. Perhaps you could test to make sure the admin user can add a user in the Admin panel. Or perhaps a test to ensure that someone without admin access cannot access the Admin panel. Write a few more tests. Update your code. Test again. Refactor if necessary.</p>

<p>Next, we’re going to add the app for adding contacts. Don’t forget to commit!</p>

<a name="Setup.the.Contacts.App"/>
<h3>Setup the Contacts App</h3>

<p>Start with a test. Add the following function:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">test_create_contact_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/admin/'</span><span class="p">)</span>
</span><span class="line">    <span class="n">username_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
</span><span class="line">    <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span class="line">    <span class="c"># user verifies that user_contacts is present</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'User_Contacts'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the test suite again. You should see the following error-</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">AssertionError: <span class="s1">'User_Contacts'</span> not found in u<span class="s1">'Django administration\nWelcome, admin. Change password / Log out\nSite administration\nAuth\nGroups\nAdd\nChange\nUsers\nAdd\nChange\nRecent Actions\nMy Actions\nNone available'</span>
</span></code></pre></td></tr></table></div></figure>


<p> -which is expected.</p>

<p> Now, write just enough code for this to pass.</p>

<p>Create the App:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python manage.py startapp user_contacts
</span></code></pre></td></tr></table></div></figure>


<p>Add it to the “settings.py” file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class="line">    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'ft'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'user_contacts'</span><span class="p">,</span>
</span><span class="line"><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Within the “admin.py” file in the <code>user_contacts</code> directory add the following code:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.models</span> <span class="kn">import</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Phone</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class="line">
</span><span class="line"><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
</span><span class="line"><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Phone</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Your project structure should now look like this:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">.
</span><span class="line">├── user_contacts
</span><span class="line">│   ├── __init__.py
</span><span class="line">│   ├── admin.py
</span><span class="line">│   ├── models.py
</span><span class="line">│   ├── tests.py
</span><span class="line">│   └── views.py
</span><span class="line">├── contacts
</span><span class="line">│   ├── __init__.py
</span><span class="line">│   ├── settings.py
</span><span class="line">│   ├── urls.py
</span><span class="line">│   └── wsgi.py
</span><span class="line">├── ft
</span><span class="line">│   ├── __init__.py
</span><span class="line">│   ├── fixtures
</span><span class="line">│   │   └── admin.json
</span><span class="line">│   └── tests.py
</span><span class="line">└── manage.py
</span></code></pre></td></tr></table></div></figure>


<p>Update “models.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
</span><span class="line">    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
</span><span class="line">    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">    <span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span><span class="s">", "</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Phone</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">person</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">'Person'</span><span class="p">)</span>
</span><span class="line">    <span class="n">number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the test again now. You should now see:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">Ran 2 tests in 11.730s
</span><span class="line">
</span><span class="line">OK
</span></code></pre></td></tr></table></div></figure>


<p>Let’s go ahead and add to the test to make sure the admin can add data:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c"># user clicks on the Persons link</span>
</span><span class="line"><span class="nv">persons_links</span> <span class="o">=</span> self.browser.find_elements_by_link_text<span class="o">(</span><span class="s1">'Persons'</span><span class="o">)</span>
</span><span class="line">persons_links<span class="o">[</span>0<span class="o">]</span>.click<span class="o">()</span>
</span><span class="line"><span class="c"># user clicks on the Add person link</span>
</span><span class="line"><span class="nv">add_person_link</span> <span class="o">=</span> self.browser.find_element_by_link_text<span class="o">(</span><span class="s1">'Add person'</span><span class="o">)</span>
</span><span class="line">add_person_link.click<span class="o">()</span>
</span><span class="line"><span class="c"># user fills out the form</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'first_name'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"Michael"</span><span class="o">)</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'last_name'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"Herman"</span><span class="o">)</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'email'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"michael@realpython.com"</span><span class="o">)</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'address'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"2227 Lexington Ave"</span><span class="o">)</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'city'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"San Francisco"</span><span class="o">)</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'state'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"CA"</span><span class="o">)</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'country'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"United States"</span><span class="o">)</span>
</span><span class="line"><span class="c"># user clicks the save button</span>
</span><span class="line">self.browser.find_element_by_css_selector<span class="o">(</span><span class="s2">"input[value='Save']"</span><span class="o">)</span>.click<span class="o">()</span>
</span><span class="line"><span class="c"># the Person has been added</span>
</span><span class="line"><span class="nv">body</span> <span class="o">=</span> self.browser.find_element_by_tag_name<span class="o">(</span><span class="s1">'body'</span><span class="o">)</span>
</span><span class="line">self.assertIn<span class="o">(</span><span class="s1">'Herman, Michael'</span>, body.text<span class="o">)</span>
</span><span class="line"><span class="c"># user returns to the main admin screen</span>
</span><span class="line"><span class="nv">home_link</span> <span class="o">=</span> self.browser.find_element_by_link_text<span class="o">(</span><span class="s1">'Home'</span><span class="o">)</span>
</span><span class="line">home_link.click<span class="o">()</span>
</span><span class="line"><span class="c"># user clicks on the Phones link</span>
</span><span class="line"><span class="nv">persons_links</span> <span class="o">=</span> self.browser.find_elements_by_link_text<span class="o">(</span><span class="s1">'Phones'</span><span class="o">)</span>
</span><span class="line">persons_links<span class="o">[</span>0<span class="o">]</span>.click<span class="o">()</span>
</span><span class="line"><span class="c"># user clicks on the Add phone link</span>
</span><span class="line"><span class="nv">add_person_link</span> <span class="o">=</span> self.browser.find_element_by_link_text<span class="o">(</span><span class="s1">'Add phone'</span><span class="o">)</span>
</span><span class="line">add_person_link.click<span class="o">()</span>
</span><span class="line"><span class="c"># user finds the person in the dropdown</span>
</span><span class="line"><span class="nv">el</span> <span class="o">=</span> self.browser.find_element_by_name<span class="o">(</span><span class="s2">"person"</span><span class="o">)</span>
</span><span class="line"><span class="k">for </span>option in el.find_elements_by_tag_name<span class="o">(</span><span class="s1">'option'</span><span class="o">)</span>:
</span><span class="line">    <span class="k">if </span>option.text <span class="o">==</span> <span class="s1">'Herman, Michael'</span>:
</span><span class="line">        option.click<span class="o">()</span>
</span><span class="line"><span class="c"># user adds the phone numbers</span>
</span><span class="line">self.browser.find_element_by_name<span class="o">(</span><span class="s1">'number'</span><span class="o">)</span>.send_keys<span class="o">(</span><span class="s2">"4158888888"</span><span class="o">)</span>
</span><span class="line"><span class="c"># user clicks the save button</span>
</span><span class="line">self.browser.find_element_by_css_selector<span class="o">(</span><span class="s2">"input[value='Save']"</span><span class="o">)</span>.click<span class="o">()</span>
</span><span class="line"><span class="c"># the Phone has been added</span>
</span><span class="line"><span class="nv">body</span> <span class="o">=</span> self.browser.find_element_by_tag_name<span class="o">(</span><span class="s1">'body'</span><span class="o">)</span>
</span><span class="line">self.assertIn<span class="o">(</span><span class="s1">'4158888888'</span>, body.text<span class="o">)</span>
</span><span class="line"><span class="c"># user logs out</span>
</span><span class="line">self.browser.find_element_by_link_text<span class="o">(</span><span class="s1">'Log out'</span><span class="o">)</span>.click<span class="o">()</span>
</span><span class="line"><span class="nv">body</span> <span class="o">=</span> self.browser.find_element_by_tag_name<span class="o">(</span><span class="s1">'body'</span><span class="o">)</span>
</span><span class="line">self.assertIn<span class="o">(</span><span class="s1">'Thanks for spending some quality time with the Web site today.'</span>, body.text<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>That’s it for the admin functionality. Let’s switch gears and focus on the application, <code>user_contacts</code>, itself. Did you forget to commit? If so, do it now.</p>

<a name="Unit.Tests"/>
<h2>Unit Tests</h2>

<p>Think about the features we have written thus far. We’ve just defined our model and allowed admins to alter the model. Based on that, and the overall goal of our Project, focus on the remaining user functionalities.</p>

<p>Users should be able to-</p>

<ol>
<li>View all contacts.</li>
<li>Add new contacts.</li>
</ol>


<p>Try to formulate the remaining Functional test(s) based on those requirements. Before we write the functional tests, though, we should define the behavior of the code through <a href="http://docs.python.org/2/library/unittest.html">unit tests</a> – which will help you write good, clean code, making it easier to write the Functional tests.</p>

<blockquote><p><strong>Remember</strong>: Functional tests are the ultimate indicator of whether your Project works or not, while Unit tests are the means to help you reach that end. This will all make sense soon.</p></blockquote>

<p>Let’s pause for a minute and talk about some conventions.</p>

<p>Although the basics of TDD (or ends) – test, code, refactor – are universal, many developers approach the means differently. For example, I like to write my unit tests first, to ensure that my code works at a granular level, then write the functional tests. Others write functional tests first, watch them fail, then write unit tests, watch them fail, then write code to first satisfy the unit tests, which should ultimately satisfy the functional tests. There’s no right or wrong answer here. Do what feels most comfortable – but continue to test first, then write code, and finally refactor.</p>

<a name="Views"/>
<h3>Views</h3>

<p>First, check to make sure all the views are setup correctly.</p>

<a name="Main.View"/>
<h3>Main View</h3>

<p>As always, start with a test:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">Client</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.models</span> <span class="kn">import</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Phone</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.views</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">ViewTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_view_home_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Name this test <code>test_views.py</code> and save it in the <code>user_contacts/tests</code> directory. Also add an <code>__init__.py</code> file to the directory and delete the “tests.py” file in the main <code>user_contacts</code> directory.</p>

<p>Run it:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python manage.py <span class="nb">test </span>user_contacts
</span></code></pre></td></tr></table></div></figure>


<p>It should fail – <code>AssertionError: 404 != 200</code> – because the URL, View, and the Template do not exist. If you’re unfamiliar with how Django handles the MVC architecture, please read the short article <a href="https://docs.djangoproject.com/en/dev/faq/general/#django-appears-to-be-a-mvc-framework-but-you-call-the-controller-the-view-and-the-view-the-template-how-come-you-don-t-use-the-standard-names">here</a>.</p>

<p>The test is simple. We first GET the url “/” using the Client, which is part of Django’s <code>TestCase</code>. The response is stored, then we check to make sure the returned status code is equal to 200.</p>

<p>Add the following route to “contacts/urls.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">url</span><span class="p">(</span><span class="s">r'^'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'user_contacts.urls'</span><span class="p">)),</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update “user_contacts/urls.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.views</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class="line">
</span><span class="line"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>
</span><span class="line">      <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">home</span><span class="p">),</span>
</span><span class="line"><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update “views.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">render</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.models</span> <span class="kn">import</span> <span class="n">Phone</span><span class="p">,</span> <span class="n">Person</span>
</span><span class="line"><span class="c"># from user_contacts.new_contact_form import ContactForm</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add an “index.html” template to the templates directory:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class="line">  <span class="nt">&lt;head&gt;</span>
</span><span class="line">    <span class="nt">&lt;title&gt;</span>Welcome.<span class="nt">&lt;/title&gt;</span>
</span><span class="line">    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;style&gt;</span>
</span><span class="line">        <span class="nc">.container</span> <span class="p">{</span>
</span><span class="line">            <span class="k">padding</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="nt">&lt;/style&gt;</span>
</span><span class="line">  <span class="nt">&lt;/head&gt;</span>
</span><span class="line">  <span class="nt">&lt;body&gt;</span>
</span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
</span><span class="line">        <span class="nt">&lt;h1&gt;</span>What would you like to do?<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">        <span class="nt">&lt;ul&gt;</span>
</span><span class="line">            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/all"</span><span class="nt">&gt;</span>View Contacts<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class="line">            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/add"</span><span class="nt">&gt;</span>Add Contact<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class="line">        <span class="nt">&lt;/ul&gt;</span>
</span><span class="line">    <span class="nt">&lt;div&gt;</span>
</span><span class="line">    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.10.2.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="line">    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="line">  <span class="nt">&lt;/body&gt;</span>
</span><span class="line"><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the test again. It should pass just fine.</p>

<a name="All.Contacts.View"/>
<h3>All Contacts View</h3>

<p>The test for this view is nearly identical to our last test. Try it on your own before looking at my answer.</p>

<p>Write the test first by adding the following function to the <code>ViewTest</code> class:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">test_view_contacts_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/all/'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>When ran, you should see the same error: <code>AssertionError: 404 != 200</code>.</p>

<p>Update “user_contacts/urls.py” with the following route:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">url</span><span class="p">(</span><span class="s">r'^all/$'</span><span class="p">,</span> <span class="n">all_contacts</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update “views.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">all_contacts</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="n">contacts</span> <span class="o">=</span> <span class="n">Phone</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class="line">    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">'all.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'contacts'</span><span class="p">:</span><span class="n">contacts</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add an “all.html” template to the templates directory:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class="line"><span class="nt">&lt;html&gt;</span>
</span><span class="line"><span class="nt">&lt;head&gt;</span>
</span><span class="line">  <span class="nt">&lt;title&gt;</span>All Contacts.<span class="nt">&lt;/title&gt;</span>
</span><span class="line">  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nt">&lt;style&gt;</span>
</span><span class="line">    <span class="nc">.container</span> <span class="p">{</span>
</span><span class="line">      <span class="k">padding</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">  <span class="nt">&lt;/style&gt;</span>
</span><span class="line"><span class="nt">&lt;/head&gt;</span>
</span><span class="line"><span class="nt">&lt;body&gt;</span>
</span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>All Contacts<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">"1"</span> <span class="na">cellpadding=</span><span class="s">"5"</span><span class="nt">&gt;</span>
</span><span class="line">      <span class="nt">&lt;tr&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>First Name<span class="nt">&lt;/th&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>Last Name<span class="nt">&lt;/th&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>Address<span class="nt">&lt;/th&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>City<span class="nt">&lt;/th&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>State<span class="nt">&lt;/th&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>Country<span class="nt">&lt;/th&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>Phone Number<span class="nt">&lt;/th&gt;</span>
</span><span class="line">        <span class="nt">&lt;th&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
</span><span class="line">      <span class="nt">&lt;/tr&gt;</span>
</span><span class="line">      {% for contact in contacts %}
</span><span class="line">        <span class="nt">&lt;tr&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.person.first\_name}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.person.last\_name}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.person.address}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.person.city}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.person.state}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.person.country}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.number}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">          <span class="nt">&lt;td&gt;</span>{{contact.person.email}}<span class="nt">&lt;/td&gt;</span>
</span><span class="line">        <span class="nt">&lt;/tr&gt;</span>
</span><span class="line">      {% endfor %}
</span><span class="line">    <span class="nt">&lt;/table&gt;</span>
</span><span class="line">    <span class="nt">&lt;br&gt;</span>
</span><span class="line">    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Return Home<span class="nt">&lt;/a&gt;</span>
</span><span class="line">  <span class="nt">&lt;/div&gt;</span>
</span><span class="line">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.10.2.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="line">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="line"><span class="nt">&lt;/body&gt;</span>
</span><span class="line"><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This should pass as well.</p>

<a name="Add.Contact.View"/>
<h3>Add Contact View</h3>

<p>This test is slightly different from the previous two, so please follow along closely.</p>

<p>Add the test to the test suite:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">test_add_contact_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/add/'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should see this error when ran: <code>AssertionError: 404 != 200</code></p>

<p>Update “urls.py”:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>Update “views.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="n">person_form</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">()</span>
</span><span class="line">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'add.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'person_form'</span> <span class="p">:</span> <span class="n">person_form</span><span class="p">},</span> <span class="n">context_instance</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make sure to add the following import:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.new_contact_form</span> <span class="kn">import</span> <span class="n">ContactForm</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a new file called <code>new_contact_form.py</code> and add the following code:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">re</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.models</span> <span class="kn">import</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Phone</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">ContactForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
</span><span class="line">    <span class="n">first_name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span class="line">    <span class="n">last_name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span class="line">    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">address</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">city</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">state</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">country</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">number</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span><span class="line">            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span>
</span><span class="line">            <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">),</span> <span class="n">last_name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'last_name'</span><span class="p">),</span>
</span><span class="line">                <span class="n">email</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'email'</span><span class="p">),</span> <span class="n">address</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'address'</span><span class="p">),</span> <span class="n">city</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'city'</span><span class="p">),</span> <span class="n">state</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'state'</span><span class="p">),</span>
</span><span class="line">                <span class="n">country</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'country'</span><span class="p">))</span>
</span><span class="line">            <span class="n">phone</span> <span class="o">=</span> <span class="n">Phone</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'number'</span><span class="p">))</span>
</span><span class="line">            <span class="k">return</span> <span class="n">phone</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add “add.html” to the templates directory:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class="line"><span class="nt">&lt;html&gt;</span>
</span><span class="line"><span class="nt">&lt;head&gt;</span>
</span><span class="line">  <span class="nt">&lt;title&gt;</span>Welcome.<span class="nt">&lt;/title&gt;</span>
</span><span class="line">  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nt">&lt;style&gt;</span>
</span><span class="line">    <span class="nc">.container</span> <span class="p">{</span>
</span><span class="line">      <span class="k">padding</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">  <span class="nt">&lt;/style&gt;</span>
</span><span class="line"><span class="nt">&lt;/head&gt;</span>
</span><span class="line">  <span class="nt">&lt;body&gt;</span>
</span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Add Contact<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;br&gt;</span>
</span><span class="line">    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/create"</span> <span class="na">method =</span><span class="s">"POST"</span> <span class="na">role=</span><span class="s">"form"</span><span class="nt">&gt;</span>
</span><span class="line">        {% csrf\_token %}
</span><span class="line">        {{ person_\_form.as\_p }}
</span><span class="line">        {{ phone\_form.as\_p }}
</span><span class="line">        <span class="nt">&lt;input</span> <span class="na">type =</span><span class="s">"submit"</span> <span class="na">name =</span><span class="s">"Submit"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">value =</span><span class="s">"Add"</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;/form&gt;</span>
</span><span class="line">      <span class="nt">&lt;br&gt;</span>
</span><span class="line">      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Return Home<span class="nt">&lt;/a&gt;</span>
</span><span class="line">    <span class="nt">&lt;/div&gt;</span>
</span><span class="line">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.10.2.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="line">  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="line">  <span class="nt">&lt;/body&gt;</span>
</span><span class="line"><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Does it pass? It should. If not, refactor.</p>

<a name="Validation"/>
<h3>Validation</h3>

<p>Now that we’re done testing the Views, let’s add validation to the form. But first we need to write a test. Surprise!</p>

<p>Create a new file called “test_validator.py” within the “tests” directory and add the following code:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
</span><span class="line">      <span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
</span><span class="line">      <span class="kn">from</span> <span class="nn">user_contacts.validators</span> <span class="kn">import</span> <span class="n">validate_number</span><span class="p">,</span> <span class="n">validate_string</span>
</span><span class="line">
</span><span class="line">      <span class="k">class</span> <span class="nc">ValidatorTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class="line">          <span class="k">def</span> <span class="nf">test_string_is_invalid_if_contains_numbers_or_special_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">              <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
</span><span class="line">                  <span class="n">validate_string</span><span class="p">(</span><span class="s">'@test'</span><span class="p">)</span>
</span><span class="line">                  <span class="n">validate_string</span><span class="p">(</span><span class="s">'tester#'</span><span class="p">)</span>
</span><span class="line">          <span class="k">def</span> <span class="nf">test_number_is_invalid_if_contains_any_character_except_digits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">              <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
</span><span class="line">                  <span class="n">validate_number</span><span class="p">(</span><span class="s">'123ABC'</span><span class="p">)</span>
</span><span class="line">                  <span class="n">validate_number</span><span class="p">(</span><span class="s">'75431#'</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before running the test suite, can you guess what might happen? <em>Hint: Pay close attention to the imports in the above code.</em> You should get the following error because we don’t have a “validators.py” file:</p>

<p> <code>sh
 ImportError: cannot import name validate_string
</code></p>

<p>In other words, we are testing the logic in a validation file that does not exist yet.</p>

<p>Add a new file called “validators.py” to the <code>user_contacts</code> directory:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">re</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">validate_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
</span><span class="line">    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'^[A-Za-z]+$'</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="line">        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s">'Invalid'</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">validate_number</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span class="line">    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'^[0-9]+$'</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="line">        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s">'Invalid'</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the test suite again. Five should now pass:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">Ran</span> <span class="mi">5</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.019</span><span class="n">s</span>
</span><span class="line">
</span><span class="line"><span class="n">OK</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Create.Contact"/>
<h3>Create Contact</h3>

<p>Since we added validation, we we want to test to ensure that the validators work in the admin area, so update “test_views.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">Client</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.models</span> <span class="kn">import</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Phone</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.views</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">ViewTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">first_name</span> <span class="o">=</span> <span class="s">'TestFirst'</span><span class="p">,</span><span class="n">last_name</span> <span class="o">=</span> <span class="s">'TestLast'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">Phone</span><span class="p">(</span><span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">person</span><span class="p">,</span><span class="n">number</span> <span class="o">=</span> <span class="s">'7778889999'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">phone</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_view_home_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_view_contacts_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/all/'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_add_contact_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/add/'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_create_contact_successful_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/create'</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'first_name'</span> <span class="p">:</span> <span class="s">'testFirst'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">:</span><span class="s">'tester'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">:</span><span class="s">'test@tester.com'</span><span class="p">,</span> <span class="s">'address'</span><span class="p">:</span><span class="s">'1234 nowhere'</span><span class="p">,</span> <span class="s">'city'</span><span class="p">:</span><span class="s">'far away'</span><span class="p">,</span> <span class="s">'state'</span><span class="p">:</span><span class="s">'CO'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">:</span><span class="s">'USA'</span><span class="p">,</span> <span class="s">'number'</span><span class="p">:</span><span class="s">'987654321'</span><span class="p">})</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_create_contact_unsuccessful_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_stub</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/create'</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'first_name'</span> <span class="p">:</span> <span class="s">'tester_first_n@me'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">:</span><span class="s">'test'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">:</span><span class="s">'tester@test.com'</span><span class="p">,</span> <span class="s">'address'</span><span class="p">:</span><span class="s">'5678 everywhere'</span><span class="p">,</span> <span class="s">'city'</span><span class="p">:</span><span class="s">'far from here'</span><span class="p">,</span> <span class="s">'state'</span><span class="p">:</span><span class="s">'CA'</span><span class="p">,</span> <span class="s">'country'</span><span class="p">:</span><span class="s">'USA'</span><span class="p">,</span> <span class="s">'number'</span><span class="p">:</span><span class="s">'987654321'</span><span class="p">})</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">phone</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Two tests should fail.</p>

<p>What needs to be done in order to get this test to pass? Well, we first need to add a function to the views for adding data to the database.</p>

<p>Add route:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">url</span><span class="p">(</span><span class="s">r'^create$'</span><span class="p">,</span> <span class="n">create</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update “views.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="n">form</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span><span class="line">        <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">'all/'</span><span class="p">)</span>
</span><span class="line">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'add.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'person_form'</span> <span class="p">:</span> <span class="n">form</span><span class="p">},</span> <span class="n">context_instance</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test again:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="err">$</span> <span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span> <span class="n">user_contacts</span>
</span></code></pre></td></tr></table></div></figure>


<p>This time only one test should fail – <code>AssertionError: 302 != 200</code> – because we tried to add data that should not have passed the validators but did. In other words, we need to update the “models.py” file as well as the form to take those validators into account.</p>

<p>Update “models.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.validators</span> <span class="kn">import</span> <span class="n">validate_string</span><span class="p">,</span> <span class="n">validate_number</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_string</span><span class="p">])</span>
</span><span class="line">    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_string</span><span class="p">])</span>
</span><span class="line">    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">    <span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_string</span><span class="p">])</span>
</span><span class="line">    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span><span class="s">", "</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Phone</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">person</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">'Person'</span><span class="p">)</span>
</span><span class="line">    <span class="n">number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_number</span><span class="p">])</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span>
</span></code></pre></td></tr></table></div></figure>


<p>Delete the current database, “db.sqlite3”, and re-sync the database:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python manage.py syncdb
</span></code></pre></td></tr></table></div></figure>


<p>Setup an admin user again.</p>

<p>Update <code>new_contact_form.py</code> by adding validation:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">re</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.models</span> <span class="kn">import</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Phone</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.validators</span> <span class="kn">import</span> <span class="n">validate_string</span><span class="p">,</span> <span class="n">validate_number</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">ContactForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
</span><span class="line">    <span class="n">first_name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_string</span><span class="p">])</span>
</span><span class="line">    <span class="n">last_name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_string</span><span class="p">])</span>
</span><span class="line">    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">address</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">city</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">state</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_string</span><span class="p">])</span>
</span><span class="line">    <span class="n">country</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="line">    <span class="n">number</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_number</span><span class="p">])</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span><span class="line">            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span>
</span><span class="line">            <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">),</span> <span class="n">last_name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'last_name'</span><span class="p">),</span>
</span><span class="line">            <span class="n">email</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'email'</span><span class="p">),</span> <span class="n">address</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'address'</span><span class="p">),</span> <span class="n">city</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'city'</span><span class="p">),</span> <span class="n">state</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'state'</span><span class="p">),</span>
</span><span class="line">            <span class="n">country</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'country'</span><span class="p">))</span>
</span><span class="line">            <span class="n">phone</span> <span class="o">=</span> <span class="n">Phone</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'number'</span><span class="p">))</span>
</span><span class="line">            <span class="k">return</span> <span class="n">phone</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the tests again. 7 should pass.</p>

<p>Now, deviating from TDD for a minute, I want to add an additional test to test validation on the client side. So add <code>test_contact_form.py</code>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.models</span> <span class="kn">import</span> <span class="n">Person</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">user_contacts.new_contact_form</span> <span class="kn">import</span> <span class="n">ContactForm</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">TestContactForm</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">test_if_valid_contact_is_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">form</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">({</span><span class="s">'first_name'</span><span class="p">:</span><span class="s">'test'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">:</span><span class="s">'test'</span><span class="p">,</span><span class="s">'number'</span><span class="p">:</span><span class="s">'9999900000'</span><span class="p">})</span>
</span><span class="line">        <span class="n">contact</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">contact</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="s">'test'</span><span class="p">)</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">test_if_invalid_contact_is_not_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">form</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">({</span><span class="s">'first_name'</span><span class="p">:</span><span class="s">'tes&amp;t'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">:</span><span class="s">'test'</span><span class="p">,</span><span class="s">'number'</span><span class="p">:</span><span class="s">'9999900000'</span><span class="p">})</span>
</span><span class="line">        <span class="n">contact</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">contact</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the test suite. All 9 tests should now pass. Yay! Now commit.</p>

<a name="Functional.Tests.Redux"/>
<h2>Functional Tests Redux</h2>

<p>With the Unit tests done, we can now add a Functional test to ensure that the app runs correctly. Hopefully, with the Unit tests passing, we should have no problems with the Functional test.</p>

<p>Add a new class to the “tests.py” file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">UserContactTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_create_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="c"># user opens web browser, navigates to home page</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/'</span><span class="p">)</span>
</span><span class="line">        <span class="c"># user clicks on the Persons link</span>
</span><span class="line">        <span class="n">add_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_link_text</span><span class="p">(</span><span class="s">'Add Contact'</span><span class="p">)</span>
</span><span class="line">        <span class="n">add_link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">        <span class="c"># user fills out the form</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"Michael"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'last_name'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"Herman"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'email'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"michael@realpython.com"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'address'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"2227 Lexington Ave"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'city'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"San Francisco"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'state'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"CA"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'country'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"United States"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'number'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"4158888888"</span><span class="p">)</span>
</span><span class="line">        <span class="c"># user clicks the save button</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">"input[value='Add']"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">        <span class="c"># the Person has been added</span>
</span><span class="line">        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'michael@realpython.com'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">test_create_contact_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="c"># user opens web browser, navigates to home page</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/'</span><span class="p">)</span>
</span><span class="line">        <span class="c"># user clicks on the Persons link</span>
</span><span class="line">        <span class="n">add_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_link_text</span><span class="p">(</span><span class="s">'Add Contact'</span><span class="p">)</span>
</span><span class="line">        <span class="n">add_link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">        <span class="c"># user fills out the form</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"test@"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'last_name'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"tester"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'email'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"test@tester.com"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'address'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"2227 Tester Ave"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'city'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"Tester City"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'state'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"TC"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'country'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"TCA"</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'number'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"4158888888"</span><span class="p">)</span>
</span><span class="line">        <span class="c"># user clicks the save button</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">"input[value='Add']"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Invalid'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the Functional tests:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python manage.py <span class="nb">test </span>ft
</span></code></pre></td></tr></table></div></figure>


<p>Here we’re just testing the code we wrote and already tested with Unit tests from the end user’s perspective. All four tests should pass.</p>

<p>Finally, let’s ensure that the validation we put into place applies to the Admin panel by adding the following function to the <code>AdminTest</code> class:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">test_create_contact_admin_raise_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">    <span class="c"># # user opens web browser, navigates to admin page, and logs in</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span> <span class="o">+</span> <span class="s">'/admin/'</span><span class="p">)</span>
</span><span class="line">    <span class="n">username_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
</span><span class="line">    <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
</span><span class="line">    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
</span><span class="line">    <span class="c"># user clicks on the Persons link</span>
</span><span class="line">    <span class="n">persons_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_link_text</span><span class="p">(</span><span class="s">'Persons'</span><span class="p">)</span>
</span><span class="line">    <span class="n">persons_links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">    <span class="c"># user clicks on the Add person link</span>
</span><span class="line">    <span class="n">add_person_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="s">'Add person'</span><span class="p">)</span>
</span><span class="line">    <span class="n">add_person_link</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">    <span class="c"># user fills out the form</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"test@"</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'last_name'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"tester"</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'email'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"test@tester.com"</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'address'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"2227 Tester Ave"</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'city'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"Tester City"</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'state'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"TC"</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">'country'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"TCA"</span><span class="p">)</span>
</span><span class="line">    <span class="c"># user clicks the save button</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">"input[value='Save']"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'body'</span><span class="p">)</span>
</span><span class="line">    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Invalid'</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run it. Five tests should pass. Commit and let’s call it a day.</p>

<a name="Test.Structure"/>
<h2>Test Structure</h2>

<p>TDD is a powerful tool and an integral part of the development cycle, helping developers break programs into small, readable portions. Such portions are much easier to write now and change later. Further, having a comprehensive test suite, covering every feature of your codebase, helps ensure that new feature implementations will not break existing code.</p>

<p>Within the process, <strong>Functional tests</strong> are high-level tests, focused on the <em>features</em> that the end users interact with.</p>

<p>Meanwhile, <strong>Unit tests</strong> support Functional tests in that they test each feature of the code. Keep in mind that Unit tests are much easier to write, generally provide better coverage, and are easier to debug because they test only one feature at a time. They also run much quicker, so be sure to test your unit tests more often than your functional tests.</p>

<p>Let’s take a look at our testing structure to see how our unit tests support the functional tests:</p>

<p><img src="https://raw.github.com/mjhea0/django-tdd/master/test-structure.png" alt="test-structure"/></p>

<a name="Conclusion"/>
<h2>Conclusion</h2>

<p>Congrats. You make it through. What’s next?</p>

<p>First, you may have noticed that I did not 100% follow the TDD process. That’s okay. Most developers engaged in TDD don’t always adhere to it in every single situation. There are times that you must deviate from it in order to just get things done – which is perfectly fine. If you’d like to refactor some of the code/process to fully adhere to the TDD process, you can. In fact, it may be a good practice.</p>

<p>Second, think about the tests I missed. Determining what and when to test is difficult. It takes time and much practice to get good at testing in general. I’ve left many blanks that I intend to revel in my next post. See if you can find those and add tests.</p>

<p>Finally, remember the last step in the TDD process? Refactoring. This step is vital as it helps create readable, maintainable code that you not only understand now – but in the future as well. When you look back at your code, think about tests you can combine. Also, which tests should you add to ensure that all written code is tested? You could test for null values and/or server side authentication, for example. You should refactor your code before moving on to writing any new code – which I did not do for time’s sake. Perhaps another blog post? Think about how bad code can pollute the entire process?</p>

<p>Thanks for reading. Grab the final code in the repo <a href="https://github.com/mjhea0/django-tdd">here</a>. Please comment below with any questions.</p>
</div>


      </div></body></html>