<html><body><div><section class="post_content clearfix" itemprop="articleBody">
                            <p class="shareaholic-canvas" data-app-id="18930042" data-app="share_buttons" data-title="Flask Testing with Mock and Nose" data-link="https://www.safaribooksonline.com/blog/2013/12/05/flask-with-mock-and-nose/" data-summary=""/><blockquote><p><em>A guest post by Aaron Kavlie, a developer at Stremor working on a mobile voice platform called Plexi.</em></p></blockquote>
<p>The Flask documentation gives you <a href="http://flask.pocoo.org/docs/testing/">some basic guidance</a> on testing Flask apps. It might leave you feeling a little unprepared, however, to handle real-world testing in more complicated applications. In this post I’ll cover some good tools and techniques to make testing your app easier. These techniques are framework agnostic too–so even if you’re using another framework, you should find the content useful.</p>
<p>Be sure to also read my <a href="https://www.safaribooksonline.com/blog/2013/11/27/flask-internationalization-and-localization/">Flask Internationalization and Localization</a> post.<span id="more-12974"/></p>
<h2>Introducing our Scraper</h2>
<p>Let’s start with a basic <a href="https://news.ycombinator.com">Hacker News</a> scraper. It gets the stories from the front page, and outputs them as JSON:</p>

		<div id="crayon-56d5b8b278bd2579214402" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-2">2</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-4">4</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-6">6</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-8">8</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-10">10</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-12">12</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-14">14</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-16">16</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-18">18</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-20">20</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-22">22</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-24">24</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-26">26</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-28">28</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-30">30</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-32">32</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-34">34</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-36">36</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-38">38</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-40">40</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-42">42</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-44">44</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-46">46</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-48">48</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bd2579214402-50">50</p><p class="crayon-num" data-line="crayon-56d5b8b278bd2579214402-51">51</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-1"><span class="crayon-e">from </span><span class="crayon-e">flask </span><span class="crayon-e">import </span><span class="crayon-v">Flask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">jsonify</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-2"> </p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-3"><span class="crayon-e">import </span><span class="crayon-e">requests</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-4"><span class="crayon-e">from </span><span class="crayon-e">lxml </span><span class="crayon-e">import </span><span class="crayon-e">html</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-6"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-8"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-9"><span class="crayon-e">def </span><span class="crayon-e">index</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-10"><span class="crayon-h">    </span><span class="crayon-v">page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'https://news.ycombinator.com'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-11"><span class="crayon-h">    </span><span class="crayon-v">root</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">html</span><span class="crayon-sy">.</span><span class="crayon-e">fromstring</span><span class="crayon-sy">(</span><span class="crayon-v">page</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-12"> </p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-13"><span class="crayon-h">    </span><span class="crayon-v">stories</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-14"><span class="crayon-h">    </span><span class="crayon-v">entry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-15"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">root</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'center table table tr'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-16"><span class="crayon-h">        </span><span class="crayon-p"># add entry to list on spacer row</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-17"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'style'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'height:5px'</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">entry</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-18"><span class="crayon-h">            </span><span class="crayon-v">stories</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">entry</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-19"><span class="crayon-h">            </span><span class="crayon-v">entry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-20"> </p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-21"><span class="crayon-h">        </span><span class="crayon-p"># first row: title</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-22"><span class="crayon-h">        </span><span class="crayon-v">titles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.title'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-23"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">titles </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">titles</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-24"><span class="crayon-h">            </span><span class="crayon-v">entry</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-25"><span class="crayon-h">                </span><span class="crayon-s">'title'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">titles</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-26"><span class="crayon-h">                </span><span class="crayon-s">'url'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">titles</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'href'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-27"><span class="crayon-h">            </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-28"><span class="crayon-h">            </span><span class="crayon-p"># this is an HN post</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-29"><span class="crayon-h">            </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">entry</span><span class="crayon-sy">[</span><span class="crayon-s">'url'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'item?'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-30"><span class="crayon-h">                </span><span class="crayon-v">entry</span><span class="crayon-sy">[</span><span class="crayon-s">'url'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'https://news.ycombinator.com/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">entry</span><span class="crayon-sy">[</span><span class="crayon-s">'url'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-31"><span class="crayon-h">        </span><span class="crayon-p"># 2nd row: points, time and comments</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-32"><span class="crayon-h">        </span><span class="crayon-e">elif </span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext span'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-33"><span class="crayon-h">            </span><span class="crayon-v">entry</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-34"><span class="crayon-h">                </span><span class="crayon-s">'points'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext span'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-35"><span class="crayon-h">                </span><span class="crayon-s">'submitter'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-36"><span class="crayon-h">                </span><span class="crayon-s">'time_submitted'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">tail</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'|'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-37"><span class="crayon-h">                   </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-38"><span class="crayon-h">                </span><span class="crayon-s">'comments_url'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'https://news.ycombinator.com/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-39"><span class="crayon-h">                             </span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'href'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-40"><span class="crayon-h">            </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-41"><span class="crayon-h">            </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'discuss'</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-42"><span class="crayon-h">                </span><span class="crayon-v">entry</span><span class="crayon-sy">[</span><span class="crayon-s">'comments'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-43"><span class="crayon-h">            </span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-44"><span class="crayon-h">                </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">logger</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-45"><span class="crayon-h">                </span><span class="crayon-v">entry</span><span class="crayon-sy">[</span><span class="crayon-s">'comments'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-46"><span class="crayon-h">                    </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">.</span><span class="crayon-e">cssselect</span><span class="crayon-sy">(</span><span class="crayon-s">'.subtext a'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-47"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-48"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">jsonify</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-s">'stories'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">stories</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-49"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bd2579214402-50"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278bd2579214402-51"><span class="crayon-h">    </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">debug</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The Python standard library includes the <a href="http://docs.python.org/2/library/unittest.html">unittest</a> unit testing framework. Its inclusion in the standard library makes it a safe default when testing Python code. Using unittest, we can start with a basic test of our scraper:</p>

		<div id="crayon-56d5b8b278bf1255094802" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-2">2</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-4">4</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-6">6</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-8">8</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-10">10</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-12">12</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-14">14</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-16">16</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-18">18</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-20">20</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-22">22</p><p class="crayon-num" data-line="crayon-56d5b8b278bf1255094802-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278bf1255094802-24">24</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-1"><span class="crayon-e">import </span><span class="crayon-e">json</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-2"><span class="crayon-e">import </span><span class="crayon-e">unittest</span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-3"><span class="crayon-e">import </span><span class="crayon-e">scraper</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-4"> </p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-5"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TestScraper</span><span class="crayon-sy">(</span><span class="crayon-v">unittest</span><span class="crayon-sy">.</span><span class="crayon-v">TestCase</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-6"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">setUp</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-7"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scraper</span><span class="crayon-sy">.</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">test_client</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-8"> </p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-9"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">test_entry</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-10"><span class="crayon-h">        </span><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-11"><span class="crayon-h">            </span><span class="crayon-s">"comments"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">105</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-12"><span class="crayon-h">            </span><span class="crayon-s">"comments_url"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"https://news.ycombinator.com/item?id=6804440"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-13"><span class="crayon-h">            </span><span class="crayon-s">"points"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">210</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-14"><span class="crayon-h">            </span><span class="crayon-s">"submitter"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"citricsquid"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-15"><span class="crayon-h">            </span><span class="crayon-s">"time_submitted"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"6 hours ago"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-16"><span class="crayon-h">            </span><span class="crayon-s">"title"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"I Am Not Satoshi"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-17"><span class="crayon-h">            </span><span class="crayon-s">"url"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"http://blog.dustintrammell.com/2013/11/26/i-am-not-satoshi/"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-18"><span class="crayon-h">        </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-20"><span class="crayon-h">        </span><span class="crayon-v">rv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-21"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">assertEqual</span><span class="crayon-sy">(</span><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">loads</span><span class="crayon-sy">(</span><span class="crayon-v">rv</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-s">'stories'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-22"> </p><p class="crayon-line" id="crayon-56d5b8b278bf1255094802-23"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bf1255094802-24"><span class="crayon-h">    </span><span class="crayon-v">unittest</span><span class="crayon-sy">.</span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>And if we run it, we get confirmation that our test passes:</p>

		<div id="crayon-56d5b8b278bfd736110893" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278bfd736110893-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">test_scraper_unittest</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bfd736110893-2"><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5b8b278bfd736110893-3"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bfd736110893-4"><span class="crayon-i">Ran</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">test </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-cn">0.406s</span></p><p class="crayon-line" id="crayon-56d5b8b278bfd736110893-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278bfd736110893-6"><span class="crayon-v">OK</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>It looks like we’re on the right path. And given the simplicity of this scraper, we already have most of the code covered.</p>
<h2>Stubbing Remote Services</h2>
<p>Unfortunately the test has a pretty big problem, which will become evident if we wait just a few minutes and run the test again:</p>

		<div id="crayon-56d5b8b278c05135248153" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-2">2</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-4">4</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-6">6</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-8">8</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-10">10</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-12">12</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-14">14</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c05135248153-16">16</p><p class="crayon-num" data-line="crayon-56d5b8b278c05135248153-17">17</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278c05135248153-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">test_scraper_unittest</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-2"><span class="crayon-v">F</span></p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-3"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-4"><span class="crayon-v">FAIL</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">test_entry</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">__main__</span><span class="crayon-sy">.</span><span class="crayon-v">TestScraper</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-5"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-6"><span class="crayon-e">Traceback</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">most </span><span class="crayon-e">recent </span><span class="crayon-e">call </span><span class="crayon-v">last</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-7"><span class="crayon-h">  </span><span class="crayon-i">File</span><span class="crayon-h"> </span><span class="crayon-s">"test_scraper_unittest.py"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">22</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">test_entry</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-8"><span class="crayon-e">    </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">assertEqual</span><span class="crayon-sy">(</span><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">loads</span><span class="crayon-sy">(</span><span class="crayon-v">rv</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-s">'stories'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-9"><span class="crayon-v">AssertionError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-i">u</span><span class="crayon-s">'time_submitted'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">'7 hours ago'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">'url'</span><span class="crayon-o">:</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-10"><span class="crayon-h">   </span><span class="crayon-i">u</span><span class="crayon-s">'http://blog.dustintrammell.com/201 [truncated]... != {'</span><span class="crayon-i">title</span><span class="crayon-s">': '</span><span class="crayon-i">I</span><span class="crayon-h"> </span><span class="crayon-e">Am </span><span class="crayon-st">Not</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-11"><span class="crayon-h"> </span><span class="crayon-i">Satoshi</span><span class="crayon-s">', '</span><span class="crayon-i">url</span><span class="crayon-s">': '</span><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//blog.dustintrammell.com/2013/11/26/ [truncated]...</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-12"><span class="crayon-e">Diff </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-cn">769</span><span class="crayon-h"> </span><span class="crayon-e">characters </span><span class="crayon-t">long</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-e">Set </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">maxDiff </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-e">None </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-e">see </span><span class="crayon-v">it</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-14"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-15"><span class="crayon-i">Ran</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">test </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-cn">0.598s</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c05135248153-16"> </p><p class="crayon-line" id="crayon-56d5b8b278c05135248153-17"><span class="crayon-e">FAILED</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">failures</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Why did the test just fail? Because Hacker News data changes all of the time! Even though the story we’re targeting, <em>I Am Not Satoshi</em>, stayed in the same place, a few things still changed: points, comments, and relative time submitted. Obviously we need some way to get a fixed version of the front page to test this code.</p>
<p>Enter <a href="http://www.voidspace.org.uk/python/mock/">Mock</a>. Mock allows us to replace code under test, like that call to <code>requests.get</code>, with a stub that gives the same answer every time. In this case, that would be reading a copy of the front page from a file that makes sense.</p>
<p>After saving the page as <code>hn_front_page.html</code>, we can add a stub for <code>requests.get</code> like so:</p>

		<div id="crayon-56d5b8b278c11928783632" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278c11928783632-1"><span class="crayon-e">def </span><span class="crayon-e">get_stub</span><span class="crayon-sy">(</span><span class="crayon-o">*</span><span class="crayon-v">args</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-v">kwargs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c11928783632-2"><span class="crayon-h">    </span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-v">get</span><span class="crayon-sy">.</span><span class="crayon-e">return_value</span></p><p class="crayon-line" id="crayon-56d5b8b278c11928783632-3"><span class="crayon-e">    </span><span class="crayon-e">with </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-s">'hn_front_page.html'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c11928783632-4"><span class="crayon-h">        </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c11928783632-5"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">response</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c11928783632-6"> </p><p class="crayon-line" id="crayon-56d5b8b278c11928783632-7"><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-v">get</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MagicMock</span><span class="crayon-sy">(</span><span class="crayon-v">side_effect</span><span class="crayon-o">=</span><span class="crayon-v">get_stub</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>And after updating the expected output, we have a passing test again–and it will stay that way!</p>
<p>There are some additional factors that make stubbing an essential practice when testing code that hits remote web services: tests will run <em>much</em> faster, especially if your tests make multiple HTTP requests (as opposed to the single request in our example). This is also friendlier to the site or service you’re hitting, and it could save money if you’re working with an API that isn’t free.</p>
<h2>Better Testing with Nose</h2>
<p>There’s another issue with our test failure: It’s not as helpful as it could be. unittest truncates long values by default, making it difficult to tell where the wrong values were. Furthermore, if <em>any</em> value is incorrect in the dictionary, the whole test fails. More granular testing would be helpful.</p>
<p><a href="https://nose.readthedocs.org/en/latest/">Nose</a> is a popular test runner with a lot of useful features. Its support for <a href="https://nose.readthedocs.org/en/latest/writing_tests.html#test-generators">test generators</a> is a perfect solution to the all-or-nothing test case we received with unittest. Test generators allow us to iterate through the dictionary and execute one test for each key/value pair in the dictionary.</p>
<p>Here’s our test, rewritten using a test generator:</p>

		<div id="crayon-56d5b8b278c1c193170069" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-2">2</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-4">4</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-6">6</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-8">8</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-10">10</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-12">12</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-14">14</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-16">16</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c1c193170069-18">18</p><p class="crayon-num" data-line="crayon-56d5b8b278c1c193170069-19">19</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-1"><span class="crayon-e">def </span><span class="crayon-e">test_entry</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-2"><span class="crayon-h">    </span><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-3"><span class="crayon-h">        </span><span class="crayon-s">"comments"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">105</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-4"><span class="crayon-h">        </span><span class="crayon-s">"comments_url"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"https://news.ycombinator.com/item?id=6804440"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-5"><span class="crayon-h">        </span><span class="crayon-s">"points"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">210</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-6"><span class="crayon-h">        </span><span class="crayon-s">"submitter"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"citricsquid"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-7"><span class="crayon-h">        </span><span class="crayon-s">"time_submitted"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"6 hours ago"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-8"><span class="crayon-h">        </span><span class="crayon-s">"title"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"I Am Not Satoshi"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-9"><span class="crayon-h">        </span><span class="crayon-s">"url"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"http://blog.dustintrammell.com/2013/11/26/i-am-not-satoshi/"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-10"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-12"><span class="crayon-h">    </span><span class="crayon-v">rv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'/'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-13"><span class="crayon-h">    </span><span class="crayon-v">story</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">loads</span><span class="crayon-sy">(</span><span class="crayon-v">rv</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-s">'stories'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-14"> </p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-15"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">check_equal</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">val</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-16"><span class="crayon-h">        </span><span class="crayon-e">assert_equal</span><span class="crayon-sy">(</span><span class="crayon-v">story</span><span class="crayon-sy">[</span><span class="crayon-v">key</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">val</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-17"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c1c193170069-18"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">val </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-sy">.</span><span class="crayon-e">iteritems</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278c1c193170069-19"><span class="crayon-h">        </span><span class="crayon-e">yield </span><span class="crayon-v">check_equal</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">val</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>While Nose works perfectly fine with a unittest class, it also accepts plain functions as shown here, as long as they’re prefixed with <code>test</code>. I tend to prefer the simplicity of writing functions to the class-based approach of <code>unittest</code>.</p>
<p>Here’s what you get when running this test:</p>

		<div id="crayon-56d5b8b278c27125021022" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-2">2</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-4">4</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-6">6</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-8">8</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-10">10</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-12">12</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-14">14</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-16">16</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-18">18</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-20">20</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-22">22</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-24">24</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-26">26</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-28">28</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-30">30</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-32">32</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-34">34</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-36">36</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-38">38</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-40">40</p><p class="crayon-num" data-line="crayon-56d5b8b278c27125021022-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b8b278c27125021022-42">42</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278c27125021022-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">nosetests </span><span class="crayon-v">test_scraper_nose</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-v">FF</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-3"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-4"><span class="crayon-v">FAIL</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">test_scraper_nose</span><span class="crayon-sy">.</span><span class="crayon-e">test_entry</span><span class="crayon-sy">(</span><span class="crayon-s">'time_submitted'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'6 hours ago'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-5"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-6"><span class="crayon-e">Traceback</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">most </span><span class="crayon-e">recent </span><span class="crayon-e">call </span><span class="crayon-v">last</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-7"><span class="crayon-h">  </span><span class="crayon-i">File</span><span class="crayon-h"> </span><span class="crayon-s">"/Users/akavlie/envs/backstop/lib/python2.7/site-packages/nose/case.py"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-8"><span class="crayon-h">    </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">197</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">runTest</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-9"><span class="crayon-e">    </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">test</span><span class="crayon-sy">(</span><span class="crayon-o">*</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">arg</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-10"><span class="crayon-h">  </span><span class="crayon-i">File</span><span class="crayon-h"> </span><span class="crayon-s">"/Users/akavlie/clients/backstop_media/hn_scraper/test_scraper_nose.py"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-11"><span class="crayon-h">    </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">46</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">check_equal</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-12"><span class="crayon-e">    </span><span class="crayon-e">assert_equal</span><span class="crayon-sy">(</span><span class="crayon-v">story</span><span class="crayon-sy">[</span><span class="crayon-v">key</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">val</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-13"><span class="crayon-v">AssertionError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">'8 hours ago'</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-s">'6 hours ago'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-14"> </p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-15"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-16"><span class="crayon-v">FAIL</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">test_scraper_nose</span><span class="crayon-sy">.</span><span class="crayon-e">test_entry</span><span class="crayon-sy">(</span><span class="crayon-s">'comments'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">105</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-17"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-18"><span class="crayon-e">Traceback</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">most </span><span class="crayon-e">recent </span><span class="crayon-e">call </span><span class="crayon-v">last</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-19"><span class="crayon-h">  </span><span class="crayon-i">File</span><span class="crayon-h"> </span><span class="crayon-s">"/Users/akavlie/envs/backstop/lib/python2.7/site-packages/nose/case.py"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-20"><span class="crayon-h">     </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">197</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">runTest</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-21"><span class="crayon-e">    </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">test</span><span class="crayon-sy">(</span><span class="crayon-o">*</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">arg</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-22"><span class="crayon-h">  </span><span class="crayon-i">File</span><span class="crayon-h"> </span><span class="crayon-s">"/Users/akavlie/clients/backstop_media/hn_scraper/test_scraper_nose.py"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-23"><span class="crayon-h">     </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">46</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">check_equal</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-24"><span class="crayon-e">    </span><span class="crayon-e">assert_equal</span><span class="crayon-sy">(</span><span class="crayon-v">story</span><span class="crayon-sy">[</span><span class="crayon-v">key</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">val</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-25"><span class="crayon-v">AssertionError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">118</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">105</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-26"> </p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-27"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-28"><span class="crayon-v">FAIL</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">test_scraper_nose</span><span class="crayon-sy">.</span><span class="crayon-e">test_entry</span><span class="crayon-sy">(</span><span class="crayon-s">'points'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">210</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-29"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-30"><span class="crayon-e">Traceback</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">most </span><span class="crayon-e">recent </span><span class="crayon-e">call </span><span class="crayon-v">last</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-31"><span class="crayon-h">  </span><span class="crayon-i">File</span><span class="crayon-h"> </span><span class="crayon-s">"/Users/akavlie/envs/backstop/lib/python2.7/site-packages/nose/case.py"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-32"><span class="crayon-h">     </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">197</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">runTest</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-33"><span class="crayon-e">    </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">test</span><span class="crayon-sy">(</span><span class="crayon-o">*</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">arg</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-34"><span class="crayon-h">  </span><span class="crayon-i">File</span><span class="crayon-h"> </span><span class="crayon-s">"/Users/akavlie/clients/backstop_media/hn_scraper/test_scraper_nose.py"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-35"><span class="crayon-h">     </span><span class="crayon-i">line</span><span class="crayon-h"> </span><span class="crayon-cn">46</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">check_equal</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-36"><span class="crayon-e">    </span><span class="crayon-e">assert_equal</span><span class="crayon-sy">(</span><span class="crayon-v">story</span><span class="crayon-sy">[</span><span class="crayon-v">key</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">val</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-37"><span class="crayon-v">AssertionError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">216</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">210</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-38"> </p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-39"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-40"><span class="crayon-i">Ran</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-h"> </span><span class="crayon-e">tests </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-cn">0.322s</span></p><p class="crayon-line" id="crayon-56d5b8b278c27125021022-41"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c27125021022-42"><span class="crayon-e">FAILED</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">failures</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This is <em>much</em> more helpful than the test method we used earlier. We now know that 3 of our 7 values were incorrect, and it’s clear what the expected values should be.</p>
<p>Correct those 3 values, and all is well:</p>

		<div id="crayon-56d5b8b278c33674048364" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b8b278c33674048364-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">nosetests </span><span class="crayon-v">test_scraper_nose</span><span class="crayon-sy">.</span><span class="crayon-i">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c33674048364-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5b8b278c33674048364-3"><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">--</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c33674048364-4"><span class="crayon-i">Ran</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-h"> </span><span class="crayon-e">tests </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-cn">0.338s</span></p><p class="crayon-line" id="crayon-56d5b8b278c33674048364-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b8b278c33674048364-6"><span class="crayon-v">OK</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h2>Conclusion</h2>
<p>While this scraper is pretty simple, the testing techniques demonstrated here really shine when you use them on more complex code bases. The <code>requests</code> stub becomes really helpful when you’re testing against tens or hundreds of URLs, and test generators are handy anywhere you need to test a variety of input/output pairs against a function.</p>
<p>All of the code for this example is <a href="https://github.com/akavlie/flask-testing-tutorial">available on GitHub</a>. Happy testing!</p>
<p>See below for Flask resources from Safari Books Online.</p>
<p>Not a subscriber? Sign up for a <a href="https://www.safaribooksonline.com/register/" target="_blank">free trial</a>.</p>
<h2>Safari Books Online has the content you need</h2>
<table>
<tbody>
<tr>
<td><a href="https://www.safaribooksonline.com/library/view/instant-flask-web/9781782169628/" target="_blank"><img alt="" hspace="70" src="https://www.safaribooksonline.com/library/cover/9781782169628/" vspace="30"/></a></td>
<td><a href="https://www.safaribooksonline.com/library/view/instant-flask-web/9781782169628/" target="_blank">Instant Flask Web Development</a> takes you beyond the quick start in the Flask documentation and shows you a bottom-up approach to organizing your Flask application. It shows you how to build a small deployable scheduling application with pointers to the various design decisions you can make when developing with Flask.</td>
</tr>
<tr>
<td><a href="https://www.safaribooksonline.com/library/view/instant-data-intensive/9781782165583/" target="_blank"><img alt="" hspace="70" src="https://www.safaribooksonline.com/library/cover/9781782165583/" vspace="30"/></a></td>
<td><a href="https://www.safaribooksonline.com/library/view/instant-data-intensive/9781782165583/" target="_blank">Instant Data Intensive Apps with pandas How-to</a> starts with Pandas’ functionalities such as joining datasets, cleaning data, and other data munging tasks. It quickly moves onto building a data reporting tool, which consists of analysis in Pandas to determine what’s relevant and present that relevant data in an easy-to-consume manner, and also provides a section on Flask.</td>
</tr>
</tbody>
</table>
<h3>About the author</h3>
<table>
<tbody>
<tr>
<td valign="top"><a href="https://www.safaribooksonline.com/blog/wp-content/uploads/2013/11/aaron.jpg"><img alt="aaron" class="aligncenter size-full wp-image-12936" src="https://www.safaribooksonline.com/blog/wp-content/uploads/2013/11/aaron.jpg"/></a></td>
<td>Aaron Kavlie started doing web development a few years ago and is currently a developer at Stremor working on a mobile voice platform called Plexi. He mainly does backend work with Python these days, but has been known to do frontend web development in the past. He can be reached at <a href="https://www.twitter.com/akavlie">@akavlie</a>.</td>
</tr>
</tbody>
</table>
                          
                            
                                                
                        </section> 
                        
                        </div></body></html>