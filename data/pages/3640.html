<html><body><div><div class="entry-content clear">
			<p id="a-guide-to-finding-books-in-images-using-python-and-opencv"><strong><em>This is a guest post by Adrian Rosebrock from <a href="http://www.pyimagesearch.com">PyImageSearch.com</a>, a blog all about computer vision, image processing, and building image search engines.</em></strong><br/>
<span id="more-562"/></p>
<hr/>
<p><a href="https://freepythontips.files.wordpress.com/2015/03/find_books_output.jpg"><img class="alignnone size-large wp-image-570" src="https://freepythontips.files.wordpress.com/2015/03/find_books_output.jpg?w=696&amp;h=525" alt="find_books_output"/></a></p>
<p>I always tell people that if they want to learn to write well they need to do two things:</p>
<ol>
<li>Practice writing often.</li>
<li>Read. A lot.</li>
</ol>
<p>It seems strange, doesn’t it? How reading often can dramatically improve your writing ability.</p>
<p>But it’s absolutely true.</p>
<p>Reading authors that like you can actually engrain their vernacular into your own writing style. And eventually, with enough practice, you can develop a style and voice of your own.</p>
<p>All that said, between the <a href="http://www.pyimagesearch.com/">PyImageSearch</a> blog, my book <a href="https://www.pyimagesearch.com/practical-python-opencv/">Practical Python and OpenCV</a>, and <a href="http://www.pyimagesearch.com/pyimagesearch-gurus/">PyImageSearch Gurus</a> (a computer vision course I’m developing), I write (and read) a lot.</p>
<p>There will be moments when I’m literally walking down the street, coffee in hand, when a stroke of inspiration will strike me like a bolt of lightning.</p>
<p>And less I let the fleeting thought disappear into the abyss of my subconscious, I have to stop in the middle of my walk, pull out my iPhone, and compose a blog post on my tiny screen and hard-to-use keyboard.</p>
<p>Is it a bit annoying at times? Yes but. But it’s a lot of fun. Both reading and writing are a passion of mine – and one passion fuels the other.</p>
<p>So it should come as no surprise that my coffee table is covered in books right now.</p>
<p>As I’m sitting here looking at my coffee table, I decided, hey, why not create a Python script to count the number of books on my table? That would be pretty cool, right? I could merge two of my passions – books and computer vision.</p>
<p>And when Yasoob invited me to do a guest post, I couldn’t help but accept. In the rest of this blog post I will show you how to create a Python script to count the number of books in an image using OpenCV.</p>
<h2 id="what-are-we-going-to-do">What are we going to do?</h2>
<p>Let’s start by taking a look at our example image we are going to count books in:</p>
<p><a href="https://freepythontips.files.wordpress.com/2015/03/example.jpg"><img class="alignnone size-full wp-image-566" src="https://freepythontips.files.wordpress.com/2015/03/example.jpg?w=696" alt="example"/></a></p>
<p>We see there are four books in the image, along with various “distractors” such as a coffee mug, a Starbucks cup, multiple coasters, and a piece of candy.</p>
<p>Our goal here is to <strong><em>find the four books in the image</em></strong> while <strong><em>ignoring the distractors.</em></strong></p>
<p>How are we going to do that?</p>
<p>Read on to find out!</p>
<h2 id="what-libraries-will-we-need">What libraries will we need?</h2>
<p>In order to build our system to find and detect books in images, we’ll be utilizing two main libraries:</p>
<ul>
<li><a href="http://www.numpy.org/">NumPy</a> to facilitate numerical operations.</li>
<li><a href="http://opencv.org/">OpenCV</a> to handle computer vision and image processing.</li>
</ul>
<p>Make sure you have these libraries installed!</p>
<h2 id="finding-books-in-images-using-python-and-opencv">Finding books in images using Python and OpenCV.</h2>
<p>Let’s go ahead and get started.</p>
<p>Open up your favorite code editor, create a new file named <code>find_books.py</code>, and let’s get started:</p>
<pre># import the necessary packages
import numpy as np
import cv2

# load the image, convert it to grayscale, and blur it
image = cv2.imread("example.jpg")
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
gray = cv2.GaussianBlur(gray, (3, 3), 0)
cv2.imshow("Gray", gray)
cv2.waitKey(0)</pre>
<p>We’ll start by importing our required libraries. We’ll be using NumPy for numerical processing and <code>cv2</code> for our OpenCV bindings.</p>
<p>Loading an image off disk is handled by the <code>cv2.imread</code> function. Here we are simply loading our image off disk, followed by converting it from the Red, Green, Blue (RGB) color space to grayscale.</p>
<p>We’ll also blur the image slightly to reduce high frequency noise and increase the accuracy of our code used to find books later in this post.</p>
<p>After executing our code, our output should look like this:</p>
<p><a href="https://freepythontips.files.wordpress.com/2015/03/find_books_grayscale.jpg"><img class="alignnone size-large wp-image-569" src="https://freepythontips.files.wordpress.com/2015/03/find_books_grayscale.jpg?w=696&amp;h=525" alt="find_books_grayscale"/></a></p>
<p>Here you can see that we have loaded the image off disk, converted it to grayscale, and blurred it slightly.</p>
<p>Now, let’s detect edges (i.e outlines) of the objects in the image:</p>
<pre># detect edges in the image
edged = cv2.Canny(gray, 10, 250)
cv2.imshow("Edged", edged)
cv2.waitKey(0)</pre>
<p>Our edged image now looks like this:</p>
<p><a href="https://freepythontips.files.wordpress.com/2015/03/find_books_edged.jpg"><img class="alignnone size-large wp-image-568" src="https://freepythontips.files.wordpress.com/2015/03/find_books_edged.jpg?w=696&amp;h=525" alt="find_books_edged"/></a></p>
<p>We have clearly found the outlines of the objects in the images. However, you’ll notice that some of the outlines are not “clean” and complete. There are gaps in between the outlines that we need to close in order to successfully detect our books.</p>
<p>To solve this, we’ll apply a “closing” operation to close the gaps between the white pixels in the image:</p>
<pre># construct and apply a closing kernel to 'close' gaps between 'white'
# pixels
kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (7, 7))
closed = cv2.morphologyEx(edged, cv2.MORPH_CLOSE, kernel)
cv2.imshow("Closed", closed)
cv2.waitKey(0)
</pre>
<p>Sure enough, the gaps in the outlines have been closed:</p>
<p><a href="https://freepythontips.files.wordpress.com/2015/03/find_books_closed.jpg"><img class="alignnone size-large wp-image-567" src="https://freepythontips.files.wordpress.com/2015/03/find_books_closed.jpg?w=696&amp;h=525" alt="find_books_closed"/></a></p>
<p>The next step is to actually detect the outlines of the objects in the image. We’ll use the <code>cv2.findContours</code> function for that:</p>
<pre># find contours (i.e. the 'outlines') in the image and initialize the
# total number of books found
(cnts, _) = cv2.findContours(closed.copy(), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
total = 0</pre>
<p>Let’s take a second and consider the geometry of a book.</p>
<p>A book is a rectangle. And a rectangle has four vertices. Therefore, if we examine a contour and find that it has four vertices, then we can assume it is a book and not one of the distractors in the image.</p>
<p>To check if a contour is a book or not, we need to loop over each of the contours individually:</p>
<pre># loop over the contours
for c in cnts:
# approximate the contour
peri = cv2.arcLength(c, True)
approx = cv2.approxPolyDP(c, 0.02 * peri, True)

# if the approximated contour has four points, then assume that the
# contour is a book -- a book is a rectangle and thus has four vertices
if len(approx) == 4:
cv2.drawContours(image, [approx], -1, (0, 255, 0), 4)
total += 1</pre>
<p>This code block is where all the magic happens. For each of the contours we compute the perimeter using <code>cv2.arcLength</code> and then approximate the contour using <code>cv2.approxPolyDP</code>.</p>
<p>The reason we approximate the contour is because the outline may not be a perfect rectangle. Due to noise when the photo was captured or shadows in the image, it is possible (and even very likely) that the book will not have <em>exactly</em> four vertices. By approximating the contour we can ensure we are able to side-step this problem.</p>
<p>Lastly, we make a check to see if the approximated contour does indeed have four vertices. If it does, then we draw the contour surrounding the book and then increment the total number of books counter.</p>
<p>We’ll wrap this example up by writing the total number of books found to the terminal and displaying the output image:</p>
<pre># display the output
print "I found {0} books in that image".format(total)
cv2.imshow("Output", image)
cv2.waitKey(0)</pre>
<p>At this point our output image should look like this:</p>
<p><a href="https://freepythontips.files.wordpress.com/2015/03/find_books_output.jpg"><img class="alignnone size-large wp-image-570" src="https://freepythontips.files.wordpress.com/2015/03/find_books_output.jpg?w=696&amp;h=525" alt="find_books_output"/></a></p>
<p>And our terminal does indeed show that we have successfully found the four books in the image will ignoring the other distractor objects:</p>
<p><a href="https://freepythontips.files.wordpress.com/2015/03/find_books_terminal_output.jpg"><img class="alignnone size-large wp-image-571" src="https://freepythontips.files.wordpress.com/2015/03/find_books_terminal_output.jpg?w=696&amp;h=473" alt="find_books_terminal_output"/></a></p>
<p>To execute the script yourself, open up a terminal and execute the following commnd:</p>
<pre>$ python find_books.py</pre>
<h1 id="summary">Summary</h1>
<p>In this blog post you learned how to find books in images using simple image processing and computer vision techniques with Python and OpenCV.</p>
<p>In review, our approach was to:</p>
<ol>
<li>Load the image from disk and convert it to grayscale.</li>
<li>Blur the image slightly.</li>
<li>Apply the Canny edge detector to detect edges (i.e. outlines) of the objects in the image.</li>
<li>Apply a closing morphological operation to close any gaps in the outlines.</li>
<li>Find the contours of the objects in the image.</li>
<li>Apply contour approximation to determine if the contour was a rectangle, and thus a book.</li>
</ol>
<p>And that’s all there is to it!</p>
<p>I hope you enjoyed this blog post! And a big thanks to Yasoob for giving me this opportunity! If you’re interested in learning more about myself and computer vision, <a href="http://www.pyimagesearch.com/">check out the PyImageSearch blog</a>.</p>
<h2 id="what-are-the-next-steps">What are the next steps?</h2>
<p>We are only scratching the surface of what we can do with computer vision and image processing. Finding contours is just the start.</p>
<p>If you’re interested in learning how to <strong>detect faces in images</strong>, <strong>track objects in video</strong>, or <strong>handwriting recognition</strong>, take a look at my book, <em><a href="https://www.pyimagesearch.com/practical-python-opencv/">Practical Python and OpenCV</a></em>. Yasoob has written <a href="https://freepythontips.wordpress.com/2015/01/19/kickstarter-pyimagesearch-gurus/">a review</a> about one of my courses as well.</p>
<h1 id="downloads">Downloads:</h1>
<p>To download the source code and example images used in this article, <a href="http://www.pyimagesearch.com/wp-content/uploads/2015/03/find-books.zip">use this link</a>.</p>
<hr/>
<p> </p>
<p>Guys I hope that you enjoyed this interesting intro to image processing in Python and OpenCV. I am sure that there would be more posts like this in future. If you have any comments and feedback do comment below.</p>
<p>See you till next time.</p>
		<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing"><h3 class="sd-title">Show your love by sharing this:</h3></div></div><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-55796613-562-56d5a81ec90fa" data-src="//widgets.wp.com/likes/#blog_id=55796613&amp;post_id=562&amp;origin=freepythontips.wordpress.com&amp;obj_id=55796613-562-56d5a81ec90fa" data-name="like-post-frame-55796613-562-56d5a81ec90fa"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p></div>					</div>
		
		</div></body></html>