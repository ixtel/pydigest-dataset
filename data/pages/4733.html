<html><body><div><div class="content">
      
        <h1 class="content-title">Alternative Redis-Like Databases with Python</h1>
      
      
      
  
  
  
    <p><a href="http://media.charlesleifer.com/blog/photos/p1432653421.74.png" title="photos/p1432653421.74.png"><img alt="photos/p1432653421.74.png" class="img-responsive" src="http://m.charlesleifer.com/t/800x-/blog/photos/p1432653421.74.png?key=VBYMfqPFZev_qncNGGh5oQ"/></a></p>
<p><a href="http://redis.io">Redis</a> is one of the more unique NoSQL offerings to have become popular over the past five years. It seems that there is no limit to the use-cases one can find for Redis. It's fantastic as a cache, doubles as a task-queue, can provide fast type-ahead search, and much more. The idea that you can store data-structures instead of rows and columns, keys and values, or JSON documents strikes me as particularly innovative. A while back I released <a href="http://walrus.readthedocs.org">walrus</a>, a collection of Python utilities I'd built to simplify some of these use-cases and provide Pythonic APIs for the data-structures Redis natively supports. If you're a Python developer you might <a href="https://github.com/coleifer/walrus">check it out</a>.</p>
<p>Recently I've learned about a few new <em>Redis-like</em> databases: <a href="https://github.com/seppo0010/rlite">Rlite</a>, <a href="http://vedis.symisc.net">Vedis</a> and <a href="http://ledisdb.com">LedisDB</a>. Each of these projects offers a slightly different take on the <em>data-structure server</em> you find in Redis, so I thought that I'd take some time and see how they worked. In this post I'll share what I've learned, and also show you how to use these databases with Walrus, as I've added support for them in the latest 0.3.0 release.</p>
<h3>Rlite</h3>
<p><a href="https://github.com/seppo0010/rlite">Rlite</a> is to Redis what SQLite is to Postgresql. What this means is that Rlite provides virtually all the same functionality of Redis in a serverless, zero-config library you embed as part of your application. Some of Rlite's features are:</p>
<ul>
<li>Serverless / zero-config library.</li>
<li><strong>Support for virtually every Redis command</strong>.</li>
<li>Supports transactions.</li>
<li>Scripting via Lua.</li>
<li>Databases can be either in-memory or stored in a single file on disk. By storing data on-disk Rlite allows you to work with data-sets that exceed available memory.</li>
<li>Lots of language support: objective-c, golang, java, javascript, php, python, ruby, r, and of course C.</li>
</ul>
<p>Rlite could be used for mobile development, where a separate server process is not practical. Rlite would also work well in development, testing or continuous-integration environments. The project's README suggests using Rlite as a slave of your Redis cluster to provide additional durability. Rlite might also be useful for large data-sets that do not fit in RAM.</p>
<p>The author of Rlite has also written the <a href="https://github.com/seppo0010/rlite-py">Python bindings</a>, which can be installed using <code>pip</code>:</p>

<p>Rlite seems like a very cool project. The compatibility with Redis is a strong selling point since it meant I could re-use a lot of my existing tools. If you're curious about how Rlite stores data on disk, the author has provided <a href="https://github.com/seppo0010/rlite/blob/master/doc/rld-format.md">documentation</a> about the RLD file format and <a href="https://github.com/seppo0010/rlite/blob/master/doc/wal-format.md">write-ahead log</a>.</p>
<h3>Vedis</h3>
<p><a href="http://vedis.symisc.net">Vedis</a> is another embedded database with over <a href="http://vedis.symisc.net/commands.html">70 Redis-like commands</a>. Like Rlite, Vedis is serverless, zero-config, and supports both in-memory and on-disk databases. According to the project's README,</p>
<blockquote>
<p>Vedis is a self-contained C library without dependency. It requires very minimal support from external libraries or from the operating system. This makes it well suited for use in embedded devices that lack the support infrastructure of a desktop computer. This also makes Vedis appropriate for use within applications that need to run without modification on a wide variety of computers of varying configurations.</p>
</blockquote>
<p>The distinctive features of Vedis are:</p>
<ul>
<li>Serverless / zero-config library.</li>
<li>Transactional (ACID) datastore.</li>
<li>Databases can be either in-memory or stored in a single file on disk.</li>
<li>Built on fast key/value store, which can be used directly for fast key/value operations.</li>
<li>Cross-platform file format.</li>
<li>Thread-safe and fully re-entrant.</li>
<li><a href="http://vedis-python.readthedocs.org">Python bindings</a> allow you to <a href="http://vedis-python.readthedocs.org/en/latest/custom_commands.html">write your own commands</a> in Python.</li>
</ul>
<p>Use-cases for Vedis are similar to Rlite, but Vedis is not nearly as compatible with Redis, so it's kind of it's own thing. I can see it being useful in mobile or resource-constrained environments, as well as for local development and testing. Vedis might also be useful for data-sets that don't fit in RAM.</p>
<p>It's important to note that Vedis supports a more limited subset of commands than Rlite. Specifically, Vedis is entirely lacking a sorted set data-type, and the list implementation only offers a handful of methods (index, push, pop, length). The hash and set data-types, however, are pretty full-featured.</p>
<p>I happen to be the author of the <a href="http://vedis-python.readthedocs.org">vedis-python</a> bindings, which use <code>ctypes</code>. One neat feature is that you can extend Vedis with your own commands, implemented in Python. The Python bindings can be installed with <code>pip</code>:</p>

<p>Unfortunately, the developers of Vedis, <a href="http://www.symisc.net/">Symisc Systems</a>, have indicated that the project is not currently being actively developed. Symisc is doing some really neat stuff, though, and hopefully they will pick the project back up.</p>
<h3>LedisDB</h3>
<p><a href="https://github.com/siddontang/ledisdb">LedisDB</a> is the most Redis-like of the projects discussed in this post. Unlike the previous databases, LedisDB can run as a separate server process or be embedded in a golang app. LedisDB is unique in that it supports a number of different storage backends such as LevelDB, RocksDB, LMDB, and more. It seems to me to have parity with Redis' features.</p>
<p>LedisDB has the following distinctive features:</p>
<ul>
<li>Supports virtually every Redis command.</li>
<li>Supports multiple storage backends, including LevelDB, RocksDB, LMDB, BoltDB, and in-memory databases.</li>
<li>Size of data-set is not limited by RAM.</li>
<li>Transactions.</li>
<li>Supports the Redis protocol for communication, so most clients and other tools work with LedisDB.</li>
<li>RESTful API allows you to communicate with LedisDB over HTTP.</li>
<li>Written in golang, easy to deploy.</li>
</ul>
<p>I see the use-cases for LedisDB to be primarily derived from it's ability to work with multiple key/value storage backends, and as a consequence, to store data-sets that exceed available RAM. The HTTP API is a cool addition, though thanks to it's compatibility with Redis' wire protocol, existing tools will probably work with LedisDB as well.</p>
<p>The <a href="https://github.com/holys/ledis-py">python bindings</a> can be installed with <code>pip</code>:</p>

<p>LedisDB seems like a really neat project, and the author provides some nice <a href="https://github.com/siddontang/ledisdb/wiki/Benchmark">benchmarks</a> showing Ledis lagging only slightly behind Redis for many use-cases, which is impressive given that it is using on-disk databases.</p>
<h2>Using with Walrus</h2>
<p><a href="http://media.charlesleifer.com/blog/photos/p1432653100.56.png" title="photos/p1432653100.56.png"><img alt="photos/p1432653100.56.png" class="img-responsive" src="http://m.charlesleifer.com/t/800x-/blog/photos/p1432653100.56.png?key=rT-UaBtK0fxDRoB54Yjoxw"/></a></p>
<p>With the version 0.3.0 release, I've added a new <code>tusks</code> submodule to the <code>walrus</code> package that contains classes for working with the above libraries. To use a particular tusk, just make sure the appropriate Python bindings are installed.</p>
<p>The Walrus project is, at the most basic level, simply a wrapper around Andy McCurdy's <a href="https://redis-py.readthedocs.org/en/latest/">redis-py</a> library. Walrus provides various high-level APIs on top of this, but that's the gist. If you'd like a quick introduction to Walrus, check out <a href="/blog/walrus-lightweight-python-utilities-for-working-with-redis/">this blog post</a>.</p>
<h3>Rlite + Walrus = WalrusLite</h3>
<p>To use Rlite with Walrus, you can use the <code>WalrusLite</code> class, found in the <code>walrus.tusks.rlite</code> module.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">walrus.tusks.rlite</span> <span class="kn">import</span> <span class="n">WalrusLite</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">WalrusLite</span><span class="p">(</span><span class="s1">':memory:'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">huey</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Hash</span><span class="p">(</span><span class="s1">'huey'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">huey</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">temperament</span><span class="o">=</span><span class="s1">'ornery'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'kitty'</span><span class="p">)</span>
<span class="go">&lt;Hash "huey": {'color': 'white', 'type': 'kitty', 'temperament': 'ornery'}&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">huey</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">['color', 'type', 'temperament']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">'color'</span> <span class="ow">in</span> <span class="n">huey</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">huey</span><span class="p">[</span><span class="s1">'color'</span><span class="p">]</span>
<span class="go">'white'</span>
</pre></div>
<p>At the time of writing, the only important commands that did not seem to be implemented were the <code>HSCAN</code>, <code>SSCAN</code> and <code>ZSCAN</code> commands which are used for efficient iteration. In their place, Walrus provides compatible implementations that rely on <code>HGETALL</code>, <code>SMEMBERS</code> and <code>ZRANGE</code>, respectively.</p>
<h3>Vedis + Walrus = WalrusVedis</h3>
<p>To use Vedis with Walrus, you can use the <code>WalrusVedis</code> class, found in the <code>walrus.tusks.vedisdb</code> module. In the examples below we'll implement two custom commands: a simple command that converts a string to title-case, and a command to calculate the union of two sets.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">walrus.tusks.vedisdb</span> <span class="kn">import</span> <span class="n">WalrusVedis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">WalrusVedis</span><span class="p">(</span><span class="s1">':memory:'</span><span class="p">)</span>  <span class="c1"># Create an in-memory database.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nd">@db.command</span><span class="p">(</span><span class="s1">'SUNION'</span><span class="p">)</span>  <span class="c1"># Vedis supports SDIFF and SINTER, but not SUNION.</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">sunion</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">smembers</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span> <span class="o">|</span> <span class="n">db</span><span class="o">.</span><span class="n">smembers</span><span class="p">(</span><span class="n">key2</span><span class="p">))</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nd">@db.command</span><span class="p">(</span><span class="s1">'KTITLE'</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">ktitle</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">source_val</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">source_val</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">source_val</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">False</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s1">'s1'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s1">'s2'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">SUNION</span><span class="p">(</span><span class="s1">'s1'</span><span class="p">,</span> <span class="s1">'s2'</span><span class="p">)</span>
<span class="go">['1', '0', '3', '2', '4']</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'charlie leifer'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">KTITLE</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span>
<span class="go">'Charlie Leifer'</span>
</pre></div>
<h3>LedisDB + Walrus = WalrusLedis</h3>
<p>To use LedisDB instead of Redis in your Python application, you can use the <code>WalrusLedis</code> class in place of the usual <code>Walrus</code> object:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">walrus.tusks.ledisdb</span> <span class="kn">import</span> <span class="n">WalrusLedis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">WalrusLedis</span><span class="p">()</span>
</pre></div>
<p>Like Rlite, you should be able to use <code>WalrusLedis</code> just as you would use the normal <code>Walrus</code> object.</p>
<h3>Thanks for reading</h3>
<p>Thanks for taking the time to read this post, I hope you found it interesting. If you'd like to try out these alternate backends with <a href="http://walrus.readthedocs.org">walrus</a>, check out the <a href="http://walrus.readthedocs.org/en/latest/alt-backends.html">alternate backend doc</a>, which contains a condensed version of the material in this post.</p>
<p>Do you know of any other Redis-like databases out there? I'd be very interested to hear about them!</p>
<h3>Links</h3>
<p>Here are some links which you may find helpful:</p>

<p>Here are some blog posts on similar topics:</p>

  
  

  
  
  


<hr/>

  <p>Commenting has been closed, but please feel free to <a href="/contact/">contact me</a></p>


    </div>

    </div></body></html>