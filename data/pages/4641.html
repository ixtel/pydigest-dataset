<html><body><div><section class="container content">
  <div class="title">
    <h1 class="post-title">Downloading YouTube and Soundcloud Audio with Python and Pandas</h1>
    <p class="when">Published December 17, 2014<br/></p>
  </div>
   <p>As a way to cross-polinate our music interests and listen to some new grooves, a friend of mine included me on mixtape swap for 2014 -- everyone picked one track to submit to the group. All of the tracks got put it in a Google poll, and naturally it was easy enough to get downloaded into a CSV and emailed out.</p>

<p>Rather than copying and pasting my way through the list to try to watch them all (or making a YouTube playlist which I couldn't watch/listen to on my flight home), I decided to script it.</p>

<p>Turns out, it's pretty easy in Python with the help of <a href="http://rg3.github.io/youtube-dl/"><code>youtube-dl</code></a>.</p>

<p><i><b>Caveat: this post is <u>purely an excercise in knowledge</u>, and you shouldn't do anything illegal, including running the code in this post verbatim.<b/></b></i></p>

<h2>YouTub Downloader</h2>

<p><a href="http://rg3.github.io/youtube-dl/"><code>youtube-dl</code></a> is a great little open-source collaboration that allows you to pull video and audio from a number of different video sites. </p>

<p>If you download it from pip, </p>

<p>you can see all the sites currently supported (all 493 of them!):</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>youtube-dl --extractor-descriptions <span class="p">|</span> wc -l
493
<span class="nv">$ </span>youtube-dl --extractor-descriptions <span class="p">|</span> head -n 15
1up.com
220.ro
24video
3sat
4tube
56.com
5min
8tracks
9gag
abc.net.au
AcademicEarth:Course
AddAnime
AdultSwim
Aftonbladet
Allocine
</code></pre></div>
<p>You'll find everything from <code>Soundcloud</code> to <code>YouTube</code> to <code>YouPorn</code>. Obviously I haven't verifed all these work, but the devs have made it quite easy <a href="https://github.com/rg3/youtube-dl/blob/master/CONTRIBUTING.md#adding-support-for-a-new-site">to add new sources</a>.</p>

<p>Conviently, it's also a nicely wrapped command line utility. However, I wanted to be able to use YouTube videos programmatically in a few other projects, so I wanted to be able to script it out. </p>

<p>Don't forget: <code>youtube-dl</code> is a project that depends on the layout of sites on the web, meaning that the extractors need to constantly change as well. Save yourself the trouble and periodically update the tool:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>pip install --upgrade youtube-dl
</code></pre></div>
<p>Otherwise you might find that extractors stop functioning without any apparent reason. </p>

<h2>Scripting <code>youtube-dl</code></h2>

<p>You can see all the <a href="https://github.com/rg3/youtube-dl/blob/master/youtube_dl/options.py">options for <code>youtube-dl</code></a>, but beware, there are a ton. The good news is there's a nice correspondence between the command line opts and the ones for scripting. </p>

<p>It's quite easy to do something simple, like download <a href="http://www.youtube.com/watch?v=ZHWZf1Z4B5k">a video of a bunny taking a shower</a>:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">youtube_dl</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">'outtmpl'</span><span class="p">:</span> <span class="s">'</span><span class="si">%(id)s</span><span class="s">'</span><span class="p">}</span>  <span class="c"># save file as the YouTube ID</span>
<span class="k">with</span> <span class="n">youtube_dl</span><span class="o">.</span><span class="n">YoutubeDL</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
    <span class="n">ydl</span><span class="o">.</span><span class="n">download</span><span class="p">([</span><span class="s">'http://www.youtube.com/watch?v=ZHWZf1Z4B5k'</span><span class="p">])</span>
</code></pre></div>
<p>It turns out of course that if we only want audio (in the case of a song), we'd rather not download the entire video file. We can adjust our options not only to only download the audio, but convert it to the format of our choosing!</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'format'</span><span class="p">:</span> <span class="s">'bestaudio/best'</span><span class="p">,</span> <span class="c"># choice of quality</span>
    <span class="s">'extractaudio'</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>      <span class="c"># only keep the audio</span>
    <span class="s">'audioformat'</span> <span class="p">:</span> <span class="s">"mp3"</span><span class="p">,</span>      <span class="c"># convert to mp3 </span>
    <span class="s">'outtmpl'</span><span class="p">:</span> <span class="s">'</span><span class="si">%(id)s</span><span class="s">'</span><span class="p">,</span>        <span class="c"># name the file the ID of the video</span>
    <span class="s">'noplaylist'</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>        <span class="c"># only download single song, not playlist</span>
<span class="p">}</span>
</code></pre></div>
<p>Note that the slashes in options fields correspond to your preference -- the first will be tried, but if not availiable, your next preference (following the next slash) will be used. </p>

<p>We also don't want to automate the downloading of an entire playlist (thought sometimes that comes in handy).</p>

<p>Also, some of the time <code>youtube-dl</code> isn't able to just extract the audio, and will have to download the video first and then convert it. Underneath the hood <code>youtube-dl</code> appears to be using <code>pydub</code>, an <code>ffmpeg</code> wrapper. You can see the postprocessors <a href="https://github.com/rg3/youtube-dl/blob/master/youtube_dl/postprocessor/__init__.py">here</a>.</p>

<h2>Metadata from YouTube videos</h2>

<p>You can also use <code>youutbe-dl</code> to get information about videos. The type and variety of fields you can extract depends on the source extractor, but let's look at an example from YouTube. </p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">youtube_dl</span>

<span class="c"># download metadata</span>
<span class="n">ydl</span> <span class="o">=</span> <span class="n">youtube_dl</span><span class="o">.</span><span class="n">YoutubeDL</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"https://www.youtube.com/watch?v=hwsXo6fsmso"</span>
<span class="k">with</span> <span class="n">ydl</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">extract_info</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c"># don't download, much faster </span>

<span class="c"># print some typical fields</span>
<span class="k">print</span> <span class="s">"</span><span class="si">%s</span><span class="s"> was uploaded by '</span><span class="si">%s</span><span class="s">' and has </span><span class="si">%d</span><span class="s"> views, </span><span class="si">%d</span><span class="s"> likes, and </span><span class="si">%d</span><span class="s"> dislikes"</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">'title'</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s">'uploader'</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s">'view_count'</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s">'like_count'</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s">'dislike_count'</span><span class="p">])</span>
</code></pre></div>
<p>outputs:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Skrillex - Ease My Mind with Niki &amp; The Dove [AUDIO] was uploaded by 'Skrillex' and has 5318382 views, 54090 likes, and 1103 dislikes
</code></pre></div>
<h2>Putting it all together</h2>

<p>Let's go right from a CSV with <a href="http://pandas.pydata.org/"><code>pandas</code></a> to mp3 files on disk. Here's a short couple of lines from a hypothetical CSV:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Artist;Title;Link
Skrillex;Ease My Mind;https://www.youtube.com/watch?v=hwsXo6fsmso
Elvis Costello; Pump It Up; ; https://www.youtube.com/watch?v=tpprOGsLWUo
Donnie Trumpet &amp; The Social Experiment; Sunday Candy; https://soundcloud.com/donnietrumpet/donnie-trumpet-the-social-experiment-sunday-candy
Mos Def; Mathematics; ; https://www.youtube.com/watch?v=m5vw4ajnWGA
Thelonius Monk; Friday the 13th; ; https://www.youtube.com/watch?v=NT9xGJvW13c
Hauschka; The Key; ; https://www.youtube.com/watch?v=D2HX3peUN8o
</code></pre></div>
<p>Reading it in is pretty simple:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"videos.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">";"</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>  <span class="c"># print out a single row</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> 
<span class="n">Artist</span>                                         <span class="n">Tame</span> <span class="n">Impala</span>
<span class="n">Title</span>                                             <span class="n">Elephant</span>
<span class="n">Link</span>           <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">youtube</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">watch</span><span class="err">?</span><span class="n">v</span><span class="o">=</span><span class="n">B6CZTDCb7g4</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</code></pre></div>
<p>The process of downloading will also take a while, so I also want to make the process be able to cache results and know what it's downloaded already without doing too much work. </p>

<p>Here's the quick and dirty script!</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">youtube_dl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="n">CSV</span> <span class="o">=</span> <span class="s">"videos.csv"</span>

<span class="c"># create directory</span>
<span class="n">savedir</span> <span class="o">=</span> <span class="s">"mixtape"</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savedir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_savepath</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">savedir</span><span class="o">=</span><span class="n">savedir</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span> <span class="s">"</span><span class="si">%s</span><span class="s">--</span><span class="si">%s</span><span class="s">.mp3"</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">artist</span><span class="p">))</span>

<span class="c"># create YouTube downloader</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'format'</span><span class="p">:</span> <span class="s">'bestaudio/best'</span><span class="p">,</span> <span class="c"># choice of quality</span>
    <span class="s">'extractaudio'</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>      <span class="c"># only keep the audio</span>
    <span class="s">'audioformat'</span> <span class="p">:</span> <span class="s">"mp3"</span><span class="p">,</span>      <span class="c"># convert to mp3 </span>
    <span class="s">'outtmpl'</span><span class="p">:</span> <span class="s">'</span><span class="si">%(id)s</span><span class="s">'</span><span class="p">,</span>        <span class="c"># name the file the ID of the video</span>
    <span class="s">'noplaylist'</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,}</span>       <span class="c"># only download single song, not playlist</span>
<span class="n">ydl</span> <span class="o">=</span> <span class="n">youtube_dl</span><span class="o">.</span><span class="n">YoutubeDL</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ydl</span><span class="p">:</span>

    <span class="c"># read in videos CSV with pandas</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">CSV</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">";"</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">Link</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Link</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">)</span>  <span class="c"># strip space from URLs</span>

    <span class="c"># for each row, download</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">"Downloading: </span><span class="si">%s</span><span class="s"> from </span><span class="si">%s</span><span class="s">..."</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Title</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Link</span><span class="p">)</span>

        <span class="c"># download location, check for progress</span>
        <span class="n">savepath</span> <span class="o">=</span> <span class="n">make_savepath</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Title</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Artist</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">"</span><span class="si">%s</span><span class="s"> already downloaded, continuing..."</span> <span class="o">%</span> <span class="n">savepath</span>
            <span class="k">continue</span>

        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="c"># download video</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">extract_info</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Link</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">'id'</span><span class="p">],</span> <span class="n">savepath</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">"Downloaded and converted </span><span class="si">%s</span><span class="s"> successfully!"</span> <span class="o">%</span> <span class="n">savepath</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">"Can't download audio! </span><span class="si">%s</span><span class="se">\n</span><span class="s">"</span> <span class="o">%</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
</code></pre></div>
<p>You can also do something similar in the command line:</p>

<p>Start by adding this to your <code>~/.bash_profile</code>:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># downloading from youtube</span>
<span class="nb">alias </span><span class="nv">ydl</span><span class="o">=</span><span class="s2">"youtube-dl --extract-audio --audio-format wav"</span>
</code></pre></div>
<p>Then whenever you open a new terminal, you can simply type <code>ydl</code> with the link of any applicable YouTube, Soundcloud, etc link and it will automatically download into the current working directory.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ydl http://www.youtube.com/watch?v<span class="o">=</span>ZHWZf1Z4B5k
</code></pre></div>
<p>I find the flexibility of keeping everything in Python and extracting metadata there is more powerful, however. </p>

<h2>Conclusion</h2>

<p>Super easy! Be aware that sometimes the process for downloading audio fails (resulting in empty or corrupted audio), and so some kind of more complicated verification to ensure download and conversion is definitely needed. </p>

<p>If you liked this post, feel free to
<a href="https://twitter.com/intent/tweet?url=http://willdrevo.com/downloading-youtube-and-soundcloud-audio-with-python-and-pandas&amp;text=Downloading YouTube and Soundcloud Audio with Python and Pandas&amp;via=wddrevo" target="_blank">
  share it with your followers</a> 
or 
<a href="https://twitter.com/wddrevo">follow me on Twitter!</a></p>

   
<br/>
<p id="disqus_thread"/>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</section>


    

  </div></body></html>