<html><body><div><div class="post-text" itemprop="text">
<p>The <code>BrokenPipeError</code> is normal as said phantom because the reading process (head) terminates and closes its end of the pipe while the writing process (python) still tries to write.</p>

<p>Is <strong>is</strong> an abnormal condition, and the python scripts receives a <code>BrokenPipeError</code> - more exactly, the Python interpreter receives a system SIGPIPE signal that it catches and raises the <code>BrokenPipeError</code> to allow the script to process the error.</p>

<p>And you effectively can process the error, because in your last example, you only see a message saying that the exception was ignored - ok it is not true, but seems related to this <a href="http://bugs.python.org/issue11380,#msg153320" rel="nofollow">open issue</a> in Python : Python developpers think important to warn user of the abnormal condition.</p>

<p>What really happens is that AFAIK the python interpreter always signals this on stderr, even if you catch the exception. But you just have to close stderr before exiting to get rid of the message.</p>

<p>I slightly changed your script to :</p>

<ul>
<li>catch the error as you did in your last example</li>
<li>catch either IOError (that I get in Python34 on Windows64) or BrokenPipeError (in Python 33 on FreeBSD 9.0) - and display a message for that</li>
<li>display a custom <em>Done</em> message on stderr (stdout is closed due to the broken pipe)</li>
<li><strong>close stderr</strong> before exiting to get rid of the message</li>
</ul>

<p>Here is the script I used : </p>

<pre><code>import sys

try:
    for i in range(4000):
            print(i, flush=True)
except (BrokenPipeError, IOError):
    print ('BrokenPipeError caught', file = sys.stderr)

print ('Done', file=sys.stderr)
sys.stderr.close()
</code></pre>

<p>and here the result of <code>python3.3 pipe.py | head -10</code> :</p>

<pre class="lang-none prettyprint-override"><code>0
1
2
3
4
5
6
7
8
9
BrokenPipeError caught
Done
</code></pre>

<p>If you do not want the extraneous messages just use :</p>

<pre><code>import sys

try:
    for i in range(4000):
            print(i, flush=True)
except (BrokenPipeError, IOError):
    pass

sys.stderr.close()
</code></pre>
    </div>
    </div></body></html>