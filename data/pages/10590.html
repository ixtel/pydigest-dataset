<html><body><div><p class="lead" itemprop="description">Краткий анонс новой библиотеки, позволяющей играм/приложениям, написанным на Python получать доступ к функциональности, предлагаемой платформой Steam.</p>
                <div class="py_user"><p>Началось всё так: уезжая в отпуск я закинул себе на ноутбук новую версию Steam SDK. Просто так закинул, ради интереса: вдруг что-то в ней появилось. А закончилось тем, что сегодня я выложил на PyPI свежую разработку — </p><a href="https://pypi.python.org/pypi/steampak" target="_blank">steampak</a><p>. Теперь обо всём по порядку.</p><a href="http://store.steampowered.com/" target="_blank">Steam</a><p> — это довольно известный сервис распространения цифрового содержимого (игры, программы, видео) от компании </p><i>Valve</i><p>. Компания Valve в девяностых делала его как платформу для распространения и обновления своих игр (Half-Life, Team Fortress, Counter-Strike), но с тех пор многое изменилось и на этой площадке публикуются тысячи продуктов других компаний и независимых разработчиков. Вы загружаете с сайта и ставите себе программу-клиент и через неё получаете доступ  цифровому магазину, сообществам по интересам и вашей библиотеке приложений (игр).</p><p>Пару-тройку лет назад Valve сумела разглядеть в операционных системах отличных от </p><i>Windows</i><p> непаханое поле рынка и, одной из первых, нужно признать, начала направлять туда своих агрономов для подготовки почвы. Сегодня, судя по тому, какое количество игр (в том числе класса </p><i>AAA</i><p>) выходит с поддержкой </p><i>Linux</i><p>, а также учитывая то, что Valve начала выпускать машинки типа </p><i>SteamBox</i><p>, под управлением операционной системы, основанной на </p><i>Debian</i><p>, можно сказать, что поле начинает давать всходы.</p><p>На площадке Steam, кроме прочего, независимые разработчики и начинающие студии могут воспользоваться сервисом </p><i>Greenlight</i><p> — выставить свою игру (или прототип) на обозрение пользователям, и если она их заинтересует, то Valve предложит вам распространять её через Steam.</p><p>Для разработчиков игр Valve предлагает платформу </p><i>Steamworks</i><p>, через которую можно управлять своими приложениями в Steam. Кроме прочего, с </p><a href="https://partner.steamgames.com/" target="_blank">сайта Steamworks</a><p> можно загрузить архив с инструментарием для разработчика (SDK). Этот инструментарий включает в себя библиотеки для взаимодействия вашей игры с клиентом Steam под разные ОС, пример их использования в виде простенькой «игры» </p><i>Spacewar</i><p> и некоторые другие полезности. </p><p>Не секрет, что на Python можно писать игры (или использовать его для скриптования), интересные, удачные, достойно выглядящие. А вот бы ещё обучить такие игры взаимодействию со Steam. Среди полезностей, предоставляемых SDK, есть заголовочные </p><b>.h</b><p> файлы, описывающие сигнатуры предлагаемых Steam методов. И можно бы, воспользовавшись этой информацией, написать обвязку. Писать обвязки для библиотек, </p><a href="http://pythonz.net/articles/19/" target="_blank">если вы помните</a><p>, лучше при помощи </p><b>ctypes</b><p>, входящего в стандартную поставку Python. Одна загвоздка: Steam-клиент написан на C++, и если «обёртывание» обычных функций особого труда не составляет, то для обращения к атрибуту экземпляра класса ctypes инструментов не предоставляет (по большей части из за того, что ввиду отсутствия строго стандарта разные компиляторы C++ по разному располагают структуры в памяти). Загвоздку можно было бы обойти, путём написания собственной обёртки на C, которая сделала обращение к атрибутам объектов плоским, но это потребовалось бы поддерживать.</p><p>И тут в отпуске я обнаружил, что в </p><i>Steam SDK</i><p>, начиная с версии 1.32, выпущенной как раз ко дню моего рождения, сделали дополнительный плоский API в стиле C. Вот здесь я и не удержался. </p><p>Сразу оговорюсь, что это не перенос API как есть, а попытка переосмысления в парадигме Python. Прежде всего из-за того, что в оригинальном API, который нарабатывался годами, накопилось несколько, мягко говоря, спорных моментов.</p><p>Пример использования </p><b>steampak</b><p>:</p><pre><code class="python"><br/>    from steampak import SteamApi  # Это единая точка вход в API.<br/><br/>    # Указываем путь до файла библиотеки.<br/>    LIBRARY_PATH = '/home/me/my_steam_game/libsteam_api.so'<br/>    <br/>    # И идентификатор вашей игры, полученный в Steamworks.<br/>    # Можно не передавать его параметром, а просто положить <br/>    # файл 'steam_appid.txt' с этим идентификатором в директорию с игрой.<br/>    APP_ID = 480  # Это ID игры 'Spacewar', она идёт в SDK.<br/>    <br/>    api = SteamApi(LIBRARY_PATH, app_id=APP_ID)<br/>    <br/>    # Выведем имена друзей пользователя:<br/>    for user in api.friends():<br/>        print(user.name)<br/>    <br/>    # Для интереса получим код страны:<br/>    print(api.utils.country_code)<br/>    <br/>    # Поглядим, как у пользователя с достижениями по нашей игре:<br/>    for ach_name, ach in api.apps.current.achievements():<br/>        print('%s (%s): %s' % (ach.title, ach_name, ach.get_unlock_info()))<br/>    <br/>    # И попробуем получить список игр (приложений) пользователя:<br/>    for app_id, app in api.apps.installed():<br/>        print('%s: %s' % (app_id, app.name))<br/>    <br/>    # Под занавес не потушить API.<br/>    api.shutdown()<br/></code></pre><p>Если вам вдруг интересно, зачем я это делал, тем более в отпуске, то ответ состоит из двух частей: 1. разрабатывать на Python интересно везде; 2. я хочу, чтобы в Steam появлялись игры на Python. </p><i>Только не надо больше «графических романов» в «японском» стиле, а то уже тошнит, правда</i><p>.</p><p>На текущий момент </p><i>steampak</i><p> реализует далеко не всё, что умеет оригинальный API. Под большим вопросом стоит поддержка функциональности, использующей обратные вызовы — так Steam-клиент реализует асинхронную работу (опять же из-за того, что обработчиком обратных вызовов ожидается объект C++, а не обычная функция). </p><p>Если вам интересен проект, </p><a href="https://github.com/idlesign/steampak" target="_blank">подключайтесь к разработке</a><p>.</p><i>Да, вы можете проставить себе все достижения во всех ваших играх, но вы ведь не станете? %)</i></div>

                

                

                </div></body></html>