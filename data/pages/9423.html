<html><body><div><div class="content">
          <p>There are many ways to handle permissions in a project. For instance we may have model level permissions, object level permissions, fine grained user permission or role based. Either way we don't need to be writing any of those from scratch, Django ecosystem has a vast amount of permission handling apps that will help us with the task. In this post we will compare how some popular permission apps work so you know which one suits your project needs. If you want to explore a little more, Django Packages has a <a href="https://www.djangopackages.com/grids/g/perms/">full grid on permissions</a>, you should take a look.</p>
<h2>1. Native Django permissions</h2>
<p>As we would expect, Django has a native permission system that works very well in many situations and it's great if final users are making intense use of the Django admin interface. It is a model level permission system that can be applied to either single users or a group. If you have <code>django.contrib.auth</code> in your <code>INSTALLED_APPS</code> django will automatically create <code>add</code>, <code>change</code>and <code>delete</code> permission types to every model in your system (or any one you add later). Giving or revoking this permissions to users will limit the actions they can take when they log in to the admin. Instead of managing user by user, you can also create a group, add users to it and manage the permissions for the whole group.</p>
<p>But this is not limited to the admin. You can verify user permissions in your own views using the <code>has_perm</code> method provided in the user model.</p>
<div class="highlight"><pre><span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'foo.add_bar'</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"You are authorized to add content!"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"Permission to add denied"</span><span class="p">)</span>
</pre></div>


<p>you can also check user permissions in your templates, using the <code>perms</code> variable that is automatically added to the template context:</p>
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.app_label.can_do_something</span> <span class="cp">%}</span><span class="x"/>
<span class="x">    This content will be shown users with can_do_something permission.</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"/>
<span class="x">This content will be shown to all users.</span>
</pre></div>


<p>You can also create your own permissions to the models:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Content</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">'view_content'</span><span class="p">,</span> <span class="s">'View content'</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>


<p>Check the <a href="https://docs.djangoproject.com/en/dev/topics/auth/default/#permissions-and-authorization">official documentation</a> for more information on how to create new permissions, programmatically managing user permissions and working with groups.</p>
<h2>2. Django guardian</h2>
<p><a href="https://github.com/django-guardian/django-guardian">Django Guardian</a> is an third party app focused on handling object level permissions. While the native Django permissions manages the access to all objects in a model, with guardian we can control the access to a particular instance of a model. A good thing is that it has a similar interface to Django's:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">contents.model</span> <span class="kn">import</span> <span class="n">Content</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">guardian.shortcuts</span> <span class="kn">import</span> <span class="n">assign_perm</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'The Writer'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">joe</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'joe'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">content</span> <span class="o">=</span> <span class="n">Content</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">owner</span><span class="o">=</span><span class="n">writer</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">'This is the content!'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">joe</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'view_content'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">assign_perm</span><span class="p">(</span><span class="s">'view_content'</span><span class="p">,</span> <span class="n">joe</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">joe</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'view_content'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="bp">True</span>
</pre></div>


<p>You can do the same to groups:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">Group</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">group</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'reviewers'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">assign_perm</span><span class="p">(</span><span class="s">'view_content'</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">joe</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">joe</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'view_content'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="bp">True</span>
</pre></div>


<p>It also has some very useful methods like <code>get_perms</code> and <code>get_objects_for_user</code>, decorators for your views and template tags.</p>
<h2>3. Django role permissions</h2>
<p><a href="https://github.com/vintasoftware/django-role-permissions">Django role permissions</a> uses a more high level approach to manage access to views and objects. Instead of saying individually which user has access to which object, we will be defining  <code>roles</code> with a default set of permissions defined. </p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">rolepermissions.roles</span> <span class="kn">import</span> <span class="n">AbstractUserRole</span>

<span class="k">class</span> <span class="nc">Writer</span><span class="p">(</span><span class="n">AbstractUserRole</span><span class="p">):</span>
    <span class="n">available_permissions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'create_content'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">'view_content'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Reviewer</span><span class="p">(</span><span class="n">AbstractUserRole</span><span class="p">):</span>
    <span class="n">available_permissions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'create_content'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">'view_content'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>


<p>Once we give a role to a user we will be able to make verifications about his permissions and also about his role.</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">rolepermissions.verifications</span> <span class="kn">import</span> <span class="n">has_permission</span><span class="p">,</span> <span class="n">has_role</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">has_permission</span><span class="p">(</span><span class="n">joe</span><span class="p">,</span> <span class="s">'view_content'</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Reviewer</span><span class="o">.</span><span class="n">assign_role_to_user</span><span class="p">(</span><span class="n">joe</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">has_permission</span><span class="p">(</span><span class="n">joe</span><span class="p">,</span> <span class="s">'view_content'</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">has_role</span><span class="p">(</span><span class="n">joe</span><span class="p">,</span> <span class="s">'reviewer'</span><span class="p">)</span>
<span class="bp">True</span>
</pre></div>


<p>It also allows you to define object level permissions using programming logic:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">rolepermissions.permissions</span> <span class="kn">import</span> <span class="n">register_object_checker</span>

<span class="nd">@register_object_checker</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">publish_content</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>


<p>and verify:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">rolepermissions.verifications</span> <span class="kn">import</span> <span class="n">has_object_permission</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">has_object_permission</span><span class="p">(</span><span class="s">'publish_content'</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</pre></div>


<p>You will also find helper functions, templates tags, decorators and mixins. This project is maintained by Vinta, so shameless plug here :)</p>
<h2>4. Rules</h2>
<p><a href="https://github.com/dfunckt/django-rules">Rules</a> is a very interesting app that does not use any database model to manage object level permissions. Everything is done by verification functions, similar to the django-role-permissions object checkers but more powerful. We start by creating predicates:</p>
<div class="highlight"><pre><span class="nd">@rules.predicate</span>
<span class="k">def</span> <span class="nf">is_content_writter</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">user</span>

<span class="nd">@rules.predicate</span>
<span class="k">def</span> <span class="nf">is_admin_user</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">is_admin</span>
</pre></div>


<p>Then we associate our predicates to a rule:</p>
<div class="highlight"><pre><span class="n">rules</span><span class="o">.</span><span class="n">add_perm</span><span class="p">(</span><span class="s">'contents.change_content'</span><span class="p">,</span> <span class="n">is_content_writter</span><span class="p">)</span>
</pre></div>


<p>We can even use operators to create complex rules that depend on multiple predicates:</p>
<div class="highlight"><pre><span class="n">is_admin_writer</span> <span class="o">=</span> <span class="n">is_content_writter</span> <span class="o">&amp;</span> <span class="n">is_admin_user</span>
<span class="n">rules</span><span class="o">.</span><span class="n">add_perm</span><span class="p">(</span><span class="s">'contents.delete_content'</span><span class="p">,</span> <span class="n">is_admin_writer</span><span class="p">)</span>
</pre></div>


<p>and finally we can test our rules with objects:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">joe</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'contents.delete_content'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">writer</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'contents.delete_content'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="bp">True</span>
</pre></div>


<p>Rules also provides decorators and mixins for your views and template tags. Another cool thing is that it can be used without Django.</p>
<hr/>
<p>I hope you got a quick glance over some of the Django permission apps available and is now able to choose the one that best suits your application. If you know some other interesting apps with different approach we'd love to hear about them in the comments! </p>
        </div>
      </div></body></html>