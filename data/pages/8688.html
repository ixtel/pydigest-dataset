<html><body><div><div class="post-text" itemprop="text">

<p>I have this code to get tweets by running a background process. The following script is run from main script using <code>subprocess.Popen</code> function. So that the main script will stop executing after invoking the background process script. </p>

<pre><code>def start_listner(unique_id, keyword, limit=200):
    class CustomStreamListener(tweepy.StreamListener):

        def __init__(self, api):
            logger.info('runnning')
            self.api = api
            super(tweepy.StreamListener, self).__init__()

            #setup rabbitMQ Connection


        def on_status(self, status):
            print status.text.encode('utf-8'), "\n"
            #queue the tweet and writes the tweet to the log

        def on_error(self, status_code):
          #some code to not kill the stream

        def on_timeout(self):
          #some code to not kill the stream

    sapi = tweepy.streaming.Stream(auth, CustomStreamListener(api))
    try:
        logger.info('tracking started')
        logger.info(keyword)
        logger.info(type(keyword))
        kw = keyword
        sapi.filter(track=[kw])  # keeps listening to the streaming api
    except Exception, err:
        logger.info(kw) # fails at this place when main py stops
        logger.info(err)

if __name__ == "__main__":
    logger.info("just now started")
    try:
        a = str(sys.argv[1])
        b = str(sys.argv[2])
        #c = int(sys.argv[5])
        logger.info(a)
        logger.info(b)
    except Exception, err:
        logger.info("inside main")
    start_listner(a, b)
</code></pre>

<p>According to the highest voted answer <a href="http://stackoverflow.com/questions/1196074/starting-a-background-process-in-python">here</a> I use the following main script to invoke the StreamingAnalytics.py(above code)</p>

<pre><code>import time
import subprocess
subprocess.Popen(["python", "StreamingAnalytics.py", 'SriLankaQ', 'lanka'])

print 'I could escape.........'
time.sleep( 15 )
</code></pre>

<p>I have added a sleep so the tweets will be successfully added to the RabbitMQ queue during that time. But as soon as the main script stops the background process prints the following error.</p>

<blockquote>
  <p>2015-12-22 16:28:16,559 - <strong>main</strong> - INFO - {'text': 'RT @Dory: lanka
  singing Hotline bling \xf0\x9f\x98\x82\xf0\x9f\x98\x82 
  'source': u'Twitter for iPhone'} </p>
  
  <p>2015-12-22 16:28:17,752 - <strong>main</strong> - INFO - lanka</p>
  
  <p>2015-12-22 16:28:17,752 - <strong>main</strong> - INFO - [Errno 22] Invalid argument</p>
</blockquote>

<p><strong>UPDATE:</strong>
Since I thought its an issue in passing arguments I removed the use of arguments by writing them to a file by main script and reading the file from background process file. So,</p>

<pre><code>subprocess.Popen(["python", "StreamingAnalytics.py"])
</code></pre>

<p>But still the same error comes. Using the traceback module I could print more information on this error.</p>

<pre><code>2015-12-24 11:01:16,562 - __main__ - INFO - Traceback (most recent call last):
File "StreamingAnalytics.py", line 84, in &lt;module&gt;
    sapi.filter(track=[keyword])
File "C:\Python27\lib\site-packages\tweepy\streaming.py", line 445, in filter
    self._start(async)
File "C:\Python27\lib\site-packages\tweepy\streaming.py", line 361, in
_start
    self._run()
File "C:\Python27\lib\site-packages\tweepy\streaming.py", line 294, in _run
    raise exception IOError: [Errno 22] Invalid argument
</code></pre>
    </div>
    </div></body></html>