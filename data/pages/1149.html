<html><body><div><div class="post-body entry-content" id="post-body-3183152108380534586" itemprop="description articleBody">

<div class="text_cell_render border-box-sizing rendered_html">
<p>Cards Against Humanity is a pretty awesome game, especially if you're friends have a dark sense of humor and optionally beer. Think of it like Apples to Apples for horrible people. If you've never heard of either of them, I'd recommend picking them up.</p>
<p>The rules for these games is pretty simple:</p>
<ul>
<li>You have two types of cards: Black and White for Cards Against Humanity, Red and Green for Apples to Apples</li>
<li>Each player draws a hand of white or red cards</li>
<li>Each player takes a turn as the judge of the round, who draws a single black or green card</li>
<li>The other players play a card or cards from their hand</li>
<li>The winner gets the black/red card, players draw cards and the next player becomes the judge</li>
</ul>
<p>For the sake of this post, I'll be modeling Cards Against Humanity, since it's a tiny bit more interesting to model than Apples to Apples</p>
<h2 id="step-one-cards">Step One: Cards</h2>
<p>It's always best to start with your basic bits. At least that's how I look at it. In this case, it's the cards. Since cards never change, it's best to model them with an immutable data type. Tuples are the most obvious choice, but card[0] is less descriptive than card.text, so collections.namedtuple is a better choice.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<p class="prompt input_prompt">
In [1]:
</p>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">WhiteCard</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">'WhiteCard'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">BlackCard</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">'BlackCard'</span><span class="p">,</span> <span class="p">[</span><span class="s">'text'</span><span class="p">,</span> <span class="s">'pick'</span><span class="p">,</span> <span class="s">'draw'</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">blacktexts</span> <span class="o">=</span> <span class="p">[</span><span class="s">'{} nested inside {}'</span><span class="p">,</span> <span class="s">'from {} import {}'</span><span class="p">,</span> <span class="s">"implementing {} only to find it's in {}"</span><span class="p">]</span>
<span class="n">blackcards</span> <span class="o">=</span> <span class="p">[</span><span class="n">BlackCard</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span> <span class="k">for</span> <span class="n">fields</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">text</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'{}'</span><span class="p">),</span> <span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'{}'</span><span class="p">))</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">blacktexts</span><span class="p">]]</span>
<span class="n">whitecards</span> <span class="o">=</span> <span class="p">[</span><span class="n">WhiteCard</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'itertools'</span><span class="p">,</span> <span class="s">'a list comprehension'</span><span class="p">,</span> <span class="s">'a dict comprehension'</span><span class="p">,</span> 
                                           <span class="s">'a generator comprehension'</span><span class="p">,</span> <span class="s">'*'</span><span class="p">,</span> <span class="s">'functools'</span><span class="p">,</span> <span class="s">'the standard library'</span><span class="p">,</span> 
                                           <span class="s">'reduce'</span><span class="p">,</span> <span class="s">'map'</span><span class="p">,</span> <span class="s">'doubly linked list'</span><span class="p">,</span> <span class="s">'collections'</span><span class="p">]]</span>
</pre></div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>And to play them, we simply run the following.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<p class="prompt input_prompt">
In [2]:
</p>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>

<span class="n">shuffle</span><span class="p">(</span><span class="n">blackcards</span><span class="p">)</span>
<span class="n">shuffle</span><span class="p">(</span><span class="n">whitecards</span><span class="p">)</span>

<span class="n">card</span> <span class="o">=</span> <span class="n">blackcards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="n">card</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">whitecards</span><span class="p">[:</span><span class="n">card</span><span class="o">.</span><span class="n">pick</span><span class="p">]])</span>
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><p class="prompt output_prompt">
    Out[2]:</p>
<div class="box-flex1 output_subarea output_pyout">


<pre>
"implementing reduce only to find it's in *"
</pre>

</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="step-two-decks">Step Two: Decks</h2>
<p>The next step is to model the decks for black cards, white cards, the discard piles and players' hands. The biggest problem we'll have here is that while players' hands are essentially the same thing as a deck, they have a limited length. Of course we could manage the length by hand, or we could use deque.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<p class="prompt input_prompt">
In [3]:
</p>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="n">max_cards</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">players</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">hands</span> <span class="o">=</span> <span class="p">[</span><span class="n">deque</span><span class="p">([</span><span class="n">whitecards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_cards</span><span class="p">)],</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_cards</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">players</span><span class="p">)]</span>

<span class="n">blackdiscard</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">whitediscard</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="step-four-a-minimal-automated-play-through">Step Four: A Minimal Automated Play Through</h2>
<p>No player interaction here, just testing that pieces fit together as expected.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<p class="prompt input_prompt">
In [4]:
</p>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="n">max_cards</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">white_text</span> <span class="o">=</span> <span class="p">[</span><span class="s">'itertools'</span><span class="p">,</span> <span class="s">'functools'</span><span class="p">,</span> <span class="s">'fiboncci sequence'</span><span class="p">,</span> <span class="s">'WSGI'</span><span class="p">,</span> 
              <span class="s">'list comprehensions'</span><span class="p">,</span> <span class="s">'Javascript'</span><span class="p">,</span> <span class="s">'RESTful'</span><span class="p">,</span> <span class="s">'C++'</span><span class="p">,</span> <span class="s">'messy inheritance'</span><span class="p">,</span> 
              <span class="s">'an unclear variable name'</span><span class="p">,</span> <span class="s">"a class that's actually just a closure"</span><span class="p">,</span> 
              <span class="s">'overriding a built in'</span><span class="p">,</span> <span class="s">'Java style getters and setters'</span><span class="p">,</span> <span class="s">'Ruby'</span><span class="p">,</span> 
              <span class="s">'a blank except line'</span><span class="p">,</span> <span class="s">'dynamic imports'</span><span class="p">,</span> <span class="s">'braces'</span><span class="p">,</span> <span class="s">'__future__'</span><span class="p">,</span> <span class="s">'a lambda'</span><span class="p">,</span> 
              <span class="s">'beautiful and idiomatic'</span><span class="p">,</span> <span class="s">'Pythonic'</span><span class="p">,</span> <span class="s">'spam'</span><span class="p">,</span> <span class="s">'eggs'</span><span class="p">,</span> <span class="s">'wheels'</span><span class="p">,</span> <span class="s">'distribute'</span>
              <span class="p">]</span>

<span class="n">blacktexts</span> <span class="o">=</span> <span class="p">[</span><span class="s">'{} nested inside {}'</span><span class="p">,</span> <span class="s">'from {} import *'</span><span class="p">,</span> <span class="s">'from {} import {}'</span><span class="p">,</span> <span class="s">'Using Python with {}'</span><span class="p">,</span> 
              <span class="s">"Implementing {} to find it's in the standard library"</span><span class="p">,</span>  <span class="s">'Treating Python like {}'</span><span class="p">,</span>  <span class="s">'Python: The Old {}'</span><span class="p">,</span> 
              <span class="s">'The next feature Guido should implement is {}'</span><span class="p">,</span>  <span class="s">'{} in Python is like {}'</span><span class="p">]</span>

<span class="n">black_builder</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'{}'</span><span class="p">),</span> <span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'{}'</span><span class="p">))</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">blacktexts</span><span class="p">]</span>

<span class="n">whitecards</span> <span class="o">=</span> <span class="p">[</span><span class="n">WhiteCard</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">white_text</span><span class="p">]</span>
<span class="n">blackcards</span> <span class="o">=</span> <span class="p">[</span><span class="n">BlackCard</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span> <span class="k">for</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">black_builder</span><span class="p">]</span>

<span class="n">shuffle</span><span class="p">(</span><span class="n">whitecards</span><span class="p">)</span>
<span class="n">shuffle</span><span class="p">(</span><span class="n">blackcards</span><span class="p">)</span>

<span class="n">hands</span> <span class="o">=</span> <span class="p">[</span><span class="n">deque</span><span class="p">((</span><span class="n">whitecards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_cards</span><span class="p">)),</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_cards</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">players</span><span class="p">)]</span>

<span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="n">blackcards</span><span class="p">:</span>
    <span class="n">card</span> <span class="o">=</span> <span class="n">blackcards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">picked</span> <span class="o">=</span> <span class="p">[[</span><span class="n">hand</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">pick</span><span class="p">)]</span> <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">hands</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">whitecards</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hands</span><span class="p">)</span> <span class="o">*</span> <span class="n">card</span><span class="o">.</span><span class="n">draw</span><span class="p">:</span>
        <span class="n">whitecards</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">whitediscard</span><span class="p">)</span>
        <span class="n">whitediscard</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">hands</span><span class="p">:</span>
        <span class="n">hand</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">whitecards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">draw</span><span class="p">)])</span>
    
    <span class="n">played</span> <span class="o">=</span> <span class="p">[</span><span class="n">card</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pick</span><span class="p">])</span> <span class="k">for</span> <span class="n">pick</span> <span class="ow">in</span> <span class="n">picked</span><span class="p">]</span>
    <span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">choice</span><span class="p">(</span><span class="n">played</span><span class="p">))</span>
    
    <span class="n">blackdiscard</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
    <span class="n">whitediscard</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">picked</span><span class="p">))</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        
</pre></div>

</div>
</div>

<div class="vbox output_wrapper">
<div class="output vbox">


<div class="hbox output_area"><p class="prompt"/>
<div class="box-flex1 output_subarea output_stream output_stdout">
<pre>
Using Python with a blank except line
from itertools import a class that's actually just a closure
beautiful and idiomatic nested inside Ruby
Implementing C++ to find it's in the standard library
The next feature Guido should implement is messy inheritance
from C++ import *
Treating Python like wheels
WSGI in Python is like a class that's actually just a closure
Python: The Old beautiful and idiomatic

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Of course, if you wanted to continually run through the whole thing, you could set that up.</p>
</div>
<div class="cell border-box-sizing code_cell vbox">
<div class="input hbox">
<p class="prompt input_prompt">
In [5]:
</p>
<div class="input_area box-flex1">
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">whitecards</span> <span class="o">=</span> <span class="p">[</span><span class="n">WhiteCard</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">white_text</span><span class="p">]</span>
<span class="n">blackcards</span> <span class="o">=</span> <span class="p">[</span><span class="n">BlackCard</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span> <span class="k">for</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">black_builder</span><span class="p">]</span>

<span class="n">Hand</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">deque</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="n">max_cards</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">blackcards</span><span class="p">,</span> <span class="n">whitecards</span><span class="p">,</span> <span class="n">whitediscard</span><span class="p">,</span> <span class="n">blackdiscard</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">blackcards</span><span class="p">)</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">whitecards</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Dealing hands."</span><span class="p">)</span>
        <span class="n">hands</span> <span class="o">=</span> <span class="p">[</span><span class="n">Hand</span><span class="p">(</span><span class="n">whitecards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_cards</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">players</span><span class="p">]</span>
        <span class="n">card</span> <span class="o">=</span> <span class="n">blackcards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        
        <span class="n">picked</span> <span class="o">=</span> <span class="p">[[</span><span class="n">h</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">pick</span><span class="p">)]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hands</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">whitecards</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hands</span><span class="p">)</span> <span class="o">*</span> <span class="n">card</span><span class="o">.</span><span class="n">draw</span><span class="p">:</span>
            <span class="n">whitecards</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">whitediscard</span><span class="p">)</span>
            <span class="n">whitediscard</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">hands</span><span class="p">:</span>
            <span class="n">hand</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">whitecards</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">draw</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">pick</span> <span class="ow">in</span> <span class="n">picked</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pick</span><span class="p">]))</span>
            <span class="nb">input</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
        
        <span class="n">blackdiscard</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="n">whitediscard</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">picked</span><span class="p">))</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"Out of black cards. Restocking decks."</span><span class="p">)</span>
    <span class="n">blackcards</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">blackdiscard</span><span class="p">)</span>
    <span class="n">whitecards</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">whitediscard</span><span class="p">)</span>
    <span class="n">whitecards</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">hands</span><span class="p">))</span>
    <span class="n">blackdiscard</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">whitediscard</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>

</div>
</div>

</div>
<div class="text_cell_render border-box-sizing rendered_html">
<p>Is it ugly? Yeah -- code that's duplicated, globals, places where tools like map would be clean it up, and just generally a mess. But for a proof of concept -- building a basic CAH clone in Python -- it's alright. Though, I'll definitely be spending some time cleaning it up and improving it.</p>
</div>
<p/>
</div>
</div></body></html>