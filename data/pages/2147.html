<html><body><div><div class="entry-content" itemprop="text"><p><a title="Paramiko" href="http://www.paramiko.org/" target="_blank" rel="nofollow">Paramiko</a> is a Python implementation of SSH with a whole range of supported features. To start, let’s look at the most simple example – connecting to a remote SSH server and gathering the output of <em>ls /tmp/</em></p>
<pre class="brush: python; title: ; notranslate" title="">
import paramiko

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
try:
        ssh.connect('localhost', username='testuser', password='t3st@#test123')
except paramiko.SSHException:
        print "Connection Failed"
        quit()

stdin,stdout,stderr = ssh.exec_command("ls /etc/")

for line in stdout.readlines():
        print line.strip()
ssh.close()
</pre>
<p>After importing paramiko, we create a new variable ‘ssh’ to hold our SSHClient. <em>ssh.set_missing_host_key_policy</em> automatically adds our server’s host key without prompting. For security, this is not a good idea in production, and host keys should be added manually. Should a host key change unexpectedly, it could indicate that the connection has been compromised and is being diverted elsewhere.</p>
<p>Next, we create 3 variables, <em>stdin, stdout and stderr</em> allowing us to access the respective streams when calling <em>ls /etc/</em></p>
<p>Finally, for each “\n” terminated line on stdout, we print the line, stripping the trailing “\n” (as print adds one). Finally we close the SSH connection.</p>
<p>Let’s look at another example, where we communicate with stdin.<br/>
<span id="more-2432"/></p>
<p><em>cat</em> in its simplest form will print what it receives on stdin to stdout. This can be shown as follows:</p>
<pre class="brush: plain; title: ; notranslate" title="">
root@w:~# echo "test" | cat
test
</pre>
<p>Simply, we can use:</p>
<pre class="brush: python; title: ; notranslate" title="">
stdin,stdout,stderr = ssh.exec_command("cat")
stdin.write("test")
</pre>
<p>To allow us to communicate with stdin. Wait! Now, the program hangs indefinitely. cat is waiting for an EOF to be received. To do so, we must close the channel:</p>
<pre class="brush: python; title: ; notranslate" title="">
stdin.channel.shutdown_write()
</pre>
<p>Now, let’s extend the example to read a colon separated username and password from a file:</p>
<pre class="brush: python; title: ; notranslate" title="">
import paramiko
import sys

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

if len(sys.argv) != 2:
	print "Usage %s &lt;filename&gt;" % sys.argv[0]
	quit()

try:
	fd = open(sys.argv[1], "r")
except IOError:
	print "Couldn't open %s" % sys.argv[1]
	quit()

username,passwd = fd.readline().strip().split(":") #TODO: add error checking!

try:
	ssh.connect('localhost', username=username, password=passwd)
	stdin,stdout,stderr = ssh.exec_command("ls /tmp")
	for line in stdout.readlines():
		print line.strip()
	ssh.close()
except paramiko.AuthenticationException:
	print "Authentication Failed"
	quit()
except:
	print "Unknown error"
	quit()


</pre>
<p>Lastly, let’s look at reading a remote directory over SFTP:</p>
<pre class="brush: python; title: ; notranslate" title="">
import paramiko

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
try:
	ssh.connect('localhost', username='testuser', password='t3st@#test123')
except paramiko.SSHException:
	print "Connection Error"
sftp = ssh.open_sftp()
sftp.chdir("/tmp/")
print sftp.listdir()
ssh.close()
</pre>
<p>Paramiko supports <a href="http://paramiko-docs.readthedocs.org/en/latest/api/sftp.html" title="Paramiko SFTP" rel="nofollow">far more SFTP options</a>, including of course the upload and download of files.</p>
</div></div></body></html>