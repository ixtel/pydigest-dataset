<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-mudpy" class="anchor" href="#mudpy" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>MudPy</h1>

<p>introspection on crack</p>

<h2><a id="user-content-overview" class="anchor" href="#overview" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Overview</h2>

<p>One of the key aspects of programming is to write data onto the disk -- however, we do not wish to uselessly write data if it has not changed. Commonly, a <code>is_dirty</code> 
variable is employed as part of the data abstraction to mark when said data has been altered. Upon saving the data, a program can skip the disk-write portion of code if 
the <code>is_dirty</code> bit is not set.</p>

<h2><a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage</h2>

<p>Objects that inherit the <code>Mud</code> class will be able to reference a field <code>Mud.is_dirty</code> to query if the object has been changed since 
initialization.</p>

<p>Calling <code>Mud.save</code> will reset the <code>is_dirty</code> field to <code>False</code>.</p>

<p>An example usage case can be found in <code>BakedPie.py</code> (a ''cooked'' mud pie), but a barebones wrapper class is as follows:</p>

<pre><code>from mudpy.Mud import Mud

# we're taking the joke and beating it to the ground
# note that Mud comes last in the inheritance chain to preserve expected super(...) behavior
class RawPie(..., Mud):
    # class attribute
    cook_time = None
    def __init__(self, *args, **kwargs):
        # set some instance variables
        self.filling = None

        # will attempt to set 'filling' and 'is_cooked', but not 'chef'
        Mud.__init__(self, **kwargs)

    # read-write property
    @property
    def is_cooked(self):
        # ...
        return None

    @is_cooked.setter
    def is_cooked(self, v):
        # ...
        pass

    # read-only property
    @property
    def chef(self):
        # ...
        return None

    def save(self):
        if not self.is_dirty:
            return

        # save the pie as a recipe
        # ...

        # reset self.is_dirty
        Mud.save(self)
</code></pre>

<p><strong>NB</strong> Strictly speaking, <code>Pie.cook_time</code> is a class attribute and cannot be modified; <code>p.cook_time = ...</code> will simply create a new instance variable to override the 
class attribute, which is detected by <code>Mud.is_dirty</code>. See <a href="http://stackoverflow.com/questions/6475321/global-variable-python-classes">StackOverflow</a> for more 
information.</p>

<h2><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Features</h2>

<p>The <code>Mud</code> class will check for dirty fields as a result of @property setters, instance variables, <strong>as well as</strong> method changes.</p>

<p>Furthermore, <code>Mud</code> can be inherited by Django models (appending to the end of the list of inherited classes) and function as an (almost) drop-in conditional save 
guard, thus replacing the more conventional, but less flexible, <a href="https://github.com/smn/django-dirtyfields">django-dirtyfields</a> package:</p>

<pre><code>from django.db import models
from mudpy.Mud import Mud

class DjangoPie(models.Model, Mud):
    def __init__(self, *args, **kwargs):
        # all instance-related fields are handled by Django
        super(DjangoPie, self).__init__(*args, **kwargs)

        # for the side-effect of setting is_dirty and initializing the cache
        Mud.__init__(self)

    def save(self, *args, **kwargs):
        # self.id evaluates to False upon a new request (and so needs to be saved)
        if not self.is_dirty and self.id:
            return
        # ...
        Mud.save(self)
</code></pre>

<h2><a id="user-content-caveats" class="anchor" href="#caveats" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Caveats</h2>

<p>The <code>Mud</code> class employs reserved variables <code>__cache__</code> and <code>__is_dirty__</code> -- undefined behavior will result if the user attempts to alter these fields manually. 
<code>Mud.__getattribute__</code> and <code>Mud.__setattr__</code> employs guards to ensure these fields are not accessed via a call such as <code>instance.__is_dirty__</code>, but does <strong>not</strong> guard 
against direct dictionary manipulation (e.g. <code>instance.__dict__['__is_dirty__']</code>) of these two fields; indeed, direct dictionary manipulation of <strong>any</strong> instance 
variable is not recommended, as it bypasses the checking system in place:</p>

<pre><code>p = RawPie()

###
# Good
###

# this is okay
p.filling = 'apple'

assert p.is_dirty == True

# save changes and set is_dirty to False
p.save()

###
# Bad
###

# this is NOT recommended
p.__dict__['filling'] = 'cherry'

# previous op bypassed checking system
assert p.is_dirty == False

# does NOT save changes
p.save()
</code></pre>

<p>Moreover, as per <a href="https://docs.python.org/2/library/stdtypes.html#special-attributes">Python2</a> and 
<a href="https://docs.python.org/3/library/stdtypes.html#special-attributes">Python3</a> documentation, there are several read-only variables which cannot be set directly. <code>Mud</code> 
guards these variables specifically by throwing an <code>AttributeError</code> when user attempts to set these variables:</p>

<pre><code>p = RawPie()

# this is okay
p.__dict__

# throws an error because the user is a bad, bad person who doesn't deserve pies
try:
    p.__dict__ = 3.14
except AttributeError:
    pass

assert p.is_dirty == False
</code></pre>

<h2><a id="user-content-contact" class="anchor" href="#contact" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Contact</h2>


</article>
  </div></body></html>