<html><body><div><div class="pf-content"><p>One of my readers suggested that I should try logging my data to a web service called <a href="http://loggly.com/" target="_blank">Loggly</a>. As I understand it, Loggly is a way to share log data with everyone in a business so that you no longer need to log in to individual machines. They also provide graphs, filters and searches of the logs. They don’t have a Python API, but it’s still pretty easy to send data to Loggly via Pythons <strong>urllib2</strong> module and <strong>simplejson</strong>. Also note that you can use Loggly for  30-day trial period.</p>
<p><span id="more-4332"/></p>
<p>Let’s take a look at some code. This code is based on the code from my <a href="http://www.blog.pythonlibrary.org/2014/10/21/logging-currently-running-processes-with-python/" target="_blank">article</a> aboud logging currently running processes. You will need the following modules installed for this example to work:</p>

<p>I just used pip to install them both. Now that we have those, let’s see how to use them to connect to Loggly</p>
<pre class="python"><span>import</span> psutil
<span>import</span> simplejson
<span>import</span> <span>time</span>
<span>import</span> <span>urllib2</span>
 
<span>#----------------------------------------------------------------------</span>
<span>def</span> log<span>(</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
    <span>token</span> = <span>"YOUR-LOGGLY-TOKEN"</span>
    url = <span>"https://logs-01.loggly.com/inputs/%s/tag/python/"</span> <span>%</span> <span>token</span>
 
    <span>while</span> <span>True</span>:
        proc_dict = <span>{</span><span>}</span>
        procs = psutil.<span>get_process_list</span><span>(</span><span>)</span>
        procs = <span>sorted</span><span>(</span>procs, key=<span>lambda</span> proc: proc.<span>name</span><span>)</span>
        <span>for</span> proc <span>in</span> procs:
            cpu_percent = proc.<span>get_cpu_percent</span><span>(</span><span>)</span>
            mem_percent = proc.<span>get_memory_percent</span><span>(</span><span>)</span>
            <span>try</span>:
                name = proc.<span>name</span><span>(</span><span>)</span>
            <span>except</span>:
                <span># this is a process with no name, so skip it</span>
                <span>continue</span>
 
            data = <span>{</span><span>"cpu_percent"</span>: cpu_percent,
                    <span>"mem_percent"</span>: mem_percent,
                    <span>}</span>
            proc_dict<span>[</span>name<span>]</span> = data
 
        log_data = simplejson.<span>dumps</span><span>(</span>proc_dict<span>)</span>
        <span>urllib2</span>.<span>urlopen</span><span>(</span>url, log_data<span>)</span>
        <span>time</span>.<span>sleep</span><span>(</span><span>60</span><span>)</span>
 
<span>if</span> __name__ == <span>"__main__"</span>:
    log<span>(</span><span>)</span></pre>
<p>This is a pretty simple function, but let’s break it down anyway. First off we set out Loggly token and create a Loggly URL to send our data to. Then we create an infinite loop that will grab a list of currently running processes every 60 seconds. Next we extract out the bits that we want to log and then we put those pieces into a dictionary of dictionaries. Finally we use simplejson’s <strong>dumps</strong> method to turn our nested dictionary into a JSON formatted string and we pass that to our url. This send the log data to Loggly where it can get parsed.</p>
<p>Once you’ve sent enough data to Loggly for it to analyze, you can login to your account and see some bar charts that are created automatically based on your data. My data in this example didn’t translate very well into graphs or trends, so those ended up looking pretty boring. I would recommend sending a system log or something else that contains more variety in it to get a better understanding of how useful this service would be for you.</p>
<p><strong>UPDATE:</strong> The people at Loggly mentioned trying to send the data as floats instead of strings, so I edited the code above appropriately. Feel free to play around with the code and see what you come up with.</p>
<hr/>
<h3>Related Code</h3>
<p>
</p><ul>
<li>One of my readers came up with a modified version of my <a href="https://gist.github.com/driscollis/db11609833e408430d0d" target="_blank">example</a></li>
</ul>
</div>	</div></body></html>