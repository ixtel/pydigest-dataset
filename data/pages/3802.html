<html><body><div><section class="entry">
<p class="fsb-clear"/><p class="p1"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding_window_example.jpg"><img class="aligncenter wp-image-2155" src="http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding_window_example.jpg" alt="sliding_window_example" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding_window_example-300x246.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding_window_example.jpg 714w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p class="p1">So in <a href="http://www.pyimagesearch.com/2015/03/16/image-pyramids-with-python-and-opencv/" target="_blank">last week’s blog post</a> we discovered how to construct an image pyramid.</p>
<p class="p1">And in today’s article we are going to extend that example and introduce the concept of a <em><strong>sliding window</strong></em>. Sliding windows play an integral role in object classification, as they allow us to localize exactly <em>“where”</em> in an image an object resides.</p>
<p class="p1">Utilizing both a sliding window and an image pyramid we are able to detect objects in images at various scales and locations.</p>
<p class="p1">In fact, both sliding windows and image pyramids are both used in my <a title="Histogram of Oriented Gradients and Object Detection" href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">6-step HOG + Linear SVM</a> object classification framework!</p>
<p class="p1">To learn more about the role sliding windows play in object classification and image classification, read on. By the time you are done reading this blog post, you’ll have an excellent understanding on how image pyramids and sliding windows are used for classification.</p>

<p class="p1"><strong>OpenCV and Python versions:</strong><br/>
This example will run on<strong> Python 2.7/Python 3.4+</strong> and <strong>OpenCV 2.4.X/OpenCV 3.0+</strong>.</p>
<h1 class="p1">What is a sliding window?</h1>
<p class="p1">In the context of computer vision (and as the name suggests), a sliding window is rectangular region of fixed width and height that “slides” across an image, such as in the following figure:</p>
<div id="attachment_1423" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/10/sliding_window_example.gif"><img class="size-full wp-image-1423" src="http://www.pyimagesearch.com/wp-content/uploads/2014/10/sliding_window_example.gif" alt="Figure 2: Example of the sliding a window approach, where we slide a window from left-to-right and top-to-bottom."/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Example of the sliding a window approach, where we slide a window from left-to-right and top-to-bottom.</p></div>
<p class="p1">For each of these windows, we would normally take the window region and apply an <i>image classifier</i> to determine if the window has an object that interests us — in this case, a face.</p>
<p class="p1">Combined with <a href="http://www.pyimagesearch.com/2015/03/16/image-pyramids-with-python-and-opencv/" target="_blank">image pyramids</a> we can create image classifiers that can <strong>recognize objects at varying <i>scales</i> and <i>locations</i> in the image.</strong></p>
<p class="p1">These techniques, while simple, play an <i>absolutely critical</i> role in object detection and image classification.</p>
<h1 class="p1">Sliding Windows for Object Detection with Python and OpenCV</h1>
<p class="p1">Let’s go ahead and build on your image pyramid example from <a href="http://www.pyimagesearch.com/2015/03/16/image-pyramids-with-python-and-opencv/" target="_blank">last week</a>.</p>
<p class="p1">Remember the 
			<span id="crayon-56d590cb183b1516024398" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">helpers</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  file? Open it back up and insert the 
			<span id="crayon-56d590cb183c1798896828" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">sliding_window</span></span></span>  function:</p>
<p/>

		<div id="crayon-56d590cb183c5555052297" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183c5555052297-22"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">sliding_window</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stepSize</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">windowSize</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590cb183c5555052297-23"><span class="crayon-h">	</span><span class="crayon-c"># slide a window across the image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183c5555052297-24"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">y</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stepSize</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590cb183c5555052297-25"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stepSize</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183c5555052297-26"><span class="crayon-h">			</span><span class="crayon-c"># yield the current window</span></p><p class="crayon-line" id="crayon-56d590cb183c5555052297-27"><span class="crayon-h">			</span><span class="crayon-r">yield</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">[</span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">windowSize</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">windowSize</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p class="p1">The 
			<span id="crayon-56d590cb183ca697837343" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">sliding_window</span></span></span>  function requires three arguments. The first is the 
			<span id="crayon-56d590cb183ce223430745" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">image</span></span></span>  that we are going to loop over. The second argument is the 
			<span id="crayon-56d590cb183d1253116795" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">stepSize</span></span></span> .</p>
<p class="p1">The <span class="s1">stepSize</span> indicates how many pixels we are going to “skip” in both the <i>(x, y)</i> direction. Normally, we would <strong><em>not</em></strong> want to loop over each and every pixel of the image (i.e.  
			<span id="crayon-56d590cb183d5907402333" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">stepSize</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></span></span> ) as this would be computationally prohibitive if we were applying an image classifier at each window.</p>
<p class="p1">Instead, the 
			<span id="crayon-56d590cb183d8239813046" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">stepSize</span></span></span>  is determined on a <i>per-dataset</i> basis and is tuned to give optimal performance based on your dataset of images. In practice, it’s common to use a 
			<span id="crayon-56d590cb183db323258144" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">stepSize</span></span></span>  of 4 to 8 pixels. <strong><em>Remember, the smaller your step size is, the more windows you’ll need to examine.</em></strong></p>
<p class="p1">The last argument 
			<span id="crayon-56d590cb183df918662133" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">windowSize</span></span></span>  defines the width and height (in terms of pixels) of the window we are going to extract from our 
			<span id="crayon-56d590cb183e2518000817" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">image</span></span></span> .</p>
<p class="p1"><b>Lines 24-27</b> are fairly straightforward and handle the actual “sliding” of the window.</p>
<p class="p1"><b>Lines 24-26</b> define two 
			<span id="crayon-56d590cb183e6566296733" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-st">for</span></span></span>  loops that loop over the <i>(x, y)</i> coordinates of the image, incrementing their respective 
			<span id="crayon-56d590cb183e9833475422" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">x</span></span></span>  and 
			<span id="crayon-56d590cb183ec753450134" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">y</span></span></span>  counters by the provided step size.</p>
<p class="p1">Then, <b>Line 27</b> returns a tuple containing the 
			<span id="crayon-56d590cb183f0744401620" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">x</span></span></span>  and 
			<span id="crayon-56d590cb183f3510312397" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">y</span></span></span>  coordinates of the sliding window, along with the window itself.</p>
<p class="p1">To see the sliding window in action, we’ll have to write a driver script for it. Create a new file, name it 
			<span id="crayon-56d590cb183f7968357485" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">sliding_window</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and we’ll finish up this example:</p>
<p/>

		<div id="crayon-56d590cb183fa307195818" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590cb183fa307195818-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183fa307195818-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">pyimagesearch</span><span class="crayon-sy">.</span><span class="crayon-e">helpers </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">pyramid</span></p><p class="crayon-line" id="crayon-56d590cb183fa307195818-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">pyimagesearch</span><span class="crayon-sy">.</span><span class="crayon-e">helpers </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">sliding_window</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183fa307195818-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line" id="crayon-56d590cb183fa307195818-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183fa307195818-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line" id="crayon-56d590cb183fa307195818-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183fa307195818-8"><span class="crayon-c"># construct the argument parser and parse the arguments</span></p><p class="crayon-line" id="crayon-56d590cb183fa307195818-9"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183fa307195818-10"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-i"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"Path to the image"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590cb183fa307195818-11"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183fa307195818-12"> </p><p class="crayon-line" id="crayon-56d590cb183fa307195818-13"><span class="crayon-c"># load the image and define the window width and height</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb183fa307195818-14"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"image"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590cb183fa307195818-15"><span class="crayon-sy">(</span><span class="crayon-v">winW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">winH</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">128</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p class="p1">On <b>Lines 2-6</b> we import our necessary packages. We’ll use our 
			<span id="crayon-56d590cb183fe119023454" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pyramid</span></span></span>  function from <a href="http://www.pyimagesearch.com/2015/03/16/image-pyramids-with-python-and-opencv/" target="_blank">last week</a> to construct our image pyramid. We’ll also use the 
			<span id="crayon-56d590cb18402751830367" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">sliding_window</span></span></span>  function we just defined. Finally we import 
			<span id="crayon-56d590cb18405509659444" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">argparse</span></span></span>  for parsing command line arguments and 
			<span id="crayon-56d590cb18408917776758" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span></span></span>  for our OpenCV bindings.</p>
<p class="p1"><b>Lines 9-12</b> handle parsing our command line arguments. We only need a single switch here, the 
			<span id="crayon-56d590cb1840c037784636" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">image</span></span></span>  that we want to process.</p>
<p class="p1">From there, <b>Line 14</b> loads our image off disk and <b>Line 15</b> defines our window width and height to be 128 pixels, respectfully.</p>
<p class="p1">Now, let’s go ahead and combine our image pyramid and sliding window:</p>
<p/>

		<div id="crayon-56d590cb1840f417350895" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-18">18</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-20">20</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-22">22</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-24">24</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-26">26</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-28">28</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-30">30</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-32">32</p><p class="crayon-num" data-line="crayon-56d590cb1840f417350895-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d590cb1840f417350895-34">34</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590cb1840f417350895-17"><span class="crayon-c"># loop over the image pyramid</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-18"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">resized </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">pyramid</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scale</span><span class="crayon-o">=</span><span class="crayon-cn">1.5</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590cb1840f417350895-19"><span class="crayon-h">	</span><span class="crayon-c"># loop over the sliding window for each layer of the pyramid</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-20"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">sliding_window</span><span class="crayon-sy">(</span><span class="crayon-v">resized</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stepSize</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">windowSize</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">winW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">winH</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590cb1840f417350895-21"><span class="crayon-h">		</span><span class="crayon-c"># if the window does not meet our desired window size, ignore it</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-22"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-e">winH </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">winW</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d590cb1840f417350895-23"><span class="crayon-h">			</span><span class="crayon-st">continue</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-24"> </p><p class="crayon-line" id="crayon-56d590cb1840f417350895-25"><span class="crayon-h">		</span><span class="crayon-c"># THIS IS WHERE YOU WOULD PROCESS YOUR WINDOW, SUCH AS APPLYING A</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-26"><span class="crayon-h">		</span><span class="crayon-c"># MACHINE LEARNING CLASSIFIER TO CLASSIFY THE CONTENTS OF THE</span></p><p class="crayon-line" id="crayon-56d590cb1840f417350895-27"><span class="crayon-h">		</span><span class="crayon-c"># WINDOW</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-28"> </p><p class="crayon-line" id="crayon-56d590cb1840f417350895-29"><span class="crayon-h">		</span><span class="crayon-c"># since we do not have a classifier, we'll just draw the window</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-30"><span class="crayon-h">		</span><span class="crayon-v">clone</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">resized</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590cb1840f417350895-31"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">rectangle</span><span class="crayon-sy">(</span><span class="crayon-v">clone</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">winW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">winH</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-32"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Window"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clone</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d590cb1840f417350895-33"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d590cb1840f417350895-34"><span class="crayon-h">		</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">0.025</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p class="p1">We start by looping over each layer of the image pyramid on <b>Line 18</b>.</p>
<p class="p1">For each layer of the image pyramid, we’ll also loop over each window in the 
			<span id="crayon-56d590cb18414666497326" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">sliding_window</span></span></span>  on <b>Line 20</b>. We also make a check on <strong>Lines 22-23</strong> to ensure that our sliding window has met the minimum size requirements.</p>
<p class="p1">If we were applying an image classifier to detect objects, we would do this on <b>Lines 25-27</b> by extracting features from the window and passing them on to our classifier (which is done in our <a title="Histogram of Oriented Gradients and Object Detection" href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">6-step HOG + Linear SVM object detection framework</a>).</p>
<p class="p1">But since we do not have an image classifier, we’ll just visualize the sliding window results instead by drawing a rectangle on the image indicating where the sliding window is on <b>Lines 30-34</b>.</p>
<h1 class="p1">Results</h1>
<p class="p1">To see our image pyramid and sliding window in action, open up a terminal and execute the following command:</p>
<p/>

		<div id="crayon-56d590cb18418775874492" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590cb18418775874492-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">sliding_window</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">image </span><span class="crayon-v">images</span><span class="crayon-o">/</span><span class="crayon-v">adrian_florida</span><span class="crayon-e">.jpg</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p class="p1">If all goes well you should see the following results:</p>
<div id="attachment_2156" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding-window-animated-adrian.gif"><img class="size-full wp-image-2156" src="http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding-window-animated-adrian.gif" alt="Figure 2: An example of applying a sliding window to each layer of the image pyramid."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> An example of applying a sliding window to each layer of the image pyramid.</p></div>
<p class="p1">Here you can see that for each of the layers in the pyramid a window is “slid” across it. And again, if we had an image classifier ready to go, we could take each of these windows and classify the contents of the window. <strong>An example could be <em>“does this window contain a face or not?”</em></strong></p>
<p class="p1">Here’s another example with a different image:</p>
<p/>

		<div id="crayon-56d590cb1841c015452822" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d590cb1841c015452822-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">sliding_window</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">image </span><span class="crayon-v">images</span><span class="crayon-o">/</span><span class="crayon-v">stick_of_truth</span><span class="crayon-e">.jpg</span><span class="crayon-e">.jpg</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/><div id="attachment_2157" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding-window-animated-sot.gif"><img class="size-full wp-image-2157" src="http://www.pyimagesearch.com/wp-content/uploads/2015/03/sliding-window-animated-sot.gif" alt="Figure 3: A second example of applying a sliding window to each layer of the image pyramid."/></a><p class="wp-caption-text"><strong>Figure 3:</strong> A second example of applying a sliding window to each layer of the image pyramid.</p></div>
<p class="p1">Once again, we can see that the sliding window is slid across the image at each level of the pyramid. High levels of the pyramid (and thus smaller layers) have less windows that need to be examined.</p>
<h1 class="p1">Summary</h1>
<p class="p1">In this blog post we learned all about sliding windows and their application to object detection and image classification.</p>
<p class="p1">By combining a sliding window with an image pyramid we are able to localize and detect objects in images at multiple <b><i>scales</i></b> and <b><i>locations</i></b>.</p>
<p class="p1">While both sliding windows and image pyramids are very simple techniques, they are absolutely critical in object detection.</p>
<p class="p1">You can learn more about the more global role they play in this <a title="Histogram of Oriented Gradients and Object Detection" href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">blog post</a>, where I detail my framework on how to use the Histogram of Oriented Gradients image descriptor and a Linear SVM classifier to build a custom object detector.</p>
<h1 id="post_downloads">Downloads:</h1>

	</section>
	</div></body></html>