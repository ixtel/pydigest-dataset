<html><body><div><div class="entry-content">
                
                    <p>Out for a walk one day, a woman came across a construction site and saw three men working.
She asked the first man, “What are you doing?”
Annoyed by the question, the first man barked, “Can’t you see that I’m laying bricks?” Not satisfied with the answer, she asked the second man what he was doing.
The second man answered, “I’m building a brick wall.” Then, turning his attention to the first man, he said, “Hey, you just passed the end of the wall. You need to take off that last brick.” Again not satisfied with the answer, she asked the third man what he was doing. And the man said to her while looking up in the sky, “I am building the biggest cathedral this world has ever known.” While he was standing there and looking up in the sky the other two men started arguing about the errant brick. The man turned to the first two men and said, “Hey guys, don’t worry about that brick. It’s an inside wall, it will get plastered over and no one will ever see that brick. Just move on to another layer.”<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></p>
<p>The moral of the story is that when you know the whole system and understand how different pieces fit together (bricks, walls, cathedral), you can identify and fix problems faster (errant brick).</p>
<p>What does it have to do with creating your own Web server from scratch?</p>
<p><strong>I believe to become a better developer you <span class="caps">MUST</span> get a better understanding of the underlying software systems you use on a daily basis and that includes programming languages, compilers and interpreters, databases and operating systems, web servers and web frameworks. And, to get a better and deeper understanding of those systems you <span class="caps">MUST</span> re-build them from scratch, brick by brick, wall by wall.</strong></p>
<p>Confucius put it this way:</p>
<blockquote>
<p><em><span class="dquo">“</span>I hear and I forget.”</em></p>
</blockquote>
<p><img alt="Hear" src="https://ruslanspivak.com/lsbasi-part4/LSBAWS_confucius_hear.png"/></p>
<blockquote>
<p><em><span class="dquo">“</span>I see and I remember.”</em></p>
</blockquote>
<p><img alt="See" src="https://ruslanspivak.com/lsbasi-part4/LSBAWS_confucius_see.png"/></p>
<blockquote>
<p><em><span class="dquo">“</span>I do and I understand.”</em></p>
</blockquote>
<p><img alt="Do" src="https://ruslanspivak.com/lsbasi-part4/LSBAWS_confucius_do.png"/></p>
<p>I hope at this point you’re convinced that it’s a good idea to start re-building different software systems to learn how they work.</p>
<p>In this three-part series I will show you how to build your own basic Web server. Let’s get started.</p>
<p>First things first, what is a Web server?</p>
<p><img alt="HTTP Request/Response" src="https://ruslanspivak.com/lsbaws-part1/LSBAWS_HTTP_request_response.png"/></p>
<p>In a nutshell it’s a networking server that sits on a physical server (oops, a server on a server) and waits for a client to send a request. When it receives a request, it generates a response and sends it back to the client. The communication between a client and a server happens using <span class="caps">HTTP</span> protocol. A client can be your browser or any other software that speaks <span class="caps">HTTP</span>.</p>
<p>What would a very simple implementation of a Web server look like?
Here is my take on it. The example is in Python but even if you don’t know Python (it’s a very easy language to pick up, try it!) you still should be able to understand concepts from the code and explanations below:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span> <span class="o">=</span> <span class="s">''</span><span class="p">,</span> <span class="mi">8888</span>

<span class="n">listen_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">listen_socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">listen_socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
<span class="n">listen_socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="s">'Serving HTTP on port </span><span class="si">%s</span><span class="s"> ...'</span> <span class="o">%</span> <span class="n">PORT</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">client_connection</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="n">listen_socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">client_connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">request</span>

    <span class="n">http_response</span> <span class="o">=</span> <span class="s">"""</span><span class="se">\</span>
<span class="s">HTTP/1.1 200 OK</span>

<span class="s">Hello, World!</span>
<span class="s">"""</span>
    <span class="n">client_connection</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">http_response</span><span class="p">)</span>
    <span class="n">client_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<p>Save the above code as <em>webserver1.py</em> or download it directly from <a href="https://github.com/rspivak/lsbaws/blob/master/part1/webserver1.py" title="GitHub">GitHub</a> and run it on the command line like this</p>
<div class="highlight"><pre><span class="nv">$ </span>python webserver1.py
Serving HTTP on port <span class="m">8888</span> …
</pre></div>


<p>Now type in the following <span class="caps">URL</span> in your Web browser’s address bar <a href="http://localhost:8888/hello" title="Hello">http://localhost:8888/hello</a>, hit Enter, and see magic in action. You should see <em>“Hello, World!”</em> displayed in your  browser like this:</p>
<p><img alt="Browser &quot;Hello, World!&quot;" src="https://ruslanspivak.com/lsbaws-part1/browser_hello_world.png"/></p>
<p>Just do it, seriously. I will wait for you while you’re testing it.</p>
<p>Done? Great. Now let’s discuss how it all actually works.</p>
<p>First let’s start with the Web address you’ve entered. It’s called an <a href="http://en.wikipedia.org/wiki/Uniform_resource_locator"><span class="caps">URL</span></a> and here is its basic structure:</p>
<p><img alt="URL Structure" src="https://ruslanspivak.com/lsbaws-part1/LSBAWS_URL_Web_address.png"/></p>
<p>This is how you tell your browser the address of the Web server it needs to find and connect to and the page (path) on the server to fetch for you.
Before your browser can send a <span class="caps">HTTP</span> request though, it first needs to establish a <span class="caps">TCP</span> connection with the Web server. Then it sends an <span class="caps">HTTP</span> request over the <span class="caps">TCP</span> connection to the server and waits for the server to send an <span class="caps">HTTP</span> response back. And when your browser receives the response it displays it, in this case it displays “Hello, World!”</p>
<p>Let’s explore in more detail how the client and the server establish a <span class="caps">TCP</span> connection before sending <span class="caps">HTTP</span> requests and responses. To do that they both use so-called <em>sockets</em>. Instead of using a browser directly you are going to simulate your browser manually by using <em>telnet</em> on the command line.</p>
<p>On the same computer you’re running the Web server fire up a telnet session on the command line specifying a host to connect to <em>localhost</em> and the port to connect to <em>8888</em> and then press Enter:</p>
<div class="highlight"><pre><span class="nv">$ </span>telnet localhost 8888
Trying 127.0.0.1 …
Connected to localhost.
</pre></div>


<p>At this point you’ve established a <span class="caps">TCP</span> connection with the server running on your local host and ready to send and receive <span class="caps">HTTP</span> messages. In the picture below you can see a standard procedure a server has to go through to be able to accept new <span class="caps">TCP</span> connections.
<img alt="Socket accept" src="https://ruslanspivak.com/lsbaws-part1/LSBAWS_socket.png"/></p>
<p>In the same telnet session type <strong><em><span class="caps">GET</span> /hello <span class="caps">HTTP</span>/1.1</em></strong> and hit Enter:</p>
<div class="highlight"><pre><span class="nv">$ </span>telnet localhost 8888
Trying 127.0.0.1 …
Connected to localhost.
GET /hello HTTP/1.1

HTTP/1.1 <span class="m">200</span> OK
Hello, World!
</pre></div>


<p>You’ve just manually simulated your browser! You sent an <span class="caps">HTTP</span> request and got an <span class="caps">HTTP</span> response back. This is the basic structure of an <span class="caps">HTTP</span> request:</p>
<p><img alt="HTTP Request Aanatomy" src="https://ruslanspivak.com/lsbaws-part1/LSBAWS_HTTP_request_anatomy.png"/></p>
<p>The <span class="caps">HTTP</span> request consists of the line indicating the <span class="caps">HTTP</span> method (<strong><em><span class="caps">GET</span></em></strong>, because we are asking our server to return us something), the path <em>/hello</em> that indicates a <em>“page”</em> on the server we want and the protocol version.</p>
<p>For simplicity’s sake our Web server at this point completely ignores the above request line. You could just as well type in any garbage instead of <em>“<span class="caps">GET</span> /hello <span class="caps">HTTP</span>/1.1”</em> and you would still get back a <em>“Hello, World!”</em> response.</p>
<p>Once you’ve typed the request line and hit Enter the client sends the request to the server, the server reads the request line, prints it and returns the proper <span class="caps">HTTP</span> response.</p>
<p>Here is the <span class="caps">HTTP</span> response that the server sends back to your client (<em>telnet</em> in this case):
<img alt="HTTP Response Anatomy" src="https://ruslanspivak.com/lsbaws-part1/LSBAWS_HTTP_response_anatomy.png"/></p>
<p>Let’s dissect it. The response consists of a status line <em><span class="caps">HTTP</span>/1.1 200 <span class="caps">OK</span></em>, followed by a required empty line, and then the <span class="caps">HTTP</span> response body.</p>
<p>The response status line <em><span class="caps">HTTP</span>/1.1 200 <span class="caps">OK</span></em> consists of the <em><span class="caps">HTTP</span> Version</em>, the <em><span class="caps">HTTP</span> status code</em> and the <em><span class="caps">HTTP</span> status code reason</em> phrase <em><span class="caps">OK</span></em>. When the browser gets the response, it displays the body of the response and that’s why you see <em>“Hello, World!”</em> in your browser.</p>
<p>And that’s the basic model of how a Web server works. To sum it up: The Web server creates a listening socket and starts accepting new connections in a loop. The client initiates a <span class="caps">TCP</span> connection and, after successfully establishing it, the client sends an <span class="caps">HTTP</span> request to the server and the server responds with an <span class="caps">HTTP</span> response that gets displayed to the user. To establish a <span class="caps">TCP</span> connection both clients and servers use <em>sockets</em>.</p>
<p>Now you have a very basic working Web server that you can test with your browser or some other <span class="caps">HTTP</span> client. As you’ve seen and hopefully tried, you can also be a human <span class="caps">HTTP</span> client too, by using <em>telnet</em> and typing <span class="caps">HTTP</span> requests manually.</p>
<p>Here’s a question for you: “How do you run a Django application, Flask application, and Pyramid application under your freshly minted Web server without making a single change to the server to accommodate all those different Web frameworks?”</p>
<p>I will show you exactly how in Part 2 of the series. Stay tuned.</p>
<p><span class="caps">BTW</span>, I’m writing a book <strong><em>“Let’s Build A Web Server: First Steps”</em></strong> that explains how to write a basic web server from scratch and goes into more detail on topics I just covered. Subscribe to the mailing list to get the latest updates about the book and the release date.</p>
<p>


</p>



<p><br/>
<strong>All articles in this series:</strong></p>


            </div>
            
    </div></body></html>