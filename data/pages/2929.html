<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-smart_open----utils-for-streaming-large-files" class="anchor" href="#smart_open----utils-for-streaming-large-files" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>smart_open -- utils for streaming large files</h1>
<p><a href="https://travis-ci.org/piskvorky/smart_open"><img alt="Travis" src="https://camo.githubusercontent.com/24c10dc98f8a2043cd55f5ccd71a18788bc51aee/68747470733a2f2f696d672e736869656c64732e696f2f7472617669732f7069736b766f726b792f736d6172745f6f70656e2f6d61737465722e737667" data-canonical-src="https://img.shields.io/travis/piskvorky/smart_open/master.svg"/>
</a>
<a href="https://pypi.python.org/pypi/smart_open"><img alt="Downloads" src="https://camo.githubusercontent.com/4297a0c6ad2b6d7f8e795673f0757ba6dcbab14c/68747470733a2f2f696d672e736869656c64732e696f2f707970692f646d2f736d6172745f6f70656e2e737667" data-canonical-src="https://img.shields.io/pypi/dm/smart_open.svg"/>
</a>
<a href="https://github.com/piskvorky/smart_open/blob/master/LICENSE"><img alt="License" src="https://camo.githubusercontent.com/f813e2bcf542785e7abf7363693aebd998839842/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f736d6172745f6f70656e2e737667" data-canonical-src="https://img.shields.io/pypi/l/smart_open.svg"/>
</a></p>
<a name="user-content-what"/>
<h2><a id="user-content-what" class="anchor" href="#what" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>What?</h2>
<p><code>smart_open</code> is a Python 2 &amp; Python 3 library for <strong>efficient streaming of very large files</strong> from/to S3, HDFS, WebHDFS or local (compressed) files.
It is well tested (using <a href="https://github.com/spulec/moto">moto</a>), well documented and sports a simple, Pythonic API:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># stream lines from an S3 object</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">for</span> line <span class="pl-k">in</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>s3://mybucket/mykey.txt<span class="pl-pds">'</span></span>):
<span class="pl-c1">...</span>    <span class="pl-c1">print</span> line

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># you can also use a boto.s3.key.Key instance directly:</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> key <span class="pl-k">=</span> boto.connect_s3().get_bucket(<span class="pl-s"><span class="pl-pds">"</span>my_bucket<span class="pl-pds">"</span></span>).get_key(<span class="pl-s"><span class="pl-pds">"</span>my_key<span class="pl-pds">"</span></span>)
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">with</span> smart_open.smart_open(key) <span class="pl-k">as</span> fin:
<span class="pl-c1">...</span>     <span class="pl-k">for</span> line <span class="pl-k">in</span> fin:
<span class="pl-c1">...</span>         <span class="pl-c1">print</span> line

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># can use context managers too:</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">with</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>s3://mybucket/mykey.txt<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> fin:
<span class="pl-c1">...</span>     <span class="pl-k">for</span> line <span class="pl-k">in</span> fin:
<span class="pl-c1">...</span>         <span class="pl-c1">print</span> line
<span class="pl-c1">...</span>     fin.seek(<span class="pl-c1">0</span>)  <span class="pl-c"># seek to the beginning</span>
<span class="pl-c1">...</span>     <span class="pl-c1">print</span> fin.read(<span class="pl-c1">1000</span>)  <span class="pl-c"># read 1000 bytes</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># stream from HDFS</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">for</span> line <span class="pl-k">in</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>hdfs://user/hadoop/my_file.txt<span class="pl-pds">'</span></span>):
<span class="pl-c1">...</span>     <span class="pl-c1">print</span> line

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># stream from WebHDFS</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">for</span> line <span class="pl-k">in</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>webhdfs://host:port/user/hadoop/my_file.txt<span class="pl-pds">'</span></span>):
<span class="pl-c1">...</span>     <span class="pl-c1">print</span> line

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># stream content *into* S3 (write mode):</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">with</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>s3://mybucket/mykey.txt<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>wb<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> fout:
<span class="pl-c1">...</span>     <span class="pl-k">for</span> line <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">'</span>first line<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>second line<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>third line<span class="pl-pds">'</span></span>]:
<span class="pl-c1">...</span>          fout.write(line <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span><span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># stream content *into* WebHDFS (write mode):</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">with</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>webhdfs://host:port/user/hadoop/my_file.txt<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>wb<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> fout:
<span class="pl-c1">...</span>     <span class="pl-k">for</span> line <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">'</span>first line<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>second line<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>third line<span class="pl-pds">'</span></span>]:
<span class="pl-c1">...</span>          fout.write(line <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span><span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># stream from/to local compressed files:</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">for</span> line <span class="pl-k">in</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>./foo.txt.gz<span class="pl-pds">'</span></span>):
<span class="pl-c1">...</span>    <span class="pl-c1">print</span> line

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">with</span> smart_open.smart_open(<span class="pl-s"><span class="pl-pds">'</span>/home/radim/foo.txt.bz2<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>wb<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> fout:
<span class="pl-c1">...</span>    fout.write(<span class="pl-s"><span class="pl-pds">"</span>some content<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>)</pre></div>
<p>Since going over all (or select) keys in an S3 bucket is a very common operation,
there's also an extra method <code>smart_open.s3_iter_bucket()</code> that does this efficiently,
<strong>processing the bucket keys in parallel</strong> (using multiprocessing):</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c"># get all JSON files under "mybucket/foo/"</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> bucket <span class="pl-k">=</span> boto.connect_s3().get_bucket(<span class="pl-s"><span class="pl-pds">'</span>mybucket<span class="pl-pds">'</span></span>)
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">for</span> key, content <span class="pl-k">in</span> s3_iter_bucket(bucket, <span class="pl-v">prefix</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>foo/<span class="pl-pds">'</span></span>, <span class="pl-v">accept_key</span><span class="pl-k">=</span><span class="pl-k">lambda</span> <span class="pl-smi">key</span>: key.endswith(<span class="pl-s"><span class="pl-pds">'</span>.json<span class="pl-pds">'</span></span>)):
<span class="pl-c1">...</span>     <span class="pl-c1">print</span> key, <span class="pl-c1">len</span>(content)</pre></div>
<p>For more info (S3 credentials in URI, minimum S3 part size...) and full method signatures, check out the API docs:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">import</span> smart_open
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c1">help</span>(smart_open.smart_open_lib)</pre></div>
<a name="user-content-why"/>
<h3><a id="user-content-why" class="anchor" href="#why" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Why?</h3>
<p>Working with large S3 files using Amazon's default Python library, <a href="http://docs.pythonboto.org/en/latest/">boto</a>, is a pain. Its <code>key.set_contents_from_string()</code> and <code>key.get_contents_as_string()</code> methods only work for small files (loaded in RAM, no streaming).
There are nasty hidden gotchas when using <code>boto</code>'s multipart upload functionality, and a lot of boilerplate.</p>
<p><code>smart_open</code> shields you from that. It builds on boto but offers a cleaner API. The result is less code for you to write and fewer bugs to make.</p>
<a name="user-content-installation"/>
<h3><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h3>
<p>The module has no dependencies beyond Python &gt;= 2.6 (or Python &gt;= 3.3) and <code>boto</code>:</p>
<pre>pip install smart_open
</pre>
<p>Or, if you prefer to install from the <a href="http://pypi.python.org/pypi/smart_open">source tar.gz</a>:</p>
<pre>python setup.py test  # run unit tests
python setup.py install
</pre>
<p>To run the unit tests (optional), you'll also need to install <a href="https://pypi.python.org/pypi/mock">mock</a> , <a href="https://github.com/spulec/moto">moto</a> and responses &lt;<a href="https://github.com/getsentry/responses">https://github.com/getsentry/responses</a>&gt; (<code>pip install mock moto responses</code>). The tests are also run automatically with <a href="https://travis-ci.org/piskvorky/smart_open">Travis CI</a> on every commit push &amp; pull request.</p>
<a name="user-content-todo"/>
<h3><a id="user-content-todo" class="anchor" href="#todo" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Todo</h3>
<p><code>smart_open</code> is an ongoing effort. Suggestions, pull request and improvements welcome!</p>
<p>On the roadmap:</p>
<ul>
<li>better documentation for the default <code>file://</code> scheme</li>
</ul>
<a name="user-content-comments-bug-reports"/>
<h3><a id="user-content-comments-bug-reports" class="anchor" href="#comments-bug-reports" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Comments, bug reports</h3>
<p><code>smart_open</code> lives on <a href="https://github.com/piskvorky/smart_open">github</a>. You can file
issues or pull requests there.</p>
<hr/>
<p><code>smart_open</code> is open source software released under the <a href="https://github.com/piskvorky/smart_open/blob/master/LICENSE">MIT license</a>.
Copyright (c) 2015-now <a href="http://radimrehurek.com">Radim Řehůřek</a>.</p>

</article>
  </div></body></html>