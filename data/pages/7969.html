<html><body><div><div class="page_content type_page">


<p>Для всех объектов в программе Python <strong>ведется подсчет ссылок</strong>. Счетчик ссылок на объект увеличивается всякий раз, когда ссылка на объект записывается в новую переменную или когда объект помещается в контейнер, такой как список, кортеж или словарь, как показано ниже:</p>

<pre class="sh_php"><code class="python">a = 37 # Создается объект со значением 37
b = a  # Увеличивается счетчик ссылок на объект 37
c = []
c.append(b) # Увеличивается счетчик ссылок на объект 37</code></pre>
<p>В этом примере создается единственный объект, содержащий значение 37. <strong>Переменная a</strong>, это всего лишь имя, ссылающееся <strong>переменной b</strong>, вслед чего b становится еще одним именем того же самого объекта, при этом счетчик ссылок на объект увеличивается на 1. Точно так же, когда <strong>переменная b</strong> помещается в список, счетчик ссылок увеличивается на единицу.</p>
<p>На протяжении всего примера существует только один объект, содержащий значение 37. Все остальные операции просто приводят к созданию новых ссылок на него.</p>
<a id="cut"/>
<p>Счетчик ссылок уменьшается, когда <strong>вызывается инструкция del</strong> или когда поток выполнения покидает область видимости ссылки(или при присваивании другого значения). Например:</p>

<pre class="sh_php"><code class="python">del a   # Уменьшает счетчик ссылок на объект 37
b = 42  # Уменьшает счетчик ссылок на объект 37
с[0] = 2.0 # Уменьшает счетчик ссылок на объект 37</code></pre>
<p>Определить текущее количество ссылок на объект можно с помощью функции <strong>sys.getrefcount()</strong>. Например, создаем переменную <a href="http://md-eksperiment.org/etv_pages.php?album_id=300&amp;category=Features" title="Иван Франко" target="_blank">Иван Франко</a> которая будет ссылаться на строку "критика на творчество Франко".</p>

<pre class="sh_php"><code class="python">&gt;&gt;&gt; a = 37
&gt;&gt;&gt; import sys
&gt;&gt;&gt; IvanFranko = "критика на творчество Франко"
&gt;&gt;&gt; length = len(IvanFranko) # длина строки
&gt;&gt;&gt; sys.getrefcount(IvanFranko)
2
&gt;&gt;&gt; sys.getrefcount(length)
9
&gt;&gt;&gt; length
28
</code></pre>
<p>Собственно, на Ubuntu все выглядит следующим образом:</p>


<p>Во многих случаях количество ссылок оказывается намного больше, чем можно было бы предположить. Для неизменяемых типах данных, таких как числа и строки, интерпретатор весьма активно стремится использовать в разных частях программы один и тот-же объект, чтобы уменьшить объем потребляемой памяти.</p>
<p>Когда счетчик ссылок на объект достигает нуля, он <strong>уничтожается сборщиком мусора</strong>. Однако в некоторых случаях могут возникать циклические зависимости между коллекциями объектов, которые больше не используются. Например:</p>

<pre class="sh_php"><code class="python">a = {}
b = {}
a['b'] = b # a содержит ссылку на b
b['a'] = a # b содержит ссылку на a
del a
del b
</code></pre>
<p>В этом примере <strong>инструкция del</strong> уменьшает счетчики ссылок на <strong>объекты a и b</strong> и уничтожает имена, ссылавшиеся на объекты в памяти. Однако поскольку объекты содержат ссылки друг на друга, счетчики ссылок не достигают нуля и объекты продолжают существовать(что приводит к утечке памяти).</p>
<p>Чтобы исправить эту проблему, интерпретатор периодически выполняет проверку наличия циклических зависимостей, отыскивает такие недоступные объекты и удаляет их. Механизм поиска циклических зависимостей запускается периодически, как только интерпретатор обнаруживает, что в процессе выполнения программы объем занимаемой памяти начинает расти. Точное поведение механизма может корректироваться  и управляться с помощью функции из <strong>модуля gc</strong>.</p>


<p class="break"/></div>
</div></body></html>