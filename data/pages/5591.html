<html><body><div><div id="usage">
<h2>Usage</h2>
<pre><span class="kn">from</span> <span class="nn">pyejabberd</span> <span class="kn">import</span> <span class="n">EjabberdAPIClient</span>

<span class="c1"># Create a client and authenticate with elevated user 'bob@example.com'</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">EjabberdAPIClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5222</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">'bob'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">'p@$$wd'</span><span class="p">,</span> <span class="n">user_domain</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span>
                           <span class="n">protocol</span><span class="o">=</span><span class="s1">'https'</span><span class="p">)</span>

<span class="c1"># Test the connection by sending an echo request to the server</span>
<span class="n">sentence</span> <span class="o">=</span> <span class="s1">'some random data'</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">sentence</span>

<span class="c1"># Get a list of users that are on the server</span>
<span class="n">registered_users</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">registered_users</span><span class="p">(</span><span class="s1">'example.com'</span><span class="p">)</span>
<span class="c1"># result is in the format [{'username': 'bob', ...}]</span>

<span class="c1"># Register a new user</span>
<span class="n">client</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">'alice'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">'@l1cepwd'</span><span class="p">)</span>

<span class="c1"># Change a password</span>
<span class="n">client</span><span class="o">.</span><span class="n">change_password</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">'alice'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">newpass</span><span class="o">=</span><span class="s1">'newpwd'</span><span class="p">)</span>

<span class="c1"># Verify password</span>
<span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">check_password_hash</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">'bob'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">'newpwd'</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span>

<span class="c1"># Set nickname</span>
<span class="n">client</span><span class="o">.</span><span class="n">set_nickname</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">'bob'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">nickname</span><span class="o">=</span><span class="s1">'Bob the builder'</span><span class="p">)</span>

<span class="c1"># Get Bob's contacts</span>
<span class="n">client</span><span class="o">.</span><span class="n">get_roster</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">'bob'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">)</span>

<span class="c1"># Add Alice to Bob's contact group Friends</span>
<span class="n">client</span><span class="o">.</span><span class="n">add_rosteritem</span><span class="p">(</span><span class="n">localuser</span><span class="o">=</span><span class="s1">'bob'</span><span class="p">,</span> <span class="n">localserver</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">'alice'</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">nick</span><span class="o">=</span><span class="s1">'Alice from Wonderland'</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">'Friends'</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="s1">'both'</span><span class="p">)</span>

<span class="c1"># Delete Alice from Bob's contacts</span>
<span class="n">client</span><span class="o">.</span><span class="n">delete_rosteritem</span><span class="p">(</span><span class="n">localuser</span><span class="o">=</span><span class="s1">'bob'</span><span class="p">,</span> <span class="n">localserver</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">'alice'</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">)</span>

<span class="c1"># Get list of *all* connected users</span>
<span class="n">client</span><span class="o">.</span><span class="n">connected_users</span><span class="p">()</span>

<span class="c1"># Get list of *all* connected users and information about their sessions</span>
<span class="n">client</span><span class="o">.</span><span class="n">connected_users_info</span><span class="p">()</span>

<span class="c1"># Get number of connected users</span>
<span class="n">client</span><span class="o">.</span><span class="n">connected_users_number</span><span class="p">()</span>

<span class="c1"># Get information for all sessions for a user</span>
<span class="n">client</span><span class="o">.</span><span class="n">user_sessions_info</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">"jim"</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"example.com"</span><span class="p">):</span>

<span class="c1"># Get muc rooms</span>
<span class="n">muc_online_rooms</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">muc_online_rooms</span><span class="p">()</span>
<span class="c1"># result is in the format ['room1@conference', ...] where 'conference' is the muc service name</span>

<span class="c1"># Create a muc room</span>
<span class="n">client</span><span class="o">.</span><span class="n">create_room</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'room1'</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s1">'conference'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">)</span>

<span class="c1"># Get room options</span>
<span class="n">room_options</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_room_options</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'room1'</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s1">'conference'</span><span class="p">)</span>

<span class="c1"># Set room option</span>
<span class="kn">from</span> <span class="nn">pyejabberd.muc.enums</span> <span class="kn">import</span> <span class="n">MUCRoomOption</span>
<span class="n">client</span><span class="o">.</span><span class="n">change_room_option</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'room1'</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s1">'conference'</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="n">MUCRoomOption</span><span class="o">.</span><span class="n">public</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">change_room_option</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'room1'</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s1">'conference'</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="n">MUCRoomOption</span><span class="o">.</span><span class="n">members_only</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Set room affiliation</span>
<span class="kn">from</span> <span class="nn">pyejabberd.muc.enums</span> <span class="kn">import</span> <span class="n">Affiliation</span>
<span class="n">client</span><span class="o">.</span><span class="n">set_room_affiliation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'room1'</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s1">'conference'</span><span class="p">,</span> <span class="n">jid</span><span class="o">=</span><span class="s1">'alice@example.com'</span><span class="p">,</span> <span class="n">affiliation</span><span class="o">=</span><span class="n">Affiliation</span><span class="o">.</span><span class="n">member</span><span class="p">)</span>

<span class="c1"># Get room affiliations</span>
<span class="n">affiliations</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_room_affiliations</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'room1'</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s1">'conference'</span><span class="p">)</span>

<span class="c1"># Destroy a muc room</span>
<span class="n">client</span><span class="o">.</span><span class="n">destroy_room</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'room1'</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s1">'conference'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">)</span>

<span class="c1"># Unregister a user</span>
<span class="n">client</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">'alice'</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'example.com'</span><span class="p">)</span>
</pre>
</div>
</div></body></html>