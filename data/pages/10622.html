<html><body><div><div class="document">


<p>Good technical writing for a suitably complex python project, technical guide,
or even a book, will require a supporting structure to sufficiently abstract
the commands needed to check and compile it.</p>
<p>Writing a guidebook across a team of writers and developers, we can integrate
<a class="reference external" href="http://sphinx-doc.org">sphinx</a>, <a class="reference external" href="https://tox.readthedocs.org/en/latest/">tox</a>, and many other free tools and services.  Many features of
sphinx are listed on their <a class="reference external" href="http://www.sphinx-doc.org/en/stable/">Welcome</a>
page, but this article will focus on:</p>
<ul class="simple">
<li>Using <a class="reference external" href="https://tox.readthedocs.org/en/latest/">tox</a> to automate checking our reStructuredText markup.</li>
<li>Cross-platform builds without any <tt class="docutils literal">Makefile</tt> or <tt class="docutils literal">make.bat</tt>.</li>
<li>Perform linting of <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html">reStructuredText</a> and project code.</li>
<li>Create API documentation from <tt class="docutils literal">""" docstrings """</tt> in code.</li>
<li>Uniformly present an introduction on GitHub, PyPi, and <a class="reference external" href="https://readthedocs.org/">readthedocs.org</a>.</li>
</ul>
<div class="section" id="sphinx">
<h1>Sphinx</h1>
<p>To be quick about it, we using the <tt class="docutils literal"><span class="pre">sphinx-quickstart</span></tt> command, specifying
<tt class="docutils literal">./docs/</tt> when prompted for the folder for sphinx to generate documentation.
If we become lost, we can just follow along the <a class="reference external" href="http://www.sphinx-doc.org/en/stable/tutorial.html">First Steps with Sphinx</a> tutorial.</p>
<p>We create an important file pattern: our introduction chapter as file
<tt class="docutils literal">docs/intro.rst</tt>, and symlink <tt class="docutils literal">README.rst</tt> to that file.  Git manages
symlinks in version control perfectly fine, and GitHub follows the symlink
target when rendering the top-level <tt class="docutils literal">README.rst</tt> and <tt class="docutils literal">CONTRIBUTING.rst</tt>
files</p>
<p>Creating the symlink:</p>
<pre class="literal-block">
ln -s docs/intro.rst README.rst
</pre>
<p>And a demo <tt class="docutils literal">docs/intro.rst</tt>:</p>
<pre class="code rst literal-block">
<span class="generic heading">Introduction</span>
<span class="generic heading">============</span>

Qwack is a toy game.  We're not accepting any contributions,
but you're welcome to read our code!
</pre>
<p>We bind this to PyPi using a short accessory function in <tt class="docutils literal">setup.py</tt>:</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">setuptools</span>

<span class="keyword">def</span> <span class="name function">get_long_description</span><span class="punctuation">():</span>
    <span class="keyword namespace">import</span> <span class="name namespace">os</span><span class="operator">,</span> <span class="name namespace">codecs</span>
    <span class="name">fpath_here</span> <span class="operator">=</span> <span class="name">os</span><span class="operator">.</span><span class="name">path</span><span class="operator">.</span><span class="name">dirname</span><span class="punctuation">(</span><span class="name">__file__</span><span class="punctuation">)</span>
    <span class="name">fpath_readme</span> <span class="operator">=</span> <span class="name">os</span><span class="operator">.</span><span class="name">path</span><span class="operator">.</span><span class="name">join</span><span class="punctuation">(</span><span class="name">fpath_here</span><span class="punctuation">,</span> <span class="literal string">'README.rst'</span><span class="punctuation">)</span>
    <span class="keyword">return</span> <span class="name">codecs</span><span class="operator">.</span><span class="name">open</span><span class="punctuation">(</span><span class="name">fpath_readme</span><span class="punctuation">,</span> <span class="literal string">'r'</span><span class="punctuation">,</span> <span class="literal string">'utf8'</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">()</span>

<span class="name">setuptools</span><span class="operator">.</span><span class="name">setup</span><span class="punctuation">(</span>
    <span class="name">name</span><span class="operator">=</span><span class="literal string">'qwack'</span><span class="punctuation">,</span>
    <span class="name">packages</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal string">'qwack'</span><span class="punctuation">,],</span>
    <span class="name">version</span><span class="operator">=</span><span class="literal number integer">1</span><span class="punctuation">,</span>
    <span class="name">description</span><span class="operator">=</span><span class="literal string">'This displays in search results and top of pypi.'</span>
    <span class="name">long_description</span><span class="operator">=</span><span class="name">get_long_description</span><span class="punctuation">(</span><span class="literal string">'README.rst'</span><span class="punctuation">),</span>
    <span class="name">author</span><span class="operator">=</span><span class="literal string">'Yours truly,'</span><span class="punctuation">,</span>
<span class="punctuation">)</span>
</pre>
<ul class="simple">
<li>We could modify the <tt class="docutils literal">get_long_description()</tt> function to concatenate
additional files, such as a <tt class="docutils literal">history.rst</tt> or <tt class="docutils literal">CONTRIBUTING.rst</tt> to
its result string, so that they appear directly on PyPi.  PyPi supports
only reStructuredText-formatted files for markup.</li>
</ul>
</div>
<div class="section" id="tox">
<h1>Tox</h1>
<p>Although <a class="reference external" href="https://tox.readthedocs.org/en/latest/">tox</a> is generally regarded for running tests, the tox workflow
is multi-purpose due to its simple workflow similar to a 'containerization'
model:</p>
<ul class="simple">
<li>create a <a class="reference external" href="http://virtualenv.readthedocs.org/en/latest/">virtualenv</a></li>
<li>install dependencies.</li>
<li>build and install our project by setup.py</li>
<li>run 1 or more commands</li>
</ul>
<p>Because <a class="reference external" href="http://virtualenv.readthedocs.org/en/latest/">virtualenv</a> is used, execution speed is fast but uniform across all
contributing parties.  Command execution is defined by an OS-independent
<tt class="docutils literal">.ini</tt> file, so Makefile, PowerShell, or bash is avoided.  <a class="reference external" href="https://tox.readthedocs.org/en/latest/">tox</a> then
becomes our command dashboard for all contributors and CI systems so that
the environment may be reliably reproduced.</p>
<div class="section" id="tox-ini">
<h2>tox.ini</h2>
<p>With this in mind, we create a <tt class="docutils literal">tox.ini</tt> with <a class="reference external" href="http://testrun.org/tox/latest/example/basic.html#a-simple-tox-ini-default-environments">testenv</a> target, '<tt class="docutils literal">docs</tt>':</p>
<pre class="code ini literal-block">
<span class="keyword">[tox]</span>
<span class="name attribute">envlist</span> <span class="operator">=</span> <span class="literal string">py35, check, docs</span>

<span class="keyword">[testenv]</span>
<span class="name attribute">deps</span> <span class="operator">=</span> <span class="literal string">pytest</span>
<span class="name attribute">commands</span> <span class="operator">=</span> <span class="literal string">py.test {posargs:--verbose --verbose} qwack/tests</span>

<span class="keyword">[testenv:check]</span>
<span class="name attribute">basepython</span> <span class="operator">=</span> <span class="literal string">python3.5</span>
<span class="name attribute">deps</span> <span class="operator">=</span> <span class="literal string">prospector[with_pyroma]</span>
<span class="name attribute">commands</span> <span class="operator">=</span> <span class="literal string">python -m compileall -fq {toxinidir}/qwack
           prospector --with-tool pyroma {toxinidir}</span>

<span class="keyword">[testenv:docs]</span>
<span class="name attribute">deps</span> <span class="operator">=</span> <span class="literal string">restructuredtext_lint
       doc8
       sphinx</span>
<span class="name attribute">commands</span> <span class="operator">=</span> <span class="literal string">rst-lint README.rst
           doc8 docs/
           sphinx-build -W -b html docs/</span>

<span class="keyword">[pytest]</span>
<span class="name attribute">norecursedirs</span> <span class="operator">=</span> <span class="literal string">.git .tox</span>
</pre>
<p>The section <tt class="docutils literal">[testenv:docs]</tt> declares the environment and commands needed
to perform a lint check and build HTML documentation.  Each tox environment
target we specify may be discovered and using <tt class="docutils literal">tox <span class="pre">-l</span></tt> and executed using
<tt class="docutils literal">tox <span class="pre">-e</span></tt> command parameters:</p>
<pre class="literal-block">
$ tox -l
py35
check
docs
</pre>
<p>Details of the other Tox targets are later described under section,
<a class="reference internal" href="#more-on-tox">More on Tox</a>.</p>
</div>
<div class="section" id="the-docs-target">
<h2>The 'docs' target</h2>
<p>Target <tt class="docutils literal">[testenv:docs]</tt> executes 3 commands:</p>
<ol class="arabic">
<li><p class="first"><a class="reference external" href="https://pypi.python.org/pypi/restructuredtext_lint">rst-lint</a> for our <tt class="docutils literal">README.rst</tt> file, ensuring it will not fail to
render on PyPi.</p>
</li>
<li><p class="first"><a class="reference external" href="https://pypi.python.org/pypi/doc8/">doc8</a> to check style of all of our <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html">reStructuredText</a> files in
the <tt class="docutils literal">docs/</tt> sub-folder.</p>
<p>The <a class="reference external" href="https://pypi.python.org/pypi/doc8/">doc8</a> PyPi page <strong>fails to render</strong> on <a class="reference external" href="https://pypi.python.org/pypi/doc8/0.6.0">pypi.python.org</a> due to a <strong>markup syntax
error</strong>.  They should have used <a class="reference external" href="https://pypi.python.org/pypi/restructuredtext_lint">rst-lint</a>!</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">sphinx-build</span></tt> to generate HTML documentation of our <tt class="docutils literal">docs/</tt>
sub-folder.  Notably, <em>turn warnings into errors</em> is enabled, which
informs our CI of a failed build.</p>
</li>
</ol>
<p>Any user with tox installed can perform these actions using:</p>
<pre class="literal-block">
tox -e docs
</pre>
</div>
</div>
<div class="section" id="cross-referencing">
<h1>Cross-referencing</h1>
<p>At its very best, <a class="reference external" href="http://sphinx-doc.org">sphinx</a> has astounding support for cross-referencing,
whether by referencing functions, classes, or objects in code, other
section titles, or even external documentation.</p>
<p>For our example document, we'd like to introduce a simple TOC in
<tt class="docutils literal">docs/index.rst</tt>:</p>
<pre class="code rst literal-block">
<span class="generic heading">=================================</span>
<span class="generic heading">Welcome to Qwack's documentation!</span>
<span class="generic heading">=================================</span>

Contents:

<span class="punctuation">..</span> <span class="operator word">toctree</span><span class="punctuation">::</span>
   <span class="name class">:maxdepth:</span> <span class="name function">3</span>

   intro
   api
</pre>
<p>Each section title up to the 3rd depth level optionally set here is rendered
here as a hyperlink.  The first title here, "Welcome to Qwack's documentation!"
is the first depth level, simply because it is the first one used. Depth levels
are defined by a novel identification of <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html#sections">title adornment characters</a>.</p>
<p>The contents of two files, <tt class="docutils literal">intro.rst</tt> and <tt class="docutils literal">api.rst</tt> are also referenced
here the first is our top-level project README, and the second <tt class="docutils literal">api.rst</tt>:</p>
<pre class="literal-block">
API Documentation
=================

This is the code documentation for developers, beware!

Begin with the Introduction_ section if you're lost!

main.py
-------

.. automodule:: qwack.main
   :members:
   :undoc-members:
</pre>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Glob_%28programming%29">glob</a> expressions may also be used:</p>
<pre class="literal-block">
.. toctree::
   :maxdepth: 3
   :glob:

   forward
   introduction
   chapters/*
   back_matter/*
   glossery
</pre>
<p>We can now refer to the target <tt class="docutils literal">`main.py`_</tt> anywhere else in our docs,
and the hyperlinks are managed appropriately by their title.  We can also
make reference to our API documentation, or even standard python
documentation:</p>
<pre class="literal-block">
This is a context manager for :func:`tty.setcbreak`.
</pre>
<p>This is made possible with <a class="reference external" href="http://www.sphinx-doc.org/en/stable/tutorial.html#intersphinx">intersphinx</a>.  External references made outside of
sphinx may also be checked by adding the <tt class="docutils literal"><span class="pre">sphinx-build</span></tt> argument
<tt class="docutils literal"><span class="pre">-blinkcheck</span></tt>, this can ensure links to external resources are verified at
the time of the build or publication date.</p>
</div>
<div class="section" id="extensions">
<h1>Extensions</h1>
<p>Sphinx extensions such as <a class="reference external" href="https://pypi.python.org/pypi/sphinx-issues">sphinx-issues</a> adds <em>domains</em>, allowing markup
<tt class="docutils literal"><span class="pre">:ghissue:`29`</span></tt> to refer to pull requests or issue numbers on GitHub.
<a class="reference external" href="https://pypi.python.org/pypi/sphinx-paramlinks">sphinx_paramlinks</a> further extends API documentation to allow referencing
<strong>function arguments</strong>, one level deeper than referring to a function:</p>
<pre class="literal-block">
The :paramref:`Terminal.get_location.timeout` keyword argument can be
specified to return coordinates (-1, -1) after a blocking timeout.
</pre>
<p>Unlike their "Markdown-flavored" derivatives, these <em>domains</em> allow rendering
of sphinx-extended text to be compiled by other reStructuredText-compatible
tools <em>even when unsupported</em>.  Most requirements of a technical writer may be
satisfied by the hundreds of extensions available.</p>
</div>
<div class="section" id="readthedocs-org">
<h1>readthedocs.org</h1>
<p>The <tt class="docutils literal">docs/conf.py</tt> file created using <tt class="docutils literal"><span class="pre">sphinx-quickstart</span></tt> and publishing
to GitHub are the only two requirements needed to use <a class="reference external" href="https://readthedocs.org/">readthedocs.org</a>.</p>
<p>As a bonus, <a class="reference external" href="https://readthedocs.org/">readthedocs.org</a> can create a PDF file for us, which would
otherwise require installing LaTeX on our local workstation which can be
difficult, even for developers!</p>
<p>If we like the way <a class="reference external" href="https://readthedocs.org/">readthedocs.org</a> looks, we can install the
<a class="reference external" href="https://pypi.python.org/pypi/sphinx_rtd_theme">sphinx_rtd_theme</a> dependency and build the same HTML/css format locally.</p>
</div>
<div class="section" id="advanced-sphinx">
<h1>Advanced Sphinx</h1>
<p>What we've covered here is something like a follow-up to the
<a class="reference external" href="https://pythonhosted.org/an_example_pypi_project/sphinx.html">Documenting Your Project Using Sphinx</a> article,
so please give it a read if you are new to <a class="reference external" href="http://sphinx-doc.org">sphinx</a> or reStructuredText.</p>
<p>You can use sphinx to document many languages other than Python, most
certainly the built-in C, C++, and javascript <a class="reference external" href="http://www.sphinx-doc.org/en/stable/domains.html">domains</a> and others by
extension, such as <a class="reference external" href="https://pythonhosted.org/sphinxcontrib-scaladomain/">scala</a>, <a class="reference external" href="https://bronto.github.io/javasphinx/">java</a>, or <a class="reference external" href="https://pypi.python.org/pypi/sphinxcontrib-golangdomain">Go</a>.</p>
</div>
<div class="section" id="more-on-tox">
<h1>More on Tox</h1>
<p>Reviewing the <a class="reference internal" href="#tox-ini">tox.ini</a> file listed earlier, we see a <a class="reference external" href="http://pytest.org/latest/">pytest</a> command
from our <a class="reference external" href="http://testrun.org/tox/latest/example/basic.html#a-simple-tox-ini-default-environments">testenv</a> section, as suggested by the tox guide section,
<a class="reference external" href="&lt;https://tox.readthedocs.org/en/latest/example/general.html#general-tips-and-tricks&gt;">General tips and tricks</a>.</p>
<p>Notably, we make use of <tt class="docutils literal">{posargs}</tt> so that we can change our test argument
signature by escaping with the traditional <a class="reference external" href="http://man7.org/linux/man-pages/man1/getopt.1.html#DESCRIPTION">getopt</a> delimiter <tt class="docutils literal"><span class="pre">--</span></tt>:</p>
<pre class="literal-block">
tox -epy35 -- --looponfail --exitfirst qwack/tests/core.py
</pre>
<p>For CI systems, tox recommends building using a <a class="reference external" href="http://pytest.org/latest/">pytest</a> target in their
<a class="reference external" href="http://tox.readthedocs.org/en/latest/example/jenkins.html">jenkins integration page</a>, but tox alone will propagate a non-zero exit
code for our build tools, which is sufficient and less complex.</p>
<p>Some of them are rather creative, or used for projects that have nothing to
do with python.  There are over 22,000 <tt class="docutils literal">tox.ini</tt> file examples on GitHub
using the query, '<a class="reference external" href="https://github.com/search?q=filename%3Atox.ini">filename:tox.ini</a>' to explore.  A tox file to
manage the steps used to develop and publish this article:</p>
<pre class="literal-block">
[tox]
skipsdist=True

[testenv:build]
deps = docutils
       pygments
whitelist_externals = hugo
commands = hugo -d upload

[testenv:develop]
deps = docutils
       pygments
whitelist_externals = hugo
commands = hugo -w server -d /tmp/hugo-develop

[testenv:publish]
whitelist_externals = rsync
commands = rsync -a upload/ jeffquast.com:jeffquast.com/
</pre>
<p>And deployed using:</p>
<pre class="literal-block">
$ tox -ebuild,publish
</pre>
<div class="section" id="code-linting">
<h2>Code Linting</h2>
<p>Returning to our <a class="reference internal" href="#tox-ini">tox.ini</a> file declared earlier in this article, our <tt class="docutils literal">check</tt>
target byte-compiles all python files using command <tt class="docutils literal">python <span class="pre">-m</span> compileall</tt>.
This ensures the code is free of some kinds of syntax errors, quickly.</p>
<p>After byte-compiling the project, <a class="reference external" href="https://pypi.python.org/pypi/prospector">prospector</a> is used, <a class="reference external" href="https://pypi.python.org/pypi/prospector">prospector</a> front-ends
several useful static analysis and style guide-enforcing tools.</p>
<p>Using the optional file, <tt class="docutils literal">.landscape.yaml</tt>, we may declare an explicit list of exclusions to any of the linting or code checking rules that are reported as
violated.  We might change the "80-column" rule 120, or make exclusions to
certain pylint messages:</p>
<pre class="code yaml literal-block">
<span class="literal scalar plain">inherits</span><span class="punctuation indicator">:</span>
    <span class="punctuation indicator">-</span> <span class="literal scalar plain">strictness_veryhigh</span>

<span class="literal scalar plain">ignore-patterns</span><span class="punctuation indicator">:</span>
    <span class="punctuation indicator">-</span> <span class="literal scalar plain">(^|/)\..+</span>
    <span class="punctuation indicator">-</span> <span class="literal scalar plain">^docs/</span>
    <span class="punctuation indicator">-</span> <span class="literal scalar plain">^build/</span>
    <span class="punctuation indicator">-</span> <span class="literal scalar plain">^qwack/tests</span>

<span class="literal scalar plain">pep8</span><span class="punctuation indicator">:</span>
  <span class="literal scalar plain">options</span><span class="punctuation indicator">:</span>
      <span class="literal scalar plain">max-line-length</span><span class="punctuation indicator">:</span> <span class="literal scalar plain">120</span>

<span class="literal scalar plain">pylint</span><span class="punctuation indicator">:</span>
    <span class="literal scalar plain">options</span><span class="punctuation indicator">:</span>
        <span class="literal scalar plain">ignored-classes</span><span class="punctuation indicator">:</span> <span class="literal scalar plain">pytest</span>
        <span class="literal scalar plain">good-names</span><span class="punctuation indicator">:</span> <span class="literal scalar plain">_,ks,fd</span>
        <span class="literal scalar plain">persistent</span><span class="punctuation indicator">:</span> <span class="literal scalar plain">no</span>

    <span class="literal scalar plain">disable</span><span class="punctuation indicator">:</span>
        <span class="punctuation indicator">-</span> <span class="literal scalar plain">protected-access</span>
        <span class="punctuation indicator">-</span> <span class="literal scalar plain">too-few-public-methods</span>
        <span class="punctuation indicator">-</span> <span class="literal scalar plain">star-args</span>
        <span class="punctuation indicator">-</span> <span class="literal scalar plain">wrong-import-order</span>
        <span class="punctuation indicator">-</span> <span class="literal scalar plain">wrong-import-position</span>
        <span class="punctuation indicator">-</span> <span class="literal scalar plain">ungrouped-imports</span>
</pre>
<p>Contributors then have no doubt about which style rules are enforced, this
file becomes a contract among developers and enforced by our CI.  The same
review process for code changes are used to propose changes.</p>
<p>By using GitHub, the cloud service <a class="reference external" href="https://landscape.io">https://landscape.io</a> can automatically
report prospector results, without installing any of these tools on our
workstation.</p>
</div>
</div>
<div class="section" id="closing-remarks">
<h1>Closing remarks</h1>
<p>Although the tools we've used are written in python, we don't require knowing
the python language to use them.  This article is rendered by a program written
in go, for example.  By using <a class="reference external" href="https://tox.readthedocs.org/en/latest/">tox</a>, we reduce the knowledge barrier for
contributions and ensure consistent behavior between team members and their
windows, mac, or linux server platforms.</p>
<p>By separating our editor and builder, as well as our content from presentation,
we allow multiple contributors to work on all of these parts independently.
Through version control and workflows offered by basic web services, we achieve
more discipline of quality and efficiency through these tools than even the
most premium "Office" software suites can offer.</p>
</div>
</div>
                </div></body></html>