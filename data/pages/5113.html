<html><body><div><div class="section-inner layoutSingleColumn"><h3 name="f052" id="f052" class="graf--h3 graf--first">Introduction to Property Based Testing With Hypothesis</h3><p name="1a89" id="1a89" class="graf--p graf-after--h3">A standard set of <a href="https://en.wikipedia.org/wiki/Test_case" data-href="https://en.wikipedia.org/wiki/Test_case" class="markup--anchor markup--p-anchor" rel="nofollow">test cases</a> looks like this: Given input X I expect result Y. Repeat for different Xs and Ys until you have confidence your code works. In practice there are at least two common problems: This testing can lead to a large amount of code that must be maintained and all too often we miss bugs because of assumptions we made about what inputs needed testing.</p><p name="1c75" id="1c75" class="graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Property Based Testing</strong> is a method of writing tests that tries to improve testing quality while minimizing testing code. The basic concept is you <em class="markup--em markup--p-em">describe</em> the inputs to your function and then declare what <em class="markup--em markup--p-em">properties</em> that must be true to declare your code correct.</p><p name="33cb" id="33cb" class="graf--p graf-after--p">Let’s walk though an example using <a href="https://hypothesis.readthedocs.org/en/master/" data-href="https://hypothesis.readthedocs.org/en/master/" class="markup--anchor markup--p-anchor" rel="nofollow">Hypothesis</a>. Hypothesis a property based testing library for <a href="http://python.org" data-href="http://python.org" class="markup--anchor markup--p-anchor" rel="nofollow">Python</a> written by <a href="https://twitter.com/DRMacIver" data-href="https://twitter.com/DRMacIver" class="markup--anchor markup--p-anchor" rel="nofollow">David R. Maclver</a>. Many of its core ideas are come from Haskell’s <a href="https://hackage.haskell.org/package/QuickCheck" data-href="https://hackage.haskell.org/package/QuickCheck" class="markup--anchor markup--p-anchor" rel="nofollow">QuickCheck</a> library.</p><p name="8bce" id="8bce" class="graf--p graf-after--p">Assume I am writing an application to be an online history archive. Below is a simple model for describing an event. I included code to encode and decode this object with <a href="http://json.org/" data-href="http://json.org/" class="markup--anchor markup--p-anchor" rel="nofollow">JSON</a> as I would like my app to communicate with some kind of front end.</p><figure name="05cc" id="05cc" class="graf--figure graf--iframe graf-after--p"><p class="iframeContainer"/></figure><p name="beb3" id="beb3" class="graf--p graf-after--figure">The question now: Does my encoder/decoder actually do what I think it does?</p><p name="4f2d" id="4f2d" class="graf--p graf-after--p">Some reasonable test code would be:</p><figure name="211c" id="211c" class="graf--figure graf--iframe graf-after--p"><p class="iframeContainer"/></figure><p name="3830" id="3830" class="graf--p graf-after--figure">This test passes and would get us full test <a href="http://nedbatchelder.com/code/coverage/" data-href="http://nedbatchelder.com/code/coverage/" class="markup--anchor markup--p-anchor" rel="nofollow">coverage</a>. However, for production ready code we may want to try different examples to ensure our code works in a variety of different situations. Realistically though, this is a fairly simple bit of code and many of us would stop here.</p><p name="afd5" id="afd5" class="graf--p graf-after--p">Besides only testing one case, the problem is that a lot of the code here is irrelevant to what’s being tested. All that code setting up my data is boilerplate. At the end of the day, I don’t care about specific data. I care about certain <em class="markup--em markup--p-em">properties</em> being true. Specifically, I expect that if I encode an object to JSON I should be able to load that code back into my system without losing data. <em class="markup--em markup--p-em">No matter what the specific values are in my object.</em></p><figure name="f5d1" id="f5d1" class="graf--figure graf-after--p"><figcaption class="imageCaption">No matter what I should be able to take my object to and from JSON without data loss</figcaption></figure><p name="92b8" id="92b8" class="graf--p graf-after--figure">Let’s see a property based version of this test.</p><figure name="ee4d" id="ee4d" class="graf--figure graf--iframe graf-after--p"><p class="iframeContainer"/></figure><p name="4fe3" id="4fe3" class="graf--p graf-after--figure">Using the <em class="markup--em markup--p-em">@given</em> decorator, I tell hypothesis what kind of data to give my test. With that I construct my Event, dump it to JSON and load that JSON back in. I then assert that I got back an equal Event.</p><p name="f27c" id="f27c" class="graf--p graf-after--p">Hypothesis by default will run 200 different examples against this test. It Explores the space of possible inputs and ensuring that for all those cases the property I wrote remains true.</p><p name="9f5f" id="9f5f" class="graf--p graf-after--p">Running this test actually highlights a problem!</p><figure name="f592" id="f592" class="graf--figure graf--iframe graf-after--p"><p class="iframeContainer"/></figure><p name="ade8" id="ade8" class="graf--p graf-after--figure">While testing my code Hypothesis found a failure. Despite working with random data Hypothesis gave me a very simple example to debug. This is because rather than giving me the first failure it finds Hypothesis will simplify that failure as much as it can.</p><p name="4781" id="4781" class="graf--p graf-after--p">So what’s happening with my program? If you look closely, you will see that this date is from the first century AD. I am using <a href="https://dateutil.readthedocs.org/en/latest/" data-href="https://dateutil.readthedocs.org/en/latest/" class="markup--anchor markup--p-anchor" rel="nofollow">dateutil</a> to parse my ISO formatted date strings and it turns out as of this writing dateutil mis-interprets this date as 1999 rather than 99. I have written a patch to fix this here <a href="https://github.com/dateutil/dateutil/pull/96" data-href="https://github.com/dateutil/dateutil/pull/96" class="markup--anchor markup--p-anchor" rel="nofollow">https://github.com/dateutil/dateutil/pull/96</a>.</p><p name="08f9" id="08f9" class="graf--p graf-after--p">This is an obscure bug in my decoder. That is the point though! I would not have thought to test this case because I assumed that the date parsing would work fine since I was relying on a solid and popular library to do it for me.</p><p name="b647" id="b647" class="graf--p graf-after--p">Property Based Testing can lead to smaller and more powerful tests. However, this method requires a different way of thinking than you may be used to. If you are interested in reading more here are some resources to get you started. I actually was provided these by David in the #hypothesis irc!</p><p name="046a" id="046a" class="graf--p graf-after--p"><a href="http://fsharpforfunandprofit.com/posts/property-based-testing-2/" data-href="http://fsharpforfunandprofit.com/posts/property-based-testing-2/" class="markup--anchor markup--p-anchor" rel="nofollow">http://fsharpforfunandprofit.com/posts/property-based-testing-2/</a></p><p name="11cd" id="11cd" class="graf--p graf-after--p"><a href="http://research.microsoft.com/en-us/projects/pex/patterns.pdf" data-href="http://research.microsoft.com/en-us/projects/pex/patterns.pdf" class="markup--anchor markup--p-anchor" rel="nofollow">http://research.microsoft.com/en-us/projects/pex/patterns.pdf</a></p><p name="c1d7" id="c1d7" class="graf--p graf-after--p">In addition, I highly recommend the Hypothesis docs. They do a fantastic job of walking you though what this library is capable of.</p><p name="18e7" id="18e7" class="graf--p graf-after--p graf--last"><a href="https://hypothesis.readthedocs.org/en/latest/" data-href="https://hypothesis.readthedocs.org/en/latest/" class="markup--anchor markup--p-anchor" rel="nofollow">https://hypothesis.readthedocs.org/en/latest/</a></p></div></div></body></html>