<html><body><div><div class="entry-content clearfix"><p><em>This is a guest blog post from <a href="https://twitter.com/chrstphrhrt">Chris Hart</a> of <a href="https://brandicted.com/">Brandicted</a> – a technologist from the great city of  Montreal.</em></p>

<a name="Foreword"/>
<h2>Foreword</h2>

<p>This tutorial is meant for beginners. If you get stuck along the way, try to power through and it will probably click. If there’s anything you just don’t get or want some help with, email <a href="mailto:info@brandicted.com">info@brandicted.com</a> or leave a comment below.</p>

<a name="Intro"/>
<h2>Intro</h2>

<p>Making an API can be a lot of work. Developers need to handle details like serialization, URL mapping, validation, authentication, authorization, versioning, testing, databases, custom code for models and views, etc. Services like Firebase and Parse exist to make this way easier. Using a Backend-as-a-Service, developers can focus more on building unique user experiences.</p>

<p>Some drawbacks of using third party backend providers include a lack of control over the backend code, inability to self-host, no intellectual property, etc.. Having control over the code <em>and</em> leveraging the time-saving convenience of a BaaS would be ideal, but most REST API frameworks in the wild still require a lot of boilerplate. One popular example of this would be the awesomely heavy <a href="http://www.django-rest-framework.org/">Django Rest Framework</a>. Another great project which requires way less boilerplate and makes building APIs super easy is <a href="https://flask-restless.readthedocs.org/en/latest/">Flask-Restless</a> (highly recommended). We wanted to get rid of all boilerplate though, including the database queries that would normally need to be written for views.</p>

<p>Enter Ramses, a simple way to generate a powerful backend from a YAML file (actually a dialect for REST APIs called <a href="http://raml.org/">RAML</a>). <strong>In this post we’ll show you how to go from zero to your own production-ready backend in a few minutes.</strong></p>

<blockquote><p>Want the code? <a href="https://github.com/brandicted/ramses">Ramses on Github</a></p></blockquote>

<a name="Bootstrap.a.new.product.API"/>
<h2>Bootstrap a new product API</h2>

<a name="Prerequisites"/>
<h3>Prerequisites</h3>

<p>We assume you are working inside a fresh <a href="https://virtualenv.pypa.io/en/latest/">virtual Python environment</a>, and are running both <a href="https://www.elastic.co/downloads/elasticsearch">elasticsearch</a> and <a href="http://www.postgresql.org/download/">postgresql</a> with default configurations. We use <a href="https://github.com/jakubroztocil/httpie">httpie</a> to interact with the API but you can also use curl or other http clients.</p>

<p>If at any time you get stuck or want to see the final working version of the code for this tutorial, <a href="https://github.com/chrstphrhrt/ramses-tutorial/tree/master/pizza_factory">it can be found here</a>.</p>

<a name="Scenario:.a.factory.to.make..hopefully..delicious.pizzas"/>
<h3>Scenario: a factory to make (hopefully) delicious pizzas</h3>









<p>We want to create an API for our new pizzeria. Our backend should know about all the different toppings, cheeses, sauces, and crusts that can be used and the different combinations of them that go into making various pizza styles.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>pip install ramses
</span><span class="line"><span class="nv">$ </span>pcreate -s ramses_starter pizza_factory
</span></code></pre></td></tr></table></div></figure>


<p>The installer will ask which database backend you want to use. Pick option “1” to use SQLAlchemy.</p>

<p>Change into the newly created directory and look around.</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>All endpoints will be accessible at the URI /api/endpoint-name/item-id. The built-in server runs on port 6543 by default. Have a read through <strong>local.ini</strong> and see if it makes any sense. Then run the server to start interacting with your new backend.</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>Look at <strong>api.raml</strong> to get an idea of how endpoints are specified.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span class="c1">#%RAML 0.8</span>
</span><span class="line"><span class="nn">---</span>
</span><span class="line"><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza_factory</span>
</span><span class="line"><span class="l-Scalar-Plain">documentation</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza_factory REST API</span>
</span><span class="line">      <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
</span><span class="line">        <span class="no">Welcome to the pizza_factory API.</span>
</span><span class="line"><span class="l-Scalar-Plain">baseUri</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://localhost:6543/api</span>
</span><span class="line"><span class="l-Scalar-Plain">mediaType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">application/json</span>
</span><span class="line"><span class="l-Scalar-Plain">protocols</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">HTTP</span><span class="p-Indicator">]</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">/items</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Collection of items</span>
</span><span class="line">    <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get all item</span>
</span><span class="line">    <span class="l-Scalar-Plain">post</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a new item</span>
</span><span class="line">        <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">application/json</span><span class="p-Indicator">:</span>
</span><span class="line">                <span class="l-Scalar-Plain">schema</span><span class="p-Indicator">:</span> <span class="kt">!include</span> <span class="l-Scalar-Plain">items.json</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">/{id}</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Collection-item</span>
</span><span class="line">        <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get a particular item</span>
</span><span class="line">        <span class="l-Scalar-Plain">delete</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Delete a particular item</span>
</span><span class="line">        <span class="l-Scalar-Plain">patch</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Update a particular item</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, we have a resource at /api/items which is defined by the schema in <strong>items.json</strong>.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http :6543/api/items
</span><span class="line">HTTP/1.1 200 OK
</span><span class="line">Cache-Control: max-age<span class="o">=</span>0, must-revalidate, no-cache, no-store
</span><span class="line">Content-Length: 73
</span><span class="line">Content-Type: application/json<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
</span><span class="line">Date: Tue, 02 Jun 2015 16:02:09 GMT
</span><span class="line">Expires: Tue, 02 Jun 2015 16:02:09 GMT
</span><span class="line">Last-Modified: Tue, 02 Jun 2015 16:02:09 GMT
</span><span class="line">Pragma: no-cache
</span><span class="line">Server: waitress
</span><span class="line">
</span><span class="line"><span class="o">{</span>
</span><span class="line">    <span class="s2">"count"</span>: 0,
</span><span class="line">    <span class="s2">"data"</span>: <span class="o">[]</span>,
</span><span class="line">    <span class="s2">"fields"</span>: <span class="s2">""</span>,
</span><span class="line">    <span class="s2">"start"</span>: 0,
</span><span class="line">    <span class="s2">"took"</span>: 1,
</span><span class="line">    <span class="s2">"total"</span>: 0
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Data.modeling"/>
<h2>Data modeling</h2>

<a name="Schemas."/>
<h3>Schemas!</h3>

<p>Schemas describe the structure of data.</p>

<p>We need to create them for each of the different kinds of ingredients that we will make our pizzas with. The default schema from Ramses is a basic example in <strong>items.json</strong>.</p>

<p>Since we’re going to have more than one schema in our project, let’s create a new directory and move the default schema into it to keep things clean.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>mkdir schemas
</span><span class="line"><span class="nv">$ </span>mv items.json schemas/
</span><span class="line"><span class="nv">$ </span><span class="nb">cd </span>schemas/
</span></code></pre></td></tr></table></div></figure>


<p><strong>Rename items.json to pizzas.json</strong> and open it in a text editor. Then copy its contents into new files in the same directory with the names <strong>toppings.json</strong>, <strong>cheeses.json</strong>, <strong>sauces.json</strong>, and <strong>crusts.json</strong>.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>tree
</span><span class="line">.
</span><span class="line">├── cheeses.json
</span><span class="line">├── crusts.json
</span><span class="line">├── pizzas.json
</span><span class="line">├── sauces.json
</span><span class="line">└── toppings.json
</span></code></pre></td></tr></table></div></figure>


<p>In each new schema, update the value of the <code>"title"</code> field for the different kinds of things that are being described (e.g. <code>"title": "Pizza schema"</code>, <code>"title": "Topping schema"</code> etc.).</p>

<p>Let’s edit the <strong>pizzas.json</strong> schema to hook up the ingredients that would go into a given style of pizza.</p>

<p>After the <code>"description"</code> field, add the following relations with the ingredients:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span class="err">...</span>
</span><span class="line"><span class="s2">"toppings"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"relationship"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"document"</span><span class="p">:</span> <span class="s2">"Topping"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_name"</span><span class="p">:</span> <span class="s2">"pizza"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span><span class="err">,</span>
</span><span class="line"><span class="s2">"cheeses"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"relationship"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"document"</span><span class="p">:</span> <span class="s2">"Cheese"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_name"</span><span class="p">:</span> <span class="s2">"pizza"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span><span class="err">,</span>
</span><span class="line"><span class="s2">"sauce_id"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"foreign_key"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"ref_document"</span><span class="p">:</span> <span class="s2">"Sauce"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column"</span><span class="p">:</span> <span class="s2">"sauce.id"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column_type"</span><span class="p">:</span> <span class="s2">"id_field"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span><span class="err">,</span>
</span><span class="line"><span class="s2">"crust_id"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"foreign_key"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"ref_document"</span><span class="p">:</span> <span class="s2">"Crust"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column"</span><span class="p">:</span> <span class="s2">"crust.id"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column_type"</span><span class="p">:</span> <span class="s2">"id_field"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="err">...</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Relations.101"/>
<h3>Relations 101</h3>

<p>We need to do the same for each of the ingredients to link them to the pizza style recipes that call for them. In <strong>toppings.json</strong> and <strong>cheeses.json</strong> we need a <code>"foreign_key"</code> field pointing to the specific pizza style that each topping would be used for (again, put this after the <code>"description"</code> field):</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span class="err">...</span>
</span><span class="line"><span class="s2">"pizza_id"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"foreign_key"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"ref_document"</span><span class="p">:</span> <span class="s2">"Pizza"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column"</span><span class="p">:</span> <span class="s2">"pizza.id"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column_type"</span><span class="p">:</span> <span class="s2">"id_field"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="err">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then in both <strong>sauces.json</strong> and <strong>crusts.json</strong> we do the <em>reverse</em> (by specifying <code>"relationship"</code> fields instead of <code>"foreign_key"</code> fields) because these two ingredients are being referenced by the particular instances of the pizza styles that call for them:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span class="err">...</span>
</span><span class="line"><span class="s2">"pizzas"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"relationship"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"document"</span><span class="p">:</span> <span class="s2">"Pizza"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_name"</span><span class="p">:</span> <span class="s2">"sauce"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="err">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>For <strong>crusts.json</strong> just make sure to set the value of <code>"backref_name"</code> to <code>"crust"</code>.</p>

<p>One thing to note here is that only a crust is <em>really</em> required to make a pizza if you think long and hard about it. Maybe we’d have to call it bread at that point, but let’s not get too philosophical.</p>

<p>Also note that <em>we have two different “directions”</em> of pizza-to-ingredient relationships going on. Pizzas have many toppings and cheeses. These are “One (pizza) to Many (ingredients)” relationships. Pizzas only have one sauce and one crust though. Each sauce or crust may be called for by many different pizza styles. When talking about pizzas, we say there is a “Many (pizzas) to One (sauce/crust)” relationship. Whichever “direction” you want to call it by is only a matter of the entity you are talking about as a point of reference.</p>

<p>One-to-Many relationships have a <code>relationship</code> field on the “One” side and a <code>foreign_key</code> field on the “Many” side, e.g. pizzas (as described in <strong>pizzas.json</strong>) have many <code>"toppings"</code>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span class="err">...</span>
</span><span class="line"><span class="s2">"toppings"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"relationship"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"document"</span><span class="p">:</span> <span class="s2">"Topping"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_name"</span><span class="p">:</span> <span class="s2">"pizza"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"backref_ondelete"</span><span class="p">:</span> <span class="s2">"NULLIFY"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="err">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>…and each topping (as described in <strong>toppings.json</strong>) is called for by certain specific pizzas (<code>"pizza_id"</code>):</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span class="err">...</span>
</span><span class="line"><span class="s2">"pizza_id"</span><span class="err">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nt">"required"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"foreign_key"</span><span class="p">,</span>
</span><span class="line">    <span class="nt">"args"</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">"ref_document"</span><span class="p">:</span> <span class="s2">"Pizza"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column"</span><span class="p">:</span> <span class="s2">"pizza.id"</span><span class="p">,</span>
</span><span class="line">        <span class="nt">"ref_column_type"</span><span class="p">:</span> <span class="s2">"id_field"</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="err">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Many-to-One relationships have a <code>foreign_key</code> field on the “Many” side and a <code>relationship</code> field on the One side. That’s why toppings have a <code>foreign_key</code> field pointing to specific pizzas, and pizzas have a <code>relationship</code> field pointing to all their toppings.</p>

<a name="Backref..amp..ondelete.arguments"/>
<h3>Backref &amp; ondelete arguments</h3>

<p><strong>To learn about using relational database concepts in detail, refer to the <a href="http://docs.sqlalchemy.org/en/latest/orm/basic_relationships.html">SQLAlchemy documentation</a>.</strong> <em>Very</em> briefly:</p>

<p>A <code>backref</code> argument tells the database that when one model is referenced by another, the “referencing” model (which has a <code>foreign_key</code> field) will also provide access “backwards” to the “referenced” model.</p>

<p>An <code>ondelete</code> argument is telling the database that when the instance of a referenced model is deleted, to change the value of the referencing field accordingly. <code>NULLIFY</code> means that the value will be set to <code>null</code>.</p>

<a name="Creating.endpoints"/>
<h2>Creating endpoints</h2>

<p>At this point, our kitchen is almost ready. In order to actually start making pizzas, we need to hook up some API endpoints to access the data models we just created.</p>

<p>Let’s edit <strong>api.raml</strong> by replacing the default “items” endpoint for each of our resources like so:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span class="c1">#%RAML 0.8</span>
</span><span class="line"><span class="nn">---</span>
</span><span class="line"><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza_factory API</span>
</span><span class="line"><span class="l-Scalar-Plain">documentation</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pizza_factory REST API</span>
</span><span class="line">      <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
</span><span class="line">        <span class="no">Welcome to the pizza_factory API.</span>
</span><span class="line"><span class="l-Scalar-Plain">baseUri</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://{host}:{port}/{version}</span>
</span><span class="line"><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">v1</span>
</span><span class="line"><span class="l-Scalar-Plain">mediaType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">application/json</span>
</span><span class="line"><span class="l-Scalar-Plain">protocols</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">HTTP</span><span class="p-Indicator">]</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">/toppings</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Collection of ingredients for toppings</span>
</span><span class="line">    <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get all topping ingredients</span>
</span><span class="line">    <span class="l-Scalar-Plain">post</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a topping ingredient</span>
</span><span class="line">        <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">application/json</span><span class="p-Indicator">:</span>
</span><span class="line">                <span class="l-Scalar-Plain">schema</span><span class="p-Indicator">:</span> <span class="kt">!include</span> <span class="l-Scalar-Plain">schemas/toppings.json</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">/{id}</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A particular topping ingredient</span>
</span><span class="line">        <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get a particular topping ingredient</span>
</span><span class="line">        <span class="l-Scalar-Plain">delete</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Delete a particular topping ingredient</span>
</span><span class="line">        <span class="l-Scalar-Plain">patch</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Update a particular topping ingredient</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">/cheeses</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Collection of different cheeses</span>
</span><span class="line">    <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get all cheeses</span>
</span><span class="line">    <span class="l-Scalar-Plain">post</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a new cheese</span>
</span><span class="line">        <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">application/json</span><span class="p-Indicator">:</span>
</span><span class="line">                <span class="l-Scalar-Plain">schema</span><span class="p-Indicator">:</span> <span class="kt">!include</span> <span class="l-Scalar-Plain">schemas/cheeses.json</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">/{id}</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A particular cheese ingredient</span>
</span><span class="line">        <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get a particular cheese</span>
</span><span class="line">        <span class="l-Scalar-Plain">delete</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Delete a particular cheese</span>
</span><span class="line">        <span class="l-Scalar-Plain">patch</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Update a particular cheese</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">/pizzas</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Collection of pizza styles</span>
</span><span class="line">    <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get all pizza styles</span>
</span><span class="line">    <span class="l-Scalar-Plain">post</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a new pizza style</span>
</span><span class="line">        <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">application/json</span><span class="p-Indicator">:</span>
</span><span class="line">                <span class="l-Scalar-Plain">schema</span><span class="p-Indicator">:</span> <span class="kt">!include</span> <span class="l-Scalar-Plain">schemas/pizzas.json</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">/{id}</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A particular pizza style</span>
</span><span class="line">        <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get a particular pizza style</span>
</span><span class="line">        <span class="l-Scalar-Plain">delete</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Delete a particular pizza style</span>
</span><span class="line">        <span class="l-Scalar-Plain">patch</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Update a particular pizza style</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">/sauces</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Collection of different sauces</span>
</span><span class="line">    <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get all sauces</span>
</span><span class="line">    <span class="l-Scalar-Plain">post</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a new sauce</span>
</span><span class="line">        <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">application/json</span><span class="p-Indicator">:</span>
</span><span class="line">                <span class="l-Scalar-Plain">schema</span><span class="p-Indicator">:</span> <span class="kt">!include</span> <span class="l-Scalar-Plain">schemas/sauces.json</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">/{id}</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A particular sauce</span>
</span><span class="line">        <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get a particular sauce</span>
</span><span class="line">        <span class="l-Scalar-Plain">delete</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Delete a particular sauce</span>
</span><span class="line">        <span class="l-Scalar-Plain">patch</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Update a particular sauce</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">/crusts</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Collection of different crusts</span>
</span><span class="line">    <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get all crusts</span>
</span><span class="line">    <span class="l-Scalar-Plain">post</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a new crust</span>
</span><span class="line">        <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">application/json</span><span class="p-Indicator">:</span>
</span><span class="line">                <span class="l-Scalar-Plain">schema</span><span class="p-Indicator">:</span> <span class="kt">!include</span> <span class="l-Scalar-Plain">schemas/crusts.json</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">/{id}</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A particular crust</span>
</span><span class="line">        <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get a particular crust</span>
</span><span class="line">        <span class="l-Scalar-Plain">delete</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Delete a particular crust</span>
</span><span class="line">        <span class="l-Scalar-Plain">patch</span><span class="p-Indicator">:</span>
</span><span class="line">            <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Update a particular crust</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Notice the order of endpoint definitions</strong>. <code>/pizzas</code> is placed after <code>/toppings</code> and <code>/cheeses</code> because it relates to them. <code>/sauces</code> and <code>/crusts</code> are placed after <code>/pizzas</code> because they relate to it. If you get any kind of errors about things missing or not being defined when starting the server, check the order of definition.</p>

<p>Now we can create our own ingredients and pizza styles!</p>

<p>Restart the server and get cooking.</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>Let’s start by making a Hawaiian style pizza:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http POST :6543/api/toppings <span class="nv">name</span><span class="o">=</span>ham
</span><span class="line">HTTP/1.1 201 Created...
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http POST :6543/api/toppings <span class="nv">name</span><span class="o">=</span>pineapple
</span><span class="line">HTTP/1.1 201 Created...
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http POST :6543/api/cheeses <span class="nv">name</span><span class="o">=</span>mozzarella
</span><span class="line">HTTP/1.1 201 Created...
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http POST :6543/api/sauces <span class="nv">name</span><span class="o">=</span>tomato
</span><span class="line">HTTP/1.1 201 Created...
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http POST :6543/api/crusts <span class="nv">name</span><span class="o">=</span>plain
</span><span class="line">HTTP/1.1 201 Created...
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http POST :6543/api/pizzas <span class="nv">name</span><span class="o">=</span>hawaiian toppings:<span class="o">=[</span>1,2<span class="o">]</span> cheeses:<span class="o">=[</span>1<span class="o">]</span> <span class="nv">sauce</span><span class="o">=</span>1 <span class="nv">crust</span><span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>


<a name="Voila."/>
<h3>Voila!</h3>









<p>Here it is in all its greasy glory:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">HTTP/1.1 201 Created
</span><span class="line">Cache-Control: max-age<span class="o">=</span>0, must-revalidate, no-cache, no-store
</span><span class="line">Content-Length: 373
</span><span class="line">Content-Type: application/json<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
</span><span class="line">Date: Fri, 05 Jun 2015 18:47:53 GMT
</span><span class="line">Expires: Fri, 05 Jun 2015 18:47:53 GMT
</span><span class="line">Last-Modified: Fri, 05 Jun 2015 18:47:53 GMT
</span><span class="line">Location: http://localhost:6543/api/pizzas/1
</span><span class="line">Pragma: no-cache
</span><span class="line">Server: waitress
</span><span class="line">
</span><span class="line"><span class="o">{</span>
</span><span class="line">    <span class="s2">"data"</span>: <span class="o">{</span>
</span><span class="line">        <span class="s2">"_type"</span>: <span class="s2">"Pizza"</span>,
</span><span class="line">        <span class="s2">"_version"</span>: 0,
</span><span class="line">        <span class="s2">"cheeses"</span>: <span class="o">[</span>
</span><span class="line">            1
</span><span class="line">        <span class="o">]</span>,
</span><span class="line">        <span class="s2">"crust"</span>: 1,
</span><span class="line">        <span class="s2">"crust_id"</span>: 1,
</span><span class="line">        <span class="s2">"description"</span>: null,
</span><span class="line">        <span class="s2">"id"</span>: 1,
</span><span class="line">        <span class="s2">"name"</span>: <span class="s2">"hawaiian"</span>,
</span><span class="line">        <span class="s2">"sauce"</span>: 1,
</span><span class="line">        <span class="s2">"sauce_id"</span>: 1,
</span><span class="line">        <span class="s2">"self"</span>: <span class="s2">"http://localhost:6543/api/pizzas/1"</span>,
</span><span class="line">        <span class="s2">"toppings"</span>: <span class="o">[</span>
</span><span class="line">            1,
</span><span class="line">            2
</span><span class="line">        <span class="o">]</span>,
</span><span class="line">        <span class="s2">"updated_at"</span>: null
</span><span class="line">    <span class="o">}</span>,
</span><span class="line">    <span class="s2">"explanation"</span>: <span class="s2">""</span>,
</span><span class="line">    <span class="s2">"id"</span>: <span class="s2">"1"</span>,
</span><span class="line">    <span class="s2">"message"</span>: null,
</span><span class="line">    <span class="s2">"status_code"</span>: 201,
</span><span class="line">    <span class="s2">"timestamp"</span>: <span class="s2">"2015-06-05T18:47:53Z"</span>,
</span><span class="line">    <span class="s2">"title"</span>: <span class="s2">"Created"</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Seed.data"/>
<h2>Seed data</h2>

<p>The last step for bonus points is to import a bunch of existing ingredient records to make things more fun.</p>

<p>First create a <code>seeds/</code> directory inside the pizza_factory project and download the seed data:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>mkdir seeds
</span><span class="line"><span class="nv">$ </span><span class="nb">cd </span>seeds/
</span><span class="line"><span class="nv">$ </span>http -d https://raw.githubusercontent.com/chrstphrhrt/ramses-tutorial/master/pizza_factory/seeds/crusts.json
</span><span class="line"><span class="nv">$ </span>http -d https://raw.githubusercontent.com/chrstphrhrt/ramses-tutorial/master/pizza_factory/seeds/sauces.json
</span><span class="line"><span class="nv">$ </span>http -d https://raw.githubusercontent.com/chrstphrhrt/ramses-tutorial/master/pizza_factory/seeds/cheeses.json
</span><span class="line"><span class="nv">$ </span>http -d https://raw.githubusercontent.com/chrstphrhrt/ramses-tutorial/master/pizza_factory/seeds/toppings.json
</span></code></pre></td></tr></table></div></figure>


<p>Now, use the built-in post2api script to load all the ingredients into your API.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>nefertari.post2api -f crusts.json -u http://localhost:6543/api/crusts
</span><span class="line"><span class="nv">$ </span>nefertari.post2api -f sauces.json -u http://localhost:6543/api/sauces
</span><span class="line"><span class="nv">$ </span>nefertari.post2api -f cheeses.json -u http://localhost:6543/api/cheeses
</span><span class="line"><span class="nv">$ </span>nefertari.post2api -f toppings.json -u http://localhost:6543/api/toppings
</span></code></pre></td></tr></table></div></figure>


<p>You can now list the different ingredients easily.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http :6543/api/toppings
</span></code></pre></td></tr></table></div></figure>


<p>Or search for the ingredients by name.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http :6543/api/toppings?name<span class="o">=</span>chicken
</span><span class="line">
</span><span class="line">HTTP/1.1 200 OK
</span><span class="line">Cache-Control: max-age<span class="o">=</span>0, must-revalidate, no-cache, no-store
</span><span class="line">Content-Length: 934
</span><span class="line">Content-Type: application/json<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
</span><span class="line">Date: Fri, 05 Jun 2015 19:58:48 GMT
</span><span class="line">Etag: <span class="s2">"fd29d8eda6441cebdd632960a21c8136"</span>
</span><span class="line">Expires: Fri, 05 Jun 2015 19:58:48 GMT
</span><span class="line">Last-Modified: Fri, 05 Jun 2015 19:58:48 GMT
</span><span class="line">Pragma: no-cache
</span><span class="line">Server: waitress
</span><span class="line">
</span><span class="line"><span class="o">{</span>
</span><span class="line">    <span class="s2">"count"</span>: 4,
</span><span class="line">    <span class="s2">"data"</span>: <span class="o">[</span>
</span><span class="line">        <span class="o">{</span>
</span><span class="line">            <span class="s2">"_score"</span>: 2.3578677,
</span><span class="line">            <span class="s2">"_type"</span>: <span class="s2">"Topping"</span>,
</span><span class="line">            <span class="s2">"_version"</span>: 0,
</span><span class="line">            <span class="s2">"description"</span>: null,
</span><span class="line">            <span class="s2">"id"</span>: 28,
</span><span class="line">            <span class="s2">"name"</span>: <span class="s2">"Chicken Tikka"</span>,
</span><span class="line">            <span class="s2">"pizza"</span>: null,
</span><span class="line">            <span class="s2">"pizza_id"</span>: null,
</span><span class="line">            <span class="s2">"self"</span>: <span class="s2">"http://localhost:6543/api/toppings/28"</span>,
</span><span class="line">            <span class="s2">"updated_at"</span>: null
</span><span class="line">        <span class="o">}</span>,
</span><span class="line">        <span class="o">{</span>
</span><span class="line">            <span class="s2">"_score"</span>: 2.3578677,
</span><span class="line">            <span class="s2">"_type"</span>: <span class="s2">"Topping"</span>,
</span><span class="line">            <span class="s2">"_version"</span>: 0,
</span><span class="line">            <span class="s2">"description"</span>: null,
</span><span class="line">            <span class="s2">"id"</span>: 27,
</span><span class="line">            <span class="s2">"name"</span>: <span class="s2">"Chicken Masala"</span>,
</span><span class="line">            <span class="s2">"pizza"</span>: null,
</span><span class="line">            <span class="s2">"pizza_id"</span>: null,
</span><span class="line">            <span class="s2">"self"</span>: <span class="s2">"http://localhost:6543/api/toppings/27"</span>,
</span><span class="line">            <span class="s2">"updated_at"</span>: null
</span><span class="line">        <span class="o">}</span>,
</span><span class="line">        <span class="o">{</span>
</span><span class="line">            <span class="s2">"_score"</span>: 2.0254436,
</span><span class="line">            <span class="s2">"_type"</span>: <span class="s2">"Topping"</span>,
</span><span class="line">            <span class="s2">"_version"</span>: 0,
</span><span class="line">            <span class="s2">"description"</span>: null,
</span><span class="line">            <span class="s2">"id"</span>: 14,
</span><span class="line">            <span class="s2">"name"</span>: <span class="s2">"BBQ Chicken"</span>,
</span><span class="line">            <span class="s2">"pizza"</span>: null,
</span><span class="line">            <span class="s2">"pizza_id"</span>: null,
</span><span class="line">            <span class="s2">"self"</span>: <span class="s2">"http://localhost:6543/api/toppings/14"</span>,
</span><span class="line">            <span class="s2">"updated_at"</span>: null
</span><span class="line">        <span class="o">}</span>,
</span><span class="line">        <span class="o">{</span>
</span><span class="line">            <span class="s2">"_score"</span>: 2.0254436,
</span><span class="line">            <span class="s2">"_type"</span>: <span class="s2">"Topping"</span>,
</span><span class="line">            <span class="s2">"_version"</span>: 0,
</span><span class="line">            <span class="s2">"description"</span>: null,
</span><span class="line">            <span class="s2">"id"</span>: 19,
</span><span class="line">            <span class="s2">"name"</span>: <span class="s2">"Cajun Chicken"</span>,
</span><span class="line">            <span class="s2">"pizza"</span>: null,
</span><span class="line">            <span class="s2">"pizza_id"</span>: null,
</span><span class="line">            <span class="s2">"self"</span>: <span class="s2">"http://localhost:6543/api/toppings/19"</span>,
</span><span class="line">            <span class="s2">"updated_at"</span>: null
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">]</span>,
</span><span class="line">    <span class="s2">"fields"</span>: <span class="s2">""</span>,
</span><span class="line">    <span class="s2">"start"</span>: 0,
</span><span class="line">    <span class="s2">"took"</span>: 3,
</span><span class="line">    <span class="s2">"total"</span>: 4
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, let’s make one last pizza by finding the ingredients. How about a vegetarian one this time?</p>

<p>Maybe a bit of spinach, ricotta, sun-dried tomato sauce, and a whole wheat crust. First we find our IDs (yours may be different)..</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http :6543/api/toppings?name<span class="o">=</span>spinach
</span><span class="line">...
</span><span class="line"><span class="s2">"id"</span>: 88,
</span><span class="line"><span class="s2">"name"</span>: <span class="s2">"Spinach"</span>,
</span><span class="line">...
</span><span class="line"><span class="nv">$ </span>http :6543/api/cheeses?name<span class="o">=</span>ricotta
</span><span class="line">...
</span><span class="line"><span class="s2">"id"</span>: 18,
</span><span class="line"><span class="s2">"name"</span>: <span class="s2">"Ricotta"</span>,
</span><span class="line">...
</span><span class="line"><span class="nv">$ </span>http :6543/api/sauces?name<span class="o">=</span>sun
</span><span class="line">...
</span><span class="line"><span class="s2">"id"</span>: 18,
</span><span class="line"><span class="s2">"name"</span>: <span class="s2">"Sun Dried Tomato"</span>,
</span><span class="line">...
</span><span class="line"><span class="nv">$ </span>http :6543/api/crusts?name<span class="o">=</span>whole
</span><span class="line">...
</span><span class="line"><span class="s2">"id"</span>: 13,
</span><span class="line"><span class="s2">"name"</span>: <span class="s2">"Whole Wheat"</span>,
</span><span class="line">...
</span></code></pre></td></tr></table></div></figure>


<p>Bake for 0 seconds, and..</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>http POST :6543/api/pizzas <span class="nv">name</span><span class="o">=</span><span class="s2">"Veggie Delight"</span> toppings:<span class="o">=[</span>88<span class="o">]</span> cheeses:<span class="o">=[</span>18<span class="o">]</span> <span class="nv">sauce</span><span class="o">=</span>18 <span class="nv">crust</span><span class="o">=</span>13
</span><span class="line">
</span><span class="line">HTTP/1.1 201 Created
</span><span class="line">Cache-Control: max-age<span class="o">=</span>0, must-revalidate, no-cache, no-store
</span><span class="line">Content-Length: 382
</span><span class="line">Content-Type: application/json<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
</span><span class="line">Date: Fri, 05 Jun 2015 20:17:26 GMT
</span><span class="line">Expires: Fri, 05 Jun 2015 20:17:26 GMT
</span><span class="line">Last-Modified: Fri, 05 Jun 2015 20:17:26 GMT
</span><span class="line">Location: http://localhost:6543/api/pizzas/2
</span><span class="line">Pragma: no-cache
</span><span class="line">Server: waitress
</span><span class="line">
</span><span class="line"><span class="o">{</span>
</span><span class="line">    <span class="s2">"data"</span>: <span class="o">{</span>
</span><span class="line">        <span class="s2">"_type"</span>: <span class="s2">"Pizza"</span>,
</span><span class="line">        <span class="s2">"_version"</span>: 0,
</span><span class="line">        <span class="s2">"cheeses"</span>: <span class="o">[</span>
</span><span class="line">            18
</span><span class="line">        <span class="o">]</span>,
</span><span class="line">        <span class="s2">"crust"</span>: 13,
</span><span class="line">        <span class="s2">"crust_id"</span>: 13,
</span><span class="line">        <span class="s2">"description"</span>: null,
</span><span class="line">        <span class="s2">"id"</span>: 2,
</span><span class="line">        <span class="s2">"name"</span>: <span class="s2">"Veggie Delight"</span>,
</span><span class="line">        <span class="s2">"sauce"</span>: 18,
</span><span class="line">        <span class="s2">"sauce_id"</span>: 18,
</span><span class="line">        <span class="s2">"self"</span>: <span class="s2">"http://localhost:6543/api/pizzas/2"</span>,
</span><span class="line">        <span class="s2">"toppings"</span>: <span class="o">[</span>
</span><span class="line">            88
</span><span class="line">        <span class="o">]</span>,
</span><span class="line">        <span class="s2">"updated_at"</span>: null
</span><span class="line">    <span class="o">}</span>,
</span><span class="line">    <span class="s2">"explanation"</span>: <span class="s2">""</span>,
</span><span class="line">    <span class="s2">"id"</span>: <span class="s2">"2"</span>,
</span><span class="line">    <span class="s2">"message"</span>: null,
</span><span class="line">    <span class="s2">"status_code"</span>: 201,
</span><span class="line">    <span class="s2">"timestamp"</span>: <span class="s2">"2015-06-05T20:17:26Z"</span>,
</span><span class="line">    <span class="s2">"title"</span>: <span class="s2">"Created"</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bon appétit!</p>

<p>Check out the full documentation for <a href="https://ramses.readthedocs.org/en/latest/">Ramses on Readthedocs</a>, and the somewhat more advanced <a href="https://github.com/brandicted/ramses-example">example project on Github</a>.</p>
</div>


      </div></body></html>