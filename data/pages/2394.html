<html><body><div><section class="entry-content ">
              <p>In this post I’ll describe the required steps to configure a <a href="https://www.djangoproject.com/" target="_blank">Django </a>Pyhton Application for <a href="http://www.cloudfoundry.org/" target="_blank">Cloud Foundry</a>.</p>
<h2><span>Cloud Foundry</span></h2>
<p><a href="http://www.cloudfoundry.org/" target="_blank">Cloud Foundry</a> (CF) is an open source Platform as a Service (PaaS) solution developed mainly by the company <a href="http://www.pivotal.io/" target="_blank">Pivotal</a>. Cloud Foundry is controlled by the Cloud Foundry Foundation where, among others,EMC, VMware, IBM and SAP are members.<br/>
Similar to Open Stack there are commercial products of Cloud Foundry like <a href="http://run.pivotal.io/" target="_blank">Pivotal Web Services</a>, <a href="http://www.pivotal.io/platform-as-a-service/pivotal-cf" target="_blank">Pivotal CF</a> and <a href="http://bluemix.net/" target="_blank">IBM Bluemix</a>.</p>
<h2><span><span>Pivotal Web Services</span></span></h2>
<p>For my tests I used the Pivotal Web Services (PWS). It is Pivotal’s public cloud offering for Cloud Foundry. PWS is running the elastic runtime on Amazon Webservices (AWS) and services in the marketplace are provided by other public cloud offerings. Service are things like databases, PostgresSQL provided by <a href="http://www.elephantsql.com/" target="_blank">ElephantSQL</a>, application monitoring, <a href="http://newrelic.com/" target="_blank">New Relic</a>, message broker, RabbitMQ provided by <a href="https://www.cloudamqp.com/" target="_blank">CloudAMQP</a>, and more:</p>

<p/>
<p/>
<p>You can get a 60 Day free trial for <a href="http://run.pivotal.io/" target="_blank">PWS</a>. All of the above services also offer a free service plan for limited usage. For my example I leveraged ElephantSQL and New Relic. How to use New Relic will be described in a later post.</p>
<h2><span><span>Python Buildpack</span></span></h2>
<p><a href="http://docs.cloudfoundry.org/buildpacks/" target="_blank">Buildpacks </a>provide framework and runtime support for your applications. Currently Cloud Foundry provides buildpacks for <a href="https://github.com/cloudfoundry/go-buildpack" target="_blank">Go</a>, <a href="https://github.com/cloudfoundry/java-buildpack" target="_blank">Java</a>, <a href="https://github.com/cloudfoundry/nodejs-buildpack" target="_blank">Node.js</a>, <a href="https://github.com/cloudfoundry/php-buildpack" target="_blank">PHP</a>, <a href="https://github.com/cloudfoundry/ruby-buildpack" target="_blank">Ruby</a> and <a href="https://github.com/cloudfoundry/python-buildpack" target="_blank">Python</a>. All buildpacks, beside the Java one, are based on Heroku buildpacks. <a href="https://www.heroku.com/" target="_blank">Heroku </a>is also a platform as a service (PaaS) but not based on Cloud Foundry. It is also possible that you create your own buildpack or e.g. use one that is shared on GitHub.</p>
<h2><span><span>Environment Variables</span></span></h2>
<p>The biggest difference between CF and Heroku is, which made me struggle, how they differently handles environment variables to inject information, like database connection information, into the container at runtime.<br/>
For example does Heroku add an environment variable (config var) “DATABASE_URL” for the database connection string (e.g. “postgres://foo:foo@heroku.com:5432/hellodb”) or “NEW_RELIC_LICENSE_KEY” for the new relic license key.<br/>
In contrary does Cloud Foundy add an environment variable “VCAP_SERVICES”, which is formatted in JSON, and stores all information for connected services. Cloud Foundry also offers the ability to create custom environment variables additionally . These variables can store any kind of strings.<br/>
Here is an example for a VCAP_SERVICES variable containing information for PostgreSQL and New Relic:</p>

		<div id="crayon-56d59909baa9f051104568" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-2">2</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-4">4</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-6">6</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-8">8</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-10">10</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-12">12</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-14">14</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-16">16</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-18">18</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-20">20</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-22">22</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-24">24</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-26">26</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-28">28</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-30">30</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59909baa9f051104568-32">32</p><p class="crayon-num" data-line="crayon-56d59909baa9f051104568-33">33</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baa9f051104568-1"><span class="crayon-sy">{</span><span class="crayon-h">  </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-2"><span class="crayon-h">   </span><span class="crayon-s">"elephantsql"</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-h">  </span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-3"><span class="crayon-h">      </span><span class="crayon-sy">{</span><span class="crayon-h">  </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-4"><span class="crayon-h">         </span><span class="crayon-s">"name"</span><span class="crayon-o">:</span><span class="crayon-s">"name"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-5"><span class="crayon-h">         </span><span class="crayon-s">"label"</span><span class="crayon-o">:</span><span class="crayon-s">"elephantsql"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-6"><span class="crayon-h">         </span><span class="crayon-s">"tags"</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-h">  </span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-7"><span class="crayon-h">            </span><span class="crayon-s">"New Product"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-8"><span class="crayon-h">            </span><span class="crayon-s">"Data Stores"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-9"><span class="crayon-h">            </span><span class="crayon-s">"relational"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-10"><span class="crayon-h">            </span><span class="crayon-s">"Data Store"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-11"><span class="crayon-h">            </span><span class="crayon-s">"postgresql"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-12"><span class="crayon-h">         </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-13"><span class="crayon-h">         </span><span class="crayon-s">"plan"</span><span class="crayon-o">:</span><span class="crayon-s">"turtle"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-14"><span class="crayon-h">         </span><span class="crayon-s">"credentials"</span><span class="crayon-o">:</span><span class="crayon-sy">{</span><span class="crayon-h">  </span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-15"><span class="crayon-h">            </span><span class="crayon-s">"uri"</span><span class="crayon-o">:</span><span class="crayon-s">"postgres://rccmcbbt:f28JL8sfsdfdsfsdsezqZm4xk@babar.elephantsql.com:5432/rccmcbbt"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-16"><span class="crayon-h">            </span><span class="crayon-s">"max_conns"</span><span class="crayon-o">:</span><span class="crayon-s">"5"</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-17"><span class="crayon-h">         </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-18"><span class="crayon-h">      </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-19"><span class="crayon-h">   </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-20"><span class="crayon-h">   </span><span class="crayon-s">"newrelic"</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-h">  </span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-21"><span class="crayon-h">      </span><span class="crayon-sy">{</span><span class="crayon-h">  </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-22"><span class="crayon-h">         </span><span class="crayon-s">"name"</span><span class="crayon-o">:</span><span class="crayon-s">"newrelic"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-23"><span class="crayon-h">         </span><span class="crayon-s">"label"</span><span class="crayon-o">:</span><span class="crayon-s">"newrelic"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-24"><span class="crayon-h">         </span><span class="crayon-s">"tags"</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-h">  </span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-25"><span class="crayon-h">            </span><span class="crayon-s">"Monitoring"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-26"><span class="crayon-h">         </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-27"><span class="crayon-h">         </span><span class="crayon-s">"plan"</span><span class="crayon-o">:</span><span class="crayon-s">"standard"</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-28"><span class="crayon-h">         </span><span class="crayon-s">"credentials"</span><span class="crayon-o">:</span><span class="crayon-sy">{</span><span class="crayon-h">  </span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-29"><span class="crayon-h">            </span><span class="crayon-s">"licenseKey"</span><span class="crayon-o">:</span><span class="crayon-s">"7251234dd1d1a3453dg90f5879e2d823"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-30"><span class="crayon-h">         </span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-31"><span class="crayon-h">      </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baa9f051104568-32"><span class="crayon-h">   </span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59909baa9f051104568-33"><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>There has to be a “but” – it seems there is one exception in Cloud Foundry. Beside the “VCAP_SERVICES” environment variable CF is creating a “DATABASE_URL” variable based on the “VCAP_SERVICES” one. Sadly I haven’t found any documentation for the Python buildpack but the variable is mentioned in the <a href="http://docs.cloudfoundry.org/buildpacks/ruby/ruby-service-bindings.html" target="_blank">documentation for the Ruby buildpack</a>.<br/>
In a later post I will describe how to handle the missing “NEW_RELIC_LICENSE_KEY” for the New Relic configuration.</p>
<h2><span>Configuration files</span></h2>
<p>The Python buildpack needs a couple of files to be present in the root folder of your Python application. These are namely: “runtime.txt”, “requirements.txt”  and “Procfile”</p>
<p>The “runtime.txt” specifies which version of Python should be loaded. A list of supported runtimes can be found on <a href="https://github.com/cloudfoundry/python-buildpack/tree/master/builds/runtimes" target="_blank">GitHub</a>.</p>
<p>runtime.txt:</p>

		

<p>The “requirements.txt” specifies which Python models should be installed by “pip”. The content of this file can be generated by using</p>

		<div id="crayon-56d59909baab5800034751" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baab5800034751-1"><span class="crayon-e">pip </span><span class="crayon-v">freeze</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">requirements</span><span class="crayon-e">.txt</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>requirements.txt:</p>

		<div id="crayon-56d59909baaba204582979" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baaba204582979-1"><span class="crayon-v">Django</span><span class="crayon-o">==</span><span class="crayon-cn">1.7.1</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baaba204582979-2"><span class="crayon-v">WhiteNoise</span><span class="crayon-o">==</span><span class="crayon-cn">1.0.4</span></p><p class="crayon-line" id="crayon-56d59909baaba204582979-3"><span class="crayon-v">gunicorn</span><span class="crayon-o">==</span><span class="crayon-cn">19.1.1</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baaba204582979-4"><span class="crayon-v">psycopg2</span><span class="crayon-o">==</span><span class="crayon-cn">2.5.4</span></p><p class="crayon-line" id="crayon-56d59909baaba204582979-5"><span class="crayon-v">dj</span><span class="crayon-o">-</span><span class="crayon-v">database</span><span class="crayon-o">-</span><span class="crayon-v">url</span><span class="crayon-o">==</span><span class="crayon-cn">0.3.0</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The most obvious package we are loading is <a href="https://github.com/django/django" target="_blank">Django</a>, our Python Web framework. <a href="https://github.com/evansd/whitenoise" target="_blank">WhiteNoise</a> is used to serve static files and <a href="https://github.com/gunicorn/gunicorn" target="_blank">Gunicorn</a> is used as our Python WSGI HTTP Server. For the Python PostgreSQL adapter I use <a href="https://github.com/psycopg/psycopg2" target="_blank">Psycopg2</a>. And finally <a href="https://github.com/kennethreitz/dj-database-url" target="_blank">dj-database-url</a> is used to simplify the usage of the “DATABASE_URL” environment variable in the Django “settings.py”.<br/>
If you want to use a MySQL database you will have to replace psycopg2 with <a href="https://github.com/PyMySQL/mysqlclient-python" target="_blank">mysqlclient</a> “mysqlclient==1.3.4” (supports Python 3).</p>
<p>The third and last file “Procfile” is used to define what should be started in the instance.</p>
<p>Procfile:</p>

		<div id="crayon-56d59909baac0116266982" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baac0116266982-1"><span class="crayon-v">web</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">gunicorn </span><span class="crayon-v">myapp</span><span class="crayon-sy">.</span><span class="crayon-v">wsgi</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-i">workers</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This “Procfile” is going to start the python application “myapp” using gunicorn with two workers. “myapp”  will have to be replaced by the name of your application.</p>
<h2><span><span>Django configuration for Cloud Foundry</span></span></h2>
<p>Before we are able to publish our django application to Cloud Foundry we have to modify “settings.py” to use the “DATABASE_URL” for the database configuration and the “static” variables to use WhiteNose for serving our static files.</p>
<p>settings.py:</p>

		<div id="crayon-56d59909baac5441933857" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baac5441933857-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">dj_database_url</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baac5441933857-2"><span class="crayon-v">DATABASES</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'default'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">dj_database_url</span><span class="crayon-sy">.</span><span class="crayon-e">config</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56d59909baac5441933857-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baac5441933857-4"><span class="crayon-v">STATIC_URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'/static/'</span></p><p class="crayon-line" id="crayon-56d59909baac5441933857-5"><span class="crayon-v">STATIC_ROOT</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os.path</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">BASE_DIR</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'staticfiles'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baac5441933857-6"><span class="crayon-v">STATICFILES_STORAGE</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'whitenoise.django.GzipManifestStaticFilesStorage'</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The function “dj_database_url.config()” loads the “DATABASE_URL” and transforms it into the django format for configuring the database setttings.<br/>
Please note that the buildpack will automatically run “<a href="https://docs.djangoproject.com/en/1.7/ref/contrib/staticfiles/" target="_blank">manage.py collectstatic</a>” to collect the static files from all of your applications.</p>
<p>“wsgi.py” has to be modified to use WhiteNose for serving our static files. Please make sure that you replace “myapp.settings” with the name of your application.</p>
<p>wsgi.py:</p>

		<div id="crayon-56d59909baaca821987898" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baaca821987898-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baaca821987898-2"><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">setdefault</span><span class="crayon-sy">(</span><span class="crayon-s">"DJANGO_SETTINGS_MODULE"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"myapp.settings"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59909baaca821987898-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baaca821987898-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">whitenoise</span><span class="crayon-sy">.</span><span class="crayon-e">django </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">DjangoWhiteNoise</span></p><p class="crayon-line" id="crayon-56d59909baaca821987898-5"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">core</span><span class="crayon-sy">.</span><span class="crayon-e">wsgi </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">get_wsgi_application</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baaca821987898-6"> </p><p class="crayon-line" id="crayon-56d59909baaca821987898-7"><span class="crayon-v">application</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_wsgi_application</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baaca821987898-8"><span class="crayon-v">application</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DjangoWhiteNoise</span><span class="crayon-sy">(</span><span class="crayon-v">application</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Once the application is deployed to Cloud Foundry, which I’ll show in a minute, we need to create the database tables and the admin user. On heroku you can simply use the heroku cli to run any command in an “<a href="https://devcenter.heroku.com/articles/one-off-dynos" target="_blank">One-Off Dyno</a>“. Cloud Foundry currently does not support a way to run a shell command in an easy way. The only option is to run once a custom script, instead of using the “Procfile”, the first time you push your application to Cloud Foundry.</p>
<p>init_db.sh:</p>

		<div id="crayon-56d59909baacf053792334" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baacf053792334-1"><span class="crayon-p">#!/bin/sh</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baacf053792334-2"><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-s">"------ Create database tables ------"</span></p><p class="crayon-line" id="crayon-56d59909baacf053792334-3"><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-v">migrate</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">noinput</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baacf053792334-4"> </p><p class="crayon-line" id="crayon-56d59909baacf053792334-5"><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-s">"------ create default admin user ------"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baacf053792334-6"><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-s">"from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@myapp.local', 'Passw0rd')"</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-e">shell</span></p><p class="crayon-line" id="crayon-56d59909baacf053792334-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baacf053792334-8"><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-s">"------ starting gunicorn &amp;nbsp;------"</span></p><p class="crayon-line" id="crayon-56d59909baacf053792334-9"><span class="crayon-e">gunicorn </span><span class="crayon-v">myapp</span><span class="crayon-e">.wsgi</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-i">workers</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This short bash script will create the database tables and create a default admin user with password ‘Passw0rd’</p>
<h2><span>Push Django App to Cloud Foundry</span></h2>
<p>The last and fun part is to push the application to Cloud Foundry. To be able to push an application easier we create a manifest file which describes the application.</p>
<p>manifest.yml:</p>

		<div id="crayon-56d59909baad5966403214" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baad5966403214-1"><span class="crayon-o">--</span><span class="crayon-o">-</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baad5966403214-2"><span class="crayon-v">applications</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59909baad5966403214-3"><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">cf</span><span class="crayon-o">-</span><span class="crayon-e">dango</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baad5966403214-4"><span class="crayon-e">  </span><span class="crayon-v">instances</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></p><p class="crayon-line" id="crayon-56d59909baad5966403214-5"><span class="crayon-h">  </span><span class="crayon-v">memory</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">128M</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baad5966403214-6"><span class="crayon-h">  </span><span class="crayon-v">command</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">null</span></p><p class="crayon-line" id="crayon-56d59909baad5966403214-7"><span class="crayon-h">  </span><span class="crayon-v">services</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baad5966403214-8"><span class="crayon-h">  </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">cf</span><span class="crayon-o">-</span><span class="crayon-v">django</span><span class="crayon-o">-</span><span class="crayon-v">pgsql</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We give our application a name, how many instances we want to start, its memory requirement and lastly the name of our database service which we want to bind.</p>
<p>Finally we are ready to push our application using the <a href="https://github.com/cloudfoundry/cli/releases" target="_blank">Cloud Foundy CLI</a>.</p>
<p>Commands:</p>

		<div id="crayon-56d59909baada472271755" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59909baada472271755-1"><span class="crayon-e">cf </span><span class="crayon-v">login</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">https</span><span class="crayon-o">:</span><span class="crayon-c">//api.run.pivotal.io</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baada472271755-2"><span class="crayon-e">cf </span><span class="crayon-v">create</span><span class="crayon-o">-</span><span class="crayon-e">service </span><span class="crayon-e">elephantsql </span><span class="crayon-e">turtle </span><span class="crayon-v">cf</span><span class="crayon-o">-</span><span class="crayon-v">django</span><span class="crayon-o">-</span><span class="crayon-e">pgsql</span></p><p class="crayon-line" id="crayon-56d59909baada472271755-3"><span class="crayon-e">cf </span><span class="crayon-v">push</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">no</span><span class="crayon-o">-</span><span class="crayon-v">route</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-s">"bash ./init_db.sh"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59909baada472271755-4"><span class="crayon-e">cf </span><span class="crayon-v">push</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>With the first command we login into the Pivotal Web Services. The command will ask you for your username and password. Next we create our PostgreSQL database. “elephantsql” is the name of the PostgreSQL service (see the picture of the service marketplace) and “turtle” is the name of the free plan.<br/>
If you deploy your app for the first time you will have to run our “init_db.sh” script once and then push your app again but without specifying the script.</p>
<p>Now your django application should successfully run on Cloud Foundry!!!</p>
<p>In one of the next posts I will describe the required steps to uses New Relic on Pivotal Web Services with Python.</p>
<h2><span><span>Example App on GitHub</span></span></h2>
<p>I published a very simple django app on GitHub, called “<a href="https://github.com/vchrisb/cf-vLab-event" target="_blank">cf-vLab-event</a>“. This app is already modified to run on Cloud Foundry and could help you as a starting point. If you successfully deployed the app to Pivotal Web Services it should look like this:</p>

		
		<div id="gallery-2" class="gallery galleryid-5 gallery-columns-3 gallery-size-thumbnail"><dl class="gallery-item">
			<dt class="gallery-icon landscape">
				<a class="grouped_elements" rel="tc-fancybox-group" href="https://banck.net/wp-content/uploads/2014/12/app_events.png" title="app_events"><img src="https://banck.net/wp-content/uploads/2014/12/app_events-270x250.png" class="attachment-thumbnail size-thumbnail" alt="PWS App Events"/></a>
			</dt>
				<dd class="wp-caption-text gallery-caption" id="gallery-2-318">
				PWS App Events
				</dd></dl><dl class="gallery-item">
			<dt class="gallery-icon landscape">
				<a class="grouped_elements" rel="tc-fancybox-group" href="https://banck.net/wp-content/uploads/2014/12/app_services.png" title="app_services"><img src="https://banck.net/wp-content/uploads/2014/12/app_services-270x250.png" class="attachment-thumbnail size-thumbnail" alt="PWS App Services"/></a>
			</dt>
				<dd class="wp-caption-text gallery-caption" id="gallery-2-322">
				PWS App Services
				</dd></dl><dl class="gallery-item">
			<dt class="gallery-icon landscape">
				<a class="grouped_elements" rel="tc-fancybox-group" href="https://banck.net/wp-content/uploads/2014/12/app_env_variables.png" title="app_env_variables"><img src="https://banck.net/wp-content/uploads/2014/12/app_env_variables-270x250.png" class="attachment-thumbnail size-thumbnail" alt="PWS App Environment Variables"/></a>
			</dt>
				<dd class="wp-caption-text gallery-caption" id="gallery-2-317">
				PWS App Environment Variables
				</dd></dl><dl class="gallery-item">
			<dt class="gallery-icon landscape">
				<a class="grouped_elements" rel="tc-fancybox-group" href="https://banck.net/wp-content/uploads/2014/12/app_routes.png" title="app_routes"><img src="https://banck.net/wp-content/uploads/2014/12/app_routes-270x250.png" class="attachment-thumbnail size-thumbnail" alt="PWS App Routes"/></a>
			</dt>
				<dd class="wp-caption-text gallery-caption" id="gallery-2-320">
				PWS App Routes
				</dd></dl><dl class="gallery-item">
			<dt class="gallery-icon landscape">
				<a class="grouped_elements" rel="tc-fancybox-group" href="https://banck.net/wp-content/uploads/2014/12/app_logs.png" title="app_logs"><img src="https://banck.net/wp-content/uploads/2014/12/app_logs-270x250.png" class="attachment-thumbnail size-thumbnail" alt="PWS App Logs"/></a>
			</dt>
				<dd class="wp-caption-text gallery-caption" id="gallery-2-319">
				PWS App Logs
				</dd></dl>
			
		</div>

                        </section>
                                            </div></body></html>