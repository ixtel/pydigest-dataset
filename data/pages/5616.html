<html><body><div><div class="post-text" itemprop="text">
<p>Here's a quote right from the Cheese Shop <a href="https://pypi.python.org/pypi/redis#connection-pools" rel="nofollow">page</a>.</p>

<blockquote>
  <p>Behind the scenes, redis-py uses a connection pool to manage connections to a Redis server. <strong>By default, each Redis instance you create will in turn create its own connection pool</strong>. You can override this behavior and use an existing connection pool by passing an already created connection pool instance to the connection_pool argument of the Redis class. You may choose to do this in order to implement client side sharding or have finer grain control of how connections are managed.</p>

<pre><code>pool = redis.ConnectionPool(host='localhost', port=6379, db=0)
r = redis.Redis(connection_pool=pool)
</code></pre>
</blockquote>

<p>Moreover, instances <a href="https://pypi.python.org/pypi/redis#thread-safety" rel="nofollow">are thread-safe</a>:</p>

<blockquote>
  <p>Redis client instances can safely be shared between threads. Internally, connection instances are only retrieved from the connection pool during command execution, and returned to the pool directly after. Command execution never modifies state on the client instance.</p>
</blockquote>

<p>You say:</p>

<p><em>So each task file has its own redis instance (which presumably is very expensive). ... For our system, we have over a dozen task files following this same pattern, and I've noticed our requests slowing down.</em></p>

<p>It's quite unlikely that several dozens of connections can slow down Redis server. But because your code, behind the scenes, use connection pool, the problem is somewhere out of connections per se. Redis is in-memory storage, thus very fast in most imaginable cases. So I would rather look for the problem in the tasks.</p>

<h1>Update</h1>

<p>From comment of @user3813256. Yes, he uses connection pool at task level. The normal way to utilize built-in connection pool of <code>redis</code> package is just share the connection. In simplest way, your <code>settings.py</code> may look like this:</p>

<pre><code>import redis

connection = None

def connect_to_redis():
    global connection
    connection = redis.StrictRedis(host='localhost', port=6379, db=0)
</code></pre>

<p>Then somewhere in bootstrapping of your application call <code>connect_to_redis</code>. Then use import <code>connection</code> in task modules.</p>
    </div>
    </div></body></html>