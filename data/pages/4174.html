<html><body><div><article id="post-442" class="post-442 post type-post status-publish format-standard hentry category-tutorials category-vision tag-opencv tag-python tag-vision"><header class="entry-header"><h1 class="entry-title">Detect faces in Google Hangouts video</h1> <span class="meta-date"><span class="meta-date-prep">Published on</span> <time datetime="2015-04-19T21:00:59+00:00">April 19, 2015</time></span> <span class="meta-author"><span class="author vcard"><span class="meta-author-prep">Author </span><a href="https://pythonspot.com/author/admin/" class="url fn n" title="View all posts by Frank">Frank</a></span></span><span class="meta-comments"><a href="https://pythonspot.com/detecti-faces-in-video/#comments" class="meta-comments-link">2 Comments</a></span></header><div class="entry-content"><figure id="attachment_449" class="wp-caption alignright"><a href="https://pythonspot.com/wp-content/uploads/2015/04/out3.gif"><img class="size-full wp-image-449" src="https://pythonspot.com/wp-content/uploads/2015/04/out3.gif" alt="OpenCV Face Detection"/></a><figcaption class="wp-caption-text">OpenCV Face Detection</figcaption></figure><p>In this tutorial you will learn how to apply face detection with Python. As input video we will use a Google Hangouts video. There are tons of Google Hangouts videos around the web and in these videos the face is usually large enough for the software to detect the faces.</p><p>Detection of faces is achieved using the OpenCV (Open Computer Vision) library. The most common face detection method is to <a href="http://docs.opencv.org/modules/objdetect/doc/cascade_classification.html#haar-feature-based-cascade-classifier-for-object-detection" target="_blank">extract cascades</a>. This technique is known to work well with face detection. You need to have the cascade files (included in OpenCV) in the same directory as your program.</p><p>To analyse the input video we extract each frame.  Each frame is shown for a brief period of time. Start with this basic program:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="python"><span>#! /usr/bin/python</span>
 
<span>import</span> cv2
 
vc <span>=</span> cv2.<span>VideoCapture</span><span>(</span><span>'video.mp4'</span><span>)</span>
c<span>=</span><span>1</span>
fps <span>=</span> <span>24</span>
 
<span>if</span> vc.<span>isOpened</span><span>(</span><span>)</span>:
    rval <span>,</span> frame <span>=</span> vc.<span>read</span><span>(</span><span>)</span>
<span>else</span>:
    rval <span>=</span> <span>False</span>
 
<span>while</span> rval:
    rval<span>,</span> frame <span>=</span> vc.<span>read</span><span>(</span><span>)</span>
    cv2.<span>imshow</span><span>(</span><span>"Result"</span><span>,</span>frame<span>)</span>
    cv2.<span>waitKey</span><span>(</span><span>1000</span> / fps<span>)</span><span>;</span>
vc.<span>release</span><span>(</span><span>)</span></pre></td></tr></table></div><p>Upon execution you will see the video played without sound. (OpenCV does not support sound).   We will display a rectangle on top of the face. To avoid flickering of the rectangle, we will show it at it latest known position if the face is not detected.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="python"><span>#! /usr/bin/python</span>
 
<span>import</span> cv2
 
face_cascade <span>=</span> cv2.<span>CascadeClassifier</span><span>(</span><span>'lbpcascade_frontalface.xml'</span><span>)</span>
vc <span>=</span> cv2.<span>VideoCapture</span><span>(</span><span>'video.mp4'</span><span>)</span>
 
<span>if</span> vc.<span>isOpened</span><span>(</span><span>)</span>:
    rval <span>,</span> frame <span>=</span> vc.<span>read</span><span>(</span><span>)</span>
<span>else</span>:
    rval <span>=</span> <span>False</span>
 
roi <span>=</span> <span>[</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>]</span>
 
<span>while</span> rval:
    rval<span>,</span> frame <span>=</span> vc.<span>read</span><span>(</span><span>)</span>
 
    <span># resize frame for speed.</span>
    frame <span>=</span> cv2.<span>resize</span><span>(</span>frame<span>,</span> <span>(</span><span>300</span><span>,</span><span>200</span><span>)</span><span>)</span> 
 
    <span># face detection.</span>
    faces <span>=</span> face_cascade.<span>detectMultiScale</span><span>(</span>frame<span>,</span> <span>1.8</span><span>,</span> <span>2</span><span>)</span>
    nfaces <span>=</span> <span>0</span>
    <span>for</span> <span>(</span>x<span>,</span>y<span>,</span>w<span>,</span>h<span>)</span> <span>in</span> faces:
        cv2.<span>rectangle</span><span>(</span>frame<span>,</span><span>(</span>x<span>,</span>y<span>)</span><span>,</span><span>(</span>x+w<span>,</span>y+h<span>)</span><span>,</span><span>(</span><span>0</span><span>,</span><span>0</span><span>,</span><span>255</span><span>)</span><span>,</span><span>2</span><span>)</span>
        nfaces <span>=</span> nfaces + <span>1</span>
        roi <span>=</span> <span>[</span>x<span>,</span>y<span>,</span>w<span>,</span>h<span>]</span>
 
    <span># undetected face, show old on position.         </span>
    <span>if</span> nfaces <span>==</span> <span>0</span>:
        cv2.<span>rectangle</span><span>(</span>frame<span>,</span><span>(</span>roi<span>[</span><span>0</span><span>]</span><span>,</span>roi<span>[</span><span>1</span><span>]</span><span>)</span><span>,</span><span>(</span>roi<span>[</span><span>0</span><span>]</span>+roi<span>[</span><span>2</span><span>]</span><span>,</span>roi<span>[</span><span>1</span><span>]</span>+roi<span>[</span><span>3</span><span>]</span><span>)</span><span>,</span><span>(</span><span>0</span><span>,</span><span>0</span><span>,</span><span>255</span><span>)</span><span>,</span><span>2</span><span>)</span>
 
    <span># show result</span>
    cv2.<span>imshow</span><span>(</span><span>"Result"</span><span>,</span>frame<span>)</span>
    cv2.<span>waitKey</span><span>(</span><span>1</span><span>)</span><span>;</span>
vc.<span>release</span><span>(</span><span>)</span></pre></td></tr></table></div><p>In this program we simply assumed there is one face in the video screen. We reduced the size of the screen to speed up the processing time. This is fine in most cases because detection will work fine in lower resolutions.  If you want to execute the face detection in “real time”, keeping the computational cycle short is mandatory. An alternative to this implementation is to process first and display later.</p><p>A limitation of this technique is that it does not always detect faces and faces that are very small or occluded may not be detected. It may show false positives such as a bag detected as face.  This technique works quite well on certain type of input videos.</p><p id="epoch-width-sniffer"/></div><footer class="entry-footer"> <span class="meta-categories"><span class="meta-categories-prep">Categories </span><a href="https://pythonspot.com/category/tutorials/" rel="category tag">Tutorials</a>, <a href="https://pythonspot.com/category/vision/" rel="category tag">Vision</a></span><span class="meta-tags"><span class="meta-tags-prep">Tags </span><a href="https://pythonspot.com/tag/opencv/" rel="tag">opencv</a>, <a href="https://pythonspot.com/tag/python/" rel="tag">python</a>, <a href="https://pythonspot.com/tag/vision/" rel="tag">vision</a></span></footer></article></div></body></html>