<html><body><div><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a id="user-content-django-mailviews" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#django-mailviews" aria-hidden="true"><span class="octicon octicon-link"/></a>django-mailviews</h1>
<p>Class-based email views for the Django framework, including a message previewer.</p>
<a href="https://travis-ci.org/disqus/django-mailviews"><img alt="https://travis-ci.org/disqus/django-mailviews.png?branch=master" src="https://camo.githubusercontent.com/3e31901b423e688b3d38ea0d1067064dd29f853a/68747470733a2f2f7472617669732d63692e6f72672f6469737175732f646a616e676f2d6d61696c76696577732e706e673f6272616e63683d6d6173746572" data-canonical-src="https://travis-ci.org/disqus/django-mailviews.png?branch=master"/></a>
<a name="user-content-introduction"/>
<h2>
<a id="user-content-introduction" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#introduction" aria-hidden="true"><span class="octicon octicon-link"/></a>Introduction</h2>
<p>Rendering and sending emails in Django can quickly become repetitive and
error-prone. By encapsulating message rendering within view classes, you can
easily compose messages in a structured and clear manner.</p>
<a name="user-content-basic-usage"/>
<h2>
<a id="user-content-basic-usage" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#basic-usage" aria-hidden="true"><span class="octicon octicon-link"/></a>Basic Usage</h2>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> mailviews.messages <span class="pl-k">import</span> TemplatedEmailMessageView

<span class="pl-c"># Subclass the `TemplatedEmailMessageView`, adding the templates you want to render.</span>
<span class="pl-k">class</span> <span class="pl-en">WelcomeMessageView</span>(<span class="pl-e">TemplatedEmailMessageView</span>):
    subject_template_name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>emails/welcome/subject.txt<span class="pl-pds">'</span></span>
    body_template_name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>emails/welcome/body.txt<span class="pl-pds">'</span></span>

<span class="pl-c"># Instantiate and send a message.</span>
message <span class="pl-k">=</span> WelcomeMessageView().send(<span class="pl-smi">extra_context</span><span class="pl-k">=</span>{
    <span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>: user,
}, <span class="pl-smi">to</span><span class="pl-k">=</span>(user.email,))</pre></div>
<p>This isn't actually the best pattern for sending messages to a user -- read the
notes under "Best Practices" for a better approach.</p>
<a name="user-content-using-the-preview-site"/>
<h2>
<a id="user-content-using-the-preview-site" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#using-the-preview-site" aria-hidden="true"><span class="octicon octicon-link"/></a>Using the Preview Site</h2>
<a name="user-content-registering-urls-and-enabling-discovery"/>
<h3>
<a id="user-content-registering-urls-and-enabling-discovery" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#registering-urls-and-enabling-discovery" aria-hidden="true"><span class="octicon octicon-link"/></a>Registering URLs and Enabling Discovery</h3>
<ul>
<li>Add <code>mailviews</code> to your project's <code>INSTALLED_APPS</code> setting.</li>
<li>Add the following somewhere within your project's <code>ROOT_URLCONF</code>:</li>
</ul>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> mailviews.previews <span class="pl-k">import</span> autodiscover, site

autodiscover()

urlpatterns <span class="pl-k">=</span> patterns(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>,
    url(<span class="pl-smi">regex</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-k">r</span><span class="pl-pds">'</span><span class="pl-k">^</span>emails/<span class="pl-pds">'</span></span>, <span class="pl-smi">view</span><span class="pl-k">=</span>site.urls),
)</pre></div>
<p>The preview index will now be available at the <code>emails/</code> URL.</p>
<a name="user-content-creating-preview-classes"/>
<h3>
<a id="user-content-creating-preview-classes" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#creating-preview-classes" aria-hidden="true"><span class="octicon octicon-link"/></a>Creating Preview Classes</h3>
<p>To create a simple preview, add a <code>emails.previews</code> submodule within one of your
<code>INSTALLED_APPS</code>, and create a new subclass of <code>Preview</code>.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> mailviews.previews <span class="pl-k">import</span> Preview, site
<span class="pl-k">from</span> example.emails.views <span class="pl-k">import</span> WelcomeMessageView

<span class="pl-c"># Define a new preview class.</span>
<span class="pl-k">class</span> <span class="pl-en">BasicPreview</span>(<span class="pl-e">Preview</span>):
    message_view <span class="pl-k">=</span> WelcomeMessageView

<span class="pl-c"># Register the preview class with the preview index.</span>
site.register(BasicPreview)</pre></div>
<p>You can see more detailed examples within the <a href="https://github.com/disqus/django-mailviews/blob/master/mailviews/tests/emails/previews.py">test suite</a>
or in the code documentation for <code>mailviews.previews</code>.</p>
<a name="user-content-customizing-preview-behavior"/>
<h3>
<a id="user-content-customizing-preview-behavior" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#customizing-preview-behavior" aria-hidden="true"><span class="octicon octicon-link"/></a>Customizing Preview Behavior</h3>
<p>You can also use Django forms to customize the creation of message previews by
adding a <code>form_class</code> attribute to your <code>Preview</code> subclasses. The form must
provide a <code>get_message_view_kwargs</code> method that returns a the keyword arguments
to be used when constructing the message view instance.</p>
<a name="user-content-best-practices"/>
<h2>
<a id="user-content-best-practices" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#best-practices" aria-hidden="true"><span class="octicon octicon-link"/></a>Best Practices</h2>
<ul>
<li>Try and avoid using the <code>extra_context</code> argument when sending emails.
Instead, create an <code>TemplatedEmailMessageView</code> subclass whose constructor accepts
as arguments all of the objects that you require to generate the context and
send the message. For example, the code shown in "Basic Usage" could written
instead as the following:</li>
</ul>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> mailviews.messages <span class="pl-k">import</span> TemplatedEmailMessageView

<span class="pl-k">class</span> <span class="pl-en">WelcomeMessageView</span>(<span class="pl-e">TemplatedEmailMessageView</span>):
    subject_template_name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>emails/welcome/subject.txt<span class="pl-pds">'</span></span>
    body_template_name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>emails/welcome/body.txt<span class="pl-pds">'</span></span>

    <span class="pl-k">def</span> <span class="pl-en"><span class="pl-c1">__init__</span></span>(<span class="pl-smi">self</span>, <span class="pl-smi">user</span>, *<span class="pl-smi">args</span>, **<span class="pl-smi">kwargs</span>):
        <span class="pl-c1">super</span>(WelcomeMessageView, <span class="pl-v">self</span>).__init__(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)
        <span class="pl-v">self</span>.user <span class="pl-k">=</span> user

    <span class="pl-k">def</span> <span class="pl-en">get_context_data</span>(<span class="pl-smi">self</span>, **<span class="pl-smi">kwargs</span>):
        context <span class="pl-k">=</span> <span class="pl-c1">super</span>(WelcomeMessageView, <span class="pl-v">self</span>).get_context_data(<span class="pl-k">**</span>kwargs)
        context[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-v">self</span>.user
        <span class="pl-k">return</span> context

    <span class="pl-k">def</span> <span class="pl-en">render_to_message</span>(<span class="pl-smi">self</span>, *<span class="pl-smi">args</span>, **<span class="pl-smi">kwargs</span>):
        <span class="pl-k">assert</span> <span class="pl-s"><span class="pl-pds">'</span>to<span class="pl-pds">'</span></span> <span class="pl-k">not</span> <span class="pl-k">in</span> kwargs  <span class="pl-c"># this should only be sent to the user</span>
        kwargs[<span class="pl-s"><span class="pl-pds">'</span>to<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> (<span class="pl-v">self</span>.user.email,)
        <span class="pl-k">return</span> <span class="pl-c1">super</span>(WelcomeMessageView, <span class="pl-v">self</span>).render_to_message(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)

<span class="pl-c"># Instantiate and send a message.</span>
WelcomeMessageView(user).send()</pre></div>
<p>In fact, you might find it helpful to encapsulate the above "message for a user"
pattern into a mixin or subclass that provides a standard abstraction for all
user-related emails. (This is left as an exercise for the reader.)</p>
<a name="user-content-testing-and-development"/>
<h2>
<a id="user-content-testing-and-development" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#testing-and-development" aria-hidden="true"><span class="octicon octicon-link"/></a>Testing and Development</h2>
<p>Tested on Python 2.6, 2.7 and 3.4 (where supported by Django) and Django
versions 1.3 through 1.8. (For specific versions supported, see the Travis or
Tox build matrices.) To run tests against the entire build matrix locally, run
<code>make test-matrix</code> (or <code>tox</code>, if already installed.)</p>
<a name="user-content-development"/>
<h3>
<a id="user-content-development" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#development" aria-hidden="true"><span class="octicon octicon-link"/></a>Development</h3>
<p>To install the project in development mode, run:</p>

<p>This installs dependencies, as well as builds static assets.</p>
<a name="user-content-testing"/>
<h3>
<a id="user-content-testing" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#testing" aria-hidden="true"><span class="octicon octicon-link"/></a>Testing</h3>
<p>To run the test suite against your installed Django version, run:</p>
<div class="highlight highlight-source-shell"><pre>python -m mailviews.tests</pre></div>
<p>To view an example preview site, you can start a test server by running:</p>
<div class="highlight highlight-source-shell"><pre>python -m mailviews.tests.manage runserver</pre></div>
<a name="user-content-integration-with-third-party-applications"/>
<h4>
<a id="user-content-integration-with-third-party-applications" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#integration-with-third-party-applications" aria-hidden="true"><span class="octicon octicon-link"/></a>Integration with Third-Party Applications</h4>
<p>All tests will automatically be run using the Django test runner when you run
the tests for your own projects if you use <code>python manage.py test</code> and
<code>mailviews</code> is within your <code>settings.INSTALLED_APPS</code>.</p>
<a name="user-content-coverage"/>
<h3>
<a id="user-content-coverage" class="anchor" href="https://github.com/disqus/django-mailviews/blob/master/#coverage" aria-hidden="true"><span class="octicon octicon-link"/></a>Coverage</h3>
<p>To generate a Coverage report using <a href="https://pypi.python.org/pypi/coverage/">coverage.py</a>, run:</p>
<div class="highlight highlight-source-shell"><pre>coverage run --source=. -m mailviews.tests</pre></div>

</article></div></body></html>