<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-baredroid" class="anchor" href="#baredroid" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><strong>BareDroid</strong></h1>

<p>BareDroid allows for bare-metal analysis on Android devices. See the paper (#)[here]</p>

<h2><a id="user-content-folders" class="anchor" href="#folders" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Folders</h2>

<p><strong>backup</strong>: used to create a backup of the device. It is a bash script which stores a copy of:</p>

<ul>
<li>userdata</li>
<li>system</li>
<li>boot 
in the <em>store</em> partition (partition number 30). This is needed only when you want to setup a new device.</li>
</ul>

<p><strong>restore</strong>: used to restore a previous backup. It is a bash script which restore a) system, b) userdata and c) userdatanew partition.</p>

<p><strong>backup_and_restore</strong>: used to create a backup and restore it. It is a merge of the previous scripts.</p>

<p><strong>setup_device</strong>:</p>

<ul>
<li>  setup: used to setup a device. Basically, this script creates the new partitions;</li>
</ul>

<hr/>

<p><strong>update</strong>: contains the python scripts used to manage the infrastructure.</p>

<ul>
<li>  adb.py: provides APIs used to send command through adb shell;</li>
<li>  device.py: contains information about the update_manager associated to the device (deprecated, not used in the next version);</li>
<li>  analysis.py: it bridges the gap between the infrastructure and the experiments. For a detailed description see below;</li>
<li>  util.py: provides utilities (deprecated);</li>
<li>  manager.py: manages the command line interface;</li>
<li>  updtae_manager.py: it is the core of the infrastructure. It is a separate process which manages the update and analysis process;</li>
<li>  update_manager_device.py: represents a separate process used to update the device during the analysis;</li>
<li>  update_manager_recovery.py: represents a separate process used to update the device during the reboot. it is used to perform a relabel of the userdata partition ( SELinux :) );</li>
</ul>

<p><strong>update/config</strong>: contains cfg and info files used to setup the python scripts.</p>

<ul>
<li>  config.cfg: contains the information about where to save the logs, and which scripts use to perform the analysis</li>
<li>  devices.info: contains general information about the devices (e.g., user, AndroidId)</li>
</ul>

<h2><a id="user-content-how-to-backup" class="anchor" href="#how-to-backup" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to backup</h2>

<ol>
<li> connect the device</li>
<li> run the "./script" file (the script reboots the device in recovery mode and run the script)</li>
<li> reboot the device</li>
</ol>

<h2><a id="user-content-how-to-restore" class="anchor" href="#how-to-restore" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to restore</h2>

<ol>
<li>connect the device</li>
<li>run the "./script" file (the script reboots the device in recovery mode and run the script)</li>
<li>reboot the device</li>
</ol>

<h2><a id="user-content-analysis-script" class="anchor" href="#analysis-script" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Analysis script</h2>

<p>The goal of this script is to provide a wrapper between the experiment and the infrastructure, <em>SetupAndStart</em> is the main method and the only one called by the infrastructure (i.e., update_manager.py line 178). It setups the environment for the experiment (e.g., adb root) and run the experiment.
If you want to use your code in an experiment you need to:
1.  modify the config.cfg file. In the stanza 'Project' put the absolute path to the code that you want to use;
2.  create an python script containing the class used in the stanza 'class' of the config.cfg file;
3.  define a 'run' method in the config.cfg file. This is the method used by the wrapper to start the experiment.</p>

<h2><a id="user-content-how-to-add-a-new-device-to-the-infrastructure" class="anchor" href="#how-to-add-a-new-device-to-the-infrastructure" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>how to add a new device to the infrastructure</h2>

<ol>
<li> see 'setup_device';</li>
<li> run the backup and restore scripts;</li>
<li> add info to the 'update/config/device.info' file (e.g., AndroidId); [mandatory]</li>
</ol>

<p>general consideration:</p>

<ol>
<li> device -&gt; Settings -&gt; Storage -&gt; USB computer connection -&gt; disable  MTP</li>
<li> device -&gt; Security -&gt; Screen lock -&gt; None</li>
<li> be sure you can install untrusted app (i.e., from outside the market)</li>
</ol>

<h2><a id="user-content-how-to-run-an-experiment" class="anchor" href="#how-to-run-an-experiment" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to run an experiment</h2>

<p>Architectural overview:</p>

<p><a href="https://camo.githubusercontent.com/c07cd57c0e567c6449792f32730c88c7c3f7cd56/68747470733a2f2f646f63732e676f6f676c652e636f6d2f64726177696e67732f642f31555861516b46456c4d6475615a636b626369637a337a6c6f447a39534f41356161705f43563046464d68512f7075623f773d34363526616d703b683d323539" target="_blank"><img src="https://camo.githubusercontent.com/c07cd57c0e567c6449792f32730c88c7c3f7cd56/68747470733a2f2f646f63732e676f6f676c652e636f6d2f64726177696e67732f642f31555861516b46456c4d6475615a636b626369637a337a6c6f447a39534f41356161705f43563046464d68512f7075623f773d34363526616d703b683d323539" alt="alt tag" data-canonical-src="https://docs.google.com/drawings/d/1UXaQkFElMduaZckbcicz3zloDz9SOA5aap_CV0FFMhQ/pub?w=465&amp;amp;h=259"/></a></p>

<ol>
<li> to run an experiment you need to include the absolute path of the folder containing the samples to analyze;</li>
<li> run the manager start script against the folder containing the apps to analyze;</li>
</ol>

<p>example</p>

<pre><code>./start_baredroid path/to/folder/containing/samples
</code></pre>

<ol>
<li> the script will prompt a command line interface which allows the user to interact with the infrastructure (e.g., start experiment);</li>
<li> select option '2' to run the experiment;</li>
<li> when the experiment is finished click on 'q';</li>
<li> the results are stored in the 'update/experiment' folder.</li>
</ol>

<hr/>

<p><em>email:</em> <a href="mailto:simone.mutti@unibg.it">simone.mutti@unibg.it</a></p>
</article>
  </div></body></html>