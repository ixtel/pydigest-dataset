<html><body><div><div class="entry-content">
		<div data-shortcode="caption" id="attachment_911" class="wp-caption aligncenter"><a href="https://impythonist.files.wordpress.com/2014/12/google-datacenter-tech-13.jpg"><img class="wp-image-911 size-full" src="https://impythonist.files.wordpress.com/2014/12/google-datacenter-tech-13.jpg?w=1000" alt=""/></a><p class="wp-caption-text">Google data center clusters</p></div>
<h2 id="toc_0">What is Parallel  Processing?</h2>
<p>Parallel processing is the simultaneous use of more than one <a title="Central processing unit" href="http://en.wikipedia.org/wiki/Central_processing_unit">CPU</a> or processor core to execute a program or multiple computational threads. Ideally, parallel processing makes programs run faster because there are more engines (CPUs or cores) running it. In practice, it is often difficult to divide a program in such a way that separate CPUs or cores can execute different portions without interfering with each other. Most computers have just one CPU, but some models have several, and <a class="mw-redirect" title="Multi-core" href="http://en.wikipedia.org/wiki/Multi-core">multi-core</a> processor chips are becoming the norm. There are even computers with thousands of CPUs. After reading that weird Wikipedia definition, what are you thinking?. The same stuff repeated in our ears for years.We all know the core concepts,but coming to implementation we take step lazily.There are many reasons for that. In this post we are going to understand the basic concepts of parallel processing,distributed computing and jump start to a hands-on example for implementing them.</p>
<h2 id="toc_0">Why parallel Processing?</h2>
<p>Assume that you have a very popular website,it has a web Fibonacci calculator.If everything is processed sequentially the requests from users are stored in a Queue and program calculates Fibonacci no and return it to user.If website got 80000 requests and calculating sequentially causes waiting of last submitted user.His reload bar will rotate for ever.How all e-commerce websites are serving the customers with light speed spontaneously?. They use parallelization techniques.Learn how to use it,implement straight away in your programmes.</p>
<h2 id="toc_0"> Let’s begin the show</h2>
<p><a href="https://impythonist.files.wordpress.com/2014/12/selection_025.png"><img class="  aligncenter wp-image-883 " src="https://impythonist.files.wordpress.com/2014/12/selection_025.png?w=518&amp;h=189" alt=""/></a> The parallel program is the program that is distributed among various process,they in turn given to the cores of the processor to execute. Take a look at smallest parallel computing illustration here.It is multiplying a scalar to a matrix.Multiplication is done by sequentially multiplying scalar to each element.But in parallel computing each element is divided as a unit,and workers are allocated with tasks of multiplying scalar to that element unit.This big task is distributed to 4 processes. <a href="https://impythonist.files.wordpress.com/2014/12/selection_022.png"><img class="aligncenter size-full wp-image-884" src="https://impythonist.files.wordpress.com/2014/12/selection_022.png?w=1000&amp;h=583" alt="Selection_022"/></a></p>
<h2 id="toc_0">Patterns for designing parallel structures</h2>
<p>The criteria for designing a pattern for a parallel problem depends on the context of problem itself.The no of workers to be dispatched,no of cores to be used all this factors are dealt with taking main problem into consideration.But here we are going to see a universal pattern for parallel computing problems.</p>
<h2 id="toc_0">Pipeline concept</h2>
<p>This concept is so simple.A task is processed in different stages.many no of workers are present in the each stage.At stage 1,workers 1 process the data,next it goes to stage 2 etc. <a href="https://impythonist.files.wordpress.com/2014/12/selection_026.png"><img class="aligncenter size-full wp-image-885" src="https://impythonist.files.wordpress.com/2014/12/selection_026.png?w=1000" alt="Selection_026"/></a> It is like an assembly line shown in Discovery and NatGeo shows of car manufacturing.In that a car chassis  will be sent to the next stage in which multiple robotic hands paint body at a time,next it moves to another stage in which another set of robotic workers fix the bolts etc. <a href="https://impythonist.files.wordpress.com/2014/12/assembly_line_050614.jpg"><img class="aligncenter size-full wp-image-889" src="https://impythonist.files.wordpress.com/2014/12/assembly_line_050614.jpg?w=1000&amp;h=625" alt="Bayerische Motoren Werke AG Unveil Their Latest Mini Automobile"/></a></p>
<h2 id="toc_0">Analyzing best python tools for implementing parallelism</h2>
<p>There are four ways for achieving concurrent processing in python. 1) threading and concurrent.features 2) multiprocessing and ProcessPoolExecutor 3) Parallel Python 4) Celery First two tools are available as built in libraries.Next two are external libraries that do most of the job behind the screens.threading solution to a parallel problem is not preferable since,synchronization mechanisms need to be carefully implemented.In this post we are making things simple and clear.No locks,no synchronization techniques.Just execute a program in a parallel way.</p>
<h2 id="toc_0">Parallel Python, a wonderful ,simple,cool library for parallel as well as distributed computing</h2>
<p>If you installed Parallel Python,it is fine.Other wise just open your terminal and install it by downloading compressed file,extract and running setup.py.compressed files available here. <a href="http://www.parallelpython.com/content/view/18/32/" rel="nofollow">http://www.parallelpython.com/content/view/18/32/</a> After pp is successfully installed, we are going to build a great practical example to illustrate parallel processing using Parallel Python library,which is a very good tool.</p>
<h2 id="toc_0">What Parallel Python can do?</h2>
<p>The most important advantage of using PP is the abstraction that this module provides. Some important features of PP are as follows: •     Automatic detection of number of processors to improve load balance •     Many processors allocated can be changed at runtime •     Load balance at runtime •     Auto-discovery resources throughout the network</p>
<h2 id="toc_0">Parallel Python basics</h2>
<p>Just we need to create a Server from pp next use submit method of that instance to submit tasks for multiple processes.</p>
<pre class="python highlighted_source">import pp

#Server encapsulates and dispatches task to multiple processes
s = pp.Server()

#Server can also be started with multiple cores and other distributed systems

s = pp.Server(ncpus=4,ppservers = ("192.168.25.21", "192.168.25.9"))

# ncpus =&gt; no of cores to use, ppservers = Ip's_of_computers_conected_as_cluster
#There is one important function called submit for adding tasks to processes.

"""
submit(self, func, args=(), depfuncs=(), modules=(),
callback=None, callbackargs=(), group='default',
globals=None)

func -&gt; target function to be executed,
args -&gt; arguments to be passed for func,
modules -&gt; list of packages to be imported by func to do it's function
callback -&gt;A function to which result of func will be returned,we can process results here,like sending computed values as response to user
"""
#For exmaple see this submit call below.
s.submit(fibo_task, (item,), modules=('os',),
callback=aggregate_results)

</pre>
<p>with these basics let us solve a real world problem.</p>
<h2 id="toc_0">Problem ( calculate greater circle distance )</h2>
<p>I created a popular website for getting greater circle distance and I need to process 80000 requests.It means the data entered by users should be processed i.e results are computed concurrently. What is greater circle distance?. It is the distance between two locations on earth.Location is a tuple of (latitude,longitude). Calculating greater circle distance uses a formula called Haversine formula.Don’t be panic by seeing big terms.It is a function that returns distance if two locations are given as arguments.</p>
<pre class="python highlighted_source"><span class="kw1">import</span> math

#This is a function.Don't bother it's contents 

def haversine(key,lat1, lon1, lat2, lon2):
    R = 6372.8 # Earth radius in kilometers
    dLat = math.radians(lat2 - lat1)
    dLon = math.radians(lon2 - lon1)
    lat1 = math.radians(lat1)
    lat2 = math.radians(lat2)
    a = math.sin(dLat/2)**2 + math.cos(lat1) * math.cos(lat2) * math.sin(dLon/2)**2
    c = 2* math.asin(math.sqrt(a))
    #calculating KM
    a = R * c
    return a</pre>
<p>Think this way.haversine function takes lat1,lon1 and lat2,lan2 and return Greater circle distance.For example we have California(37.0000° N, 120.0000° W) and New Jersey(40.0000° N, 74.5000° W).If we want to find distance between California and New Jersey then use above function as distance_ca_nj = haversine(37.0000,120.0000,40.0000,74.0000) #Gives us distance between California and New jersey in KM.</p>
<h2 id="toc_0">How to make haversine function execute in parallel fashion</h2>
<p>Here I am using four inputs from users,we can extend it to any no of inputs and make them run concurrently.</p>
<pre class="python highlighted_source"><span class="kw1">import os, pp

users={'california_to_newJersey' : (37.0000,120.0000,40.0000,74.0000),
'oklahoma_to_texas' : (35.5000, 98.0000,31.0000, 100.0000),
'arizona_to_kansas' : (34.0000, 112.0000,38.5000, 98.0000),
'mississippi_to_boston' : (33.0000, 90.0000,42.3581, 71.0636)} 

#This dict stores Great distance values for each key in users
result_dict = {}</span></pre>
<h2 id="toc_0"/>
<p>Now we can modify haversine function.</p>
<pre class="python highlighted_source"><span class="kw1">def haversine(key,lat1, lon1, lat2, lon2):
    R = 6372.8 # Earth radius in kilometers
    dLat = math.radians(lat2 - lat1)
    dLon = math.radians(lon2 - lon1)
    lat1 = math.radians(lat1)
    lat2 = math.radians(lat2)
    a = math.sin(dLat/2)**2 + math.cos(lat1) * math.cos(lat2) * math.sin(dLon/2)**2
    c = 2* math.asin(math.sqrt(a))
    #calculating KM
    a = R * c
    message = "the Great Circle Distance calculated by pid %d was %d KM"%(os.getpid(), a)
    return (key, message)
</span></pre>
<p>Next we need to process the result returned.So let’s create a callback function that takes result returned and stores it in the result_dict</p>
<div>
<pre class="python highlighted_source"><span class="kw1">def aggregate_results(result):
    print "Computing results with PID [%d]" % os.getpid()
    result_dict[result[0]] = result[1]</span></pre>
</div>
<p> Now let us code the main thing that adds tasks to process,we will use all the functions we created above.</p>
<div>
<pre class="python highlighted_source"><span class="kw1">job_server = pp.Server(ncpus=4)

for key in users.keys(): 
    job_server.submit(haversine,(key,users[key][0],users[key][1],users[key] [2],users[key][3]), modules=('os','math'), \
callback=aggregate_results)

"""
Above line creates multiple processes and assign 
executing haversine function with arguments as key,expanded tuple.
Processes starts executing using all cores of your processor.
Wait for all processes complete execution before retrieving result
"""
job_server.wait()

#Next main process starts executing
print "Main process PID [%d]" % os.getpid()
for key, value in result_dict.items():
    print "For input %d, %s" % (key, value)
</span></pre>
</div>
<div>
<h2 id="toc_0">See the output, It works</h2>
<p><a href="https://impythonist.files.wordpress.com/2014/12/selection_028.png"><img class="aligncenter wp-image-904 size-full" src="https://impythonist.files.wordpress.com/2014/12/selection_028.png?w=1000" alt=""/></a></p></div>
<p>Why there is common pid for all processes?,actually program executed parallel under main process.So main process process id is listed for each dispatched worker.But it  executes in 1/4 th  time of general sequential program.</p>
<p/>
<p>Total code can be found at this github link.Just save haversine.py from below repository and run it.You will find it’s lightening execution speed.</p>
<p/>

<p/>
<p>any discussions please forward to narenarya@live.com</p>
<p/>
<p>Resources:</p>
<p/>
<p>*</p>

<div><p>*
</p><p class="detailheader">Parallel Programming with Python</p>

<p>*</p></div>

<p/>
<p/>
<p/>
<p/>
<p/>
		<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-62549587-879-56d598f112b4d" data-src="//widgets.wp.com/likes/#blog_id=62549587&amp;post_id=879&amp;origin=impythonist.wordpress.com&amp;obj_id=62549587-879-56d598f112b4d" data-name="like-post-frame-62549587-879-56d598f112b4d"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p></div>					</div>

	</div></body></html>