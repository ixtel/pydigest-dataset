<html><body><div><div class="post-text" itemprop="text">

<p>I am trying to connect to a MySQL database using python but I am getting a strange error.  It is compounded by the fact that I can use the same connection values from the <code>mysql</code> console command and it connects with no problems.</p>

<p>Here is the exact code I am using:</p>

<p>import pymysql
    from checks import AgentCheck</p>

<pre><code>class DelayedJobCheck(AgentCheck):
    def check(self, instance):
        self.log.info("testing connection")
        self.log.info(instance)

        connection = pymysql.connect(**instance)

        cur = cnx.cursor(buffered=True)
        cur.execute("SHOW STATUS LIKE 'Ssl_cipher'")
        print(cur.fetchone())
        cur.close()
        cnx.close()

        self.gauge('hello.world', 1)
</code></pre>

<p>This is the error that I am getting:</p>

<pre>
Traceback (most recent call last):
  File "/opt/datadog-agent/agent/checks/__init__.py", line 661, in run
    self.check(copy.deepcopy(instance))
  File "/opt/datadog-agent/agent/checks.d/delayed_job.py", line 10, in check
    connection = pymysql.connect(**instance)
  File "/opt/datadog-agent/embedded/lib/python2.7/site-packages/pymysql/__init__.py", line 88, in Connect
    return Connection(*args, **kwargs)
  File "/opt/datadog-agent/embedded/lib/python2.7/site-packages/pymysql/connections.py", line 644, in __init__
    self._connect()
  File "/opt/datadog-agent/embedded/lib/python2.7/site-packages/pymysql/connections.py", line 869, in _connect
    raise exc
OperationalError: (2003, u"Can't connect to MySQL server on '192.168.199.86' ([SSL: SSL_NEGATIVE_LENGTH] dh key too small (_ssl.c:590))")

</pre>

<p>I am running this code on a Ubuntu box and I though initially that it might be because the SSL CA is a self generated cert.  So I followed the steps <a href="http://superuser.com/questions/437330/how-do-you-add-a-certificate-authority-ca-to-ubuntu">here</a> But, it did not make any difference.  Also I have verified that the process that is running this code has full access to the cert files</p>

<p>Any ideas what else might be causing this?</p>
    </div>
    </div></body></html>