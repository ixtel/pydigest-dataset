<html><body><div><div class="content">
  <h1>
    Using Python to organize a music directory
  </h1>

  <p class="byline">
    July  5, 2014
  </p>

  <p>This is part of a 3-post series on using mpv and Python
for music organization and playing in Linux and OSX.</p>



<p>This article introduces a Python script I use to organize my
mp3 music directory structure for <a href="https://cmus.github.io/">cmus</a> and <a href="http://mpv.io">mpv</a>.
mpv is a fork of <a href="http://www.mplayerhq.hu">mplayer</a> and adds
bug patches, an improved command-line interface, and
an experimental Lua scripting option.</p>

<p><strong>Note that this currently only works for mp3 files,
but the project is open to pull requests to support
other media formats.</strong></p>

<p>I have a small collection of Python scripts I add to my <code class="highlighter-rouge">PATH</code>
in the <a href="https://github.com/bamos/python-scripts">bamos/python-scripts</a> GitHub repository,
including <a href="https://github.com/bamos/python-scripts/blob/master/python2.7/music-organizer.py">music-organizer.py</a>.
<code class="highlighter-rouge">music-organizer.py</code> organizes my music into the simple directory
structure of <code class="highlighter-rouge">&lt;artist&gt;/&lt;track&gt;</code>, where <code class="highlighter-rouge">&lt;artist&gt;</code> and <code class="highlighter-rouge">&lt;track&gt;</code> are
lower case strings separated by dashes.
I call these lowercase strings <code class="highlighter-rouge">neat</code> and convert them with the <code class="highlighter-rouge">toNeat</code>
function below.
Keeping the files as lowercase helps me navigate the music directory
on the command line if I’m trying to synchronize artists between
computers with <a href="http://www.cis.upenn.edu/~bcpierce/unison/">unison</a> or use mpv.</p>

<figure class="highlight">
  <pre><code class="language-python" data-lang="python"><span class="c"># Maps a string such as 'The Beatles' to 'the-beatles'.</span>
<span class="k">def</span> <span class="nf">toNeat</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"&amp;"</span><span class="p">,</span><span class="s">"and"</span><span class="p">)</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"[()</span><span class="err">\</span><span class="s">[</span><span class="err">\</span><span class="s">],.'</span><span class="se">\"\\</span><span class="err">\</span><span class="s">?</span><span class="err">\</span><span class="s">#/</span><span class="err">\</span><span class="s">!</span><span class="err">\</span><span class="s">$</span><span class="err">\</span><span class="s">:]"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"[ </span><span class="err">\</span><span class="s">*</span><span class="err">\</span><span class="s">_]"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"-+"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
  <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">"[^0-9a-z</span><span class="err">\</span><span class="s">-</span><span class="err">\</span><span class="s">=]"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">search</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Error: Unrecognized character in '"</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">"'"</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">42</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">s</span></code></pre>
</figure>

<p><code class="highlighter-rouge">music-organizer.py</code> can be run on an entire music collection to
create subdirectories, or within an artist directory to only
organize the songs.</p>

<h2 id="artist-mode">Artist Mode.</h2>
<p>In artist mode, all songs from subdirectories will be merged into
the current directory.
For example, suppose a user has the following directory structure
for an artist.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">Album1/Track A.mp3
Album1/Track B.mp3
Album1/Track C.mp3
Album2/Track D.mp3
Album2/Track E.mp3</code></pre>
</figure>

<p>Running <code class="highlighter-rouge">music-organizer.py --artist</code> in this directory will
produce the following.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">track-a.mp3
track-b.mp3
track-c.mp3
track-d.mp3
track-e.mp3</code></pre>
</figure>

<h2 id="collection-mode">Collection Mode.</h2>
<p>In collection mode, the artist names will be preserved to allow
the user to override metadata, and only songs in the top level will
be sorted.
For example, suppose a user has the following directory structure
as a collection.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">Alpha 1.mp3 <span class="o">(</span>Artist: Alpha, Title: 1<span class="o">)</span>
Alpha 2.mp3 <span class="o">(</span>Artist: Alpha, Title: 2<span class="o">)</span>
Beta 1.mp3 <span class="o">(</span>Artist: Beta, Title: 1<span class="o">)</span>
KeepThisDir/1.mp3
KeepThisDir/2.mp3</code></pre>
</figure>

<p>Running <code class="highlighter-rouge">music-organizer.py --collection</code> in this directory will
produce the following.</p>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash">alpha/1.mp3 <span class="o">(</span>Artist: Alpha, Title: 1<span class="o">)</span>
alpha/2.mp3 <span class="o">(</span>Artist: Alpha, Title: 2<span class="o">)</span>
beta/1.mp3 <span class="o">(</span>Artist: Beta, Title: 1<span class="o">)</span>
KeepThisDir/1.mp3
KeepThisDir/2.mp3</code></pre>
</figure>

<h2 id="edge-cases">Edge cases.</h2>
<p>I’ve encountered two edge cases when running <code class="highlighter-rouge">music-organizer.py</code> on
my full music directory. Please try running music-organizer on
a copy or subset of your music directory first to ensure you don’t
run into any others!</p>

<p><strong>Case 1.</strong> When two separate files share the same metadata, I will either
change the metadata with a tool like <a href="https://musicbrainz.org/doc/MusicBrainz_Picard">Picard</a> or
use <code class="highlighter-rouge">music-organizer.py</code> to delete the conflicts with <code class="highlighter-rouge">--delete-conflicts</code>.</p>

<p><strong>Case 2.</strong> When the metadata in some artist directory indicates the
tracks have different names, <code class="highlighter-rouge">music-organizer.py</code> will halt
and suggest this to be changed.
Use <code class="highlighter-rouge">--ignore-multiple-artists</code> to allow this.</p>

<h2 id="detailed-usage">Detailed Usage.</h2>

<figure class="highlight">
  <pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>music-organizer.py -h
usage: music-organizer.py <span class="o">[</span>-h] <span class="o">[</span>--delete-conflicts]
                          <span class="o">[</span>--ignore-multiple-artists] <span class="o">[</span>--collection]
                          <span class="o">[</span>--artist]

Organizes a music collection using tag information. The directory format is
that the music collection consists of artist subdirectories, and there are 2
modes to operate on the entire collection or a single artist. All names are
made lowercase and separated by dashes <span class="k">for </span>easier navigation <span class="k">in </span>a Linux
filesystem.

optional arguments:
  -h, --help            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  --delete-conflicts    If an artist has duplicate tracks with the same name,
                        delete them. Note this might always be best <span class="k">in case</span> an
                        artist has multiple versions. To keep multiple
                        versions, fix the tag information.
  --ignore-multiple-artists
                        This script will prompt <span class="k">for </span>confirmation <span class="k">if </span>an artist
                        directory has songs with more than 2 different tags.
                        This flag disables the confirmation and won<span class="s1">'t perform
                        this check.
  --collection          Operate in '</span>collection<span class="s1">' mode and run '</span>artist<span class="s1">' mode on
                        every subdirectory.
  --artist              Operate in '</span>artist<span class="s1">' mode and copy all songs to the
                        root of the directory and cleanly format the names to
                        be easily typed and navigated in a shell.</span></code></pre>
</figure>



  
</div>





</div></body></html>