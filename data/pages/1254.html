<html><body><div><div class="entry-content clearfix"><p>This is a collaboration piece between Real Python and the mighty Nathan Nichols, using a collaborative method we have dubbed ‘agile blogging`. Say ‘hi’ <a href="http://twitter.com/natsamnic">@natsamnic</a>.</p>

<hr/>


<p>Let’s get down to business:</p>

<ol>
<li>Download the compressed pre-ajax Django Project from the <a href="https://github.com/realpython/django-form-fun/tree/master/part1">repo</a></li>
<li>Activate a virtualenv</li>
<li>Install the requirements</li>
<li>Sync the database</li>
<li>Fire up the server</li>
</ol>


<p>Once logged in, test out the form. What we have here is a <em>simple</em> communication app with just create rights. It looks nice, but there’s one annoying issue: The page refresh. How do we get rid of it? Or, how do we update just a <em>portion</em> of a webpage without having to refresh the <em>entire</em> page? Enter AJAX. AJAX is a client-side technology used for making asynchronous requests to the server-side – i.e., requesting or submitting data – where the subsequent responses do not cause an entire page refresh.</p>

<p><img src="https://raw.githubusercontent.com/realpython/django-form-fun/master/overview.png" alt="ajax-overview"/></p>

<blockquote><p>This tutorial assumes you have working knowledge of Django as well as <strong>some</strong> experience with JavaScript/jQuery. You should also be familiar with the basic HTTP methods, particularly GET and POST. Need to get up to speed? Get <a href="http://realpython.com">Real Python</a>.</p></blockquote>

<a name="Use.Protection"/>
<h2>Use Protection</h2>

<p>Regardless of whether you’re using AJAX or not, forms are at risk for Cross Site Request Forgeries (CSRF) attacks.</p>

<blockquote><p>Read more about CSRF attacks on the <a href="http://blog.codinghorror.com/preventing-csrf-and-xsrf-attacks/">Coding Horror</a> blog. They’ve got a great article.</p></blockquote>

<p>To prevent such attacks, you must add the  <code>{% csrf_token %}</code> template tag to the form, which adds a hidden input field containing a token that gets sent with each POST request.</p>

<p>If you look at the <em>talk/index.html</em> template, you can see that we have already included this token. However, when it comes to AJAX requests, we need to add a bit more code, because we cannot pass that token using a JavaScript object since the scripts are static.</p>

<p>To get around this, we need to create a custom header that includes the token to watch our back. Simply grab the code <a href="https://github.com/realpython/django-form-fun/blob/master/part1/main.js">here</a> and add it to the end of the <em>main.js</em> file. Yes, it’s a lot of code. We could go through it line-by-line, but that’s not the point of this post. Just trust us that it works.</p>

<p>Moving on…</p>

<a name="Handling.Events"/>
<h2>Handling Events</h2>

<p>Before we touch the AJAX code, we need to add an <a href="http://learn.jquery.com/events/handling-events/">event handler</a> to our JavaScript file using jQuery.</p>

<blockquote><p>Keep in mind that jQuery is JavaScript. It’s simply a JavaScript library used to reduce the amount of code you need to write. This is a common area of confusion so just be mindful of this as you go through the remainder of this tutorial.</p></blockquote>

<p>Which event(s) do we need to “handle”? Since we’re just working with creating a post at this point, we just need to add one handler to <em>main.js</em>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Submit post on submit</span>
</span><span class="line"><span class="nx">$</span><span class="p">(</span><span class="s1">'#post-form'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
</span><span class="line">    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"form submitted!"</span><span class="p">)</span>  <span class="c1">// sanity check</span>
</span><span class="line">    <span class="nx">create_post</span><span class="p">();</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, when a user submits the form this function fires, which-</p>

<ol>
<li>Prevents the <a href="http://www.w3schools.com/jquery/event_preventdefault.asp">default browser behavior</a> for a form submission,</li>
<li>Logs “form submitted!” to the console, and</li>
<li>Calls a function called <code>create_post()</code> where the AJAX code will live.</li>
</ol>


<p>Make sure to add an id of <code>post-form</code> to the form on the <em>index.html</em> file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/create_post/"</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">id=</span><span class="s">"post-form"</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And add a link to the JavaScript file to the bottom of the template:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"static/scripts/main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test this out. Fire up the server, then open your JavaScript console. You should see the following when you submit the form:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="html"><span class="line">form submitted!
</span><span class="line">Uncaught ReferenceError: create_post is not defined
</span></code></pre></td></tr></table></div></figure>


<p>This is exactly what we should see: The form submission is handled correctly, since “form submitted!” is displayed and the <code>create_post</code> function is called. Now we just need to add that function.</p>

<a name="Adding.AJAX"/>
<h2>Adding AJAX</h2>

<p>Let’s develop one last iteration before we add the actual AJAX code.</p>

<a name="Update..em.main.js..em.:"/>
<h3>Update <em>main.js</em>:</h3>

<p>Add the <code>create_post</code> function:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// AJAX for posting</span>
</span><span class="line"><span class="kd">function</span> <span class="nx">create_post</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"create post is working!"</span><span class="p">)</span> <span class="c1">// sanity check</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#post-text'</span><span class="p">).</span><span class="nx">val</span><span class="p">())</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, we ran a sanity check to ensure the function is called correctly, then we grab the input value of the form. For this to work correctly we need to add an id to the form field:</p>

<a name="Update..em.forms.py..em.:"/>
<h3>Update <em>forms.py</em>:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">PostForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
</span><span class="line">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="line">        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
</span><span class="line">        <span class="c"># exclude = ['author', 'updated', 'created', ]</span>
</span><span class="line">        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'text'</span><span class="p">]</span>
</span><span class="line">        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">            <span class="s">'text'</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
</span><span class="line">                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="s">'post-text'</span><span class="p">,</span> <span class="s">'required'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">'placeholder'</span><span class="p">:</span> <span class="s">'Say something...'</span><span class="p">}</span>
</span><span class="line">            <span class="p">),</span>
</span><span class="line">        <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice how we also added a placeholder to the field and made it required along with the id. We could add some error handlers to the form template or simply let HTML5 handle it. Let’s use the latter.</p>

<p>Test again. Submit the form with the word “test”. You should see the following in your console:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">form</span> <span class="n">submitted</span><span class="err">!</span>
</span><span class="line"><span class="n">create</span> <span class="n">post</span> <span class="ow">is</span> <span class="n">working</span><span class="err">!</span>
</span><span class="line"><span class="n">test</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sweet. So, we’ve confirmed that we’re calling the <code>create_post()</code> function correctly as well as grabbing the value of the form input. Now let’s wire in some AJAX to submit the POST request.</p>

<a name="Update..em.main.js..em.:"/>
<h3>Update <em>main.js</em>:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// AJAX for posting</span>
</span><span class="line"><span class="kd">function</span> <span class="nx">create_post</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"create post is working!"</span><span class="p">)</span> <span class="c1">// sanity check</span>
</span><span class="line">    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class="line">        <span class="nx">url</span> <span class="o">:</span> <span class="s2">"create_post/"</span><span class="p">,</span> <span class="c1">// the endpoint</span>
</span><span class="line">        <span class="nx">type</span> <span class="o">:</span> <span class="s2">"POST"</span><span class="p">,</span> <span class="c1">// http method</span>
</span><span class="line">        <span class="nx">data</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">the_post</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#post-text'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="p">},</span> <span class="c1">// data sent with the post request</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// handle a successful response</span>
</span><span class="line">        <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="nx">$</span><span class="p">(</span><span class="s1">'#post-text'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span> <span class="c1">// remove the value from the input</span>
</span><span class="line">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span> <span class="c1">// log the returned json to the console</span>
</span><span class="line">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"success"</span><span class="p">);</span> <span class="c1">// another sanity check</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// handle a non-successful response</span>
</span><span class="line">        <span class="nx">error</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span><span class="nx">errmsg</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="nx">$</span><span class="p">(</span><span class="s1">'#results'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">"&lt;div class='alert-box alert radius' data-alert&gt;Oops! We have encountered an error: "</span><span class="o">+</span><span class="nx">errmsg</span><span class="o">+</span>
</span><span class="line">                <span class="s2">" &lt;a href='#' class='close'&gt;&amp;times;&lt;/a&gt;&lt;/div&gt;"</span><span class="p">);</span> <span class="c1">// add the error to the dom</span>
</span><span class="line">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span> <span class="c1">// provide a bit more info about the error to the console</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">});</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>What’s happening? Well, we submit form data to the <code>create_post/</code> endpoint, then wait for one of two responses – either a success or a failure…. Follow the code comments for a more detailed explanation.</p>

<a name="Update.the.views"/>
<h3>Update the views</h3>

<p>Now let’s update our views to handle the POST request correctly:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">create_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
</span><span class="line">        <span class="n">post_text</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'the_post'</span><span class="p">)</span>
</span><span class="line">        <span class="n">response_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class="line">
</span><span class="line">        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">post_text</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span><span class="line">        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">        <span class="n">response_data</span><span class="p">[</span><span class="s">'result'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Create post successful!'</span>
</span><span class="line">        <span class="n">response_data</span><span class="p">[</span><span class="s">'postpk'</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">pk</span>
</span><span class="line">        <span class="n">response_data</span><span class="p">[</span><span class="s">'text'</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">text</span>
</span><span class="line">        <span class="n">response_data</span><span class="p">[</span><span class="s">'created'</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">created</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%B </span><span class="si">%d</span><span class="s">, %Y %I:%M %p'</span><span class="p">)</span>
</span><span class="line">        <span class="n">response_data</span><span class="p">[</span><span class="s">'author'</span><span class="p">]</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span>
</span><span class="line">
</span><span class="line">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span>
</span><span class="line">            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">),</span>
</span><span class="line">            <span class="n">content_type</span><span class="o">=</span><span class="s">"application/json"</span>
</span><span class="line">        <span class="p">)</span>
</span><span class="line">    <span class="k">else</span><span class="p">:</span>
</span><span class="line">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span>
</span><span class="line">            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"nothing to see"</span><span class="p">:</span> <span class="s">"this isn't happening"</span><span class="p">}),</span>
</span><span class="line">            <span class="n">content_type</span><span class="o">=</span><span class="s">"application/json"</span>
</span><span class="line">        <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we grab the post text along with the author and update the database. Then we create a response dict, serialize it into JSON, and then send it as the response – which gets logged to the console in the success handler: <code>console.log(json)</code>, as you saw in the <code>create_post()</code> function in the JavaScript file above.</p>

<p>Test this again.</p>

<p>You should see the object in the console:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">form</span> <span class="n">submitted</span><span class="err">!</span>
</span><span class="line"><span class="n">create</span> <span class="n">post</span> <span class="ow">is</span> <span class="n">working</span><span class="err">!</span>
</span><span class="line"><span class="n">Object</span> <span class="p">{</span><span class="n">text</span><span class="p">:</span> <span class="s">"hey!"</span><span class="p">,</span> <span class="n">author</span><span class="p">:</span> <span class="s">"michael"</span><span class="p">,</span> <span class="n">postpk</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="s">"Create post successful!"</span><span class="p">,</span> <span class="n">created</span><span class="p">:</span> <span class="s">"August 22, 2014 10:55 PM"</span><span class="p">}</span>
</span><span class="line"><span class="n">success</span>
</span></code></pre></td></tr></table></div></figure>


<p>How about we add the JSON to the <a href="http://en.wikipedia.org/wiki/Document_Object_Model">DOM</a>!</p>

<a name="Updating.the.DOM"/>
<h2>Updating the DOM</h2>

<a name="Update.the.template"/>
<h3>Update the template</h3>

<p>Simply add an id of “talk” to the <code>&lt;ul&gt;</code>:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>Then update the form so that errors will be added:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">id=</span><span class="s">"post-form"</span><span class="nt">&gt;</span>
</span><span class="line">    {% csrf_token %}
</span><span class="line">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"fieldWrapper"</span> <span class="na">id=</span><span class="s">"the_post"</span><span class="nt">&gt;</span>
</span><span class="line">        {{ form.text }}
</span><span class="line">    <span class="nt">&lt;/div&gt;</span>
</span><span class="line">    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"results"</span><span class="nt">&gt;&lt;/div&gt;</span> <span class="c">&lt;!-- errors go here --&gt;</span>
</span><span class="line">    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Post"</span> <span class="na">class=</span><span class="s">"tiny button"</span><span class="nt">&gt;</span>
</span><span class="line"><span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Update..em.main.js..em."/>
<h3>Update <em>main.js</em></h3>

<p>Now we can add the JSON to the DOM where that new “talk” id is:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">$</span><span class="p">(</span><span class="s1">'#post-text'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span> <span class="c1">// remove the value from the input</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span> <span class="c1">// log the returned json to the console</span>
</span><span class="line">    <span class="nx">$</span><span class="p">(</span><span class="s2">"#talk"</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="s2">"&lt;li&gt;&lt;strong&gt;"</span><span class="o">+</span><span class="nx">json</span><span class="p">.</span><span class="nx">text</span><span class="o">+</span><span class="s2">"&lt;/strong&gt; - &lt;em&gt; "</span><span class="o">+</span><span class="nx">json</span><span class="p">.</span><span class="nx">author</span><span class="o">+</span><span class="s2">"&lt;/em&gt; - &lt;span&gt; "</span><span class="o">+</span><span class="nx">json</span><span class="p">.</span><span class="nx">created</span><span class="o">+</span><span class="s2">"&lt;/span&gt;&lt;/li&gt;"</span><span class="p">);</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"success"</span><span class="p">);</span> <span class="c1">// another sanity check</span>
</span><span class="line"><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ready to see this in action? Test it out!</p>

<p><img src="https://raw.githubusercontent.com/realpython/django-form-fun/master/convo.png" alt="convo_app"/></p>

<p>If you’d like to see what an error looks like, then comment out all the CSRF Javascript in <em>main.js</em> and then try to submit the form.</p>

<a name="Rinse..Repeat"/>
<h2>Rinse, Repeat</h2>

<p>Your turn. We need to handle some more events. With your new found knowledge of jQuery and AJAX, you get to put these into place. I added code to the final app – which you can download <a href="https://github.com/realpython/django-form-fun/tree/master/part1">here</a> – that includes a delete link. You just need to add an event to handle the click, which then calls a function that uses AJAX to send a POST request to the back-end to delete the post from the database. Follow the same workflow as I did in this tutorial. We’ll post the answer to this next time.</p>

<p>If you get stuck, and can’t debug the errors, follow this workflow –</p>

<ol>
<li>Use the “Google-it-first” algorithm</li>
<li>Struggle. Spin your wheels. Set the code aside. Run around the block. Then come back to it.</li>
<li>Still stuck? Comment below, stating first the problem and then detailing the steps you’ve taken to solve the problem thus far</li>
</ol>


<p>Be sure to <em>try</em> troubleshooting on your own before asking for help. Spinning your wheels, hacking away at a solution will benefit you in the long run. It’s the process that matters, not so much the solution. It’s part of what separates poor developers from great developers. Good luck.</p>

<p><strong>Check out the solution <a href="https://realpython.com/blog/python/django-and-ajax-form-submissions-more-practice/">here</a>.</strong></p>

<a name="Conclusion"/>
<h2>Conclusion</h2>

<p>How does your app look? Ready for more?</p>

<ol>
<li>AJAX is <em>so</em> yesterday. We can do a lot more with much less code using AngularJS.</li>
<li>In most cases, it’s a standard to couple the client-side JavaScript, whether it’s AJAX or Angular or some other framework, with a server-side RESTful API.</li>
<li>Where’s the tests?</li>
</ol>


<p>What would you like to see next? Comment below. Cheers!</p>

<p>Happy coding!</p>

<p><a href="https://github.com/realpython/django-form-fun">Link to repo</a>.</p>
</div>


      </div></body></html>