<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_header.jpg"><img class="aligncenter wp-image-3038" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_header.jpg" alt="detecting_blur_header" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_header-300x196.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_header.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Between myself and my father, Jemma, the super-sweet, hyper-active, extra-loving family beagle may be the most photographed dog of all time. Since we got her as a 8-week old puppy, to now, just under three years later, we have accumulated over <em><strong>6,000+ photos</strong> </em>of the dog.</p>
<p>Excessive?</p>
<p>Perhaps. But I love dogs. A lot. Especially beagles. So it should come as no surprise that as a dog owner, I spend a lot of time playing tug-of-war with Jemma’s favorite toys, rolling around on the kitchen floor with her as we roughhouse, and yes, <em>snapping tons of photos of her with my iPhone.</em></p>
<p>Over this past weekend I sat down and tried to organize the massive amount of photos in iPhoto. Not only was it a huge undertaking, I started to notice a pattern fairly quickly — <strong><em>there were lots of photos with excessive amounts of blurring</em></strong>.</p>
<p>Whether due to sub-par photography skills, trying to keep up with super-active Jemma as she ran around the room, or her spazzing out right as I was about to take the <em>perfect shot</em>, many photos contained a decent amount of blurring.</p>
<p>Now, for the average person I suppose they would have just deleted these blurry photos (or at least moved them to a separate folder) — but as a computer vision scientist, that wasn’t going to happen.</p>
<p>Instead, I opened up an editor and coded up a quick Python script to <strong>perform blur detection with OpenCV</strong>.</p>
<p>In the rest of this blog post, I’ll show you how to compute the amount of blur in an image using OpenCV, Python, and the Laplacian operator. By the end of this post, you’ll be able to apply the <em>variance of the Laplacian</em> <em>method</em> to your own photos to detect the amount of blurring.</p>

<h2>Variance of the Laplacian</h2>
<div id="attachment_3018" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_convolution.jpg"><img class="size-full wp-image-3018" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_convolution.jpg" alt="Figure 2: Convolving the input image with the Laplacian operator." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_convolution-245x300.jpg 245w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_convolution.jpg 368w" sizes="(max-width: 368px) 100vw, 368px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Convolving the input image with the Laplacian operator.</p></div>
<p>My first stop when figuring out how to detect the amount of blur in an image was to read through the excellent survey work, <em><a href="http://www.sayonics.com/publications/pertuz_PR2013.pdf" target="_blank">Analysis of focus measure operators for shape-from-focus</a></em> [2013 Pertuz et al]. Inside their paper, Pertuz et al. reviews nearly <em>36 different methods</em> to estimate the focus measure of an image.</p>
<p>If you have any background in signal processing, the first method to consider would be computing the <a href="https://en.wikipedia.org/wiki/Fast_Fourier_transform" target="_blank">Fast Fourier Transform</a> of the image and then examining the distribution of low and high frequencies — if there are a low amount of high frequencies, then the image can be considered blurry. However, defining what is a <em>low</em> number of high frequencies and what is a <em>high</em> number of high frequencies can be quite problematic, often leading to sub-par results.</p>
<p>Instead, wouldn’t it be nice if we could just compute a <em>single floating point value</em> to represent how <em>blurry</em> a given image is?</p>
<p>Pertuz et al. reviews many methods to compute this “blurryness metric”, some of them simple and straightforward using just basic grayscale pixel intensity statistics, others more advanced and feature-based, evaluating the Local Binary Patterns of an image.</p>
<p>After a quick scan of the paper, I came to the implementation that I was looking for: <strong>variation of the Laplacian</strong><em> </em>by Pech-Pacheco et al. in their 2000 ICPR paper, <em><a href="http://optica.csic.es/papers/icpr2k.pdf" target="_blank">Diatom autofocusing in brightfield microscopy: a comparative study</a></em>.</p>
<p>The method is simple. Straightforward. Has sound reasoning. And can be implemented in <em><strong>only a single line of code</strong></em>:</p>

		<div id="crayon-56d5bdc2e7fa3849376825" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5bdc2e7fa3849376825-1"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Laplacian</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CV_64F</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">var</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>You simply take a single channel of an image (presumably grayscale) and convolve it with the following <i>3 x 3</i> kernel:</p>
<div id="attachment_3020" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_laplacian.png"><img class="size-full wp-image-3020" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_laplacian.png" alt="Figure 2: The Laplacian kernel."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> The Laplacian kernel.</p></div>
<p>And then take the variance (i.e. standard deviation squared) of the response.</p>
<p>If the variance falls below a pre-defined threshold, then the image is considered <em>blurry</em>; otherwise, the image is <em>not blurry</em>.</p>
<p>The reason this method works is due to the definition of the Laplacian operator itself, which is used to measure the 2nd derivative of an image. The Laplacian highlights regions of an image containing rapid intensity changes, much like the Sobel and Scharr operators. And, just like these operators, the Laplacian is often used for edge detection. The assumption here is that if an image contains <em>high variance</em> then there is a wide spread of responses, both edge-like and non-edge like, representative of a normal, in-focus image. But if there is <em>very low variance</em>, then there is a tiny spread of responses, indicating there are very little edges in the image. As we know, the more an image is blurred, <em>the less edges there are</em>.</p>
<p>Obviously the trick here is setting the correct threshold which can be quite domain dependent. Too low of a threshold and you’ll incorrectly mark images as blurry when they are not. Too high of a threshold then images that are actually blurry will not be marked as blurry. This method tends to work best in environments where you can compute an acceptable focus measure range and then detect outliers.</p>
<h2>Detecting the amount of blur in an image</h2>
<p>So now that we’ve reviewed the the method we are going to use to compute a single metric to represent how “blurry” a given image is, let’s take a look at our dataset of the following 12 images:</p>
<div id="attachment_3036" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_dataset.png"><img class="wp-image-3036" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_dataset.png" alt="Figure 3: Our dataset of images. Some are blurry, some are not. Our goal is to perform blur detection with OpenCV and mark the images as such." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_dataset-300x296.png 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_dataset.png 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Our dataset of images. Some are blurry, some are not. Our goal is to perform blur detection with OpenCV and mark the images as such.</p></div>
<p>As you can see, some images are blurry, some images are not. Our goal here is to <em>correctly</em> mark each image as <em>blurry</em> or <em>non-blurry</em>.</p>
<p>With that said, open up a new file, name it 
			<span id="crayon-56d5bdc2e7faf526600925" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect_blur</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and let’s get coding:</p>

		<div id="crayon-56d5bdc2e7fb4997610611" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-2">2</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-4">4</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-6">6</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-8">8</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-10">10</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-12">12</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-14">14</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fb4997610611-16">16</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fb4997610611-17">17</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">imutils </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">paths</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">cv2</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-6"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">variance_of_laplacian</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-7"><span class="crayon-h">	</span><span class="crayon-c"># compute the Laplacian of the image and then return the focus</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-8"><span class="crayon-h">	</span><span class="crayon-c"># measure, which is simply the variance of the Laplacian</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-9"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Laplacian</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CV_64F</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">var</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-10"> </p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-11"><span class="crayon-c"># construct the argument parse and parse the arguments</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-12"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-13"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-i"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--images"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-14"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"path to input directory of images"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-15"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-t"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--threshold"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">type</span><span class="crayon-o">=</span><span class="crayon-k ">float</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">default</span><span class="crayon-o">=</span><span class="crayon-cn">100.0</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fb4997610611-16"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"focus measures that fall below this value will be considered 'blurry'"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fb4997610611-17"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start off by importing our necessary packages on <strong>Lines 2-4</strong>. If you don’t already have my <a href="https://github.com/jrosebr1/imutils" target="_blank">imutils</a> package on your machine, you’ll want to install it now:</p>

		

<p>From there, we’ll define our 
			<span id="crayon-56d5bdc2e7fbd141952747" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">variance_of_laplacian</span></span></span>  function on <strong>Line 6</strong>. This method will take only a single argument the 
			<span id="crayon-56d5bdc2e7fc1069615390" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">image</span></span></span>  (presumed to be a single channel, such as a grayscale image) that we want to compute the focus measure for. From there, <strong>Line 9</strong> simply convolves the 
			<span id="crayon-56d5bdc2e7fc5720245517" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">image</span></span></span>  with the <i>3 x 3</i> Laplacian operator and returns the variance.</p>
<p><strong>Lines 12-17</strong> handle parsing our command line arguments. The first switch we’ll need is 
			<span id="crayon-56d5bdc2e7fc8234428638" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">images</span></span></span> , the path to the directory containing our dataset of images we want to test for blurryness.</p>
<p>We’ll also define an optional argument 
			<span id="crayon-56d5bdc2e7fcc772032549" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">thresh</span></span></span> , which is the threshold we’ll use for the blurry test. If the focus measure for a given image falls below this threshold, we’ll mark the image as <em>blurry</em>. It’s important to note that you’ll likely have to tune this value for your own dataset of images. A value of 
			<span id="crayon-56d5bdc2e7fcf285941478" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-cn">100</span></span></span>  seemed to work well for my dataset, but this value is quite subjective to the contents of the image(s), so you’ll need to play with this value yourself to obtain optimal results.</p>
<p>Believe it or not, the hard part is done! We just need to write a bit of code to load the image from disk, compute the variance of the Laplacian, and then mark the image as blurry or non-blurry:</p>

		<div id="crayon-56d5bdc2e7fd3846255119" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-20">20</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-22">22</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-24">24</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-26">26</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-28">28</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-30">30</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-32">32</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-34">34</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-36">36</p><p class="crayon-num" data-line="crayon-56d5bdc2e7fd3846255119-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5bdc2e7fd3846255119-38">38</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-19"><span class="crayon-c"># loop over the input images</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-20"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">imagePath </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">paths</span><span class="crayon-sy">.</span><span class="crayon-e">list_images</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"images"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-21"><span class="crayon-h">	</span><span class="crayon-c"># load the image, convert it to grayscale, and compute the</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-22"><span class="crayon-h">	</span><span class="crayon-c"># focus measure of the image using the Variance of Laplacian</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-23"><span class="crayon-h">	</span><span class="crayon-c"># method</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-24"><span class="crayon-h">	</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">imagePath</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-25"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-26"><span class="crayon-h">	</span><span class="crayon-k ">fm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variance_of_laplacian</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-27"><span class="crayon-h">	</span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"Not Blurry"</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-28"> </p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-29"><span class="crayon-h">	</span><span class="crayon-c"># if the focus measure is less than the supplied threshold,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-30"><span class="crayon-h">	</span><span class="crayon-c"># then the image should be considered "blurry"</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-31"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-k ">fm</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"threshold"</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-32"><span class="crayon-h">		</span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"Blurry"</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-33"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-34"><span class="crayon-h">	</span><span class="crayon-c"># show the image</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-35"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">putText</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"{}: {:.2f}"</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">text</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">fm</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-36"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">FONT_HERSHEY_SIMPLEX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5bdc2e7fd3846255119-37"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5bdc2e7fd3846255119-38"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start looping over our directory of images on <strong>Line 20</strong>. For each of these images we’ll load it from disk, convert it to grayscale, and then apply blur detection using OpenCV (<strong>Lines 24-27</strong>).</p>
<p>In the case that the focus measure exceeds the threshold supplied a command line argument, we’ll mark the image as <em>“blurry”</em>.</p>
<p>Finally, <strong>Lines 35-38</strong> write the 
			<span id="crayon-56d5bdc2e7fd8333301706" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">text</span></span></span>  and computed focus measure to the image and display the result to our screen.</p>
<h2>Applying blur detection with OpenCV</h2>
<p>Now that we have 
			<span id="crayon-56d5bdc2e7fdb064616481" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect_blur</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  script coded up, let’s give it a shot. Open up a shell and issue the following command:</p>

		<div id="crayon-56d5bdc2e7fdf305760582" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5bdc2e7fdf305760582-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">detect_blur</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">images </span><span class="crayon-v">images</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/><div id="attachment_3023" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_001.jpg"><img class="wp-image-3023" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_001.jpg" alt="Figure 4: Correctly marking the image as &quot;blurry&quot;." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_001-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_001-785x1024.jpg 785w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_001.jpg 1128w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 4:</strong> Correctly marking the image as “blurry”.</p></div>
<p>The focus measure of this image is <em>83.17</em>, falling below our threshold of <em>100</em>; thus, we correctly mark this image as blurry.</p>
<div id="attachment_3024" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_002.jpg"><img class="wp-image-3024" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_002.jpg" alt="Figure 5: Performing blur detection with OpenCV. This image is marked as &quot;blurry&quot;." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_002-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_002.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 5:</strong> Performing blur detection with OpenCV. This image is marked as “blurry”.</p></div>
<p>This image has a focus measure of <em>64.25</em>, also causing us to mark it as “blurry”.</p>
<div id="attachment_3025" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_003.jpg"><img class="wp-image-3025" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_003.jpg" alt="Figure 6: Marking an image as &quot;non-blurry&quot;." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_003-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_003.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 6:</strong> Marking an image as “non-blurry”.</p></div>
<p><strong>Figure 6</strong> has a very high focus measure score at <em>1004.14</em> — orders of magnitude higher than the previous two figures. This image is clearly non-blurry and in-focus.</p>
<div id="attachment_3026" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_004.jpg"><img class="wp-image-3026" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_004.jpg" alt="Figure 7: Applying blur detection with OpenCV and Python." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_004-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_004.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 7:</strong> Applying blur detection with OpenCV and Python.</p></div>
<p>The only amount of blur in this image comes from Jemma wagging her tail.</p>
<div id="attachment_3027" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_005.jpg"><img class="wp-image-3027" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_005.jpg" alt="Figure 8: Basic blur detection with OpenCV and Python." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_005-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_005.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 8:</strong> Basic blur detection with OpenCV and Python.</p></div>
<p>The reported focus measure is lower than <strong>Figure 7</strong>, but we are still able to correctly classify the image as “non-blurry”.</p>
<div id="attachment_3028" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_006.jpg"><img class="wp-image-3028" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_006.jpg" alt="Figure 9: Computing the focus measure of an image." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_006-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_006.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 9:</strong> Computing the focus measure of an image.</p></div>
<p>However, we can clearly see the above image is blurred.</p>
<div id="attachment_3029" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_007.jpg"><img class="wp-image-3029" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_007.jpg" alt="Figure 10: An example of computing the amount of blur in an image." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_007-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_007.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 10:</strong> An example of computing the amount of blur in an image.</p></div>
<p>The large focus measure score indicates that the image is non-blurry.</p>
<div id="attachment_3030" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_008.jpg"><img class="wp-image-3030" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_008.jpg" alt="Figure 11: The subsequent image in the dataset is marked as &quot;blurry&quot;." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_008-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_008.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 11:</strong> The subsequent image in the dataset is marked as “blurry”.</p></div>
<p>However, this image contains dramatic amounts of blur.</p>
<div id="attachment_3031" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_009.jpg"><img class="wp-image-3031" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_009.jpg" alt="Detecting the amount of blur in an image using the variance of Laplacian." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_009-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_009.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 12:</strong> Detecting the amount of blur in an image using the variance of Laplacian.</p></div>
<div id="attachment_3032" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_010.jpg"><img class="wp-image-3032" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_010.jpg" alt="Figure 13: Compared to Figure 12 above, the amount of blur in this image is substantially reduced." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_010-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_010.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 13:</strong> Compared to Figure 12 above, the amount of blur in this image is substantially reduced.</p></div>
<div id="attachment_3033" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_011.jpg"><img class="wp-image-3033" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_011.jpg" alt="Figure 14: Again, this image is correctly marked as not being &quot;blurred&quot;." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_011-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_011.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 14:</strong> Again, this image is correctly marked as not being “blurred”.</p></div>
<div id="attachment_3034" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_012.jpg"><img class="wp-image-3034" src="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_012.jpg" alt="Figure 15: Lastly, we end our example by using blur detection in OpenCV to mark this image as &quot;blurry&quot;." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_012-230x300.jpg 230w, http://www.pyimagesearch.com/wp-content/uploads/2015/09/detecting_blur_result_012.jpg 766w" sizes="(max-width: 460px) 100vw, 460px"/></a><p class="wp-caption-text"><strong>Figure 15:</strong> Lastly, we end our example by using blur detection in OpenCV to mark this image as “blurry”.</p></div>
<h2>Summary</h2>
<p>In this blog post we learned how to perform blur detection using OpenCV and Python.</p>
<p>We implemented the <em>variance of Laplacian</em> method to give us a single floating point value to represent the “blurryness” of an image. This method is fast, simple, and easy to apply — we simply convolve our input image with the Laplacian operator and compute the variance. If the variance falls below a predefined threshold, we mark the image as “blurry”.</p>
<p>It’s important to note that threshold is a critical parameter to tune correctly and you’ll often need to tune it on a per-dataset basis. Too small of a value, and you’ll accidentally mark images as blurry when they are not. With too large of a threshold, you’ll mark images as non-blurry when in fact they are.</p>
<p>Be sure to download the code using the form at the bottom of this post and give it a try!</p>
<h2 id="post_downloads">Downloads:</h2>

	</section>
	</div></body></html>