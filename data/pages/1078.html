<html><body><div><div class="entry-content"><p>Stop using <code>STATIC_URL</code> and start using the static template tag to ensure your URLs work across storages.</p>




<p>What does that mean? It means when you have static files in templates, do this:</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="django"><span class="line"><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="nv">from</span> <span class="nv">staticfiles</span> <span class="cp">%}</span><span class="x"/>
</span><span class="line"><span class="x">&lt;img src="</span><span class="cp">{%</span> <span class="k">static</span> <span class="s2">"images/hi.jpg"</span> <span class="cp">%}</span><span class="x">" alt="Hi!" /&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Not this:</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="django"><span class="line"><span class="x">&lt;img src="</span><span class="cp">{{</span> <span class="nv">STATIC_URL</span> <span class="cp">}}</span><span class="x">images/hi.jpg" alt="Hi!" /&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Why? Like many of the worst mistakes to make, this will work absolutely fine until it doesn’t.</p>

<p>So there you are, writing your templates.
You think “what’s the point in loading an extra template tag when I already have <code>STATIC_URL</code> in the context?”.
You <code>collectstatic</code> your files to somewhere your nginx can serve them, and everything works fine.
Later you try moving to Amazon S3, or CloudFront, or some other CDN.
At which point all your static links break, and there goes your afternoon.</p>

<a name="Why."/>
<h2>Why?</h2>

<p>What the <code>static</code> tag does is call the <code>url</code> method of your configured <code>STATICFILES_STORAGE</code> (remember those from <a href="http://blog.doismellburning.co.uk/2012/06/25/django-and-static-files/">http://blog.doismellburning.co.uk/2012/06/25/django-and-static-files/</a> ?) with the path provided, to get the correct URL for the file path.</p>

<p>For the vanilla <code>StaticFilesStorage</code>, this is straightforward, so <code>StaticFileStorage.url</code> effectively just prepends <code>STATIC_URL</code> to the path given, which is almost the same result as blind in-template concatenation.</p>

<p>For some of the more complex storages, like <a href="http://django-storages.readthedocs.org/en/latest/backends/amazon-S3.html"><code>S3BotoStorage</code></a> from <a href="https://pypi.python.org/pypi/django-storages"><code>django-storages</code></a>, determining a file’s URL can potentially involve generating an access token, expiry time, and other such fun. At this point, simple concatenation won’t quite cut it.</p>

<p>Anyone who’s been using Django for some time may be particularly in need of this advice, as, prior to Django 1.5, the documentation advocated just using <code>STATIC_URL</code>, only mentioning the template tag as a sidenote, and it generally works often enough that you could never realise the shortcomings until they come to bite you.</p>

<p>Don’t get caught out.</p>

<a name="UPDATE:"/>
<h3>UPDATE:</h3>

<p>Another great example of when you absolutely must use the <code>static</code> tag: if you’re using Django’s <a href="https://docs.djangoproject.com/en/1.6/ref/contrib/staticfiles/#django.contrib.staticfiles.storage.CachedStaticFilesStorage"><code>CachedStaticFilesStorage</code></a> as described in my post about <a href="/blog/setting-up-static-file-caching/">Setting up static file caching</a>, because it uses a hash of the file’s contents as <em>part of</em> the file name (so <code>css/styles.css</code> might be saved as <code>css/styles.55e7cbb9ba48.css</code>) and no amount of carefully constructing <code>STATIC_URL</code> will help you here!</p>
</div>


  </div></body></html>