<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/05/jp.png"><img class="aligncenter wp-image-749" src="http://www.pyimagesearch.com/wp-content/uploads/2014/05/jp.png" alt="Jurassic Park Movie Poster"/></a></p>
<p>Take a second to look at the <em>Jurassic Park</em> movie poster above.</p>
<p>What are the <em>dominant</em> colors? (i.e. the colors that are represented most in the image)</p>
<p>Well, we see that the background is largely <strong>black</strong>. There is some <strong>red</strong> around the T-Rex. And there is some <strong>yellow</strong> surrounding the actual logo.</p>
<p>It’s pretty simple for the human mind to pick out these colors.</p>
<p>But what if we wanted to create an algorithm to <em>automatically</em> pull out these colors?</p>

<p>You might think that a color histogram is your best bet…</p>
<p>But there’s actually a more interesting algorithm we can apply — k-means clustering.</p>
<p>In this blog post I’ll show you how to use OpenCV, Python, and the <a href="http://en.wikipedia.org/wiki/K-means_clustering" target="_blank">k-means clustering algorithm</a> to find the most dominant colors in an image.</p>
<p><strong>OpenCV and Python versions:</strong><br/>
This example will run on<strong> Python 2.7/Python 3.4+</strong> and <strong>OpenCV 2.4.X/OpenCV 3.0+</strong>.</p>
<h1>K-Means Clustering</h1>
<p>So what exactly is k-means?</p>
<p>K-means is a <a href="http://en.wikipedia.org/wiki/Cluster_analysis" target="_blank">clustering algorithm</a>.</p>
<p>The goal is to partition <em>n</em> data points into <em>k</em> clusters. Each of the <em>n</em> data points will be assigned to a cluster with the nearest mean. The mean of each cluster is called its “centroid” or “center”.</p>
<p>Overall, applying k-means yields <em>k</em> separate clusters of the original <em>n</em> data points. Data points inside a particular cluster are considered to be “more similar” to each other than data points that belong to other clusters.</p>
<p>In our case, we will be clustering the pixel intensities of a RGB image. Given a <em>MxN</em> size image, we thus have <em>MxN</em> pixels, each consisting of three components: Red, Green, and Blue respectively.</p>
<p>We will treat these <em>MxN</em> pixels as our data points and cluster them using k-means.</p>
<p>Pixels that belong to a given cluster will be more similar in color than pixels belonging to a separate cluster.</p>
<p>One caveat of k-means is that we need to specify the number of clusters we want to generate <strong><em>ahead of time</em></strong>. There are algorithms that automatically select the optimal value of <em>k</em>, but these algorithms are outside the scope of this post.</p>
<h1>OpenCV and Python K-Means Color Clustering</h1>
<p>Alright, let’s get our hands dirty and cluster pixel intensities using OpenCV, Python, and k-means:</p>

		<div id="crayon-56d58f76a11dc432246542" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-2">2</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-4">4</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-6">6</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-8">8</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-10">10</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-12">12</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-14">14</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-16">16</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-18">18</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-20">20</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a11dc432246542-22">22</p><p class="crayon-num" data-line="crayon-56d58f76a11dc432246542-23">23</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58f76a11dc432246542-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">cluster </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">KMeans</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">utils</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-8"><span class="crayon-c"># construct the argument parser and parse the arguments</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-9"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-10"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-i"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">help</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"Path to the image"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-11"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-c"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--clusters"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">type</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-12"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"# of clusters"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-13"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-14"> </p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-15"><span class="crayon-c"># load the image and convert it from BGR to RGB so that</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-16"><span class="crayon-c"># we can dispaly it with matplotlib</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-17"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"image"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-18"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2RGB</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-20"><span class="crayon-c"># show our image</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-21"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11dc432246542-22"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">axis</span><span class="crayon-sy">(</span><span class="crayon-s">"off"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a11dc432246542-23"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 2-6</strong> handle importing the packages we need. We’ll use the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html" target="_blank">scikit-learn implementation of k-means</a> to make our lives easier — no need to re-implement the wheel, so to speak. We’ll also be using <code>matplotlib</code> to display our images and most dominant colors. To parse command line arguments we will use <code>argparse</code>. The <code>utils</code> package contains two helper functions which I will discuss later. And finally the <code>cv2</code> package contains our Python bindings to the OpenCV library.</p>
<p><strong>Lines 9-13</strong> parses our command line arguments. We only require two arguments: <code>--image</code>, which is the path to where our image resides on disk, and <code>--clusters</code>, the number of clusters that we wish to generate.</p>
<p><strong>On Lines 17-18</strong> we load our image off of disk and then convert it from the BGR to the RGB colorspace. Remember, OpenCV represents images as multi-dimensions NumPy arrays. However, these images are stored in BGR order rather than RGB. To remedy this, we simply using the <code>cv2.cvtColor</code> function.</p>
<p>Finally, we display our image to our screen using <code>matplotlib</code> on <strong>Lines 21-23</strong>.</p>
<p>As I mentioned earlier in this post, our goal is to generate <em>k</em> clusters from <em>n</em> data points. We will be treating our <em>MxN</em> image as our data points.</p>
<p>In order to do this, we need to re-shape our image to be a list of pixels, rather than <em>MxN</em> matrix of pixels:</p>

		<div id="crayon-56d58f76a11ec015661269" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58f76a11ec015661269-25"><span class="crayon-c"># reshape the image to be a list of pixels</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11ec015661269-26"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This code should be pretty self-explanatory. We are simply re-shaping our NumPy array to be a list of RGB pixels.</p>
<h2>The 2 lines of code:</h2>
<p>Now that are data points are prepared, we can write these <strong>2 lines of code</strong> using k-means to find the most dominant colors in an image:</p>

		<div id="crayon-56d58f76a11f2819322463" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11f2819322463-28"><span class="crayon-c"># cluster the pixel intensities</span></p><p class="crayon-line" id="crayon-56d58f76a11f2819322463-29"><span class="crayon-v">clt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">KMeans</span><span class="crayon-sy">(</span><span class="crayon-v">n_clusters</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"clusters"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11f2819322463-30"><span class="crayon-v">clt</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We are using the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html" target="_blank">scikit-learn implementation of k-means</a> to avoid re-implementing the algorithm. There is also a k-means built into OpenCV, but if you have ever done any type of machine learning in Python before (or if you ever intend to), I suggest using the scikit-learn package.</p>
<p>We instantiate <code>KMeans</code> on <strong>Line 29</strong>, supplying the number of clusters we wish to generate. A call to <code>fit()</code> method on <strong>Line 30</strong> clusters our list of pixels.</p>
<p>That’s all there is to clustering our RGB pixels using Python and k-means.</p>
<p><a href="https://www.pyimagesearch.com/practical-python-opencv/?src=in-post-kmeans-color-clustering"><img src="http://www.pyimagesearch.com/wp-content/uploads/2014/08/in_post_sales_banner.png" alt="Practical Python and OpenCV"/></a></p>
<p>Scikit-learn takes care of everything for us.</p>
<p>However, in order to display the most dominant colors in the image, we need to define two helper functions.</p>
<p>Let’s open up a new file, <code>utils.py</code>, and define the <code>centroid_histogram</code> function:</p>

		<div id="crayon-56d58f76a11fb580193532" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58f76a11fb580193532-1"><span class="crayon-p"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-2"><span class="crayon-e">import </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line" id="crayon-56d58f76a11fb580193532-3"><span class="crayon-e">import </span><span class="crayon-e">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-4"> </p><p class="crayon-line" id="crayon-56d58f76a11fb580193532-5"><span class="crayon-e">def </span><span class="crayon-e">centroid_histogram</span><span class="crayon-sy">(</span><span class="crayon-v">clt</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-6"><span class="crayon-h">	</span><span class="crayon-p"># grab the number of different clusters and create a histogram</span></p><p class="crayon-line" id="crayon-56d58f76a11fb580193532-7"><span class="crayon-h">	</span><span class="crayon-p"># based on the number of pixels assigned to each cluster</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-8"><span class="crayon-h">	</span><span class="crayon-v">numLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">arange</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">clt</span><span class="crayon-sy">.</span><span class="crayon-v">labels_</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a11fb580193532-9"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">hist</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">histogram</span><span class="crayon-sy">(</span><span class="crayon-v">clt</span><span class="crayon-sy">.</span><span class="crayon-v">labels_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bins</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numLabels</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-10"> </p><p class="crayon-line" id="crayon-56d58f76a11fb580193532-11"><span class="crayon-h">	</span><span class="crayon-p"># normalize the histogram, such that it sums to one</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-12"><span class="crayon-h">	</span><span class="crayon-v">hist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hist</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">"float"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a11fb580193532-13"><span class="crayon-h">	</span><span class="crayon-v">hist</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-v">hist</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-14"> </p><p class="crayon-line" id="crayon-56d58f76a11fb580193532-15"><span class="crayon-h">	</span><span class="crayon-p"># return the histogram</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a11fb580193532-16"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">hist</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>As you can see, this method takes a single parameter, <code>clt</code>. This is our k-means clustering object that we created in <code>color_kmeans.py</code>.</p>
<p>The k-means algorithm assigns each pixel in our image to the closest cluster. We grab the number of clusters on <strong>Line 8</strong> and then create a histogram of the number of pixels assigned to each cluster on <strong>Line 9</strong>.</p>
<p>Finally, we normalize the histogram such that it sums to one and return it to the caller on <strong>Lines 12-16</strong>.</p>
<p>In essence, <strong><em>all this function is doing is counting the number of pixels that belong to each cluster.</em></strong></p>
<p>Now for our second helper function, <code>plot_colors</code>:</p>

		<div id="crayon-56d58f76a1200711197137" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-18">18</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-20">20</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-22">22</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-24">24</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-26">26</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-28">28</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-30">30</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-32">32</p><p class="crayon-num" data-line="crayon-56d58f76a1200711197137-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58f76a1200711197137-34">34</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-18"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">plot_colors</span><span class="crayon-sy">(</span><span class="crayon-v">hist</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">centroids</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-19"><span class="crayon-h">	</span><span class="crayon-c"># initialize the bar chart representing the relative frequency</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-20"><span class="crayon-h">	</span><span class="crayon-c"># of each of the colors</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-21"><span class="crayon-h">	</span><span class="crayon-v">bar</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">300</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"uint8"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-22"><span class="crayon-h">	</span><span class="crayon-v">startX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-23"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-24"><span class="crayon-h">	</span><span class="crayon-c"># loop over the percentage of each cluster and the color of</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-25"><span class="crayon-h">	</span><span class="crayon-c"># each cluster</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-26"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">percent</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">zip</span><span class="crayon-sy">(</span><span class="crayon-v">hist</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">centroids</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-27"><span class="crayon-h">		</span><span class="crayon-c"># plot the relative percentage of each cluster</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-28"><span class="crayon-h">		</span><span class="crayon-v">endX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">startX</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">percent</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">300</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-29"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">rectangle</span><span class="crayon-sy">(</span><span class="crayon-v">bar</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">startX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">endX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-30"><span class="crayon-h">			</span><span class="crayon-v">color</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">"uint8"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">tolist</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-31"><span class="crayon-h">		</span><span class="crayon-v">startX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">endX</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-32"><span class="crayon-h">	</span></p><p class="crayon-line" id="crayon-56d58f76a1200711197137-33"><span class="crayon-h">	</span><span class="crayon-c"># return the bar chart</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1200711197137-34"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">bar</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The <code>plot_colors</code> function requires two parameters: <code>hist</code>, which is the histogram generated from the <code>centroid_histogram function</code>, and <code>centroids</code>, which is the list of centroids (cluster centers) generated by the k-means algorithm.</p>
<p>On <strong>Line 21</strong> we define a <em>300×50</em> pixel rectangle to hold the most dominant colors in the image.</p>
<p>We start looping over the color and percentage contribution on <strong>Line 26</strong> and then draw the percentage the current color contributes to the image on <strong>Line 29</strong>. We then return our color percentage bar to the caller on <strong>Line 34</strong>.</p>
<p>Again, this function performs a very simple task — generates a figure displaying how many pixels were assigned to each cluster based on the output of the <code>centroid_histogram</code> function.</p>
<p>Now that we have our two helper functions defined, we can glue everything together:</p>

		<div id="crayon-56d58f76a1208937372624" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1208937372624-32"><span class="crayon-c"># build a histogram of clusters and then create a figure</span></p><p class="crayon-line" id="crayon-56d58f76a1208937372624-33"><span class="crayon-c"># representing the number of pixels labeled to each color</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1208937372624-34"><span class="crayon-v">hist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">centroid_histogram</span><span class="crayon-sy">(</span><span class="crayon-v">clt</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a1208937372624-35"><span class="crayon-v">bar</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">plot_colors</span><span class="crayon-sy">(</span><span class="crayon-v">hist</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clt</span><span class="crayon-sy">.</span><span class="crayon-v">cluster_centers_</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1208937372624-36"> </p><p class="crayon-line" id="crayon-56d58f76a1208937372624-37"><span class="crayon-c"># show our color bart</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1208937372624-38"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a1208937372624-39"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">axis</span><span class="crayon-sy">(</span><span class="crayon-s">"off"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58f76a1208937372624-40"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-v">bar</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58f76a1208937372624-41"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On <strong>Line 34</strong> we count the number of pixels that are assigned to each cluster. And then on <strong>Line 35</strong> we generate the figure that visualizes the number of pixels assigned to each cluster.</p>
<p><strong>Lines 38-41</strong> then displays our figure.</p>
<p>To execute our script, issue the following command:</p>

		<div id="crayon-56d58f76a120d628345400" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58f76a120d628345400-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">color_kmeans</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">image </span><span class="crayon-v">images</span><span class="crayon-o">/</span><span class="crayon-v">jp</span><span class="crayon-e">.png</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-i">clusters</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>If all goes well, you should see something similar to below:</p>
<div id="attachment_754" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/05/jurassic-park-colors.jpg"><img class="wp-image-754" src="http://www.pyimagesearch.com/wp-content/uploads/2014/05/jurassic-park-colors.jpg" alt="Figure 1: Using Python, OpenCV, and k-means to find the most dominant colors in our image."/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Using Python, OpenCV, and k-means to find the most dominant colors in our image.</p></div>
<p>Here you can see that our script generated three clusters (since we specified three clusters in the command line argument). The most dominant clusters are black, yellow, and red, which are all heavily represented in the <em>Jurassic Park</em> movie poster.</p>
<p>Let’s apply this to a screenshot of <em>The Matrix</em>:</p>
<div id="attachment_756" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/05/the-matrix-colors.jpg"><img class="wp-image-756" src="http://www.pyimagesearch.com/wp-content/uploads/2014/05/the-matrix-colors.jpg" alt="Figure 2: Finding the four most dominant colors using k-means in our The Matrix image."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Finding the four most dominant colors using k-means in our <em>The Matrix</em> image.</p></div>
<p>This time we told k-means to generate four clusters. As you can see, black and various shades of green are the most dominant colors in the image.</p>
<p>Finally, let’s generate five color clusters for this Batman image:</p>
<div id="attachment_757" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/05/batman-colors.jpg"><img class="wp-image-757" src="http://www.pyimagesearch.com/wp-content/uploads/2014/05/batman-colors.jpg" alt="Figure 3: Applying OpenCV and k-means clustering to find the five most dominant colors in a RGB image."/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Applying OpenCV and k-means clustering to find the five most dominant colors in a RGB image.</p></div>
<p>So there you have it.</p>
<p>Using OpenCV, Python, and k-means to cluster RGB pixel intensities to find the most dominant colors in the image is actually quite simple. Scikit-learn takes care of all the heavy lifting for us. Most of the code in this post was used to glue all the pieces together.</p>
<h1>Summary</h1>
<p>In this blog post I showed you how to use OpenCV, Python, and k-means to find the most dominant colors in the image.</p>
<p>K-means is a clustering algorithm that generates <em>k</em> clusters based on <em>n</em> data points. The number of clusters <em>k</em> must be specified ahead of time. Although algorithms exist that can find an optimal value of <em>k</em>, they are outside the scope of this blog post.</p>
<p>In order to find the most dominant colors in our image, we treated our pixels as the data points and then applied k-means to cluster them.</p>
<p>We used the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html" target="_blank">scikit-learn implementation of k-means</a> to avoid having to re-implement it.</p>
<p>I encourage you to apply k-means clustering to our own images. In general, you’ll find that smaller number of clusters (<em>k &lt;= 5</em>) will give the best results.</p>
<h1 id="post_downloads">Downloads:</h1>

	</section>
	</div></body></html>