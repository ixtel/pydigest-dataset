<html><body><div><article class="markdown-body entry-content" itemprop="text"><p>A simple statistical profiler which outputs in format suitable for <a href="http://www.brendangregg.com/flamegraphs.html">FlameGraph</a>.</p>
<a name="user-content-install"/>
<h2><a id="user-content-install" class="anchor" href="#install" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>INSTALL:</h2>
<p>Simply run:</p>
<pre>pip install git+https://github.com/evanhempel/python-flamegraph.git
</pre>
<a name="user-content-usage"/>
<h2><a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>USAGE:</h2>
<p>Run your script under the profiler:</p>
<pre>python -m flamegraph -o perf.log myscript.py --your-script args here
</pre>
<p>Run Brendan Gregg's <a href="http://www.brendangregg.com/flamegraphs.html">FlameGraph</a> tool against the output:</p>
<pre>flamegraph.pl --title "MyScript CPU" perf.log &gt; perf.svg
</pre>
<p>Enjoy the output:</p>
<a href="/evanhempel/python-flamegraph/blob/master/docs/attic-create.png" target="_blank"><img alt="Attic create flame graph" src="/evanhempel/python-flamegraph/raw/master/docs/attic-create.png"/></a>
<p><strong>Filtering</strong></p>
<p>Sometimes you may want to exclude a method
(for example in a server the method that waits for a new request)
or you may want to profile only a subset of your code
(a particular method and its children which are performance critical).</p>
<p>Filtering can be done by passing a python regular expression to the
<code>-f</code> or <code>--filter</code> command line option
which will restrict output to only those lines which match.
Filtering is done against the entire line so you can filter by
function name, thread name, both, or even by
more complex filters such as function ABC calls DEF (<code>ABC.*DEF</code>).</p>
<p>Alternatively since the output is stackframes each on a line by itself,
this can simply be done with a simple grep filter.:</p>
<pre>Exclude:

  grep -v waiting_method perf.log &gt; removed_waiting.log

Include:

  grep function_name perf.log &gt; filtered.log
</pre>
<p>Then run the flamegraph.pl script against the filtered file.</p>
<div>
<a href="/evanhempel/python-flamegraph/blob/master/docs/ycanta-full.png" target="_blank"><img alt="yCanta webapp full profile of PDF export" src="/evanhempel/python-flamegraph/raw/master/docs/ycanta-full.png"/></a>
<p>Full profile output of <a href="https://github.com/yCanta/yCanta">yCanta</a> webapp PDF export.  Most time is
spent in wait state and graph is not very helpful.</p>
</div>
<div>
<a href="/evanhempel/python-flamegraph/blob/master/docs/ycanta-pdf.png" target="_blank"><img alt="yCanta webapp filtered for PDF export format function." src="/evanhempel/python-flamegraph/raw/master/docs/ycanta-pdf.png"/></a>
<p>Filtered profile output of <a href="https://github.com/yCanta/yCanta">yCanta</a> webapp PDF export.  Filtering was on the
pdf format function so time spent in wait state has been excluded and the
graph is now helpful.</p>
</div>

</article>
  </div></body></html>