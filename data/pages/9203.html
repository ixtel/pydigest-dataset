<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-nextdoor-scheduler" class="anchor" href="#nextdoor-scheduler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Nextdoor Scheduler</h1>

<p><a href="https://camo.githubusercontent.com/64d506383be67decddf8968e3b0072c3e9ba4a84/68747470733a2f2f696d672e736869656c64732e696f2f686578706d2f6c2f706c75672e737667" target="_blank"><img src="https://camo.githubusercontent.com/64d506383be67decddf8968e3b0072c3e9ba4a84/68747470733a2f2f696d672e736869656c64732e696f2f686578706d2f6c2f706c75672e737667" alt="Apache" data-canonical-src="https://img.shields.io/hexpm/l/plug.svg"/></a> 
<a href="https://travis-ci.org/Nextdoor/ndscheduler"><img src="https://camo.githubusercontent.com/3160f40a504b2d0c709b21aca8477b1e530b13c9/68747470733a2f2f7472617669732d63692e6f72672f4e657874646f6f722f6e647363686564756c65722e737667" alt="Build Status" data-canonical-src="https://travis-ci.org/Nextdoor/ndscheduler.svg"/></a></p>

<p><code>ndscheduler</code> is a flexible python library for building your own cron-like system to schedule jobs, which is to run a tornado process to serve REST APIs and a web ui. It's like <a href="http://llvm.org/">LLVM</a> that provides modular and reusable components for building a compiler. </p>

<p>Check out our blog post - <a href="https://medium.com/nextdoor-engineering/we-don-t-run-cron-jobs-at-nextdoor-6f7f9cc62040#.150z7i5lx">We Donâ€™t Run Cron Jobs at Nextdoor</a></p>

<h2><a id="user-content-table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Table of contents</h2>



<h2><a id="user-content-key-abstractions" class="anchor" href="#key-abstractions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Key Abstractions</h2>

<ul>
<li><a href="https://github.com/Nextdoor/ndscheduler/tree/master/ndscheduler/core">Core</a>: a bunch of resuable components

<ul>
<li><a href="https://github.com/Nextdoor/ndscheduler/tree/master/ndscheduler/core/datastore">Datastore</a>: manages database connections and makes queries; could support Postgres, MySQL, and sqlite.

<ul>
<li>Job: represents a schedule job and decides how to run a paricular job.</li>
<li>Execution: represents an instance of job execution.</li>
<li>AuditLog: logs when and who runs what job.</li>
</ul></li>
<li><a href="https://github.com/Nextdoor/ndscheduler/blob/master/ndscheduler/core/scheduler_manager.py">ScheduleManager</a>: access Datastore to manage jobs, i.e., schedule/modify/delete/pause/resume a job.</li>
</ul></li>
<li><a href="https://github.com/Nextdoor/ndscheduler/tree/master/ndscheduler/server">Server</a>: a tornado server that runs ScheduleManager and provides REST APIs and serves UI.</li>
<li><a href="https://github.com/Nextdoor/ndscheduler/tree/master/ndscheduler/static">Web UI</a>: a single page HTML app; this is a default implementation.</li>
</ul>

<h2><a id="user-content-try-it-now" class="anchor" href="#try-it-now" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Try it NOW</h2>

<p>From source code:</p>

<pre><code>git clone https://github.com/Nextdoor/ndscheduler.git
cd ndscheduler
make simple
</code></pre>

<p>Or use docker:</p>

<pre><code>docker run -it -p 8888:8888 wenbinf/ndscheduler
</code></pre>

<p>Open your browser and go to <a href="http://localhost:8888">localhost:8888</a>. </p>

<p><strong>Demo</strong>
(Click for fullscreen play)
<a href="https://camo.githubusercontent.com/86369c0aae0da0781e2798db72bd3cc40a47ac9d/68747470733a2f2f6769616e742e6766796361742e636f6d2f4e61737479426f7373794265617665722e676966" target="_blank"><img src="https://camo.githubusercontent.com/86369c0aae0da0781e2798db72bd3cc40a47ac9d/68747470733a2f2f6769616e742e6766796361742e636f6d2f4e61737479426f7373794265617665722e676966" alt="ndscheduler demo" data-canonical-src="https://giant.gfycat.com/NastyBossyBeaver.gif"/></a></p>

<h2><a id="user-content-how-to-build-your-own-cron-replacement" class="anchor" href="#how-to-build-your-own-cron-replacement" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to build Your own cron-replacement</h2>

<h3><a id="user-content-install-ndscheduler" class="anchor" href="#install-ndscheduler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Install ndscheduler</h3>

<p>Using pip (from GitHub repo)</p>

<pre><code>#
# Put this in requirements.txt, then run
#    pip install -r requirements.txt
#

# If you want the latest build
git+https://github.com/Nextdoor/ndscheduler.git#egg=ndscheduler

# Or put this if you want a specific commit
git+https://github.com/Nextdoor/ndscheduler.git@5843322ebb440d324ca5a66ba55fea1fd00dabe8

# Or put this if you want a specific tag version
git+https://github.com/Nextdoor/ndscheduler.git@v0.1.0#egg=ndscheduler

#
# Run from command line
#

pip install -e git+https://github.com/Nextdoor/ndscheduler.git#egg=ndscheduler
</code></pre>

<p>(We'll upload the package to PyPI soon.)</p>

<h3><a id="user-content-three-things" class="anchor" href="#three-things" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Three things</h3>

<p>You have to implement three things for your scheduler, i.e., <code>Settings</code>, <code>Server</code>, and <code>Jobs</code>.</p>

<p><strong>Settings</strong></p>

<p>In your implementation, you need to provide a settings file to override default settings (e.g., <a href="https://github.com/Nextdoor/ndscheduler/blob/master/simple_scheduler/settings.py">settings in simple_scheduler</a>). You need to specify the python import path in the environment variable <code>NDSCHEDULER_SETTINGS_MODULE</code> before running the server.</p>

<p>All available settings can be found in <a href="https://github.com/Nextdoor/ndscheduler/blob/master/ndscheduler/default_settings.py">default_settings.py</a> file.</p>

<p><strong>Server</strong></p>

<p>You need to have a server file to import and run <code>ndscheduler.server.server.SchedulerServer</code>.</p>

<p><strong>Jobs</strong></p>

<p>Each job should be a standalone class that is a subclass of <code>ndscheduler.job.JobBase</code> and put the main logic of the job in <code>run()</code> function.</p>

<p>After you set up <code>Settings</code>, <code>Server</code> and <code>Jobs</code>, you can run the whole thing like this:</p>

<pre><code>NDSCHEDULER_SETTINGS_MODULE=simple_scheduler.settings \
PYTHONPATH=.:$(PYTHONPATH) \
        python simple_scheduler/scheduler.py
</code></pre>

<h3><a id="user-content-reference-implementation" class="anchor" href="#reference-implementation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Reference Implementation</h3>

<p>See code in the <a href="https://github.com/Nextdoor/ndscheduler/tree/master/simple_scheduler">simple_scheduler/</a> directory for inspiration :)</p>

<p>Run it</p>

<pre><code>make simple
</code></pre>

<p>Access the web ui via <a href="http://localhost:8888">localhost:8888</a></p>

<p>The reference implementation also comes with <a href="https://github.com/Nextdoor/ndscheduler/tree/master/simple_scheduler/jobs">several sample jobs</a>.</p>

<ul>
<li>AwesomeJob: it just prints out 2 arguments you pass in.</li>
<li>SlackJob: it sends a slack message periodically, for example, team standup reminder.</li>
<li>ShellJob: it runs an executable command, for example, run curl to crawl web pages.</li>
<li>CurlJob: it's like running <a href="http://curl.haxx.se/">curl</a> periodically.</li>
</ul>

<p>And it's <a href="https://github.com/Nextdoor/ndscheduler/tree/master/simple_scheduler/docker">dockerized</a>.</p>

<h2><a id="user-content-contribute-code-to-ndscheduler" class="anchor" href="#contribute-code-to-ndscheduler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Contribute code to ndscheduler</h2>

<p><strong>Install dependencies</strong></p>

<pre><code># Each time we introduce a new dependency in setup.py, you have to run this
make install
</code></pre>

<p><strong>Run unit tests</strong></p>

<pre><code>make test
</code></pre>

<p><strong>Clean everything and start from scratch</strong></p>

<pre><code>make clean
</code></pre>

<p>Finally, send pull request. Please make sure the <a href="https://travis-ci.org/Nextdoor/ndscheduler">CI</a> passes for your PR.</p>

<h2><a id="user-content-rest-apis" class="anchor" href="#rest-apis" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>REST APIs</h2>

<p>Please see <a href="https://github.com/Nextdoor/ndscheduler/blob/master/ndscheduler/server/handlers/README.md">README.md in ndscheduler/server/handlers</a>.</p>

<h2><a id="user-content-web-ui" class="anchor" href="#web-ui" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Web UI</h2>

<p>We provide a default implementation of web ui. You can replace the default web ui by overwriting these settings</p>

<pre><code>STATIC_DIR_PATH = :static asset directory paths:
TEMPLATE_DIR_PATH = :template directory path:
APP_INDEX_PAGE = :the file name of the single page app's html:
</code></pre>

<h3><a id="user-content-the-default-web-ui" class="anchor" href="#the-default-web-ui" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>The default web ui</h3>

<p><strong>List of jobs</strong></p>

<p><a href="https://camo.githubusercontent.com/3c59f6cb7e57f28044a85aed4680064be9c25f2c/687474703a2f2f692e696d6775722e636f6d2f6447494c626b5a2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/3c59f6cb7e57f28044a85aed4680064be9c25f2c/687474703a2f2f692e696d6775722e636f6d2f6447494c626b5a2e706e67" alt="List of jobs" data-canonical-src="http://i.imgur.com/dGILbkZ.png"/></a></p>

<p><strong>List of executions</strong></p>

<p><a href="https://camo.githubusercontent.com/6bdf70221d1a8798f264b4714c94a1ea85dabc9a/687474703a2f2f692e696d6775722e636f6d2f4a706a7a726c552e706e67" target="_blank"><img src="https://camo.githubusercontent.com/6bdf70221d1a8798f264b4714c94a1ea85dabc9a/687474703a2f2f692e696d6775722e636f6d2f4a706a7a726c552e706e67" alt="List of executions" data-canonical-src="http://i.imgur.com/JpjzrlU.png"/></a></p>

<p><strong>Audit Logs</strong></p>

<p><a href="https://camo.githubusercontent.com/09a48a4b87c7cde66d2a0dd0badf9574cdde516b/687474703a2f2f692e696d6775722e636f6d2f65484c7a4868772e706e67" target="_blank"><img src="https://camo.githubusercontent.com/09a48a4b87c7cde66d2a0dd0badf9574cdde516b/687474703a2f2f692e696d6775722e636f6d2f65484c7a4868772e706e67" alt="Audit logs" data-canonical-src="http://i.imgur.com/eHLzHhw.png"/></a></p>

<p><strong>Modify a job</strong></p>

<p><a href="https://camo.githubusercontent.com/16e024ab7817299eec66986f3d746f4ad3671551/687474703a2f2f692e696d6775722e636f6d2f61577636784f522e706e67" target="_blank"><img src="https://camo.githubusercontent.com/16e024ab7817299eec66986f3d746f4ad3671551/687474703a2f2f692e696d6775722e636f6d2f61577636784f522e706e67" alt="Modify a job" data-canonical-src="http://i.imgur.com/aWv6xOR.png"/></a></p>
</article>
  </div></body></html>