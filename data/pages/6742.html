<html><body><div><div class="entry-content"><p>Анимация, основанная на spritesheet’ах, используется в играх довольно продолжительное время. В том числе в таких популярных играх, как Legend of Zelda: A Link to the Past или Cut the Rope. В этой статье мы поговорим о том, как работает такая анимация и как ее запрограммировать. В качестве языка программирования будем использовать JavaScript, но вы можете выбрать любой удобный для вас.<br/> <span id="more-8741"/></p><p>Прежде чем говорить о том, как программировать spritesheet анимацию, нам следует определить три термина: анимация, спрайт и, собственно, spritesheet.</p><h3>Анимация</h3><p>В далеком 1872 году английскому и американскому фотографу Эдварду Мейбриджу было поручено узнать, поднимает ли лошадь все свои 4 ноги во время бега. Мейбридж для этого использовал несколько камер, которые делали снимок, когда лошадь с наездником пробегала мимо. В итоге фотограф получил 16 изображений лошади. Кстати говоря, в парочке из них все четыре ноги лошади действительно находятся в воздухе.</p><p><img class="aligncenter size-full wp-image-8745" src="http://cdn.tproger.ru/wp-content/uploads/2015/09/Muybridge_race_horse_sheet.gif" alt="Muybridge_race_horse_sheet"/></p><p>Позднее Мейбридж повторил эксперимент, но поместил все фотографии в устройство, которое могло проецировать их в быстрой последовательности так, что получалась иллюзия бега лошади. Это устройство позднее назвали кинопроектор.</p><p><img class="aligncenter size-full wp-image-8746" src="http://cdn.tproger.ru/wp-content/uploads/2015/09/Muybridge_race_horse_animated.gif" alt="Muybridge_race_horse_animated"/></p><p>Процесс быстрой смены изображений для создания иллюзии движения назвали анимацией.</p><h3>Спрайт</h3><p>Спрайт является одним графическим изображением, которое помещают на большую сцену. То есть спрайт является частью этой сцены.</p><p><img class="aligncenter size-full wp-image-8747" src="http://cdn.tproger.ru/wp-content/uploads/2015/09/sprite.png" alt="sprite"/></p><p>Спрайты являются популярным способом для создания больших и сложных сцен, так как вы можете манипулировать и управлять каждым изображением в отдельности. Это позволяет лучше контролировать происходящее на сцене.</p><p>Совсем не редкость, когда в игре существуют десятки, а то и сотни спрайтов. Загрузка каждого из них в качестве индивидуального и самостоятельного изображения будет потреблять много памяти и вычислительной мощности. Для того, чтобы избежать этих неудобств, и используют spritesheet’ы.</p><h3>Spritesheet’ы</h3><p>Когда вы кладете множество спрайтов в одно изображение, вы получаете spritesheet.</p><p><img class="aligncenter size-full wp-image-8748" src="http://cdn.tproger.ru/wp-content/uploads/2015/09/spritesheet.png" alt="spritesheet"/></p><p>Spritesheet’ы используют для ускорения процесса отображения картинки на экране. Гораздо эффективнее и быстрее загрузить одно большое изображение и показать его часть, чем загрузить множество спрайтов и показать их.</p><p>Анимация, основанная на spritesheet, есть не более чем обычный spritesheet, который показывается не целиком и полностью, а покадрово. Причем эти кадры меняются с достаточно большой скоростью. Принцип работы такой анимации аналогичен принципу работы кинопроектора, созданного Мейбриджем.</p><h3>Части spritesheet’а</h3><p>Сам по себе spritesheet состоит из двух частей: кадров и циклов.</p><p>Кадр является обычным изображением (или спрайтом). На примере лошади Мейбриджа: каждое изображение лошади во всей анимации является кадром.</p><p>Если кадры поставить в правильном порядке, то получится непрерывное движение. Это и есть цикл.</p><h3>Программирование spritesheet анимации</h3><p>Существует 3 этапа создания spritesheet анимации:</p><ol><li>Создание изображения.</li><li>Обновление изображения для каждого кадра анимации.</li><li>Рисование анимации на экране.</li></ol><h4>Создание изображения</h4><p>Начнем с создания функции (или класса), который будет обрабатывать нашу spritesheet анимацию. Эта функция будет создавать изображение и установит его путь для того, чтобы мы могли использовать его для дальнейшего рисования на экране.</p><div id="crayon-56d5ac572a5e9450785787" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ac572a5e9450785787-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">SpriteSheet</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameHeight</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5e9450785787-2"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a5e9450785787-3"><span class="crayon-h">   </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Image</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5e9450785787-4"><span class="crayon-h">   </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">framesPerRow</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a5e9450785787-5"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5e9450785787-6"><span class="crayon-h">   </span><span class="crayon-c">// вычисление количества кадров в строке после загрузки изображения</span></p><p class="crayon-line" id="crayon-56d5ac572a5e9450785787-7"><span class="crayon-h">   </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5e9450785787-8"><span class="crayon-h">   </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">onload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5ac572a5e9450785787-9"><span class="crayon-h">      </span><span class="crayon-v">framesPerRow</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5e9450785787-10"><span class="crayon-h">   </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a5e9450785787-11"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5e9450785787-12"><span class="crayon-h">   </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a5e9450785787-13"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> Так как spritesheet’ы могут иметь разные размеры, то, зная размер одного кадра, мы будем знать количество кадров в строке и столбце.</p><p>Очень важно, чтобы каждый кадр анимации имел один и тот же размер, иначе анимация получится не натуральная.</p><h4>Обновление изображений</h4><p>Чтобы обновить spritesheet анимацию, нам понадобится изменить тот кадр, который рисуется в данный момент. Ниже spritesheet разделен на кадры, каждый из которых пронумерован.</p><p><img class="aligncenter size-full wp-image-8749" src="http://cdn.tproger.ru/wp-content/uploads/2015/09/spritesheet_numbered.png" alt="spritesheet_numbered"/></p><p>Менять текущий кадр на следующий нужно не моментально, а через какое-то время. То есть при показе одного из кадров требуется сделать определенную задержку перед тем, как поменять его.</p><p>Важно отметить, что не каждый spritesheet имеет доступный спрайт в каждом из своих кадров. Например, в spritesheet’е Мейбриджа 16-й спрайт отсутствует. Если бы мы не учли этого, то анимация получилась бы со вспышкой.</p><p>Избежать всплесков запросто: мы не будем отрисовывать эти пустые изображения:</p><div id="crayon-56d5ac572a5fa859504535" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"><div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-2">2</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-4">4</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-6">6</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-8">8</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-10">10</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-12">12</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-14">14</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-16">16</p><p class="crayon-num" data-line="crayon-56d5ac572a5fa859504535-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a5fa859504535-18">18</p></div></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">SpriteSheet</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameHeight</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameSpeed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endFrame</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-2"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-3"><span class="crayon-h">  </span><span class="crayon-c">// код удален для краткости</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-4"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-5"><span class="crayon-h">  </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h">  </span><span class="crayon-c">// текущий кадр для отрисовки</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-6"><span class="crayon-h">  </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h">       </span><span class="crayon-c">// счетчик ожидания</span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-7"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-8"><span class="crayon-h">  </span><span class="crayon-c">// обновление анимации</span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-9"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">update</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-10"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-11"><span class="crayon-h">    </span><span class="crayon-c">// если подошло время смены кадра, то меняем</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-12"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">frameSpeed</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-13"><span class="crayon-h">      </span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">endFrame</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-14"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-15"><span class="crayon-h">    </span><span class="crayon-c">// обновление счетчика ожидания</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-16"><span class="crayon-h">    </span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">frameSpeed</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a5fa859504535-17"><span class="crayon-h">    </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a5fa859504535-18"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></p></div></td></tr></table></div></div><p> При использовании операции по взятию <a href="https://ru.wikipedia.org/wiki/%D0%94%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81_%D0%BE%D1%81%D1%82%D0%B0%D1%82%D0%BA%D0%BE%D0%BC" target="_blank">остатка от деления (%)</a> для <tt>currentFrame</tt> мы создаем непрерывный цикл чисел от 0 до <tt>endFrame</tt>. Таким образом мы воспроизводим только те кадры, изображения для которых у нас есть в spritesheet’е.</p><h4>Рисование анимации</h4><p>Вычисляем строку с нужным кадром, взяв остаток от деления номера текущего кадра на количество кадров в строке. Также вычисляем столбец с нужным кадром путем деления номера текущего кадра на количество кадров в строке.</p><p>Используя найденные величины мы можем найти координаты той рамки, внутри которой и находится искомый кадр:</p><div id="crayon-56d5ac572a601858546036" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ac572a601858546036-1"><span class="crayon-h">   </span><span class="crayon-c">// отрисовка текущего кадра</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a601858546036-2"><span class="crayon-h">   </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">draw</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5ac572a601858546036-3"><span class="crayon-h">      </span><span class="crayon-c">// вычисление столбика и строчки с нужным кадром</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a601858546036-4"><span class="crayon-h">      </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">framesPerRow</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a601858546036-5"><span class="crayon-h">      </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">framesPerRow</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a601858546036-6"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a601858546036-7"><span class="crayon-h">      </span><span class="crayon-v">ctx</span><span class="crayon-sy">.</span><span class="crayon-e">drawImage</span><span class="crayon-sy">(</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a601858546036-8"><span class="crayon-h">         </span><span class="crayon-v">image</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5ac572a601858546036-9"><span class="crayon-h">         </span><span class="crayon-e ">col *</span><span class="crayon-h"> </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e ">row *</span><span class="crayon-h"> </span><span class="crayon-v">frameHeight</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a601858546036-10"><span class="crayon-h">         </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameHeight</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5ac572a601858546036-11"><span class="crayon-h">         </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a601858546036-12"><span class="crayon-h">         </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameHeight</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a601858546036-13"><span class="crayon-h">  </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a601858546036-14"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> Теперь мы готовы создать анимацию:</p><div id="crayon-56d5ac572a606961080351" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ac572a606961080351-1"><span class="crayon-v">spritesheet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">SpriteSheet</span><span class="crayon-sy">(</span><span class="crayon-s">'Walk_Cycle_Image.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">125</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">125</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a606961080351-2"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a606961080351-3"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">animate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a606961080351-4"><span class="crayon-h">   </span><span class="crayon-e">requestAnimFrame</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-i">animate</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a606961080351-5"><span class="crayon-h">   </span><span class="crayon-v">ctx</span><span class="crayon-sy">.</span><span class="crayon-e">clearRect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a606961080351-6"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a606961080351-7"><span class="crayon-h">   </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a606961080351-8"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a606961080351-9"><span class="crayon-h">   </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-e">draw</span><span class="crayon-sy">(</span><span class="crayon-cn">12.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12.5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a606961080351-10"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p/><h3>Несколько циклов в одном spritesheet</h3><p>Приведенный выше код будет работать для любого spritesheet’а, содержащего ровно один цикл. Тем не менее, существуют spritesheet’ы с несколькими циклами (анимациями).</p><p>Для работы с несколькими анимациями в одном spritesheet’е, нам понадобится изменить наш принцип работы.</p><h4>Создание изображения</h4><p>Храним информацию об изображении и его размерах:</p><div id="crayon-56d5ac572a60c218701802" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"/><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ac572a60c218701802-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">SpriteSheet</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameHeight</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a60c218701802-2"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Image</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a60c218701802-3"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">frameWidth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">frameWidth</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a60c218701802-4"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">frameHeight</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">frameHeight</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a60c218701802-5"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a60c218701802-6"><span class="crayon-h">  </span><span class="crayon-c">// вычисление количества кадров в строке после загрузки изображения</span></p><p class="crayon-line" id="crayon-56d5ac572a60c218701802-7"><span class="crayon-h">  </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a60c218701802-8"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">onload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5ac572a60c218701802-9"><span class="crayon-h">    </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">framesPerRow</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">frameWidth</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a60c218701802-10"><span class="crayon-h">  </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a60c218701802-11"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a60c218701802-12"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a60c218701802-13"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p/><h4>Обновление и рисование анимации</h4><p>Функция <tt>Animation()</tt> будет отвечать за обновление и отрисовку картинки:</p><div id="crayon-56d5ac572a611087605950" class="crayon-syntax crayon-theme-classic crayon-font-courier-new crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"/><div class="crayon-main"><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums " data-settings="show"><div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-2">2</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-4">4</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-6">6</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-8">8</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-10">10</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-12">12</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-14">14</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-16">16</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-18">18</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-20">20</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-22">22</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-24">24</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-26">26</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-28">28</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-30">30</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-32">32</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-34">34</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-36">36</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-38">38</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-40">40</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-42">42</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-44">44</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ac572a611087605950-46">46</p><p class="crayon-num" data-line="crayon-56d5ac572a611087605950-47">47</p></div></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ac572a611087605950-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">Animation</span><span class="crayon-sy">(</span><span class="crayon-v">spritesheet</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frameSpeed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">startFrame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endFrame</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-2"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-3"><span class="crayon-h">  </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">animationSequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h">  </span><span class="crayon-c">// array holding the order of the animation</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-4"><span class="crayon-h">  </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h">        </span><span class="crayon-c">// the current frame to draw</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-5"><span class="crayon-h">  </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h">             </span><span class="crayon-c">// keep track of frame rate</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-6"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-7"><span class="crayon-h">  </span><span class="crayon-c">// создание последовательности из номеров кадров анимации</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-8"><span class="crayon-h">  </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">frameNumber</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">startFrame</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">frameNumber</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">endFrame</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">frameNumber</span><span class="crayon-o">++</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-9"><span class="crayon-h">    </span><span class="crayon-v">animationSequence</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-v">frameNumber</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-10"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-11"><span class="crayon-h">  </span><span class="crayon-c">// обновление анимации</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-12"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">update</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-13"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-14"><span class="crayon-h">    </span><span class="crayon-c">// если подошло время смены кадра, то меняем</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-15"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">frameSpeed</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-16"><span class="crayon-h">      </span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">currentFrame</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">animationSequence</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-17"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-18"><span class="crayon-h">    </span><span class="crayon-c">// обновление счетчика ожидания</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-19"><span class="crayon-h">    </span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">frameSpeed</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-20"><span class="crayon-h">  </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-21"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-22"><span class="crayon-h">  </span><span class="crayon-c">// отрисовка текущего кадра</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-23"><span class="crayon-h">  </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">draw</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-24"><span class="crayon-h">    </span><span class="crayon-c">// вычисление количества кадров в строке после загрузки изображения</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-25"><span class="crayon-h">    </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">animationSequence</span><span class="crayon-sy">[</span><span class="crayon-v">currentFrame</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">framesPerRow</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-26"><span class="crayon-h">    </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">animationSequence</span><span class="crayon-sy">[</span><span class="crayon-v">currentFrame</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">framesPerRow</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-27"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-28"><span class="crayon-h">    </span><span class="crayon-v">ctx</span><span class="crayon-sy">.</span><span class="crayon-e">drawImage</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-29"><span class="crayon-h">      </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-30"><span class="crayon-h">      </span><span class="crayon-e ">col *</span><span class="crayon-h"> </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e ">row *</span><span class="crayon-h"> </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">frameHeight</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-31"><span class="crayon-h">      </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">frameHeight</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-32"><span class="crayon-h">      </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-33"><span class="crayon-h">      </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">frameWidth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">spritesheet</span><span class="crayon-sy">.</span><span class="crayon-v">frameHeight</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-34"><span class="crayon-h">  </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-35"><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-36"><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-37"><span class="crayon-v">spritesheet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">SpriteSheet</span><span class="crayon-sy">(</span><span class="crayon-s">'Walk_Cycle_Image.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">125</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">125</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-38"><span class="crayon-v">walk</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Animation</span><span class="crayon-sy">(</span><span class="crayon-v">spritesheet</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">15</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-39"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-40"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">animate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-41"><span class="crayon-h">   </span><span class="crayon-e">requestAnimFrame</span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-i">animate</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-42"><span class="crayon-h">   </span><span class="crayon-v">ctx</span><span class="crayon-sy">.</span><span class="crayon-e">clearRect</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-43"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-44"><span class="crayon-h">   </span><span class="crayon-v">walk</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-45"><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ac572a611087605950-46"><span class="crayon-h">   </span><span class="crayon-v">walk</span><span class="crayon-sy">.</span><span class="crayon-e">draw</span><span class="crayon-sy">(</span><span class="crayon-cn">12.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12.5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-56d5ac572a611087605950-47"><span class="crayon-sy">}</span></p></div></td></tr></table></div></div><p> Поскольку spritesheet содержит множество кадров для различных анимаций, мы должны знать номера тех кадров, анимацию которых мы хотим сейчас воспроизводить.</p><h3>Послесловие</h3><p>Мы написали простенькую игру-раннер, используя ту самую анимацию, о которой говорилось в статье. Исходный код, приведенный в статье, вы можете увидеть, пройдя по <a href="https://github.com/tutsplus/kandi-runner/" target="_blank">этой ссылке</a>.</p><p align="right"><sub>Перевод статьи <a href="http://gamedevelopment.tutsplus.com/tutorials/an-introduction-to-spritesheet-animation--gamedev-13099" target="_blank">«An Introduction to Spritesheet Animation»</a></sub></p><footer class="entry-meta clearfix"><p class="vk_like" id="vk_like_bottom_8741"/></footer></div></div></body></html>