<html><body><div><p>Django authentication and authorization utilities.</p>
<div id="configuration">

<p>In order to use the <tt>auth_utils</tt> template tag library, add <tt>auth_utils</tt> to your <tt>INSTALLED_APPS</tt>.</p>
<p>Alternatively, since Django 1.9, you can add <tt>auth_utils.templatetags.auth_utils</tt> to your
<a href="https://docs.djangoproject.com/en/1.9/topics/templates/#django.template.backends.django.DjangoTemplates" rel="nofollow">DjangoTemplates</a> OPTIONS.</p>
</div>
<div id="usage">

<div id="permission-checking-views">

<p>The <tt>ObjectPermissionRequiredMixin</tt> view combines Django’s <a href="https://docs.djangoproject.com/en/1.9/topics/auth/default/#the-permissionrequiredmixin-mixin" rel="nofollow">PermissionRequiredMixin</a> and
<a href="https://docs.djangoproject.com/en/1.9/ref/class-based-views/mixins-single-object/#singleobjectmixin" rel="nofollow">SingleObjectMixin</a> views, and performs the permission check against the object that was looked up.</p>
<p>Use it like the base classes:</p>
<pre><span class="kn">from</span> <span class="nn">auth_utils.views</span> <span class="kn">import</span> <span class="n">ObjectPermissionRequiredMixin</span>


<span class="k">class</span> <span class="nc">ArticleDetail</span><span class="p">(</span><span class="n">ObjectPermissionRequiredMixin</span><span class="p">,</span> <span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'news.read_article'</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ArticleUpdate</span><span class="p">(</span><span class="n">ObjectPermissionRequiredMixin</span><span class="p">,</span> <span class="n">generic</span><span class="o">.</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'news.change_article'</span><span class="p">]</span>
</pre>
</div>
<div id="permission-checking-in-templates">

<p>Load the template tag library:</p>
<pre><span class="cp">{%</span> <span class="k">load</span> <span class="nv">auth_utils</span> <span class="cp">%}</span>
</pre>
<p>The <tt>perms</tt> filter allows checking object-level permissions with a convenient syntax:</p>
<pre><span class="cp">{%</span> <span class="k">if</span> <span class="nv">perm</span> <span class="k">in</span> <span class="nv">user</span><span class="o">|</span><span class="nf">perms</span><span class="o">:</span><span class="nv">object</span> <span class="cp">%}</span><span class="x"> ... </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre>
<p>The <tt>object</tt> argument is optional. If omitted, the global permission is checked,
similar to Django’s <a href="https://docs.djangoproject.com/en/1.9/topics/auth/default/#permissions" rel="nofollow">perms object</a>.</p>
<p>Examples:</p>
<pre><span class="cp">{%</span> <span class="k">if</span> <span class="s1">'news.read_article'</span> <span class="k">in</span> <span class="nv">user</span><span class="o">|</span><span class="nf">perms</span><span class="o">:</span><span class="nv">article</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nv">article.text</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    You do not have permission to read this article.
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">if</span> <span class="s1">'news.change_article'</span> <span class="k">in</span> <span class="nv">user</span><span class="o">|</span><span class="nf">perms</span><span class="o">:</span><span class="nv">article</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"..."</span><span class="p">&gt;</span>Edit article<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="s1">'news.delete_article'</span> <span class="k">in</span> <span class="nv">user</span><span class="o">|</span><span class="nf">perms</span><span class="o">:</span><span class="nv">article</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"..."</span><span class="p">&gt;</span>Delete article<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre>
<p>The library provides <tt>can_change</tt> and <tt>can_delete</tt> shorthands for checking Django’s default
<tt>app.change_model</tt> and <tt>app.delete_model</tt> model permissions:</p>
<pre><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user</span><span class="o">|</span><span class="nf">can_change</span><span class="o">:</span><span class="nv">article</span> <span class="cp">%}</span> <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"..."</span><span class="p">&gt;</span>Edit<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">user</span><span class="o">|</span><span class="nf">can_delete</span><span class="o">:</span><span class="nv">article</span> <span class="cp">%}</span> <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"..."</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre>
</div>
<div id="baseauthorizationbackend">

<p>This base class provides all the boilerplate code necessary for a Django <a href="https://docs.djangoproject.com/en/1.9/topics/auth/customizing/#writing-an-authentication-backend" rel="nofollow">authentication backend</a>
to work, without performing any user authentication or permission authorization itself.</p>
<p>This is intended to make it easy to write <a href="https://docs.djangoproject.com/en/1.9/topics/auth/customizing/#handling-authorization-in-custom-backends" rel="nofollow">custom authorization</a> policies that only implement the backend
methods they’re interested in:</p>
<pre><span class="kn">from</span> <span class="nn">auth_utils.backends</span> <span class="kn">import</span> <span class="n">BaseAuthorizationBackend</span>


<span class="k">class</span> <span class="nc">ArticleEditPolicy</span><span class="p">(</span><span class="n">BaseAuthorizationBackend</span><span class="p">):</span>
    <span class="sd">"""
    Allow authors to change and delete their own articles.
    """</span>

    <span class="k">def</span> <span class="nf">get_user_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">is_author</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Article</span><span class="p">)</span> <span class="ow">and</span> <span class="n">article</span><span class="o">.</span><span class="n">author</span> <span class="o">==</span> <span class="n">user_obj</span>
        <span class="k">if</span> <span class="n">user_obj</span><span class="o">.</span><span class="n">is_active</span> <span class="ow">and</span> <span class="n">is_author</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">'news.change_article'</span><span class="p">,</span> <span class="s1">'news.delete_article'</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GuestAccessPolicy</span><span class="p">(</span><span class="n">BaseAuthorizationBackend</span><span class="p">):</span>
    <span class="sd">"""
    Allow anonymous users to read non-premium articles.
    """</span>

    <span class="k">def</span> <span class="nf">get_user_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">guest_readable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Article</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">article</span><span class="o">.</span><span class="n">is_premium</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_obj</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">()</span> <span class="ow">and</span> <span class="n">guest_readable</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">'news.read_article'</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
</pre>
<p>Once defined, these policies can be enabled in <a href="https://docs.djangoproject.com/en/1.9/ref/settings/#std:setting-AUTHENTICATION_BACKENDS" rel="nofollow">AUTHENTICATION_BACKENDS</a>:</p>
<pre><span class="n">AUTHENTICATION_BACKENDS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'django.contrib.auth.backends.ModelBackend'</span><span class="p">,</span>

    <span class="c1"># Custom authorization policies</span>
    <span class="s1">'news.auth.ArticleEditPolicy'</span><span class="p">,</span>
    <span class="s1">'news.auth.GuestAccessPolicy'</span><span class="p">,</span>
<span class="p">]</span>
</pre>
</div>
</div>
</div></body></html>