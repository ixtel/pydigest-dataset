<html><body><div><div itemprop="articleBody">
      <p>I’m interning for my final year dissertation. My main goal is to find associations between medical data and <a href="https://en.wikipedia.org/wiki/Connectome">connectomes</a> <em>(map of neural connections in the brain)</em>. After lot of processing on the MRI Images, I end up having a square matrix with the estimated connectivity between the different brain areas.</p>

<p>A square matrix full of numbers is not the easiest thing to interpret for a human, so I decided that I needed a tool to be able to iterate over the brains in the different studies and quickly “<em>understand</em>” them. The classic approach that they suggested me was to do a <a href="http://stanford.edu/~mwaskom/software/seaborn/examples/network_correlations.html">correlation matrix with a heatmap</a>. I find them difficult to understand so I wanted to copy some of the chord diagrams I saw before in some articles and posters. Most of the chord graphs visualizations I found on google were done with <a href="http://bl.ocks.org/mbostock/4062006">d3.js</a>; which is not easy to integrate on a Python workflow.</p>

<p><a href="http://matplotlib.org/">Matplotlib</a>, <a href="http://stanford.edu/~mwaskom/software/seaborn/">Seaborn</a> or <a href="http://bokeh.pydata.org/en/latest/">Bokeh</a> are the libraries I’m used to work with, so I took it as a personal challenge and I started the adventure of creating a chord graph with one of those libraries. I like interactivity a lot, so I finally end up using <a href="http://bokeh.pydata.org/en/latest/">Bokeh</a>.</p>

<h3 id="creating-a-circle-of-dots">Creating a circle of dots</h3>

<p>The first idea I came up with was to assign <strong>each area a dot in a circle</strong> an then draw the connections between the areas. I made a function to create dinamically the <em>x</em> and <em>y</em> of each point in a circle given a <em>n</em> number of areas; as I might use different approaches sometimes.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span>

<span class="k">def</span> <span class="nf">draw_circle_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">centerX</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">centerY</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">part</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">points</span>
    <span class="n">final_points</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">part</span> <span class="o">*</span> <span class="n">point</span><span class="p">;</span>
        <span class="n">newX</span> <span class="o">=</span> <span class="n">centerX</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">newY</span> <span class="o">=</span> <span class="n">centerY</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">final_points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">newX</span><span class="p">,</span> <span class="n">newY</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">final_points</span></code></pre></figure>

<h3 id="creating-the-lines">Creating the lines</h3>

<p>Now that I had each area as a point in the graph, I needed to add the lines from one area to the other using the <em>x,y</em> array I just got. In order to remove the connections that were very weak, I added a hardness parameter to the function that will ignore those area connections connected by less than 20 estimated connections.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="c"># Emulate a connectome</span>
<span class="n">connectome</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span><span class="mi">85</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">connectomme_lines</span><span class="p">(</span><span class="n">connectome</span><span class="p">,</span> <span class="n">hardness</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">number_of_areas</span> <span class="o">=</span> <span class="n">connectome</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">draw_circle_points</span><span class="p">(</span><span class="n">number_of_areas</span><span class="p">)</span>

    <span class="n">final_positions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">area_name</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">area1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectome</span><span class="p">):</span>
        <span class="n">commonXY</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index2</span><span class="p">,</span> <span class="n">area2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">area1</span><span class="p">):</span>
            <span class="n">newXY</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">index2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">area2</span> <span class="o">&gt;</span> <span class="n">hardness</span><span class="p">:</span>
                <span class="n">final_positions</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="n">commonXY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newXY</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">commonXY</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">newXY</span><span class="p">[</span><span class="mi">1</span><span class="p">]]])</span>

    <span class="k">return</span> <span class="n">final_positions</span>

<span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectomme_lines</span><span class="p">(</span><span class="n">connectome</span><span class="p">))</span><span class="o">.</span><span class="n">T</span></code></pre></figure>

<p>The lines array was generated and it needed to be transposed to be easier to work with it.</p>

<h3 id="lets-plot-this-">Let’s plot this !</h3>

<p>Time to make <a href="http://bokeh.pydata.org/en/latest/">Bokeh</a> work. As I was going to plot lot of lines, curved lines (bezier lines) seemed a better option than straight lines. I gave a fixed curvature to all of them so I didn’t have to worry about that.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">Range1d</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Connectomme"</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s">"below"</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">bezier</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
         <span class="n">y0</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
         <span class="n">cx0</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
         <span class="n">cy0</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
         <span class="n">cx1</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
         <span class="n">cy1</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
         <span class="n">x1</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
         <span class="n">y1</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code></pre></figure>

<p>A preview:</p>

<p class="embed-container bokeh">
    
</p>

<p>So we had a bunch of lines in the form of a chord diagram, but nothing easy to understand. I thought that giving each line the color of the area it was originated from could be a great idea. Other thing that the graph was not considering at the moment was the number of connections between the areas; zero to thousands depending in the case. Standardization of the number of connections and plotting them as the difference in the width of a connection seemed like a good approach to quantify the strength of the connection.</p>

<h3 id="counting-the-number-of-connections">Counting the number of connections</h3>
<p>To modify the width of the lines, we just need add one parameter to our bezier object.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">width_of_lines</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">hardness</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">flat</span> <span class="o">=</span> <span class="n">f</span><span class="p">[(</span><span class="n">f</span> <span class="o">&gt;</span> <span class="n">hardness</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">flat</span><span class="o">/</span><span class="n">flat</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span></code></pre></figure>

<p>As the standardized values were too low for bokeh, I broadcasted a multiplication to be able to have some visible lines.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">connections_standardized</span> <span class="o">=</span> <span class="n">width_of_lines</span><span class="p">(</span><span class="n">connectome</span><span class="p">)</span> <span class="o">*</span> <span class="mi">150</span></code></pre></figure>

<p>In order to create the glyphs information only once and reuse it in different plots, ColumnDataSource let’s you define the data in a variable and then use it when you create a glyph in a plot.</p>

<p>Now the plot, the glyphs and the data source were three different things defined independently.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span>
<span class="c"># The Data</span>
<span class="n">beziers</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">({</span>
            <span class="s">'x0'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s">'y0'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">'x1'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s">'y1'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">'cx0'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1.5</span><span class="p">,</span>
            <span class="s">'cy0'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1.5</span><span class="p">,</span>
            <span class="s">'cx1'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1.5</span><span class="p">,</span>
            <span class="s">'cy1'</span> <span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1.5</span>
        <span class="p">})</span>

<span class="n">dots</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># The Plot</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Connectomme"</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s">"below"</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># The Glyphs</span>
<span class="n">p2</span><span class="o">.</span><span class="n">bezier</span><span class="p">(</span><span class="s">'x0'</span><span class="p">,</span> <span class="s">'y0'</span><span class="p">,</span> <span class="s">'x1'</span><span class="p">,</span> <span class="s">'y1'</span><span class="p">,</span> <span class="s">'cx0'</span><span class="p">,</span> <span class="s">'cy0'</span><span class="p">,</span> <span class="s">'cx1'</span><span class="p">,</span> <span class="s">'cy1'</span><span class="p">,</span>
          <span class="n">source</span><span class="o">=</span><span class="n">beziers</span><span class="p">,</span>
          <span class="n">line_cap</span><span class="o">=</span><span class="s">'round'</span><span class="p">,</span>
          <span class="n">line_width</span><span class="o">=</span><span class="n">connections_standardized</span><span class="p">)</span> <span class="c"># Add the width</span>

<span class="n">p2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s">"#6D6A75"</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">dots</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span></code></pre></figure>

<p>When adding the curve glyphs to the plot <code class="highlighter-rouge">line_width</code> set the width of each line.</p>

<p class="embed-container bokeh">
    
</p>

<h3 id="coloring-the-brain">Coloring the brain</h3>

<p><img src="/assets/img/posts/lobes.svg"/>
Coloring the brain wasn’t something new for me, but in this case assigning so many areas a unique color required some research in color theory.</p>

<p>Creating random color values without too dark or too bright colors is not an easy task. There are different ways of defining a color but the most usual one is using RGB, that stands for red, green, blue. If you use RGB to create random color, the usual output is to have some awful colors that variate a lot in their brightness. I found out that using the HSV method (hue, saturation, value), you can set two of the parameters fixed and generate random colors in a similar color space just by modifying the hue.</p>

<p><img src="/assets/img/posts/hsv.png"/></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">colorsys</span> <span class="kn">import</span> <span class="n">hsv_to_rgb</span>

<span class="k">def</span> <span class="nf">gen_color</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="c"># Source: http://www.goldennumber.net/color/</span>
    <span class="n">golden_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">h</span> <span class="o">+=</span> <span class="n">golden_ratio</span>
    <span class="n">h</span> <span class="o">%=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s">'#</span><span class="si">%02</span><span class="s">x</span><span class="si">%02</span><span class="s">x</span><span class="si">%02</span><span class="s">x'</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">))</span>

<span class="n">area_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen_color</span><span class="p">(</span><span class="n">area</span><span class="o">/</span><span class="n">connectome</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">connectome</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span></code></pre></figure>

<p>I needed now to iterate over the matrix to assign each line the correct color depending in the area it was originated from.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">lines_colors</span><span class="p">(</span><span class="n">connectome</span><span class="p">,</span> <span class="n">area_colors</span><span class="p">,</span> <span class="n">hardness</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">area1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectome</span><span class="p">):</span>
        <span class="n">area_hsv</span> <span class="o">=</span> <span class="n">area_colors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">area2</span> <span class="ow">in</span> <span class="n">area1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">area2</span> <span class="o">&gt;</span> <span class="n">hardness</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area_hsv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colors</span>

<span class="n">area_colors_lines</span> <span class="o">=</span> <span class="n">lines_colors</span><span class="p">(</span><span class="n">connectome</span><span class="p">,</span> <span class="n">area_colors</span><span class="p">)</span></code></pre></figure>

<p>Now let’s plot the same chord diagram with colors</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p3</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Connectomme"</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s">"below"</span><span class="p">)</span>

<span class="n">p3</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p3</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="n">p3</span><span class="o">.</span><span class="n">bezier</span><span class="p">(</span><span class="s">'x0'</span><span class="p">,</span> <span class="s">'y0'</span><span class="p">,</span> <span class="s">'x1'</span><span class="p">,</span> <span class="s">'y1'</span><span class="p">,</span> <span class="s">'cx0'</span><span class="p">,</span> <span class="s">'cy0'</span><span class="p">,</span> <span class="s">'cx1'</span><span class="p">,</span> <span class="s">'cy1'</span><span class="p">,</span>
          <span class="n">source</span><span class="o">=</span><span class="n">beziers</span><span class="p">,</span>
          <span class="n">line_cap</span><span class="o">=</span><span class="s">'round'</span><span class="p">,</span>
          <span class="n">line_width</span><span class="o">=</span><span class="n">connections_standardized</span><span class="p">,</span>
          <span class="n">line_color</span><span class="o">=</span><span class="n">area_colors_lines</span>
         <span class="p">)</span>

<span class="n">p3</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">area_colors</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">dots</span><span class="p">)</span></code></pre></figure>

<p class="embed-container bokeh">
    
</p>

<h3 id="adding-interactivity-to-the-plot">Adding interactivity to the plot</h3>
<p>Having such a cool plot needed a way to interact with it. <a href="http://bokeh.pydata.org/en/latest/">Bokeh</a> offers some tools like <a href="http://bokeh.pydata.org/en/latest/docs/reference/models/tools.html#bokeh.models.tools.HoverTool">HoverTool</a> for that. The hover tool displays informational tooltips whenever the cursor is directly over a glyph, in this case I used the circles to show the area it was representing.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">area_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'area_names.csv'</span><span class="p">)</span>
<span class="n">area_names</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"num"</span><span class="p">,</span> <span class="s">"names"</span><span class="p">]</span>
<span class="n">area_names</span><span class="p">[</span><span class="s">"names"</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_names</span><span class="p">[</span><span class="s">"names"</span><span class="p">]</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">)</span></code></pre></figure>

<p>The dot’s data was modified again, as we needed to include the data to be shown when the mouse is hover the point.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bokeh.models.tools</span> <span class="kn">import</span> <span class="n">HoverTool</span>
<span class="c"># Area's dots</span>
<span class="n">dots_interactive</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">y</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="n">desc</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">area_names</span><span class="p">[</span><span class="s">"names"</span><span class="p">]))</span>
                                    <span class="p">)</span>

<span class="c"># Hover tools</span>
<span class="n">hover_dots</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span>
    <span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s">"Area"</span><span class="p">,</span> <span class="s">" @desc"</span><span class="p">)],</span>
    <span class="n">point_policy</span><span class="o">=</span><span class="s">'snap_to_data'</span>
<span class="p">)</span></code></pre></figure>

<p>We plot again.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p4</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Connectomme"</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s">"below"</span><span class="p">)</span>

<span class="n">p4</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">p4</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="n">p4</span><span class="o">.</span><span class="n">bezier</span><span class="p">(</span><span class="s">'x0'</span><span class="p">,</span> <span class="s">'y0'</span><span class="p">,</span> <span class="s">'x1'</span><span class="p">,</span> <span class="s">'y1'</span><span class="p">,</span> <span class="s">'cx0'</span><span class="p">,</span> <span class="s">'cy0'</span><span class="p">,</span> <span class="s">'cx1'</span><span class="p">,</span> <span class="s">'cy1'</span><span class="p">,</span>
          <span class="n">source</span><span class="o">=</span><span class="n">beziers</span><span class="p">,</span>
          <span class="n">line_cap</span><span class="o">=</span><span class="s">'round'</span><span class="p">,</span>
          <span class="n">line_width</span><span class="o">=</span><span class="n">connections_standardized</span><span class="p">,</span>
          <span class="n">line_color</span><span class="o">=</span><span class="n">area_colors_lines</span>
         <span class="p">)</span>

<span class="n">p4</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">area_colors</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">dots_interactive</span><span class="p">)</span></code></pre></figure>

<p>We include the new tool and Voilá !</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p4</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover_dots</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p4</span><span class="p">)</span></code></pre></figure>

<p class="embed-container bokeh">
    
</p>

<p><strong><em>NOTE: The order of the labels in this specific case is not the correct one. I’ll correct it soon.</em></strong></p>

<p>And this is so far what I did but this still work on progress and I’ll show more soon.
Thanks for passing by !</p>


    </div>
    </div></body></html>