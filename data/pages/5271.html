<html><body><div><div class="post-text" itemprop="text">

<p>I have a test code which uses an FTP stub with pyftpdlib, which to my surprise failed in production. The reason for this is that proftpd returns the directory name in response to <code>NLST</code>. Here is the response from <code>pyftpdlib</code> FTP stub:</p>

<pre><code>In [10]: local_conn.login('user', '12345')
Out[10]: '230 Login successful.'

In [11]: import ftplib

In [12]: local_conn = ftplib.FTP()

In [13]: local_conn.connect('localhost', 2121)
Out[13]: '220 pyftpdlib 1.4.0 ready.'

In [14]: local_conn.login('user', '12345')
Out[14]: '230 Login successful.'

In [15]: local_conn.nlst('structuredata_advanced')
Out[15]: 
['Report_20150618.csv',
 'Report_20150618.fin',
 'Report_20150619.csv',
 'Report_20150619.fin',
 'Report_20150620.csv',
 'Report_20150620.fin']
</code></pre>

<p>Here is the response from <code>proftpd</code>:</p>

<pre><code>In [16]: remote_conn = ftplib.FTP()

In [17]: remote_conn.connect('A1B.7Y.XX.XX', 21)
Out[17]: '220 ProFTPD 1.3.4a Server (vztd3.company.com) [A1B.7Y.XX.XX]'

In [18]: remote_conn.login('remoteuser', 'verysecret')
Out[18]: '230 User yougov logged in'

In [19]: remote_conn.nlst('structuredata_advanced')
Out[19]: 
['structuredata_advanced/Report_20150624.csv',
 'structuredata_advanced/Report_20150629.csv',
 'structuredata_advanced/Report_20150625.fin',
 'structuredata_advanced/Report_20150628.fin',
 'structuredata_advanced/Report_20150627.fin',
 'structuredata_advanced/Report_20150620.fin',
 'structuredata_advanced/Report_20150619.csv', 
  ...]
</code></pre>

<p>It's easy enough to remove those directory names:</p>

<pre><code>    # this code works both in production and testing 
    files = conn.nlst(basedir)
    # proftd is weired it returns the basedir name too
    files = [f.split('/')[-1] for f in files]
</code></pre>

<p>but I would like to understand if this is something that pyftpdlib does wrong?<br/>
Is this something that can be configured in <code>ProFTPD</code>?<br/>
Is there something I need to know about the FTP protocol and NLST command?</p>

<h2>update</h2>

<p>I just tested another ftp server called <a href="https://github.com/troglobit/uftpd/"><code>uftpd</code></a> it behaves like <code>pyftpdlib</code> when issuing <code>NLST</code>. </p>
    </div>
    </div></body></html>