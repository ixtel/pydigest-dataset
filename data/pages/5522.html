<html><body><div><div id="usage">
<h2>Usage</h2>
<p>The iiif2 library includes an image processing component called IIIF,
responsible for implementing the iiif image processing pipeline, and a
Parse utility capable of extracting iiif parameters and their data
from uris.</p>
<pre><span class="kn">from</span> <span class="nn">iiif2</span> <span class="kn">import</span> <span class="n">IIIF</span>
<span class="kn">from</span> <span class="nn">iiif2.web</span> <span class="kn">import</span> <span class="n">Parse</span>
</pre>
<p>You can combine the IIIF and Parse objects to create iiif 2.0 image
tiles using only:</p>
<ul>
<li>a iiif image 2.0 uri and</li>
<li>a resolved image filepath</li>
</ul>
<p>An image path may be provided in one of two ways. First, it can be
manually specified as a string:</p>
<pre><span class="kn">from</span> <span class="nn">iiif2</span> <span class="kn">import</span> <span class="n">IIIF</span><span class="p">,</span> <span class="n">web</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">'https://stacks.stanford.edu/image/iiif/'</span>
      <span class="s1">'ff139pd0160</span><span class="si">%252F</span><span class="s1">K90113-43/full/full/0/default.jpg'</span>

<span class="c1"># a web server can return a rendered tile directly</span>
<span class="c1"># without ever saving tile to disk. Works on read-only fs:</span>
<span class="n">tile</span> <span class="o">=</span> <span class="n">IIIF</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">'images/file.jpg'</span><span class="p">,</span> <span class="o">*</span><span class="n">web</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

<span class="c1"># if we want, we can save tile (e.g. for caching)</span>
<span class="n">tile</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'cache/</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="n">web</span><span class="o">.</span><span class="n">urihash</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</pre>
</div>
<div id="example-web-service">
<h2>Example Web Service</h2>
<p>An entire IIIF Web Service written in Flask in ~30 lines of code is
provided in the examples/ folder.</p>
<pre><span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">send_file</span>
<span class="kn">from</span> <span class="nn">iiif2</span> <span class="kn">import</span> <span class="n">IIIF</span><span class="p">,</span> <span class="n">web</span>

<span class="n">PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/&lt;identifier&gt;/info.json'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url_root</span><span class="p">,</span> <span class="n">identifier</span><span class="p">))</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s1">'/&lt;identifier&gt;/&lt;region&gt;/&lt;size&gt;/&lt;rotation&gt;/&lt;quality&gt;.&lt;fmt&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">iiif</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Parse</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'identifier'</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">IIIF</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">tile</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">tile</span><span class="o">.</span><span class="n">mime</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>
    <span class="sd">"""Resolves a iiif identifier to the resource's path on disk.
    This method is specific to this server's architecture.
    """</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH</span><span class="p">,</span> <span class="s1">'images'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%s</span><span class="s1">.jpg'</span> <span class="o">%</span> <span class="n">identifier</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
</div>


</div></body></html>