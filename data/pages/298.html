<html><body><div><div class="content html_format">
      <b>Python </b><p> — красивый и местами загадочный язык. И даже зная его весьма неплохо, рано или поздно находишь для себя нечто такое, что раньше не использовал. Этот пост отражает некоторые детали языка, на которые многие не обращают внимание. Сразу скажу: многие примеры являются непрактичными, но, оттого, не менее интересными. Так же, многие примеры демонстрируют unpythonic стиль, но я и не претендую на новые стандарты — я просто хочу показать, что можно делать вот так.
</p><a name="habracut"/>
<b>1. Бесконечно вложенный список</b>

<pre><code class="python">&gt;&gt;&gt; a = [1, 2, 3, 4]
&gt;&gt;&gt; a.append(a)
&gt;&gt;&gt; a
[1, 2, 3, 4, [...]]
&gt;&gt;&gt; a[4]
[1, 2, 3, 4, [...]]
&gt;&gt;&gt; a[4][4][4][4][4][4][4][4][4][4] == a
True
</code></pre><p>
То же самое со словарями:
</p><pre><code class="python">&gt;&gt;&gt; a = {}
&gt;&gt;&gt; b = {}
&gt;&gt;&gt; a['b'] = b
&gt;&gt;&gt; b['a'] = a
&gt;&gt;&gt; print a
{'b': {'a': {...}}}
</code></pre>

<b>2. Форматирование списка</b>

<pre><code class="python">&gt;&gt;&gt; l = [[1, 2, 3], [4, 5], [6], [7, 8, 9]]
&gt;&gt;&gt; sum(l, [])
[1, 2, 3, 4, 5, 6, 7, 8, 9]
</code></pre><p>
Генератором списков (</p><a href="http://habrahabr.ru/post/207988/#comment_7161392">спасибо</a><a href="http://habrahabr.ru/users/magic4x/" class="user_link">magic4x</a><p>):
</p><pre><code class="python">[y for x in data for y in x]
</code></pre><p>
Альтернативные, но более длинные варианты (</p><a href="http://habrahabr.ru/post/207988/#comment_7161280">спасибо</a> <a href="http://habrahabr.ru/users/monolithed/" class="user_link">monolithed</a><p>): 
</p><pre><code class="python">import itertools
data = [[1, 2, 3], [4, 5, 6]]
list(itertools.chain.from_iterable(data))
</code></pre>
<pre><code class="python">from functools import reduce
from operator import add
data = [[1, 2, 3], [4, 5, 6]]
reduce(add, data)
</code></pre>

<b>3. Генератор словарей</b>
<p>
Многие знают про генератор списков, а как насчет генераторов словарей?
</p><pre><code class="python">&gt;&gt;&gt; {a:a**2 for a in range(1, 10)}
{1: 1, 2: 4, 3: 9, 4: 16, 5: 25, 6: 36, 7: 49, 8: 64, 9: 81}
</code></pre>

<b>4. Одноразовая функция в классе</b>
<p>
На тот случай, если вам нужна функция, которая будет использоваться всего один раз, после чего будет использоваться другая функция:
</p><pre><code class="python">class foo:
    def normal_call(self):
        print("normal_call")
    def call(self):
        print("first_call")
        self.call = self.normal_call
</code></pre>
<pre><code class="python">&gt;&gt;&gt; y = foo()
&gt;&gt;&gt; y.call()
first_call
&gt;&gt;&gt; y.call()
normal_call
&gt;&gt;&gt; y.call()
normal_call
</code></pre>

<b>5. Получение аттрибутов класса</b>

<pre><code class="python">class GetAttr(object):
	def __getattribute__(self, name):
		f = lambda: "Hello {}".format(name)
		return f
</code></pre>
<pre><code class="python">&gt;&gt;&gt; g = GetAttr()
&gt;&gt;&gt; g.Mark()
'Hello Mark'
</code></pre>

<b>6. Операции над множествами</b>
<p>
Set — множество, в котором отсутствуют повторяющиеся элементы:
</p><pre><code class="python">&gt;&gt;&gt; a = set([1,2,3,4])
&gt;&gt;&gt; b = set([3,4,5,6])
&gt;&gt;&gt; a | b # Объединение
{1, 2, 3, 4, 5, 6}
&gt;&gt;&gt; a &amp; b # Пересечение
{3, 4}
&gt;&gt;&gt; a &lt; b # Подмножества
False
&gt;&gt;&gt; a - b # Разница
{1, 2}
&gt;&gt;&gt; a ^ b # Симметрическая разность
{1, 2, 5, 6}
</code></pre><p>
Без множества set эти операции работать не будут. Если только это не генератор множеств (</p><a href="http://habrahabr.ru/post/207988/#comment_7162076">спасибо</a> <a href="http://habrahabr.ru/users/zyxi/" class="user_link">ZyXI</a><p>):
</p><pre><code class="python">{ x for x in range(10)} # Генератор множеств

set([1, 2, 3]) == {1, 2, 3}
set((i*2 for i in range(10))) == {i*2 for i in range(10)}
</code></pre>

<b>7. Операторы сравнения</b>

<pre><code class="python">&gt;&gt;&gt; x = 5
&gt;&gt;&gt; 1 &lt; x &lt; 10
True
&gt;&gt;&gt; 10 &lt; x &lt; 20 
False
&gt;&gt;&gt; x &lt; 10 &lt; x*10 &lt; 100
True
&gt;&gt;&gt; 10 &gt; x &lt;= 9
True
&gt;&gt;&gt; 5 == x &gt; 4
True
</code></pre>

<b>8. Динамичное создание новых классов</b>

<pre><code class="python">&gt;&gt;&gt; NewType = type("NewType", (object,), {"x": "hello"})
&gt;&gt;&gt; n = NewType()
&gt;&gt;&gt; n.x
'hello'
</code></pre><p>
Этот же вариант в обычном виде: 
</p><pre><code class="python">&gt;&gt;&gt; class NewType(object):
&gt;&gt;&gt;     x = "hello"
&gt;&gt;&gt; n = NewType()
&gt;&gt;&gt; n.x
"hello"
</code></pre>

<b>9. Подавление исключения «KeyError» в словарях</b>
<p>
В словарях существует метод </p><i>.get()</i><p>. В обычном случае, если вы вызываете несуществующий ключ </p><i>name_dict['key']</i><p>, вы получите исключение KeyError. Однако, если вызвать ключ через метод </p><i>d.get('key')</i><p>, то исключения не будет и, если ключа нет, то словарь возвратит None. Если вы хотите назначить переменную вместо отсутствующего ключа, то можно назначить второй параметр: </p><i>d.get('key', 0)</i><p>.
</p><p>
Лучше всего это применять при переборе числовых ключей:
</p><pre><code class="python">sum[value] = sum.get(value, 0) + 1
</code></pre>

<b>10. Добавление в список, находящийся в словаре</b>
<p>
Если вам необходимо хранить несколько значений ключей, то вы можете хранить их в списке:

</p><pre><code class="python">&gt;&gt;&gt; d = {}
&gt;&gt;&gt; a, b = 4, 5
&gt;&gt;&gt; d[a] = list()
&gt;&gt;&gt; d
{4: []}
&gt;&gt;&gt; d[a].append(b)
&gt;&gt;&gt; d
{4: [5]}
</code></pre>

<b>11. Назначение переменных по условию</b>

<pre><code class="python">x = 1 if (y == 10) else 2 # X равно 1, при условии, что Y равен 10. Если это не так - X равен 2
x = 3 if (y == 1) else 2 if (y == -1) else 1  # Более длинное условие. Не используйте здесь elif
</code></pre>

<b>12. Распаковка значений на переменные</b>
<p>
Если при присваивании значений их окажется больше переменных — добавьте в начало имени переменной звездочку и ей будут присвоены остальные переменные (только Python 3.x):
</p><pre><code class="python">&gt;&gt;&gt; first,second,*rest = (1,2,3,4,5,6,7,8)
&gt;&gt;&gt; first # Первое значение
1
&gt;&gt;&gt; second # Второе значение
2
&gt;&gt;&gt; rest # Все остальные значения
[3, 4, 5, 6, 7, 8]
</code></pre>
<pre><code class="python">&gt;&gt;&gt; first,*rest,last = (1,2,3,4,5,6,7,8)
&gt;&gt;&gt; first
1
&gt;&gt;&gt; rest
[2, 3, 4, 5, 6, 7]
&gt;&gt;&gt; last
8
</code></pre>

<b>13. Нумерация элементов списка</b>

<pre><code class="python">&gt;&gt;&gt; l = ["spam", "ham", "eggs"]
&gt;&gt;&gt; list(enumerate(l)) 
&gt;&gt;&gt; [(0, "spam"), (1, "ham"), (2, "eggs")]
&gt;&gt;&gt; list(enumerate(l, 1)) # Можно указать начало нумерации в качестве аргумента
&gt;&gt;&gt; [(1, "spam"), (2, "ham"), (3, "eggs")]
</code></pre>

<b>14. Использование <i>else</i> в исключениях</b>
<p>
Спасибо за исправление </p><a href="http://habrahabr.ru/users/animeshneg/" class="user_link">animeshneG</a>
<pre><code class="python">try: 
  function()
except Error:
  # Если не сработал try и объявлена ошибка Error
else:
  # Если сработал try и не сработал except
finally:
  # Выполняется в любом случае
</code></pre>

<b>15. Создание копии списка</b>
<p>
При создании копии обычным методом произойдет следующее:
</p><pre><code class="python">&gt;&gt;&gt; x = [1, 2, 3]
&gt;&gt;&gt; y = x
&gt;&gt;&gt; y[2] = 5
&gt;&gt;&gt; y
[1, 2, 5]
&gt;&gt;&gt; x
[1, 2, 5]
</code></pre><p>
Правильный вариант:
</p><pre><code class="python">&gt;&gt;&gt; x = [1,2,3]
&gt;&gt;&gt; y = x[:]
&gt;&gt;&gt; y.pop()
3
&gt;&gt;&gt; y
[1, 2]
&gt;&gt;&gt; x
[1, 2, 3]
</code></pre><p>
Копирование вложенных списков\словарей (</p><a href="http://habrahabr.ru/post/207988/#comment_7161248">спасибо</a> <a href="http://habrahabr.ru/users/denisbalyko/" class="user_link">denisbalyko</a><p>)
</p><pre><code class="python">import copy
my_dict = {'a': [1, 2, 3], 'b': [4, 5, 6]} 
my_copy_dict = copy.deepcopy(my_dict)
</code></pre>

<b>16. Нумерация в <i>for</i></b>
<p>
Для нумерации элементов при выводе через цикл </p><i>for</i><p> используйте метод </p><i>enumerate</i>
<pre><code class="python">&gt;&gt;&gt; l = ['a', 'b', 'c', 'd', 'e']
&gt;&gt;&gt; for i, value_list in enumerate(l, 1): # Аттрибут 1 - начало сортировки
&gt;&gt;&gt;     print(i, value_list)
...     
1 a
2 b
3 c
4 d
5 e
</code></pre>

<b>17. Значения функции по умолчанию</b>
<p>
При назначении функциям неправильные аргументы по умолчанию может получится нечто такое:
</p><pre><code class="python">&gt;&gt;&gt; def foo(x=[]):
...     x.append(1)
...     print x
... 
&gt;&gt;&gt; foo()
[1]
&gt;&gt;&gt; foo() 
[1, 1] # А должно быть [1]
&gt;&gt;&gt; foo()
[1, 1, 1]
</code></pre>
<p>
Вместо этого присваивайте аргументу значение None по умолчанию:
</p><pre><code class="python">&gt;&gt;&gt; def foo(x=None):
...     if x is None:
...         x = []
...     x.append(1)
...     print x
&gt;&gt;&gt; foo()
[1]
&gt;&gt;&gt; foo()
[1]
</code></pre>

<b>18. Метод <i>__missing__</i> для словарей</b>
<p>
Метод </p><i>__missing__</i><p> позволяет избавить от исключения KeyError, возвращая вместо ошибки — имя запрошенного ключа.
</p><pre><code class="python">class MyDict(dict): # Функция создания словаря
    def __missing__(self, key):
        return key
...
&gt;&gt;&gt; m = MyDict(a=1, b=2, c=3) # Создание словаря через функцию
&gt;&gt;&gt; m
{'a': 1, 'c': 3, 'b': 2}
&gt;&gt;&gt; m['a'] # Ключ существует и вернет 1
1
&gt;&gt;&gt; m['z'] # Ключа не существует и вернет имя запрошенног ключа
'z' 
</code></pre>

<b>19. Декораторы</b>

<a href="http://docs.python.org/ref/function.html#tok-decorators">Декораторы</a><p> позволяют обернуть одну функцию другой, добавляя в нее функциональные возможности. Для обозначения декоратора на строку выше функции вы пишите знак "@«и имя функции. Пример:
</p><pre><code class="python">&gt;&gt;&gt; def print_args(function):
&gt;&gt;&gt;     def wrapper(*args, **kwargs):
&gt;&gt;&gt;         print 'Аргументы функции: ', args, kwargs
&gt;&gt;&gt;         return function(*args, **kwargs)
&gt;&gt;&gt;     return wrapper

&gt;&gt;&gt; @print_args
&gt;&gt;&gt; def write(text):
&gt;&gt;&gt;     print text
&gt;&gt;&gt; write('foo')
Arguments: ('foo',) {}
foo
</code></pre><p>
Объяснить попроще может только документация: 
</p><pre><code class="python">@f1(arg)
@f2
def func(): pass
</code></pre><p>
эквивалентно коду
</p><pre><code class="python">def func(): pass
func = f1(arg)(f2(func))
</code></pre>

<b>20. Обмен значениями между переменными</b>

<pre><code class="python">&gt;&gt;&gt; a = 10
&gt;&gt;&gt; b = 5
&gt;&gt;&gt; a, b
(10, 5)
&gt;&gt;&gt; a, b = b, a
&gt;&gt;&gt; a, b
(5, 10)
</code></pre>

<b>21. Функции первого класса</b>

<pre><code class="python">&gt;&gt;&gt; def jim(phrase):
...   return 'Jim says, "%s".' % phrase
&gt;&gt;&gt; def say_something(person, phrase):
...   print person(phrase)

&gt;&gt;&gt; say_something(jim, 'hey guys') # Передаем второй функции первую
'Jim says, "hey guys".'
</code></pre>
<p>
Функции высшего порядка (</p><a href="http://habrahabr.ru/post/207988/#comment_7161838">спасибо</a> <a href="http://habrahabr.ru/users/andrey_solomatin/" class="user_link">Andrey_Solomatin</a><p>):
</p><pre><code class="python"># Здесь рассматривается функция высшего порядка g(), которая в качестве первого аргумента принимает функцию. 
# В результате на экран будет выведено  "100" (результат вычисления (7+3)×(7+3)).
def f(x):
    return x + 3
 
def g(function, x):
    return function(x) * function(x)
 
print g(f, 7)
</code></pre>

<b>22. Отрицательный round</b>

<pre><code class="python">&gt;&gt;&gt; round(1234.5678, -2)
1200.0
&gt;&gt;&gt; round(1234.5678, 2)
1234.57
</code></pre>

<b>23. Дзен Python'a</b>

<pre><code class="python">import this
</code></pre>

<b>24. Использование стиля C т.е. {} вместо отступов</b>
<p>
Это, возможно, зло, но если вам хочется использовать скобки {} вместо отступов, для обозначения областей:
</p><pre><code class="python">from __future__ import braces
</code></pre>

<b>25. Шаг в срезе списка</b>

<pre><code class="python">a = [1,2,3,4,5]
&gt;&gt;&gt; a[::2]  # Указываем шаг
[1,3,5]
</code></pre><p>
Значение -1 равносильно методу </p><i>reverse</i><p> — переворачивает список:
</p><pre><code class="python">&gt;&gt;&gt; a[::-1] # Переворачиваем список
[5,4,3,2,1]
</code></pre>

<b>26. Открытие вкладки в браузере</b>
<p>
Открывает вкладку с указанным адресом в браузере по умолчанию.
</p><pre><code class="python">import webbrowser
webbrowser.open_new_tab('http://habrahabr.ru/') # Вернет True и откроет вкладку
</code></pre>

<b>27. <i>zip</i>. Объединение списков</b>

<pre><code class="python">a = [(1,2), (3,4), (5,6)]
zip(*a)
# [(1, 3, 5), (2, 4, 6)]
</code></pre><p>
Слияние двух списков в словарь:
</p><pre><code class="python">&gt;&gt;&gt; t1 = (1, 2, 3)
&gt;&gt;&gt; t2 = (4, 5, 6)
&gt;&gt;&gt; dict (zip(t1,t2))
{1: 4, 2: 5, 3: 6}
</code></pre>

<b>28. Срезы в списках и работа с ними</b>

<pre><code class="python">&gt;&gt;&gt; a = range(10)
&gt;&gt;&gt; a
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
&gt;&gt;&gt; a[:5] = [42] # Все символы до 5 заменяются элементом "42"
&gt;&gt;&gt; a
[42, 5, 6, 7, 8, 9]
&gt;&gt;&gt; a[:1] = range(5) 
&gt;&gt;&gt; a
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
&gt;&gt;&gt; del a[::2] # Удаление каждого второго элемента
&gt;&gt;&gt; a
[1, 3, 5, 7, 9]
&gt;&gt;&gt; a[::2] = a[::-2] # Альтернатива reserved
&gt;&gt;&gt; a
[9, 3, 5, 7, 1]
</code></pre>

<b>29. Хранение нескольких элементов в ключе словаря</b>
<p>
Если на ключ нужно назначить больше одного элемента, лучше хранить их в списке:
</p><pre><code class="python">&gt;&gt;&gt; m = {}
&gt;&gt;&gt; m.setdefault('foo', []).append(1)
&gt;&gt;&gt; m
{'foo': [1]}
&gt;&gt;&gt; m.setdefault('foo', []).append(2)
&gt;&gt;&gt; m
{'foo': [1, 2]}
</code></pre>

<div class="spoiler"><b class="spoiler_title">30. Последнее и самое главное</b><div class="spoiler_text"><p>Ради всего неизвестного, читайте </p><a href="http://www.python.org/doc/">ДОКУМЕНТАЦИЮ</a><p>! Не собирайте очередной велосипед — возможно ваш код еще кому-то читать. Ни одна книга не сможет отразить полноту документации, а документация у python'а отличная.
</p></div></div>

<div class="spoiler"><b class="spoiler_title">UPD:</b><div class="spoiler_text"><b>31.</b><p> @Alex222 | </p><a href="http://habrahabr.ru/post/207988/#comment_7161084">комментарий</a>
<pre><code class="python">import antigravity
</code></pre>

<b>32.</b> <a href="http://habrahabr.ru/users/tanenn/" class="user_link">tanenn</a><p> | </p><a href="http://habrahabr.ru/post/207988/#comment_7161174">комментарий</a><p>
Использование else в цикле for:
</p><pre><code class="python">&gt;&gt;&gt; for n in range(2, 10):
...     for x in range(2, n):
...         if n % x == 0:
...             print n, 'equals', x, '*', n/x
...             break
...     else:
...         # loop fell through without finding a factor
...         print n, 'is a prime number'
</code></pre>

<b>33.</b> <a href="http://habrahabr.ru/users/monolithed/" class="user_link">monolithed</a><p> | </p><a href="http://habrahabr.ru/post/207988/#comment_7161256">комментарий</a><p>
Пишем первую программу — »Hello World!"
</p><pre><code class="python">import __hello__
</code></pre>

<b>34.</b> <a href="http://habrahabr.ru/users/andersondunai/" class="user_link">AndersonDunai</a><p> | </p><a href="http://habrahabr.ru/post/207988/#comment_7161346">комментарий</a><p>
OrderedDict или сортировка словарей:
</p><pre><code class="python">&gt;&gt;&gt; # Не сортированный словарь
&gt;&gt;&gt; d = {'banana': 3, 'apple':4, 'pear': 1, 'orange': 2}
&gt;&gt;&gt; # Словарь сортирован по ключ
&gt;&gt;&gt; OrderedDict(sorted(d.items(), key=lambda t: t[0]))
OrderedDict([('apple', 4), ('banana', 3), ('orange', 2), ('pear', 1)])
&gt;&gt;&gt; # Сортировка по значениям
&gt;&gt;&gt; OrderedDict(sorted(d.items(), key=lambda t: t[1]))
OrderedDict([('pear', 1), ('orange', 2), ('banana', 3), ('apple', 4)])
&gt;&gt;&gt; # Сортировка по длине названия ключа
&gt;&gt;&gt; OrderedDict(sorted(d.items(), key=lambda t: len(t[0])))
OrderedDict([('pear', 1), ('apple', 4), ('orange', 2), ('banana', 3)])
</code></pre>

<b>35.</b> <a href="http://habrahabr.ru/users/andersondunai/" class="user_link">AndersonDunai</a><p> | </p><a href="http://habrahabr.ru/post/207988/#comment_7161356">комментарий</a><p>
Изменение класса объекта на лету изнутри класса через self.__class__ (</p><a href="http://habrahabr.ru/post/114576/">подробнее</a><p>)</p><p>
Показательный пример (</p><a href="http://habrahabr.ru/post/207988/#comment_7161556">спасибо</a> <a href="http://habrahabr.ru/users/dmitriko/" class="user_link">dmitriko</a><p>):
</p><pre><code class="python">class Worm:
    def creep(self):
    print("i am creeping")

class Butterfly:
    def fly(self):
    print("i am flying")

creature = Worm()
creature.creep()
creature.__class__ = Butterfly
creature.fly()
</code></pre>

<b>36.</b> <a href="http://habrahabr.ru/users/skovorodkin/" class="user_link">skovorodkin</a><p> | </p><a href="http://habrahabr.ru/post/207988/#comment_7161470">комментарий</a><p>
Подсчет количества элементов (в примере — количество букв в слове):
</p><pre><code class="python">from collections import Counter
Counter('habrahabr')  # Counter({'a': 3, 'h': 2, 'r': 2, 'b': 2})
</code></pre>

<b>37. assert</b><p>
Assert — это специальная конструкция, позволяющая проверять предположения о значениях произвольных данных в произвольном месте программы. Данная конструкция используется в целях тестирования/отладки кода, например Вы можете написать такую инструкцию:
 </p><pre><code class="python">assert x&gt;y </code></pre><p>
и если данная инструкция вернет false будет возбуждено исключение AssertationError. По сути, данная инструкция
 </p><pre><code class="python">assert &lt;test&gt;, &lt;data&gt;</code></pre><p>
это краткий эквивалент такой:
 </p><pre><code class="python"> if __debug__:
              if not &lt;test&gt;:
                  raise AssertationError, &lt;data&gt; 
</code></pre>
</div></div>

<div class="spoiler"><b class="spoiler_title">Сохранить страницу с комментариями в pdf</b><div class="spoiler_text"><p>Если у вас Google Chrome — просто нажмите Печать -&gt; Принтер «Сохранить в PDF». Насчет подобной фичи в других браузерах — не знаю.</p>

<a href="http://www.dopdf.com/ru/">Если у вас не Chrome</a><p>
doPDF обрезает меню habr'ы, а комментарии оставляет. Страница Хабры сделана так, чтобы отправляться на печать без меню, так что подойдет любой виртуальный принтер. В итоге — имеем читабельный PDF файл. Очень удобно. Скачиваете, устанавливаете вместо принтера и отправляете на печать. (потом еще спасибо скажете).
</p></div></div>
      <p class="clear"/>
    </div>

    
  </div></body></html>