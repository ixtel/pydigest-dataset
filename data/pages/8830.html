<html><body><div><article class="markdown-body entry-content" itemprop="text"><p><a href="https://travis-ci.org/jvns/teeceepee"><img src="https://camo.githubusercontent.com/c375c0afa0b543af725f17f6efde182f70ac7cd9/68747470733a2f2f7472617669732d63692e6f72672f6a766e732f7465656365657065652e706e67" alt="Build Status" data-canonical-src="https://travis-ci.org/jvns/teeceepee.png"/></a></p>

<h1><a id="user-content-teeceepee" class="anchor" href="#teeceepee" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>teeceepee</h1>

<p>This is a tiny TCP stack implemented in pure Python, for fun and
learning. It is essentially a finicky and slow replacement for
<code>socket</code> where the interface is not quite right. But you can use it to
get webpages!</p>

<p>It's built on top of <a href="http://www.secdev.org/projects/scapy/">scapy</a>,
which takes care of all the packet parsing and construction. This
module handles actually sending and receiving packets.</p>

<p>There is an example of using it to get a webpage in
<code>examples/curl.py</code>. The example is quite finicky -- it uses ARP
spoofing to bypass the kernel's TCP stack, which sometimes results in
it just Not Working. Running it a few times sometimes fixes this
problem.</p>

<pre><code>sudo python examples/curl.py 10.0.4.4 example.com
</code></pre>

<p>works for me. If it doesn't work for you, let me know! If you're not
connected to the internet on <code>wlan0</code>, you'll need to specify an
interface as well.</p>

<p>I use Linux and Python 2.7 and it works for me. I would expect it to
not work on a BSD, and certainly not on Windows.</p>

<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Features</h3>

<ul>
<li>Can connect to hosts, send packets, and reassemble the replies in
the correct order</li>
<li>Will ignore out-of-order packets</li>
<li>Basically it is appropriate for implementing <code>curl</code>, but not for
sending data</li>
</ul>

<h3><a id="user-content-missing-features" class="anchor" href="#missing-features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Missing features</h3>

<ul>
<li>Sending more than one packet at once</li>
<li>Resending dropped packets</li>
<li>Handling more than one incoming connection at once</li>
<li><code>bind()</code> hasn't been tested in the wild at all, just unit tested. So
it probably doesn't work.</li>
</ul>

<h3><a id="user-content-difficulties" class="anchor" href="#difficulties" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Difficulties</h3>

<ul>
<li>It needs to run as root because it needs to use raw sockets.</li>
<li>TCP stacks aren't really <em>supposed</em> to start and stop. In
principle this should really run as a daemon, but it doesn't.</li>
<li>It needs to bypass the kernel, since normally the TCP stack there
will intercept any incoming packets and reset the connection. So we
listen on a fake IP address and send gratuitous ARPs to the router.
This is why <code>curl.py</code> needs your network interface and a fake IP
address.</li>
<li>It's slow, because Python. If you watch it in Wireshark, it does a
hilarious thing where it gets backed up sending ACKs and then sends
a load of ACKs at the end and takes forever to close the connection.</li>
<li>Sometimes the ARP spoofing or sniffing doesn't quite work. Usually
if I run it 5 times it will work.</li>
</ul>
</article>
  </div></body></html>