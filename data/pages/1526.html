<html><body><div><div class="entry-content clearfix"><p><img src="https://raw.githubusercontent.com/realpython/django-form-fun/master/images/drf.png" alt="drf-image"/></p>

<p>Let’s look at how to create a RESTFul API for our Django Talk Project using <a href="http://www.django-rest-framework.org/">Django Rest Framework</a> (DRF), which is an application used for rapidly building RESTful APIs based on Django models. <strong>Put another way, we’ll be converting a non-RESTful application into a RESTful one with DRF</strong>. <em>We’ll be using DRF version 2.4.2 for this application.</em></p>

<p><strong>This tutorial covers these topics</strong>:</p>

<ol>
<li>DRF Setup</li>
<li>RESTful Structure</li>
<li>Model Serializer</li>
<li>DRF Web Browseable API</li>
</ol>


<blockquote><p>If you missed parts <a href="https://realpython.com/blog/python/django-and-ajax-form-submissions/">one</a> and <a href="https://realpython.com/blog/python/django-and-ajax-form-submissions-more-practice/">two</a> be sure to check them out. Need the code? Download it from the <a href="https://github.com/realpython/django-form-fun">repo</a>.</p></blockquote>

<p><strong>For a more in-depth tutorial on Django Rest Framework, check out the third <a href="https://realpython.com">Real Python</a> course.</strong></p>

<a name="DRF.setup"/>
<h2>DRF setup</h2>

<p>Install:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>pip install djangorestframework
</span><span class="line"><span class="nv">$ </span>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Update <em>settings.py</em>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class="line">    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'talk'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'rest_framework'</span>
</span><span class="line"><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Boom!</p>

<a name="RESTful.Structure"/>
<h2>RESTful Structure</h2>

<p>In a RESTful API, endpoints (URLs) define the structure of the API and how end users access data from our application using the HTTP methods: GET, POST, PUT, DELETE. Endpoints should be logically organized around <em>collections</em> and <em>elements</em>, both of which are resources. In our case, we have one single resource, <code>posts</code>, so we will use the following URLS – <code>/posts/</code> and <code>/posts/&lt;id&gt;</code> for collections and elements, respectively.</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th/>
      <th>GET</th>
      <th>POST</th>
      <th>PUT</th>
      <th>DELETE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>/posts/</code></td>
      <td>Show all posts</td>
      <td>Add new post</td>
      <td>Update all posts</td>
      <td>Delete all posts</td>
    </tr>
    <tr>
      <td><code>/posts/&lt;id&gt;</code></td>
      <td>Show &lt;id&gt;</td>
      <td>N/A</td>
      <td>Update &lt;id&gt;</td>
      <td>Delete &lt;id&gt;</td>
    </tr>
  </tbody>
</table>


<a name="DRF.Quick.Start"/>
<h2>DRF Quick Start</h2>

<p>Let’s get our new API up and running!</p>

<a name="Model.Serializer"/>
<h3>Model Serializer</h3>

<p>DRF’s Serializers convert model instances to Python dictionaires, which can then be rendered in various API appropriate formats – like JSON or XML. Similar to the Django <code>ModelForm</code> class, DRF comes with a concise format for its Serializers, the <code>ModelSerializer</code> class. It’s simple to use: Just tell it which fields you want to use from the model:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">talk.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">PostSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="line">        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
</span><span class="line">        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Save this as <em>serializers.py</em> within the “talk” directory.</p>

<a name="Update.Views"/>
<h3>Update Views</h3>

<p>We need to refactor our current views to fit the RESTful paradigm. Comment out the current views and add in:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">rest_framework.decorators</span> <span class="kn">import</span> <span class="n">api_view</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">talk.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">talk.serializers</span> <span class="kn">import</span> <span class="n">PostSerializer</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">talk.forms</span> <span class="kn">import</span> <span class="n">PostForm</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="n">tmpl_vars</span> <span class="o">=</span> <span class="p">{</span><span class="s">'form'</span><span class="p">:</span> <span class="n">PostForm</span><span class="p">()}</span>
</span><span class="line">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'talk/index.html'</span><span class="p">,</span> <span class="n">tmpl_vars</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@api_view</span><span class="p">([</span><span class="s">'GET'</span><span class="p">])</span>
</span><span class="line"><span class="k">def</span> <span class="nf">post_collection</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
</span><span class="line">        <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class="line">        <span class="n">serializer</span> <span class="o">=</span> <span class="n">PostSerializer</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@api_view</span><span class="p">([</span><span class="s">'GET'</span><span class="p">])</span>
</span><span class="line"><span class="k">def</span> <span class="nf">post_element</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span class="line">    <span class="k">try</span><span class="p">:</span>
</span><span class="line">        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span class="line">    <span class="k">except</span> <span class="n">Post</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class="line">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
</span><span class="line">        <span class="n">serializer</span> <span class="o">=</span> <span class="n">PostSerializer</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>What’s happening here</strong>:</p>

<ol>
<li>First, the <code>@api_view</code> decorator checks that the appropriate HTTP request is passed into the view function. Right now, we’re only supporting GET requests.</li>
<li>Then, the view either grabs all the data, if it’s for the collection, or just a single post, if it’s for an element.</li>
<li>Finally, the data is serialized to JSON and returned.</li>
</ol>


<blockquote><p>Be sure to read more about the <code>@api_view</code> from the official <a href="http://www.django-rest-framework.org/api-guide/views#@api_view">documentation</a>.</p></blockquote>

<a name="Update.URLs"/>
<h3>Update URLs</h3>

<p>Let’s wire up some new URLs:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># Talk urls</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
</span><span class="line">    <span class="s">'talk.views'</span><span class="p">,</span>
</span><span class="line">    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="s">'home'</span><span class="p">),</span>
</span><span class="line">
</span><span class="line">    <span class="c"># api</span>
</span><span class="line">    <span class="n">url</span><span class="p">(</span><span class="s">r'^api/v1/posts/$'</span><span class="p">,</span> <span class="s">'post_collection'</span><span class="p">),</span>
</span><span class="line">    <span class="n">url</span><span class="p">(</span><span class="s">r'^api/v1/posts/(?P&lt;pk&gt;[0-9]+)$'</span><span class="p">,</span> <span class="s">'post_element'</span><span class="p">)</span>
</span><span class="line"><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Test"/>
<h3>Test</h3>

<p>We’re now ready for our first test!</p>

<ol>
<li>Fire up the server, then navigate to: <a href="http://127.0.0.1:8000/api/v1/posts/?format=json">http://127.0.0.1:8000/api/v1/posts/?format=json</a>.</li>
<li><p>Now let’s check out the <a href="http://www.django-rest-framework.org/topics/browsable-api">Browsable API</a>. Navigate to <a href="http://127.0.0.1:8000/api/v1/posts/">http://127.0.0.1:8000/api/v1/posts/</a></p>

<p> So, With no extra work on our end we automatically get this nice, human-readable output of our API. Nice! This is a <em>huge</em> win for DRF.</p></li>
<li><p>How about an element? Try: <a href="http://127.0.0.1:8000/api/v1/posts/1">http://127.0.0.1:8000/api/v1/posts/1</a></p></li>
</ol>


<p>Before moving on you may have noticed that the author field is an <code>id</code> rather than the actual <code>username</code>. We’ll address this shortly. For now, let’s wire up our new API so that it works with our current application’s Templates.</p>

<a name="Refactor.for.REST"/>
<h2>Refactor for REST</h2>

<a name="GET"/>
<h3>GET</h3>

<p>On the initial page load, we want to display all posts. To do that, add the following AJAX request:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">load_posts</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Load all posts on page load</span>
</span><span class="line"><span class="kd">function</span> <span class="nx">load_posts</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class="line">        <span class="nx">url</span> <span class="o">:</span> <span class="s2">"api/v1/posts/"</span><span class="p">,</span> <span class="c1">// the endpoint</span>
</span><span class="line">        <span class="nx">type</span> <span class="o">:</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="c1">// http method</span>
</span><span class="line">        <span class="c1">// handle a successful response</span>
</span><span class="line">        <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">json</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span><span class="line">                <span class="nx">$</span><span class="p">(</span><span class="s2">"#talk"</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="s2">"&lt;li id='post-"</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="o">+</span><span class="s2">"'&gt;&lt;strong&gt;"</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">text</span><span class="o">+</span><span class="s2">"&lt;/strong&gt; - &lt;em&gt; "</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">author</span><span class="o">+</span><span class="s2">"&lt;/em&gt; - &lt;span&gt; "</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">created</span><span class="o">+</span>
</span><span class="line">                <span class="s2">"&lt;/span&gt; - &lt;a id='delete-post-"</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="o">+</span><span class="s2">"'&gt;delete me&lt;/a&gt;&lt;/li&gt;"</span><span class="p">);</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="c1">// handle a non-successful response</span>
</span><span class="line">        <span class="nx">error</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span><span class="nx">errmsg</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="nx">$</span><span class="p">(</span><span class="s1">'#results'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">"&lt;div class='alert-box alert radius' data-alert&gt;Oops! We have encountered an error: "</span><span class="o">+</span><span class="nx">errmsg</span><span class="o">+</span>
</span><span class="line">                <span class="s2">" &lt;a href='#' class='close'&gt;&amp;times;&lt;/a&gt;&lt;/div&gt;"</span><span class="p">);</span> <span class="c1">// add the error to the dom</span>
</span><span class="line">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span> <span class="c1">// provide a bit more info about the error to the console</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">});</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>You’ve seen all this before. Notice how we’re handling a success: Since the API sends back a number of objects, we need to iterate through them, appending each to the DOM. We also changed <code>json[i].postpk</code> to <code>json[i].id</code> as we are serializing the post <code>id</code>.</p>

<p>Test this out. Fire up the server, log in, then check out the posts.</p>

<p>Besides the <code>author</code> being displayed as an <code>id</code>, take note of the datetime format. This is not what we want, right? We want a <em>readable</em> datetime format. Let’s update that…</p>

<a name="Datetime.Format"/>
<h3>Datetime Format</h3>

<p>We can use an awesome JavaScript library called <a href="http://momentjs.com/">MomentJS</a> to easily format the date anyway we want.</p>

<p>First, we need to import the library to our <em>index.html</em> file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="c">&lt;!-- scripts --&gt;</span>
</span><span class="line"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.2/moment.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="line"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"static/scripts/main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then update the for loop in <em>main.js</em>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">json</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">convert_to_readable_date</span><span class="p">(</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">created</span><span class="p">)</span>
</span><span class="line">    <span class="nx">$</span><span class="p">(</span><span class="s2">"#talk"</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="s2">"&lt;li id='post-"</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="o">+</span><span class="s2">"'&gt;&lt;strong&gt;"</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">text</span><span class="o">+</span>
</span><span class="line">        <span class="s2">"&lt;/strong&gt; - &lt;em&gt; "</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">author</span><span class="o">+</span><span class="s2">"&lt;/em&gt; - &lt;span&gt; "</span><span class="o">+</span><span class="nx">dateString</span><span class="o">+</span>
</span><span class="line">        <span class="s2">"&lt;/span&gt; - &lt;a id='delete-post-"</span><span class="o">+</span><span class="nx">json</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="o">+</span><span class="s2">"'&gt;delete me&lt;/a&gt;&lt;/li&gt;"</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we pass the date string to a new function called <code>convert_to_readable_date()</code>, which needs to be added:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// convert ugly date to human readable date</span>
</span><span class="line"><span class="kd">function</span> <span class="nx">convert_to_readable_date</span><span class="p">(</span><span class="nx">date_time_string</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">newDate</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">date_time_string</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="s1">'MM/DD/YYYY, h:mm:ss a'</span><span class="p">)</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">newDate</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That’s it. Refresh the browser. The datetime format should now look something like this – <code>08/22/2014, 6:48:29 pm</code>. Be sure to check out the <a href="http://momentjs.com/">MomentJS</a> documentation to view more information on parsing and formatting a datetime string in JavaScript.</p>

<a name="POST"/>
<h3>POST</h3>

<p>POST requests are handled in similar fashion. Before messing with the serializer, let’s test it first by just updating the views. Maybe we’ll get lucky and it will just work.</p>

<p>Update the <code>post_collection()</code> function in <em>views.py</em>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="nd">@api_view</span><span class="p">([</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
</span><span class="line"><span class="k">def</span> <span class="nf">post_collection</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="line">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
</span><span class="line">        <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class="line">        <span class="n">serializer</span> <span class="o">=</span> <span class="n">PostSerializer</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
</span><span class="line">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'text'</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'the_post'</span><span class="p">),</span> <span class="s">'author'</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">}</span>
</span><span class="line">        <span class="n">serializer</span> <span class="o">=</span> <span class="n">PostSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span class="line">        <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span><span class="line">            <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also add the following import:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">status</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>What’s happening here</strong>:</p>

<ol>
<li><code>request.DATA</code> extends Django’s HTTPRequest, returning the content from the request body. Read more about it <a href="http://www.django-rest-framework.org/api-guide/requests">here</a>.</li>
<li>If the deserialization process works, we return a response with a code of 201 (created).</li>
<li>On the other hand, if the deserialization process fails, we return a 400 response.</li>
</ol>


<p>Update the endpoint in the <code>create_post()</code> function</p>

<p>From:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">url</span> <span class="o">:</span> <span class="s2">"create_post/"</span><span class="p">,</span> <span class="c1">// the endpoint</span>
</span></code></pre></td></tr></table></div></figure>


<p>To:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">url</span> <span class="o">:</span> <span class="s2">"api/v1/posts/"</span><span class="p">,</span> <span class="c1">// the endpoint</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test it out in the browser. It should work. Don’t forget to update the handling of the dates correctly as well as changing <code>json.postpk</code> to <code>json.id</code>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">$</span><span class="p">(</span><span class="s1">'#post-text'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span> <span class="c1">// remove the value from the input</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span> <span class="c1">// log the returned json to the console</span>
</span><span class="line">    <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">convert_to_readable_date</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">created</span><span class="p">)</span>
</span><span class="line">    <span class="nx">$</span><span class="p">(</span><span class="s2">"#talk"</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="s2">"&lt;li id='post-"</span><span class="o">+</span><span class="nx">json</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">"'&gt;&lt;strong&gt;"</span><span class="o">+</span><span class="nx">json</span><span class="p">.</span><span class="nx">text</span><span class="o">+</span><span class="s2">"&lt;/strong&gt; - &lt;em&gt; "</span><span class="o">+</span>
</span><span class="line">        <span class="nx">json</span><span class="p">.</span><span class="nx">author</span><span class="o">+</span><span class="s2">"&lt;/em&gt; - &lt;span&gt; "</span><span class="o">+</span><span class="nx">dateString</span><span class="o">+</span>
</span><span class="line">        <span class="s2">"&lt;/span&gt; - &lt;a id='delete-post-"</span><span class="o">+</span><span class="nx">json</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s2">"'&gt;delete me&lt;/a&gt;&lt;/li&gt;"</span><span class="p">);</span>
</span><span class="line">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"success"</span><span class="p">);</span> <span class="c1">// another sanity check</span>
</span><span class="line"><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Author.Format"/>
<h3>Author Format</h3>

<p>Now’s a good time to pause and address the author <code>id</code> vs. <code>username</code> issue. We have a few options:</p>

<ol>
<li>Be really RESTFUL and make another call to get the user info, which is not good for performance.</li>
<li>Utilize the <a href="http://www.django-rest-framework.org/api-guide/relations#slugrelatedfield">SlugRelatedField</a> relation.</li>
</ol>


<p>Let’s go with the latter option. Update the serializer:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">talk.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">PostSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
</span><span class="line">    <span class="n">author</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">SlugRelatedField</span><span class="p">(</span>
</span><span class="line">        <span class="n">queryset</span><span class="o">=</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">slug_field</span><span class="o">=</span><span class="s">'username'</span>
</span><span class="line">    <span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="line">        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
</span><span class="line">        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>What’s happening here?</strong></p>

<ol>
<li>The <code>SlugRelatedField</code> allows us to change the target of the <code>author</code> field from <code>id</code> to <code>username</code>.</li>
<li>Also, by default the target field – <code>username</code> – is both readable and writeable so out-of-the-box this relation will work for both GET and POST requests.</li>
</ol>


<p>Update the <code>data</code> variable in the views as well:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'text'</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'the_post'</span><span class="p">),</span> <span class="s">'author'</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test again. You should now see the author’s <code>username</code>. Make sure both GET and POST requests are working correctly.</p>

<a name="Delete"/>
<h3>Delete</h3>

<p>Before changing or adding anything, test it out. Try the delete link. What happens? You should get a 404 error. Any idea why that would be? Or where to go to find out what the issue is? How about the <code>delete_post</code> function in our JavaScript file:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">url</span> <span class="o">:</span> <span class="s2">"delete_post/"</span><span class="p">,</span> <span class="c1">// the endpoint</span>
</span></code></pre></td></tr></table></div></figure>


<p>That URL does not exist. Before we update it, ask yourself – “Should we target the collection or an individual element?”. If you’re unsure, scroll back up and look at the <em>RESTful Structure</em> table. Unless we want to delete <em>all</em> posts, then we need to hit the element endpoint:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">url</span> <span class="o">:</span> <span class="s2">"api/v1/posts/"</span><span class="o">+</span><span class="nx">post_primary_key</span><span class="p">,</span> <span class="c1">// the endpoint</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test again. Now what happens? You should see a 405 error – <code>405: {"detail": "Method 'DELETE' not allowed."}</code> – since the view is not setup to handle a DELETE request.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="nd">@api_view</span><span class="p">([</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'DELETE'</span><span class="p">])</span>
</span><span class="line"><span class="k">def</span> <span class="nf">post_element</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
</span><span class="line">    <span class="k">try</span><span class="p">:</span>
</span><span class="line">        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
</span><span class="line">    <span class="k">except</span> <span class="n">Post</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class="line">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
</span><span class="line">        <span class="n">serializer</span> <span class="o">=</span> <span class="n">PostSerializer</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'DELETE'</span><span class="p">:</span>
</span><span class="line">        <span class="n">post</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</span><span class="line">        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the DELETE HTTP verb added, we can handle the request by removing the post with the <code>delete()</code> method and returning a 204 response. Does it work? Only one way to find out. This time when you test make sure that (a) the post is actually deleted and removed from the DOM and (b) that a 204 status code is returned (you can confirm this in the <em>Network</em> tab within <em>Chrome Developer Tools</em>).</p>

<a name="Conclusion.and.Next.Steps"/>
<h2>Conclusion and Next Steps</h2>

<p>This is all for now. Need an extra challenge? Add the ability to update posts with the PUT request.</p>

<p>The actual REST part is simple: You just need to update the <code>post_element()</code> function to handle PUT requests.</p>

<p>The client side is a bit more difficult as you need to update the actual HTML to display an input box for the user to enter the new value in, which you’ll need to grab in the JavaScript file so you can send it with the PUT request.</p>

<p>Are you going to allow any user to update any post, regardless of whether s/he originally posted it?</p>

<p>If so, are you going to update the author name? Maybe add an <code>edited_by</code> field to the database? Then display an edited by note on the DOM as well. If users can only update their own posts, you need to make sure you are handling this correctly in the views and then displaying an error message if the user is trying to edit a post that s/he did not originally post. Or perhaps you could just remove the edit link (and perhaps the delete link as well) for posts that a certain user can’t edit. You could turn it into a permissions issue and only let <em>certain</em> users, like moderators or admin, edit all posts while the remaining users can only update their own posts.</p>

<p>So many questions.</p>

<p>If you do decide to try this, go with the lowest hanging fruit – <em>simply allow any user to update any post and only update the <code>text</code> in the database.</em> Then test. Then add another iteration. Then test. Etc. Take notes and email us at <strong>info@realpython.com</strong> so we can add a supplementary blog post!</p>

<hr/>


<p>Anyhow, next time you’ll get to see us tear apart the current JavaScript code as we add in <strong>Angular</strong>! See you then.</p>
</div>


      </div></body></html>