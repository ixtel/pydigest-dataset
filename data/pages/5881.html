<html><body><div><div class="content html_format">
      

<h5><b>Введение</b></h5><p>
Django — широко известный и один из наиболее развитых фреймворков для веб-разработки. Django написан на Python и, следовательно, для работы с ним потребуется установленный интерпретатор Python. Это не представляет никаких проблем, если мы работаем в среде Linux. Однако события принимают совсем другой оборот, если приходится заниматься разработкой на Python под Windows.
</p><p>
Для Windows есть готовые сборки Python, среди которых стоит отметить </p><a href="https://www.enthought.com/products/epd/">Enthought Python</a><p>, </p><a href="https://store.continuum.io/cshop/anaconda//">Anaconda Python</a><p>, </p><a href="https://code.google.com/p/pythonxy/">PythonXY</a><p>.</p><p>
Есть и </p><a href="http://docs.python-guide.org/en/latest/starting/install/win/">более простые пути</a><p>.</p><p>
Основной их недостаток по сравнению со «стандартным» Python в Linux — ограниченность набора библиотек, доступных для установки. В частности, в них не Django, и для его установки приходится совершать некие не совсем очевидные действия.
</p><p>
Один из возможных вариантов решения проблемы — установка виртуальной машины с Linux на борту. Работа с виртуальной машиной, несмотря на простоту ее установки и настройки, привносит ряд неудобств.</p><p>
Так, виртуальная машина может оказаться довольно требовательной к ресурсам компьютера и временами работать медленно, создавая дискомфорт разработчику. Особенно сильно это раздражает, если торможение начинается в самый напряженный момент работы (а именно тогда это чаще всего и происходит!). Кроме того, даже на очень хорошем железе такое IDE, как PyCharm, работает в режиме далеком от того, который принято считать комфортным.
</p><p>
Повысить быстродействие можно за счет установки только необходимых пакетов, отсутствия оконного менеджера и тому подобных проблем. Т. е., необходимо правильно сконфигурировать виртуальную машину. И в этом деле на помощь приходит </p><a href="http://www.vagrantup.com/">Vagrant</a><p> — утилита для создания полностью готовых рабочих окружений на основе виртуальных машин (VirtualBox, VmWare Player/Workstation). Vagrant не только устанавливает виртуальную машину, но и позволяет с легкостью создавать новые, используя текущую конфигурацию пользователя.
</p><p>
В следующем разделе рассматривается установка и настройка рабочего окружения Vagrant для использования его в качестве удаленного Python интерпретатора для проектов PyCharm.
</p><a name="habracut"/>
<h5><b>Работа с Vagrant в Windows</b></h5>

<h6><b>Установка Vagrant и загрузка окружения</b></h6>
<p>
Установка Vagrant выполняется очень просто. Все, что необходимо, — скачать </p><a href="https://dl.bintray.com/mitchellh/vagrant/vagrant_1.5.2.msi">установщик</a><p> с сайта и запустить его. Кроме того, для работы Vagrant требуется установить одну из виртуальных машин VirtualBox или VMware.
</p><p>
После того, как Vagrant установлен, мы переходим к созданию рабочего окружения. Основа его построения — «коробка» Vagrant (box). »Коробка» Vagrant представляет собой файл с расширением box. Этот файл есть не что иное, как архив tar, возможно сжатый с помощью gzip. Внутри архива хранятся образ виртуальной машины и файлы, необходимые для ее корректного запуска.
</p><p>
На официальном сайте Vagrant есть значительное число готовых «коробок» с различными версиями Linux и установленным ПО. Их список можно посмотреть на </p><a href="https://vagrantcloud.com/discover/featured">VagrantCloud</a><p>.</p><p>
Еще больше готовых окружений доступно на </p><a href="http://www.vagrantbox.es">www.vagrantbox.es</a><p>.
</p><p>
Для наших целей вполне подойдет стандартная версия Ubuntu — hashicorp/precise64 с предустановленными Chef и Puppet (которые нам, к слову сказать, не понадобятся) из официального репозитория. Перед тем как устанавливать окружение, создадим директорию, где будет храниться файл с конфигурацией для него. Назовем ее Vagrant. Переходим в эту директорию и выполняем в консоли:

</p><pre><code class="python">\Vagrant&gt; vagrant init hashicorp/precise64
</code></pre>
<p>
После этого в директории появится файл Vagrantfile, в котором содержится описание конфигурации данного окружения. Например, строчка config.vm.box = «hashicorp/precise64» определяет имя нашего окружения. Теперь все готово к тому, чтобы приступить к запуску окружения. Выполним

</p><pre><code class="python">\Vagrant&gt; vagrant up
</code></pre>
<p>
и увидим сообщение о загрузке соответствующей «коробки». Т. к. это — первый запуск данного окружения, перед стартом его надо скачать из репозитория на локальный диск. Следует заметить, что в приведенном выше примере аргумент команды init — имя окружения — совпадает с таковым на сайте Vagrant. Это соответствие необязательно. Так, можно было бы сконфигурировать данное окружение (его версию без Chef и Puppet) и таким образом:

</p><pre><code class="python">\Vagrant&gt; vagrant init precise64
http://cloud-images.ubuntu.com/vagrant/precise/current/... .box
</code></pre>
<p>
Второй аргумент init, как несложно заметить, представляет собой URL «коробки». Отметим также, что имена окружений, например, использованные выше hashicorp/precise64, precise64, фактически нужны для удобной ориентации среди установленных окружений, а сам Vagrant использует уникальные идентификаторы для запуска требуемого окружения (их значение хранится в файле action_set_name). Файлы рабочих окружений хранятся по умолчанию в директории ~/.vagrant.d}, где «~» в Windows — директория C:\Users\your_login\.
</p><p>
После того как мы выполнили vagrant up и дождались загрузки окружения, оно готово к использованию, в чем можно убедиться, проверив его статус:

</p><pre><code class="python">\Vagrant&gt; vagrant status
</code></pre>
<p>
Для завершения работы окружения используется команда

</p><pre><code class="python">\Vagrant&gt; vagrant halt
</code></pre>
<p>
Все установленные окружения Vagrnat можно просмотреть с помощью vagrant box list или непосредственно в VirtualBox (VMware).

</p>
<i>Virtualbox с установленными виртуальными машинами Vagrant.</i>
<p>
В заключение этого раздела отметим, что окружение Vagrant может быть добавлено с помощью команды vagrant box add. Подробнее о ней и о других консольных командах Vagrant можно прочитать на странице с </p><a href="http://docs.vagrantup.com/v2/cli/index.html">официальной документацией</a><p>.

</p><h6><b>Подключение к окружению Vagrant</b></h6>
<p>
При старте окружения (vagrant up) в папке .vagrant.d автоматически создается ключ insecure_private_key для подключения к окружению по протоколу ssh. Для использования протокола ssh в Windows нам потребуются программы </p><a href="http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe">PuTTY</a><p> и PuTTYgen (для конвертирования ключа в формат, который PuTTY понимает). Запускаем </p><a href="http://the.earth.li/~sgtatham/putty/latest/x86/puttygen.exe">PuTTYgen</a><p>, открываем insecure_private_key и видим сообщение, что ключ был успешно импортирован. Теперь можно сохранить его в формате ppk как private key.
</p><p>
Из соображений удобства ключ можно сохранить в папку с файлом Vagrantfile для данного окружения. Теперь указываем PuTTY, какой ключ использовать, и подключаемся через порт 2222 (номер порта отображается при выполнении vagrant up). По умолчанию для подключения используется имя (login) — vagrant.
</p><p>
Если подключение прошло удачно, мы окажемся в консоли нашего Vagrant-окружения, откуда можно устанавливать библиотеки Python или системные приложения.

</p>
<i>Сохранение ключа в PuTTYgen.</i>



<i>Настройка параметров соединения PuTTY.</i>
<p>
Теперь, когда рабочие окружения скачаны и запущены, все готово к установке Python и собственно Django. Хорошая практика — использование виртуальных окружений для работы с Python (и не только с ним). В этом случае риск конфликтов с уже установленными в системе версиями интерпретатора и прочего ПО сводится к минимуму и появляется возможность одновременной работы с разными версиями интерпретатора Python, Django или любого другого пакета.
</p><p>
Для установки виртуального окружения выполняем в консоли Vagrant:

</p><pre><code class="python">vagrant@vagrant sudo apt-get install python-virtualenv
</code></pre>
<p>
После завершения установки создаем новое виртуальное окружение

</p><pre><code class="python">vagrant@vagrant  virtualenv venv
</code></pre>
<p>
активируем его

</p><pre><code class="python">vagrant@vagrant  source /home/vagrant/venv/bin/activate

</code></pre><p>
Теперь пришло время установить Django:

</p><pre><code class="python">(venv)vagrant@vagrant  pip install django
</code></pre>
<p>
Можно указать версию пакета, которую мы хотим установить:

</p><pre><code class="python">(venv)vagrant@vagrant  pip install django==1.4
</code></pre>
<p>
Django установлен, но осталась одна небольшая задача: научить PyCharm работать с интерпретатором Python, установленным в окружении Vagrant. Как это сделать, разбирается в следующем разделе.

</p><h6><b>Настройка PyCharm</b></h6>
<p>
Запустим PyCharm и создадим новый Django-проект. По умолчанию он создается в папке ~/PycharmProjects/. Пусть это будет проект Test. Далее в домашней директории рабочего окружения Vagrant создадим папку PycharmProjects (совпадение имен случайно и выбрано из соображений удобства).
</p><p>
Переходим в меню настроек проекта: File-&gt;Settings-&gt;Project Interpeter. Здесь добавляем новый интерпретатор: указываем его адрес (127.0.0.1), номер порта (2222), имя пользователя (vagrant), путь к интерпретатору /home/vagrant/venv/bin/python и, наконец, указываем путь к файлу с ключом для ssh.
</p><p>
Теперь необходимо настроить синхронизацию локальной папки с проектами и аналогичной папки в окружении Vagrant. Открываем для редактирования файл Vagrant и раскомментируем в нем строку с config.vm.synced_folder, исправляя ее на config.vm.synced_folder C:/Users/adolgikh/PycharmProjects, /home/vagrant/PycharmProjects. Теперь локальные файлы будут синхронизироваться с окружением, в котором установлен интерпретатор. Перезапускаем Vagrant

</p><pre><code class="python">$  vagrant reload
</code></pre>
<p>
и видим, что наша папка с проектом Test была успешно добавлена в папку с проектами в удаленном рабочем окружении.
</p><p>
Чтобы текущие изменения, сделанные по ходу работы над проектом, сразу отправлялись в удаленную среду, необходимо сделать дополнительные настройки в проекте Pycharm. Заходим в меню Run-&gt;Edit Configuration и корректируем Path Mapping так, как это показано на скриншоте.</p><p>
Упоминания заслуживает возможность запуска ssh-консоли в Pycharm. Она запускается из меню Tools и подключается по ssh к окружению, которое указано в настройках удаленного интерпретатора. Таким образом, нам нет необходимости использовать PuTTY с корректно настроенным проектом в Pycharm.

</p>
<i>Настройка Path Mapping в Pycharm</i>

<h5><b>Заключение</b></h5><p>
Несомненно, Vagrant хорош не только тем, что позволяет существенно повысить удобство Python-разработки в Windows. Устанавливая Vagrant, мы получаем возможность создавать, конфигурировать и сохранять полностью функциональные рабочие окружения. Более того, мы можем создавать конфигурации, где одновременно работают несколько Vagrant окружений с различными конфигурациями.</p><p>
Таким образом, появляется возможность достаточно точно смоделировать предполагаемое рабочее окружение, используемое в production. Одним словом, Vagrant представляет собой еще один ценный инструмент в руках разработчика, в дальнейшем мы постараемся осветить и другие аспекты работы с ним.

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>