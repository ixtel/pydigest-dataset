<html><body><div><section class="post-content">
            <p>Python is becoming an increasingly popular language for data science, and with good reason.  It’s easy to learn, has powerful data science libraries, and integrates well with databases and tools like Hadoop and Spark.  With Python, we can perform the full lifecycle of data science projects, including reading data in, analyzing data, visualizing data, and making predictions with machine learning.</p>

<p>In this post, we’ll walk through getting started with data science using Python.  If you want to dive more deeply into the topics we cover, visit <a href="https://www.dataquest.io">Dataquest</a>, where we teach every component of the Python data science lifecycle in depth. </p>

<p>We’ll be working with a dataset of political contributions to candidates in the 2016 US presidential elections, which can be found <a href="http://www.fec.gov/disclosurep/PDownload.do">here</a>.  The file is in <em>csv</em> format, and each row in the dataset represents a single donation to the campaign of a single candidate.  The dataset has several interesting columns, including:</p>

<ul>
  <li><code>cand_nm</code> – name of the candidate receiving the donation.</li>
  <li><code>contbr_nm</code> – name of the contributor.</li>
  <li><code>contbr_state</code> – state where the contributor lives.</li>
  <li><code>contbr_employer</code> – where the contributor works.</li>
  <li><code>contbr_occupation</code> – the occupation of the contributor.</li>
  <li><code>contb_receipt_amount</code> – the size of the contribution, in US dollars.</li>
  <li><code>contb_receipt_dt</code> – the date the contribution was received.</li>
</ul>

<h2 id="installing-python">Installing Python</h2>

<p>The first step we’ll need to take to analyze this data is to install <a href="https://www.python.org/">Python</a>.  Installing Python is an easy process with <a href="https://www.continuum.io/why-anaconda">Anaconda</a>, a tool that installs Python along with several popular data analysis libraries.  You can download Anaconda <a href="https://www.continuum.io/downloads">here</a>.  It’s recommended to install <em>Python 3.5</em>, which is the newest version of Python.  You can read more about Python 2 vs Python 3 <a href="https://wiki.python.org/moin/Python2orPython3">here</a>.</p>

<p>Anaconda automatically installs several libraries that we’ll be using in this post, including <a href="http://jupyter.org/">Jupyter</a>, <a href="http://pandas.pydata.org/">Pandas</a>, <a href="http://scikit-learn.org/">scikit-learn</a>, and <a href="http://matplotlib.org/">matplotlib</a>.</p>

<h2 id="getting-started-with-jupyter">Getting started with Jupyter</h2>

<p>Now that we have everything installed, we can launch Jupyter notebook (formerly known as IPython notebook).  Jupyter notebook is a powerful data analysis tool that enables you to quickly explore data, visualize your findings, and share your results.  It’s used by data scientists at organizations like Google, IBM, and Microsoft to analyze data and collaborate.</p>

<p>Start Jupyter by running <code>ipython notebook</code> in the terminal.  If you have trouble, check <a href="http://jupyter-notebook-beginner-guide.readthedocs.org/en/latest/execute.html">here</a>.</p>



<p>You should see a file browser interface that allows you to create new notebooks.  Create a <em>Python 3</em> notebook, which we’ll be using in our analysis.  If you need more help with installation, check out our guide <a href="https://www.dataquest.io/mission/118/project-python-and-pandas-installation">here</a>.</p>

<h3 id="notebook-cells">Notebook cells</h3>

<p>Each Jupyter notebook is composed of multiple <em>cells</em> in which you can run code or write explanations.  Your notebook will only have one <em>cell</em> initially, but you can add more:</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [ ]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># This is a code cell.  Any output we generate here will show up below.</span>

<span class="nb">print</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [ ]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># You can have multiple cells, and re-run each cell as many times as you want to refine your analysis.</span>
<span class="c"># The power of Jupyter notebook is that the results of each cell you run are cached.</span>
<span class="c"># So you can run code in cells that depends on other cells.</span>

<span class="nb">print</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
</div></div></div></div>

<p>If you want to learn more about Jupyter, check our our in-depth tutorial <a href="https://www.dataquest.io/mission/162/guided-project-using-jupyter-notebook">here</a>.</p>

<h2 id="getting-started-with-pandas">Getting started with Pandas</h2>

<p><a href="http://pandas.pydata.org/">Pandas</a> is a data analysis library for Python.  It enables us to read in data from a variety of formats, including csv, and then analyze that data efficiently.  We can read in the data using this code:</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [2]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">donations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"political_donations.csv"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">


<div class="output_wrapper">
<div class="output">


<div class="output_area"><p class="prompt output_prompt">Out[4]:</p>

<div class="output_html rendered_html output_subarea output_execute_result">
<div class="jupyter-table">
<table border="1" class="s">
  <thead>
    <tr>
      <th/>
      <th>cmte_id</th>
      <th>cand_id</th>
      <th>cand_nm</th>
      <th>contbr_nm</th>
      <th>contbr_city</th>
      <th>contbr_st</th>
      <th>contbr_zip</th>
      <th>contbr_employer</th>
      <th>contbr_occupation</th>
      <th>contb_receipt_amt</th>
      <th>contb_receipt_dt</th>
      <th>receipt_desc</th>
      <th>memo_cd</th>
      <th>memo_text</th>
      <th>form_tp</th>
      <th>file_num</th>
      <th>tran_id</th>
      <th>election_tp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C00458844</th>
      <td> P60006723</td>
      <td> Rubio, Marco</td>
      <td>      KIBBLE, KUMAR</td>
      <td> DPO</td>
      <td> AE</td>
      <td> 092131903</td>
      <td>   U.S. DEPARTMENT OF HOMELAND SECURITY</td>
      <td>                        LAW ENFORCEMENT</td>
      <td> 500</td>
      <td> 27-AUG-15</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> SA17A</td>
      <td> 1029457</td>
      <td> SA17.813360</td>
      <td> P2016</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>C00458844</th>
      <td> P60006723</td>
      <td> Rubio, Marco</td>
      <td> HEFFERNAN, MICHAEL</td>
      <td> APO</td>
      <td> AE</td>
      <td> 090960009</td>
      <td> INFORMATION REQUESTED PER BEST EFFORTS</td>
      <td> INFORMATION REQUESTED PER BEST EFFORTS</td>
      <td> 210</td>
      <td> 27-JUN-15</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> SA17A</td>
      <td> 1029436</td>
      <td> SA17.796904</td>
      <td> P2016</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
</div></div></div></div>

<p>In the cells above, we import the Pandas library using <code>import pandas as pd</code>, then use the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">read_csv()</a> method to read <code>political_donations.csv</code> into the <code>donations</code> variable.  The <code>donations</code> variable is a Pandas <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">DataFrame</a>, which is an enhanced version of a matrix that has data analysis methods built in and allows different datatypes in each column.</p>

<p>We access the <code>shape</code> property of <code>donations</code> variable to print out how many rows and columns it has.  When a statement or variable is placed on the last line of a notebook cell, its value or output is automatically rendered!  We then use the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">head()</a> method on DataFrames to print out the first two rows of <code>donations</code> so we can inspect them.</p>

<p>If you want to dive into more depth with Pandas, see our course <a href="https://www.dataquest.io/section/data-analysis">here</a>.</p>

<h2 id="total-donations-by-candidate">Total donations by candidate</h2>

<p>We can compute per-candidate summary statistics using the Pandas <a href="http://pandas.pydata.org/pandas-docs/stable/groupby.html">groupby()</a> method.  We can first use the groupby method to split <code>donations</code> into subsets based on <code>cand_nm</code>.  Then, we can compute statistics separately for each candidate.  The first summary statistic we compute will be total donations.  To get this, we just take the sum of the <code>contb_receipt_amount</code> column for each candidate.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [14]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">donations</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"cand_nm"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">"contb_receipt_amt"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><p class="prompt output_prompt">Out[14]:</p>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th/>
      <th>contb_receipt_amt</th>
      <th>file_num</th>
    </tr>
    <tr>
      <th>cand_nm</th>
      <th/>
      <th/>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pataki, George E.</th>
      <td>   365090.98</td>
      <td>   234695430</td>
    </tr>
    <tr>
      <th>Webb, James Henry Jr.</th>
      <td>   398717.25</td>
      <td>   709419893</td>
    </tr>
    <tr>
      <th>Lessig, Lawrence</th>
      <td>   621494.50</td>
      <td>  1378488449</td>
    </tr>
    <tr>
      <th>Santorum, Richard J.</th>
      <td>   781401.03</td>
      <td>   822086638</td>
    </tr>
    <tr>
      <th>Trump, Donald J.</th>
      <td>  1009730.97</td>
      <td>  2357347570</td>
    </tr>
    <tr>
      <th>Jindal, Bobby</th>
      <td>  1013918.12</td>
      <td>   584896776</td>
    </tr>
    <tr>
      <th>Perry, James R. (Rick)</th>
      <td>  1120362.59</td>
      <td>   925732125</td>
    </tr>
    <tr>
      <th>Huckabee, Mike</th>
      <td>  1895549.15</td>
      <td>  2700810255</td>
    </tr>
    <tr>
      <th>O'Malley, Martin Joseph</th>
      <td>  2921991.65</td>
      <td>  2664148850</td>
    </tr>
    <tr>
      <th>Graham, Lindsey O.</th>
      <td>  2932402.63</td>
      <td>  3131180533</td>
    </tr>
    <tr>
      <th>Kasich, John R.</th>
      <td>  3734242.12</td>
      <td>  2669944682</td>
    </tr>
    <tr>
      <th>Christie, Christopher J.</th>
      <td>  3976329.13</td>
      <td>  2421473376</td>
    </tr>
    <tr>
      <th>Paul, Rand</th>
      <td>  4376828.14</td>
      <td> 16056604577</td>
    </tr>
    <tr>
      <th>Fiorina, Carly</th>
      <td>  4505707.06</td>
      <td> 12599637777</td>
    </tr>
    <tr>
      <th>Walker, Scott</th>
      <td>  4654810.30</td>
      <td>  5636746962</td>
    </tr>
    <tr>
      <th>Sanders, Bernard</th>
      <td>  9018526.00</td>
      <td> 71139864714</td>
    </tr>
    <tr>
      <th>Rubio, Marco</th>
      <td> 10746283.24</td>
      <td> 22730139555</td>
    </tr>
    <tr>
      <th>Carson, Benjamin S.</th>
      <td> 11746359.74</td>
      <td> 75613624360</td>
    </tr>
    <tr>
      <th>Cruz, Rafael Edward 'Ted'</th>
      <td> 17008622.17</td>
      <td> 69375616591</td>
    </tr>
    <tr>
      <th>Bush, Jeb</th>
      <td> 23243472.85</td>
      <td> 14946097673</td>
    </tr>
    <tr>
      <th>Clinton, Hillary Rodham</th>
      <td> 61726374.09</td>
      <td> 86560202290</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
  
</div></div></div></div>

<p>In the above code, we first split <code>donations</code> into groups based on <code>cand_nm</code> using the code <code>donations.groupby("cand_nm")</code>.  This returns a <a href="http://pandas.pydata.org/pandas-docs/stable/groupby.html">GroupBy</a> object that has some special methods for aggregating data.  One of these methods is <code>sum()</code>, which we use to compute the sum of each column in each group.  </p>

<p>Pandas automatically recognizes the data type of columns when data is read in, and only performs the sum operation on the numeric columns.  We end up with a DataFrame showing the sum of the <code>contb_receipt_amt</code> and <code>file_num</code> columns for each candidate.  In a final step, we use the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.sort.html">sort()</a> method on DataFrames to sort in ascending order to <code>contb_receipt_amt</code>.  This shows us how much each candidate has collected in donations.</p>

<h2 id="visualizing-total-donations">Visualizing total donations</h2>

<p>We can use <a href="http://matplotlib.org/">matplotlib</a>, the main Python data visualization library, to make plots.  Jupyter notebook even supports rendering matplotlib plots inline.  We’ll need to activate the <em>inline</em> mode of matplotlib to do this.  We can use <a href="http://ipython.org/ipython-doc/dev/interactive/tutorial.html#magics-explained">Jupyter magics</a> to make matplotlib figures show up in the notebook.  </p>

<p>Magics are commands that start with a <code>%</code> or <code>%%</code>, and affect the behavior of Jupyter notebook.  They are meant to be used as a way to change Jupyter configuration without the commands getting mixed up with Python code.  To enable matplotlib figures to show up inline, we need to run <code>%matplotlib inline</code> in a cell.  Read more about plotting with Jupyter <a href="https://ipython.org/ipython-doc/3/notebook/notebook.html#plotting">here</a>.</p>

<p>Here we import the <code>matplotlib</code> library and activate inline mode:</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [ ]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

</div>
</div></div></div></div>

<p>Pandas DataFrames have built-in visualization support, and you can call the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.plot.html">plot()</a> method to generate a <code>matplotlib</code> plot from a DataFrame.  This is often much quicker than using <code>matplotlib</code> directly.  First, we assign our DataFrame from earlier to a variable, <code>total_donations</code>.  Then, we use <a href="http://pandas.pydata.org/pandas-docs/stable/indexing.html">indexing</a> to select a single column of the DataFrame, <code>contb_receipt_amt</code>.  This generates a Pandas Series.  </p>

<p>Pandas Series have most of the same methods as DataFrames, but they store 1-dimensional data, like a single row or a single column.  We can then call the <a href="http://pandas.pydata.org/pandas-docs/version/0.17.1/generated/pandas.Series.plot.html">plot()</a> method on the Series to generate a bar chart of each candidate’s total donations.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [16]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">total_donations</span> <span class="o">=</span> <span class="n">donations</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"cand_nm"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">"contb_receipt_amt"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [20]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">total_donations</span><span class="p">[</span><span class="s">"contb_receipt_amt"</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">"bar"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><p class="prompt output_prompt">Out[20]:</p>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x108892208&gt;</pre>
</div>

</div>



</div>
</div>

</div>
</div></div></div></div>

<p>If you want to dive more into matplotlib, check out our course <a href="https://www.dataquest.io/section/data-visualization">here</a>.</p>

<h2 id="finding-the-mean-donation-size">Finding the mean donation size</h2>

<p>It’s dead simple to find the mean donation size instead of the total donations.  We just swap the <code>sum()</code> method for the <a href="http://pandas.pydata.org/pandas-docs/version/0.17.1/generated/pandas.DataFrame.mean.html">mean()</a> method.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [22]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">avg_donations</span> <span class="o">=</span> <span class="n">donations</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">"cand_nm"</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">"contb_receipt_amt"</span><span class="p">)</span>
<span class="n">avg_donations</span><span class="p">[</span><span class="s">"contb_receipt_amt"</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">"bar"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><p class="prompt output_prompt">Out[22]:</p>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x108d82c50&gt;</pre>
</div>

</div>



</div>
</div>

</div>
</div></div></div></div>

<h2 id="predicting-donation-size">Predicting donation size</h2>

<p>Let’s make a simple algorithm that can figure out how much someone will donate based on their state (<code>contbr_st</code>), occupation (<code>contbr_occupation</code>), and preferred candidate (<code>cand_nm</code>).  The first step is to make a separate Dataframe with just these columns and the <code>contb_receipt_amt</code> column, which we want to predict.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [41]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">pdonations</span> <span class="o">=</span> <span class="n">donations</span><span class="p">[[</span><span class="s">"contbr_st"</span><span class="p">,</span> <span class="s">"contbr_occupation"</span><span class="p">,</span> <span class="s">"cand_nm"</span><span class="p">,</span> <span class="s">"contb_receipt_amt"</span><span class="p">]]</span>
</pre></div>

</div>
</div>
</div>

</div>
</div></div></div></div>

<p>Now we’ll check the data types of each column in <code>pdonations</code>.  When Pandas reads in a csv file, it automatically assigns a data type to each column.  We can only use columns to make predictions if they are a <em>numeric</em> data type.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">


<div class="output_wrapper">
<div class="output">


<div class="output_area"><p class="prompt output_prompt">Out[42]:</p>


<div class="output_text output_subarea output_execute_result">
<pre>contbr_st             object
contbr_occupation     object
cand_nm               object
contb_receipt_amt    float64
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
</div></div></div></div>

<p>Unfortunately, all of the columns we want to use to predict are <em>object</em> datatypes (strings).  This is because they are categorical data.  Each column has several options, but they are shown as text instead of using numeric codes.  We can convert each column into numeric data by converting to the <em>categorical</em> datatype, then to numeric.  <a href="https://pandas-docs.github.io/pandas-docs-travis/categorical.html">Here’s</a> more on the categorical data type.  Essentially, the categorical data type assigns a <em>numeric</em> code behind the scenes to each unique value in a column.  We can replace the column with these codes to convert to numeric entirely.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [43]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">pdonations</span><span class="p">[</span><span class="s">"contbr_st"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdonations</span><span class="p">[</span><span class="s">"contbr_st"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">pdonations</span><span class="p">[</span><span class="s">"contbr_st"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdonations</span><span class="p">[</span><span class="s">"contbr_st"</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">


<div class="output_wrapper">
<div class="output">


<div class="output_area"><p class="prompt output_prompt">Out[44]:</p>


<div class="output_text output_subarea output_execute_result">
<pre>0     1
1     1
2     1
3     2
4     2
5     2
6     2
7     2
8     2
9     2
10    2
11    2
12    2
13    2
14    2
...
384870    75
384871    75
384872    75
384873    75
384874    75
384875    75
384876    75
384877    75
384878    75
384879    75
384880    75
384881    75
384882    75
384883    77
384884    77
Name: contbr_st, Length: 384885, dtype: int8</pre>
</div>

</div>

</div>
</div>

</div>
</div></div></div></div>

<p>As you can see, we’ve converted the <code>contbr_st</code> column to numeric values.  We’ll need to repeat the same process with the <code>contbr_occupation</code> and <code>cand_nm</code> columns.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [ ]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"contbr_st"</span><span class="p">,</span> <span class="s">"contbr_occupation"</span><span class="p">,</span> <span class="s">"cand_nm"</span><span class="p">]:</span>
    <span class="n">pdonations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdonations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
    <span class="n">pdonations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdonations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
</pre></div>

</div>
</div>
</div>

</div>
</div></div></div></div>

<h2 id="splitting-into-training-and-testing-sets">Splitting into training and testing sets</h2>

<p>We’ll now be able to start leveraging <a href="http://scikit-learn.org/">scikit-learn</a>, the primary Python machine learning library, to help us with the rest of the prediction workflow.  First, we’ll split the data into two sets – one which we train our algorithm on called the training set, and one which we use to evaluate the performance of the model called the test set.  We do this to avoid <a href="https://en.wikipedia.org/wiki/Overfitting">overfitting</a>, and getting a misleading error value.</p>

<p>We can use the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cross_validation.train_test_split.html">train_test_split()</a> function to split <code>pdonations</code> into a train and a test set.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [48]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="k">import</span> <span class="n">train_test_split</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">pdonations</span><span class="p">[[</span><span class="s">"contbr_st"</span><span class="p">,</span> <span class="s">"contbr_occupation"</span><span class="p">,</span> <span class="s">"cand_nm"</span><span class="p">]],</span> <span class="n">pdonations</span><span class="p">[</span><span class="s">"contb_receipt_amt"</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
</div></div></div></div>

<p>The above code splits the columns we want to use to train the algorithm, and the column we want to make predictions on (<code>contb_receipt_amt</code>) each both train and test sets.  We take <code>33%</code> of the data for the test set.  The rows are randomly assigned to the sets.</p>

<h2 id="fitting-a-model">Fitting a model</h2>

<p>We’ll use the <a href="https://en.wikipedia.org/wiki/Random_forest">random forest</a> algorithm to make our predictions.  It’s an accurate and versatile algorithm, and it’s implemented by scikit-learn via the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">RandomForestRegressor</a> class.  This class makes it simple to train the model, then make predictions with it.</p>

<p>First, we’ll train the model using <code>train</code> and <code>y_train</code>:</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [52]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><p class="prompt output_prompt">Out[52]:</p>


<div class="output_text output_subarea output_execute_result">
<pre>RandomForestRegressor(bootstrap=True, compute_importances=None,
           criterion='mse', max_depth=None, max_features='auto',
           max_leaf_nodes=None, min_density=None, min_samples_leaf=10,
           min_samples_split=2, n_estimators=100, n_jobs=1,
           oob_score=False, random_state=None, verbose=0)</pre>
</div>

</div>

</div>
</div>

</div>
</div></div></div></div>

<p>One of the great things about scikit-learn is that it has a consistent API across all the algorithms it implements.  You can train a linear regression the exact same way you train a random forest.  We now have a fit model, so we can make predictions with it.</p>

<h2 id="making-predictions-and-finding-error">Making predictions and finding error</h2>

<p>It’s very easy to make predictions with scikit-learn.  We just pass in our test data to the fitted model.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [54]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
</div></div></div></div>

<p>Now that we have predictions, we can calculate error.  Our error will let us know how well our model is performing, and give us a way to evaluate it as we make tweaks.  We’ll use <a href="https://en.wikipedia.org/wiki/Mean_squared_error">mean squared error</a>, a common error metric.</p>

<div class="row jupyter"><div class="col-md-12"><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<p class="prompt input_prompt">In [57]:</p>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>



</div>
</div></div></div></div>

<p>If you want to learn more about scikit-learn, check out our tutorials <a href="https://www.dataquest.io/section/machine-learning">here</a>.</p>

<h2 id="next-steps">Next steps</h2>

<p>Taking the square root of the error you got will give you an error value that’s easier to think about in terms of donation size.  If you don’t take the square root, you’ll have the average squared error, which doesn’t directly mean anything in the context of our data.  Either way, the error is large, and there are many things you can do to lower it.</p>

<ul>
  <li>Add in data from more columns.</li>
  <li>See if per-candidate models are more accurate.</li>
  <li>Try other algorithms.</li>
</ul>

<p>Here are some other interesting data explorations you could do:</p>

<ul>
  <li>Map out which candidates get the most donations from each state.</li>
  <li>Plot which occupations give the most to each candidate.</li>
  <li>Divide candidates by Republican/Democrat, and see if any interesting patterns emerge.</li>
  <li>Assign genders based on name, and see if splitting the data by gender reveals any interesting patterns.</li>
  <li>Make a heatmap of total donations by area of the US.</li>
</ul>

<p>If you want to dive more deeply into the concepts mentioned here, check out our lessons on <a href="https://www.dataquest.io">Dataquest</a>.</p>


        </section>

        </div></body></html>