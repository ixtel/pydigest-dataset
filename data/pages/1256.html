<html><body><div><div class="the-content">
    							<p>A few weeks ago, we announced that we would be <a href="http://blog.sendwithus.com/upgrading-to-jinja/">upgrading our templating language from Django to Jinja</a> and discussed some of the reasons for doing so. At the time we promised a follow-up with more depth on the technical details. Today we’re here to fulfill that promise.</p>
<p>As mentioned previously, the three big reasons we’re upgrading to Jinja are that it’s highly extensible, fast, and easy to sandbox. We also considered <a href="http://genshi.edgewall.org/wiki/Documentation/templates.html">Genshi </a>and <a href="http://www.makotemplates.org/">Mako</a>, but eventually landed on <a href="http://jinja.pocoo.org/">Jinja </a>because, in addition to fulfilling our criteria, Jinja had the advantage of being based on Django. This meant that it already rendered almost all of our Django templates correctly from the get go and wouldn’t require as much work to migrate everyone over.</p>
<p>Clearly Jinja has a lot to offer, but today we want to focus on the performance advantages, so let’s get benchmarking!</p>
<p><span id="more-533"/></p>
<h2>A New Challenger Approaches</h2>
<p>To measure performance of Jinja and Django templates we chose three benchmark parameters. The number of variables contained, the number of items being iterated in a for loop, and a real world test using actual email templates.</p>
<p><em>To keep the tests’ performance measurements fair between Jinja and Django the parsed versions of the templates were not cached. So unless otherwise stated, render can be taken to mean parse then render.</em></p>
<p><a href="http://blog.sendwithus.com/wp-content/uploads/2014/08/VarRender1.png"><img class="aligncenter wp-image-542 size-full" src="http://blog.sendwithus.com/wp-content/uploads/2014/08/VarRender1.png" alt="VarRender1"/></a></p>
<p> </p>
<p>Starting with the variables it is easy to see that Django seems to have a clear advantage. For most real world templates there will be far less than even fifty rendered variables, but still it is interesting how much faster Jinja’s performance decreases as this number increases.</p>
<p><a href="http://blog.sendwithus.com/wp-content/uploads/2014/08/VarMem1.png"><img class="aligncenter wp-image-543 size-full" src="http://blog.sendwithus.com/wp-content/uploads/2014/08/VarMem1.png" alt="VarMem1"/></a></p>
<p> </p>
<p>In this same test we see that Jinja uses about six megabytes less memory than Django for normal inputs. Again we see the memory used by Jinja linearly increasing with the number of template variables, where Django’s memory usage is pretty much flat.</p>
<p><a href="http://blog.sendwithus.com/wp-content/uploads/2014/08/LoopRender1.png"><img class="aligncenter wp-image-544 size-full" src="http://blog.sendwithus.com/wp-content/uploads/2014/08/LoopRender1.png" alt="LoopRender1"/></a></p>
<p>When rendering variables in a loop the story is similar: for all practical inputs Django appears to render faster than Jinja. Interestingly though, this time Django slows down in a similar manner to Jinja in the first test.</p>
<p><a href="http://blog.sendwithus.com/wp-content/uploads/2014/08/LoopMem1.png"><img class="aligncenter wp-image-545 size-full" src="http://blog.sendwithus.com/wp-content/uploads/2014/08/LoopMem1.png" alt="LoopMem1"/></a></p>
<p>For memory usage in this test, again Jinja uses quite a bit less memory than Django at all scales in the test range.</p>
<p><a href="http://blog.sendwithus.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-25-at-10.10.19-AM.png"><img class="aligncenter size-full wp-image-570" src="http://blog.sendwithus.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-25-at-10.10.19-AM.png" alt="Screen Shot 2014-08-25 at 10.10.19 AM"/></a></p>
<p><a href="http://blog.sendwithus.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-25-at-10.11.36-AM.png"><img class="aligncenter size-full wp-image-571" src="http://blog.sendwithus.com/wp-content/uploads/2014/08/Screen-Shot-2014-08-25-at-10.11.36-AM.png" alt="Screen Shot 2014-08-25 at 10.11.36 AM"/></a></p>
<p>The performance of extensions is where Jinja really shines. Our new Jinja snippets render significantly faster, and as expected us much less memory than our Django equivalent.</p>
<h2>Real World (w/ Caching) Testing</h2>
<p>The next part of the bench mark was to test performance with real data. Five thousand different templates from the Sendwithus database were rendered with real world data. Given how Django out performed Jinja on the benchmarks, we expected that it would perform similarly on real templates. To our surprise over our dataset Jinja was nearly 4.5 times faster than Django.</p>
<p><a href="http://blog.sendwithus.com/wp-content/uploads/2014/08/realdataRender11.png"><img class="aligncenter wp-image-546 size-full" src="http://blog.sendwithus.com/wp-content/uploads/2014/08/realdataRender11.png" alt="realdataRender1"/></a>With the addition of caching the compiled Jinja templates we were able to get more than a 10x performance increase from the Jinja templates over our old email rendering system.</p>
<h2>Conclusions</h2>
<p>Given the huge performance differences between the our benchmarks and the performance of rendering real templates within Sendwithus, we are reminded to be weary of somewhat contrived benchmarks. Still, the benchmark performance gains on our Jinja snippets extension is promising. One of the reasons we were most stoked about switching to Jinja is the ability to easily write cool and performant new template extensions.</p>
<div class="ssba ssba-wrap"><div><p>Share this post</p><a data-site="" class="ssba_twitter_share" href="http://twitter.com/share?url=http://blog.sendwithus.com/python-templating-performance-showdown-django-vs-jinja/&amp;text=Python+Templating+Performance+Showdown%3A+Django+vs+Jinja+" target="_blank"><img src="http://blog.sendwithus.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/twitter.png" title="Twitter" class="ssba ssba-img" alt="Tweet about this on Twitter"/></a><a data-site="" class="ssba_facebook_share" href="http://www.facebook.com/sharer.php?u=http://blog.sendwithus.com/python-templating-performance-showdown-django-vs-jinja/" target="_blank"><img src="http://blog.sendwithus.com/wp-content/plugins/simple-share-buttons-adder/buttons/somacro/facebook.png" title="Facebook" class="ssba ssba-img" alt="Share on Facebook"/></a></div></div>
    							    						</div>

    						</div></body></html>