<html><body><div><div class="content html_format"><p>
      В данном посте представлен обзор новшеств и особенностей популярного среди Python разработчиков фреймворка Django 1.7. Релиз позиционируется как сообществом, так и основными разработчиками — как наиболее значимый релиз, с момента выхода в свет Django 1.0.</p>

<img src="https://habrastorage.org/getpro/habr/post_images/37e/465/2cc/37e4652cc459cf199d92030a0887268e.jpg" alt="image"/>
<a name="habracut"/>

<h4>Новшества в версии 1.7</h4><p>
Прекращение поддержки Python 2.6. Теперь поддерживается версия Python 2.7 и выше. Заявлена поддержка Python 3.4.</p><p>
Добавлена нативная поддержка </p><a href="https://docs.djangoproject.com/en/dev/topics/migrations/">миграций</a><p> непосредственно в сам фреймворк. Можно поблагодарить за это автора популярной батарейки South — </p><a href="https://github.com/andrewgodwin">Andrew Godwin-а</a><p>.
</p><p>
Команда syncdb объявлена как устаревшая, и будет удалена в Django 1.9. До тех пор syncdb является псевдонимом команды migrate, которая обеспечивает как выполнение миграций, так и старое поведение syncdb.</p><p>
Фикстуры initial_data более не инициализируются по умолчанию для приложений с миграциями. Предлагается воспользоваться загрузкой фикстур на уровне самих миграций.
</p><p>
Механизм </p><a href="https://docs.djangoproject.com/en/dev/ref/applications/">загрузки приложения</a><p> — был подвергнут полному рефакторингу. В результате можно отказаться от models.py, который ранее идентифицировал приложение и был обязательным.</p><p>
Новые методы подклассов </p><a href="https://docs.djangoproject.com/en/dev/howto/custom-model-fields/#django.db.models.Field">Field</a><p>. Главная особенность — это обязательный метод deconstruct(). К сожалению в этом вина включения миграций в состав Django. Если Вы наследуетесь от стандартных полей и не переопределяете метод __init__, то заботиться Вам об этом не придется.
</p><p>
Появилась возможность вызовов </p><a href="https://docs.djangoproject.com/en/dev/topics/db/managers/#create-manager-with-queryset-methods">QuerySet-ов</a><p> напрямую из менеджера:

</p><pre><code class="python">class FoodQuerySet(models.QuerySet):
    def pizzas(self):
        return self.filter(kind='pizza')

    def vegetarian(self):
        return self.filter(vegetarian=True)

class Food(models.Model):
    kind = models.CharField(max_length=50)
    vegetarian = models.BooleanField()
    objects = FoodQuerySet.as_manager()

Food.objects.pizzas().vegetarian()
</code></pre><p>
Возможность указать необходимый менеджер при использовании связывания моделей:
</p><pre><code class="python">class Blog(models.Model):
    pass

class Entry(models.Model):
    blog = models.ForeignKey(Blog)

    objects = models.Manager()  # Default Manager
    entries = EntryManager()    # Custom Manager

b = Blog.objects.get(id=1)
b.entry_set(manager='entries').all()
</code></pre>
<p>
Новая система, для проверки проекта(System check), которая при запуске опеделяет проблемы и подсказывает что и как необходимо исправить. Для проверки, используется новая команда check, пришедшая на замену устаревшей команде validate.</p><p>
Новый </p><a href="https://docs.djangoproject.com/en/dev/ref/models/queries/#django.db.models.Prefetch">Prefetch</a><p> для продвинутых операций prefetch_related. Теперь можно настроить предварительную выборку используя QuerySet-ы.
</p><p>
Поддержка текущего часового пояса в панели администратора, при работе с виджетом даты. Прежде использовался часовой пояс браузера. При расхождении времени в браузере и на сервере — выводится визуальная подсказка.
</p><p>
Курсор баз данных, теперь может использоваться в качестве контекст менеджера, что является сокращением для:

</p><pre><code class="python">c = connection.cursor()
try:
    c.execute(...)
finally:
    c.close()
</code></pre>
<p>
Возможность определения собственных </p><a href="https://docs.djangoproject.com/en/dev/ref/models/custom-lookups/#django.db.models.Lookup">типов поиска</a><p>, для фильтрации при использовании ORM.

</p><pre><code class="python">from django.db.models import IntegerField
from django.db.models import Transform

class AbsoluteValue(Transform):
    lookup_name = 'abs'

    def as_sql(self, qn, connection):
        lhs, params = qn.compile(self.lhs)
        return "ABS(%s)" % lhs, params

IntegerField.register_lookup(AbsoluteValue)

# Использование
Experiment.objects.filter(change__abs=27)

# В результате получим
# SELECT ... WHERE ABS("experiments"."change") = 27
</code></pre>

<h4>Другие интересные изменения</h4>
<b>django.contrib.admin</b>


<b>django.contrib.auth</b>


<b>django.contrib.sites</b>


<b>E-mail</b>


<b>Загрузка файлов</b>


<b>Формы</b>
<ul>
<li>Textarea теперь включает атрибут max_length, если в модели определен max_length.</li>
<li>Field.choices позволяет задать value для пустого значения. По умолчанию "-------".</li>
<li>В формах в методе clean() более не требуется возвращать self.cleaned_data.</li>
<li>Появилась возможность удалить поля из формы, путем установки их имени в None.</li>
<li>Новый метод add_error() позволяет задавать ошибки для конкретных полей.</li>
<li>Добавлена возможность задавать и выводить ошибки к ограничителям вида unique, unique_for_date, и unique_together.</li>
</ul>

<b>Интернационализация</b>
<ul>
<li>Атрибут <a href="https://docs.djangoproject.com/en/dev/ref/middleware/#django.middleware.locale.LocaleMiddleware.response_redirect_class">django.middleware.locale.LocaleMiddleware.response_redirect_class</a> позволяет настроить переадресацию.</li>
<li><a href="https://docs.djangoproject.com/en/dev/ref/middleware/#django.middleware.locale.LocaleMiddleware">LocaleMiddleware</a> хранит выбранный язык пользователем язык в _language. Получить доступ, можно используя константу LANGUAGE_SESSION_KEY.</li>
<li>Тег <a href="https://docs.djangoproject.com/en/dev/topics/i18n/translation/#std:templatetag-blocktrans">blocktrans</a> удаляет атрибут trimmed. Данная опция удаляет символы новой строки с начала и до конца, обьеденяя их через пробел. Что удобно для генерации файлов локали.</li>
<li>Улучшен <a href="https://docs.djangoproject.com/en/dev/ref/django-admin/#django-admin-makemessages">makemessages</a>. </li>
<li>Были добавлены следущие языковые константы: LANGUAGE_COOKIE_AGE, LANGUAGE_COOKIE_DOMAIN and LANGUAGE_COOKIE_PATH.</li>
</ul>

<b>Команды управления</b>
<ul>
<li>Возможность отключить цветной вывод в консоль.</li>
<li>Добавлена возможность дампа данных с первичными ключами при сериализации.</li>
<li>Нет необходимости указывать название кеш таблицы при использовании createcachetable. Теперь Django это делает сама, с учетом настройки кеша в настройках проекта.</li>
<li>Команда runserver была улучшена. Теперь при установленном pyinotify, скорость релоада стала выше, и меньше потребляет батарею на ноутах. Так же сервер релоадиться при использовании команды compilemessages. Выводятся в консоль все запросы к статике, которые прежде фильтровались.</li>
</ul>

<b>Модели</b>
<ul>
<li>Новый метод <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#django.db.models.query.QuerySet.update_or_create">QuerySet.update_or_create()</a>.</li>
<li>Новая Meta опция <a href="https://docs.djangoproject.com/en/dev/ref/models/options/#django.db.models.Options.default_permissions">default_permissions</a>, которая позволяет настроить операции создания/изменения/удаления.</li>
<li>Обнаружение OneToOneField при наследовании в абстрактных классах.</li>
<li>Добавлена возможность использовать None в качестве значения запроса при использовании <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#std:fieldlookup-iexact">iexact</a>.</li>
<li>Возможность использования единого списка в <a href="https://docs.djangoproject.com/en/dev/ref/models/options/#django.db.models.Options.index_together">index_together</a> при указании одного набора полей(не список в списках).</li>
<li>Числовые поля теперь проверяются в зависимости от БД. Ранее могло приводить к ошибке.</li>
</ul>

<b>Запросы и ответы</b>

<b>Утилиты</b>

<p>
Данный пост является вольным интерпретированием официальной документации находящейся в стадии разработки, и носит исключительно ознакомительный характер. </p><p>
В него включены наиболее интересные вещи с точки зрения автора поста. Для более подробного и детального ознакомления, можно </p><p>
перейти на страницу </p><a href="https://docs.djangoproject.com/en/dev/releases/1.7/">документации</a><p>.

      	</p><div class="polling">
		

	

    <p class="for_users_only_msg">Только зарегистрированные пользователи могут участвовать в опросе. <a href="https://habrahabr.ru/auth/login/">Войдите</a>, пожалуйста.</p>
	</div>

      <p class="clear"/>
    </div>

    
  </div></body></html>