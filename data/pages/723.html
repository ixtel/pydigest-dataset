<html><body><div><div class="ui text container">
    


    
  
  

<p><a href="https://github.com/peterbe/grymt">grymt</a> is a python tool that takes a directory full of .html, .css and .js and prepares the html for optimial production use. </p>
<p>For a teaser:  </p>
<ol>
<li>
<p><a href="https://github.com/peterbe/github-pr-triage/blob/master/app/index.html">Look at the "input"</a>  </p>
</li>
<li>
<p><a href="https://prs.paas.allizom.org/">Look at the "output"</a> (Note! You have to right-click and view source)  </p>
</li>
</ol>
<h4>So why did I write my own tool and not use <a href="http://gruntjs.com/">Grunt</a>?!</h4>
<p>Glad you asked! The reason is simple: I couldn't get Grunt to work.  </p>
<p>Grunt is a framework. It's a place where you say which "recipes" to execute and how. It's effectively a common config framework. Like <a href="http://en.wikipedia.org/wiki/Make_%28software%29">make</a>.<br/>
However, I tried to set up a bunch of recipes in my Gruntfile.js and most of them worked well individually but it was a hellish nightmare to get it all to work together just the way I want it.  </p>
<p>For example, the <a href="https://github.com/gruntjs/grunt-contrib-uglify">grunt-contrib-uglify</a> is fine for doing the minification but it doesn't work with concatenation and it doesn't deal with taking one input file and outputting to a different file.<br/>
Basically, I spent two evenings getting things to work but I could never get exactly what I wanted. So I wrote my own and because I'm quite familiar with this kind of stuff, I did it in Python. Not because it's better than Node but just because I had it near by and was able to quicker build something.  </p>
<h4>So what sweet features do you get out of grymt?</h4>
<ol>
<li>
<p>You can easily make an output file have a hash in the filename. E.g. <code>vendor-$hash.min.js</code> becomes <code>vendor-64f7425.min.js</code> and thus the filename is always unique but doesn't change in between deployments unless you change the files.  </p>
</li>
<li>
<p>It automatically notices which files already have been minified. E.g. no need to minify <code>somelib.min.js</code> but do minify <code>otherlib.js</code>.  </p>
</li>
<li>
<p>You can put <code>$git_revision</code> anywhere in your HTML and this gets expanded automatically. For example, view the source of <a href="http://buggy.peterbe.com">buggy.peterbe.com</a> and look at the first 20 lines.  </p>
</li>
<li>
<p>Images inside CSS get rewritten to have unique names (based on files' modified time) so they can be far-future cached aggresively too.  </p>
</li>
<li>
<p>You never have to write down any lists of file names in soome Gruntfile.js equivalent file  </p>
</li>
<li>
<p>It copies ALL files from a source directory. This is important in case you have something like this inside your javascript code: <code>$('&lt;img&gt;').attr('src', 'picture.jpg')</code> for example.  </p>
</li>
<li>
<p>You can chose to inline all the minified and concatenated CSS or javascript. Inlining CSS is neat for single page apps where you have a majority of primed cache hits. Instead of one .html and one .css you get just one .html and the amount of bytes is the same. Not having to do another HTTP request can save a lot of time on web performance.  </p>
</li>
<li>
<p>The generated (aka. "dist" directory) contains everything you need. It does not refer back to the source directory in any way. This means you can set up your apache/nginx to point directly at the root of your "dist" directory.  </p>
</li>
</ol>
<h4>So what's the catch?</h4>
<ol>
<li>
<p>It's not Grunt. It's not a framework. It does only what it does and if you want it to do more you have to work on grymt itself.  </p>
</li>
<li>
<p>The files you want to analyze, process and output all have to be in a sub directory.<br/>
Look at how I've laid out the files here in <a href="https://github.com/peterbe/github-pr-triage">this project for example</a>. ALL files that you need is all in one sub-directory called <code>app</code>. So, to run <code>grymt</code> I simply run: <code>grymt app</code>.  </p>
</li>
<li>
<p>The HTML files you throw into it have to be plain HTML files. No templates for server-side code.  </p>
</li>
</ol>
<h4>How do you use it?</h4>
<pre>
pip install grymt
</pre>

<p>Then you need a directory it can process, e.g <code>./client/</code> (assumed to contain a .html file(s)).  </p>
<pre>
grymt ./client
</pre>

<p>For more options, check out  </p>
<pre>
grymt --help
</pre>

<h4>What's in the future of grymt?</h4>
<p>If people like it and want to add features, I'm more than happy to accept pull requests. Some future potential feature work:  </p>
<ul>
<li>
<p>I haven't needed it immediately, yet, myself, but it would be nice to add things like coffeescript, less, sass etc into pre-processing hooks. </p>
</li>
<li>
<p>It would be easy to automatically generate and insert a reference to a appcache manifest. Since every file used and mentioned is noticed, we could very accurately generate an appcache file that is less prone to human error. </p>
</li>
<li>
<p>Spitting out some stats about number bytes saved and number of files reduced. </p>
</li>
</ul>

  <section id="buttons">
    <a href="https://twitter.com/peterbe" class="twitter-follow-button" data-show-count="false">Follow @peterbe</a>
  </section>

  <h2 class="ui dividing header">Comments</h2>

      
    
  
      <p id="preview-comment-outer" class="ui comments preview"/>

    
  

<h2 class="ui dividing header">Related posts</h2>

<dl>
    <dt>Previous:</dt>
  <dd><a href="/plog/copyfile_disable">COPYFILE_DISABLE and python distutils in python 2.6</a>
  <small>12 April 2014</small>
  </dd>
  
    <dt>Next:</dt>
  <dd><a href="/plog/wattvision">Wattvision - real-time energy monitoring</a>
  <small>27 April 2014</small>
  </dd>
  </dl>

<dl>
  <dt>Related by keywords:</dt>
    <dd><a href="/plog/comparing-google-closure-with-uglifyjs" data-plogrank="2159.0">Comparing Google Closure with UglifyJS</a>
  <small>10 July 2011</small>
  </dd>
    <dd><a href="/plog/comparing-jsmin-and-slimmer" data-plogrank="185.0">Comparing jsmin and slimmer</a>
  <small>17 September 2009</small>
  </dd>
  </dl>

  </div>

  </div></body></html>