<html><body><div><p>This post is the first of a series about the use of Python, a programming language, and it's uses for investigative
journalists. That might sound a bit strange, because programming is not the first thing to think of when doing research.
Starting with simple examples going to more advanced cases, I would like to show how to create your own toolkit for
future use.</p>
<div class="section" id="a-practical-example">
<h2>A practical example</h2>
<p>A simple setup of the first example can be managed in Python with the addition of a library: Tweepy. Tweepy is not
included in the Anaconda distribution. For this, we use PyCharm to install it. Start PyCharm and again, go to the
settings. Select your Python installation (which is the Anaconda install by default, if you've never used or installed
Python before) and click the '+' button to install a new package (for example a library like Tweepy). Search for
'Tweepy', select the package with the matching name and click 'install'. The package should install without errors.</p>
<p>For Tweepy to work, you need a Twitter API key. Go to <a class="reference external" href="https://apps.twitter.com">apps.twitter.com</a> and log in with
your Twitter account or create an account. Click 'Create a new app' and fill in the form. You do not need to enter a
callback url for a standalone application like we are going to make. The system will give you an API key and an API
secret. When you have your application selected in this menu, click on 'API Keys' and generate an access token.
These four keys are used in the application. The API key and the API secret are used in the application itself, the
Access token and the Access token secret are used to identify your account with the application. In applications used by
multiple Twitter accounts, the access token and it's secret are obtained by a oauth call. We might talk about that in a
later post.</p>
<p>Enough talk for now, I'll move on to the example and explain what it does.</p>
<div class="highlight"><pre><span class="c"># coding=utf8</span>
<span class="c"># A program to search twitter for a given search query in a given area.</span>
<span class="kn">import</span> <span class="nn">tweepy</span>

<span class="n">api_key</span> <span class="o">=</span> <span class="s">'API KEY'</span>  <span class="c"># replace API KEY with your api key</span>
<span class="n">api_secret</span> <span class="o">=</span> <span class="s">'API SECRET'</span>  <span class="c"># replace API SECRET with your api secret</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="s">'ACCESS TOKEN'</span>  <span class="c"># replace ACCESS TOKEN with your access token</span>
<span class="n">access_token_secret</span> <span class="o">=</span> <span class="s">'ACCESS TOKEN SECRET'</span>  <span class="c"># replace ACCESS TOKEN SECRET with your access token secret</span>

<span class="n">search_query</span> <span class="o">=</span> <span class="s">'#GazaUnderAttack'</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="mf">31.494722</span>  <span class="c"># latitude of the location</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="mf">34.451667</span>  <span class="c"># longitude of the location</span>
<span class="n">search_range</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c"># range in kilometers</span>

<span class="n">search_area</span> <span class="o">=</span> <span class="s">'{0},{1},{2}km'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">search_range</span><span class="p">)</span>

<span class="n">authentication</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
<span class="n">authentication</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">authentication</span><span class="p">)</span>
<span class="n">search</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">search_query</span><span class="p">,</span> <span class="n">geocode</span><span class="o">=</span><span class="n">search_area</span><span class="p">)</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">search</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
<p>That might look quite complicated. We will walk through the program line by line.</p>
<div class="highlight"><pre><span class="c"># coding=utf8</span>
<span class="c"># A program to search twitter for a given search query in a given area.</span>
</pre></div>
<p>In Python, every line starting with a '#' is known as a comment. You can enter everything you want behind this sign and
the program won't pick it up as code. This way you can document what you are writing, write instructions for yourself or
for others and make sure you understand what you just wrote in a couple of years time.
<tt class="docutils literal"># coding=utf8</tt> is a special instruction for the Python interpreter, the program that reads your code and executes it.
To make sure non-ascii characters, for example Arabic or Cyrillic characters, can be used in your program without the
interpreter falling over it, put this on the first line of your program (or the second line if you specify which
interpreter must be used, but as we didn't in this example, just put it on the first line).</p>

<p>Every non-comment line contains one statement. In Python, every library you would like to use in your program has to be
loaded. Even the libraries included with the basic installation of Python must be imported to use them.</p>
<div class="highlight"><pre><span class="n">api_key</span> <span class="o">=</span> <span class="s">'API KEY'</span>  <span class="c"># replace API KEY with your api key</span>
<span class="n">api_secret</span> <span class="o">=</span> <span class="s">'API SECRET'</span>  <span class="c"># replace API SECRET with your api secret</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="s">'ACCESS TOKEN'</span>  <span class="c"># replace ACCESS TOKEN with your access token</span>
<span class="n">access_token_secret</span> <span class="o">=</span> <span class="s">'ACCESS TOKEN SECRET'</span>  <span class="c"># replace ACCESS TOKEN SECRET with your access token secret</span>
</pre></div>
<p>Now it is getting more interesting: variables. A variable can hold a value, whether that is a piece of text, a number or
a more complex data structure like a list of values. In Python, all you have to do to declare a variable is to give it
a name and give it a value, like this: <tt class="docutils literal">name = value</tt>. To enter a piece of text, a so called string, put it between
quotes. You can use both single and double quotes, but not a mix of them. Single quotes are preferred by the style
guideline known as PEP8. By following this set of guidelines, even large programs are easy enough to read. PEP8 does
contain a section about variable naming as well: use whole words or even multiple words and replace the spaces by
underscores. So the most logical name for a access token secret is <tt class="docutils literal">access_token_secret</tt>.
Again, we see comments, however in a slightly different way. When added somewhere halfway a line, they start a comment
till the end of the line. Another style guideline from PEP8 says that when you add a comment to a line with a statement,
separate the statement and the comment by two (2) spaces, add a '#' to start the comment and put another space there
before starting the comment text. The same thing applies to regular comments.</p>
<div class="highlight"><pre><span class="n">search_query</span> <span class="o">=</span> <span class="s">'#GazaUnderAttack'</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="mf">31.494722</span>  <span class="c"># latitude of the location</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="mf">34.451667</span>  <span class="c"># longitude of the location</span>
<span class="n">search_range</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c"># range in kilometers</span>
</pre></div>
<p>Here we have another set of variables. Note the hashtag in the search query. The next part of the line is not read as a
comment however, because it is enclosed by (single) quotes, thus being part of a string. The next variable <tt class="docutils literal">latitude</tt>,
is not a string. The decimal value is known as a floating point number, float in short. To declare a variable as a
float, simply put it there without any quotation marks. Use a dot as the decimal separator. The variable
<tt class="docutils literal">search_range</tt> is a number, known as a integer. To make things complicated in programming, 15 is not the same as 15.0,
because the first is an integer and the second one a float. For now, let's not focus on that fact and continue with the
next block.</p>
<div class="highlight"><pre><span class="n">search_area</span> <span class="o">=</span> <span class="s">'{0},{1},{2}km'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">search_range</span><span class="p">)</span>
</pre></div>
<p>This line is a matter of taste. There are more ways to glue different variables together to one string. I prefer this
way, others might prefer other ways. With <em>my</em> way, more advanced formatting is possible. Again, we declare a variable
of a string type. This time however, we also call a function to do something with this string. By using the format
function, it is possible to replace parts enclosed in brackets by specified variables. In most programming languages,
including Python, we start counting from 0 instead of 1. When calling the format function, you supply variables to
replace parts in brackets. The part marked as <tt class="docutils literal">{0}</tt> is replaced by the first supplied variable, the part marked
<tt class="docutils literal">{1}</tt> is replaced by the second supplied variable and so on. You can even reuse variables, if for example you wrote
this: <tt class="docutils literal">'{0} is the same as <span class="pre">{0}'.format(variable)</span></tt>. To call the function format on a string, add a dot to the value
like seen above, and type the name of the function, which in this case is <tt class="docutils literal">format</tt>. Add parentheses and between them
add the variables, separated with commas.</p>
<p>If not used to this way of writing, it looks difficult. As I said, there are different ways to do this. I'll list a
couple more:</p>
<div class="highlight"><pre><span class="n">search_area</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span> <span class="o">+</span> <span class="s">','</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span> <span class="o">+</span> <span class="s">','</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">search_range</span><span class="p">)</span> <span class="o">+</span> <span class="s">'km'</span>
<span class="n">search_area</span> <span class="o">=</span> <span class="s">'31.494722,34.45166,15km'</span>
</pre></div>
<p>I'll start with the second line. Although this is perfectly possible, it is not what we want. It might work out fine
for now, but every time we use a different location, we have to change this line. In the current situation, we only have
to change the variables latitude and longitude to a different value. We might even fill them dynamically...
Some people prefer the first line. To glue strings together, just sum them up. However, every part must be a string for
this to work. Both latitude and longitude are floats and with search_range being an integer, just summing them up does
not work. We have to 'cast' every non-string to a string, by calling the 'string' function. The string function takes
one argument, the variable we want to cast to a string. It returns the same variable, but with the string type. The
format function, described above, does the same thing in putting the string together. However, it automatically casts
a non-string variable you supply to it to a string.</p>
<p>As I said before, it is a matter of taste. Both cases work, but the format function does the checking to see which
variables must be translated to a string type.</p>
<div class="highlight"><pre><span class="n">authentication</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">api_secret</span><span class="p">)</span>
<span class="n">authentication</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>
</pre></div>
<p>Next, we are finally going to use the Tweepy library. We call the 'OAuthHandler' function from the tweepy library and
supply our api key and api secret. The resulting 'object' is put in the variable authentication.
On the object authentication, we call the function set_access_token and supply our access token and access token
secret. As we can see, <tt class="docutils literal">authentication</tt> is a special kind of variable. I'll explain more about this in future posts.
For now, we just accept that this variable has it's own set of functions.</p>
<div class="highlight"><pre><span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">authentication</span><span class="p">)</span>
<span class="n">search</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">search_query</span><span class="p">,</span> <span class="n">geocode</span><span class="o">=</span><span class="n">search_area</span><span class="p">)</span>
</pre></div>
<p>Until now, we did the make a lot of variables and used a couple of functions. Here, we are finally going to use them.
The first line authenticates our client by Twitter and logs in with the account used to create the application.
The resulting object is put in the variable api. Like <tt class="docutils literal">authentication</tt>, this is a special kind of variable as well.
The second line is where we were al waiting for: the actual search. We call the function search on the api object and
supply the search query and the geocode. By all functions until now, we had positional arguments; arguments that had to
be supplied in the correct order. This function uses keyword arguments. The other functions had keyword arguments as
well, but we did not use them, as keyword arguments are optional. All arguments, both positional and keyword arguments,
are explained in the <a class="reference external" href="http://tweepy.readthedocs.org/en/v2.3.0/">Tweepy documentation</a>.</p>
<p>This function gives another object in return. This object, of the type <tt class="docutils literal">tweepy.models.SearchResults</tt>, has a couple of
features we will use in the next part: it is basically a collection of data that we can walk through.</p>
<div class="highlight"><pre><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">search</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
<p>The final part of the program. As described in the previous block, we can walk through <tt class="docutils literal">search</tt>. In Python, this
feature is called an <em>iterable</em>. By using the for statement, we can walk through an iterable object. This is done by
telling Python we want to loop through <tt class="docutils literal">search</tt> and every time we do that, we the next piece of data out of it, until
we reach it's end. This piece of data we pull out will be put in the variable <tt class="docutils literal">item</tt>. This variable can only be used
within the block that follows. To open this block, put a colon to the end of the line. All lines within the block are
indented with four (4) spaces or a tab. Do not merge tabs and spaces, or the interpreter will fall over it. PEP8, the
style guidelines prefer the use of four spaces. Python versions 3 and above do not even accept tabs. When using PyCharm,
you do not have to worry about this. When you press tab, the editor inserts the correct amount of spaces instead of a
tab. When you stop indenting lines, the interpreter assumes the block has ended. Every time the for statement loops over
<tt class="docutils literal">search</tt>, the whole block that follows is repeated. The only thing that is different every time, is the value of the
variable <tt class="docutils literal">item</tt>. The block must have at least one line. In this case, it is exactly one line.</p>
<p>Here, we introduce another function: the print function. What it does is very simple. It prints the value of the
supplied variable to the output. The variable <tt class="docutils literal">item</tt> is another kind of special object. It contains a lot of values,
including <tt class="docutils literal">text</tt>. That value is the text of the tweet.</p>
<p>Other values of <tt class="docutils literal">item</tt> are: <tt class="docutils literal">author</tt>, <tt class="docutils literal">contributors</tt>, <tt class="docutils literal">coordinates</tt>, <tt class="docutils literal">id</tt>, <tt class="docutils literal">geo</tt>, <tt class="docutils literal">lang</tt>, <tt class="docutils literal">place</tt>,
<tt class="docutils literal">user</tt>, and a lot more. To view all functions and values an object has, use the <tt class="docutils literal">dir</tt> function. The dir function
takes one argument: the object you would like information about. You can use it like this:</p>

</div>
</div></body></html>