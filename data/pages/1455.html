<html><body><div><div class="entry-content">
                    <p>Sometimes in the <tt class="docutils literal">clean()</tt>, <tt class="docutils literal">clean_FOO</tt> or <tt class="docutils literal">save()</tt> methods of a Django form, you need to have additional form instance attributes available. A sample case for this is having <tt class="docutils literal">user_id</tt> available. This is a simple example of how to do it in Class-Based Views.</p>
<p>Assuming this form:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MyModel</span>


<span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># set the user_id as an attribute of the form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
</pre></div>
<p>Now that the form is defined, the view needs to inject the form with the user id:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">UpdateView</span>

<span class="c"># this assumes that django-braces is installed</span>
<span class="kn">from</span> <span class="nn">braces.views</span> <span class="kn">import</span> <span class="n">LoginRequiredMixin</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">MyForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MyModel</span>


<span class="k">class</span> <span class="nc">MyUpdateView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">MyForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="s">"/someplace/"</span>

    <span class="k">def</span> <span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""This method is what injects forms with their keyword</span>
<span class="sd">            arguments."""</span>
        <span class="c"># grab the current set of form #kwargs</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyUpdateView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">()</span>
        <span class="c"># Update the kwargs with the user_id</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">'user_id'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span>
        <span class="k">return</span> <span class="n">kwargs</span>
</pre></div>
<div class="section" id="additional-notes">
<h2>Additional Notes</h2>
<p>You can use this technique with:</p>
<ul class="simple">
<li><tt class="docutils literal">forms.Form</tt></li>
<li><tt class="docutils literal">forms.ModelForm</tt></li>
<li><tt class="docutils literal">CreateView</tt></li>
<li><tt class="docutils literal">FormView</tt></li>
<li><tt class="docutils literal">UpdateView</tt></li>
</ul>
<p>As always, <a class="reference external" href="http://ccbv.co.uk">http://ccbv.co.uk</a> is a great resource for deliving into Django forms.</p>
<p>While this technique is used by <tt class="docutils literal"><span class="pre">django-braces</span></tt> through the <tt class="docutils literal">UserFormKwargsMixin</tt> and <tt class="docutils literal">UserKwargModelFormMixin</tt> mixins, it's useful to know how to do it outside that very useful tool. The reason being that attaching the <tt class="docutils literal">user</tt> object or <tt class="docutils literal">user_id</tt> is just one option out of many.</p>
</div>

<div class="section" id="see-you-at-barcamp-django-sf">
<h2>See you at BarCamp Django SF!</h2>
<p>On October 4th and 5th I'll be at <a class="reference external" href="http://pydanny.com/barcamp-django-sf.html">BarCamp Django SF</a> if you want to talk about Django, Python, or have me teach you how to do cartwheels.</p>
</div>

                    
                </div>
                                </div></body></html>