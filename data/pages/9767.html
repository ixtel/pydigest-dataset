<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-hero-protocol" class="anchor" href="#hero-protocol" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Hero Protocol</h1>

<p>heroprotocol is a reference Python library and standalone tool to decode Heroes of the Storm replay files into Python data structures.</p>

<p>Currently heroprotocol can decode these structures and events:</p>

<ul>
<li>replay header</li>
<li>game details</li>
<li>replay init data</li>
<li>game events</li>
<li>message events</li>
<li>tracker events</li>
</ul>

<p>heroprotocol can be used as a base-build-specific library to decode binary blobs, or it can be run as a standalone tool to pretty print information from supported replay files.</p>

<p>Note that heroprotocol does not expose game balance information or provide any kind of high level analysis of replays; it's meant
to be just the first tool in the chain for your data mining application.</p>

<h1><a id="user-content-supported-versions" class="anchor" href="#supported-versions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Supported Versions</h1>

<p>heroprotocol supports all Hereos of the Storm replay files that were written with retail versions of the game. The current plan is to support all future publicly released versions, including public betas.</p>

<h1><a id="user-content-how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>How to Use</h1>

<p>A working installation of Python 2.x is required. From the folder where <em>heroprotocol</em> is located, type the following into the command line, assuming that the replay file was also copied into the same folder:</p>

<div class="highlight highlight-source-python"><pre>py heroprotocol.py <span class="pl-ii">--</span><span class="pl-k">&lt;</span>option<span class="pl-k">&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>&lt;replayFileName&gt;<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> output.txt</pre></div>

<p>If you want the output shown directly in the terminal, leave out the <code>&gt; output.txt</code>.</p>

<h2><a id="user-content-example-usage" class="anchor" href="#example-usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example Usage</h2>

<div class="highlight highlight-source-python"><pre>py heroprotocol.py <span class="pl-ii">--</span>details <span class="pl-s"><span class="pl-pds">"</span>Blackheart's Bay.StormReplay<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> output.txt</pre></div>

<h2><a id="user-content----arguments" class="anchor" href="#---arguments" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>-- arguments</h2>

<p><code>-h, --help</code> Show the options that are available.</p>

<p><code>--gameevents</code> print all game events including coordinates</p>

<p><code>--messageevents</code> print message events such as ping events</p>

<p><code>--trackerevents</code> print tracker events such as units killed, game stat events, score result event</p>

<p><code>--attributeevents</code> print attribute events, a table of attrid, namespace, and attribute values</p>

<p><code>--header</code> print protocol header including HotS build and elapsedGameLoops</p>

<p><code>--details</code> print protocol details, e.g. teamId, player names and chosen heroes, player region, game result, observer status</p>

<p><code>--initdata</code> print protocol initdata, e.g. interface settings for every player</p>

<p><code>--stats</code> print game stats</p>

<h1><a id="user-content-tracker-events" class="anchor" href="#tracker-events" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Tracker Events</h1>

<p>Some notes on tracker events:</p>

<ul>
<li>Convert unit tag index, recycle pairs into unit tags (as seen in game events) with protocol.unit_tag(index, recycle)</li>
<li>Interpret the NNet.Replay.Tracker.SUnitPositionsEvent events like this:</li>
</ul>

<div class="highlight highlight-source-python"><pre>    unitIndex <span class="pl-k">=</span> event[<span class="pl-s"><span class="pl-pds">'</span>m_firstUnitIndex<span class="pl-pds">'</span></span>]
    <span class="pl-k">for</span> i <span class="pl-k">in</span> <span class="pl-v">xrange</span>(<span class="pl-c1">0</span>, <span class="pl-c1">len</span>(event[<span class="pl-s"><span class="pl-pds">'</span>m_items<span class="pl-pds">'</span></span>]), <span class="pl-c1">3</span>):
        unitIndex <span class="pl-k">+=</span> event[<span class="pl-s"><span class="pl-pds">'</span>m_items<span class="pl-pds">'</span></span>][i <span class="pl-k">+</span> <span class="pl-c1">0</span>]
        x <span class="pl-k">=</span> event[<span class="pl-s"><span class="pl-pds">'</span>m_items<span class="pl-pds">'</span></span>][i <span class="pl-k">+</span> <span class="pl-c1">1</span>] <span class="pl-k">*</span> <span class="pl-c1">4</span>
        y <span class="pl-k">=</span> event[<span class="pl-s"><span class="pl-pds">'</span>m_items<span class="pl-pds">'</span></span>][i <span class="pl-k">+</span> <span class="pl-c1">2</span>] <span class="pl-k">*</span> <span class="pl-c1">4</span>
        <span class="pl-c"># unit identified by unitIndex at the current event['_gameloop'] time is at approximate position (x, y)</span></pre></div>

<ul>
<li>Only units that have inflicted or taken damage are mentioned in unit position events, and they occur periodically with a limit of 256 units mentioned per event.</li>
<li>NNet.Replay.Tracker.SUnitInitEvent events appear for units under construction. When complete you'll see a NNet.Replay.Tracker.SUnitDoneEvent with the same unit tag.</li>
<li>NNet.Replay.Tracker.SUnitBornEvent events appear for units that are created fully constructed.</li>
<li>You may receive a NNet.Replay.Tracker.SUnitDiedEvent after either a UnitInit or UnitBorn event for the corresponding unit tag.</li>
<li>In NNet.Replay.Tracker.SPlayerStatsEvent, m_scoreValueFoodUsed and m_scoreValueFoodMade are in fixed point (divide by 4096 for integer values). All other values are in integers.</li>
<li>There's a known issue where revived units are not tracked, and placeholder units track death but not birth.</li>
</ul>

<h1><a id="user-content-license" class="anchor" href="#license" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>License</h1>

<p>Copyright (c) 2015 Blizzard Entertainment</p>

<p>Open sourced under the MIT license. See the included LICENSE file for more information.</p>

<h1><a id="user-content-acknowledgements" class="anchor" href="#acknowledgements" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Acknowledgements</h1>

<p>The standalone tool uses <a href="https://github.com/eagleflo/mpyq">mpyq</a> to read mopaq files.</p>

<p>Thanks to David Joerg and Graylin Kim of <a href="http://www.ggtracker.com">GGTracker</a> for design feedback and beta-testing of the s2protocol library that heroprotocol is based upon.</p>

<p>Thanks to Ben Barrett of <a href="http://www.hotslogs.com">HOTSLogs</a> for feedback on and beta-testing of the heroprotocol library.</p>
</article>
  </div></body></html>