<html><body><div><div itemprop="articleBody"><p>There was always this annoying thing about RSS/Atom feeds - it's hard to track views or visits. You cannot directly use Google Analytics for feeds cause it wants to run JavaScript. Feedburner could be a solution but it looks like it's not maintained - the list of readers is the same since it got acquired by Google. I haven't seen anything new in it for a while - it looks like it is going to have the same fate as the late Google Reader. It's not particularly good at analytics anyway ...</p><p>We could make Google Analytics register page views in one of these ways:</p><ul class="simple"><li>Include a <tt class="docutils literal">&lt;img&gt;</tt> tag linking to <a class="reference external" href="https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting?csw=1#gifParameters">__utm.gif</a>. Problem is that visitors cannot be tracked. All page views will show up as unique visits.</li><li>Make a request yourself to Google Analytics. There are libraries for this in Python: <a class="reference external" href="https://github.com/kra3/py-ga-mob">pyga</a> and <a class="reference external" href="https://github.com/b1tr0t/Google-Analytics-for-Mobile--python-">ga_app</a>. Sadly, both of them use the old <a class="reference external" href="https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting?csw=1#gifParameters">__utm.gif</a> API.</li><li>Use some <a class="reference external" href="https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting?csw=1#gifParameters">__utm.gif</a> redirector service like <a class="reference external" href="http://nojsstats.blogspot.com/">nojsstats</a>. It looks like it could work but it's closed source and neglected. It tries to set cookies to track visitors (so views don't show up as uniques) but doesn't succeed (it sets expired cookies - makes no sense).</li></ul><p>Now neither of those are really likable solutions since they all use the old outdated (and plain horrible) <a class="reference external" href="https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting?csw=1#gifParameters">__utm.gif</a> API. If you use <a class="reference external" href="https://support.google.com/analytics/answer/2790010?hl=en-GB">Universal Analytics</a> you can use the <a class="reference external" href="https://developers.google.com/analytics/devguides/collection/protocol/v1/">Measurement Protocol</a> which is way better. Compare that to those <a class="reference external" href="https://developers.google.com/analytics/devguides/collection/gajs/cookie-usage?hl=en">obscure</a><tt class="docutils literal">__utm</tt> cookies ...</p><p>The <a class="reference external" href="https://developers.google.com/analytics/devguides/collection/protocol/v1/">Measurement Protocol</a> documentation give POST requests as example, however, GET request work just as well and we can use that to implement a simple, better redirector.</p><p>I've implemented a simple redirector that sets a unique visitor cookie (the <tt class="docutils literal">cid</tt>, see bellow) before redirecting. It's hosted <a class="reference external" href="http://t.ionelmc.ro/">here</a>. You would use it like this:</p><div class="highlight"><pre><span/><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"//t.ionelmc.ro/UA-123456/domain.com?dp=/path/to/page&amp;t=pageview&amp;dr=http%3A//domain.com/referral/path/"</span> <span class="na">width</span><span class="o">=</span><span class="s">"1"</span> <span class="na">height</span><span class="o">=</span><span class="s">"1"</span><span class="p">&gt;</span>
</pre></div><p>Note that the protocol (<tt class="docutils literal">http:</tt> or <tt class="docutils literal">https:</tt>) is missing. This will cause browsers to use the current page's protocol. This is very useful when you don't know what protocol you will use.</p><p>The rest of the parameters:</p><dl class="docutils"><dt><tt class="docutils literal"><span class="pre">UA-123456</span></tt></dt><dd>This is the Tracking ID</dd><dt><tt class="docutils literal">domain.com</tt></dt><dd>This is the domain that you see in your <a class="reference external" href="https://support.google.com/analytics/answer/2790010?hl=en-GB">Universal Analytics</a> javascript tracking code.</dd><dt><tt class="docutils literal">t</tt></dt><dd>Type of event.</dd><dt><tt class="docutils literal">dp</tt></dt><dd>Page url that should show as viewed. You want this to be the page path that the feed item points to. In other words, the URL without the protocol and domain. <em>Don't forget to quote it!</em> <a class="footnote-reference" href="#id4" id="id1">[1]</a></dd><dt><tt class="docutils literal">dr</tt></dt><dd>You can specify a different referral URL here. If you don't specify this then the <tt class="docutils literal">Referer</tt> header is used. Set <tt class="docutils literal">dr</tt> to empty value if you don't want this. <em>Don't forget to quote it!</em> <a class="footnote-reference" href="#id4" id="id2">[1]</a></dd></dl><p>None of the GET parameters are really required - you can add any parameters you want - they get passed to the collector API. I've just outlined the minimum set of parameters required for pageviews.</p><p>If you feel adventurous and want something else read the <a class="reference external" href="https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters">reference</a>.</p><p>Notes:</p><ul class="simple"><li><tt class="docutils literal">cid</tt> is generated in the app (and saved with cookies).</li><li>The Tracking ID and domain are not in the arguments because they have a special role: they are the path for the visitor cookie. So each different combination of Tracking ID and domain will have a different cookie.</li></ul><p>And please don't use my instance for anything serious. Make your own - the sourcecode is <a class="reference external" href="https://github.com/ionelmc/t.ionelmc.ro">here</a> and simple enough to understand.</p><div class="section" id="pelican-integration"><h2>Pelican integration<a class="headerlink" href="#pelican-integration" title="Permalink to this headline"> *</a></h2><p>Now, because I'm using <a class="reference external" href="http://docs.getpelican.com/">Pelican</a> I'm going to show how to make it add that little image to each item in the feeds.</p><p>The easiest way appears to be using a custom <em>Writer</em> that looks like this:</p><div class="highlight"><pre><span/><span class="c1"># tracker.py:</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">sep</span>
<span class="kn">from</span> <span class="nn">pelican</span> <span class="kn">import</span> <span class="n">Pelican</span>
<span class="kn">from</span> <span class="nn">pelican.writers</span> <span class="kn">import</span> <span class="n">Writer</span><span class="p">,</span> <span class="n">Markup</span><span class="p">,</span> <span class="n">set_date_tzinfo</span>

<span class="k">class</span> <span class="nc">TrackingWriter</span><span class="p">(</span><span class="n">Writer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_add_item_to_the_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">Markup</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">striptags</span><span class="p">()</span>
        <span class="n">feed</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">link</span><span class="o">=</span><span class="s1">'</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_url</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">url</span><span class="p">),</span>
            <span class="n">unique_id</span><span class="o">=</span><span class="s1">'tag:</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
                                        <span class="n">item</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">item</span><span class="o">.</span><span class="n">url</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get_content</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_url</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"""</span>
<span class="s2">            &lt;img src="//t.ionelmc.ro/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">?t=pageview&amp;dp=</span><span class="si">%s</span><span class="s2">&amp;referer=</span><span class="si">%s</span><span class="s2">" width="1" height="1"&gt;</span>
<span class="s2">            """</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'GOOGLE_ANALYTICS_ACCOUNT'</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'GOOGLE_ANALYTICS_DOMAIN'</span><span class="p">],</span>
                <span class="s1">'/'</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">'/'</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feed_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">categories</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">tags</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">'tags'</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">author_name</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">'author'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
            <span class="n">pubdate</span><span class="o">=</span><span class="n">set_date_tzinfo</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'TIMEZONE'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)))</span>


<span class="k">class</span> <span class="nc">TrackingPelican</span><span class="p">(</span><span class="n">Pelican</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TrackingWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>
</pre></div><p>And in the settings we put this:</p><pre class="literal-block">
PELICAN_CLASS = 'tracker.TrackingPelican'
</pre><p>Tested to work on Pelican 3.2 and 3.3, pageviews show fine in Google Analytics. Remeber that you need the <a class="reference external" href="https://support.google.com/analytics/answer/2790010?hl=en-GB">Universal Analytics</a>, not the Classic Analytics!</p></div></div></div></body></html>