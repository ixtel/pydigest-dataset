<html><body><div><p>A single-core cache hierarchy simulator written in python.</p>
<p>The goal is to accurately simulate the caching (allocation/hit/miss/replace/evict) behavior of all cache levels found in modern processors. It is developed as a backend to <a href="https://github.com/RRZE-HPC/kerncraft" rel="nofollow">kerncraft</a>, but is also planned to introduce a command line interface to replay LOAD/STORE instructions.</p>
<div id="usage">
<h2>Usage</h2>
<pre><span class="kn">from</span> <span class="nn">cachesim</span> <span class="kn">import</span> <span class="n">CacheSimulator</span><span class="p">,</span> <span class="n">Cache</span><span class="p">,</span> <span class="n">MainMemory</span>

<span class="n">cacheline_size</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">l3</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="mi">20480</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">cacheline_size</span><span class="p">,</span> <span class="s2">"LRU"</span><span class="p">)</span>  <span class="c1"># 20MB 16-ways</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">cacheline_size</span><span class="p">,</span> <span class="s2">"LRU"</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">l3</span><span class="p">)</span>  <span class="c1"># 256kB 8-ways</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">cacheline_size</span><span class="p">,</span> <span class="s2">"LRU"</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">l2</span><span class="p">)</span>  <span class="c1"># 32kB 8-ways</span>
<span class="n">mem</span> <span class="o">=</span> <span class="n">MainMemory</span><span class="p">(</span><span class="n">l3</span><span class="p">)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">CacheSimulator</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">mem</span><span class="p">,</span> <span class="n">write_allocate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">cs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="mi">2342</span><span class="p">)</span>  <span class="c1"># Loads one byte from address 2342, should be a miss in all cache-levels</span>
<span class="n">cs</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># stores 8 bytes to addresses 512-519,</span>
                                 <span class="c1"># will also be a load miss (due to write-allocate)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">520</span><span class="p">)</span>  <span class="c1"># Loads from address 512 until (exclusive) 520 (eight bytes)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">stats</span><span class="p">()))</span>
</pre>
<p>This should return:</p>
<pre><span class="p">[{</span><span class="s1">u'LOAD'</span><span class="p">:</span> <span class="il">17L</span><span class="p">,</span> <span class="s1">u'MISS'</span><span class="p">:</span> <span class="il">2L</span><span class="p">,</span> <span class="s1">u'HIT'</span><span class="p">:</span> <span class="il">15L</span><span class="p">,</span> <span class="s1">u'STORE'</span><span class="p">:</span> <span class="il">8L</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">u'LOAD'</span><span class="p">:</span> <span class="il">2L</span><span class="p">,</span> <span class="s1">u'MISS'</span><span class="p">:</span> <span class="il">2L</span><span class="p">,</span> <span class="s1">u'HIT'</span><span class="p">:</span> <span class="il">0L</span><span class="p">,</span> <span class="s1">u'STORE'</span><span class="p">:</span> <span class="il">8L</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">u'LOAD'</span><span class="p">:</span> <span class="il">2L</span><span class="p">,</span> <span class="s1">u'MISS'</span><span class="p">:</span> <span class="il">2L</span><span class="p">,</span> <span class="s1">u'HIT'</span><span class="p">:</span> <span class="il">0L</span><span class="p">,</span> <span class="s1">u'STORE'</span><span class="p">:</span> <span class="il">8L</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">u'LOAD'</span><span class="p">:</span> <span class="il">2L</span><span class="p">,</span> <span class="s1">u'MISS'</span><span class="p">:</span> <span class="il">0L</span><span class="p">,</span> <span class="s1">u'HIT'</span><span class="p">:</span> <span class="il">2L</span><span class="p">,</span> <span class="s1">u'STORE'</span><span class="p">:</span> <span class="il">8L</span><span class="p">}]</span>
</pre>
<p>Each dictionary refers to one memory-level, starting with L1 and ending with main memory. The 17 loads are the sum of all byte-wise access to the cache-hierarchy. 1 (from first load) +8 (from store with write-allocate) +8 (from second load) = 17.</p>
<p>The 15 hits, are for bytes which were cached already. The high number is due to the byte-wise operation of the interface, so 15 bytes were already present in cache. Internally the pycachesim operates on cache-lines, which all addresses get transformed to. Thus, the two misses throughout all cache-levels are actually two complete cache-lines and after the cache-line had been loaded the consecutive access to the same cache-line are handled as hits.</p>
<p>So: hits and loads in L1 are byte-wise, just like stores throughout all cache-levels. Every other statistical information are based on cache-lines.</p>
</div>


</div></body></html>