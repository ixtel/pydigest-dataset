<html><body><div><div class="msg_body message-w-userpic"><p>Ура. Освоил недавно, зело нравится - новый хост настроить с нуля по образу и подобию можно на раз-два. Не нравится только наличие файла hosts который дублирует playbook и неудобство работы с разнородными хостами. Вот скажем, есть у меня три хоста, на каждом свой набор сервисов, наборы пересекаются, между ними есть зависимости, и это всё один проект:</p><ul><li>hosta: s1 s2 s3
</li><li>hostb: s2 s3 s4
</li><li>hostc: s1 s4 s5
</li></ul><p>Как мне лучше составить playbook?</p><p>Если по отдельному play для s1, s2, s3, s4, s5, то зависимости между сервисами не работают (т.е. если s1 зависит от s2, s2 притащится два раза - в play для s2 и в play для s1 как его зависимость), и параллельности тоже не будет (т.е. каждому хосту коннектимся 3 раза в данном случае).</p><p>Можно сделать один play и разруливать наличие сервисов переменными, но это попахивает костылями, будет много мусора в логах (skipped) и какие-то ещё проблемы, не помню.</p><p>А хочется, задать, грубо говоря, матрицу хост-сервисы, и чтобы она выполнилась максимально параллельно, с подключением к каждому хосту только один раз. И чтобы она была задана в одном месте, а не размазана по hosts и playbook.</p><p>И сразу, стоит ли вообще после ansible смотреть chef/puppet/cfengine/salt/что там ещё? Мне то что требует наличия агентов как-то даже трогать не хочется.</p></div></div></body></html>