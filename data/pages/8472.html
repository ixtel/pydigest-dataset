<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-unishark--" class="anchor" href="#unishark--" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>unishark <a href="https://travis-ci.org/twitter/unishark"><img src="https://camo.githubusercontent.com/dbf580ba102a03699d103e1054cef44998a9ec4c/68747470733a2f2f7472617669732d63692e6f72672f747769747465722f756e69736861726b2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/twitter/unishark.svg?branch=master"/></a> <a href="https://coveralls.io/r/twitter/unishark?branch=master"><img src="https://camo.githubusercontent.com/103b007affc780901f3679eaa7dedf3391099b1e/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f747769747465722f756e69736861726b2f62616467652e706e673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/twitter/unishark/badge.png?branch=master"/></a></h1>

<p>A python test framework extending unittest (unittest2), inspired by testng</p>



<p><a name="user-content-Overview"/></p>

<h2><a id="user-content-overview" class="anchor" href="#overview" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Overview</h2>

<p>The latest released version: <a href="https://pypi.python.org/pypi/unishark">https://pypi.python.org/pypi/unishark</a></p>

<p>unishark extends unittest (to be accurate, unittest2) in the following ways:</p>

<ul>
<li>Customizing test suites with dictionary config (or yaml/json like config).</li>
<li>Running the tests concurrently at different levels.</li>
<li>Generating polished test reports in HTML/XUnit formats.</li>
<li>Offering data-driven decorator to accelerate tests writing.</li>
</ul>

<p>For existing unittests, the first three features could be obtained immediately with a single config, without changing any test code.</p>

<p>Here is an example config in YAML format (you could also write it directly in a <code>dict()</code>):</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">suites:</span></span>
  <span class="pl-s"><span class="pl-ent">my_suite_name_1:</span></span>
    <span class="pl-s"><span class="pl-ent">package:</span> <span class="pl-s">my.package.name</span></span>
    <span class="pl-s"><span class="pl-ent">groups:</span></span>
      <span class="pl-s"><span class="pl-ent">my_group_1:</span></span>
        <span class="pl-s"><span class="pl-ent">granularity:</span> <span class="pl-s">module</span></span>
        <span class="pl-s"><span class="pl-ent">modules:</span> <span class="pl-s">[test_module1, test_module2]</span></span>
        <span class="pl-s"><span class="pl-ent">except_classes:</span> <span class="pl-s">[test_module2.MyTestClass3]</span></span>
        <span class="pl-s"><span class="pl-ent">except_methods:</span> <span class="pl-s">[test_module1.MyTestClass1.test_1]</span></span>
      <span class="pl-s"><span class="pl-ent">my_group_2:</span></span>
        <span class="pl-s"><span class="pl-ent">granularity:</span> <span class="pl-s">class</span></span>
        <span class="pl-s"><span class="pl-ent">disable:</span> <span class="pl-s">False</span></span>
        <span class="pl-s"><span class="pl-ent">classes:</span> <span class="pl-s">[test_module3.MyTestClass5]</span></span>
        <span class="pl-s"><span class="pl-ent">except_methods:</span> <span class="pl-s">[test_module3.MyTestClass5.test_11]</span></span>
    <span class="pl-s"><span class="pl-ent">concurrency:</span></span>
      <span class="pl-s"><span class="pl-ent">level:</span> <span class="pl-s">module</span></span>
      <span class="pl-c1"><span class="pl-ent">max_workers:</span> 2</span>
  <span class="pl-s"><span class="pl-ent">my_suite_name_2:</span></span>
    <span class="pl-s"><span class="pl-ent">package:</span> <span class="pl-s">my.package.name</span></span>
    <span class="pl-s"><span class="pl-ent">groups:</span></span>
      <span class="pl-s"><span class="pl-ent">my_group_1:</span></span>
        <span class="pl-s"><span class="pl-ent">granularity:</span> <span class="pl-s">method</span></span>
        <span class="pl-s"><span class="pl-ent">methods:</span> <span class="pl-s">[test_module3.MyTestClass6.test_13, test_module3.MyTestClass7.test_15]</span></span>
    <span class="pl-s"><span class="pl-ent">concurrency:</span></span>
      <span class="pl-s"><span class="pl-ent">level:</span> <span class="pl-s">class</span></span>
      <span class="pl-c1"><span class="pl-ent">max_workers:</span> 2</span>
  <span class="pl-s"><span class="pl-ent">my_suite_name_3:</span></span>
    <span class="pl-s"><span class="pl-ent">package:</span> <span class="pl-s">another.package.name</span></span>
    <span class="pl-s"><span class="pl-ent">groups:</span></span>
      <span class="pl-s"><span class="pl-ent">group_1:</span></span>
        <span class="pl-s"><span class="pl-ent">granularity:</span> <span class="pl-s">package</span></span>
        <span class="pl-s"><span class="pl-ent">pattern:</span> <span class="pl-s"><span class="pl-pds">'</span>(<span class="pl-cce">\w</span>+<span class="pl-cce">\.</span>){2}test<span class="pl-cce">\w</span>*<span class="pl-pds">'</span></span></span>
        <span class="pl-s"><span class="pl-ent">except_modules:</span> <span class="pl-s">[module1, module2]</span></span>
        <span class="pl-s"><span class="pl-ent">except_classes:</span> <span class="pl-s">[module3.Class1, module3.Class3]</span></span>
        <span class="pl-s"><span class="pl-ent">except_methods:</span> <span class="pl-s">[module3.Class2.test_1, module4.Class2.test_5]</span></span>
    <span class="pl-s"><span class="pl-ent">concurrency:</span></span>
      <span class="pl-s"><span class="pl-ent">level:</span> <span class="pl-s">method</span></span>
      <span class="pl-c1"><span class="pl-ent">max_workers:</span> 20</span>
<span class="pl-s"><span class="pl-ent">reporters:</span></span>
  <span class="pl-s"><span class="pl-ent">html:</span></span>
    <span class="pl-s"><span class="pl-ent">class:</span> <span class="pl-s">unishark.HtmlReporter</span></span>
    <span class="pl-s"><span class="pl-ent">kwargs:</span></span>
      <span class="pl-s"><span class="pl-ent">dest:</span> <span class="pl-s">logs</span></span>
      <span class="pl-s"><span class="pl-ent">overview_title:</span> <span class="pl-s"><span class="pl-pds">'</span>Example Report<span class="pl-pds">'</span></span></span>
      <span class="pl-s"><span class="pl-ent">overview_description:</span> <span class="pl-s"><span class="pl-pds">'</span>This is an example report<span class="pl-pds">'</span></span></span>
  <span class="pl-s"><span class="pl-ent">xunit:</span></span>
    <span class="pl-s"><span class="pl-ent">class:</span> <span class="pl-s">unishark.XUnitReporter</span></span>
    <span class="pl-s"><span class="pl-ent">kwargs:</span></span>
      <span class="pl-s"><span class="pl-ent">summary_title:</span> <span class="pl-s"><span class="pl-pds">'</span>Example Report<span class="pl-pds">'</span></span></span>

<span class="pl-s"><span class="pl-ent">test:</span></span>
  <span class="pl-s"><span class="pl-ent">suites:</span> <span class="pl-s">[my_suite_name_1, my_suite_name_2, my_suite_name_3]</span></span>
  <span class="pl-s"><span class="pl-ent">concurrency:</span></span>
    <span class="pl-s"><span class="pl-ent">type:</span> <span class="pl-s">processes</span></span>
    <span class="pl-c1"><span class="pl-ent">max_workers:</span> 3</span>
  <span class="pl-s"><span class="pl-ent">reporters:</span> <span class="pl-s">[html, xunit]</span></span>
  <span class="pl-s"><span class="pl-ent">name_pattern:</span> <span class="pl-s"><span class="pl-pds">'</span>^test<span class="pl-cce">\w</span>*<span class="pl-pds">'</span></span></span></pre></div>

<p>It configures 3 test suites with some of the test cases excluded, and running the defined set of tests concurrently, and generating both HTML and XUnit (default JUnit) format reports at the end of tests.</p>

<p><strong>NOTE: In 0.2.x versions, 'max_workers' was set directly under 'test', and 'max_workers' and 'concurrency_level' were set directly under '{suite name}'. See why 0.2.x are NOT recommended in <a href="#Concurrent_Tests">Concurrent Tests</a> NOTE.</strong></p>

<p>To run it, simply add the following code:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> unishark
<span class="pl-k">import</span> yaml

<span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    <span class="pl-k">with</span> <span class="pl-c1">open</span>(<span class="pl-s"><span class="pl-pds">'</span>your_yaml_config_file<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>r<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> f:
        dict_conf <span class="pl-k">=</span> yaml.load(f.read())  <span class="pl-c"># use a 3rd party yaml parser, e.g., PyYAML</span>
        program <span class="pl-k">=</span> unishark.DefaultTestProgram(dict_conf)
        unishark.main(program)</pre></div>

<p>And a HTML report is like:
<a href="https://camo.githubusercontent.com/6e82bba322044c49c11f5791229c467fcc5bf64e/68747470733a2f2f7261776769742e636f6d2f747769747465722f756e69736861726b2f6d61737465722f646f63732f756e69736861726b5f7265706f72745f6f766572766965772e706e67" target="_blank"><img src="https://camo.githubusercontent.com/6e82bba322044c49c11f5791229c467fcc5bf64e/68747470733a2f2f7261776769742e636f6d2f747769747465722f756e69736861726b2f6d61737465722f646f63732f756e69736861726b5f7265706f72745f6f766572766965772e706e67" alt="Screenshot 1" data-canonical-src="https://rawgit.com/twitter/unishark/master/docs/unishark_report_overview.png"/></a>
<a href="https://camo.githubusercontent.com/ca1768cd250c151ddb9ac6a4b31e6668f7bd1876/68747470733a2f2f7261776769742e636f6d2f747769747465722f756e69736861726b2f6d61737465722f646f63732f756e69736861726b5f7265706f72745f64657461696c2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/ca1768cd250c151ddb9ac6a4b31e6668f7bd1876/68747470733a2f2f7261776769742e636f6d2f747769747465722f756e69736861726b2f6d61737465722f646f63732f756e69736861726b5f7265706f72745f64657461696c2e706e67" alt="Screenshot 2" data-canonical-src="https://rawgit.com/twitter/unishark/master/docs/unishark_report_detail.png"/></a></p>

<p><a name="user-content-Prerequisites"/></p>

<h2><a id="user-content-prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Prerequisites</h2>

<p>Language:</p>

<ul>
<li>Python 2.7, 3.3, 3.4, 3.5</li>
<li>Jython 2.7</li>
</ul>

<p>3rd Party Dependencies:</p>

<ul>
<li>Jinja2&gt;=2.7.2</li>
<li>MarkupSafe&gt;=0.15</li>
<li>futures&gt;=2.1.1 (standard lib in Python3.x)</li>
</ul>

<p>OS:</p>



<p><a name="user-content-Installation"/></p>

<h2><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h2>

<p>pip install unishark</p>

<p><a name="user-content-The_Test_Config"/></p>

<h2><a id="user-content-the-test-config" class="anchor" href="#the-test-config" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>The Test Config</h2>

<p>Each config must have a <strong>test</strong> dict, which has the following keys:</p>

<ul>
<li><strong>test['suites']</strong>: Required. A list of suite names defined in <strong>suites</strong> dict. See <a href="#Customize_Test_Suites">Customize Test Suites</a>.</li>
<li><strong>test['reporters']</strong>: Optional. A list of reporter names defined in <strong>reporters</strong> dict. See <a href="#Test_Reports">Test Reports</a>.</li>
<li><strong>test['concurrency']</strong> (since 0.3.0): Optional. Default is {'max_workers': 1, 'type': 'threads', 'timeout': None}. See <a href="#Concurrent_Tests">Concurrent Tests</a>.</li>
<li><strong>test['concurrency']['max_workers']</strong>: Required if 'concurrency' is defined. The max number of workers allocated to run the test suites.</li>
<li><strong>test['concurrency']['type']</strong>: Optional. Run the suites included in test['suites'] concurrently with 'threads' or 'processes'. Default is 'threads' if not set.</li>
<li><strong>test['concurrency']['timeout']</strong>: Optional. The maximum number of seconds to wait before getting results. Can be an int or float. Default is None(no limit to the wait time). The wait only happens when max_workers &gt; 1.</li>
<li><strong>test['name_pattern']</strong>: Optional. A python regular expression to match the test method names. All the tests whose method name does not match the pattern will be filtered out. Default <strong>'^test\w*'</strong> if not set.</li>
</ul>

<p><a name="user-content-Customize_Test_Suites"/></p>

<h3><a id="user-content-customize-test-suites" class="anchor" href="#customize-test-suites" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Customize Test Suites</h3>

<p>This part describes <strong>suites</strong> dict in the test config, with the example in <a href="#Overview">Overview</a>:</p>

<ul>
<li>Name of a suite or a group could be anything you like.</li>
<li><strong>suites[{suite name}]['package']</strong>: Optional. A dotted path (relative to PYTHONPATH) indicating the python package where your test .py files locate. The tests in one suite have to be in the same package. To collect tests in another package, define another suite. However tests in one package can be divided into several suites.</li>
<li><strong>suites[{suite name}]['concurrency']</strong> (since 0.3.0): Optional. Default is {'max_workers': 1, 'level': 'class', 'timeout': None}. See <a href="#Concurrent_Tests">Concurrent Tests</a>.</li>
<li><strong>suites[{suite name}]['concurrency']['max_workers']</strong>: Required if 'concurrency' is defined. The max number of workers allocated to run the tests within a suite.</li>
<li><strong>suites[{suite name}]['concurrency']['level']</strong>: Optional. Can be 'module', 'class' or 'method' to run the modules, classes, or methods concurrently. Default is 'class'.</li>
<li><strong>suites[{suite name}]['concurrency']['timeout']</strong>: Optional. The maximum number of seconds to wait before getting the suite result. Can be an int or float. Default is None(no limit to the wait time). The wait only happens when max_workers &gt; 1.</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['granularity']</strong>: Required. Must be one of 'package', 'module', 'class' and 'method'. If granularity is 'package', then suites[{suite name}]['package'] must be given.</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['pattern']</strong>: Optional. Only takes effect when granularity is 'package'. A python regular expression to match tests long names like 'module.class.method' in the package. Default is <strong>'(\w+\.){2}test\w*'</strong> if not set.</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['modules']</strong>: Required if granularity is 'module'. A list of module names (test file names with .py trimmed).</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['classes']</strong>: Required if granularity is 'class'. A list of dotted class names conforming to 'module.class'.</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['methods']</strong>: Required if granularity is 'method'. A list of dotted method names conforming to 'module.class.method'.</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['except_modules']</strong>: Optional. Only takes effect when granularity is 'package'. A list of excluded module names.</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['except_classes']</strong>: Optional. Only takes effect when granularity is 'package' or 'module'. A list of excluded class names conforming to 'module.class'. </li>
<li><strong>suites[{suite name}]['groups'][{group name}]['except_methods']</strong>: Optional. Only takes effect when granularity is 'package', 'module' or 'class'. A list of excluded method names conforming to 'module.class.method'.</li>
<li><strong>suites[{suite name}]['groups'][{group name}]['disable']</strong>: Optional. Excludes the group of tests if the value is True. Default is False if not set.</li>
</ul>

<p>To include/exclude a suite, add/remove the suite name in/from the <strong>test['suites']</strong> list in the <strong>test</strong> dict:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">test:</span></span>
  <span class="pl-s"><span class="pl-ent">suites:</span> <span class="pl-s">[my_suite_1] </span></span><span class="pl-c"># will only run my_suite_1</span>
  ...</pre></div>

<p><a name="user-content-Test_Reports"/></p>

<h3><a id="user-content-test-reports" class="anchor" href="#test-reports" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Test Reports</h3>

<p>This part describes the <strong>reporters</strong> dict in the test config, with the example in <a href="#Overview">Overview</a>:</p>

<ul>
<li><strong>reporters['class']</strong>: Required if a reporter is defined. A dotted reporter class name.</li>
<li><strong>reporters['kwargs']</strong>: Optional. The arguments for initiating the reporter instance.</li>
</ul>

<p>The arguments of the built-in HtmlReporter and their default values are:</p>

<ul>
<li>dest='results'</li>
<li>overview_title='Reports'</li>
<li>overview_description=''</li>
<li>templates_path=None</li>
<li>report_template=None</li>
<li>overview_template=None</li>
<li>index_template=None</li>
</ul>

<p>The arguments of the built-in XUnitReporter and their default values are:</p>

<ul>
<li>dest='results'</li>
<li>summary_title='XUnit Reports'</li>
<li>templates_path=None</li>
<li>report_template=None</li>
<li>summary_template=None</li>
</ul>

<p>Configuring <strong>multiple reporters</strong> which generate different formats of reports is allowed, and only a single run of the tests is needed to generate all different formats.</p>

<p>To include/exclude a reporter, add/remove the reporter name in/from the <strong>test['reporters']</strong> list in the <strong>test</strong> dict:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">test:</span></span>
  <span class="pl-s"><span class="pl-ent">reporters:</span> <span class="pl-s">[html] </span></span><span class="pl-c"># will only generate html format reports</span>
  ...</pre></div>

<p>If the list is empty, no report files will be generated.</p>

<p>unishark can buffer logging stream during the running of a test case, and writes all buffered output to report files at the end of tests. To let unishark capture the logging stream and write logs into reports, simply redirect the logging stream to <code>unishark.out</code>, e.g.,</p>

<div class="highlight highlight-source-python"><pre>formatter <span class="pl-k">=</span> logging.Formatter(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-c1">%(levelname)s</span>: <span class="pl-c1">%(message)s</span><span class="pl-pds">'</span></span>)
handler <span class="pl-k">=</span> logging.StreamHandler(<span class="pl-v">stream</span><span class="pl-k">=</span>unishark.out)
handler.setLevel(logging.<span class="pl-c1">INFO</span>)
handler.setFormatter(formatter)
logger <span class="pl-k">=</span> logging.getLogger(<span class="pl-s"><span class="pl-pds">'</span>example<span class="pl-pds">'</span></span>)
logger.addHandler(handler)
logger.setLevel(logging.<span class="pl-c1">INFO</span>)</pre></div>

<p>or in YAML format,</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">formatters:</span></span>
  <span class="pl-s"><span class="pl-ent">simple:</span></span>
    <span class="pl-s"><span class="pl-ent">format:</span> <span class="pl-s"><span class="pl-pds">'</span>%(levelname)s: %(message)s<span class="pl-pds">'</span></span></span>

<span class="pl-s"><span class="pl-ent">handlers:</span></span>
  <span class="pl-s"><span class="pl-ent">myhandler:</span></span>
    <span class="pl-s"><span class="pl-ent">class:</span> <span class="pl-s">logging.StreamHandler</span></span>
    <span class="pl-s"><span class="pl-ent">formatter:</span> <span class="pl-s">simple</span></span>
    <span class="pl-s"><span class="pl-ent">stream:</span> <span class="pl-s">ext://unishark.out</span></span>

<span class="pl-s"><span class="pl-ent">loggers:</span></span>
  <span class="pl-s"><span class="pl-ent">example:</span></span>
    <span class="pl-s"><span class="pl-ent">level:</span> <span class="pl-s">DEBUG</span></span>
    <span class="pl-s"><span class="pl-ent">handlers:</span> <span class="pl-s">[myhandler]</span></span>
    <span class="pl-s"><span class="pl-ent">propagate:</span> <span class="pl-s">False</span></span></pre></div>

<p><strong>NOTE</strong>: </p>

<ul>
<li>unishark does NOT buffer stdout and stderr. So if you use <code>print('some message')</code> in a test case, the message will be output to stdout during the test running.</li>
<li>Suite names are reflected in the reports while groups are not. Test cases are grouped by class then module in the reports. <strong>groups</strong> config is simply for conveniently including/excluding a group of test cases by enabling/disabling the group.</li>
</ul>

<p>To output unishark's own logs to stdout:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">handlers:</span></span>
  <span class="pl-s"><span class="pl-ent">console:</span></span>
    <span class="pl-s"><span class="pl-ent">class:</span> <span class="pl-s">logging.StreamHandler</span></span>
    <span class="pl-s"><span class="pl-ent">formatter:</span> <span class="pl-s">simple</span></span>
    <span class="pl-s"><span class="pl-ent">stream:</span> <span class="pl-s">ext://sys.stdout</span></span>

<span class="pl-s"><span class="pl-ent">loggers:</span></span>
  <span class="pl-s"><span class="pl-ent">unishark:</span></span>
    <span class="pl-s"><span class="pl-ent">level:</span> <span class="pl-s">INFO</span></span>
    <span class="pl-s"><span class="pl-ent">handlers:</span> <span class="pl-s">[console]</span></span>
    <span class="pl-s"><span class="pl-ent">propagate:</span> <span class="pl-s">False</span></span></pre></div>

<p><a name="user-content-Concurrent_Tests"/></p>

<h3><a id="user-content-concurrent-tests" class="anchor" href="#concurrent-tests" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Concurrent Tests</h3>

<p>Concurrency in unishark can be:  </p>

<ul>
<li>concurrent execution of multiple suites (<strong>with processes or threads</strong>) .</li>
<li>concurrent execution within a suite (<strong>only with threads</strong>) :

<ul>
<li>at module level.</li>
<li>at class level.</li>
<li>at method level.</li>
</ul></li>
</ul>

<p>To enable concurrent execution of multiple suites, set 'concurrency' sub-dict (since 0.3.0) in the 'test' dict:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">test:</span></span>
  ...
  <span class="pl-s"><span class="pl-ent">concurrency:</span></span>
    <span class="pl-s"><span class="pl-ent">type:</span> <span class="pl-s">processes  </span></span><span class="pl-c"># or threads</span>
    <span class="pl-c1"><span class="pl-ent">max_workers:</span> 4  </span><span class="pl-c"># number of threads or processes depending on the type</span></pre></div>

<p>To enable concurrent execution within a suite, set 'concurrency' sub-dict (since 0.3.0) in the '{suite name}' dict:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">suites:</span></span>
  <span class="pl-s"><span class="pl-ent">my_suite_name_1:</span></span>
    <span class="pl-s"><span class="pl-ent">concurrency:</span></span>
      <span class="pl-c1"><span class="pl-ent">max_workers:</span> 6  </span><span class="pl-c"># no choices of concurrency type, just threads</span>
      <span class="pl-s"><span class="pl-ent">level:</span> <span class="pl-s">method  </span></span><span class="pl-c"># or class or module</span>
    ...</pre></div>

<p><strong>NOTE</strong>:</p>

<ul>
<li><strong>Since 0.3.2</strong>, both threading and multiprocessing concurrency are supported. In CPython, threading can benefit IO bound tests while cannot benefit CPU bound tests due to GIL, whereas multiprocessing can bypass GIL and benefit CPU bound tests.</li>
<li>Versions &lt; 0.3.2 only support threading concurrency.</li>
<li>Versions 0.2.x are NOT recommended because:

<ul>
<li>Versions &gt;= 0.3.0 adopt a new concurrent execution model internally. Test fixtures setUpModule/tearDownModule setUpClass/tearDownClass will be executed once and only once in a suite no matter what concurrency level(module/class/method) of the suite is.</li>
<li>In 0.2.x versions, 'max_workers' was set directly under 'test', and 'max_workers' and 'concurrency_level' were set directly under '{suite name}'.</li>
<li>In 0.2.x versions, on the condition of thread-safety, the recommended concurrency level is: If there is setUpModule/tearDownModule in a module, set 'concurrency_level' to 'module', otherwise setUpModule/tearDownModule may run multiple times for the module; If there is setUpClass/tearDownClass in a class, set 'concurrency_level' to 'class' or 'module', otherwise setUpClass/tearDownClass may run multiple times for the class; If there are only setUp/tearDown, 'concurrency_level' can be set to any level.</li>
</ul></li>
<li>If max_workers &lt;= 1, it is just sequential running.</li>
<li><strong>Users are responsible for reasoning the thread-safety</strong> before enabling concurrent execution. For example, when concurrency level is 'method', race conditions will occur if any method including setUp/tearDown tries to modify a class-scope shared resource. In this case, user should set concurrency level to 'class' or 'module'.</li>
<li>To optimize the running speed:

<ul>
<li>If your tests are <strong>IO bound</strong> (read/write, send/receive): gradually increase suites[{suite name}]['concurrency']['max_workers'] and test['concurrency']['max_workers'] until the total time taken is the least. It has NO better effect to set test['concurrency']['max_workers'] &gt; # of suites or suites[{suite name}]['concurrency']['max_workers'] &gt; # of modules/classes/methods when concurrency level is module/class/method.</li>
<li>If your tests are <strong>CPU bound</strong>: for CPython, define multiple suites and run them with up to # of cores processes, and do not configure threading within a suite (threading might even make CPU bound program slower due to GIL). For Jython, your tests should still be able to benefit from threading since threads are mapped to Java threads. Jython does not have GIL thus does not support multiprocessing to bypass GIL anyway.</li>
</ul></li>
</ul>

<p><a name="user-content-Data_Driven"/></p>

<h2><a id="user-content-data-driven" class="anchor" href="#data-driven" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Data Driven</h2>

<p>Here are some effects of using <code>@unishark.data_driven</code>.<br/>
'Json' style data-driven. This style is good for loading the data in json format to drive the test case: </p>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@unishark.data_driven</span>(<span class="pl-k">*</span>[{<span class="pl-s"><span class="pl-pds">'</span>userid<span class="pl-pds">'</span></span>: <span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>passwd<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>}, {<span class="pl-s"><span class="pl-pds">'</span>userid<span class="pl-pds">'</span></span>: <span class="pl-c1">2</span>, <span class="pl-s"><span class="pl-pds">'</span>passwd<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>def<span class="pl-pds">'</span></span>}])
<span class="pl-k">def</span> <span class="pl-en">test_data_driven</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-k">**</span><span class="pl-smi">param</span>):
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>userid: <span class="pl-c1">%d</span>, passwd: <span class="pl-c1">%s</span><span class="pl-pds">'</span></span> <span class="pl-k">%</span> (param[<span class="pl-s"><span class="pl-pds">'</span>userid<span class="pl-pds">'</span></span>], param[<span class="pl-s"><span class="pl-pds">'</span>passwd<span class="pl-pds">'</span></span>]))</pre></div>

<p>Results:</p>

<pre><code>userid: 1, passwd: abc
userid: 2, passwd: def
</code></pre>

<p>'Args' style data-driven:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@unishark.data_driven</span>(<span class="pl-v">userid</span><span class="pl-k">=</span>[<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>], <span class="pl-v">passwd</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])
<span class="pl-k">def</span> <span class="pl-en">test_data_driven</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-k">**</span><span class="pl-smi">param</span>):
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>userid: <span class="pl-c1">%d</span>, passwd: <span class="pl-c1">%s</span><span class="pl-pds">'</span></span> <span class="pl-k">%</span> (param[<span class="pl-s"><span class="pl-pds">'</span>userid<span class="pl-pds">'</span></span>], param[<span class="pl-s"><span class="pl-pds">'</span>passwd<span class="pl-pds">'</span></span>]))</pre></div>

<p>Results:</p>

<pre><code>userid: 1, passwd: a
userid: 2, passwd: b
userid: 3, passwd: c
userid: 4, passwd: d
</code></pre>

<p>Cross-multiply data-driven:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@unishark.data_driven</span>(<span class="pl-v">left</span><span class="pl-k">=</span><span class="pl-c1">list</span>(<span class="pl-c1">range</span>(<span class="pl-c1">10</span>)))
<span class="pl-en">@unishark.data_driven</span>(<span class="pl-v">right</span><span class="pl-k">=</span><span class="pl-c1">list</span>(<span class="pl-c1">range</span>(<span class="pl-c1">10</span>)))
<span class="pl-k">def</span> <span class="pl-en">test_data_driven</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-k">**</span><span class="pl-smi">param</span>):
    l <span class="pl-k">=</span> param[<span class="pl-s"><span class="pl-pds">'</span>left<span class="pl-pds">'</span></span>]
    r <span class="pl-k">=</span> param[<span class="pl-s"><span class="pl-pds">'</span>right<span class="pl-pds">'</span></span>]
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-c1">%d</span> x <span class="pl-c1">%d</span> = <span class="pl-c1">%d</span><span class="pl-pds">'</span></span> <span class="pl-k">%</span> (l, r, l <span class="pl-k">*</span> r))</pre></div>

<p>Results:</p>

<pre><code>0 x 1 = 0
0 x 2 = 0
...
1 x 0 = 0
1 x 1 = 1
1 x 2 = 2
...
...
9 x 8 = 72
9 x 9 = 81
</code></pre>

<p>You can get the permutations (with repetition) of the parameters values by doing:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@unishark.data_driven</span>(<span class="pl-c1">...</span>)
<span class="pl-en">@unishark.data_driven</span>(<span class="pl-c1">...</span>)
<span class="pl-en">@unishark.data_driven</span>(<span class="pl-c1">...</span>)
<span class="pl-c1">...</span></pre></div>

<p>Multi-threads data-driven in 'json style':</p>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@unishark.multi_threading_data_driven</span>(<span class="pl-c1">2</span>, <span class="pl-k">*</span>[{<span class="pl-s"><span class="pl-pds">'</span>userid<span class="pl-pds">'</span></span>: <span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>passwd<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>}, {<span class="pl-s"><span class="pl-pds">'</span>userid<span class="pl-pds">'</span></span>: <span class="pl-c1">2</span>, <span class="pl-s"><span class="pl-pds">'</span>passwd<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>def<span class="pl-pds">'</span></span>}])
<span class="pl-k">def</span> <span class="pl-en">test_data_driven</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-k">**</span><span class="pl-smi">param</span>):
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>userid: <span class="pl-c1">%d</span>, passwd: <span class="pl-c1">%s</span><span class="pl-pds">'</span></span> <span class="pl-k">%</span> (param[<span class="pl-s"><span class="pl-pds">'</span>userid<span class="pl-pds">'</span></span>], param[<span class="pl-s"><span class="pl-pds">'</span>passwd<span class="pl-pds">'</span></span>]))</pre></div>

<p>Results: same results as using <code>unishark.data_driven</code>, but up to 2 threads are spawned, each running the test with a set of inputs (userid, passwd).</p>

<p>Multi-threads data-driven in 'args style':</p>

<div class="highlight highlight-source-python"><pre><span class="pl-en">@unishark.multi_threading_data_driven</span>(<span class="pl-c1">5</span>, <span class="pl-v">time</span><span class="pl-k">=</span>[<span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>])
<span class="pl-k">def</span> <span class="pl-en">test_data_driven</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-k">**</span><span class="pl-smi">param</span>):
    sleep(param[<span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span>])</pre></div>

<p>Results: 5 threads are spawned to run the test with 10 sets of inputs concurrently (only sleep 1 sec in each thread).
It takes about 2 sec in total (10 sec if using <code>unishark.data_driven</code>) to run.</p>

<p><strong>NOTE</strong>: It is user's responsibility to ensure thread-safe within the test method which is decorated by <code>unishark.multi_threading_data_driven</code>.
If exceptions are thrown in one or more threads, the exceptions information will be collected and summarized in the "main" thread and thrown as <code>unishark.exception.MultipleErrors</code>.</p>

<p><a name="user-content-Useful_API"/></p>

<h2><a id="user-content-useful-api" class="anchor" href="#useful-api" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Useful API</h2>

<p><a name="user-content-DefaultTestLoader"/></p>

<h3><a id="user-content-defaulttestloader" class="anchor" href="#defaulttestloader" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>DefaultTestLoader</h3>

<ul>
<li><strong>load_tests_from_dict(dict_conf)</strong>: Loads tests from a dictionary config described in <a href="#The_Test_Config">The Test Config</a>. Returns a suites dictionary with suite names as keys.</li>
<li><strong>load_tests_from_package(pkg_name, regex=None)</strong>: Returns a unittest.TestSuite instance containing the tests whose dotted long name 'module.class.method' matches the given regular expression and short method name matches DefaultTestLoader.name_pattern. A dotted package name must be provided. regex is default to '(\w+\.){2}test\w*'.</li>
<li><strong>load_tests_from_modules(mod_names, regex=None)</strong>: Returns a unittest.TestSuite instance containing the tests whose dotted name 'class.method' matches the given regular expression and short method name matches DefaultTestLoader.name_pattern. A list of dotted module names must be provided. regex is default to '\w+\.test\w*'.</li>
</ul>

<p><a name="user-content-Advanced_Usage"/></p>

<h2><a id="user-content-advanced-usage" class="anchor" href="#advanced-usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Advanced Usage</h2>

<p>unishark is totally compatible with unittest because it extends unittest. Here are some examples of mixed use of the two:</p>

<p>Run unittest suite with <code>unishark.BufferedTestRunner</code>: </p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    reporter <span class="pl-k">=</span> unishark.HtmlReporter(<span class="pl-v">dest</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>log<span class="pl-pds">'</span></span>)
    unittest.main(<span class="pl-v">testRunner</span><span class="pl-k">=</span>unishark.BufferedTestRunner(<span class="pl-v">reporters</span><span class="pl-k">=</span>[reporter]))</pre></div>

<div class="highlight highlight-source-python"><pre><span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    <span class="pl-k">import</span> sys
    suite <span class="pl-k">=</span> unittest.TestLoader().loadTestsFromModule(sys.modules[<span class="pl-c1">__name__</span>])
    reporter <span class="pl-k">=</span> unishark.HtmlReporter(<span class="pl-v">dest</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>log<span class="pl-pds">'</span></span>)
    <span class="pl-c"># Run methods concurrently with 10 workers and generate 'mytest2_result.html'</span>
    result <span class="pl-k">=</span> unishark.BufferedTestRunner(<span class="pl-v">reporters</span><span class="pl-k">=</span>[reporter]).run(suite, <span class="pl-v">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>mytest2<span class="pl-pds">'</span></span>, <span class="pl-v">max_workers</span><span class="pl-k">=</span><span class="pl-c1">10</span>, <span class="pl-v">concurrency_level</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>method<span class="pl-pds">'</span></span>)
    sys.exit(<span class="pl-c1">0</span> <span class="pl-k">if</span> result.wasSuccessful() <span class="pl-k">else</span> <span class="pl-c1">1</span>)</pre></div>

<div class="highlight highlight-source-python"><pre><span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    <span class="pl-k">import</span> sys
    suite <span class="pl-k">=</span> unittest.TestLoader().loadTestsFromModule(sys.modules[<span class="pl-c1">__name__</span>])
    <span class="pl-c"># Run classes concurrently with 2 workers</span>
    result <span class="pl-k">=</span> unishark.BufferedTestRunner().run(suite, <span class="pl-v">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>mytest3<span class="pl-pds">'</span></span>, <span class="pl-v">max_workers</span><span class="pl-k">=</span><span class="pl-c1">2</span>)
    <span class="pl-c"># Generating reports can be delayed</span>
    reporter <span class="pl-k">=</span> unishark.HtmlReporter(<span class="pl-v">dest</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>log<span class="pl-pds">'</span></span>)
    reporter.report(result)
    <span class="pl-c"># Also generate overview and index pages</span>
    reporter.collect()</pre></div>

<p>Load test suites with <code>unishark.DefaultTestLoader</code> and run them with <code>unittest.TextTestRunner</code>:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    dict_conf <span class="pl-k">=</span> <span class="pl-c1">None</span>
    <span class="pl-k">with</span> <span class="pl-c1">open</span>(<span class="pl-s"><span class="pl-pds">'</span>your_yaml_config_file<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>r<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> f:
        dict_conf <span class="pl-k">=</span> yaml.load(f.read())  <span class="pl-c"># use a 3rd party yaml parser, e.g., PyYAML</span>
    suites <span class="pl-k">=</span> unishark.DefaultTestLoader(<span class="pl-v">name_pattern</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>^test\w*<span class="pl-pds">'</span></span>).load_tests_from_dict(dict_conf)
    <span class="pl-k">for</span> suite_name, suite_content <span class="pl-k">in</span> suites.items():
        package_name <span class="pl-k">=</span> suite_content[<span class="pl-s"><span class="pl-pds">'</span>package<span class="pl-pds">'</span></span>]
        suite <span class="pl-k">=</span> suite_content[<span class="pl-s"><span class="pl-pds">'</span>suite<span class="pl-pds">'</span></span>]
        concurrency <span class="pl-k">=</span> suite_content[<span class="pl-s"><span class="pl-pds">'</span>concurrency<span class="pl-pds">'</span></span>]
        unittest.TextTestRunner().run(suite)</pre></div>

<p><a name="user-content-More_Examples"/></p>

<h2><a id="user-content-more-examples" class="anchor" href="#more-examples" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>More Examples</h2>

<p>For more examples, please see 'example/' in the project directory. To run the examples, please read 'example/read_me.txt' first.</p>

<p><a name="user-content-User_Extension"/></p>

<h2><a id="user-content-user-extension" class="anchor" href="#user-extension" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>User Extension</h2>

<p><a name="user-content-Customized_Reports"/></p>

<h3><a id="user-content-customized-reports" class="anchor" href="#customized-reports" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Customized Reports</h3>

<p>If you prefer a different style of HTML or XUnit reports, passing different template files to the <code>unishark.HtmlReporter</code> or <code>unishark.XUnitReporter</code> constructor is the easiest way:</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">reporters:</span></span>
  <span class="pl-s"><span class="pl-ent">html:</span></span>
    <span class="pl-s"><span class="pl-ent">class:</span> <span class="pl-s">unishark.HtmlReporter</span></span>
    <span class="pl-s"><span class="pl-ent">kwargs:</span></span>
      <span class="pl-s"><span class="pl-ent">dest:</span> <span class="pl-s">logs</span></span>
      <span class="pl-s"><span class="pl-ent">overview_title:</span> <span class="pl-s"><span class="pl-pds">'</span>Example Report<span class="pl-pds">'</span></span></span>
      <span class="pl-s"><span class="pl-ent">overview_description:</span> <span class="pl-s"><span class="pl-pds">'</span>This is an example report<span class="pl-pds">'</span></span></span>
      <span class="pl-s"><span class="pl-ent">templates_path:</span> <span class="pl-s">mytemplates</span></span>
      <span class="pl-s"><span class="pl-ent">report_template:</span> <span class="pl-s">myreport.html</span></span>
      <span class="pl-s"><span class="pl-ent">overview_template:</span> <span class="pl-s">myoverview.html</span></span>
      <span class="pl-s"><span class="pl-ent">index_template:</span> <span class="pl-s">myindex.html</span></span>
  <span class="pl-s"><span class="pl-ent">xunit:</span></span>
    <span class="pl-s"><span class="pl-ent">class:</span> <span class="pl-s">unishark.XUnitReporter</span></span>
    <span class="pl-s"><span class="pl-ent">kwargs:</span></span>
      <span class="pl-s"><span class="pl-ent">summary_title:</span> <span class="pl-s"><span class="pl-pds">'</span>Example Report<span class="pl-pds">'</span></span></span>
      <span class="pl-s"><span class="pl-ent">templates_path:</span> <span class="pl-s">xmltemplates</span></span>
      <span class="pl-s"><span class="pl-ent">report_template:</span> <span class="pl-s">xunit_report.xml</span></span>
      <span class="pl-s"><span class="pl-ent">summary_template:</span> <span class="pl-s">xunit_summary.xml</span></span></pre></div>

<p><strong>NOTE</strong>:</p>

<ul>
<li>The customized templates must also be <a href="http://jinja.pocoo.org/docs/dev/templates">Jinja2</a> templates</li>
<li>Once you decide to use your own templates, you have to specify all of the 'teamplates_path' and '*_template' arguments. If one of them is None or empty, the reporters will still use the default templates carried with unishark.</li>
</ul>

<p>If the above customization cannot satisfy you, you could write your own reporter class extending <code>unishark.Reporter</code> abstract class. Either passing the reporter instance to <code>unishark.BufferedTestRunner</code> or configuring the initializer in the test config will make unishark run your reporter.</p>

<p><a name="user-content-Implement_TestProgram"/></p>

<h3><a id="user-content-implement-testprogram" class="anchor" href="#implement-testprogram" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Implement TestProgram</h3>

<p>You could also write your own test program class extending <code>unishark.TestProgram</code> abstract class. Implement <code>run()</code> method, making sure it returns an integer exit code, and call <code>unishark.main(your_program)</code> to run it.</p>
</article>
  </div></body></html>