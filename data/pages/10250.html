<html><body><div><div class="section-inner layoutSingleColumn"><h3 name="7d16" id="7d16" class="graf--h3 graf-after--figure">Finding a needle in a haystack</h3><p name="fe7f" id="fe7f" class="graf--p graf-after--h3">Secrets don’t belong in source code. At Lyft we use a secret management system (<a href="https://eng.lyft.com/announcing-confidant-an-open-source-secret-management-service-from-lyft-1e256fe628a3#.23uvftebc" data-href="https://eng.lyft.com/announcing-confidant-an-open-source-secret-management-service-from-lyft-1e256fe628a3#.23uvftebc" class="markup--anchor markup--p-anchor">Confidant</a>) to ensure our repositories are free of secrets, so we also want to ensure no one accidentally adds secrets into repositories. Manually auditing for this is laborious, so we wanted to add automated tests that fail if secrets are introduced in pull requests.</p><p name="8dda" id="8dda" class="graf--p graf-after--p">OpenStack recently released Bandit, a static analyzer that traverses abstract syntax trees (<a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" data-href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" class="markup--anchor markup--p-anchor">ASTs</a>) of Python code. Bandit looked like a solid base for building an automated Python analysis tool, and its architecture supports plugins, so we created a Bandit plugin for identifying secrets in source code.</p><p name="1ad4" id="1ad4" class="graf--p graf-after--p">Our plugin, <a href="https://github.com/lyft/bandit-high-entropy-string" data-href="https://github.com/lyft/bandit-high-entropy-string" class="markup--anchor markup--p-anchor">bandit-high-entropy-string</a>, captures strings from the AST and attempts to detect if the strings are secrets. The problem with most secrets is that they’re randomly generated (have high entropy), which means unlike other strings, for instance dangerous SQL statements, secrets are difficult to find in an automated way. The high entropy itself is something that we can use as a marker, though.</p><p name="8972" id="8972" class="graf--p graf-after--p">As an example, let’s look at the following code:</p><figure name="0ddb" id="0ddb" class="graf--figure graf--iframe graf-after--p"><p class="iframeContainer"/></figure><p name="18f1" id="18f1" class="graf--p graf-after--figure">In the above, when the AST is parsed, the plugin captures assignments, function definitions, function calls, comparisons, dicts, lists, etc. When it captures these, it takes a look at the surrounding context to bump the confidence level up or down.</p><p name="8516" id="8516" class="graf--p graf-after--p">If a string is being assigned to a variable that looks like it would store a secret, it has higher confidence. If it’s being assigned to a variable that looks safe or is inside of a function call that looks safe, it has lower confidence. We also lower the confidence on strings that look like common patterns in Python. For instance, strings referencing files on a filesystem, or URLs, or Flask routes.</p><p name="95ed" id="95ed" class="graf--p graf-after--p">We first assess the confidence of a string based on its context and then we use Dropbox’s <a href="https://github.com/dropbox/zxcvbn" data-href="https://github.com/dropbox/zxcvbn" class="markup--anchor markup--p-anchor">zxcvbn</a> library to determine the entropy of each string. If the string’s total entropy is high we increase the confidence, if the entropy per character (total entropy / string length) is high we increase the confidence some more.</p><p name="b650" id="b650" class="graf--p graf-after--p">Right now the plugin has relatively low noise and good signal when Bandit is run to filter all but high confidence issues (-iii). It’s not perfect by any means, though, so please give it a try, and open issues and send in pull requests for improvements!</p><p name="6b79" id="6b79" class="graf--p graf-after--p">Thanks to the OpenStack security team for giving us help and feedback on the plugin and, of course, for writing Bandit. Thanks also to the Dropbox product security team for feedback on docs and signal/noise issues.</p><blockquote name="1578" id="1578" class="graf--blockquote graf-after--p">Interested in open source work and having a big impact? <a href="https://www.lyft.com/jobs#job-openings" data-href="https://www.lyft.com/jobs#job-openings" class="markup--anchor markup--blockquote-anchor">Lyft is hiring</a>! Drop me a note on <a href="https://twitter.com/squiddlane" data-href="https://twitter.com/squiddlane" class="markup--anchor markup--blockquote-anchor">Twitter</a> or at <a href="mailto:ryan.lane@lyft.com" data-href="mailto:ryan.lane@lyft.com" class="markup--anchor markup--blockquote-anchor" rel="nofollow">ryan.lane@lyft.com</a>.</blockquote><p name="a8e2" id="a8e2" class="graf--p graf-after--blockquote graf--last"><strong class="markup--strong markup--p-strong">N E X T</strong> → <a href="https://eng.lyft.com/announcing-confidant-an-open-source-secret-management-service-from-lyft-1e256fe628a3" data-href="https://eng.lyft.com/announcing-confidant-an-open-source-secret-management-service-from-lyft-1e256fe628a3" class="markup--anchor markup--p-anchor">Announcing Confidant, an open source secret management service from Lyft</a></p></div></div></body></html>