<html><body><div><div class="text-content">

								
								


<h1>Introduction</h1>
<p>Time Series (referred as TS from now) is considered to be one of the less known skills in the analytics space (Even I had little clue about it a couple of days back). But as you know our inaugural <strong><a href="http://datahack.analyticsvidhya.com/contest/mini-datahack" target="_blank">Mini Hackathon</a></strong> is based on it, I set myself on a journey to learn the basic steps for solving a Time Series problem and here I am sharing the same with you. These will definitely help you get a decent model in our hackathon today.</p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/guide.jpg" rel="attachment wp-att-23218"><img class="alignnone size-full wp-image-23218" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/guide.jpg?resize=500%2C280" alt="Complete guide to create time series forecasting with Python" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/guide.jpg?resize=300%2C168 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/guide.jpg?resize=257%2C144 257w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/guide.jpg?w=500 500w" sizes="(max-width: 500px) 100vw, 500px" data-recalc-dims="1"/></a></p>
<p>Before going through this article, I highly recommend reading <a href="http://www.analyticsvidhya.com/blog/2015/12/complete-tutorial-time-series-modeling/" target="_blank">A Complete Tutorial on Time Series Modeling in R</a>, which is like a prequel to this article. It focuses on fundamental concepts and is based on R and I will focus on using these concepts in solving a problem end-to-end along with codes in Python. Many resources exist for TS in R but very few are there for Python so I’ll be using Python in this article.</p>
<p>Out journey would go through the following steps:</p>
<ol>
<li>What makes Time Series Special?</li>
<li>Loading and Handling Time Series in Pandas</li>
<li>How to Check Stationarity of a Time Series?</li>
<li>How to make a Time Series Stationary?</li>
<li>Forecasting a Time Series</li>
</ol>
<p> </p>
<h1>1. What makes Time Series Special?</h1>
<p>As the name suggests, TS is a collection of data points collected at <strong>constant time intervals</strong>. These are analyzed to determine the long term trend so as to forecast the future or perform some other form of analysis. But what makes a TS different from say a regular regression problem? There are 2 things:</p>
<ol>
<li>It is <strong>time dependent</strong>. So the basic assumption of a linear regression model that the observations are independent doesn’t hold in this case.</li>
<li>Along with an increasing or decreasing trend, most TS have some form of <strong>seasonality trends</strong>, i.e. variations specific to a particular time frame. For example, if you see the sales of a woolen jacket over time, you will invariably find higher sales in winter seasons.</li>
</ol>
<p>Because of the inherent properties of a TS, there are various steps involved in analyzing it. These are discussed in detail below. Lets start by loading a TS object in Python. We’ll be using the popular AirPassengers data set which can be downloaded <a href="http://www.analyticsvidhya.com/wp-content/uploads/2016/02/AirPassengers.csv">here</a>.</p>
<p>Please note that the aim of this article is to familiarize you with the various techniques used for TS in general. The example considered here is just for illustration and I will focus on coverage a breadth of topics and not making a very accurate forecast.</p>
<p> </p>
<h1>2. Loading and Handling Time Series in Pandas</h1>
<p>Pandas has dedicated libraries for handling TS objects, particularly the <strong>datatime64[ns]</strong> class which stores time information and allows us to perform some operations really fast. Lets start by firing up the required libraries:</p>
<pre>import pandas as pd
import numpy as np
import matplotlib.pylab as plt
%matplotlib inline
from matplotlib.pylab import rcParams
rcParams['figure.figsize'] = 15, 6</pre>
<p>Now, we can load the data set and look at some initial rows and data types of the columns:</p>
<pre>data = pd.read_csv('AirPassengers.csv')
print data.head()
print '\n Data Types:'
print data.dtypes</pre>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dataload-1.png" rel="attachment wp-att-23169"><img class="aligncenter wp-image-23169 size-medium" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dataload-1.png?resize=300%2C287" alt="1. dataload 1" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dataload-1.png?resize=300%2C287 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dataload-1.png?w=422 422w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>The data contains a particular month and number of passengers travelling in that month. But this is still not read as a TS object as the data types are ‘object’ and ‘int’. In order to read the data as a time series, we have to pass special arguments to the read_csv command:</p>
<pre>dateparse = lambda dates: pd.datetime.strptime(dates, '%Y-%m')
data = pd.read_csv('AirPassengers.csv', parse_dates='Month', index_col='Month',date_parser=dateparse)
print data.head()</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dataload-2.png" rel="attachment wp-att-23170"><img class="size-medium wp-image-23170 aligncenter" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dataload-2.png?resize=300%2C173" alt="2. dataload 2" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dataload-2.png?resize=300%2C173 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dataload-2.png?w=438 438w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>Let’s understand the arguments one by one:</p>
<ol>
<li><strong>parse_dates</strong>: This specifies the column which contains the date-time information. As we say above, the column name is ‘Month’.</li>
<li><strong>index_col:</strong> A key idea behind using Pandas for TS data is that the index has to be the variable depicting date-time information. So this argument tells pandas to use the ‘Month’ column as index.</li>
<li><strong>date_parser:</strong> This specifies a function which converts an input string into datetime variable. Be default Pandas reads data in format ‘YYYY-MM-DD HH:MM:SS’. If the data is not in this format, the format has to be manually defined. Something similar to the dataparse function defined here can be used for this purpose.</li>
</ol>
<p>Now we can see that the data has time object as index and #Passengers as the column. We can cross-check the datatype of the index with the following command:</p>
<pre>data.index</pre>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-index-type.png" rel="attachment wp-att-23171"><img class="wp-image-23171 size-large aligncenter" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-index-type.png?resize=1024%2C225" alt="3. index type" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-index-type.png?resize=300%2C66 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-index-type.png?resize=768%2C169 768w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-index-type.png?resize=1024%2C225 1024w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-index-type.png?resize=850%2C187 850w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-index-type.png?w=1328 1328w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>Notice the <strong>dtype=’datetime[ns]’</strong> which confirms that it is a datetime object. As a personal preference, I would convert the column into a Series object to prevent referring to columns names every time I use the TS. Please feel free to use as a dataframe is that works better for you.</p>
<p>ts = data[‘#Passengers’]
ts.head(10)</p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-series.png" rel="attachment wp-att-23172"><img class="size-medium wp-image-23172 aligncenter" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-series.png?resize=300%2C230" alt="4. series" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-series.png?resize=300%2C230 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-series.png?w=556 556w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>Before going further, I’ll discuss some indexing techniques for TS data. Lets start by selecting a particular value in the Series object. This can be done in following 2 ways:</p>
<pre>#1. Specific the index as a string constant:
ts['1949-01-01']

#2. Import the datetime library and use 'datetime' function:
from datetime import datetime
ts[datetime(1949,1,1)]</pre>
<p>Both would return the value ‘112’ which can also be confirmed from previous output. Suppose we want all the data upto May 1949. This can be done in 2 ways:</p>
<pre>#1. Specify the entire range:
ts['1949-01-01':'1949-05-01']

#2. Use ':' if one of the indices is at ends:
ts[:'1949-05-01']</pre>
<p>Both would yield following output:</p>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-index-range.png" rel="attachment wp-att-23173"><img class="size-medium wp-image-23173 aligncenter" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-index-range.png?resize=300%2C130" alt="5. index range" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-index-range.png?resize=300%2C130 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-index-range.png?w=548 548w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>There are 2 things to note here:</p>
<ol>
<li>Unlike numeric indexing, the <strong>end index is included here</strong>. For instance, if we index a list as a[:5] then it would return the values at indices – [0,1,2,3,4]. But here the index ‘1949-05-01’ was included in the output.</li>
<li>The <strong>indices have to be sorted</strong> for ranges to work. If you randomly shuffle the index, this won’t work.</li>
</ol>
<p>Consider another instance where you need all the values of the year 1949. This can be done as:</p>
<pre>ts['1949']</pre>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-index-year.png" rel="attachment wp-att-23174"><img class="size-medium wp-image-23174 aligncenter" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-index-year.png?resize=300%2C252" alt="6. index year" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-index-year.png?resize=300%2C252 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-index-year.png?w=584 584w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>The month part was omitted. Similarly if you all days of a particular month, the day part can be omitted.</p>
<p>Now, lets move onto the analyzing the TS.</p>
<p> </p>
<h1>3. How to Check Stationarity of a Time Series?</h1>
<p>A TS is said to be stationary if its <strong>statistical properties</strong> such as mean, variance remain <strong>constant over time</strong>. But why is it important? Most of the TS models work on the assumption that the TS is stationary. Intuitively, we can sat that if a TS has a particular behaviour over time, there is a very high probability that it will follow the same in the future. Also, the theories related to stationary series are more mature and easier to implement as compared to non-stationary series.</p>
<p>Stationarity is defined using very strict criterion. However, for practical purposes we can assume the series to be stationary if it has constant statistical properties over time, ie. the following:</p>
<ol>
<li>constant mean</li>
<li>constant variance</li>
<li>an autocovariance that does not depend on time.</li>
</ol>
<p>I’ll skip the details as it is very clearly defined in <a href="http://www.analyticsvidhya.com/blog/2015/12/complete-tutorial-time-series-modeling/" target="_blank">this article</a>. Lets move onto the ways of testing stationarity. First and foremost is to simple plot the data and analyze visually. The data can be plotted using following command:</p>
<pre>plt.plot(ts)</pre>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/7.-ts.png" rel="attachment wp-att-23175"><img class="size-large wp-image-23175 aligncenter" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/7.-ts.png?resize=1024%2C438" alt="7. ts" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/7.-ts.png?resize=300%2C128 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/7.-ts.png?resize=768%2C329 768w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/7.-ts.png?resize=1024%2C438 1024w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/7.-ts.png?resize=850%2C364 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>It is clearly evident that there is an <strong>overall increasing trend</strong> in the data along with some seasonal variations. However, it might not always be possible to make such visual inferences (we’ll see such cases later). So, more formally, we can check stationarity using the following:</p>
<ol>
<li><strong>Plotting Rolling Statistics:</strong> We can plot the moving average or moving variance and see if it varies with time. By moving average/variance I mean that at any instant ‘t’, we’ll take the average/variance of the last year, i.e. last 12 months. But again this is more of a visual technique.</li>
<li><strong>Dickey-Fuller Test:</strong> This is one of the statistical tests for checking stationarity. Here the null hypothesis is that the TS is non-stationary. The test results comprise of a <strong>Test Statistic</strong> and some <strong>Critical Values</strong> for difference confidence levels. If the ‘Test Statistic’ is less than the ‘Critical Value’, we can reject the null hypothesis and say that the series is stationary. Refer <a href="http://www.analyticsvidhya.com/blog/2015/12/complete-tutorial-time-series-modeling/" target="_blank">this article</a> for details.</li>
</ol>
<p>These concepts might not sound very intuitive at this point. I recommend going through the prequel article. If you’re interested in some theoretical statistics, you can refer <strong>Introduction to Time Series and Forecasting</strong> by <strong>Brockwell and Davis</strong>. The book is a bit stats-heavy, but if you have the skill to read-between-lines, you can understand the concepts and tangentially touch the statistics.</p>
<p>Back to checking stationarity, we’ll be using the rolling statistics plots along with Dickey-Fuller test results a lot so I have defined a function which takes a TS as input and generated them for us. Please note that I’ve plotted standard deviation instead of variance to keep the unit similar to mean.</p>
<pre>from statsmodels.tsa.stattools import adfuller
def test_stationarity(timeseries):
    
    #Determing rolling statistics
    rolmean = pd.rolling_mean(timeseries, window=12)
    rolstd = pd.rolling_std(timeseries, window=12)

    #Plot rolling statistics:
    orig = plt.plot(timeseries, color='blue',label='Original')
    mean = plt.plot(rolmean, color='red', label='Rolling Mean')
    std = plt.plot(rolstd, color='black', label = 'Rolling Std')
    plt.legend(loc='best')
    plt.title('Rolling Mean &amp; Standard Deviation')
    plt.show(block=False)
    
    #Perform Dickey-Fuller test:
    print 'Results of Dickey-Fuller Test:'
    dftest = adfuller(timeseries, autolag='AIC')
    dfoutput = pd.Series(dftest[0:4], index=['Test Statistic','p-value','#Lags Used','Number of Observations Used'])
    for key,value in dftest[4].items():
        dfoutput['Critical Value (%s)'%key] = value
    print dfoutput</pre>
<p>The code is pretty straight forward. Please feel free to discuss the code in comments if you face challenges in grasping it.</p>
<p>Let’s run it for our input series:</p>
<pre>test_stationarity(ts)</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dfuller-ts.png" rel="attachment wp-att-23177"><img class="wp-image-23206 size-large aligncenter" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dfuller-ts.png?resize=1024%2C630" alt="" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dfuller-ts.png?resize=300%2C185 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dfuller-ts.png?resize=768%2C473 768w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dfuller-ts.png?resize=1024%2C630 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/1.-dfuller-ts.png?resize=850%2C523 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>Though the variation in standard deviation is small, mean is clearly increasing with time and this is not a stationary series. Also, the test statistic is way more than the critical values. Note that the <strong>signed values should be compared</strong> and not the absolute values.</p>
<p>Next, we’ll discuss the techniques that can be used to take this TS towards stationarity.</p>
<p> </p>
<h1>4. How to make a Time Series Stationary?</h1>
<p>Though stationarity assumption is taken in many TS models, almost none of practical time series are stationary. So statisticians have figured out ways to make series stationary, which we’ll discuss now. Actually, its almost impossible to make a series perfectly stationary, but we try to take it as close as possible.</p>
<p>Lets understand what is making a TS non-stationary. There are 2 major reasons behind non-stationaruty of a TS:<br/>
1. <strong>Trend</strong> – varying mean over time. For eg, in this case we saw that on average, the number of passengers was growing over time.<br/>
2. <strong>Seasonality</strong> – variations at specific time-frames. eg people might have a tendency to buy cars in a particular month because of pay increment or festivals.</p>
<p>The underlying principle is to model or estimate the trend and seasonality in the series and remove those from the series to get a stationary series. Then statistical forecasting techniques can be implemented on this series. The final step would be to convert the forecasted values into the original scale by applying trend and seasonality constraints back.</p>
<p>Note: I’ll be discussing a number of methods. Some might work well in this case and others might not. But the idea is to get a hang of all the methods and not focus on just the problem at hand.</p>
<p>Let’s start by working on the trend part.</p>
<p> </p>
<h2>Estimating &amp; Eliminating Trend</h2>
<p>One of the first tricks to reduce trend can be <strong>transformation</strong>. For example, in this case we can clearly see that the there is a significant positive trend. So we can apply transformation which penalize higher values more than smaller values. These can be taking a log, square root, cube root, etc. Lets take a <strong>log transform</strong> here for simplicity:</p>
<pre>ts_log = np.log(ts)
plt.plot(ts_log)</pre>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/9.-ts-log.png" rel="attachment wp-att-23178"><img class="alignnone size-large wp-image-23178" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/9.-ts-log.png?resize=1024%2C431" alt="9. ts log" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/9.-ts-log.png?resize=300%2C126 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/9.-ts-log.png?resize=768%2C323 768w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/9.-ts-log.png?resize=1024%2C431 1024w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/9.-ts-log.png?resize=850%2C357 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>In this simpler case, it is easy to see a forward trend in the data. But its not very intuitive in presence of noise. So we can use some techniques to estimate or model this trend and then remove it from the series. There can be many ways of doing it and some of most commonly used are:</p>
<ol>
<li><strong>Aggregation</strong> – taking average for a time period like monthly/weekly averages</li>
<li><strong>Smoothing</strong> – taking rolling averages</li>
<li><strong>Polynomial</strong> F<strong>itting</strong> – fit a regression model</li>
</ol>
<p>I will discuss smoothing here and you should try other techniques as well which might work out for other problems. Smoothing refers to taking rolling estimates, i.e. considering the past few instances. There are can be various ways but I will discuss two of those here.</p>
<h3>Moving average</h3>
<p>In this approach, we take average of ‘k’ consecutive values depending on the frequency of time series. Here we can take the average over the past 1 year, i.e. last 12 values. Pandas has specific functions defined for determining rolling statistics.</p>
<pre>moving_avg = pd.rolling_mean(ts_log,12)
plt.plot(ts_log)
plt.plot(moving_avg, color='red')</pre>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.-smooth-1.png" rel="attachment wp-att-23182"><img class="size-large wp-image-23182 aligncenter" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.-smooth-1.png?resize=1024%2C434" alt="10. smooth 1" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.-smooth-1.png?resize=300%2C127 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.-smooth-1.png?resize=768%2C326 768w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.-smooth-1.png?resize=1024%2C434 1024w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.-smooth-1.png?resize=850%2C360 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>The red line shows the rolling mean. Lets subtract this from the original series. Note that since we are taking average of last 12 values, rolling mean is not defined for first 11 values. This can be observed as:</p>
<pre>ts_log_moving_avg_diff = ts_log - moving_avg
ts_log_moving_avg_diff.head(12)</pre>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.5-missing-rolling.png" rel="attachment wp-att-23183"><img class="alignnone size-medium wp-image-23183" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.5-missing-rolling.png?resize=300%2C246" alt="10.5 missing rolling" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.5-missing-rolling.png?resize=300%2C246 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/10.5-missing-rolling.png?w=594 594w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>Notice the first 11 being Nan. Lets drop these NaN values and check the plots to test stationarity.</p>
<pre>ts_log_moving_avg_diff.dropna(inplace=True)
test_stationarity(ts_log_moving_avg_diff)</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dfuller-smooth-1.png" rel="attachment wp-att-23184"><img class="wp-image-23207 size-large aligncenter" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dfuller-smooth-1.png?resize=1024%2C636" alt="" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dfuller-smooth-1.png?resize=300%2C186 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dfuller-smooth-1.png?resize=768%2C477 768w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dfuller-smooth-1.png?resize=1024%2C636 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/2.-dfuller-smooth-1.png?resize=850%2C528 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>This looks like a much better series. The rolling values appear to be varying slightly but there is no specific trend. Also, the test statistic is <strong>smaller than the 5% critical values</strong> so we can say with 95% confidence that this is a stationary series.</p>
<p>However, a drawback in this particular approach is that the time-period has to be strictly defined. In this case we can take yearly averages but in complex situations like forecasting a stock price, its difficult to come up with a number. So we take a ‘weighted moving average’ where more recent values are given a higher weight. There can be many technique for assigning weights. A popular one is <strong>exponentially weighted moving average</strong> where weights are assigned to all the previous values with a decay factor. Find details <a href="http://pandas.pydata.org/pandas-docs/stable/computation.html#exponentially-weighted-moment-functions" target="_blank">here</a>. This can be implemented in Pandas as:</p>
<pre>expwighted_avg = pd.ewma(ts_log, halflife=12)
plt.plot(ts_log)
plt.plot(expwighted_avg, color='red')</pre>
<p> </p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/12.-smooth-2.png" rel="attachment wp-att-23186"><img class="size-large wp-image-23186 aligncenter" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/12.-smooth-2.png?resize=1024%2C430" alt="12. smooth 2" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/12.-smooth-2.png?resize=300%2C126 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/12.-smooth-2.png?resize=768%2C322 768w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/12.-smooth-2.png?resize=1024%2C430 1024w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/12.-smooth-2.png?resize=850%2C357 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>Note that here the parameter ‘halflife’ is used to define the amount of exponential decay. This is just an assumption here and would depend largely on the business domain. Other parameters like span and center of mass can also be used to define decay which are discussed in the link shared above. Now, let’s remove this from series and check stationarity:</p>
<pre>ts_log_ewma_diff = ts_log - expwighted_avg
test_stationarity(ts_log_ewma_diff,nlags=100)</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-dfuller-smooth-2.png" rel="attachment wp-att-23187"><img class="alignnone wp-image-23208 size-large" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-dfuller-smooth-2.png?resize=1024%2C628" alt="" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-dfuller-smooth-2.png?resize=300%2C184 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-dfuller-smooth-2.png?resize=768%2C471 768w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-dfuller-smooth-2.png?resize=1024%2C628 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/3.-dfuller-smooth-2.png?resize=850%2C521 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>This TS has even lesser variations in mean and standard deviation in magnitude. Also, the test statistic is <strong>smaller than the 1% critical value</strong>, which is better than the previous case. Note that in this case there will be no missing values as all values from starting are given weights. So it’ll work even with no previous values.</p>
<p> </p>
<h3>Eliminating Trend and Seasonality</h3>
<p>The simple trend reduction techniques discussed before don’t work in all cases, particularly the ones with high seasonality. Lets discuss two ways of removing trend and seasonality:</p>
<ol>
<li><strong>Differencing</strong> – taking the differece with a particular time lag</li>
<li><strong>Decomposition</strong> – modeling both trend and seasonality and removing them from the model.</li>
</ol>
<h4>Differencing</h4>
<p>One of the most common methods of dealing with both trend and seasonality is differencing. In this technique, we take the difference of the observation at a particular instant with that at the previous instant. This mostly works well in improving stationarity. First order differencing can be done in Pandas as:</p>
<pre>ts_log_diff = ts_log - ts_log.shift()
plt.plot(ts_log_diff)</pre>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/14.-ts-diff.png" rel="attachment wp-att-23188"><img class="alignnone size-large wp-image-23188" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/14.-ts-diff.png?resize=1024%2C427" alt="14. ts diff" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/14.-ts-diff.png?resize=300%2C125 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/14.-ts-diff.png?resize=768%2C320 768w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/14.-ts-diff.png?resize=1024%2C427 1024w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/14.-ts-diff.png?resize=850%2C354 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>This appears to have reduced trend considerably. Lets verify using our plots:</p>
<pre>ts_log_diff.dropna(inplace=True)
test_stationarity(ts_log_diff, nlags=10)</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-dfuller-diff.png" rel="attachment wp-att-23189"><img class="wp-image-23209 size-large aligncenter" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-dfuller-diff.png?resize=1024%2C625" alt="" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-dfuller-diff.png?resize=300%2C183 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-dfuller-diff.png?resize=768%2C469 768w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-dfuller-diff.png?resize=1024%2C625 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/4.-dfuller-diff.png?resize=850%2C519 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>We can see that the mean and std variations have small variations with time. Also, the Dickey-Fuller test statistic is <strong>less than the 10% critical value</strong>, thus the TS is stationary with 90% confidence. We can also take second or third order differences which might get even better results in certain applications. I leave it to you to try them out.</p>
<h4>Decomposing</h4>
<p>In this approach, both trend and seasonality are modeled separately and the remaining part of the series is returned. I’ll skip the statistics and come to the results:</p>
<pre>from statsmodels.tsa.seasonal import seasonal_decompose
decomposition = seasonal_decompose(ts_log)

trend = decomposition.trend
seasonal = decomposition.seasonal
residual = decomposition.resid

plt.subplot(411)
plt.plot(ts_log, label='Original')
plt.legend(loc='best')
plt.subplot(412)
plt.plot(trend, label='Trend')
plt.legend(loc='best')
plt.subplot(413)
plt.plot(seasonal,label='Seasonality')
plt.legend(loc='best')
plt.subplot(414)
plt.plot(residual, label='Residuals')
plt.legend(loc='best')
plt.tight_layout()</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/16.-decompose.png" rel="attachment wp-att-23190"><img class="alignnone size-large wp-image-23190" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/16.-decompose.png?resize=1024%2C408" alt="16. decompose" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/16.-decompose.png?resize=300%2C119 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/16.-decompose.png?resize=768%2C306 768w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/16.-decompose.png?resize=1024%2C408 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/16.-decompose.png?resize=850%2C338 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>Here we can see that the trend, seasonality are separated out from data and we can model the residuals. Lets check stationarity of residuals:</p>
<pre>ts_log_decompose = residual
ts_log_decompose.dropna(inplace=True)
test_stationarity(ts_log_decompose,nlags=10)</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-dfuller-decompose.png" rel="attachment wp-att-23192"><img class="wp-image-23210 size-large aligncenter" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-dfuller-decompose.png?resize=1024%2C624" alt="" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-dfuller-decompose.png?resize=300%2C183 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-dfuller-decompose.png?resize=768%2C468 768w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-dfuller-decompose.png?resize=1024%2C624 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/5.-dfuller-decompose.png?resize=850%2C518 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>The Dickey-Fuller test statistic is significantly <strong>lower than the 1% critical value</strong>. So this TS is very close to stationary. You can try advanced decomposition techniques as well which can generate better results. Also, you should note that converting the residuals into original values for future data in not very intuitive in this case.</p>
<p> </p>
<h1>5. Forecasting a Time Series</h1>
<p>We saw different techniques and all of them worked reasonably well for making the TS stationary. Lets make model on the TS after differencing as it is a very popular technique. Also, its relatively easier to add noise and seasonality back into predicted residuals in this case. Having performed the trend and seasonality estimation techniques, there can be two situations:</p>
<ol>
<li>A <strong>strictly stationary series</strong> with no dependence among the values. This is the easy case wherein we can model the residuals as white noise. But this is very rare.</li>
<li>A series with significant <strong>dependence among values</strong>. In this case we need to use some statistical models like ARIMA to forecast the data.</li>
</ol>
<p>Let me give you a brief introduction to <strong>ARIMA</strong>. I won’t go into the technical details but you should understand these concepts in detail if you wish to apply them more effectively. ARIMA stands for <strong>Auto-Regressive Integrated Moving Averages</strong>. The ARIMA forecasting for a stationary time series is nothing but a linear (like a linear regression) equation. The predictors depend on the parameters (p,d,q) of the ARIMA model:</p>
<ol>
<li><strong>Number of AR (Auto-Regressive) terms (p):</strong> AR terms are just lags of dependent variable. For instance if p is 5, the predictors for x(t) will be x(t-1)….x(t-5).</li>
<li><strong>Number of MA (Moving Average) terms (q):</strong> MA terms are lagged forecast errors in prediction equation. For instance if q is 5, the predictors for x(t) will be e(t-1)….e(t-5) where e(i) is the difference between the moving average at i<sup>th</sup> instant and actual value.</li>
<li><strong>Number of Differences (d):</strong> These are the number of nonseasonal differences, i.e. in this case we took the first order difference. So either we can pass that variable and put d=0 or pass the original variable and put d=1. Both will generate same results.</li>
</ol>
<p>An importance concern here is how to determine the value of ‘p’ and ‘q’. We use two plots to determine these numbers. Lets discuss them first.</p>
<ol>
<li><strong>Autocorrelation Function (ACF):</strong> It is a measure of the correlation between the the TS with a lagged version of itself. For instance at lag 5, ACF would compare series at time instant ‘t1’…’t2’ with series at instant ‘t1-5’…’t2-5’ (t1-5 and t2 being end points).</li>
<li><strong>Partial Autocorrelation Function (PACF):</strong> This measures the correlation between the TS with a lagged version of itself but after eliminating the variations already explained by the intervening comparisons. Eg at lag 5, it will check the correlation but remove the effects already explained by lags 1 to 4.</li>
</ol>
<p>The ACF and PACF plots for the TS after differencing can be plotted as:</p>
<pre>#ACF and PACF plots:
from statsmodels.tsa.stattools import acf, pacf</pre>
<pre>lag_acf = acf(ts_log_diff, nlags=20)
lag_pacf = pacf(ts_log_diff, nlags=20, method='ols')</pre>
<pre>#Plot ACF: 
plt.subplot(121) 
plt.plot(lag_acf)
plt.axhline(y=0,linestyle='--',color='gray')
plt.axhline(y=-1.96/np.sqrt(len(ts_log_diff)),linestyle='--',color='gray')
plt.axhline(y=1.96/np.sqrt(len(ts_log_diff)),linestyle='--',color='gray')
plt.title('Autocorrelation Function')</pre>
<pre>#Plot PACF:
plt.subplot(122)
plt.plot(lag_pacf)
plt.axhline(y=0,linestyle='--',color='gray')
plt.axhline(y=-1.96/np.sqrt(len(ts_log_diff)),linestyle='--',color='gray')
plt.axhline(y=1.96/np.sqrt(len(ts_log_diff)),linestyle='--',color='gray')
plt.title('Partial Autocorrelation Function')
plt.tight_layout()</pre>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-acf-pcf-final.png" rel="attachment wp-att-23211"><img class="size-large wp-image-23211 aligncenter" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-acf-pcf-final.png?resize=1024%2C412" alt="6. acf pcf final" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-acf-pcf-final.png?resize=300%2C121 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-acf-pcf-final.png?resize=768%2C309 768w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-acf-pcf-final.png?resize=1024%2C412 1024w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/6.-acf-pcf-final.png?resize=850%2C342 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>In this plot, the two dotted lines on either sides of 0 are the confidence interevals. These can be used to determine the ‘p’ and ‘q’ values as:</p>
<ol>
<li><strong>p</strong> – The lag value where the <strong>PACF</strong> chart crosses the upper confidence interval for the first time. If you notice closely, in this case p=2.</li>
<li><strong>q</strong> – The lag value where the <strong>ACF</strong> chart crosses the upper confidence interval for the first time. If you notice closely, in this case q=2.</li>
</ol>
<p>Now, lets make 3 different ARIMA models considering individual as well as combined effects. I will also print the RSS for each. Please note that here RSS is for the values of residuals and not actual series.</p>
<p>We need to load the ARIMA model first:</p>
<pre>from statsmodels.tsa.arima_model import ARIMA</pre>
<p>The p,d,q values can be specified using the order argument of ARIMA which take a tuple (p,d,q). Let model the 3 cases:</p>
<h3>AR Model</h3>
<pre>model = ARIMA(ts_log, order=(2, 1, 0))  
results_AR = model.fit(disp=-1)  
plt.plot(ts_log_diff)
plt.plot(results_AR.fittedvalues, color='red')
plt.title('RSS: %.4f'% sum((results_AR.fittedvalues-ts_log_diff)**2))</pre>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/18.-model-AR.png" rel="attachment wp-att-23193"><img class="size-large wp-image-23193 aligncenter" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/18.-model-AR.png?resize=1024%2C449" alt="18. model AR" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/18.-model-AR.png?resize=300%2C132 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/18.-model-AR.png?resize=768%2C337 768w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/18.-model-AR.png?resize=1024%2C449 1024w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/18.-model-AR.png?resize=850%2C373 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<h3>MA Model</h3>
<pre>model = ARIMA(ts_log, order=(0, 1, 2))  
results_MA = model.fit(disp=-1)  
plt.plot(ts_log_diff)
plt.plot(results_MA.fittedvalues, color='red')
plt.title('RSS: %.4f'% sum((results_MA.fittedvalues-ts_log_diff)**2))</pre>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/19.-model-MA.png" rel="attachment wp-att-23194"><img class="size-large wp-image-23194 aligncenter" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/19.-model-MA.png?resize=1024%2C444" alt="19. model MA" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/19.-model-MA.png?resize=300%2C130 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/19.-model-MA.png?resize=768%2C333 768w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/19.-model-MA.png?resize=1024%2C444 1024w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/19.-model-MA.png?resize=850%2C368 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<h3>Combined Model</h3>
<pre>model = ARIMA(ts_log, order=(2, 1, 2))  
results_ARIMA = model.fit(disp=-1)  
plt.plot(ts_log_diff)
plt.plot(results_ARIMA.fittedvalues, color='red')
plt.title('RSS: %.4f'% sum((results_ARIMA.fittedvalues-ts_log_diff)**2))</pre>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/20.-model-both.png" rel="attachment wp-att-23195"><img class="alignnone size-large wp-image-23195" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/20.-model-both.png?resize=1024%2C446" alt="20. model both" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/20.-model-both.png?resize=300%2C131 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/20.-model-both.png?resize=768%2C334 768w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/20.-model-both.png?resize=1024%2C446 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/20.-model-both.png?resize=850%2C370 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>Here we can see that the AR and MA models have almost the same RSS but combined is significantly better. Now, we are left with 1 last step, i.e. taking these values back to the original scale.</p>
<h3>Taking it back to original scale</h3>
<p>Since the combined model gave best result, lets scale it back to the original values and see how well it performs there. First step would be to store the predicted results as a separate series and observe it.</p>
<pre>predictions_ARIMA_diff = pd.Series(results_ARIMA.fittedvalues, copy=True)
print predictions_ARIMA_diff.head()</pre>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/21.-check-output.png" rel="attachment wp-att-23197"><img class="wp-image-23196 size-medium aligncenter" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/21.-check-output.png?resize=300%2C174" alt="" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/21.-check-output.png?resize=300%2C174 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/21.-check-output.png?w=438 438w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>Notice that these start from ‘1949-02-01’ and not the first month. Why? This is because we took a lag by 1 and first element doesn’t have anything before it to subtract from. The way to convert the differencing to log scale is to add these differences consecutively to the base number. An easy way to do it is to first determine the cumulative sum at index and then add it to the base number. The cumulative sum can be found as:</p>
<pre>predictions_ARIMA_diff_cumsum = predictions_ARIMA_diff.cumsum()
print predictions_ARIMA_diff_cumsum.head()</pre>
<p> </p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/22.-cumsum.png" rel="attachment wp-att-23197"><img class="size-medium wp-image-23197 aligncenter" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/22.-cumsum.png?resize=300%2C182" alt="22. cumsum" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/22.-cumsum.png?resize=300%2C182 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/22.-cumsum.png?w=416 416w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>You can quickly do some back of mind calculations using previous output to check if these are correct. Next we’ve to add them to base number. For this lets create a series with all values as base number and add the differences to it. This can be done as:</p>
<pre>predictions_ARIMA_log = pd.Series(ts_log.ix[0], index=ts_log.index)
predictions_ARIMA_log = predictions_ARIMA_log.add(predictions_ARIMA_diff_cumsum,fill_value=0)
predictions_ARIMA_log.head()</pre>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/23.-add-cumsum.png" rel="attachment wp-att-23198"><img class="size-medium wp-image-23198 aligncenter" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/23.-add-cumsum.png?resize=300%2C185" alt="23. add cumsum" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/23.-add-cumsum.png?resize=300%2C185 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/23.-add-cumsum.png?w=408 408w" sizes="(max-width: 300px) 100vw, 300px" data-recalc-dims="1"/></a></p>
<p>Here the first element is base number itself and from thereon the values cumulatively added. Last step is to take the exponent and compare with the original series.</p>
<pre>predictions_ARIMA = np.exp(predictions_ARIMA_log)
plt.plot(ts)
plt.plot(predictions_ARIMA)
plt.title('RMSE: %.4f'% np.sqrt(sum((predictions_ARIMA-ts)**2)/len(ts)))</pre>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/24.-final-plot.png" rel="attachment wp-att-23200"><img class="alignnone size-large wp-image-23200" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/24.-final-plot.png?resize=1024%2C440" alt="24. final plot" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/24.-final-plot.png?resize=300%2C129 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/24.-final-plot.png?resize=768%2C330 768w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/24.-final-plot.png?resize=1024%2C440 1024w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2016/02/24.-final-plot.png?resize=850%2C365 850w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p>Finally we have a forecast at the original scale. Not a very good forecast I would say but you got the idea right? Now, I leave it upto you to refine the methodology further and make a better solution.</p>
<p> </p>
<h1>End Notes</h1>
<p>Through this article I have tried to give you a standard approach for solving time series problem. This couldn’t have come at a better time as today is our <a href="http://datahack.analyticsvidhya.com/contest/mini-datahack" target="_blank">Mini DataHack</a> which will challenge you to solve a similar problem. We’ve covered concepts of stationarity, how to take a time series closer to stationarity and finally forecasting the residuals. It was a long journey and I skipped some statistical details which I encourage you to refer using the suggested material. If you don’t want to copy-paste, you can download the iPython notebook with all the codes from my <a href="https://github.com/aarshayj/Analytics_Vidhya/tree/master/Articles" target="_blank">GitHub</a> repository.</p>
<p>I hope this article will help you achieve a good first solution today. All the best guys!</p>
<p>Did you like the article? How helpful was it in the hackathon today? Somethings bothering you which you wish to discuss further? Please feel free to post a comment and I’ll be more than happy to discuss.</p>

<p/>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p>
															</div>

							</div></body></html>