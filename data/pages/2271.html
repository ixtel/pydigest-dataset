<html><body><div><section class="post-content">
            <p>Once I have submitted my in google play, I was really happy about how stable my app is. Look, this is ANR/crashes report from developers dashboard:</p>

<p><img src="/content/images/2014/Dec/Screenshot_from_2014_12_03_11_35_50.png" alt=""/></p>

<p>Cool ha? Two crashes within 6 months. Haha, how naive...</p>

<p>The thing is, that if some exception happens in python, android app will exit gracefully. I can't even imagine, that crash reporting allows you to <br/>
put extra information, which could be a stack trace for example in our case.</p>

<p>In my every day work I use sentry for monitoring the health status of my django apps. So why not to use it for kivy app? This is my most favorite part in python: There are solutions for everything.</p>

<p>So let's start...</p>

<h3 id="ravensentryintegration">Raven/Sentry integration</h3>

<p>Let's assume that we already have working <a href="http://sentry.readthedocs.org/en/latest/quickstart/">sentry installation</a>. First we need install raven - client app for sentry:</p>

<pre><code>pip install raven
</code></pre>

<p>Put as much code from <code>main.py</code> as possible in try-catch block</p>

<pre><code>try:  
    from kivy.app import App

    class KognitivoApp(App):
        ...


    if __name__ == '__main__':
        app = KognitivoApp()
        app.run()

except SystemExit:  
    pass
except:  
    ...
</code></pre>

<p>System exit is needed for passing <code>exit()</code> calls as non-errors.</p>

<p>After that you need to initialize raven client with <a href="http://raven.readthedocs.org/en/latest/config/#the-sentry-dsn">sentry dsn</a> in exception block and catch exception</p>

<pre><code>from raven import Client  
client = Client(dsn="http://your_sentry_dsn")  
raven.captureException()  
</code></pre>

<p>That's it. If you want to have more context, you can attach device and manufacturer name, version and so on:</p>

<pre><code>raven.tags_context({
    "version": settings.VERSION
})

if platform == 'android':
    from jnius import autoclass

    Build = autoclass("android.os.Build")
    self.user_context({
        "model": Build.MODEL,
        "manufacturer": Build.MANUFACTURER,
    })
</code></pre>

<p>After I've integrated it, imagine what I saw. This is how it looked like after four days:</p>

<p><img src="/content/images/2014/Dec/Screenshot_from_2014_11_28_16_57_39.png" alt=""/></p>

<p>And some context: <br/>
<img src="/content/images/2014/Dec/Screenshot_from_2014_12_03_12_18_09.png" alt=""/>
<img src="/content/images/2014/Dec/Screenshot_from_2014_12_03_12_18_37.png" alt=""/>
<img src="/content/images/2014/Dec/Screenshot_from_2014_12_03_12_18_57.png" alt=""/></p>

<p>Once we have a web for catching bugs, we want also know, how do users interact with the app.</p>

<h3 id="googleanalytics">Google analytics</h3>

<p>First we need last google play services version. If you use buildozer, you will find out, that default sdk downloaded by buildozer, does not have it. You will need to download it.  Call a command:</p>

<pre><code>    ~/.buildozer/android/platform/android-sdk-23/tools/android
</code></pre>

<p>Replace 23 with your sdk version, if you use a different one. Mark Extra-&gt;Google Services for download.</p>

<p>Copy <code>~/.buildozer/android/platform/android-sdk-23/extras/google/google_play_services/libproject/google-play-services_lib</code> to your project folder. It's a standard part. </p>

<p>Add reference to lib project in <code>buildozer.spec</code>:</p>

<pre><code>android.meta_data = com.google.android.gms.version=@integer/google_play_services_version  
android.library_references = google-play-services_lib/  
</code></pre>

<p>Build lib project (from project folder):</p>

<pre><code>~/.buildozer/android/platform/android-sdk-23/tools/android update project -t 1 -p ./google-play-services_lib
</code></pre>

<p>Make android build, check if it works.</p>

<p>Now we have google play services in our apk. </p>

<p>I've sketched a small tracking client for kivy, which you can use. It depends on jnius and can be found <a href="https://github.com/eviltnan/kivy-google-analytics">here</a>. It could be also useful to put screens tracking in a separate mixin:</p>

<pre><code>class TrackingScreenMixin(object):  
    def on_enter(self, *args):
        tracker = App.get_running_app().tracker
        tracker.send_screen(self)

    def on_pre_leave(self, *args):
        tracker = App.get_running_app().tracker

        tracker.clear_screen()
</code></pre>

<p>You would need to instantiate tracker in your app first. Put events tracking where you want to monitor them:</p>

<pre><code>self.tracker.send_event('category', 'action', 'label', 1)  
</code></pre>

<p><strong>* Like it? Want more? Support my kivy app on <a href="https://www.facebook.com/kognitivo">facebook</a> and <a href="https://play.google.com/store/apps/details?id=org.kognitivo.kognitivo">google play</a>. Thank you! *</strong></p>

<p>That's it. This is the basic config, you can surely extend it with more google analytics or google services functions, but this is enough for a fast start.</p>

<p>Happy monitoring!</p>
        </section>

        </div></body></html>