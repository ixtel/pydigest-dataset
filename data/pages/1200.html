<html><body><div><section class="body">
        <p>Django’s forms are fantastic for parsing user input, but I’ve come up with a nice way to use them, in conjunction with HTML forms, for pagination, using the inbuilt Django pagination features.</p>

<p>It all stems from the fact that I’ve begun using forms quite heavily for GET purposes, rather than just for POST. Basically, anytime you have a URL that may have some parts of the query string that may need to be built, it’s simpler to use a form element, than to manually build up the url in your template.</p>

<p>Thus, where you may have something like:</p>

<div class="highlight"><pre><code class="html+django"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'foo'</span> <span class="cp">%}</span><span class="s">?page=</span><span class="cp">{{</span> <span class="nv">page</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>
</code></pre>
</div>

<p>It may be better do do something more like:</p>

<div class="highlight"><pre><code class="html+django"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'foo'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"page"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">page</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>

<p>Indeed, you can even use named buttons for submission, which will refer to the page. That is the key to the process outlined below.</p>

<hr/>

<p>Django comes with lots of “batteries”, including form handling and pagination. The Class Based Views (CBV) that deal with collections of objects will include pagination, although it is possible to use this pagination in your own views. For simplicity, we’ll stick with a simple <code>ListView</code>.</p>

<p>Let’s begin with that simple view: in our <code>views.py</code>:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Person</span>

<span class="n">person_list</span> <span class="o">=</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
    <span class="n">queryset</span><span class="o">=</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
    <span class="n">template_name</span><span class="o">=</span><span class="s1">'person/list.html'</span><span class="p">,</span>
    <span class="n">paginate_by</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">person_detail</span> <span class="o">=</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
    <span class="n">queryset</span><span class="o">=</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
    <span class="n">template_name</span><span class="o">=</span><span class="s1">'person/detail.html'</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>Essentially, that’s all you need to do. You could use implied template names, but I almost never do this. The takeaway from this block is that we are stating the queryset that our <code>ListView</code> will use as the base, the template it should render, and the number of items per page.</p>

<p>I’ve stubbed out the <code>person_detail</code> view, just so we can refer to it in our urlconf, and then in turn in the template. Because of the simplicity of it, we could have just done all of this in our <code>urls.py</code>.</p>

<p>Speaking of our <code>urls.py</code>, we have something like:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>

<span class="kn">import</span> <span class="nn">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">r'^people/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">person_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'person_list'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">r'^people/(?P&lt;pk&gt;\d+)/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">person_detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'person_detail'</span><span class="p">),</span>
<span class="p">]</span>
</code></pre>
</div>

<p>Then, in our template, we can render it as (ignoring the majority of the page):</p>

<div class="highlight"><pre><code class="html+django"><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"people"</span><span class="nt">&gt;</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">object</span> <span class="k">in</span> <span class="nv">object_list</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'person_detail'</span> <span class="nv">pk</span><span class="o">=</span><span class="nv">object.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">{{</span> <span class="nv">object</span> <span class="cp">}}</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
</div>

<p>But this doesn’t give us our pagination. It will only show the first ten results, with no way to access the others. All we need to do to access the others is to append <code>?page=X</code>, but, as we will see, there is another way.</p>

<p>Typically, your pagination block might look something like:</p>

<div class="highlight"><pre><code class="html+django"><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_previous</span> <span class="cp">%}</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.previous_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>
        prev
      <span class="nt">&lt;/a&gt;</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
      <span class="nt">&lt;span&gt;</span>prev<span class="nt">&lt;/span&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="nt">&lt;/li&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_number</span> <span class="k">in</span> <span class="nv">paginator.page_range</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_number</span> <span class="o">=</span> <span class="nv">page_obj.number</span> <span class="cp">%}</span>
      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"active"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span><span class="cp">{{</span> <span class="nv">page_number</span> <span class="cp">}}</span><span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>
          <span class="cp">{{</span> <span class="nv">page_number</span> <span class="cp">}}</span>
        <span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>


  <span class="nt">&lt;li&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_next</span> <span class="cp">%}</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"?page=</span><span class="cp">{{</span> <span class="nv">page_obj.next_page_number</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span>
        next
      <span class="nt">&lt;/a&gt;</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
      <span class="nt">&lt;span&gt;</span>next<span class="nt">&lt;/span&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
</div>

<p>Depending upon your CSS framework, if you use one, there may already be some pre-prepared styles to help you out with this.</p>

<p>This is all well and good, until you want paginated search results. Then, you can no longer rely on being able to rely on using <code>?page=N</code>, as this would remove any search terms you were already using. Also, if you were using ajax to fetch and display stuff, you may need to use the whole URL, rather than just the query string.</p>

<p>Instead, we can use a Django form for searching, and just add in the pagination bits.</p>

<p>We will build a page that displays an optionally filtered list of people.</p>

<p>Our <code>Person</code> model will be deliberately simple:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
</code></pre>
</div>

<p>Likewise, our form will be simple. All we need to do is have the form able to filter our queryset.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">PersonSearchForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">'Filter'</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">'query'</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">queryset</span>
</code></pre>
</div>

<p>Finally, we will need to subclass a <code>ListView</code>. We’ll mixin from <code>FormMixin</code>, so we get the form-handling capabilities:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">FormMixin</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="k">class</span> <span class="nc">FilteredListView</span><span class="p">(</span><span class="n">FormMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="s1">'initial'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial</span><span class="p">(),</span>
          <span class="s1">'prefix'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_prefix</span><span class="p">(),</span>
          <span class="s1">'data'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>

        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">filter_queryset</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">object_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre>
</div>

<p>There’s a little bit to comment on there: we override the <code>get_form_kwargs</code> so we pull our form’s data from <code>request.GET</code>, instead of the default.</p>

<p>We also override <code>get</code>, so we filter results if the form validates (which it will if there was data provided). We delegate responsibility for the actual filtering to the form class.</p>

<p>Everything else is just standard.</p>

<p>We will want to actually use this view:</p>

<div class="highlight"><pre><code class="python"><span class="n">people_list</span> <span class="o">=</span> <span class="n">FilteredListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
    <span class="n">form_class</span><span class="o">=</span><span class="n">PersonSearchForm</span><span class="p">,</span>
    <span class="n">template_name</span><span class="o">=</span><span class="s">'person/list.html'</span><span class="p">,</span>
    <span class="n">queryset</span><span class="o">=</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
    <span class="n">paginate_by</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</code></pre>
</div>

<p>Now we need to render this.</p>

<div class="highlight"><pre><code class="html+django"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">"person-list-filter"</span> <span class="na">action</span><span class="o">=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'person_list'</span> <span class="cp">%}</span><span class="s">"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form.query.html_name</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">value</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form.query.value</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">type</span><span class="o">=</span><span class="s">"search"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">name</span><span class="o">=</span><span class="s">"page"</span> <span class="na">value</span><span class="o">=</span><span class="s">"1"</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">trans</span> <span class="s1">'Search'</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"results"</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">include</span> <span class="s1">'person/list-results.html'</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>You may notice that the search button will result in <code>page=1</code> being used. This is deliberate.</p>

<p>Our <code>person/list-results.html</code> is just the same as what our <code>person/list.html</code> looked like before, with the addition of the pagination template inclusion.</p>

<div class="highlight"><pre><code class="html+django"><span class="cp">{%</span> <span class="k">include</span> <span class="s1">'pagination.html'</span> <span class="k">with</span> <span class="nv">form_target</span><span class="o">=</span><span class="s1">'person-list-filter'</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">"people"</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">object</span> <span class="k">in</span> <span class="nv">object_list</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'person_detail'</span> <span class="nv">pk</span><span class="o">=</span><span class="nv">object.pk</span> <span class="cp">%}</span><span class="s">"</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">object</span> <span class="cp">}}</span>
      <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>Our <code>pagination.html</code> is very similar to how our other template above looked too, but using <code>&lt;button&gt;</code> elements instead of <code>&lt;a&gt;</code>, and we will disable those that should not be clickable. Also, the buttons contain an attribute indicating which form they should be bound to.</p>

<div class="highlight"><pre><code class="html+django"><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">"pagination"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span>
      <span class="na">form</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form_target</span> <span class="cp">}}</span><span class="s">"</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_previous</span> <span class="cp">%}</span>
        <span class="na">name</span><span class="o">=</span><span class="s">"page"</span>
        <span class="na">value</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">page_obj.previous_page_number</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="na">disabled</span><span class="o">=</span><span class="s">"disabled"</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
      prev
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_number</span> <span class="k">in</span> <span class="nv">paginator.page_range</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_number</span> <span class="o">=</span> <span class="nv">page_obj.number</span> <span class="cp">%}</span><span class="s">active</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">name</span><span class="o">=</span><span class="s">"page"</span>
        <span class="na">value</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">page_number</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span>
        <span class="na">form</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form_target</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_number</span> <span class="o">=</span> <span class="nv">page_obj.number</span> <span class="cp">%}</span>
          <span class="na">disabled</span><span class="o">=</span><span class="s">"disabled"</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">page_number</span> <span class="cp">}}</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span>
      <span class="na">form</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form_target</span> <span class="cp">}}</span><span class="s">"</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_next</span> <span class="cp">%}</span>
        <span class="na">name</span><span class="o">=</span><span class="s">"page"</span>
        <span class="na">value</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">page_obj.next_page_number</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="na">disabled</span><span class="o">=</span><span class="s">"disabled"</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
      next
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>We are getting close now. This will be enough to have clicking on the next/previous or page number buttons resubmitting our search form, resulting in the page reloading with the correct results.</p>

<p>But we can do a bit better. We can easily load the results using AJAX, and just insert them into the page.</p>

<p>We just need one additional method on our View class:</p>

<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">FilteredListView</span><span class="p">(</span><span class="n">FormMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">get_template_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ajax_template_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">]</span>

    <span class="c"># ...</span>
</code></pre>
</div>

<p>and one addition to our view declaration:</p>

<div class="highlight"><pre><code class="python"><span class="n">people_list</span> <span class="o">=</span> <span class="n">FilteredListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
    <span class="n">form_class</span><span class="o">=</span><span class="n">PersonSearchForm</span><span class="p">,</span>
    <span class="n">template_name</span><span class="o">=</span><span class="s">'person/list.html'</span><span class="p">,</span>
    <span class="n">ajax_template_name</span><span class="o">=</span><span class="s">'person/list-results.html'</span><span class="p">,</span>
    <span class="n">queryset</span><span class="o">=</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
    <span class="n">paginate_by</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>I’ll use jQuery, is it makes for easier to follow code:</p>

<div class="highlight"><pre><code class="js"><span class="c1">// Submit handler for our form: submit it using AJAX instead.</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'#person-list-filter'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

  <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">action</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">).</span><span class="nx">serialize</span><span class="p">(),</span>
    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">'#results'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Because we are using buttons, which ajax submit will not send,</span>
<span class="c1">// we need to add a hidden field with the relevant page number</span>
<span class="c1">// when we send our request.</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'#person-list-filter'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="s1">'[name=page]'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">$button</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">'button'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">$form</span> <span class="o">=</span> <span class="nx">$button</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">form</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'[type=hidden][name=page]'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">$form</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;input type="hidden" name="page"&gt;'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'[type=hidden][name=page]'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$button</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span>

  <span class="nx">$form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
<span class="p">});</span>
</code></pre>
</div>

<p>That should do nicely.</p>

<hr/>

<p>There is another thing that we need to think about. If we leave the next/prev buttons, then we need to handle multiple clicks on those buttons, which fetch the subsequent page, and possibly cancel the existing AJAX request.</p>

<p>I do have a solution for this, too, although it complicates things a fair bit. First, we need to add some attributes to the next/prev buttons:</p>

<div class="highlight"><pre><code class="html+django"><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">"pagination"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span>
      <span class="na">form</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form_target</span> <span class="cp">}}</span><span class="s">"</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_previous</span> <span class="cp">%}</span>
        <span class="na">name</span><span class="o">=</span><span class="s">"page"</span>
        <span class="na">value</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">page_obj.previous_page_number</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span>
        <span class="na">data-increment</span><span class="o">=</span><span class="s">"-1"</span>
        <span class="na">data-stop-at</span><span class="o">=</span><span class="s">"1"</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="na">disabled</span><span class="o">=</span><span class="s">"disabled"</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
      prev
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">page_number</span> <span class="k">in</span> <span class="nv">paginator.page_range</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_number</span> <span class="o">=</span> <span class="nv">page_obj.number</span> <span class="cp">%}</span><span class="s">active</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="s">"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">name</span><span class="o">=</span><span class="s">"page"</span>
        <span class="na">value</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">page_number</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span>
        <span class="na">form</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form_target</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_number</span> <span class="o">=</span> <span class="nv">page_obj.number</span> <span class="cp">%}</span>
          <span class="na">disabled</span><span class="o">=</span><span class="s">"disabled"</span>
        <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">page_number</span> <span class="cp">}}</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span>
      <span class="na">form</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">form_target</span> <span class="cp">}}</span><span class="s">"</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">page_obj.has_next</span> <span class="cp">%}</span>
        <span class="na">name</span><span class="o">=</span><span class="s">"page"</span>
        <span class="na">value</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">page_obj.next_page_number</span> <span class="cp">}}</span><span class="s">"</span>
        <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span>
        <span class="na">data-increment</span><span class="o">=</span><span class="s">"1"</span>
        <span class="na">data-stop-at</span><span class="o">=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">paginator.num_pages</span> <span class="cp">}}</span><span class="s">"</span>
      <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
        <span class="na">disabled</span><span class="o">=</span><span class="s">"disabled"</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
      next
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>And our click handler changes a bit too:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">'#person-list-filter'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="s1">'button[name=page]'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">$form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">form</span><span class="p">);</span>
  <span class="c1">// Only update the value of the hidden form.</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'[name=page][type=hidden]'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">$form</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="s1">'&lt;input name=page type=hidden&gt;'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'[name=page][type=hidden]'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
  <span class="c1">// Increment any prev/next buttons values by their increment amount,</span>
  <span class="c1">// and set the disabled flag on any that have reached their stop-at</span>
  <span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'[data-increment]'</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">increment</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="nx">page</span><span class="p">;</span>
    <span class="c1">// We want to disable the button if we get to the 'stop-at' value,</span>
    <span class="c1">// but this needs to happen after any submit events have occurred.</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">stopAt</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">stopAt</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">$form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
<span class="p">});</span>
</code></pre>
</div>

<hr/>

<p>Since this was posted, I have written a number of pages that use this pattern. Some of the improvements that could be made are listed below:</p>

<p>It’s possible to have these results automatically update as the user types. Obviously, this only makes sense if we have AJAX submission happening!</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">'#person-list-filter'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
<span class="p">})</span>
</code></pre>
</div>

<p>If you have lots and lots of results, you probably won’t want to show every button. Often you will see the first few, and a couple either side of the current page (and sometimes the last few). This is <em>almost</em> possible to do with pure CSS, but not quite. I do have a solution for this, but it’s probably worthy of a complete post of its own.</p>

<p>Another situation that is likely to happen is this:</p>

<ul>
  <li>User clicks on a page other than page 1 of results. Let’s say page N.</li>
  <li>User enters text in search field which results in fewer than N pages of results being available.</li>
  <li>User gets error message.</li>
</ul>

<p>We can fix this with an overridden method:</p>

<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">FilteredListView</span><span class="p">(</span><span class="n">FormMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">paginate_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="p">,</span> <span class="n">page_size</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FilteredListView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">page_size</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Http404</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">'page'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'last'</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FilteredListView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">page_size</span><span class="p">)</span>

    <span class="c1"># ...</span>
</code></pre>
</div>

<p>You’ll also need to add in a <code>get_prefix()</code> method if you are using an old Django, but really you should just upgrade.</p>

<hr/>

<p>Updated: I’ve added in some more error checking into the templates, to prevent exceptions when attempting to render previous and next page links (thanks inoks).</p>

<p>Updated: I’ve changed to use the preferred urlpattern syntax. (thanks knbk).</p>

<p>Updated: Delegate to the form for filtering. Add discussion of other extensions. Add <code>button[form]</code> attributes.</p>

    </section>
    </div></body></html>