<html><body><div><section class="the_post">
    <div class="section" id="about-the-authors">
<h2>About the authors</h2>

<div>
<p class="p1"><strong>ttwick</strong> and <strong>Machinalis</strong> are cooperating on fintech projects for Wall Street</p>
</div>
</div>
<div class="section" id="ipython-notebook">
<h2>IPython notebook</h2>
<p>This post is also available as an IPython notebook on <a class="reference external" href="http://nbviewer.ipython.org/github/abarto/embedding_interactive_maps_into_an_ipython_notebook/blob/master/embedding_interactive_maps_to_ipython_notebook.ipynb">GitHub</a>.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction</h2>
<p>There are many sources of geolocated data for interesting events available on the Internet. The data ranges from catastrophic events as the latest earthquakes, to the most mundane of tweets regarding Kim Kardashian. Putting aside the actual value of the data, IPyhton Notebooks are a great tool to play, analyze and publish the results of of our work.</p>
<p>The purpose of this post (and the associated Notebook) is to show you how easy it is to fetch geolocated data from public sources, create Pandas’ DataFrames from it, and plotting the results using interactive Matplotlib, Google Maps and OpenLayers.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements</h2>
<p>In order to properly run this Notebook, you need to install the following Python modules:</p>
<ul class="simple">
<li>matplotlib</li>
<li>Basemap (you might need to install it with pip install basemap –allow-external basemap –allow-unverified basemap)</li>
<li>dateutil</li>
<li>pandas</li>
</ul>
<p>The rest of the modules we use are dependencies for IPython Notebook, pandas or Basemap.</p>
</div>
<div class="section" id="about-pandas">
<h2>About Pandas</h2>
<p>Although Pandas is not strictly necessary to accomplish what we do in the examples, it is such a popular data analysis tool that we wanted to use it anyway. We recommend that you read the <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/10min.html#min">10 Minutes to Pandas</a> tutorial to get and idea of what it can do or buy <a class="reference external" href="http://shop.oreilly.com/product/0636920023784.do">Python for Data Analysis</a> for an in depth guide of data analysis using Python, Pandas and NumPy.</p>
</div>

<div class="section" id="plotting-historic-earthquake-data-for-mexico-city-with-matplotlib">
<h2>Plotting historic earthquake data for Mexico City with Matplotlib</h2>
<p>The <a class="reference external" href="http://www.usgs.gov/">United States Geological Survey</a> is a fantastic source of information. They provide quality data from all over the planet in a variety of formats for all kinds of events (not just geological ones), so it’s the go to source for <a class="reference external" href="http://maps.google.com/gallery/details?id=z4f-ZuCLmiKg.kjEKRL8AzeQM&amp;hl=en">examples</a> <a class="reference external" href="http://nbviewer.ipython.org/github/ehmatthes/intro_programming/blob/master/notebooks/visualization_earthquakes.ipynb">related</a> to geolocated data.</p>
<p>For this example we’re going to use <a class="reference external" href="http://comcat.cr.usgs.gov/fdsnws/event/1/">Earthquake Search and Web Service API</a> that allows you to search for geological events using several criteria and filters.</p>
<p>We’re going to plot (initially) all the earthquakes of magnitude 4.0 or higher in an 800km circle around Mexico City from 1/1/1984 to 1/1/2014.</p>
<p>In order to make the map interactive, we’ll use IPython’s <a class="reference external" href="http://nbviewer.ipython.org/github/ipython/ipython/blob/2.x/examples/Interactive%20Widgets/Using%20Interact.ipynb">interact()</a> function that takes a callback function and an arbitrary list of parameters that can either be fixed values or widgets. Whenever a widget is updated, the callback function is called.</p>
<p>Our callback function display_map, makes a request to the USGS API, creates a Pandas DataFrame from the CSV response, creates a Basemap map, and plots the geological events onto the map. The latitude, longitude, radius, start date, end date and minimum magnitude parameters are presented as widgets. The start date and end date use the custom date selection widget that was defined above.</p>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="k">def</span> <span class="nf">display_map</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">maxradiuskm</span><span class="p">,</span> <span class="n">minmagnitude</span><span class="p">):</span>
    <span class="c"># Make the request to the Earthquake Search and Web Service API</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://comcat.cr.usgs.gov/fdsnws/event/1/query'</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'starttime'</span><span class="p">:</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">starttime</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="s">'endtime'</span><span class="p">:</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">endtime</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="s">'latitude'</span><span class="p">:</span> <span class="n">latitude</span><span class="p">,</span>
        <span class="s">'longitude'</span><span class="p">:</span> <span class="n">longitude</span><span class="p">,</span>
        <span class="s">'maxradiuskm'</span><span class="p">:</span> <span class="n">maxradiuskm</span><span class="p">,</span>
        <span class="s">'minmagnitude'</span><span class="p">:</span> <span class="n">minmagnitude</span><span class="p">,</span>
        <span class="s">'magtype'</span><span class="p">:</span> <span class="s">'md'</span><span class="p">,</span>
        <span class="s">'format'</span><span class="p">:</span> <span class="s">'csv'</span> <span class="c"># We ask for a CSV formatted response</span>
    <span class="p">})</span>

    <span class="c"># Create a DataFrame from the CSV response. Notice that we force Pandas to</span>
    <span class="c"># interpret the latitude and longitude columns as float and that we use the</span>
    <span class="c"># time column as index.</span>
    <span class="n">earthquakes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'latitude'</span><span class="p">:</span><span class="s">'float'</span><span class="p">,</span> <span class="s">'longitude'</span><span class="p">:</span><span class="s">'float'</span><span class="p">},</span>
        <span class="n">index_col</span><span class="o">=</span><span class="s">'time'</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>

    <span class="n">figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>

    <span class="c"># Create a new map with cylindrical projection centered around the supplied</span>
    <span class="c"># coordinates</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="s">'cyl'</span><span class="p">,</span>
                <span class="n">lon_0</span><span class="o">=</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span>
                <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">latitude</span> <span class="o">-</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">latitude</span> <span class="o">+</span> <span class="mf">5.0</span><span class="p">,</span>
                <span class="n">llcrnrlon</span><span class="o">=</span><span class="n">longitude</span> <span class="o">-</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">longitude</span> <span class="o">+</span> <span class="mf">5.0</span><span class="p">,</span>
                <span class="n">resolution</span><span class="o">=</span><span class="s">'i'</span>
                <span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="s">'aqua'</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">fillcontinents</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'coral'</span><span class="p">,</span><span class="n">lake_color</span><span class="o">=</span><span class="s">'aqua'</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawstates</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">drawstates</span><span class="p">()</span>

    <span class="c"># Plot the geolocical events as blue dots</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">earthquakes_df</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">earthquakes_df</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">'bo'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">([</span><span class="n">longitude</span><span class="p">],</span> <span class="p">[</span><span class="n">latitude</span><span class="p">])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">'rx'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">15.0</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Earthquakes around ({longitude}, {latitude}) from {starttime} to {endtime}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span> <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="n">endtime</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
</div>
</div>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="n">i</span> <span class="o">=</span> <span class="n">interact</span><span class="p">(</span>
    <span class="n">display_map</span><span class="p">,</span>
    <span class="n">latitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">19.4284700</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">90.0</span><span class="p">),</span>
    <span class="n">longitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Longitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">99.1276600</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span>
    <span class="n">starttime</span><span class="o">=</span><span class="n">DateWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Start Date'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">'1984-01-01'</span><span class="p">),</span>
    <span class="n">endtime</span><span class="o">=</span><span class="n">DateWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'End Date'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">'2014-01-01'</span><span class="p">),</span>
    <span class="n">maxradiuskm</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Radius (Km)"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
    <span class="n">minmagnitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Minimum Magnitude"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">)</span>
</pre>
</div>
</div>
<img src="/static/media/uploads/uploads/basemap_controls.png" alt="/static/media/uploads/uploads/basemap_controls.png"/> <img src="/static/media/uploads/uploads/basemap.png" alt="/static/media/uploads/uploads/basemap.png"/></div>
<div class="section" id="plotting-recent-earthquakes-with-google-maps">
<h2>Plotting recent earthquakes with Google Maps</h2>
<p>Although Basemap is quite capable it lacks the interactivity that most users are accostumed to. Luckily, it is pretty simple to embed arbitrary HTML and Javascript code into an IPython Notebook, and we’re going to use this feature to integrate Google Maps (using <a class="reference external" href="https://developers.google.com/maps/documentation/javascript/">Google Maps Javascript API</a>) in our example.</p>
<p>We’ll use of one USGS <a class="reference external" href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php">earthquake feeds</a> to plot the latest events. We’re going to use the interact function() again, but we’ll give the user the ability to choose which feed to use and the type of map to render. Notice that there’s an additional parameter called “div” that takes and HTMLWidget as parameter. We need this widget rendered before any Javascript code is executed so the Google Maps API can paint the map onto it.</p>
<p>The callback function makes the request to the web service, and generates a Pandas DataFrame from the JSON response. Afterwards it displays Javascript code from a Jinja2 template that creates the map, and then iterates over the events to create a marker for each of them.</p>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="k">def</span> <span class="nf">display_earthquake_markers_map</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">map_type</span><span class="p">,</span> <span class="n">div</span><span class="p">):</span>
    <span class="c"># Make a request to the supplied feed and parse the response as JSON</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
    <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="c"># Create a DataFrame from a list comprehension built from the "features"</span>
    <span class="c"># field of the JSON response.</span>
    <span class="n">latest_earthquakes</span> <span class="o">=</span> <span class="p">[(</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'time'</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">),</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'geometry'</span><span class="p">][</span><span class="s">'coordinates'</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'geometry'</span><span class="p">][</span><span class="s">'coordinates'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'mag'</span><span class="p">],</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'title'</span><span class="p">],</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">response_json</span><span class="p">[</span><span class="s">'features'</span><span class="p">]]</span>

    <span class="n">latest_earthquakes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">latest_earthquakes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'time'</span><span class="p">,</span> <span class="s">'latitude'</span><span class="p">,</span> <span class="s">'longitude'</span><span class="p">,</span> <span class="s">'mag'</span><span class="p">,</span> <span class="s">'title'</span><span class="p">])</span>
    <span class="n">latest_earthquakes_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'time'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># Define a Jinja2 template that creates the map, and iterates of the</span>
    <span class="c"># features to create a marker for each of them.</span>
    <span class="n">latest_earthquakes_javascript</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span>
    <span class="sd">"""</span>
<span class="sd"> require(['async!http://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=visualization&amp;callback=console.log'], function() {</span>
<span class="sd"> var mapOptions = {</span>
<span class="sd"> zoom: 2.0,</span>
<span class="sd"> center: new google.maps.LatLng({{ latitude }}, {{ longitude }}),</span>
<span class="sd"> mapTypeId: {{ map_type }}</span>
<span class="sd"> };</span>

<span class="sd"> var map = new google.maps.Map(document.getElementById('latest_earthquakes_map_markers'), mapOptions);</span>
<span class="sd"> var markers = Array();</span>

<span class="sd"> var machinalis_marker = new google.maps.Marker({</span>
<span class="sd"> position: new google.maps.LatLng(-31.4122599,-64.2010031),</span>
<span class="sd"> icon: {</span>
<span class="sd"> size: new google.maps.Size(30, 30),</span>
<span class="sd"> url: 'data:image/png;base64,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'</span>
<span class="sd"> },</span>
<span class="sd"> title: 'http://www.machinalis.com',</span>
<span class="sd"> map: map</span>
<span class="sd"> });</span>

<span class="sd"> {% for earthquake in latest_earthquakes %}</span>
<span class="sd"> markers.push(new google.maps.Marker({</span>
<span class="sd"> position: new google.maps.LatLng({{ earthquake[1] }}, {{ earthquake[2] }}),</span>
<span class="sd"> title: "{{ earthquake[4] }}",</span>
<span class="sd"> map: map</span>
<span class="sd"> }));</span>
<span class="sd"> {% endfor %}</span>
<span class="sd"> });</span>
<span class="sd"> """</span>
    <span class="p">)</span>

    <span class="c"># Render the template and display it as Javascript</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="n">latest_earthquakes_javascript</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">latest_earthquakes</span><span class="o">=</span><span class="n">latest_earthquakes_df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(),</span>
        <span class="n">map_type</span><span class="o">=</span><span class="n">map_type</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span>
    <span class="p">)))</span>
</pre>
</div>
</div>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="n">i</span> <span class="o">=</span> <span class="n">interact</span><span class="p">(</span>
    <span class="n">display_earthquake_markers_map</span><span class="p">,</span>
    <span class="n">latitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">31.4122599</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">90.0</span><span class="p">),</span>
    <span class="n">longitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Longitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">64.2010031</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span>
    <span class="n">map_type</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">DropdownWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Map Type"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'Road Map'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.ROADMAP'</span><span class="p">,</span>
        <span class="s">'Satellite'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.SATELLITE'</span><span class="p">,</span>
        <span class="s">'Hybrid'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.HYBRID'</span><span class="p">,</span>
        <span class="s">'Terrain'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.TERRAIN'</span><span class="p">,</span>
    <span class="p">},</span> <span class="n">value</span><span class="o">=</span><span class="s">'google.maps.MapTypeId.SATELLITE'</span><span class="p">),</span>
    <span class="n">feed</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">DropdownWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Feed'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'Significant Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_week.geojson'</span><span class="p">,</span>
        <span class="s">'M4.5+ Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson'</span><span class="p">,</span>
        <span class="s">'M2.5+ Earthquakes'</span><span class="p">:</span> <span class="s">'hytp://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojson'</span><span class="p">,</span>
        <span class="s">'M1.0+ Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/1.0_week.geojson'</span><span class="p">,</span>
        <span class="s">'All Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson'</span>
    <span class="p">},</span> <span class="n">value</span><span class="o">=</span><span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson'</span><span class="p">),</span>
    <span class="n">div</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">HTMLWidget</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">'&lt;div id="latest_earthquakes_map_markers" style="width: 800px; height: 600px"&gt;&lt;/div&gt;'</span><span class="p">)</span>
<span class="p">)</span>
</pre>
</div>
</div>
<img src="/static/media/uploads/uploads/google_maps_markers_controls.png" alt="/static/media/uploads/uploads/google_maps_markers_controls.png"/> <img src="/static/media/uploads/uploads/google_maps_markers.png" alt="/static/media/uploads/uploads/google_maps_markers.png"/>
<p>It might be useful to represent the geological events as circles with radius proportional to its magnitude. For that we define a getCircle Javascript function that’s going to define the icon for each marker.</p>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="k">def</span> <span class="nf">display_earthquake_circles_map</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">map_type</span><span class="p">,</span> <span class="n">div</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
    <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">latest_earthquakes</span> <span class="o">=</span> <span class="p">[(</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'time'</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">),</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'geometry'</span><span class="p">][</span><span class="s">'coordinates'</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'geometry'</span><span class="p">][</span><span class="s">'coordinates'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'mag'</span><span class="p">],</span>
        <span class="n">feature</span><span class="p">[</span><span class="s">'properties'</span><span class="p">][</span><span class="s">'title'</span><span class="p">],</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">response_json</span><span class="p">[</span><span class="s">'features'</span><span class="p">]]</span>

    <span class="n">latest_earthquakes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">latest_earthquakes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'time'</span><span class="p">,</span> <span class="s">'latitude'</span><span class="p">,</span> <span class="s">'longitude'</span><span class="p">,</span> <span class="s">'mag'</span><span class="p">,</span> <span class="s">'title'</span><span class="p">])</span>
    <span class="n">latest_earthquakes_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'time'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">latest_earthquakes_javascript</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span>
    <span class="sd">"""</span>
<span class="sd"> require(['async!http://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=visualization&amp;callback=console.log'], function() {</span>
<span class="sd"> function getCircle(magnitude) {</span>
<span class="sd"> return {</span>
<span class="sd"> path: google.maps.SymbolPath.CIRCLE,</span>
<span class="sd"> fillColor: 'red',</span>
<span class="sd"> fillOpacity: .2,</span>
<span class="sd"> scale: Math.pow(2, magnitude) / Math.PI,</span>
<span class="sd"> strokeColor: 'white',</span>
<span class="sd"> strokeWeight: .5</span>
<span class="sd"> };</span>
<span class="sd"> }</span>

<span class="sd"> var mapOptions = {</span>
<span class="sd"> zoom: 2.0,</span>
<span class="sd"> center: new google.maps.LatLng({{ latitude }}, {{ longitude }}),</span>
<span class="sd"> mapTypeId: {{ map_type }}</span>
<span class="sd"> };</span>

<span class="sd"> var map = new google.maps.Map(document.getElementById('latest_earthquakes_map_circles'), mapOptions);</span>

<span class="sd"> var machinalis_marker = new google.maps.Marker({</span>
<span class="sd"> position: new google.maps.LatLng(-31.4122599,-64.2010031),</span>
<span class="sd"> icon: {</span>
<span class="sd"> size: new google.maps.Size(30, 30),</span>
<span class="sd"> url: 'data:image/png;base64,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'</span>
<span class="sd"> },</span>
<span class="sd"> title: 'http://www.machinalis.com',</span>
<span class="sd"> map: map</span>
<span class="sd"> });</span>

<span class="sd"> var markers = Array();</span>

<span class="sd"> {% for earthquake in latest_earthquakes %}</span>
<span class="sd"> markers.push(new google.maps.Marker({</span>
<span class="sd"> position: new google.maps.LatLng({{ earthquake[1] }}, {{ earthquake[2] }}),</span>
<span class="sd"> title: "{{ earthquake[4] }}",</span>
<span class="sd"> icon: getCircle({{ earthquake[3] }}),</span>
<span class="sd"> map: map</span>
<span class="sd"> }));</span>
<span class="sd"> {% endfor %}</span>
<span class="sd"> });</span>
<span class="sd"> """</span>
    <span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="n">latest_earthquakes_javascript</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">latest_earthquakes</span><span class="o">=</span><span class="n">latest_earthquakes_df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(),</span>
        <span class="n">map_type</span><span class="o">=</span><span class="n">map_type</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span>
    <span class="p">)))</span>
</pre>
</div>
</div>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="n">i</span> <span class="o">=</span> <span class="n">interact</span><span class="p">(</span>
    <span class="n">display_earthquake_circles_map</span><span class="p">,</span>
    <span class="n">latitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">31.4122599</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">90.0</span><span class="p">),</span>
    <span class="n">longitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Longitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">64.2010031</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span>
    <span class="n">map_type</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">DropdownWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Map Type"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'Road Map'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.ROADMAP'</span><span class="p">,</span>
        <span class="s">'Satellite'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.SATELLITE'</span><span class="p">,</span>
        <span class="s">'Hybrid'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.HYBRID'</span><span class="p">,</span>
        <span class="s">'Terrain'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.TERRAIN'</span><span class="p">,</span>
    <span class="p">},</span> <span class="n">value</span><span class="o">=</span><span class="s">'google.maps.MapTypeId.SATELLITE'</span><span class="p">),</span>
    <span class="n">feed</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">DropdownWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Feed'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'Significant Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_week.geojson'</span><span class="p">,</span>
        <span class="s">'M4.5+ Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson'</span><span class="p">,</span>
        <span class="s">'M2.5+ Earthquakes'</span><span class="p">:</span> <span class="s">'hytp://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojson'</span><span class="p">,</span>
        <span class="s">'M1.0+ Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/1.0_week.geojson'</span><span class="p">,</span>
        <span class="s">'All Earthquakes'</span><span class="p">:</span> <span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson'</span>
    <span class="p">},</span> <span class="n">value</span><span class="o">=</span><span class="s">'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson'</span><span class="p">),</span>
    <span class="n">div</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">HTMLWidget</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">'&lt;div id="latest_earthquakes_map_circles" style="width: 800px; height: 600px"&gt;&lt;/div&gt;'</span><span class="p">)</span>
<span class="p">)</span>
</pre>
</div>
</div>
<img src="/static/media/uploads/uploads/google_maps_markers_controls.png" alt="/static/media/uploads/uploads/google_maps_markers_controls.png"/> <img src="/static/media/uploads/uploads/google_maps_circles.png" alt="/static/media/uploads/uploads/google_maps_circles.png"/></div>
<div class="section" id="plotting-recent-heat-points-in-argentina-with-google-maps">
<h2>Plotting recent heat points in Argentina with Google Maps</h2>
<p>We mentioned at the beginning of the post that there are many sources of geolocated data available on the Internet. Of one such sources is provided by <a class="reference external" href="http://www.conae.gov.ar/index.php/espanol/">CONAE</a> (The Argentine Space Agency) and it gives us a list of <a class="reference external" href="http://catalogos.conae.gov.ar/focos/">heat points</a> as a GEORSS feed (A specialized Atom feed).</p>
<p>We can use this feed to build a new DataFrame and from it, a map that shows those heat points with a custom icon (an Base64 encoded PNG file). As before, we’re going to use requests to fetch the data, but this time we’ll use ElementTree and XPath to parse and preparte the date before we build the DataFrame. All this functionality is contained within a new callback function.</p>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="k">def</span> <span class="nf">display_heat_points_map</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">map_type</span><span class="p">,</span> <span class="n">div</span><span class="p">):</span>
    <span class="c"># Make the request and parse the response as XML using ElementTree</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://catalogos.conae.gov.ar/focos/focosdecalor.xml'</span><span class="p">)</span>
    <span class="n">response_atom</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

    <span class="c"># Build a DataFrame extrating the data for each entry using XPath</span>
    <span class="n">entries_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}id'</span><span class="p">)]</span>
    <span class="n">entries_title</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}title'</span><span class="p">)]</span>
    <span class="n">entries_updated</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}updated'</span><span class="p">)]</span>
    <span class="n">entries_summary</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}summary'</span><span class="p">)]</span>
    <span class="n">entries_point_lat</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.georss.org/georss}point'</span><span class="p">)]</span>
    <span class="n">entries_point_lon</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.georss.org/georss}point'</span><span class="p">)]</span>

    <span class="n">entries_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s">'id'</span><span class="p">:</span> <span class="n">entries_id</span><span class="p">,</span>
        <span class="s">'title'</span><span class="p">:</span> <span class="n">entries_title</span><span class="p">,</span>
        <span class="s">'summary'</span><span class="p">:</span> <span class="n">entries_summary</span><span class="p">,</span>
        <span class="s">'lat'</span><span class="p">:</span> <span class="n">entries_point_lat</span><span class="p">,</span>
        <span class="s">'lon'</span><span class="p">:</span> <span class="n">entries_point_lon</span>
    <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">entries_updated</span><span class="p">)</span>

    <span class="c"># Define a Jinja2 template that creates the map, and iterates of the</span>
    <span class="c"># entries to create a marker with a custom icon for each of them.</span>
    <span class="n">heat_points_javascript</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span>
    <span class="sd">"""</span>
<span class="sd"> require(['async!http://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=visualization&amp;callback=console.log'], function() {</span>
<span class="sd"> var mapOptions = {</span>
<span class="sd"> zoom: 4,</span>
<span class="sd"> center: new google.maps.LatLng({{ latitude }}, {{ longitude }}),</span>
<span class="sd"> mapTypeId: {{ map_type }}</span>
<span class="sd"> };</span>

<span class="sd"> var map = new google.maps.Map(document.getElementById('heat_points'), mapOptions);</span>

<span class="sd"> var machinalis_marker = new google.maps.Marker({</span>
<span class="sd"> position: new google.maps.LatLng(-31.4122599,-64.2010031),</span>
<span class="sd"> icon: {</span>
<span class="sd"> size: new google.maps.Size(30, 30),</span>
<span class="sd"> url: 'data:image/png;base64,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'</span>
<span class="sd"> },</span>
<span class="sd"> title: 'http://www.machinalis.com',</span>
<span class="sd"> map: map</span>
<span class="sd"> });</span>

<span class="sd"> // Taken from http://hubpic.com/flame-icon-vector-material-04.html</span>
<span class="sd"> var marker_icon = {</span>
<span class="sd"> size: new google.maps.Size(21, 32),</span>
<span class="sd"> url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAgCAYAAAD9oDOIAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH3gUcDQEVStH2UQAAArJJREFUSMet1UtoXGUUB/Dfdyc0j0JREmybSBaKL6ILxTRYXUQQFAQXlUIXpQWzUFS6Koi7SnFpNz6ouml9RKpI6SYUurGCzcKtglVQWm2h1Edt7CN1JsfF/XKbiZnMJOmB4c537rl//uf1/1ihxc1nEYwHA4tjipWCphKwH3/jUuL3sEYL9gUR7HcLwLqCqQwYwV2xBrD53+kgoihBbwXLL4OIFyqWPy8XX3TQ5f3Y5gAuVa/n1sKwN6jHdhHfiHikYlpfFdNsJwyqeT1TvwlVCwZiFemP4HFv4Gp29jaFjKVVMN3lXjy0wDPS9P7d5RZE0JO4vojpFUf0uXNB1/7Ec03fv5R4vxXT2eCzoJYB73aHPkOaJ3Ijnm/6fh//H9oi0w1cwLns32Jwibz+xYvorjybgo/TMjX9ERuDNzFguEXB1uMoeirPzmC0Fej9+fkaety2zFZswCdN3qNNoAvqsXV+BrGhGqNWNohD1WkoZ1iCZn3sxsO2VUGXnWkDOof7cKDyvBp0LUz/U+sVdlcBF5zvYI8bGMM4uSgHIUWZyDm78Qqexl+mccYxOwxoL3QNPFnJTH+RjzyaR+Y98BhO2ysn1MbW4eXqNF5gO7g9MxrGBNjjJx+ant+7Nky3VqcdKTiPzb7A5uzuw6RyAWfMOqZbfxvgelXb31JwDT0+z2OymMHX+BW72oB24wnManRlmRg0s0RgDU/l9Osd1LZs1MUicymXtGhRr04AL+dGM13gMLnrfWu4Hc9W/yYLnMB3ZvJ2pFUA9uIIyv5MFWikUt/P+iiL30qBv8VxgZHE1cUqNWUnfuhw6FOu495y6BO/xLygZLueeNYNEyZ87x1czKNSW0KF1+EUnnHKP+5JueGpzZ0/HHwQo/6It9yIk+px0lx8pRFvm40HHA8eXOo6+Q9fYtvU17HpOgAAAABJRU5ErkJggg=='</span>
<span class="sd"> }</span>

<span class="sd"> var markers = Array();</span>
<span class="sd"> var marker_info_windows = Array();</span>

<span class="sd"> {% for heat_point in heat_points %}</span>
<span class="sd"> marker_info_windows[{{ loop.index0 }}] = new google.maps.InfoWindow({</span>
<span class="sd"> content: '{{ heat_point[4] }}'</span>
<span class="sd"> });</span>

<span class="sd"> markers[{{ loop.index0 }}] = new google.maps.Marker({</span>
<span class="sd"> position: new google.maps.LatLng({{ heat_point[2] }}, {{ heat_point[3] }}),</span>
<span class="sd"> title: '{{ heat_point[5] }}',</span>
<span class="sd"> icon: marker_icon,</span>
<span class="sd"> map: map</span>
<span class="sd"> });</span>

<span class="sd"> google.maps.event.addListener(markers[{{ loop.index0 }}], 'click', function() {</span>
<span class="sd"> var _map = marker_info_windows[{{ loop.index0 }}].getMap();</span>

<span class="sd"> if (_map !== null &amp;&amp; typeof _map !== "undefined") {</span>
<span class="sd"> marker_info_windows[{{ loop.index0 }}].close();</span>
<span class="sd"> } else {</span>
<span class="sd"> marker_info_windows[{{ loop.index0 }}].open(map, markers[{{ loop.index0 }}]);</span>
<span class="sd"> }</span>
<span class="sd"> });</span>
<span class="sd"> {% endfor %}</span>
<span class="sd"> })</span>
<span class="sd"> """</span>
    <span class="p">)</span>
    <span class="c"># Render the template and display it as Javascript</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="n">heat_points_javascript</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">heat_points</span><span class="o">=</span><span class="n">entries_df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(),</span>
        <span class="n">map_type</span><span class="o">=</span><span class="n">map_type</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span>
    <span class="p">)))</span>
</pre>
</div>
</div>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="n">i</span> <span class="o">=</span> <span class="n">interact</span><span class="p">(</span>
    <span class="n">display_heat_points_map</span><span class="p">,</span>
    <span class="n">latitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">31.4122599</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">90.0</span><span class="p">),</span>
    <span class="n">longitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Longitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">64.2010031</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span>
    <span class="n">map_type</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">DropdownWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Map Type"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'Road Map'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.ROADMAP'</span><span class="p">,</span>
        <span class="s">'Satellite'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.SATELLITE'</span><span class="p">,</span>
        <span class="s">'Hybrid'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.HYBRID'</span><span class="p">,</span>
        <span class="s">'Terrain'</span><span class="p">:</span> <span class="s">'google.maps.MapTypeId.TERRAIN'</span><span class="p">,</span>
    <span class="p">},</span> <span class="n">value</span><span class="o">=</span><span class="s">'google.maps.MapTypeId.SATELLITE'</span><span class="p">),</span>
    <span class="n">div</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">HTMLWidget</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">'&lt;div id="heat_points" style="width: 800px; height: 600px"&gt;&lt;/div&gt;'</span><span class="p">),</span>
<span class="p">)</span>
</pre>
</div>
</div>
<img src="/static/media/uploads/uploads/google_maps_fire_controls.png" alt="/static/media/uploads/uploads/google_maps_fire_controls.png"/> <img src="/static/media/uploads/uploads/google_maps_fire.png" alt="/static/media/uploads/uploads/google_maps_fire.png"/>
<p>Instead of using one of Google Map’s predefined marker icons, we’ve embedded our own encoding the image using Base64. Each data entry contains an HTML snippet that we’re going to show when the user clicks the marker’s icon. The following code contains a Jinja2 template that defines the required Javascript objects and iterates over the data entries to create the markers. Later we embed the rendered template so the map is displayed on the div above.</p>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="k">def</span> <span class="nf">display_heat_points_map_ol</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">div</span><span class="p">):</span>
    <span class="c"># Make the request and parse the response as XML using ElementTree</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://catalogos.conae.gov.ar/focos/focosdecalor.xml'</span><span class="p">)</span>
    <span class="n">response_atom</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

    <span class="c"># Build a DataFrame extrating the data for each entry using XPath</span>
    <span class="n">entries_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}id'</span><span class="p">)]</span>
    <span class="n">entries_title</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}title'</span><span class="p">)]</span>
    <span class="n">entries_updated</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}updated'</span><span class="p">)]</span>
    <span class="n">entries_summary</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.w3.org/2005/Atom}summary'</span><span class="p">)]</span>
    <span class="n">entries_point_lat</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.georss.org/georss}point'</span><span class="p">)]</span>
    <span class="n">entries_point_lon</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">response_atom</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.//{http://www.w3.org/2005/Atom}entry/{http://www.georss.org/georss}point'</span><span class="p">)]</span>

    <span class="n">entries_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s">'id'</span><span class="p">:</span> <span class="n">entries_id</span><span class="p">,</span>
        <span class="s">'title'</span><span class="p">:</span> <span class="n">entries_title</span><span class="p">,</span>
        <span class="s">'summary'</span><span class="p">:</span> <span class="n">entries_summary</span><span class="p">,</span>
        <span class="s">'lat'</span><span class="p">:</span> <span class="n">entries_point_lat</span><span class="p">,</span>
        <span class="s">'lon'</span><span class="p">:</span> <span class="n">entries_point_lon</span>
    <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">entries_updated</span><span class="p">)</span>

    <span class="c"># Define a Jinja2 template that creates the map, and iterates of the</span>
    <span class="c"># entries to create a marker with a custom icon for each of them.</span>
    <span class="n">heat_points_javascript</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span>
    <span class="sd">"""</span>
<span class="sd"> require(["open_layers"], function() {</span>
<span class="sd"> var map = new OpenLayers.Map('heat_points_ol', {});</span>
<span class="sd"> // var layer = new OpenLayers.Layer.WMS('OpenLayers WMS', 'http://vmap0.tiles.osgeo.org/wms/vmap0', {layers: 'basic'});</span>

<span class="sd"> var layer = new OpenLayers.Layer.WMS(</span>
<span class="sd"> 'Global Imagery',</span>
<span class="sd"> 'http://maps.opengeo.org/geowebcache/service/wms',</span>
<span class="sd"> {layers: 'bluemarble'},</span>
<span class="sd"> {isBaseLayer: true}</span>
<span class="sd"> );</span>

<span class="sd"> map.addLayer(layer);</span>
<span class="sd"> map.setCenter(</span>
<span class="sd"> new OpenLayers.LonLat({{ longitude }}, {{ latitude }}),</span>
<span class="sd"> {{ zoom }}</span>
<span class="sd"> );</span>

<span class="sd"> var heat_points_layer = new OpenLayers.Layer.Markers("Heat Points Layer");</span>

<span class="sd"> var machinalis_logo_icon_url = 'data:image/png;base64,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';</span>
<span class="sd"> var heat_point_icon_url = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAgCAYAAAD9oDOIAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH3gUcDQEVStH2UQAAArJJREFUSMet1UtoXGUUB/Dfdyc0j0JREmybSBaKL6ILxTRYXUQQFAQXlUIXpQWzUFS6Koi7SnFpNz6ouml9RKpI6SYUurGCzcKtglVQWm2h1Edt7CN1JsfF/XKbiZnMJOmB4c537rl//uf1/1ihxc1nEYwHA4tjipWCphKwH3/jUuL3sEYL9gUR7HcLwLqCqQwYwV2xBrD53+kgoihBbwXLL4OIFyqWPy8XX3TQ5f3Y5gAuVa/n1sKwN6jHdhHfiHikYlpfFdNsJwyqeT1TvwlVCwZiFemP4HFv4Gp29jaFjKVVMN3lXjy0wDPS9P7d5RZE0JO4vojpFUf0uXNB1/7Ec03fv5R4vxXT2eCzoJYB73aHPkOaJ3Ijnm/6fh//H9oi0w1cwLns32Jwibz+xYvorjybgo/TMjX9ERuDNzFguEXB1uMoeirPzmC0Fej9+fkaety2zFZswCdN3qNNoAvqsXV+BrGhGqNWNohD1WkoZ1iCZn3sxsO2VUGXnWkDOof7cKDyvBp0LUz/U+sVdlcBF5zvYI8bGMM4uSgHIUWZyDm78Qqexl+mccYxOwxoL3QNPFnJTH+RjzyaR+Y98BhO2ysn1MbW4eXqNF5gO7g9MxrGBNjjJx+ant+7Nky3VqcdKTiPzb7A5uzuw6RyAWfMOqZbfxvgelXb31JwDT0+z2OymMHX+BW72oB24wnManRlmRg0s0RgDU/l9Osd1LZs1MUicymXtGhRr04AL+dGM13gMLnrfWu4Hc9W/yYLnMB3ZvJ2pFUA9uIIyv5MFWikUt/P+iiL30qBv8VxgZHE1cUqNWUnfuhw6FOu495y6BO/xLygZLueeNYNEyZ87x1czKNSW0KF1+EUnnHKP+5JueGpzZ0/HHwQo/6It9yIk+px0lx8pRFvm40HHA8eXOo6+Q9fYtvU17HpOgAAAABJRU5ErkJggg==';</span>

<span class="sd"> var machinalis_logo_icon = new OpenLayers.Icon(machinalis_logo_icon_url, new OpenLayers.Size(30, 30));</span>
<span class="sd"> heat_points_layer.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(-64.2010031, -31.4122599), machinalis_logo_icon));</span>

<span class="sd"> var heat_point_icon = new OpenLayers.Icon(heat_point_icon_url, new OpenLayers.Size(21, 32));</span>

<span class="sd"> {% for heat_point in heat_points %}</span>
<span class="sd"> heat_points_layer.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat({{ heat_point[3] }}, {{ heat_point[2] }}), heat_point_icon.clone()));</span>
<span class="sd"> {% endfor %}</span>

<span class="sd"> map.addLayer(heat_points_layer);</span>
<span class="sd"> })</span>
<span class="sd"> """</span>
    <span class="p">)</span>
    <span class="c"># Render the template and display it as Javascript</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="n">heat_points_javascript</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">heat_points</span><span class="o">=</span><span class="n">entries_df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(),</span>
        <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span>
    <span class="p">)))</span>
</pre>
</div>
</div>
<div class="code python highlight-python">
<div class="highlight">
<pre><span class="n">i</span> <span class="o">=</span> <span class="n">interact</span><span class="p">(</span>
    <span class="n">display_heat_points_map_ol</span><span class="p">,</span>
    <span class="n">latitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Latitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">31.4122599</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">90.0</span><span class="p">),</span>
    <span class="n">longitude</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatTextWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Longitude'</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">64.2010031</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span>
    <span class="n">zoom</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSliderWidget</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'zoom'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">div</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">HTMLWidget</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">'&lt;div id="heat_points_ol" style="width: 800px; height: 600px"&gt;&lt;/div&gt;'</span><span class="p">),</span>
<span class="p">)</span>
</pre>
</div>
</div>
<img src="/static/media/uploads/uploads/openlayers_controls.png" alt="/static/media/uploads/uploads/openlayers_controls.png"/> <img src="/static/media/uploads/uploads/openlayers.png" alt="/static/media/uploads/uploads/openlayers.png"/></div>
<div class="section" id="conclusions">
<h2>Conclusions</h2>
<p>You’ll find a lot of interesting examples of using geolocated data on an IPython Notebook, but we wanted to show you how easy it is to turn them into an interactive experience using IPython Notebook. Both Basemap and Google Maps are great tools, but you can easily apply what we just showed you to integrate other javascript plotting libraries with geographical support like <a class="reference external" href="http://d3js.org/">d3js</a>.</p>
</div>
</section>


</div></body></html>