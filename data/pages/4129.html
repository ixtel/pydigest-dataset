<html><body><div><div class="post-text" itemprop="text">

<p>This is driving me totally nuts, I've been struggling with it for many hours. Any help would be much appreciated. </p>

<p>I'm using <a href="https://pypi.python.org/pypi/pyquery">PyQuery</a> 1.2.9 (which is built on top of <code>lxml</code>) to scrape <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term=The%20cost-effectiveness%20of%20mirtazapine%20versus%20paroxetine%20in%20treating%20people%20with%20depression%20in%20primary%20care">this URL</a>. I just want to get a list of all the links in the <code>.linkoutlist</code> section. </p>

<p>This is my request in full:</p>

<pre><code>response = requests.get('http://www.ncbi.nlm.nih.gov/pubmed/?term=The%20cost-effectiveness%20of%20mirtazapine%20versus%20paroxetine%20in%20treating%20people%20with%20depression%20in%20primary%20care')
doc = pq(response.content)
links = doc('#maincontent .linkoutlist a')
print links
</code></pre>

<p>But that returns an empty array. If I use this query instead:</p>

<pre><code>links = doc('#maincontent .linkoutlist')
</code></pre>

<p>Then I get this back this HTML:</p>

<pre><code>&lt;div xmlns="http://www.w3.org/1999/xhtml" xmlns:xi="http://www.w3.org/2001/XInclude" class="linkoutlist"&gt;
   &lt;h4&gt;Full Text Sources&lt;/h4&gt;
   &lt;ul&gt;
      &lt;li&gt;&lt;a title="Full text at publisher's site" href="http://meta.wkhealth.com/pt/pt-core/template-journal/lwwgateway/media/landingpage.htm?issn=0268-1315&amp;amp;volume=19&amp;amp;issue=3&amp;amp;spage=125" ref="itool=Abstract&amp;amp;PrId=3159&amp;amp;uid=15107654&amp;amp;db=pubmed&amp;amp;log$=linkoutlink&amp;amp;nlmid=8609061" target="_blank"&gt;Lippincott Williams &amp;amp; Wilkins&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href="http://ovidsp.ovid.com/ovidweb.cgi?T=JS&amp;amp;PAGE=linkout&amp;amp;SEARCH=15107654.ui" ref="itool=Abstract&amp;amp;PrId=3682&amp;amp;uid=15107654&amp;amp;db=pubmed&amp;amp;log$=linkoutlink&amp;amp;nlmid=8609061" target="_blank"&gt;Ovid Technologies, Inc.&lt;/a&gt;&lt;/li&gt;
   &lt;/ul&gt;
   &lt;h4&gt;Other Literature Sources&lt;/h4&gt;
   ...
&lt;/div&gt;
</code></pre>

<p>So the parent selectors do return HTML with lots of <code>&lt;a&gt;</code> tags. This also appears to be valid HTML. </p>

<p>More experimenting reveals that lxml does not like the <code>xmlns</code> attribute on the opening div, for some reason. </p>

<p>How can I ignore this in lxml, and just parse it like regular HTML?</p>

<p><strong>UPDATE</strong>: Trying <code>ns_clean</code>, still failing:</p>

<pre><code>    parser = etree.XMLParser(ns_clean=True)
    tree = etree.parse(StringIO(response.content), parser)
    sel = CSSSelector('#maincontent .rprt_all a')
    print sel(tree)
</code></pre>
    </div>
    </div></body></html>