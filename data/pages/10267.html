<html><body><div><div id="installation">
<h2>Installation</h2>
<p>Python package:</p>
<pre>pip install django-auth-adfs
</pre>
<p>In your project’s <tt>settings.py</tt></p>
<pre><span class="n">AUTHENTICATION_BACKENDS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="s1">'django_auth_adfs.backend.AdfsBackend'</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="c1"># Needed for the ADFS redirect URI to function</span>
    <span class="s1">'django_auth_adfs'</span><span class="p">,</span>
    <span class="o">...</span>

<span class="c1"># checkout config.py for more settings</span>
<span class="n">AUTH_ADFS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"ADFS_SERVER"</span><span class="p">:</span> <span class="s2">"adfs.yourcompany.com"</span><span class="p">,</span>
    <span class="s2">"ADFS_CLIENT_ID"</span><span class="p">:</span> <span class="s2">"your-configured-client-id"</span><span class="p">,</span>
    <span class="s2">"ADFS_RESOURCE"</span><span class="p">:</span> <span class="s2">"your-adfs-RPT-name"</span><span class="p">,</span>
    <span class="s2">"ADFS_SIGNING_CERT"</span><span class="p">:</span> <span class="s2">"/path/to/adfs-signing-certificate.pem"</span><span class="p">,</span>
    <span class="c1"># Make sure to read the documentation about the ADFS_AUDIENCE setting</span>
    <span class="c1"># when you configured the identifier as a URL!</span>
    <span class="s2">"ADFS_AUDIENCE"</span><span class="p">:</span> <span class="s2">"microsoft:identityserver:your-RelyingPartyTrust-identifier"</span><span class="p">,</span>
    <span class="s2">"ADFS_ISSUER"</span><span class="p">:</span> <span class="s2">"http://adfs.yourcompany.com/adfs/services/trust"</span><span class="p">,</span>
    <span class="s2">"ADFS_CA_BUNDLE"</span><span class="p">:</span> <span class="s2">"/path/to/ca-bundle.pem"</span><span class="p">,</span>
    <span class="s2">"ADFS_CLAIM_MAPPING"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"given_name"</span><span class="p">,</span>
                           <span class="s2">"last_name"</span><span class="p">:</span> <span class="s2">"family_name"</span><span class="p">,</span>
                           <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"email"</span><span class="p">},</span>
    <span class="s2">"ADFS_REDIR_URI"</span><span class="p">:</span> <span class="s2">"https://www.yourcompany.com/oauth2/login"</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">########################</span>
<span class="c1"># OPTIONAL SETTINGS</span>
<span class="c1">########################</span>
<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="o">...</span>
        <span class="s1">'OPTIONS'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'context_processors'</span><span class="p">:</span> <span class="p">[</span>
                <span class="c1"># Only needed if you want to use the variable ADFS_AUTH_URL in your templates</span>
                <span class="s1">'django_auth_adfs.context_processors.adfs_url'</span><span class="p">,</span>
                <span class="o">...</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>


<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="c1"># With this you can force a user to login without using</span>
    <span class="c1"># the @login_required decorator for every view function</span>
    <span class="c1">#</span>
    <span class="c1"># You can specify URLs for which login is not forced by</span>
    <span class="c1"># specifying them in LOGIN_EXEMPT_URLS in setting.py.</span>
    <span class="c1"># The values in LOGIN_EXEMPT_URLS are interpreted as regular expressions.</span>
    <span class="s1">'django_auth_adfs.middleware.LoginRequiredMiddleware'</span><span class="p">,</span>
<span class="p">)</span>
</pre>
<p>In your project’s <tt>urls.py</tt></p>
<pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="c1"># Needed for the redirect URL to function</span>
    <span class="c1"># The namespace is important and shouldn't be changed</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">r'^oauth2/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'django_auth_adfs.urls'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">'auth_adfs'</span><span class="p">)),</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre>
<p>The URL you have to configure as the redirect URL in ADFS depends on the url pattern you configure.
In the example above you have to make the redirect url in ADFS point to <tt><span class="pre">https://yoursite.com/oauth2/login</span></tt></p>
</div>
</div></body></html>