<html><body><div><div class="postsum"><header><h1>Example parsing XML with lxml.objectify</h1></header><p>Example run with <a href="http://lxml.de/">lxml</a> 2.3, <a href="http://www.python.org/">Python</a> 2.6.6 on <a href="http://www.ubuntu.com/">Ubuntu</a> 10.10</p><div class="python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">objectify</span><span class="p">,</span> <span class="n">etree</span>

<span class="n">xml</span> <span class="o">=</span> <span class="s">'''</span>
<span class="s">&lt;dataset&gt;</span>
<span class="s">  &lt;statusthing&gt;success&lt;/statusthing&gt;</span>
<span class="s">  &lt;datathing gabble="sent"&gt;joe@email.com&lt;/datathing&gt;</span>
<span class="s">  &lt;datathing gabble="not sent"&gt;&lt;/datathing&gt;</span>
<span class="s">&lt;/dataset&gt;</span>
<span class="s">'''</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">objectify</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>

<span class="k">print</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span>
<span class="k">print</span> <span class="n">root</span><span class="o">.</span><span class="n">text</span>
<span class="k">print</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span>
<span class="c"># dataset</span>
<span class="c"># None</span>
<span class="c"># {}</span>

<span class="k">print</span> <span class="n">root</span><span class="o">.</span><span class="n">statusthing</span><span class="o">.</span><span class="n">tag</span>
<span class="k">print</span> <span class="n">root</span><span class="o">.</span><span class="n">statusthing</span><span class="o">.</span><span class="n">text</span>
<span class="k">print</span> <span class="n">root</span><span class="o">.</span><span class="n">statusthing</span><span class="o">.</span><span class="n">attrib</span>
<span class="c"># statusthing</span>
<span class="c"># success</span>
<span class="c"># {}</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">datathing</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span>
    <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">text</span>
    <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">attrib</span>
    <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">'gabble'</span><span class="p">]</span>
<span class="c"># datathing</span>
<span class="c"># joe@email.com</span>
<span class="c"># {'gabble': 'sent'}</span>
<span class="c"># sent</span>
<span class="c"># datathing</span>
<span class="c"># None</span>
<span class="c"># {'gabble': 'not sent'}</span>
<span class="c"># not sent</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span>
<span class="c"># statusthing</span>
<span class="c"># datathing</span>
<span class="c"># datathing</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span>
<span class="c"># statusthing</span>
<span class="c"># datathing</span>
<span class="c"># datathing</span>

<span class="c"># you cannot modify the text attribute of an element.</span>
<span class="c"># instead just assign to the element itself.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">root</span><span class="o">.</span><span class="n">statusthing</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">'failure'</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">traceback</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
<span class="c"># Traceback (most recent call last):</span>
<span class="c">#   File "lxml_ex.py", line 54, in &lt;module&gt;</span>
<span class="c">#     root.statusthing.text = 'failure'</span>
<span class="c">#   File "lxml.objectify.pyx", line 237, in lxml.objectify.ObjectifiedElement.__setattr__ (src/lxml/lxml.objectify.c:2980)</span>
<span class="c"># TypeError: attribute 'text' of 'StringElement' objects is not writable</span>

<span class="c"># modify element text and write it out as xml again</span>
<span class="n">root</span><span class="o">.</span><span class="n">statusthing</span> <span class="o">=</span> <span class="s">'failure'</span>
<span class="n">xml_new</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span> <span class="n">xml_new</span>
<span class="c"># &lt;dataset&gt;</span>
<span class="c">#   &lt;statusthing xmlns:py="http://codespeak.net/lxml/objectify/pytype" py:pytype="str"&gt;failure&lt;/statusthing&gt;</span>
<span class="c">#   &lt;datathing gabble="sent"&gt;joe@email.com&lt;/datathing&gt;</span>
<span class="c">#   &lt;datathing gabble="not sent"&gt;</span>
<span class="c"># &lt;/datathing&gt;&lt;/dataset&gt;</span>

<span class="c"># Use deannotate() to get rid of 'py:pytype' information</span>
<span class="n">objectify</span><span class="o">.</span><span class="n">deannotate</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">cleanup_namespaces</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">xml_new</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span> <span class="n">xml_new</span>
<span class="c"># &lt;dataset&gt;</span>
<span class="c">#   &lt;statusthing&gt;failure&lt;/statusthing&gt;</span>
<span class="c">#   &lt;datathing gabble="sent"&gt;joe@email.com&lt;/datathing&gt;</span>
<span class="c">#   &lt;datathing gabble="not sent"&gt;</span>
<span class="c"># &lt;/datathing&gt;&lt;/dataset&gt;</span>

<span class="c"># Add a child element to the root</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s">"thisdoesntmatter"</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s">"thisdoesntmattereither"</span>
<span class="n">c</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"mytext"</span>
<span class="n">c</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">'myattr'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'myvalue'</span>
<span class="n">root</span><span class="o">.</span><span class="n">newchild</span> <span class="o">=</span> <span class="n">c</span>
<span class="n">objectify</span><span class="o">.</span><span class="n">deannotate</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">cleanup_namespaces</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">xml_new</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span> <span class="n">xml_new</span>
<span class="c"># &lt;dataset&gt;</span>
<span class="c">#   &lt;statusthing&gt;failure&lt;/statusthing&gt;</span>
<span class="c">#   &lt;datathing gabble="sent"&gt;joe@email.com&lt;/datathing&gt;</span>
<span class="c">#   &lt;datathing gabble="not sent"&gt;</span>
<span class="c">#   &lt;newchild myattr="myvalue"&gt;mytext&lt;/newchild&gt;</span>
<span class="c"># &lt;/datathing&gt;&lt;/dataset&gt;&lt;/module&gt;</span>
</pre></div></div><h4 id="references">References:<a class="sectionlink" href="#references" title="Section permalink">Â¶</a></h4></div></div></body></html>