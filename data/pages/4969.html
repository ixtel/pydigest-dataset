<html><body><div><div class="post-body entry-content" id="post-body-8143007374752482637">
<div dir="ltr" trbidi="on"><p>
This gem was posted in the </p><a href="https://github.com/isagalaev/ijson/issues/35" target="_blank">ijson issue tracker</a><p> after some discussion on #pypy, and Dav1dde kindly allowed us to repost it here:

</p><span>"</span><p>So, I was playing around with parsing huge JSON files (19GiB, testfile is ~520MiB) and wanted to try a sample code with PyPy, turns out, PyPy needed ~1:30-2:00 whereas CPython 2.7 needed ~13 seconds (the pure python implementation on both pythons was equivalent at ~8 minutes). </p><p>"Apparantly ctypes is really bad performance-wise, especially on PyPy. So I made a quick </p><a href="https://pypi.python.org/pypi/cffi">CFFI</a><p> mockup: </p><a href="https://gist.github.com/Dav1dde/c509d472085f9374fc1d">https://gist.github.com/Dav1dde/c509d472085f9374fc1d</a>
<p>
Before:
</p><p>CPython 2.7: </p><span>    python -m emfas.server size dumps/echoprint-dump-1.json <br/>    11.89s user 0.36s system 98% cpu 12.390 total </span><p>
PYPY: </p><span>    python -m emfas.server size dumps/echoprint-dump-1.json <br/>    117.19s user 2.36s system 99% cpu 1:59.95 total </span><p>
After (CFFI):</p><p> CPython 2.7: </p><span>     python jsonsize.py ../dumps/echoprint-dump-1.json<br/>      8.63s user 0.28s system 99% cpu 8.945 total </span><p>
PyPy: </p><span>     python jsonsize.py ../dumps/echoprint-dump-1.json <br/>     4.04s user 0.34s system 99% cpu 4.392 total
</span><p>"
</p><p>
<br/></p>
<p>Dav1dd goes into more detail in the issue itself, but we just want to emphasize a few significant points from this brief interchange:
</p><ul>
<li>His CFFI implementation is faster than the ctypes one even on CPython 2.7.</li>
<li>PyPy + CFFI is faster than CPython even when using C code to do the heavy parsing.</li>
</ul><p>
 The PyPy Team </p>
</div>
<p/>
</div>
</div></body></html>