<html><body><div><div class="section">
              <h1>httpretty 0.8.14</h1>

              


<p>HTTP client mock for Python</p><p>








HTTPretty 0.8.3</p><p>===============</p><p>|https://s3-us-west-2.amazonaws.com/s.cdpn.io/18885/httpretty-logo_1.svg|</p><p>|tip for next commit| |Build Status| `ChangeLog &lt;news.md&gt;`__</p><p>Installing</p><p>==========</p><p>Since you are interested in HTTPretty you should also be interested in</p><p>speeding up your build. Replace ``pip`` with</p><p>`curdling &lt;http: clarete.github.io="" curdling=""/&gt;`__ and see your build</p><p>running a lot faster.</p><p>You can use curdling to install not only HTTPretty but every dependency</p><p>in your project and see the speed gains.</p><p>.. code:: bash</p><p>    $ easy_install curdling</p><p>    $ curd install HTTPretty</p><p>In a nutshell</p><p>=============</p><p>Once upon a time a python developer wanted to use a RESTful api,</p><p>everything was fine but until the day they needed to test the code that</p><p>hits the RESTful API: what if the API server is down? What if its</p><p>content has changed ?</p><p>Don't worry, HTTPretty is here for you:</p><p>.. code:: python</p><p>    import requests</p><p>    from sure import expect</p><p>    import httpretty</p><p>    @httpretty.activate</p><p>    def test_yipit_api_returning_deals():</p><p>        httpretty.register_uri(httpretty.GET, "http://api.yipit.com/v1/deals/",</p><p>                               body='[{"title": "Test Deal"}]',</p><p>                               content_type="application/json")</p><p>        response = requests.get('http://api.yipit.com/v1/deals/')</p><p>        expect(response.json()).to.equal([{"title": "Test Deal"}])</p><p>A more technical description</p><p>============================</p><p>HTTPretty is a HTTP client mock library for Python 100% inspired on</p><p>ruby's `FakeWeb &lt;http: fakeweb.rubyforge.org=""/&gt;`__. If you come from</p><p>ruby this would probably sound familiar :)</p><p>Usage</p><p>=====</p><p>expecting a simple response body</p><p>--------------------------------</p><p>.. code:: python</p><p>    import requests</p><p>    import httpretty</p><p>    def test_one():</p><p>        httpretty.enable()  # enable HTTPretty so that it will monkey patch the socket module</p><p>        httpretty.register_uri(httpretty.GET, "http://yipit.com/",</p><p>                               body="Find the best daily deals")</p><p>        response = requests.get('http://yipit.com')</p><p>        assert response.text == "Find the best daily deals"</p><p>        httpretty.disable()  # disable afterwards, so that you will have no problems in code that uses that socket module</p><p>        httpretty.reset()    # reset HTTPretty state (clean up registered urls and request history)</p><p>testing query strings</p><p>---------------------</p><p>.. code:: python</p><p>    import requests</p><p>    from sure import expect</p><p>    import httpretty</p><p>    def test_one():</p><p>        httpretty.enable()  # enable HTTPretty so that it will monkey patch the socket module</p><p>        httpretty.register_uri(httpretty.GET, "http://yipit.com/login",</p><p>                               body="Find the best daily deals")</p><p>        requests.get('http://yipit.com/login?email=user@github.com&amp;password=foobar123')</p><p>        expect(httpretty.last_request()).to.have.property("querystring").being.equal({</p><p>            "email": "user@github.com",</p><p>            "password": "foobar123",</p><p>        })</p><p>        httpretty.disable()  # disable afterwards, so that you will have no problems in code that uses that socket module</p><p>ohhhh, really? can that be easier?</p><p>----------------------------------</p><p>**YES** we've got a decorator</p><p>.. code:: python</p><p>    import requests</p><p>    import httpretty</p><p>    @httpretty.activate</p><p>    def test_one():</p><p>        httpretty.register_uri(httpretty.GET, "http://yipit.com/",</p><p>                               body="Find the best daily deals")</p><p>        response = requests.get('http://yipit.com')</p><p>        assert response.text == "Find the best daily deals"</p><p>the ``@httpretty.activate`` is a short-hand decorator that wraps the</p><p>decorated function with httpretty.enable() and then calls</p><p>httpretty.disable() right after.</p><p>mocking the status code</p><p>-----------------------</p><p>.. code:: python</p><p>    import requests</p><p>    from sure import expect</p><p>    import httpretty</p><p>    @httpretty.activate</p><p>    def test_github_access():</p><p>        httpretty.register_uri(httpretty.GET, "http://github.com/",</p><p>                               body="here is the mocked body",</p><p>                               status=201)</p><p>        response = requests.get('http://github.com')</p><p>        expect(response.status_code).to.equal(201)</p><p>you can tell HTTPretty to return any HTTP headers you want</p><p>----------------------------------------------------------</p><p>**and all you need is to add keyword args in which the keys are always</p><p>lower-cased and with underscores ``_`` instead of dashes ``-``**</p><p>For example, let's say you want to mock that server returns</p><p>``content-type``. To do so, use the argument ``content_type``, **all the</p><p>keyword args are taken by HTTPretty and transformed in the RFC2616</p><p>equivalent name**.</p><p>.. code:: python</p><p>    @httpretty.activate</p><p>    def test_some_api():</p><p>        httpretty.register_uri(httpretty.GET, "http://foo-api.com/gabrielfalcao",</p><p>                               body='{"success": false}',</p><p>                               status=500,</p><p>                               content_type='text/json')</p><p>        response = requests.get('http://foo-api.com/gabrielfalcao')</p><p>        expect(response.json()).to.equal({'success': False})</p><p>        expect(response.status_code).to.equal(500)</p><p>Adding extra headers and forcing headers</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>You can pass the ``adding_headers`` argument as a dictionary and your</p><p>headers will be</p><p>`united &lt;http: en.wikipedia.org="" wiki="" union_(set_theory)=""&gt;`__ to the</p><p>existing headers.</p><p>.. code:: python</p><p>    @httpretty.activate</p><p>    def test_some_api():</p><p>        httpretty.register_uri(httpretty.GET, "http://foo-api.com/gabrielfalcao",</p><p>                               body='{"success": false}',</p><p>                               status=500,</p><p>                               content_type='text/json',</p><p>                               adding_headers={</p><p>                                   'X-foo': 'bar'</p><p>                               })</p><p>        response = requests.get('http://foo-api.com/gabrielfalcao')</p><p>        expect(response.json()).to.equal({'success': False})</p><p>        expect(response.status_code).to.equal(500)</p><p>Although there are some situation where some headers line</p><p>``content-length`` will be calculated by HTTPretty based on the</p><p>specified fake response body.</p><p>So you might want to *"force"* those headers:</p><p>.. code:: python</p><p>    @httpretty.activate</p><p>    def test_some_api():</p><p>        httpretty.register_uri(httpretty.GET, "http://foo-api.com/gabrielfalcao",</p><p>                               body='{"success": false}',</p><p>                               status=500,</p><p>                               content_type='text/json',</p><p>                               forcing_headers={</p><p>                                   'content-length': '100'</p><p>                               })</p><p>        response = requests.get('http://foo-api.com/gabrielfalcao')</p><p>        expect(response.json()).to.equal({'success': False})</p><p>        expect(response.status_code).to.equal(500)</p><p>You should, though, be careful with it. The HTTP client is likely to</p><p>rely on the content length to know how many bytes of response payload</p><p>should be loaded. Forcing a ``content-length`` that is bigger than the</p><p>action response body might cause the HTTP client to hang because it is</p><p>waiting for data. Read more in the "caveats" session on the bottom.</p><p>rotating responses</p><p>------------------</p><p>Same URL, same request method, the first request return the first</p><p>httpretty.Response, all the subsequent ones return the last (status</p><p>202).</p><p>Notice that the ``responses`` argument is a list and you can pass as</p><p>many responses as you want.</p><p>.. code:: python</p><p>    import requests</p><p>    from sure import expect</p><p>    @httpretty.activate</p><p>    def test_rotating_responses():</p><p>        httpretty.register_uri(httpretty.GET, "http://github.com/gabrielfalcao/httpretty",</p><p>                               responses=[</p><p>                                   httpretty.Response(body="first response", status=201),</p><p>                                   httpretty.Response(body='second and last response', status=202),</p><p>                                ])</p><p>        response1 = requests.get('http://github.com/gabrielfalcao/httpretty')</p><p>        expect(response1.status_code).to.equal(201)</p><p>        expect(response1.text).to.equal('first response')</p><p>        response2 = requests.get('http://github.com/gabrielfalcao/httpretty')</p><p>        expect(response2.status_code).to.equal(202)</p><p>        expect(response2.text).to.equal('second and last response')</p><p>        response3 = requests.get('http://github.com/gabrielfalcao/httpretty')</p><p>        expect(response3.status_code).to.equal(202)</p><p>        expect(response3.text).to.equal('second and last response')</p><p>streaming responses</p><p>-------------------</p><p>Mock a streaming response by registering a generator response body.</p><p>.. code:: python</p><p>    import requests</p><p>    from sure import expect</p><p>    import httpretty</p><p>    # mock a streaming response body with a generator</p><p>    def mock_streaming_tweets(tweets):</p><p>        from time import sleep</p><p>        for t in tweets:</p><p>            sleep(.5)</p><p>            yield t</p><p>    @httpretty.activate</p><p>    def test_twitter_api_integration(now):</p><p>        twitter_response_lines = [</p><p>            '{"text":"If @BarackObama requests to follow me one more time I\'m calling the police."}\r\n',</p><p>            '\r\n',</p><p>            '{"text":"Thanks for all your #FollowMe1D requests Directioners! We\u2019ll be following 10 people throughout the day starting NOW. G ..."}\r\n'</p><p>        ]</p><p>        TWITTER_STREAMING_URL = "https://stream.twitter.com/1/statuses/filter.json"</p><p>        # set the body to a generator and set `streaming=True` to mock a streaming response body</p><p>        httpretty.register_uri(httpretty.POST, TWITTER_STREAMING_URL,</p><p>                               body=mock_streaming_tweets(twitter_response_lines),</p><p>                               streaming=True)</p><p>        # taken from the requests docs</p><p>        # http://docs.python-requests.org/en/latest/user/advanced/#streaming-requests</p><p>        response = requests.post(TWITTER_STREAMING_URL, data={'track':'requests'},</p><p>                                auth=('username','password'), prefetch=False)</p><p>        #test iterating by line</p><p>        line_iter = response.iter_lines()</p><p>        for i in xrange(len(twitter_response_lines)):</p><p>            expect(line_iter.next().strip()).to.equal(twitter_response_lines[i].strip())</p><p>dynamic responses through callbacks</p><p>-----------------------------------</p><p>Set a callback to allow for dynamic responses based on the request.</p><p>.. code:: python</p><p>    import requests</p><p>    from sure import expect</p><p>    import httpretty</p><p>    @httpretty.activate</p><p>    def test_response_callbacks():</p><p>        def request_callback(request, uri, headers):</p><p>            return (200, headers, "The {} response from {}".format(request.method, uri))</p><p>        httpretty.register_uri(</p><p>            httpretty.GET, "https://api.yahoo.com/test",</p><p>            body=request_callback)</p><p>        response = requests.get('https://api.yahoo.com/test')</p><p>        expect(response.text).to.equal('The GET response from https://api.yahoo.com/test')</p><p>Dynamic responses can also be used when you have to work with badly</p><p>designed APIs where, for example, the same uri and method are used to</p><p>handle different requests based on request body which contains xml.</p><p>.. code:: python</p><p>    import requests</p><p>    import httpretty</p><p>    @httpretty.activate</p><p>    def test_response_callbacks():</p><p>        def request_callback(request, uri, headers):</p><p>            # parse_xml() extracts important data from request</p><p>            data = parse_xml(request.body)</p><p>            # response based on that data</p><p>            if data.something_important:</p><p>                return (200, headers, "relevant data")</p><p>            else:</p><p>                return (400, headers, "panic mode!")</p><p>        httpretty.register_uri(</p><p>            httpretty.GET, "https://api.brilliant-api.com/",</p><p>            body=request_callback)</p><p>        response = requests.get('https://api.brilliant-api.com/')</p><p>matching regular expressions</p><p>----------------------------</p><p>You can register a `compiled</p><p>regex &lt;http: docs.python.org="" 2="" library="" re.html#re.compile=""&gt;`__ and it</p><p>will be matched against the requested urls.</p><p>.. code:: python</p><p>    @httpretty.activate</p><p>    def test_httpretty_should_allow_registering_regexes():</p><p>        u"HTTPretty should allow registering regexes"</p><p>        httpretty.register_uri(</p><p>            httpretty.GET,</p><p>            re.compile("api.yipit.com/v2/deal;brand=(\w+)"),</p><p>            body="Found brand",</p><p>        )</p><p>        response = requests.get('https://api.yipit.com/v2/deal;brand=GAP')</p><p>        expect(response.text).to.equal('Found brand')</p><p>        expect(httpretty.last_request().method).to.equal('GET')</p><p>        expect(httpretty.last_request().path).to.equal('/v1/deal;brand=GAP')</p><p>By default, the regexp you register will match the requests without</p><p>looking at the querystring. If you want the querystring to be</p><p>considered, you can set ``match_querystring=True`` when calling</p><p>``register_uri``.</p><p>expect for a response, and check the request got by the "server" to make sure it was fine.</p><p>------------------------------------------------------------------------------------------</p><p>.. code:: python</p><p>    import requests</p><p>    from sure import expect</p><p>    import httpretty</p><p>    @httpretty.activate</p><p>    def test_yipit_api_integration():</p><p>        httpretty.register_uri(httpretty.POST, "http://api.yipit.com/foo/",</p><p>                               body='{"repositories": ["HTTPretty", "lettuce"]}')</p><p>        response = requests.post('http://api.yipit.com/foo'</p><p>                                '{"username": "gabrielfalcao"}',</p><p>                                headers={</p><p>                                    'content-type': 'text/json',</p><p>                                })</p><p>        expect(response.text).to.equal('{"repositories": ["HTTPretty", "lettuce"]}')</p><p>        expect(httpretty.last_request().method).to.equal("POST")</p><p>        expect(httpretty.last_request().headers['content-type']).to.equal('text/json')</p><p>checking whether a request was made or not</p><p>------------------------------------------</p><p>.. code:: python</p><p>    import httpretty</p><p>    import requests</p><p>    def order_pizza(user, home_delivery=True):</p><p>        check_number = make_pizza()</p><p>        if home_delivery:</p><p>            requests.post('http://api.pizzas.com/deliveries/' {'address': user.address, 'check_number': check_number})</p><p>        else:</p><p>            # for pick up.</p><p>            pass</p><p>        return check_number</p><p>    @httpretty.activate</p><p>    def test_pizza_delivery():</p><p>        httpretty.register_uri(httpretty.POST, 'http://api.pizzas.com/deliveries/' body='OK')</p><p>        order_pizza(some_user)</p><p>        expect(httpretty.has_request()).to.be.true</p><p>        httpretty.reset()</p><p>        order_pizza(some_user, home_delivery=False)</p><p>        expect(httpretty.has_request()).to.be.false</p><p>checking if is enabled</p><p>----------------------</p><p>.. code:: python</p><p>    httpretty.enable()</p><p>    httpretty.is_enabled().should.be.true</p><p>    httpretty.disable()</p><p>    httpretty.is_enabled().should.be.false</p><p>raising an error if an unregistered endpoint is requested</p><p>---------------------------------------------------------</p><p>.. code:: python</p><p>    import urllib2</p><p>    import httpretty</p><p>    httpretty.enable()</p><p>    httpretty.HTTPretty.allow_net_connect = False</p><p>    httpretty.register_uri(httpretty.GET, 'http://www.google.com', body='OK')</p><p>    urllib2.urlopen('http://www.google.com')</p><p>    urllib2.urlopen('http://www.reddit.com') # raises httpretty.errors.UnmockedError</p><p>Motivation</p><p>==========</p><p>When building systems that access external resources such as RESTful</p><p>webservices, XMLRPC or even simple HTTP requests, we stumble in the</p><p>problem:</p><p>::</p><p>    "I'm gonna need to mock all those requests"</p><p>It brings a lot of hassle, you will need to use a generic mocking tool,</p><p>mess with scope and so on.</p><p>The idea behind HTTPretty (how it works)</p><p>----------------------------------------</p><p>HTTPretty `monkey patches &lt;http: en.wikipedia.org="" wiki="" monkey_patch=""&gt;`__</p><p>Python's `socket &lt;http: docs.python.org="" library="" socket.html=""&gt;`__ core</p><p>module, reimplementing the HTTP protocol, by mocking requests and</p><p>responses.</p><p>As for it works in this way, you don't need to worry what http library</p><p>you're gonna use.</p><p>HTTPretty will mock the response for you :) *(and also give you the</p><p>latest requests so that you can check them)*</p><p>Acknowledgements</p><p>================</p><p>caveats with the `requests &lt;http: docs.python-requests.org="" en="" latest=""/&gt;`__ library</p><p>----------------------------------------------------------------------------------</p><p>``forcing_headers`` + ``Content-Length``</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>if you use the ``forcing_headers`` options make sure to add the header</p><p>``Content-Length`` otherwise the</p><p>`requests &lt;http: docs.python-requests.org="" en="" latest=""/&gt;`__ will try to</p><p>load the response endlessly</p><p>Officially supported libraries</p><p>==============================</p><p>Because HTTPretty works in the socket level it should work with any HTTP</p><p>client libraries, although it is `battle</p><p>tested &lt;https: github.com="" gabrielfalcao="" httpretty="" tree="" master="" tests="" functional=""&gt;`__</p><p>against:</p><p>-  `requests &lt;http: docs.python-requests.org="" en="" latest=""/&gt;`__</p><p>-  `httplib2 &lt;http: code.google.com="" p="" httplib2=""/&gt;`__</p><p>-  `urllib2 &lt;http: docs.python.org="" 2="" library="" urllib2.html=""&gt;`__</p><p>Hacking on HTTPretty</p><p>====================</p><p>create a virtual env</p><p>--------------------</p><p>you will need</p><p>`virtualenvwrapper &lt;http: www.doughellmann.com="" projects="" virtualenvwrapper=""/&gt;`__</p><p>.. code:: console</p><p>    mkvirtualenv --distribute --no-site-packages HTTPretty</p><p>install the dependencies</p><p>------------------------</p><p>.. code:: console</p><p>    pip install -r requirements.txt</p><p>next steps:</p><p>-----------</p><p>1. run the tests with make:</p><p>   .. code:: bash</p><p>       make unit functional</p><p>2. hack at will</p><p>3. commit, push etc</p><p>4. send a pull request</p><p>License</p><p>=======</p><p>::</p><p>    &lt;httpretty -="" http="" client="" mock="" for="" python=""&gt;</p><p>    Copyright (C) &lt;2011-2015&gt;  Gabriel Falcão &lt;gabriel@nacaolivre.org&gt;</p><p>    Permission is hereby granted, free of charge, to any person</p><p>    obtaining a copy of this software and associated documentation</p><p>    files (the "Software"), to deal in the Software without</p><p>    restriction, including without limitation the rights to use,</p><p>    copy, modify, merge, publish, distribute, sublicense, and/or sell</p><p>    copies of the Software, and to permit persons to whom the</p><p>    Software is furnished to do so, subject to the following</p><p>    conditions:</p><p>    The above copyright notice and this permission notice shall be</p><p>    included in all copies or substantial portions of the Software.</p><p>    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,</p><p>    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES</p><p>    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</p><p>    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT</p><p>    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,</p><p>    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</p><p>    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</p><p>    OTHER DEALINGS IN THE SOFTWARE.</p><p>Main contributors</p><p>=================</p><p>There folks made remarkable contributions to HTTPretty:</p><p>-  Steve Pulec ~&gt; @spulec</p><p>-  Hugh Saunders ~&gt; @hughsaunders</p><p>-  Matt Luongo ~&gt; @mhluongo</p><p>-  James Rowe ~&gt; @JNRowe</p><p>.. |https://s3-us-west-2.amazonaws.com/s.cdpn.io/18885/httpretty-logo_1.svg| image:: https://s3-us-west-2.amazonaws.com/s.cdpn.io/18885/httpretty-logo_1.svg</p><p>.. |tip for next commit| image:: http://tip4commit.com/projects/133.svg</p><p>   :target: http://tip4commit.com/projects/133</p><p>.. |Build Status| image:: https://travis-ci.org/gabrielfalcao/HTTPretty.png?branch=master</p><p>   :target: https://travis-ci.org/gabrielfalcao/HTTPretty

</p><a name="downloads"> </a>


<ul class="nodot">
  <li><strong>Downloads (All Versions):</strong></li>
  <li>
    <span>0</span> downloads in the last day
  </li>
  <li>
    <span>15679</span> downloads in the last week
  </li>
  <li>
    <span>116708</span> downloads in the last month
  </li>
</ul>









            </div>


          </div></body></html>