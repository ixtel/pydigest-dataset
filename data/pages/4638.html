<html><body><div><div class="content html_format"><p>
      Около года назад я поучаствовал в конкурсе </p><a href="http://kivy.org/#contest">Kivy App Contest 2014</a><p>. Игрушка заняла одно из призовых мест (номинация «лучшая идея») и ко мне неоднократно обращались с просьбой выложить её на маркет. Я долго откладывал, но позавчера наконец созрел и потратив вечер — выложил. Оказалось всё совсем просто и я решил написать эту инструкцию для тех, кто, как и я, пишет на киви «в стол». Ну или тех, кто пишет на Питоне и не в курсе, что на нём можно легко писать андроидные приложения и даже выкладывать их в маркете. Инструкция рассчитана на таких же как я полнейших чайников в разработке под Android. Профессионалам можно здесь прекратить чтение, а можно поправить/дополнить в комментариях.
</p><a name="habracut"/><p>
Для начала пара слов для тех, кто на киви (пока, это не надолго) не пишет. Киви — это очень удобный фреймворк, позволяющий на чистом Питоне писать приложения и компилировать их для Linux, Windows, OS X, Android и iOS практически не меняя код. 
</p><a href="http://kivy.org/#home">Сайт фреймворка.</a> 
<a href="http://inclem.net/pages/kivy-crash-course/">Хороший видеокурс для начинающих и продолжающих</a>
<a href="https://github.com/kivy/kivy/wiki/List-of-Kivy-Projects">Список проектов написанных на киви</a>
<p>
Итак, у вас есть приложение на киви, оно прекрасно работает на PC и теперь вы хотите выложить её на Play Store. Что для этого нужно?
</p><p>
Для начала — убедиться, что на андроиде оно работает не менее прекрасно. Проверить это есть два способа. </p><p>
Первый из них — установить на устройстве приложение </p><a href="https://play.google.com/store/apps/details?id=org.kivy.pygame">Kivy Launcher</a><p> и с его помощью запустить приложение прямо из исходников. Это очень удобно, а при наличии хорошего текстового редактора можно даже разрабатывать прямо на телефоне/таблете. Но есть один нюанс. Приложение не должно пользоваться внешними библиотеками — только киви и стандартной библиотекой Питона. Если внешние библиотеки используются, всё ещё есть шанс запустить — проверьте, что библиотека не содержит никаких бинарников, только чистый Питон. Если это так, просто поместите её локально в папку с приложением и поменяйте соответственно импорты. Если бинарники всё-таки есть, из исходников запустить не выйдет, придётся компилировать. Для начала проверьте, есть ли используемые библиотеки в </p><a href="https://github.com/kivy/python-for-android/tree/master/recipes">списке рецептов</a><p>. 
</p><p>
Если нет, придётся разбираться с компиляцией самостоятельно или общаться в </p><a href="http://webchat.freenode.net/?nick=kvuser.&amp;channels=kivy&amp;uio=d4">чате</a><p> с разработчиками (рекомендую, очень отзывчивые товарищи). Но большинство популярных и важных библиотек уже давно в этом списке.
</p><p>
Всё что описано дальше, выполняется на маке или линуксе. На винде придётся ставить виртуальную машину и образ. На </p><a href="http://kivy.org/#download">этой страничке</a><p> можно скачать образ с предустановленным билдозером. 
</p><p>
Устанавливаем программу buildozer (</p><b>pip install buildozer</b><p>). Заходим в папку с приложением и запускаем </p><b>buildozer init</b><p>. В папке появляется файл buildozer.spec. Меняем там настройки по вкусу, то, что действительно важно — requirements, а когда дело дойдёт до релиза — версия, впрочем, файл прекрасно документирован и разобраться с ним — дело пары минут. А, ну да, ещё уровень логов в начале полезно поставить 2 вместо 1, чтобы видеть почему компиляция падает, если она падает. Затем запускаем </p><b>buildozer android debug</b><p>. 
</p><p>
Если всё прошло успешно, в папке с проектом появится папка bin, а в ней apk файл. </p><p>
Проверяем программу, любым из двух способов, обрабатываем напильником, доводим до совершенства (шучу, совершенства не бывает). Очень полезна опция logcat. Подсоединяем устройство к компьютеру usb кабелем запускаем </p><b>buildozer logcat</b><p>, запускаем приложение и смотрим на компьютере логи и трейсбэки. Мне пригодилось, когда приложение просто молча вылетало при запуске…
</p><p>
Итак, у вас есть приложение на киви, оно прекрасно работает на андроиде и теперь вы хотите выложить его на Play Store. Что для этого нужно?
</p><p>
сначала компилируем релиз-версию:
</p><b>buildozer android release</b><p>
Получаем unsigned apk, его нужно подписать. А для этого нужно создать ключ.</p><p>
Запускаем:
</p><b>keytool -genkey -v -keystore путь_туда_где_будет_лежать_ключ/имя_ключа.keystore -alias короткое_имя_для_ключа -keyalg RSA -keysize 2048 -validity 10000</b>
<p>
Ключ готов. Его нужно сохранить и беречь как зеницу глаза. Теперь нужно подписать приложение этим ключом (при выкладывании новых версий пользуемся тем же самым ключом, новый создавать не нужно).
</p><b>jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore путь_туда_где_лежит_ключ/имя_ключа.keystore путь_к_проекту/bin/неподписанный_apk короткое_имя</b>
<p>
Теперь хоть файл и называется unsigned, он уже подписан. Теперь желательно оптимизировать его утилитой zipalign. она лежит в android sdk, который buildozer скачивает при установке.

</p><b>zipalign -v 4 путь_к_подписанному_apk путь_туда_где_будет_лежать_готовый_apk</b>
<p>
Итак у вас есть готовый apk.
</p><p>
Теперь вам нужно нарисовать несколько картинок.
</p><p>
Картинки следующие — иконка приложения которая будет отображаться на устройстве (её нужно прописать в buildozer.spec), иконка приложения (512х512), которая будет отображаться в маркете. Скриншоты для телефона, семидюймовых таблетов, десятидюймовых таблетов (в общем для тех устройств, для которых приложение будет показываться в маркете) и картинка 1024х500 для раздела рекомендуемое (ага, знаю, смешно, но это обязательно к заполнению). Я всё вышеперечисленное нарезал за пару минут из скриншотов, но безусловно лучше потратить время и сделать что-нибудь качественное.
</p><p>
Когда есть apk и все картинки, идём наконец в </p><a href="https://play.google.com/apps/publish/">консоль разработчика</a><p>, регистрируемся если ещё не, платим Гуглу за удовольствие 25$ (может об этом надо было написать в начале статьи?) расставляем все картиночки, пишем описания, отвечаем на пару вопросов для получения возрастного рейтинга, загружаем apk, ждём несколько часов подтверждения и любуемся приложением в маркете. Ссылки на выложенные приложения кидайте в комменты.

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>