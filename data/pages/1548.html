<html><body><div><div class="post-body entry-content" id="post-body-63395290652357996" itemprop="description articleBody">
<b>NOTE:</b><p> You can also watch a video walkthrough of the common code covered in this blogpost </p><a href="http://youtu.be/h-gBeC9Y9cE?list=PLOU2XLYxmsILOIxBRPPhgYbuSslr50KVq&amp;index=3">here</a><p>.
</p><p/>
<h2>Introduction</h2><p>
Back in 2012 when I published </p><a href="http://amzn.com/0132678209" target="_blank"><i>Core Python Applications Programming</i>, 3rd ed.</a><p>, I
</p><a href="http://wescpy.blogspot.com/2012/04/integrating-google-apis-and.html" target="_blank">posted</a><p> about how I integrated Google technologies into the book. The only problem is that I presented very specific code for </p><a href="http://developers.google.com/appengine" target="_blank">Google App Engine</a><p> and </p><a href="http://plus.google.com/" target="_blank">Google+</a><p> only. I didn't show a generic way how, using pretty much the same boilerplate Python snippet, you can access any number of Google APIs; so here we are.
</p><p>
In this multi-part series, I'll break down the code that allows </p><b>you</b><p> to leverage Google APIs to the most basic level (even for Python), so you can customize as necessary for your app, whether it's running as a command-line tool or something server-side in the cloud backending Web or mobile clients. If you've got the book and played around with our </p><a href="http://developers.google.com/+" target="_blank">Google+ API</a><p> example, you'll find this code familiar, if not identical — I'll go into more detail here, highlighting the common code for generic API access and </p><i>then</i><p> bring in the G+-relevant code later.
</p><p>
We'll start in this first post by demonstrating how to access public or </p><i>unauthorized</i><p> data from Google APIs. (The next post will illustrate how to access </p><i>authorized</i><p> data from Google APIs.) Regardless of which you use, the corresponding boilerplate code stands alone. In fact, it's probably best if you saved these generic snippets in a library module so you can (re)use the same bits for any number of apps which access any number of </p><a href="https://developers.google.com/api-client-library/python/apis" target="_blank">modern Google APIs</a><p>.

</p><h2>
Google API access</h2><p>
In order to access Google APIs, follow these instructions:
</p><ul>
<li>Go to the <a href="http://console.developers.google.com/" target="_blank">Google Developers Console</a> and login.</li>
<ul>
<li>Use your Gmail or Google credentials; create an account if needed</li>
</ul>
<li>Click "Create Project" button</li>
<ul>
<li>Enter a Project Name (mutable, human-friendly string only used in the console)</li>
<li>Enter a Project ID (immutable, must be unique and not already taken)</li>
</ul>
<li>Once project has been created, click "Enable an API" button</li>
<ul>
<li>You can toggle on any API(s) that support(s) simple API access (not authorized).</li>
<li>For the code example below, we use the Google+ API.</li>
<li>Other ideas: YouTube Data API, Google Maps API, etc.</li>
<li>Find more APIs (and version#s which you need) at the <a href="http://developers.google.com/oauthplayground" target="_blank">OAuth Playground</a>.</li>
</ul>
<li>Select "Credentials" in left-nav under "APIs &amp; auth"</li>
<ul>
<li>Go to bottom half and click "Create new Key" button</li>
<li>Grab long "API KEY" cryptic string and save to Python script</li>
</ul>
</ul>

<b>NOTE:</b><p> You can also watch a video walkthrough of this app setup process in the "DevConsole" </p><a href="http://youtu.be/DYAwYxVs2TI?index=2&amp;list=PLOU2XLYxmsILOIxBRPPhgYbuSslr50KVq">here</a><p>.
</p><p/>

<h2>
Accessing Google APIs from Python</h2><p>
Now that you're set up, everything else is done on the Python side. To talk to a Google API, you need the </p><a href="http://developers.google.com/api-client-library/python" target="_blank">Google APIs Client Library for Python</a><p>, specifically the </p><span>apiclient.discovery.build()</span><p> function. Download and install the library in your usual way, for example:
</p><p>
<br/></p>
<span>$ pip install -U google-api-python-client</span>
<blockquote class="tr_bq">
<b>NOTE</b>: If you're building a Python App Engine app, you'll need something else, the <a href="https://developers.google.com/api-client-library/python/guide/google_app_engine" target="_blank">Google APIs Client Library for Python on Google App Engine</a>. It's similar but has extra goodies (specifically decorators — brief generic intro to those in <a href="http://wescpy.blogspot.com/2014/07/introduction-to-python-decorators.html" target="_blank">my previous post</a>) just for cloud developers that must be installed elsewhere. As App Engine developers know, libraries must be in the same location on the filesystem as your source code.</blockquote><p>
Once everything is installed, make sure that you can import </p><span>apiclient.discovery</span><p>:

</p><span>$ python</span>
<span>Python 2.7.6 (default, Apr  9 2014, 11:48:52)</span>
<span>[GCC 4.2.1 Compatible Apple LLVM 5.1 (clang-503.0.38)] on darwin</span>
<span>Type "help", "copyright", "credits" or "license" for more information.</span>
<span>&gt;&gt;&gt; <b>import</b> apiclient.discovery</span>
<span>&gt;&gt;&gt;</span>
<p>
In </p><span>discovery.py</span><p> is the </p><span>build()</span><p> function, which is what we need to create a service endpoint for interacting with an API. Now craft the following lines of code in your command-line tool:

</p><span><b>from</b> apiclient.discovery <b>import</b> build</span>

<span>API_KEY = # copied from project credentials page</span>
<span><i>SERVICE</i> = build(<i>API, VERSION</i>, developerKey=API_KEY)</span>
<p>
Take the API key you copied from the credentials page and assign to the </p><span>API_KEY</span><p> variable as a string. </p><i>Obviously</i><p>, embedding an API key in source code isn't something you'd so in practice as it's </p><b>not secure</b><p> whatsoever — stick it in a database, key broker, encrypt, or at least have it in a separate byte code (</p><span>.pyc</span><p>/</p><span>.pyo</span><p>) file that you import — but we'll allow it now solely for illustrative purposes of a simple command-line script.
</p><p>
In our short example we're going to do a simple search for "python" in public Google+ posts, so for the </p><span>API</span><p> variable, use the string </p><span>'plus'</span><p>. The API version is currently on version 1 (at the time of this writing), so use </p><span>'v1'</span><p> for </p><span>VERSION</span><p>. (Each API will use a different name and version string... again, you can find those in the </p><a href="http://developers.google.com/oauthplayground" target="_blank">OAuth Playground</a><p> or in the docs for the specific API you want to use.) Here's the call once we've filled in those variables:

</p><span>GPLUS = build('plus', 'v1', developerKey=API_KEY)</span>
<p>
We need a template for the results that come back. There are many fields in a Google+ post, so we're only going to pick three to display... the user name, post timestamp, and a snippet of the post itself:

</p><span>TMPL = '''</span>
<span>    User: %s</span>
<span>    Date: %s</span>
<span>    Post: %s</span>
<span>'''</span>
<p>
Now for the code. Google+ posts are activities (known as "notes;" there are other activities as well). One of the methods you have access to is </p><span>search()</span><p>, which lets you </p><b>query</b><p> public activities; so that's what we're going to use. Add the following call using the </p><span>GPLUS</span><p> service endpoint you already created using the verbs we just described and execute it:

</p><span>items = GPLUS.activities().search(query='python').execute().get('items', [])</span>
<p>
If all goes well, the (JSON) response payload will contain a set of </p><span>'items'</span><p> (else we assign an empty list for the </p><span><b>for</b></span><p> loop). From there, we'll loop through each matching post, do some minor string manipulation to replace all whitespace characters (including NEWLINEs [ </p><span>\n</span><p> ]) with spaces, and display if not blank:

</p><span><b>for</b> data <b>in</b> items:</span>
<span>    post = ' '.join(data['title'].strip().split())</span>
<span>    <b>if</b> post:</span>
<span>        <b>print</b> TMPL % (</span><span>data['actor']['displayName'],</span>
<span>                      data['published'], post)</span>
<p>
We're using the </p><span><b>print</b></span><p> statement here in Python 2, but a pro tip to start getting ready for Python 3 is to add this import to the top of your script (which has no effect in 3.x) so you can use the </p><span>print()</span><p> function instead:

</p><span><b>from</b> __future__ <b>import</b> print_function</span>

<h2>
Conclusion</h2><p>
To find out more about the input parameters as well as all the fields that are in the response, take a look at </p><a href="http://developers.google.com/+/api/latest/activities/search" target="_blank">the docs</a><p>. Below is the entire script missing only the </p><span>API_KEY</span><p> which you'll have to fill in yourself.

</p><span>#!/usr/bin/env python</span>
<span><br/></span>
<span><b>from</b> apiclient.discovery <b>import</b> build</span>
<span><br/></span>
<span>TMPL = '''</span>
<span>    User: %s</span>
<span>    Date: %s</span>
<span>    Post: %s</span>
<span>'''</span>
<span><br/></span>
<span>API_KEY = # copied from project credentials page</span>
<span>GPLUS = build('plus', 'v1', developerKey=API_KEY)</span>
<span>items = GPLUS.activities().search(query='python').execute().get('items', [])</span>
<span><b>for</b> data <b>in</b> items:</span>
<span>    post = ' '.join(data['title'].strip().split())</span>
<span>    <b>if</b> post:</span>
<span>        <b>print</b> TMPL % (</span><span>data['actor']['displayName'],</span>
<span>                      data['published'], post)</span>
<div>
<p>
When you run it, you should see pretty much what you'd expect, a few posts on Python, some on Monty Python, and of course, some on the snake — I called my script </p><span>plus_search.py</span><p>:

</p><span>$ python plus_search.py </span>
<span><br/></span>
<span>    User: Jeff Ward</span>
<span>    Date: 2014-09-20T18:08:23.058Z</span>
<span>    Post: How to make python accessible in the command window.</span>
<span><br/></span>
<span><br/></span>
<span>    User: Fayland Lam</span>
<span>    Date: 2014-09-20T16:40:11.512Z</span>
<span>    Post: Data Engineer http://findmjob.com/job/AB7ZKitA5BGYyW1oAlQ0Fw/Data-Engineer.html #python #hadoop #jobs...</span>
<span><br/></span>
<span><br/></span>
<span>    User: Willy's Emporium LTD</span>
<span>    Date: 2014-09-20T16:19:33.851Z</span>
<span>    Post: MONTY PYTHON QUOTES MUG Take a swig to wash down all that albatross and crunchy frog. Featuring 20 ...</span>
<span><br/></span>
<span><br/></span>
<span>    User: Doddy Pal</span>
<span>    Date: 2014-09-20T15:49:54.405Z</span>
<span>    Post: Classic Monty Python!!!</span>
<span><br/></span>
<span><br/></span>
<span>    User: Sebastian Huskins</span>
<span>    Date: 2014-09-20T15:33:00.707Z</span>
<span>    Post: Made a small python script to get shellcode out of an executable. I found a nice commandlinefu.com oneline...</span>
<p>
<br/></p>
<b>EXTRA CREDIT</b><p>: To test your skills, check the docs and add a fourth line to each output which is the URL/link to that specific post, so that you (and your users) can open a browser to it if of interest.
</p><p>
If you want to build on from here, check out the </p><i>larger</i><p> app using the Google+ API featured in Chapter 15 of the book — it adds some brains to this basic code where the Google+ posts are sorted by popularity using a "chatter" score. That just about wraps it up this post. Once you're good to go, then you're ready to learn how to perform </p><a href="http://goo.gl/cdm3kZ"><b>authorized Google API access</b></a><p> in part 2 of this two-part series!
</p><p>
<br/></p>
</div>

<p/>
</div>
</div></body></html>