<html><body><div><article class="post-515 post type-post status-publish format-standard hentry category-programming-2 category-python" id="post-515">
				
				<h2>My top 5 ‘new’ Python modules of 2015</h2>
				<time>December 23, 2015</time>
		
				<p>As I’ve been blogging a lot more about Python over the last year, I thought I’d list a few of my favourite ‘new’ Python modules from 2015. These aren’t necessarily modules that were newly released in 2015, but modules that were ‘new to me’ this year – and may be new to you too!</p>

<p>This module is <em>so simpl</em><em>e </em>but <em>so useful</em> – it makes it stupidly easy to display progress bars for loops in your code. So, if you have some code like this:</p>
<pre class="brush: python; gutter: false; first-line: 1">for item in items:
    process(item)</pre>
<p>Just wrap the iterable in the tqdm function:</p>
<pre class="brush: python; gutter: false; first-line: 1">from tqdm import tqdm

for item in tqdm(items):
    process(item)</pre>
<p>and you’ll get a beautiful progress bar display like this:<br/>
<tt>18%|█████████                               | 9/50 [00:09&lt;;00:41,  1.00it/s</tt></p>
<p class="p1">I introduced my wife to this recently and it blew her mind – it’s so beautifully simple, and so useful.</p>

<p>I had come across joblib previously, but I never really ‘got’ it – it seemed a bit of a mismash of various functions. I still feel like it’s a bit of a mishmash, but it’s very useful. I was re-introduced to it by one of my <a href="http://www.flowminder.org">Flowminder</a> colleagues, and we used it extensively in our data analysis code. So, what does it do? Well, three main things: 1) <a href="https://pythonhosted.org/joblib/memory.html">caching</a>, 2) <a href="https://pythonhosted.org/joblib/parallel.html">parallelisation</a>, and 3) <a href="https://pythonhosted.org/joblib/persistence.html">persistence</a> (saving/loading data). I must admit that I haven’t used the parallel programming functionality yet, but I have used the other functions extensively.</p>
<p>The caching functionality allows you to easily ‘memoize’ functions with a simple decorator. This caches the results, and loads them from the cache when calling the function again using the same parameters – saving a lot of time. One tip for this is to choose the arguments of the function that you memoize carefully: although joblib uses a fairly fast hashing function to compare the arguments, it can still take a while if it is processing an absolutely enormous array (many Gigabytes!). In this case, it is often better to memoize a function that takes arguments of filenames, dates, model parameters or whatever else is used to create the large array – cutting out the loading of the large array and the hashing of that array on each call.</p>
<p>The persistence functionality is strongly linked to the memoization functions – as it is what is used to save the cached results to file. It basically performs the same function as the built-in <tt>pickle</tt> module (or the <a href="http://trac.mystic.cacr.caltech.edu/project/pathos/wiki/dill">dill</a> module – see below), but works really efficiently for objects that contain numpy arrays. The interface is exactly the same as the pickle interface (simple <tt>load</tt> and <tt>dump</tt> functions), so it’s really easy to switch over. One thing I didn’t realise before is that if you set <tt>compressed=True</tt> then a) your output files will be smaller (obviously!) and b) the output will all be in one file (as opposed to the default, which produces a <tt>.pkl</tt> file along with many <tt>.npy</tt> files).</p>

<p><img class="aligncenter wp-image-516 size-medium" src="http://blog.rtwilson.com/wp-content/uploads/2015/12/folium-300x156.jpeg" alt="folium" srcset="http://blog.rtwilson.com/wp-content/uploads/2015/12/folium-300x156.jpeg 300w, http://blog.rtwilson.com/wp-content/uploads/2015/12/folium-768x399.jpeg 768w, http://blog.rtwilson.com/wp-content/uploads/2015/12/folium.jpeg 800w" sizes="(max-width: 300px) 100vw, 300px"/></p>
<p>I’ve barely scratched the surface of this library, but it’s been <em>really</em> helpful for doing quick visualisations of geographic data from within Python – and it even plays well with the Jupyter Notebook!</p>
<p>One of the pieces of example code from the <a href="https://folium.readthedocs.org/en/latest/">documentation</a> shows how easily it can be used:</p>
<pre class="brush: python; gutter: false; first-line: 1">map_1 = folium.Map(location=[45.372, -121.6972])
map_1.simple_marker([45.3288, -121.6625], popup='Mt. Hood Meadows')
map_1.simple_marker([45.3311, -121.7113], popup='Timberline Lodge')
map_1.create_map(path='output.html')</pre>
<p>You can easily configure almost every aspect of the map above, including the background map used (any leaflet tileset will work), point icons, colours, sizes and pretty-much anything else. You can visualise GeoJSON data and do choropleth maps too (even linking to Pandas data frames!).</p>
<p>Again, I used this in my work with Flowminder, but have since used it in all sorts of other contexts too. Just taking the code above and putting the call to <code>simple_marker</code> in a loop makes it really easy to visualise a load of points.</p>
<p>The example above shows how to save a map to a specified HTML file – but to use it within the Jupyter Notebook just make sure that the map object (<code>map_1</code> in the example above) is by itself on the final line in a cell, and the notebook will work its magic and display it inline…perfect!</p>

<p>The first version of my ‘new’ module recipy (as presented at the Collaborations Workshop 2015) used MongoDB as the backend data store. However, this added significant complexity to the installation/set-up process, as you needed to install a MongoDB server first, get it running etc. I went looking for a pure-Python NoSQL database and came across TinyDB…which had a simple interface, and has handled everything I’ve thrown at it so far!</p>
<p>In the longer-term we are thinking of making the backend for <a href="https://github.com/recipy/recipy">recipy</a> configurable – so that people can use MongoDB if they want some of the advantages that brings (being able to share the database easily across a network, better performance), but we’ll still keep TinyDB as the default as it just makes life so much easier!</p>

<p><code>dill</code> is a better <code>pickle</code> (geddit?). You’ve probably used the built-in <code>pickle</code> module to store various Python objects to disk but every so often you may have received an error like this:</p>
<pre class="brush: python; gutter: false; first-line: 1">---------------------------------------------------------------------------
PicklingError                             Traceback (most recent call last)
&lt;ipython-input-5-aa42e6ee18b1&gt; in &lt;module&gt;()
----&gt; 1 pickle.dumps(x)

PicklingError: Can't pickle &lt;function &lt;lambda&gt; at 0x103671e18&gt;: attribute lookup &lt;lambda&gt; on __main__ failed</pre>
<p>That’s because the pickle object is relatively limited in what it can pickle: it can’t cope with nested functions, lambdas, slices, and more. You may not often want to pickle those objects directly – but it is fairly common to come across these <em>inside</em> other objects you want to pickle, thus causing the pickling to fail.</p>
<p><code>dill</code> solves this by simply being able to pickle a lot more stuff – almost everything, in fact, apart from frames, generators and tracebacks. As with joblib above, the interface is exactly the same as <code>pickle</code> (<code>load</code> and <code>dump</code>), so it’s really easy to switch.</p>
<p>Also, for those of you who like R’s ability to save the entire session in a <code>.RData</code> file, dill has <code>dump_session</code> and <code>load_session</code> functions too – which do exactly what you’d expect!</p>

<p>This is a ‘bonus’ as it isn’t actually a Python module, but is something that I started using for the first time in 2015 (yes, I was late to the party!) but couldn’t manage without now!</p>
<p>Anaconda can be a little confusing because it consists of a number of separate things – multiple of which are called ‘Anaconda’. So, these are:</p>
<ul>
<li>A cross-platform Scientific Python distribution – along the same lines as the <a href="https://www.enthought.com/products/epd/">Enthought Python Distribution</a>, <a href="http://winpython.github.io/">WinPython</a> and so on. Once you’ve <a href="https://www.continuum.io/downloads">downloaded</a> and installed it you get a full scientific Python stack including all of the standard libraries (numpy, scipy, pandas, matplotlib, sklearn, skimage…and many more). It is available in four flavours overall: Python 2 or Python 3, each of which has the option of the full Anaconda distribution, or the reduced-size Miniconda distribution. This leads nicely on to…</li>
<li>The conda package management system. This is designed to work with Python packages, but can be used for installing <em>any</em> binaries. You may think this sounds very much like pip, but it’s far better because a) it installs binaries (no more compiling numpy from source!), b) it deals with dependencies better, and c) you can easily create multiple <em>environments</em> which can have different packages installed <em>and</em> run different Python versions</li>
<li>The <a href="http://anaconda.org">anaconda.org</a> repository (previously called binstar) where you can create an account and upload binary conda packages to easily share with others. For example, I’ve got a couple of conda packages hosted there, which makes them really easy to install for anyone running conda.</li>
</ul>
<p>So, there we go – my top five Python modules that were <em>new to me</em> in 2015. Hope you found it useful – and Merry Christmas and Happy New Year to you all!</p>
<p><em>(If you liked this post, then you may also like </em><em><a href="http://blog.rtwilson.com/an-easy-way-to-install-jupyter-notebook-extensions/">An easy way to install Jupyter Notebook extensions</a>, <a href="http://blog.rtwilson.com/bokeh-plots-with-dataframe-based-tooltips/">Bokeh plots with DataFrame-based tooltips</a>, and <a href="http://blog.rtwilson.com/orthogonal-distance-regression-in-python/">Orthogonal Distance Regression in Python</a></em>)</p>

				<hr class="clearfix"/>

        
        <p class="post_categories"><strong>Categorised as:</strong> <a href="http://blog.rtwilson.com/category/programming-2/" rel="category tag">Programming</a>, <a href="http://blog.rtwilson.com/category/programming-2/python/" rel="category tag">Python</a> </p>

								
				<hr class="clearfix"/>
				
			</article>

			


	

	</div></body></html>