<html><body><div><div id="initiation-of-the-payment-gateway">
<h3>Initiation of the payment gateway</h3>
<pre><span class="c1"># create payment and pass url to template</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">payments</span><span class="o">.</span><span class="n">create_payment</span><span class="p">({})</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">has_succeed</span><span class="p">():</span>
    <span class="n">templateParameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'gatewayUrl'</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">'gw_url'</span><span class="p">],</span>
        <span class="s1">'embedJs'</span><span class="p">:</span> <span class="n">gopay</span><span class="o">.</span><span class="n">url_to_embedjs</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="c1"># render template</span>
</pre>
<div id="inline-gateway">

<pre><span class="x">&lt;form action="&lt;%= $gatewayUrl %&gt;" method="post" id="gopay-payment-button"&gt;
  &lt;button name="pay" type="submit"&gt;Pay&lt;/button&gt;
  &lt;script type="text/javascript" src="&lt;%= $embedJs %&gt;"&gt;&lt;/script&gt;
&lt;/form&gt;</span>
</pre>
</div>
<div id="redirect-gateway">

<pre><span class="x">&lt;form action="&lt;%= $gatewayUrl %&gt;" method="post"&gt;
  &lt;button name="pay" type="submit"&gt;Pay&lt;/button&gt;
&lt;/form&gt;</span>
</pre>
</div>

</div>
<div id="cache-access-token">
<h3>Cache access token</h3>
<p>Access token expires after 30 minutes so it’s expensive to use new token
for every request. Unfortunately it’s default behavior of
<tt>`gopay.oauth2.InMemoryTokenCache</tt> &lt;/gopay/oauth2.py&gt;`__. But you can
implement your cache and store tokens in Memcache, Redis, files, …
It’s up to you.</p>
<p>Your cache must implement template methods <tt>get_token</tt> and
<tt>set_token</tt>. Be aware that there are two
<a href="https://doc.gopay.com/en/?shell#scope" rel="nofollow">scopes</a> (<tt>TokenScope</tt>) and
SDK can be used for different clients (<tt>clientId</tt>,
<tt>isProductionMode</tt>). So <tt>client</tt> passed to methods is unique
identifier (<tt>string</tt>) that is built for current environment. Below you
can see example implementation of caching tokens in memory:</p>
<pre><span class="c1"># register cache in optional service configuration</span>
<span class="n">payments</span> <span class="o">=</span> <span class="n">gopay</span><span class="o">.</span><span class="n">payments</span><span class="p">(</span>
    <span class="p">{},</span> <span class="c1"># your config</span>
    <span class="p">{</span><span class="s1">'cache'</span><span class="p">:</span> <span class="n">MyCache</span><span class="p">()}</span>
<span class="p">)</span>
</pre>
<pre><span class="k">class</span> <span class="nc">MyCache</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="c1"># return None if token not exists</span>

    <span class="k">def</span> <span class="nf">set_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">client</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</pre>
</div>
<div id="log-http-communication">
<h3>Log HTTP communication</h3>
<p>You can log every request and response from communication with API.
Check available loggers below. Or you can implement your own logger,
just implement function that takes two arguments:
<tt>`gopay.http.request</tt> &lt;/gopay/http.py&gt;`__ and
<tt>`gopay.http.response</tt> &lt;/gopay/http.py&gt;`__.</p>
<pre><span class="c1"># register logger in optional service configuration</span>
<span class="n">payments</span> <span class="o">=</span> <span class="n">gopay</span><span class="o">.</span><span class="n">payments</span><span class="p">(</span>
    <span class="p">{},</span> <span class="c1"># your config</span>
    <span class="p">{</span><span class="s1">'logger'</span><span class="p">:</span> <span class="n">my_logger</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">my_logger</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
</pre>

</div>
</div></body></html>