<html><body><div><div role="main" id="main">
<p>

In this series of articles we are going to build an application to run polls and maybe even surveys using Flask.
</p><p>

In addition to the articles, you can follow the development of the application in <a href="https://github.com/szabgab/flask-poll">this</a> repository.
</p><p>

Let's get started by creating a simple Flask-based application.
</p><p>

</p><p>

We create an new directory and in that directory we create a Python script with the following content:
</p><p>

<b>examples/flask/poll1/poll.py</b><br/></p><pre class="prettyprint linenums language-python">
from flask import Flask, render_template
import os
app = Flask(__name__)

@app.route('/')
def root():
    return render_template('poll.html')

if __name__ == "__main__":
    app.run(debug=True)

</pre>
<p>

We created a route for <span class="inline_code">/</span> that will invoke the <span class="inline_code">root()</span> function that will return the content of
the <span class="inline_code">poll.html</span> template. The template itself was added in the <span class="inline_code">templates/</span> subdirectory.
</p><p>

<b>examples/flask/poll1/templates/poll.html</b><br/></p><pre class="prettyprint linenums language-html">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Poll&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Poll&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<p>

This is how the directory of the project looks like:
</p><p>

</p><pre class="linenums">
$ tree
.
├── poll.py
└── templates
    └── poll.html
</pre>
<p>

We can now run <span class="inline_code">python poll.py</span> that will tell us
</p><p>

</p><pre class="linenums">
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
</pre>
<p>

If we open the browser to the give URL, we'll see the following:
</p><p>

<img src="/img/flask_poll_1.png" alt="Flask poll"/>
</p><p>

Not much, but it is working. Just like the <a href="/hello-world-with-flask-and-python">hello world</a>, but with a template.
</p><p>

</p><pre class="linenums">
$ git init
$ git add .
$ git commit -m "step 1 - hello world with a template"
</pre>
<p>

<a href="https://github.com/szabgab/flask-poll/commit/c78124201aeb49a2853cac6dc9d28fc1ee03edb3">commit</a>.
</p><p>

</p><p>

</p><h2>Display the poll</h2>
<p>

In order to have a poll we need a question and we need a list of values to pick from.
Later this should be probably placed in a configuration file, but for now let's create
a dictionary in our application holding the data:
</p><p>

</p><pre class="linenums">
poll_data = {
   'question' : 'Which web framework do you use?',
   'fields'   : ['Flask', 'Django', 'TurboGears', 'web2py', 'pylonsproject']
}
</pre>
<p>

We also change the call to <span class="inline_code">render_template</span> and pass this dictionary to it
with an arbitrary key we called <span class="inline_code">data</span>.
</p><p>

<b>examples/flask/poll2/poll.py</b><br/></p><pre class="prettyprint linenums language-python">
from flask import Flask, render_template
import os
app = Flask(__name__)

poll_data = {
   'question' : 'Which web framework do you use?',
   'fields'   : ['Flask', 'Django', 'TurboGears', 'web2py', 'pylonsproject']
}

@app.route('/')
def root():
    return render_template('poll.html', data=poll_data)

if __name__ == "__main__":
    app.run(debug=True)

</pre>
<p>

In the template we use the expression <span class="inline_code">{{ data.question }}</span> to include the
question. We use that both as the title of the whole page that will show up as the title
of the browser tab, and in an <span class="inline_code">h1</span> element to have something more visible.
</p><p>

Then we create a form with <span class="inline_code">action="/poll"&gt;</span> which means we'll have to create another route
for this in our application. Inside the form, we create a number of <span class="inline_code">radio</span> input elements.
One for each value in the list of possible values. Radio input fields are good here as we would like
to get exact one answer.
</p><p>

<b>examples/flask/poll2/templates/poll.html</b><br/></p><pre class="prettyprint linenums language-html">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;{{ data.question }}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;{{ data.question }}&lt;/h1&gt;
&lt;form action="/poll"&gt;
  {% for e in data.fields %}
     &lt;input type="radio" name="field" value="{{ e }}"&gt; {{ e }}&lt;br&gt;
  {% endfor %}
  &lt;input type="submit" value="Vote" /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<p>

After the changes, if we visit our website we'll see the following:
</p><p>

<img src="/img/flask_poll_2.png" alt="Flask poll"/>
</p><p>

If we select one of the items and click on the "Vote" button we get this response:
</p><p>

<img src="/img/flask_poll_2_2.png" alt="Flask poll"/>
</p><p>

This just means we have not implemented the <span class="inline_code">/poll</span> route yet. Let's do that now.
</p><p>

</p><pre class="linenums">
$ git add .
$ git commit -m "add poll data and display it"
</pre>
<p>

<a href="https://github.com/szabgab/flask-poll/commit/2a293a4051bc4ba3ae4c8b95dd1e02b669a76b82">commit</a>
</p><p>

</p><h2>Accept the vote</h2>
<p>

First step is to add a function to handle the <span class="inline_code">/poll</span> route, accept the value from
the <span class="inline_code">field</span> of the form using <span class="inline_code">request.args.get('field')</span>. At fist let's just return
this value to the user:
</p><p>

</p><pre class="linenums">
@app.route('/poll')
def poll():
    vote = request.args.get('field')
    return vote 
</pre>
<p>

We can reload the browser and it will show our selection:
</p><p>

<img src="/img/flask_poll_3_1.png" alt="Flask poll"/>
</p><p>

The next step is to save the vote somewhere. To be simple, we are going to use a flat file for this.
At the beginning of the <span class="inline_code">poll.py</span> script we add the name of the file in a variable:
filename = 'data.txt' (it is always good to have values in variables),
and then we open the file to append more content (using <span class="inline_code">'a'</span> as the parameter to the <span class="inline_code">open</span> function),
write the vote to the file and close the file.
</p><p>

We are going to have one vote in every line. It will be easy to collect the data later.
</p><p>

</p><pre class="linenums">
@app.route('/poll')
def poll():
    vote = request.args.get('field')

    out = open(filename, 'a')
    out.write( vote + '\n' )
    out.close()

    return vote 
</pre>
<p>

At this point, if we reload the web page, it will already save our vote in the data file, but it will still just echo
back the vote. Instead of that let's add a slightly nicer thank-you page:
</p><p>

</p><pre class="linenums">
    return render_template('thankyou.html', data=poll_data)
</pre>
<p>

The Flask script looks like this now:
</p><p>

<b>examples/flask/poll3/poll.py</b><br/></p><pre class="prettyprint linenums language-python">
from flask import Flask, render_template, request
import os
app = Flask(__name__)

poll_data = {
   'question' : 'Which web framework do you use?',
   'fields'   : ['Flask', 'Django', 'TurboGears', 'web2py', 'pylonsproject']
}
filename = 'data.txt'

@app.route('/')
def root():
    return render_template('poll.html', data=poll_data)

@app.route('/poll')
def poll():
    vote = request.args.get('field')

    out = open(filename, 'a')
    out.write( vote + '\n' )
    out.close()

    return render_template('thankyou.html', data=poll_data)


if __name__ == "__main__":
    app.run(debug=True)

</pre>
<p>

The thank-you template is this:
</p><p>

<b>examples/flask/poll3/templates/thankyou.html</b><br/></p><pre class="prettyprint linenums language-html">
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;{{ data.question }}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Thank you for submitting your vote for&lt;/h1&gt;
{{ data.question }}

&lt;/body&gt;
&lt;/html&gt;

</pre>
<p>

</p><pre class="linenums">
$ git add poll.py templates/thankyou.html
$ git commit -m "save the vote and thank the voter"
</pre>
<p>

<a href="https://github.com/szabgab/flask-poll/commit/ba5a516c7e1506d7c25807ebd18e9ef388df2b9b">commit</a>
</p><p>

This version of the voting station could already work, but let's add another page showing the results.
</p><p>

</p><h2>Show the results</h2>
<p>

In order to show the results we'll create another route called <span class="inline_code">/results</span> that will read the data file
and display the number of votes for each one of the candidates.
</p><p>

This is the route:
</p><p>

</p><pre class="linenums">
@app.route('/results')
def show_results():
    votes = {}
    for f in poll_data['fields']:
        votes[f] = 0

    f  = open(filename, 'r')
    for line in f:
        vote = line.rstrip("\n")
        votes[vote] += 1

    return render_template('results.html', data=poll_data, votes=votes)
</pre>
<p>

At first we create a dictionary called <span class="inline_code">votes</span> where we are going to collect the number of votes.
Then we go over the list of expected names from the original list of fields and put an entry for each one of them
with 0 votes. That will make sure each one of the fields will have a representation in the results, even if no-one voted for it.
</p><p>

Then we open the data file for reading, read line-by-line. Before updating the <span class="inline_code">votes</span> dictionary we need to
remove the trailing newline from the line which we do using <span class="inline_code">line.rstrip("\n")</span>.
</p><p>

Finally we pass the votes to the <span class="inline_code">render_template</span> function.
</p><p>

The template itself looks like this:
</p><p>

<b>examples/flask/poll4/templates/results.html</b><br/></p><pre class="prettyprint linenums language-html">
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;{{ data.question }}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Results for&lt;/h1&gt;
{{ data.question }}

&lt;ul&gt;
{% for e in votes %}
  &lt;li&gt;{{ e }} {{ votes[e] }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;

&lt;/body&gt;
&lt;/html&gt;


</pre>
<p>

and this is the full script:
</p><p>

<b>examples/flask/poll4/poll.py</b><br/></p><pre class="prettyprint linenums language-python">
from flask import Flask, render_template, request
import os
app = Flask(__name__)

poll_data = {
   'question' : 'Which web framework do you use?',
   'fields'   : ['Flask', 'Django', 'TurboGears', 'web2py', 'pylonsproject']
}
filename = 'data.txt'

@app.route('/')
def root():
    return render_template('poll.html', data=poll_data)

@app.route('/poll')
def poll():
    vote = request.args.get('field')

    out = open(filename, 'a')
    out.write( vote + '\n' )
    out.close()

    return render_template('thankyou.html', data=poll_data)

@app.route('/results')
def show_results():
    votes = {}
    for f in poll_data['fields']:
        votes[f] = 0

    f  = open(filename, 'r')
    for line in f:
        vote = line.rstrip("\n")
        votes[vote] += 1

    return render_template('results.html', data=poll_data, votes=votes)



if __name__ == "__main__":
    app.run(debug=True)

</pre>
<p>

If we visit the http://127.0.0.1:5000/results url we'll see a response like this:
</p><p>

<img src="/img/flask_poll_4.png" alt="Flask poll"/>
</p><p>

</p><p>

</p><pre class="linenums">
$ git add poll.py templates/results.html
$ git commit -m "show the results"
</pre>
<p>

<a href="https://github.com/szabgab/flask-poll/commit/9c0f04d7c7d80da68c681dfec2c0f7ad4f4d605a">commit</a>
</p><p>

</p><h2>What next?</h2>
<p>

<a href="/testing-the-flask-poll">Testing the Flask Poll</a>.
</p><p>

</p><p>

</p><p>


</p></div>



<p>


  In the comments, please wrap your code snippets within &lt;pre&gt; &lt;/pre&gt; tags and use spaces for indentation.

</p></div></body></html>