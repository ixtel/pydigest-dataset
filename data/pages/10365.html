<html><body><div><p>This adapter was built to send mosaik simulation data to the data stream management system <a href="http://odysseus.offis.uni-oldenburg.de" rel="nofollow">Odysseus</a>.
Odysseus allows to process and visualise the simulation results online during the simulation.
More information can be found in the <a href="http://mosaik.readthedocs.org/en/latest/ecosystem/odysseus.html" rel="nofollow">mosaik documentation</a>.</p>
<div id="installation">
<h3>Installation</h3>
<p><em>mosaik-zmq</em> can be installed using pip:</p>
<pre>$ pip install mosaik-zmq
</pre>
<p><em>mosaik-zmq</em> uses the <a href="https://pyzmq.readthedocs.org/en/latest/" rel="nofollow">pyzmq</a> module. If you get an error during installation,
install the python 3 headers and python-zmq package  (e.g., <tt>sudo <span class="pre">apt-get</span> install <span class="pre">python3-dev</span> <span class="pre">python-zmq</span></tt>)</p>
<p>If installation is still not working you may need to install a C compiler (e.g. <tt>sudo <span class="pre">apt-get</span> install
<span class="pre">build-essential</span></tt>)</p>
</div>
<div id="usage">
<h3>Usage</h3>
<p>The mosaik-zmq adapter can be added to a simulation scenario like any other component.
First you have to add the following code to the <em>sim_config</em>:</p>
<pre><span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">'ZMQ'</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'cmd'</span><span class="p">:</span> <span class="s1">'mosaik-zmq </span><span class="si">%(addr)s</span><span class="s1">'</span><span class="p">,</span>
   <span class="p">},</span>
<span class="p">}</span>
</pre>
<div id="initialization">
<h4>Initialization</h4>
<p>When you start <em>mosaik-zmq</em>, you have to provide a <em>step_size</em> and a <em>duration</em>
argument. The <em>step_size</em> defines how often data will be sent. The
<em>duration</em> is the simulation end time in seconds.</p>
<p>Example:</p>
<pre><span class="n">zmqModel</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">'ZMQ'</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
</pre>
</div>
<div id="model-instantiation">
<h4>Model instantiation</h4>
<p>Every instance of <em>mosaik-zmq</em> allows you to create instances of its
<em>Socket</em> model. The <em>Socket</em> has the following parameters:</p>
<ul>
<li><em>host</em> (default: ‘<a>tcp://*</a>:’) is the address of the host the data will be sent to.</li>
<li><em>port</em> (default: 5558) is the port on which the host will receive data.</li>
<li><em>socket_type</em> (default: ‘PUB’) is the type of the ZeroMQ socket to open for connection between the adapter and the host. Two different patterns can be used. The default is ‘PUB’, which stands for the <a href="http://zguide.zeromq.org/py:all#Getting-the-Message-Out" rel="nofollow">publish subscribe pattern</a> . Alternatively the <a href="http://zguide.zeromq.org/py:all#Divide-and-Conquer" rel="nofollow">push pull pattern</a> (‘PUSH’) can be used.</li>
</ul>
<p>Example code:</p>
<pre><span class="n">zmq</span> <span class="o">=</span> <span class="n">zmqModel</span><span class="o">.</span><span class="n">Socket</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'tcp://*:'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5558</span><span class="p">,</span> <span class="n">socket_type</span><span class="o">=</span><span class="s1">'PUB'</span><span class="p">)</span>
</pre>
</div>
<div id="connection">
<h4>Connection</h4>
<p>To get data sent to the host the zmq model has to be connected to an other model in the scenario definition.
Based on the <a href="https://bitbucket.org/mosaik/mosaik-demo" rel="nofollow">mosaik-demo</a> the scenario could look like this:</p>
<pre><span class="n">pvsim</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">'CSV'</span><span class="p">,</span> <span class="n">sim_start</span><span class="o">=</span><span class="n">START</span><span class="p">,</span> <span class="n">datafile</span><span class="o">=</span><span class="n">PV_DATA</span><span class="p">)</span>
<span class="n">pvs</span> <span class="o">=</span> <span class="n">pvsim</span><span class="o">.</span><span class="n">PV</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">zmqModel</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">'ZMQ'</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="n">zmq</span> <span class="o">=</span> <span class="n">zmqModel</span><span class="o">.</span><span class="n">Socket</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'tcp://*:'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5558</span><span class="p">,</span> <span class="n">socket_type</span><span class="o">=</span><span class="s1">'PUB'</span><span class="p">)</span>

<span class="n">connect_many_to_one</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">pvs</span><span class="p">,</span> <span class="n">zmq</span><span class="p">,</span> <span class="s1">'P'</span><span class="p">)</span>
</pre>
</div>
</div>
</div></body></html>