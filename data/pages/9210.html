<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-pyexpool" class="anchor" href="#pyexpool" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>PyExPool</h1>

<p>Lightweight Multi-Process Execution Pool to schedule Jobs execution with <em>per-job timeout</em>, optionally grouping them into Tasks and specifying execution parameters:</p>

<ul>
<li>timeout per each Job (it was the main motivation to implement this module, because this feature is not provided by any Python implementation out of the box)</li>
<li>onstart/ondone callbacks, ondone is called only on successful completion (not termination) for both Jobs and Tasks (group of jobs)</li>
<li>stdout/err output, which can be redirected to any custom file or PIPE</li>
<li>custom parameters for each Job and embracing Task besides the name/id</li>
</ul>

<p>The implementation is a <strong><em>single file module</em> to be easily included into your project and <em>customized</em> as a part of your distribution</strong> (like in <a href="//github.com/XI-lab/PyCABeM">PyCaBeM</a>), not as a separate library.<br/>
The main purpose of this single-file module is <em>asynchronouschronious execution of modules and external executables</em>. When asynchronious execution of Python functions is required and usage of external dependences is not a problem, then more handy and straightforward approach is to use <a href="https://pypi.python.org/pypi/Pebble">Pebble</a> library.</p>

<p>\author: (c) Artem Lutov <a href="mailto:artem@exascale.info">artem@exascale.info</a><br/>
\organizations: <a href="http://exascale.info/">eXascale Infolab</a>, <a href="http://www.lumais.com/">Lumais</a>, <a href="http://sciencewise.info/">ScienceWise</a><br/>
\date: 2016-01  </p>

<h2><a id="user-content-content" class="anchor" href="#content" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Content</h2>



<h2><a id="user-content-api" class="anchor" href="#api" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>API</h2>

<p>Flexible API provides optional automatic restart of jobs on timeout, access to job's process, parent task, start and stop execution time and much more...</p>

<h3><a id="user-content-job" class="anchor" href="#job" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Job</h3>

<div class="highlight highlight-source-python"><pre>Job(name, <span class="pl-v">workdir</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-v">args</span><span class="pl-k">=</span>(), <span class="pl-v">timeout</span><span class="pl-k">=</span><span class="pl-c1">0</span>, <span class="pl-v">ontimeout</span><span class="pl-k">=</span><span class="pl-c1">False</span>, <span class="pl-v">task</span><span class="pl-k">=</span><span class="pl-c1">None</span>
, <span class="pl-v">startdelay</span><span class="pl-k">=</span><span class="pl-c1">0</span>, <span class="pl-v">onstart</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-v">ondone</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-v">params</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-v">stdout</span><span class="pl-k">=</span>sys.stdout, <span class="pl-v">stderr</span><span class="pl-k">=</span>sys.stderr):
    <span class="pl-s"><span class="pl-pds">"""</span>Initialize job to be executed</span>
<span class="pl-s"/>
<span class="pl-s">    name  - job name</span>
<span class="pl-s">    workdir  - working directory for the corresponding process, None means the dir of the benchmarking</span>
<span class="pl-s">    args  - execution arguments including the executable itself for the process</span>
<span class="pl-s">        <span class="pl-k">NOTE</span>: can be None to make make a stub process and execute the callbacks</span>
<span class="pl-s">    timeout  - execution timeout. Default: 0, means infinity</span>
<span class="pl-s">    ontimeout  - action on timeout:</span>
<span class="pl-s">        False  - terminate the job. Default</span>
<span class="pl-s">        True  - restart the job</span>
<span class="pl-s">    task  - origin task if this job is a part of the task</span>
<span class="pl-s">    startdelay  - delay after the job process starting to execute it for some time,</span>
<span class="pl-s">        executed in the CONTEXT OF THE CALLER (main process).</span>
<span class="pl-s">        ATTENTION: should be small (0.1 .. 1 sec)</span>
<span class="pl-s">    onstart  - callback which is executed on the job starting (before the execution</span>
<span class="pl-s">        started) in the CONTEXT OF THE CALLER (main process) with the single argument,</span>
<span class="pl-s">        the job. Default: None</span>
<span class="pl-s">        ATTENTION: must be lightweight</span>
<span class="pl-s">        <span class="pl-k">NOTE</span>: can be executed a few times if the job is restarted on timeout</span>
<span class="pl-s">    ondone  - callback which is executed on successful completion of the job in the</span>
<span class="pl-s">        CONTEXT OF THE CALLER (main process) with the single argument, the job. Default: None</span>
<span class="pl-s">        ATTENTION: must be lightweight</span>
<span class="pl-s">    params  - additional parameters to be used in callbacks</span>
<span class="pl-s">    stdout  - None or file name or PIPE for the buffered output to be APPENDED</span>
<span class="pl-s">    stderr  - None or file name or PIPE or STDOUT for the unbuffered error output to be APPENDED</span>
<span class="pl-s">        ATTENTION: PIPE is a buffer in RAM, so do not use it if the output data is huge or unlimited</span>
<span class="pl-s"/>
<span class="pl-s">    tstart  - start time is filled automatically on the execution start (before onstart). Default: None</span>
<span class="pl-s">    tstop  - termination / completion time after ondone</span>
<span class="pl-s">    proc  - process of the job, can be used in the ondone() to read it's PIPE</span>
<span class="pl-s">    <span class="pl-pds">"""</span></span></pre></div>

<h3><a id="user-content-task" class="anchor" href="#task" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Task</h3>

<div class="highlight highlight-source-python"><pre>Task(name, <span class="pl-v">timeout</span><span class="pl-k">=</span><span class="pl-c1">0</span>, <span class="pl-v">onstart</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-v">ondone</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-v">params</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-v">stdout</span><span class="pl-k">=</span>sys.stdout, <span class="pl-v">stderr</span><span class="pl-k">=</span>sys.stderr):
    <span class="pl-s"><span class="pl-pds">"""</span>Initialize task, which is a group of jobs to be executed</span>
<span class="pl-s"/>
<span class="pl-s">    name  - task name</span>
<span class="pl-s">    timeout  - execution timeout. Default: 0, means infinity</span>
<span class="pl-s">    onstart  - callback which is executed on the task starting (before the execution</span>
<span class="pl-s">        started) in the CONTEXT OF THE CALLER (main process) with the single argument,</span>
<span class="pl-s">        the task. Default: None</span>
<span class="pl-s">        ATTENTION: must be lightweight</span>
<span class="pl-s">    ondone  - callback which is executed on successful completion of the task in the</span>
<span class="pl-s">        CONTEXT OF THE CALLER (main process) with the single argument, the task. Default: None</span>
<span class="pl-s">        ATTENTION: must be lightweight</span>
<span class="pl-s">    params  - additional parameters to be used in callbacks</span>
<span class="pl-s">    stdout  - None or file name or PIPE for the buffered output to be APPENDED</span>
<span class="pl-s">    stderr  - None or file name or PIPE or STDOUT for the unbuffered error output to be APPENDED</span>
<span class="pl-s">        ATTENTION: PIPE is a buffer in RAM, so do not use it if the output data is huge or unlimited</span>
<span class="pl-s"/>
<span class="pl-s">    tstart  - start time is filled automatically on the execution start (before onstart). Default: None</span>
<span class="pl-s">    tstop  - termination / completion time after ondone</span>
<span class="pl-s">    <span class="pl-pds">"""</span></span></pre></div>

<h3><a id="user-content-execpool" class="anchor" href="#execpool" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>ExecPool</h3>

<div class="highlight highlight-source-python"><pre>ExecPool(<span class="pl-v">workers</span><span class="pl-k">=</span>cpu_count())
    <span class="pl-s"><span class="pl-pds">"""</span>Multi-process execution pool of jobs</span>
<span class="pl-s"/>
<span class="pl-s">    workers  - number of resident worker processes</span>
<span class="pl-s">    <span class="pl-pds">"""</span></span>

    execute(job, <span class="pl-k">async</span><span class="pl-k">=</span><span class="pl-c1">True</span>):
        <span class="pl-s"><span class="pl-pds">"""</span>Schedule the job for the execution</span>
<span class="pl-s"/>
<span class="pl-s">        job  - the job to be executed, instance of Job</span>
<span class="pl-s">        async  - async execution or wait until execution completed</span>
<span class="pl-s">          <span class="pl-k">NOTE</span>: sync tasks are started at once</span>
<span class="pl-s">        return  - 0 on successful execution, proc. returncode otherwise</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>

    join(<span class="pl-v">timeout</span><span class="pl-k">=</span><span class="pl-c1">0</span>):
        <span class="pl-s"><span class="pl-pds">"""</span>Execution cycle</span>
<span class="pl-s"/>
<span class="pl-s">        timeout  - execution timeout in seconds before the workers termination, &gt;= 0.</span>
<span class="pl-s">            0 means absence of the timeout. The time is measured SINCE the first job</span>
<span class="pl-s">            was scheduled UNTIL the completion of all scheduled jobs.</span>
<span class="pl-s">        return  - True on graceful completion, False on termination by the specified timeout</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>

    <span class="pl-c1">__del__</span>():
        <span class="pl-s"><span class="pl-pds">"""</span>Force termination of the pool<span class="pl-pds">"""</span></span>

    __finalize__():
        <span class="pl-s"><span class="pl-pds">"""</span>Force termination of the pool<span class="pl-pds">"""</span></span></pre></div>

<h2><a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage</h2>

<p>Target version of the Python is 2.7+ including 3.x, also works fine on PyPy.</p>

<p>The workflow consists of the following steps:</p>

<ol>
<li>Create Execution Pool.</li>
<li>Create and schedule Jobs with required parameters, callbacks and optionally packing them into Tasks.</li>
<li>Wait on Execution pool until all the jobs are completed or terminated, or until the global timeout is elapsed.</li>
</ol>

<h3><a id="user-content-usage-example" class="anchor" href="#usage-example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage Example</h3>

<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> multiprocessing <span class="pl-k">import</span> cpu_count
<span class="pl-k">from</span> sys <span class="pl-k">import</span> executable <span class="pl-k">as</span> <span class="pl-c1">PYEXEC</span>  <span class="pl-c"># Full path to the current Python interpreter</span>

<span class="pl-c"># 1. Create Multi-process execution pool</span>
execpool <span class="pl-k">=</span> ExecPool(<span class="pl-c1">max</span>(cpu_count() <span class="pl-k">-</span> <span class="pl-c1">1</span>, <span class="pl-c1">1</span>))
global_timeout <span class="pl-k">=</span> <span class="pl-c1">30</span> <span class="pl-k">*</span> <span class="pl-c1">60</span>  <span class="pl-c"># 30 min, timeout to execute all scheduled jobs or terminate them</span>


<span class="pl-c"># 2. Schedule jobs execution in the pool</span>

<span class="pl-c"># 2.a Job scheduling using external executable: "ls -la"</span>
execpool.execute(Job(<span class="pl-v">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>list_dir<span class="pl-pds">'</span></span>, <span class="pl-v">args</span><span class="pl-k">=</span>(<span class="pl-s"><span class="pl-pds">'</span>ls<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>-la<span class="pl-pds">'</span></span>)))


<span class="pl-c"># 2.b Job scheduling using python function / code fragment,</span>
<span class="pl-c"># which is not a goal of the design, but is possible.</span>

<span class="pl-c"># 2.b.1 Create the job with specified parameters</span>
jobname <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>NetShuffling<span class="pl-pds">'</span></span>
jobtimeout <span class="pl-k">=</span> <span class="pl-c1">3</span> <span class="pl-k">*</span> <span class="pl-c1">60</span>  <span class="pl-c"># 3 min</span>

<span class="pl-c"># The network shuffling routine to be scheduled as a job,</span>
<span class="pl-c"># which can also be a call of any external executable (see 2.alt below)</span>
args <span class="pl-k">=</span> (<span class="pl-c1">PYEXEC</span>, <span class="pl-s"><span class="pl-pds">'</span>-c<span class="pl-pds">'</span></span>,
<span class="pl-s"><span class="pl-pds">"""</span>import os</span>
<span class="pl-s">import subprocess</span>
<span class="pl-s"/>
<span class="pl-s">basenet = '<span class="pl-c1">{jobname}</span>' + '<span class="pl-c1">{_EXTNETFILE}</span>'</span>
<span class="pl-s">#print('basenet: ' + basenet, file=sys.stderr)</span>
<span class="pl-s">for i in range(1, <span class="pl-c1">{shufnum}</span> + 1):</span>
<span class="pl-s">    netfile = ''.join(('<span class="pl-c1">{jobname}</span>', '.', str(i), '<span class="pl-c1">{_EXTNETFILE}</span>'))</span>
<span class="pl-s">    if <span class="pl-c1">{overwrite}</span> or not os.path.exists(netfile):</span>
<span class="pl-s">        # sort -R pgp_udir.net -o pgp_udir_rand3.net</span>
<span class="pl-s">        subprocess.call(('sort', '-R', basenet, '-o', netfile))</span>
<span class="pl-s"><span class="pl-pds">"""</span></span>.format(<span class="pl-v">jobname</span><span class="pl-k">=</span>jobname, <span class="pl-v">_EXTNETFILE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>.net<span class="pl-pds">'</span></span>, <span class="pl-v">shufnum</span><span class="pl-k">=</span><span class="pl-c1">5</span>, <span class="pl-v">overwrite</span><span class="pl-k">=</span><span class="pl-c1">False</span>))

<span class="pl-c"># 2.b.2 Schedule the job execution, which might be postponed</span>
<span class="pl-c"># if there are no any free executor processes available</span>
execpool.execute(Job(<span class="pl-v">name</span><span class="pl-k">=</span>jobname, <span class="pl-v">workdir</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>this_sub_dir<span class="pl-pds">'</span></span>, <span class="pl-v">args</span><span class="pl-k">=</span>args, <span class="pl-v">timeout</span><span class="pl-k">=</span>jobtimeout
    <span class="pl-c"># Note: onstart/ondone callbacks, custom parameters and others can be also specified here!</span>
))

<span class="pl-c"># Add another jobs</span>
<span class="pl-c"># ...</span>


<span class="pl-c"># 3. Wait for the jobs execution for the specified timeout at most</span>
execpool.join(global_timeout)  <span class="pl-c"># 30 min</span></pre></div>

<h3><a id="user-content-failover-example" class="anchor" href="#failover-example" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Failover Example</h3>

<p>To perform <em>graceful termination</em> of the Jobs in case of external termination of your program, signal handlers can be set:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> signal  <span class="pl-c"># Intercept kill signals</span>

<span class="pl-c"># Use execpool as a global variable, which is set to None when all jobs are done,</span>
<span class="pl-c"># and recreated on jobs scheduling</span>
execpool <span class="pl-k">=</span> <span class="pl-c1">None</span>

<span class="pl-k">def</span> <span class="pl-en">terminationHandler</span>(<span class="pl-smi">signal</span>, <span class="pl-smi">frame</span>):
    <span class="pl-s"><span class="pl-pds">"""</span>Signal termination handler<span class="pl-pds">"""</span></span>
    <span class="pl-k">global</span> execpool

    <span class="pl-k">if</span> execpool:
        <span class="pl-k">del</span> execpool  <span class="pl-c"># Destructors are called later</span>
    sys.exit(<span class="pl-c1">0</span>)

<span class="pl-c"># Set handlers of external signals, which can be the first lines inside</span>
<span class="pl-c"># if __name__ == '__main__':</span>
signal.signal(signal.<span class="pl-c1">SIGTERM</span>, terminationHandler)
signal.signal(signal.<span class="pl-c1">SIGHUP</span>, terminationHandler)
signal.signal(signal.<span class="pl-c1">SIGINT</span>, terminationHandler)
signal.signal(signal.<span class="pl-c1">SIGQUIT</span>, terminationHandler)
signal.signal(signal.<span class="pl-c1">SIGABRT</span>, terminationHandler)


<span class="pl-c"># Define execpool to schedule some jobs</span>
execpool <span class="pl-k">=</span> ExecPool(<span class="pl-c1">max</span>(cpu_count() <span class="pl-k">-</span> <span class="pl-c1">1</span>, <span class="pl-c1">1</span>))

<span class="pl-c"># Failsafe sage of execpool ...</span></pre></div>

<p><strong>Note:</strong> Please, <a href="//github.com/XI-lab/PyExPool">star this project</a> if you use it.</p>

<h2><a id="user-content-related-projects" class="anchor" href="#related-projects" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Related Projects</h2>

<ul>
<li><a href="https://bitbucket.org/lumais/exectime">ExecTime</a>  -  <em>failover</em> lightweight resource consumption profiler (<em>timings and memory</em>), applicable to multiple processes with optional <em>per-process results labeling</em> and synchronized <em>output to the specified file</em> or <code>stderr</code>: <a href="https://bitbucket.org/lumais/exectime">https://bitbucket.org/lumais/exectime</a></li>
</ul>
</article>
  </div></body></html>