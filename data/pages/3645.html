<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-django-imagekit-cropper" class="anchor" href="#django-imagekit-cropper" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>django-imagekit-cropper</h1>

<p>A library to enhance django-imagekit which allows you to specify your image variant crops:</p>

<p><a href="https://camo.githubusercontent.com/a87715fdf39aca8b59a4d04b5873f627f114e482/68747470733a2f2f7261772e6769746875622e636f6d2f6e696e617061766c6963682f646a616e676f2d696d6167656b69742d63726f707065722f6d61737465722f646f63732f73637265656e73686f74732f63726f705f73637265656e73686f742e706e67" target="_blank"><img src="https://camo.githubusercontent.com/a87715fdf39aca8b59a4d04b5873f627f114e482/68747470733a2f2f7261772e6769746875622e636f6d2f6e696e617061766c6963682f646a616e676f2d696d6167656b69742d63726f707065722f6d61737465722f646f63732f73637265656e73686f74732f63726f705f73637265656e73686f742e706e67" alt="CKEditor Dialog" data-canonical-src="https://raw.github.com/ninapavlich/django-imagekit-cropper/master/docs/screenshots/crop_screenshot.png"/></a></p>

<p><strong>InstanceSpecField</strong> This is a class that extends ImageSpecField which passes the model instance to 
the processors so that you can access other model fields to process the image.</p>

<p><strong>InstanceFormatSpecField</strong> This is a class that extends InstanceSpecField and can dynamically choose the image format (e.g. JPEG, PNG, GIF). PNGs have a much larger file size than JPEGs, but sometimes it's worth the filesize; this allows the admins to control on a per-image basis. Just pass a reference to the model field that returns a PIL-compatible file format.</p>

<p><strong>ImageCropField</strong> This is a custom model field for setting the image crop. This uses a custom
widget to allow admins to visually crop the image.</p>

<p><strong>PositionCrop</strong> This a custom processor which recieves the model instance and crops the image
using the image source and the value of the image crop field.</p>

<p><strong>FormatProcessor</strong> This is a custom processor which implements resizing and outputs to a dynamic format.</p>

<p><strong>PositionAndFormatCrop</strong> This processor extends PositionCrop and also implements dynamic format.</p>

<p><strong>WARNING:</strong> This library is in very early alpha stages. I have only tested this on version django-imagekit==3.2.5</p>

<h2><a id="user-content-example-usage" class="anchor" href="#example-usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example Usage</h2>

<pre><code>    $ pip install django-imagekit-cropper
</code></pre>

<pre><code>    #settings.py

    INSTALLED_APPS = (
        ...
        imagekit_cropper,
        ...
    )
</code></pre>

<div class="highlight highlight-source-python"><pre>    <span class="pl-c">#models.py</span>

    <span class="pl-k">from</span> imagekit_cropper.fields <span class="pl-k">import</span> ImageCropField, InstanceSpecField, InstanceFormatSpecField
    <span class="pl-k">from</span> imagekit_cropper.processors <span class="pl-k">import</span> PositionCrop, PositionAndFormatCrop, FormatProcessor

    image <span class="pl-k">=</span> models.ImageField(<span class="pl-v">blank</span><span class="pl-k">=</span><span class="pl-c1">True</span>, <span class="pl-v">null</span><span class="pl-k">=</span><span class="pl-c1">True</span>)

    <span class="pl-c">#Example 1 - BASIC CROP FIELD</span>
    width_1200_wide_crop_properties <span class="pl-k">=</span> {
        <span class="pl-s"><span class="pl-pds">'</span>source<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>image<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>crop_field<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>width_1200_wide_crop<span class="pl-pds">'</span></span>, 
        <span class="pl-s"><span class="pl-pds">'</span>resize_method<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>:<span class="pl-c1">1200</span>,
        <span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>:<span class="pl-c1">750</span>, 
        <span class="pl-s"><span class="pl-pds">'</span>upscale<span class="pl-pds">'</span></span>:<span class="pl-c1">True</span>
    }
    width_1200_wide_crop <span class="pl-k">=</span> ImageCropField(<span class="pl-v">null</span><span class="pl-k">=</span><span class="pl-c1">True</span>, <span class="pl-v">blank</span><span class="pl-k">=</span><span class="pl-c1">True</span>, 
        <span class="pl-v">properties</span><span class="pl-k">=</span>width_1200_wide_crop_properties)

    width_1200_wide <span class="pl-k">=</span> InstanceSpecField( 
        <span class="pl-v">source</span><span class="pl-k">=</span>width_1200_wide_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>source<span class="pl-pds">'</span></span>], 
        <span class="pl-v">options</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>quality<span class="pl-pds">'</span></span>: <span class="pl-c1">85</span>}, 
        <span class="pl-v">processors</span><span class="pl-k">=</span>[PositionCrop(width_1200_wide_crop_properties)])

    <span class="pl-c">#Example 2 - DYNAMIC FORMAT FIELD</span>


    width_1200_crop_properties <span class="pl-k">=</span> {
        <span class="pl-s"><span class="pl-pds">'</span>source<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>image<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>format_field<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>get_format<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>resize_method<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>fit<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>:<span class="pl-c1">1200</span>,
        <span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>:<span class="pl-c1">None</span>, 
        <span class="pl-s"><span class="pl-pds">'</span>upscale<span class="pl-pds">'</span></span>:<span class="pl-c1">False</span>
    }
    width_1200 <span class="pl-k">=</span> InstanceFormatSpecField( 
        <span class="pl-v">source</span><span class="pl-k">=</span>width_1200_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>source<span class="pl-pds">'</span></span>], 
        <span class="pl-v">format_field</span><span class="pl-k">=</span>width_1200_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>format_field<span class="pl-pds">'</span></span>],
        <span class="pl-v">options</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>quality<span class="pl-pds">'</span></span>: <span class="pl-c1">95</span>}, 
        <span class="pl-v">processors</span><span class="pl-k">=</span>[FormatProcessor(width_1200_crop_properties)])

    use_png <span class="pl-k">=</span> models.BooleanField( <span class="pl-v">default</span> <span class="pl-k">=</span> <span class="pl-c1">False</span>, 
        <span class="pl-v">verbose_name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>Use .PNG (instead of .JPG)<span class="pl-pds">'</span></span>)

    <span class="pl-en">@</span><span class="pl-c1">property</span>
    <span class="pl-k">def</span> <span class="pl-en">get_format</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        <span class="pl-k">if</span> <span class="pl-v">self</span>.use_png:
            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>PNG<span class="pl-pds">'</span></span>
        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>JPEG<span class="pl-pds">'</span></span>


    <span class="pl-c">#Example 3 - TWO SPECS USING THE SAME CROP</span>

    square_crop_properties <span class="pl-k">=</span> {
        <span class="pl-s"><span class="pl-pds">'</span>source<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>image<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>crop_field<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>square_crop<span class="pl-pds">'</span></span>, 
        <span class="pl-s"><span class="pl-pds">'</span>format_field<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>get_format<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>resize_method<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>,
        <span class="pl-s"><span class="pl-pds">'</span>aspect_ratio<span class="pl-pds">'</span></span>:<span class="pl-c1">1</span>,
        <span class="pl-s"><span class="pl-pds">'</span>min_width<span class="pl-pds">'</span></span>:<span class="pl-c1">400</span>,
        <span class="pl-s"><span class="pl-pds">'</span>min_height<span class="pl-pds">'</span></span>:<span class="pl-c1">400</span>,
        <span class="pl-s"><span class="pl-pds">'</span>upscale<span class="pl-pds">'</span></span>:<span class="pl-c1">False</span>
    }
    square_crop <span class="pl-k">=</span> ImageCropField(<span class="pl-v">null</span><span class="pl-k">=</span><span class="pl-c1">True</span>, <span class="pl-v">blank</span><span class="pl-k">=</span><span class="pl-c1">True</span>, <span class="pl-v">properties</span><span class="pl-k">=</span>square_crop_properties)

    square_200_crop_properties <span class="pl-k">=</span> copy.copy(square_crop_properties)
    square_200_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">200</span>
    square_200_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">200</span>

    square_200 <span class="pl-k">=</span> InstanceSpecField(
        <span class="pl-v">format</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>PNG<span class="pl-pds">'</span></span>,
        <span class="pl-v">source</span><span class="pl-k">=</span>square_200_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>source<span class="pl-pds">'</span></span>], 
        <span class="pl-v">options</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>quality<span class="pl-pds">'</span></span>: <span class="pl-c1">85</span>}, 
        <span class="pl-v">processors</span><span class="pl-k">=</span>[PositionCrop(square_200_crop_properties)]
    )

    square_400_crop_properties <span class="pl-k">=</span> copy.copy(square_crop_properties)
    square_400_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">400</span>
    square_400_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">400</span>

    square_400 <span class="pl-k">=</span> InstanceFormatSpecField(
        <span class="pl-v">source</span><span class="pl-k">=</span>square_400_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>source<span class="pl-pds">'</span></span>], 
        <span class="pl-v">format_field</span><span class="pl-k">=</span>square_400_crop_properties[<span class="pl-s"><span class="pl-pds">'</span>format_field<span class="pl-pds">'</span></span>],
        <span class="pl-v">options</span><span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>quality<span class="pl-pds">'</span></span>: <span class="pl-c1">85</span>}, 
        <span class="pl-v">processors</span><span class="pl-k">=</span>[PositionAndFormatCrop(square_400_crop_properties)]
    )
</pre></div>

<div class="highlight highlight-source-python"><pre>    <span class="pl-c">#admin.py</span>

    <span class="pl-k">from</span> .forms <span class="pl-k">import</span> ImageAdminForm

    <span class="pl-k">class</span> <span class="pl-en">ImageAdmin</span>(<span class="pl-e">models</span>.<span class="pl-e">ModelAdmin</span>):
        form <span class="pl-k">=</span> ImageAdminForm
</pre></div>

<div class="highlight highlight-source-python"><pre>    <span class="pl-c">#forms.py</span>

    <span class="pl-k">from</span> django <span class="pl-k">import</span> forms
    <span class="pl-k">from</span> imagekit_cropper.widgets <span class="pl-k">import</span> ImageCropWidget    
    <span class="pl-k">from</span> .models <span class="pl-k">import</span> Image


    <span class="pl-k">class</span> <span class="pl-en">ImageAdminForm</span>(<span class="pl-e">forms</span>.<span class="pl-e">ModelForm</span>):
        square_150_crop <span class="pl-k">=</span> forms.CharField(<span class="pl-v">widget</span><span class="pl-k">=</span>ImageCropWidget(<span class="pl-v">properties</span><span class="pl-k">=</span>Image.square_150_crop_properties, <span class="pl-v">help_text</span><span class="pl-k">=</span>Image.help[<span class="pl-s"><span class="pl-pds">'</span>square_150_crop<span class="pl-pds">'</span></span>]))

        <span class="pl-k">class</span> <span class="pl-en">Meta</span>:
            model <span class="pl-k">=</span> Image
</pre></div>

<p>To generate images, you'll need to use this modified version of the generateimages command:</p>

<pre><code>    $ python manage.py generateimages_cropped
</code></pre>
</article>
  </div></body></html>