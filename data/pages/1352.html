<html><body><div><div class="article__body">
      <p><strong>tl;dr Blaze abstracts tabular computation, providing uniform access to a variety of database technologies</strong></p><h2>Introduction</h2><p>NumPy and Pandas couple a high level interface with fast low-level computation. They allow us to manipulate data intuitively and efficiently.</p><p>Occasionally we run across a dataset that is too big to fit in our computer’s memory. In this case NumPy and Pandas don’t fit our needs and we look to other tools to manage and analyze our data. Popular choices include databases like Postgres and MongoDB, out-of-disk storage systems like PyTables and BColz and the menagerie of tools on top of the Hadoop File System (Hadoop, Spark, Impala and derivatives.) Each of these systems has their own strengths and weaknesses and an experienced data analyst will choose the right tool for the problem at hand. Unfortunately learning how each system works and pushing data into the proper form often takes most of the data scientist’s time.</p><p><em>The startup costs of learning to munge and migrate data between new technologies often dominate biggish-data analytics.</em></p><p>Blaze strives to reduce this friction. Blaze provides a uniform interface to a variety of database technologies and abstractions for migrating data.</p><h2>Expressions</h2><p>At its core, Blaze is a way to express data and computations.</p><p>In the following example we build an abstract table for accounts in a simple bank. We then describe a query, <code>deadbeats</code>, to find the names of the account holders with a negative balance.</p><div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="kn">from</span> <span class="nn">blaze</span> <span class="kn">import</span> <span class="n">TableSymbol</span><span class="p">,</span> <span class="n">compute</span>
<span class="n">accounts</span> <span class="o">=</span> <span class="n">TableSymbol</span><span class="p">(</span><span class="s">'accounts'</span><span class="p">,</span> <span class="s">'{id: int, name: string, amount: int}'</span><span class="p">)</span>
 
<span class="c"># The names of account holders with negative balance</span>
<span class="n">deadbeats</span> <span class="o">=</span> <span class="n">accounts</span><span class="p">[</span><span class="n">accounts</span><span class="p">[</span><span class="s">'amount'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<p>Programmers familiar with Pandas should find the syntax to create <code>deadbeats</code> familiar. Note that we haven’t actually done any work yet. The table <code>accounts</code> is purely imaginary and so the <code>deadbeats</code> expression is just an expression of intent. The Pandas-like syntax builds up a graph of operations to perform later.</p>
<p>However, if we happen to have some similarly shaped data lying around</p>
<div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="n">L</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="s">'Alice'</span><span class="p">,</span>   <span class="mi">100</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s">'Bob'</span><span class="p">,</span>    <span class="o">-</span><span class="mi">200</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s">'Charlie'</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s">'Dennis'</span><span class="p">,</span>  <span class="mi">400</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="s">'Edith'</span><span class="p">,</span>  <span class="o">-</span><span class="mi">500</span><span class="p">]]</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<p>We can combine our expression, <code>deadbeats</code> with our data <code>L</code> to compute an actual result</p>
<div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">compute</span><span class="p">(</span><span class="n">deadbeats</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c"># an iterator as a result</span>
<span class="o">&lt;</span><span class="n">itertools</span><span class="o">.</span><span class="n">imap</span> <span class="n">at</span> <span class="mh">0x7fdd7fcde450</span><span class="o">&gt;</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">compute</span><span class="p">(</span><span class="n">deadbeats</span><span class="p">,</span> <span class="n">L</span><span class="p">))</span>
<span class="p">[</span><span class="s">'Bob'</span><span class="p">,</span> <span class="s">'Edith'</span><span class="p">]</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<p>So in its simplest incarnation, Blaze is a way to write down computations abstractly which can later be applied to real data.</p>
<h3>Multiple Backends - Pandas</h3>
<p>Fortunately the <code>deadbeats</code> expression can run against many different kinds of data. We just computed <code>deadbeats</code> against Python lists, here we compute it against a Pandas DataFrame</p>
<div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="s">'Alice'</span><span class="p">,</span>   <span class="mi">100</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s">'Bob'</span><span class="p">,</span>    <span class="o">-</span><span class="mi">200</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s">'Charlie'</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s">'Dennis'</span><span class="p">,</span>  <span class="mi">400</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="s">'Edith'</span><span class="p">,</span>  <span class="o">-</span><span class="mi">500</span><span class="p">]],</span>
               <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'amount'</span><span class="p">])</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="n">compute</span><span class="p">(</span><span class="n">deadbeats</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="mi">1</span>      <span class="n">Bob</span>
<span class="mi">4</span>    <span class="n">Edith</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<p>Note that Blaze didn’t perform the computation here, Pandas did (it’s good at that), Blaze just told Pandas what to do. Blaze doesn’t compute results; Blaze drives other systems to compute results.</p>
<h3>Multiple Backends - MongoDB</h3>
<p>To demonstrate some breadth, let’s show Blaze driving a Mongo Database.</p>

<pre><code>$ # We install and run MongoDB locally
$ sudo apt-get install mongodb-server
$ mongod <span class="amp">&amp;</span>
$ pip install pymongo
</code></pre>

<div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="kn">import</span> <span class="nn">pymongo</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()</span><span class="o">.</span><span class="n">db</span>
<span class="n">db</span><span class="o">.</span><span class="n">mycollection</span><span class="o">.</span><span class="n">insert</span><span class="p">([{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Alice'</span><span class="p">,</span>   <span class="s">'amount'</span><span class="p">:</span>  <span class="mi">100</span><span class="p">},</span>
                        <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Bob'</span><span class="p">,</span>     <span class="s">'amount'</span><span class="p">:</span> <span class="o">-</span><span class="mi">200</span><span class="p">},</span>
                        <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Charlie'</span><span class="p">,</span> <span class="s">'amount'</span><span class="p">:</span>  <span class="mi">300</span><span class="p">},</span>
                        <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Dennis'</span><span class="p">,</span>  <span class="s">'amount'</span><span class="p">:</span>  <span class="mi">400</span><span class="p">},</span>
                        <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Edith'</span><span class="p">,</span>   <span class="s">'amount'</span><span class="p">:</span> <span class="o">-</span><span class="mi">500</span><span class="p">}])</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="n">compute</span><span class="p">(</span><span class="n">deadbeats</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">mycollection</span><span class="p">)</span>
<span class="p">[</span><span class="s">u'Bob'</span><span class="p">,</span> <span class="s">u'Edith'</span><span class="p">]</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<h2>Recap</h2>
<p>To remind you we created a single Blaze query</p>
<div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="n">accounts</span> <span class="o">=</span> <span class="n">TableSymbol</span><span class="p">(</span><span class="s">'accounts'</span><span class="p">,</span> <span class="s">'{id: int, name: string, amount: int}'</span><span class="p">)</span>
<span class="n">deadbeats</span> <span class="o">=</span> <span class="n">accounts</span><span class="p">[</span><span class="n">accounts</span><span class="p">[</span><span class="s">'amount'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<p>And then executed that same query against multiple backends</p>
<div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">compute</span><span class="p">(</span><span class="n">deadbeats</span><span class="p">,</span> <span class="n">L</span><span class="p">))</span>          <span class="c"># Python</span>
<span class="p">[</span><span class="s">'Bob'</span><span class="p">,</span> <span class="s">'Edith'</span><span class="p">]</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="n">compute</span><span class="p">(</span><span class="n">deadbeats</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>               <span class="c"># Pandas</span>
<span class="mi">1</span>      <span class="n">Bob</span>
<span class="mi">4</span>    <span class="n">Edith</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="n">compute</span><span class="p">(</span><span class="n">deadbeats</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">mycollection</span><span class="p">)</span>  <span class="c"># MongoDB</span>
<span class="p">[</span><span class="s">u'Bob'</span><span class="p">,</span> <span class="s">u'Edith'</span><span class="p">]</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<p>At the time of this writing Blaze supports the following backends</p>
<ul><li>Pure Python</li><li>Pandas</li><li>MongoDB</li><li><span class="caps">SQL</span></li><li>PySpark</li><li>PyTables</li><li>BColz</li></ul>
<h2>Interactivity</h2>
<p>The separation of expressions and computation is core to Blaze. It’s also confusing for new Blaze users. NumPy and Pandas demonstrated the value of immediate data interaction and having to explicitly call <code>compute</code> is a step backward from that goal.</p>
<p>To this end we create the <code>Table</code> abstraction, a <code>TableSymbol</code> that knows about a particular data resource. Operations on this <code>Table</code> object produce abstract expressions just like normal, but statements that would normally print results to the screen initiate calls to <code>compute</code> and then print those results, giving an interactive feel in a console or notebook</p>
<div class="codebox"><figure class="code"><div class="highlight">
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">blaze</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">mycollection</span><span class="p">)</span>  <span class="c"># give MongoDB resource to Table</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span>
   <span class="n">amount</span>  <span class="nb">id</span>     <span class="n">name</span>
<span class="mi">0</span>     <span class="mi">100</span>   <span class="mi">1</span>    <span class="n">Alice</span>
<span class="mi">1</span>    <span class="o">-</span><span class="mi">200</span>   <span class="mi">2</span>      <span class="n">Bob</span>
<span class="mi">2</span>     <span class="mi">300</span>   <span class="mi">3</span>  <span class="n">Charlie</span>
<span class="mi">3</span>     <span class="mi">400</span>   <span class="mi">4</span>   <span class="n">Dennis</span>
<span class="mi">4</span>    <span class="o">-</span><span class="mi">500</span>   <span class="mi">5</span>    <span class="n">Edith</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
   <span class="n">amount</span>  <span class="nb">id</span>   <span class="n">name</span>
<span class="mi">0</span>    <span class="o">-</span><span class="mi">200</span>   <span class="mi">2</span>    <span class="n">Bob</span>
<span class="mi">1</span>    <span class="o">-</span><span class="mi">500</span>   <span class="mi">5</span>  <span class="n">Edith</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">])</span>        <span class="c"># Still just an expression</span>
<span class="n">blaze</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Selection</span>
 
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">])</span>  <span class="c"># repr triggers call to compute</span>
   <span class="n">amount</span>  <span class="nb">id</span>   <span class="n">name</span>
<span class="mi">0</span>    <span class="o">-</span><span class="mi">200</span>   <span class="mi">2</span>    <span class="n">Bob</span>
<span class="mi">1</span>    <span class="o">-</span><span class="mi">500</span>   <span class="mi">5</span>  <span class="n">Edith</span>
</pre>
</div> 
<figcaption>Python</figcaption></figure></div>
<p>These expressions generate the appropriate MongoDB queries, call <code>compute</code> only when we print a result to the screen, and then push the result into a <code>DataFrame</code> to use Pandas’ excellent tabular printing. For large datasets we always append a <code>.head(10)</code> call to the expression to only retrieve the sample of the output necessary to print to the screen; this avoids large data transfers when not necessary.</p>
<p>Using the interactive <code>Table</code> object we can interact with a variety of computational backends with the familiarity of a local DataFrame.</p>
<h2>More Information</h2>
  </div>

        
  
</div></body></html>