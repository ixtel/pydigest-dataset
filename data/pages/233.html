<html><body><div><header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"/> <time datetime="2013-12-14T10:10:19-07:00" pubdate="" data-updated="true">Dec 14<sup>th</sup>, 2013</time>
        
           | <a href="#disqus_thread" data-disqus-identifier="https://realpython.com">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title">
        Rethink Flask - a Simple Todo List Powered by Flask and RethinkDB
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><p>After a number of requests for a basic <a href="http://flask.pocoo.org/">Flask</a> and <a href="http://www.rethinkdb.com/">RethinkDB</a> template, I decided to go ahead and write a blog post. This is that post.</p>

<blockquote><p>BTW: We always welcome requests. If you have something you’d like us to write about, or build, shoot us an email.</p></blockquote>

<p>Today we’ll be creating a <em>simple</em> todo list, which you’ll be able to modify to meet your own needs. Before beginning, I highly suggest reading over <a href="http://www.rethinkdb.com/docs/rethinkdb-vs-mongodb/">this</a> article, which details how RethinkDB differs from some of the other NoSQL databases.</p>

<a name="Set.up.RethinkDB"/>
<h2>Set up RethinkDB</h2>

<a name="Install"/>
<h3>Install</h3>

<p>Navigate <a href="http://www.rethinkdb.com/docs/install/">here</a> and download the appropriate package for your system. I used Homebrew – <code>$ brew install rethinkdb</code> – and it took almost twenty minutes to download and install the build:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="o">==</span>&gt; Installing <span class="nv">rethinkdb</span>
</span><span class="line"><span class="o">==</span>&gt; Downloading http://download.rethinkdb.com/dist/rethinkdb-     1.11.2.tgz
</span><span class="line"><span class="c">######################################################################## 100.0%</span>
</span><span class="line"><span class="o">==</span>&gt; ./configure --prefix<span class="o">=</span>/usr/local/Cellar/rethinkdb/1.11.2 --  fetch v8 --fetch <span class="nv">protobuf</span>
</span><span class="line"><span class="o">==</span>&gt; <span class="nv">make</span>
</span><span class="line"><span class="o">==</span>&gt; make install-osx
</span><span class="line"><span class="o">==</span>&gt; Caveats
</span><span class="line">To have launchd start rethinkdb at login:
</span><span class="line">  ln -sfv /usr/local/opt/rethinkdb/*.plist   ~/Library/LaunchAgents
</span><span class="line">Then to load rethinkdb now:
</span><span class="line">  launchctl load   ~/Library/LaunchAgents/homebrew.mxcl.rethinkdb.plist
</span><span class="line"><span class="o">==</span>&gt; Summary
</span><span class="line">đş  /usr/local/Cellar/rethinkdb/1.11.2: 174 files, 29M, built in   19.7 minutes
</span></code></pre></td></tr></table></div></figure>


<a name="Install.the.Python.drivers.globally:"/>
<h3>Install the Python drivers globally:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>sudo pip install rethinkdb
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Note: I installed Rethink globally (outside of a virtualenv) since I’ll probably use the same version with a number of projects, with a number of different languages. We will be installing in within a virtualenv later on in this tutorial.</p></blockquote>

<a name="Test"/>
<h3>Test</h3>

<p>First, let’s start the server with the following command:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>If all is installed correctly, you should see something similar to:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">info: Creating directory /Users/michaelherman/rethinkdb_data
</span><span class="line">info: Creating a default database <span class="k">for </span>your convenience. <span class="o">(</span>This is because you ran <span class="s1">'rethinkdb'</span> without <span class="s1">'create'</span>, <span class="s1">'serve'</span>, or <span class="s1">'--join'</span>, and the directory <span class="s1">'/Users/michaelherman/rethinkdb_data'</span> did not already exist.<span class="o">)</span>
</span><span class="line">info: Running rethinkdb 1.11.2 <span class="o">(</span>CLANG 4.2 <span class="o">(</span>clang-425.0.28<span class="o">))</span>...
</span><span class="line">info: Running on Darwin 12.4.0 x86_64
</span><span class="line">info: Loading data from directory    /Users/michaelherman/rethinkdb_data
</span><span class="line">info: Listening <span class="k">for </span>intracluster connections on port 29015
</span><span class="line">info: Listening <span class="k">for </span>client driver connections on port 28015
</span><span class="line">info: Listening <span class="k">for </span>administrative HTTP connections on port 8080
</span><span class="line">info: Listening on addresses: 127.0.0.1, ::1
</span><span class="line">info: To fully expose RethinkDB on the network, <span class="nb">bind </span>to all addresses
</span><span class="line">info: by running rethinkdb with the <span class="sb">`</span>--bind all<span class="sb">`</span> <span class="nb">command </span>line option.
</span><span class="line">info: Server ready
</span></code></pre></td></tr></table></div></figure>


<p>Then test the connection. Open a new window in your terminal and enter the following commands:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python
</span><span class="line">&gt;&gt;&gt; import rethinkdb
</span><span class="line">&gt;&gt;&gt; rethinkdb.connect<span class="o">(</span><span class="s1">'localhost'</span>, 28015<span class="o">)</span>.repl<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should see:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">&lt;rethinkdb.net.Connection object at 0x101122410&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Exit the Python shell but leave the RethinkDB server running in the other terminal window.</p>

<a name="Set.up.a.Basic.Flask.project"/>
<h2>Set up a Basic Flask project</h2>

<a name="Create.a.directory.to.store.your.project:"/>
<h3>Create a directory to store your project:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>mkdir flask-rethink
</span><span class="line"><span class="nv">$ </span><span class="nb">cd </span>flask-rethink
</span></code></pre></td></tr></table></div></figure>


<a name="Set.up.and.activate.a.virtualenv:"/>
<h3>Set up and activate a virtualenv:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>virtualenv --no-site-packages env
</span><span class="line"><span class="nv">$ </span><span class="nb">source </span>env/bin/activate
</span></code></pre></td></tr></table></div></figure>


<a name="Install.Flask.and.Flask-WTF:"/>
<h3>Install Flask and Flask-WTF:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>pip install flask
</span><span class="line"><span class="nv">$ </span>pip install flask-wtf
</span></code></pre></td></tr></table></div></figure>


<a name="Create.a.requirements:"/>
<h3>Create a requirements:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<a name="Download.the.Flask.boilerplate"/>
<h3>Download the Flask boilerplate</h3>

<p>Found in the template directory of <a href="https://github.com/mjhea0/flask-rethink">this</a> repo.</p>

<a name="Your.project.structure.should.now.look.like.this:"/>
<h3>Your project structure should now look like this:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">.
</span><span class="line">âââ app
</span><span class="line">âÂ Â  âââ __init__.py
</span><span class="line">âÂ Â  âââ forms.py
</span><span class="line">âÂ Â  âââ models.py
</span><span class="line">âÂ Â  âââ templates
</span><span class="line">âÂ Â  âÂ Â  âââ base.html
</span><span class="line">âÂ Â  âÂ Â  âââ index.html
</span><span class="line">âÂ Â  âââ views.py
</span><span class="line">âââ readme.md
</span><span class="line">âââ requirements.txt
</span><span class="line">âââ run.py
</span></code></pre></td></tr></table></div></figure>


<a name="Run.the.app:"/>
<h3>Run the app:</h3>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>Navigate to <a href="http://localhost:5000/">http://localhost:5000/</a>, and you should see:</p>

<p><img src="https://raw.github.com/mjhea0/flask-rethink/master/main.png" alt="main"/></p>

<p>Don’t try to submit anything yet, because we need to get a database setup first. Let’s get RethinkDB going.</p>

<a name="RethinkDB.Config"/>
<h2>RethinkDB Config</h2>

<a name="Install.RethinkDB:"/>
<h3>Install RethinkDB:</h3>

<figure class="code"><figcaption><span/></figcaption></figure>


<a name="Add.the.following.code.to..views.py.:"/>
<h3>Add the following code to “views.py”:</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># rethink imports</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">rethinkdb</span> <span class="kn">as</span> <span class="nn">r</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">rethinkdb.errors</span> <span class="kn">import</span> <span class="n">RqlRuntimeError</span>
</span><span class="line">
</span><span class="line"><span class="c"># rethink config</span>
</span><span class="line"><span class="n">RDB_HOST</span> <span class="o">=</span>  <span class="s">'localhost'</span>
</span><span class="line"><span class="n">RDB_PORT</span> <span class="o">=</span> <span class="mi">28015</span>
</span><span class="line"><span class="n">TODO_DB</span> <span class="o">=</span> <span class="s">'todo'</span>
</span><span class="line">
</span><span class="line"><span class="c"># db setup; only run once</span>
</span><span class="line"><span class="k">def</span> <span class="nf">dbSetup</span><span class="p">():</span>
</span><span class="line">    <span class="n">connection</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">RDB_HOST</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">RDB_PORT</span><span class="p">)</span>
</span><span class="line">    <span class="k">try</span><span class="p">:</span>
</span><span class="line">        <span class="n">r</span><span class="o">.</span><span class="n">db_create</span><span class="p">(</span><span class="n">TODO_DB</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
</span><span class="line">        <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">TODO_DB</span><span class="p">)</span><span class="o">.</span><span class="n">table_create</span><span class="p">(</span><span class="s">'todos'</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
</span><span class="line">        <span class="k">print</span> <span class="s">'Database setup completed'</span>
</span><span class="line">    <span class="k">except</span> <span class="n">RqlRuntimeError</span><span class="p">:</span>
</span><span class="line">        <span class="k">print</span> <span class="s">'Database already exists.'</span>
</span><span class="line">    <span class="k">finally</span><span class="p">:</span>
</span><span class="line">        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line"><span class="n">dbSetup</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="c"># open connection before each request</span>
</span><span class="line"><span class="nd">@app.before_request</span>
</span><span class="line"><span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
</span><span class="line">    <span class="k">try</span><span class="p">:</span>
</span><span class="line">        <span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">RDB_HOST</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">RDB_PORT</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">TODO_DB</span><span class="p">)</span>
</span><span class="line">    <span class="k">except</span> <span class="n">RqlDriverError</span><span class="p">:</span>
</span><span class="line">        <span class="n">abort</span><span class="p">(</span><span class="mi">503</span><span class="p">,</span> <span class="s">"Database connection could be established."</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c"># close the connection after each request</span>
</span><span class="line"><span class="nd">@app.teardown_request</span>
</span><span class="line"><span class="k">def</span> <span class="nf">teardown_request</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
</span><span class="line">    <span class="k">try</span><span class="p">:</span>
</span><span class="line">        <span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line">    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span class="line">        <span class="k">pass</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check the comments for a brief explanation of what each of the functions do.</p>

<a name="Start.your.server.again."/>
<h3>Start your server again.</h3>

<p>You should see the following alert in your terminal:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">Database setup completed
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>If you see this error <code>rethinkdb.errors.RqlDriverError: Could not connect to localhost:28015.</code> your RethinkDB server is not running. Open up a new terminal window and run <code>$ rethinkdb</code>.</p></blockquote>

<p>So, we created a new database called “todo”, which has a table called “todos”.</p>

<p>You can verify this in the RethinkDB Admin. Navigate to <a href="http://localhost:8080/">http://localhost:8080/</a>. The admin should load. If you click “Tables”, you should see the database and table we created:</p>

<p><img src="https://raw.github.com/mjhea0/flask-rethink/master/rethink-admin.png" alt="rethink-admin"/></p>

<a name="Display.Todos"/>
<h3>Display Todos</h3>

<p>With the database setup, let’s add code to display todos. Update the <code>index()</code> function in “views.py”:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="nd">@app.route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class="line">    <span class="n">form</span> <span class="o">=</span> <span class="n">TaskForm</span><span class="p">()</span>
</span><span class="line">    <span class="n">selection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">'todos'</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">))</span>
</span><span class="line">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">tasks</span><span class="o">=</span><span class="n">selection</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we’re selecting the “todos” table, pulling all of the data, which is in JSON, and passing the entire table to the template.</p>

<a name="Add.data.manually"/>
<h3>Add data manually</h3>

<p>Before we can view any todos, we need to add some first. Let’s go through the shell and add them in manually.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python
</span><span class="line">&gt;&gt;&gt; import rethinkdb
</span><span class="line">&gt;&gt;&gt; <span class="nv">conn</span> <span class="o">=</span> rethinkdb.connect<span class="o">(</span><span class="nv">db</span><span class="o">=</span><span class="s1">'todo'</span><span class="o">)</span>
</span><span class="line">&gt;&gt;&gt; rethinkdb.table<span class="o">(</span><span class="s1">'todos'</span><span class="o">)</span>.insert<span class="o">({</span><span class="s1">'name'</span>:<span class="s1">'sail to the moon'</span><span class="o">})</span>.run<span class="o">(</span>conn<span class="o">)</span>
</span><span class="line"><span class="o">{</span>u<span class="s1">'errors'</span>: 0, u<span class="s1">'deleted'</span>: 0, u<span class="s1">'generated_keys'</span>: <span class="o">[</span>u<span class="s1">'c5562325-c5a1-4a78-8232-c0de4f500aff'</span><span class="o">]</span>, u<span class="s1">'unchanged'</span>: 0, u<span class="s1">'skipped'</span>: 0, u<span class="s1">'replaced'</span>: 0, u<span class="s1">'inserted'</span>: 1<span class="o">}</span>
</span><span class="line">&gt;&gt;&gt; rethinkdb.table<span class="o">(</span><span class="s1">'todos'</span><span class="o">)</span>.insert<span class="o">({</span><span class="s1">'name'</span>:<span class="s1">'jump in the ocean'</span><span class="o">})</span>.run<span class="o">(</span>conn<span class="o">)</span>
</span><span class="line"><span class="o">{</span>u<span class="s1">'errors'</span>: 0, u<span class="s1">'deleted'</span>: 0, u<span class="s1">'generated_keys'</span>: <span class="o">[</span>u<span class="s1">'0a3e3658-4513-48cb-bc68-5af247269ee4'</span><span class="o">]</span>, u<span class="s1">'unchanged'</span>: 0, u<span class="s1">'skipped'</span>: 0, u<span class="s1">'replaced'</span>: 0, u<span class="s1">'inserted'</span>: 1<span class="o">}</span>
</span><span class="line">&gt;&gt;&gt; rethinkdb.table<span class="o">(</span><span class="s1">'todos'</span><span class="o">)</span>.insert<span class="o">({</span><span class="s1">'name'</span>:<span class="s1">'think of another todo'</span><span class="o">})</span>.run<span class="o">(</span>conn<span class="o">)</span>
</span><span class="line"><span class="o">{</span>u<span class="s1">'errors'</span>: 0, u<span class="s1">'deleted'</span>: 0, u<span class="s1">'generated_keys'</span>: <span class="o">[</span>u<span class="s1">'b154a036-3c3b-47f4-89ec-cb9f4eff5f5a'</span><span class="o">]</span>, u<span class="s1">'unchanged'</span>: 0, u<span class="s1">'skipped'</span>: 0, u<span class="s1">'replaced'</span>: 0, u<span class="s1">'inserted'</span>: 1<span class="o">}</span>
</span><span class="line">&gt;&gt;&gt;
</span></code></pre></td></tr></table></div></figure>


<p>So, we connected to the database, then entered three new objects into the table within the database. <em>Check the API <a href="http://www.rethinkdb.com/api/python/">docs</a> for more information.</em></p>

<p>Fire up the server. You should now see the three tasks:</p>

<p><img src="https://raw.github.com/mjhea0/flask-rethink/master/tasks.png" alt="tasks"/></p>

<a name="Finalize.the.form"/>
<h3>Finalize the form</h3>

<p>Update the <code>index()</code> function again to pull the data from the form and add it to the database:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="nd">@app.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
</span><span class="line"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class="line">    <span class="n">form</span> <span class="o">=</span> <span class="n">TaskForm</span><span class="p">()</span>
</span><span class="line">      <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
</span><span class="line">          <span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">'todos'</span><span class="p">)</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">"name"</span><span class="p">:</span><span class="n">form</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">data</span><span class="p">})</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">)</span>
</span><span class="line">          <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'index'</span><span class="p">))</span>
</span><span class="line">      <span class="n">selection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">'todos'</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">rdb_conn</span><span class="p">))</span>
</span><span class="line">      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">,</span> <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="p">,</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">selection</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test this out. Add some todos. Go crazy.</p>

<a name="Challenges"/>
<h2>Challenges</h2>

<p>The current app is functional, but there’s a lot more we can do. Take this app to the next level.</p>

<p>Here’s a few ideas:</p>

<ol>
<li>Add a user login.</li>
<li>Create a more robust form, where you can add a due date for each todo, and then sort the todos by that date before rendering them to the DOM.</li>
<li>Add functional and unit tests.</li>
<li>Add the ability to create sub tasks for each task.</li>
<li>Read over the API reference <a href="http://www.rethinkdb.com/api/python/">docs</a>. Play around with various methods.</li>
<li>Modularize the app.</li>
<li>Refactor the code. Show off your new code to RethinkDB.</li>
</ol>


<p>What else would you like to see? Interested in seeing a part 2? How do you like RethinkDB in comparison to MongoDB? Share your thoughts below.</p>

<p>You can grab all the code from the <a href="https://github.com/mjhea0/flask-rethink">repo</a>. Cheers!</p>
</div>


      </div></body></html>