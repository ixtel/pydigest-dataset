<html><body><div><article class="post-content">
    <h1 id="sections">Sections</h1>



<h2 id="the-c3-class-resolution-algorithm-for-multiple-class-inheritance">The C3 class resolution algorithm for multiple class inheritance</h2>

<p>If we are dealing with multiple inheritance, according to the newer C3 class resolution algorithm, the following applies:<br/>
Assuming that child class C inherits from two parent classes A and B, “class A should be checked before class B”.</p>

<p>If you want to learn more, please read the <a href="http://python-history.blogspot.ru/2010/06/method-resolution-order.html">original blog</a> post by Guido van Rossum.</p>

<p>(Original source: <a href="http://gistroll.com/rolls/21/horizontal_assessments/new">http://gistroll.com/rolls/21/horizontal_assessments/new</a>)</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"class A"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"class B"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">C</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
</code></pre>
</div>



<p>So what actually happened above was that class <code class="highlighter-rouge">C</code> looked in the scope of the parent class <code class="highlighter-rouge">A</code> for the method <code class="highlighter-rouge">.foo()</code> first (and found it)!</p>

<p>I received an email containing a suggestion which uses a more nested example to illustrate Guido van Rossum’s point a little bit better:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span><span class="p">(</span><span class="s">"class A"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
   <span class="k">pass</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span><span class="p">(</span><span class="s">"class C"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">):</span>
   <span class="k">pass</span>

<span class="n">D</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
</code></pre>
</div>



<p>Here, class <code class="highlighter-rouge">D</code> searches in <code class="highlighter-rouge">B</code> first, which in turn inherits from <code class="highlighter-rouge">A</code> (note that class <code class="highlighter-rouge">C</code> also inherits from <code class="highlighter-rouge">A</code>, but has its own <code class="highlighter-rouge">.foo()</code> method) so that we come up with the search order: <code class="highlighter-rouge">D, B, C, A</code>.</p>

<p><a name="pm_in_lists"/>
<br/>
<br/></p>

<h2 id="assignment-operators-and-lists---simple-add-vs-add-and-operators">Assignment operators and lists - simple-add vs. add-AND operators</h2>

<p>Python <code class="highlighter-rouge">list</code>s are mutable objects as we all know. So, if we are using the <code class="highlighter-rouge">+=</code> operator on <code class="highlighter-rouge">list</code>s, we extend the <code class="highlighter-rouge">list</code> by directly modifying the object directly.</p>

<p>However, if we use the assignment via <code class="highlighter-rouge">my_list = my_list + ...</code>, we create a new list object, which can be demonstrated by the following code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">a_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">print</span><span class="p">(</span><span class="s">'ID:'</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">a_list</span><span class="p">))</span>

<span class="n">a_list</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">'ID (+=):'</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">a_list</span><span class="p">))</span>

<span class="n">a_list</span> <span class="o">=</span> <span class="n">a_list</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">'ID (list = list + ...):'</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">a_list</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>ID: 4366496544
ID (+=): 4366496544
ID (list = list + ...): 4366495472
</code></pre>
</div>

<p>Just for reference, the <code class="highlighter-rouge">.append()</code> and <code class="highlighter-rouge">.extends()</code> methods are modifying the <code class="highlighter-rouge">list</code> object in place, just as expected.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">a_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">print</span><span class="p">(</span><span class="n">a_list</span><span class="p">,</span> <span class="s">'</span><span class="se">\n</span><span class="s">ID (initial):'</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="n">a_list</span><span class="p">),</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

<span class="n">a_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a_list</span><span class="p">,</span> <span class="s">'</span><span class="se">\n</span><span class="s">ID (append):'</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="n">a_list</span><span class="p">),</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

<span class="n">a_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">a_list</span><span class="p">,</span> <span class="s">'</span><span class="se">\n</span><span class="s">ID (extend):'</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="n">a_list</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>[]
ID (initial): 140704077653128

[1]
ID (append): 140704077653128

[1, 2]
ID (extend): 140704077653128
</code></pre>
</div>

<h2 id="true-and-false-in-the-datetime-module"><code class="highlighter-rouge">True</code> and <code class="highlighter-rouge">False</code> in the datetime module</h2>

<p>“It often comes as a big surprise for programmers to find (sometimes by way of a hard-to-reproduce bug) that, unlike any other time value, midnight (i.e. <code class="highlighter-rouge">datetime.time(0,0,0)</code>) is False. A long discussion on the python-ideas mailing list shows that, while surprising, that behavior is desirable—at least in some quarters.”</p>

<p>(Original source: <a href="http://lwn.net/SubscriberLink/590299/bf73fe823974acea/">http://lwn.net/SubscriberLink/590299/bf73fe823974acea/</a>)</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">print</span><span class="p">(</span><span class="s">'"datetime.time(0,0,0)" (Midnight) -&gt;'</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>

<span class="k">print</span><span class="p">(</span><span class="s">'"datetime.time(1,0,0)" (1 am) -&gt;'</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>"datetime.time(0,0,0)" (Midnight) -&gt; False
"datetime.time(1,0,0)" (1 am) -&gt; True
</code></pre>
</div>

<h2 id="python-reuses-objects-for-small-integers---use--for-equality-is-for-identity">Python reuses objects for small integers - use “==” for equality, “is” for identity</h2>

<p>This oddity occurs, because Python keeps an array of small integer objects (i.e., integers between -5 and 256, <a href="https://docs.python.org/2/c-api/int.html#PyInt_FromLong">see the doc</a>).</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="s">'a is b'</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="n">b</span><span class="p">))</span>
<span class="bp">True</span>

<span class="n">c</span> <span class="o">=</span> <span class="mi">999</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">999</span>
<span class="k">print</span><span class="p">(</span><span class="s">'c is d'</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">c</span> <span class="ow">is</span> <span class="n">d</span><span class="p">))</span>
</code></pre>
</div>



<p>(<em>I received a comment that this is in fact a CPython artefact and</em> <strong>must not necessarily be true</strong> <em>in all implementations of Python!</em>)</p>

<p>So the take home message is: always use “==” for equality, “is” for identity!</p>

<p>Here is a <a href="http://python.net/%7Egoodger/projects/pycon/2007/idiomatic/handout.html#other-languages-have-variables">nice article</a> explaining it by comparing “boxes” (C language) with “name tags” (Python).</p>

<p>This example demonstrates that this applies  indeed for integers in the range in -5 to 256:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'256 is 257-1'</span><span class="p">,</span> <span class="mi">256</span> <span class="ow">is</span> <span class="mi">257</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'257 is 258-1'</span><span class="p">,</span> <span class="mi">257</span> <span class="ow">is</span> <span class="mi">258</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'-5 is -6+1'</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span> <span class="ow">is</span> <span class="o">-</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'-7 is -6-1'</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span> <span class="ow">is</span> <span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>256 is 257-1 True
257 is 258-1 False
-5 is -6+1 True
-7 is -6-1 False
</code></pre>
</div>

<h4 id="and-to-illustrate-the-test-for-equality--vs-identity-is">And to illustrate the test for equality (<code class="highlighter-rouge">==</code>) vs. identity (<code class="highlighter-rouge">is</code>):</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="s">'hello world!'</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">'hello world!'</span>
<span class="k">print</span><span class="p">(</span><span class="s">'a is b,'</span><span class="p">,</span> <span class="n">a</span> <span class="ow">is</span> <span class="n">b</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'a == b,'</span><span class="p">,</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>a is b, False
a == b, True
</code></pre>
</div>

<p>We would think that identity would always imply equality, but this is not always true, as we can see in the next example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">'nan'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'a is a,'</span><span class="p">,</span> <span class="n">a</span> <span class="ow">is</span> <span class="n">a</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'a == a,'</span><span class="p">,</span> <span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>a is a, True
a == a, False
</code></pre>
</div>

<h2 id="shallow-vs-deep-copies-if-list-contains-other-structures-and-objects">Shallow vs. deep copies if list contains other structures and objects</h2>

<p><strong>Shallow copy</strong>:<br/>
If we use the assignment operator to assign one list to another list, we just create a new name reference to the original list. If we want to create a new list object, we have to make a copy of the original list. This can be done via <code class="highlighter-rouge">a_list[:]</code> or <code class="highlighter-rouge">a_list.copy()</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">list2</span> <span class="o">=</span> <span class="n">list1</span>        <span class="c"># reference</span>
<span class="n">list3</span> <span class="o">=</span> <span class="n">list1</span><span class="p">[:]</span>     <span class="c"># shallow copy</span>
<span class="n">list4</span> <span class="o">=</span> <span class="n">list1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c"># shallow copy</span>

<span class="k">print</span><span class="p">(</span><span class="s">'IDs:</span><span class="se">\n</span><span class="s">list1: {}</span><span class="se">\n</span><span class="s">list2: {}</span><span class="se">\n</span><span class="s">list3: {}</span><span class="se">\n</span><span class="s">list4: {}</span><span class="se">\n</span><span class="s">'</span>
      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">list1</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">list2</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">list3</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">list4</span><span class="p">)))</span>

<span class="n">list2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">print</span><span class="p">(</span><span class="s">'list1:'</span><span class="p">,</span> <span class="n">list1</span><span class="p">)</span>

<span class="n">list3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">list4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="k">print</span><span class="p">(</span><span class="s">'list1:'</span><span class="p">,</span> <span class="n">list1</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>IDs:
list1: 4346366472
list2: 4346366472
list3: 4346366408
list4: 4346366536

list1: [3, 2]
list1: [3, 2]
</code></pre>
</div>

<p><strong>Deep copy</strong><br/>
As we have seen above, a shallow copy works fine if we want to create a new list with contents of the original list which we want to modify independently.</p>

<p>However, if we are dealing with compound objects (e.g., lists that contain other lists, <a href="https://docs.python.org/2/library/copy.html">read here</a> for more information) it becomes a little trickier.</p>

<p>In the case of compound objects, a shallow copy would create a new compound object, but it would just insert the references to the contained objects into the new compound object. In contrast, a deep copy would go “deeper” and create also new objects <br/>
for the objects found in the original compound object.
If you follow the code, the concept should become more clear:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="n">list1</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">list2</span> <span class="o">=</span> <span class="n">list1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    <span class="c"># shallow copy</span>
<span class="n">list3</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span> <span class="c"># deep copy</span>

<span class="k">print</span><span class="p">(</span><span class="s">'IDs:</span><span class="se">\n</span><span class="s">list1: {}</span><span class="se">\n</span><span class="s">list2: {}</span><span class="se">\n</span><span class="s">list3: {}</span><span class="se">\n</span><span class="s">'</span>
      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">list1</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">list2</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">list3</span><span class="p">)))</span>

<span class="n">list2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">print</span><span class="p">(</span><span class="s">'list1:'</span><span class="p">,</span> <span class="n">list1</span><span class="p">)</span>

<span class="n">list3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">print</span><span class="p">(</span><span class="s">'list1:'</span><span class="p">,</span> <span class="n">list1</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>IDs:
list1: 4377956296
list2: 4377961752
list3: 4377954928

list1: [[3], [2]]
list1: [[3], [2]]
</code></pre>
</div>

<h2 id="picking-true-values-from-logical-ands-and-ors">Picking <code class="highlighter-rouge">True</code> values from logical <code class="highlighter-rouge">and</code>s and <code class="highlighter-rouge">or</code>s</h2>

<p><strong>Logical <code class="highlighter-rouge">or</code>:</strong></p>

<p><code class="highlighter-rouge">a or b == a if a else b</code><br/>
- If both values in <code class="highlighter-rouge">or</code> expressions are <code class="highlighter-rouge">True</code>, Python will select the first value (e.g., select <code class="highlighter-rouge">"a"</code> in <code class="highlighter-rouge">"a" or "b"</code>), and the second one in <code class="highlighter-rouge">and</code> expressions.<br/>
This is also called <strong>short-circuiting</strong> - we already know that the logical <code class="highlighter-rouge">or</code> must be <code class="highlighter-rouge">True</code> if the first value is <code class="highlighter-rouge">True</code> and therefore can omit the evaluation of the second value.</p>

<p><strong>Logical <code class="highlighter-rouge">and</code>:</strong></p>

<p><code class="highlighter-rouge">a and b == b if a else a</code><br/>
- If both values in <code class="highlighter-rouge">and</code> expressions are <code class="highlighter-rouge">True</code>, Python will select the second value, since for a logical <code class="highlighter-rouge">and</code>, both values must be true.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="ow">or</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="ow">and</span> <span class="mi">7</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'2 * 7 ='</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</code></pre>
</div>



<h2 id="dont-use-mutable-objects-as-default-arguments-for-functions">Don’t use mutable objects as default arguments for functions!</h2>

<p>Don’t use mutable objects (e.g., dictionaries, lists, sets, etc.) as default arguments for functions! You might expect that a new list is created every time when we call the function without providing an argument for the default parameter, but this is not the case: <strong>Python will create the mutable object (default parameter) the first time the function is defined - not when it is called</strong>, see the following code:</p>

<p>(Original source: <a href="http://docs.python-guide.org/en/latest/writing/gotchas/">http://docs.python-guide.org/en/latest/writing/gotchas/</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">append_to_list</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">def_list</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">def_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">def_list</span>

<span class="n">my_list</span> <span class="o">=</span> <span class="n">append_to_list</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>

<span class="n">my_other_list</span> <span class="o">=</span> <span class="n">append_to_list</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">my_other_list</span><span class="p">)</span>
</code></pre>
</div>



<p>Another good example showing that demonstrates that default arguments are created when the function is created (<strong>and not when it is called!</strong>):</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">report_arg</span><span class="p">(</span><span class="n">my_default</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">my_default</span><span class="p">)</span>

<span class="n">report_arg</span><span class="p">()</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">report_arg</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1397764090.456688
1397764090.456688
</code></pre>
</div>

<h2 id="be-aware-of-the-consuming-generator">Be aware of the consuming generator</h2>

<p>Be aware of what is happening when combining “<code class="highlighter-rouge">in</code>” checks with generators, since they won’t evaluate from the beginning once a position is “consumed”.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'2 in gen,'</span><span class="p">,</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'3 in gen,'</span><span class="p">,</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'1 in gen,'</span><span class="p">,</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>2 in gen, True
3 in gen, True
1 in gen, False
</code></pre>
</div>

<p>Although this defeats the purpose of an generator (in most cases), we can convert a generator into a list to circumvent the problem.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">a_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'2 in l,'</span><span class="p">,</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">a_list</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'3 in l,'</span><span class="p">,</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">a_list</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'1 in l,'</span><span class="p">,</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">a_list</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>2 in l, True
3 in l, True
1 in l, True
</code></pre>
</div>

<h2 id="bool-is-a-subclass-of-int"><code class="highlighter-rouge">bool</code> is a subclass of <code class="highlighter-rouge">int</code></h2>

<p>Chicken or egg? In the history of Python (Python 2.2 to be specific) truth values were implemented via 1 and 0 (similar to the old C). In order to avoid syntax errors in old (but perfectly working) Python code, <code class="highlighter-rouge">bool</code> was added as a subclass of <code class="highlighter-rouge">int</code> in Python 2.3.</p>

<p>Original source: <a href="http://www.peterbe.com/plog/bool-is-int">http://www.peterbe.com/plog/bool-is-int</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'isinstance(True, int):'</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'True + True:'</span><span class="p">,</span> <span class="bp">True</span> <span class="o">+</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'3*True + True:'</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="bp">True</span> <span class="o">+</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'3*True - False:'</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="bp">True</span> <span class="o">-</span> <span class="bp">False</span><span class="p">)</span>

</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>isinstance(True, int): True
True + True: 2
3*True + True: 4
3*True - False: 3
</code></pre>
</div>

<h2 id="about-lambda-in-closures-and-a-loop-pitfall">About lambda-in-closures-and-a-loop pitfall</h2>

<p>Remember the section about the <a href="consuming_generators">“consuming generators”</a>? This example is somewhat related, but the result might still come unexpected.</p>

<p>(Original source: <a href="http://openhome.cc/eGossip/Blog/UnderstandingLambdaClosure3.html">http://openhome.cc/eGossip/Blog/UnderstandingLambdaClosure3.html</a>)</p>

<p>In the first example below, we call a <code class="highlighter-rouge">lambda</code> function in a list comprehension, and the value <code class="highlighter-rouge">i</code> will be dereferenced every time we call <code class="highlighter-rouge">lambda</code> within the scope of the list comprehension. Since the list comprehension has already been constructed and evaluated when we for-loop through the list, the closure-variable will be set to the last value 4.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">l</span><span class="p">())</span>
</code></pre>
</div>



<p>However, by using a generator expression, we can make use of its stepwise evaluation (note that the returned variable still stems from the same closure, but the value changes as we iterate over the generator).</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_gen</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">my_gen</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">l</span><span class="p">())</span>
</code></pre>
</div>



<p>And if you are really keen on using lists, there is a nifty trick that circumvents this problem as a reader nicely pointed out in the comments: We can simply pass the loop variable <code class="highlighter-rouge">i</code> as a default argument to the lambdas.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">l</span><span class="p">())</span>
</code></pre>
</div>



<h2 id="pythons-legb-scope-resolution-and-the-keywords-global-and-nonlocal">Python’s LEGB scope resolution and the keywords <code class="highlighter-rouge">global</code> and <code class="highlighter-rouge">nonlocal</code></h2>

<p>There is nothing particularly surprising about Python’s LEGB scope resolution (Local -&gt; Enclosed -&gt; Global -&gt; Built-in), but it is still useful to take a look at some examples!</p>

<h3 id="global-vs-local"><code class="highlighter-rouge">global</code> vs. <code class="highlighter-rouge">local</code></h3>

<p>According to the LEGB rule, Python will first look for a variable in the local scope. So if we set the variable <code class="highlighter-rouge">x = 1</code> <code class="highlighter-rouge">local</code>ly in the function’s scope, it won’t have an effect on the <code class="highlighter-rouge">global</code> <code class="highlighter-rouge">x</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">in_func</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'in_func:'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">in_func</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'global:'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre>
</div>



<p>If we want to modify the <code class="highlighter-rouge">global</code> x via a function, we can simply use the <code class="highlighter-rouge">global</code> keyword to import the variable into the function’s scope:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">in_func</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'in_func:'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">in_func</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'global:'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre>
</div>



<h3 id="local-vs-enclosed"><code class="highlighter-rouge">local</code> vs. <code class="highlighter-rouge">enclosed</code></h3>

<p>Now, let us take a look at <code class="highlighter-rouge">local</code> vs. <code class="highlighter-rouge">enclosed</code>. Here, we set the variable <code class="highlighter-rouge">x = 1</code> in the <code class="highlighter-rouge">outer</code> function and set <code class="highlighter-rouge">x = 1</code> in the enclosed function <code class="highlighter-rouge">inner</code>. Since <code class="highlighter-rouge">inner</code> looks in the local scope first, it won’t modify <code class="highlighter-rouge">outer</code>’s <code class="highlighter-rouge">x</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
       <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
       <span class="k">print</span><span class="p">(</span><span class="s">'outer before:'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
       <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
           <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
           <span class="k">print</span><span class="p">(</span><span class="s">"inner:"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
       <span class="n">inner</span><span class="p">()</span>
       <span class="k">print</span><span class="p">(</span><span class="s">"outer after:"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">outer</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>outer before: 1
inner: 2
outer after: 1
</code></pre>
</div>

<p>Here is where the <code class="highlighter-rouge">nonlocal</code> keyword comes in handy - it allows us to modify the <code class="highlighter-rouge">x</code> variable in the <code class="highlighter-rouge">enclosed</code> scope:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
       <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
       <span class="k">print</span><span class="p">(</span><span class="s">'outer before:'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
       <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
           <span class="n">nonlocal</span> <span class="n">x</span>
           <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
           <span class="k">print</span><span class="p">(</span><span class="s">"inner:"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
       <span class="n">inner</span><span class="p">()</span>
       <span class="k">print</span><span class="p">(</span><span class="s">"outer after:"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">outer</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>outer before: 1
inner: 2
outer after: 2
</code></pre>
</div>

<h2 id="when-mutable-contents-of-immutable-tuples-arent-so-mutable">When mutable contents of immutable tuples aren’t so mutable</h2>

<p>As we all know, tuples are immutable objects in Python, right!? But what happens if they contain mutable objects?</p>

<p>First, let us have a look at the expected behavior: a <code class="highlighter-rouge">TypeError</code> is raised if we try to modify immutable types in a tuple:</p>



<div class="highlighter-rouge"><pre class="highlight"><code>---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

&lt;ipython-input-41-c3bec6c3fe6f&gt; in &lt;module&gt;()
      1 tup = (1,)
----&gt; 2 tup[0] += 1


TypeError: 'tuple' object does not support item assignment
</code></pre>
</div>

<h4 id="but-what-if-we-put-a-mutable-object-into-the-immutable-tuple-well-modification-works-but-we-also-get-a-typeerror-at-the-same-time">But what if we put a mutable object into the immutable tuple? Well, modification works, but we <strong>also</strong> get a <code class="highlighter-rouge">TypeError</code> at the same time.</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">tup</span> <span class="o">=</span> <span class="p">([],)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'tup before: '</span><span class="p">,</span> <span class="n">tup</span><span class="p">)</span>
<span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>tup before:  ([],)



---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

&lt;ipython-input-42-aebe9a31dbeb&gt; in &lt;module&gt;()
      1 tup = ([],)
      2 print('tup before: ', tup)
----&gt; 3 tup[0] += [1]


TypeError: 'tuple' object does not support item assignment
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'tup after: '</span><span class="p">,</span> <span class="n">tup</span><span class="p">)</span>
</code></pre>
</div>



<p>However, <strong>there are ways</strong> to modify the mutable contents of the tuple without raising the <code class="highlighter-rouge">TypeError</code>, the solution is the <code class="highlighter-rouge">.extend()</code> method, or alternatively <code class="highlighter-rouge">.append()</code> (for lists):</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">tup</span> <span class="o">=</span> <span class="p">([],)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'tup before: '</span><span class="p">,</span> <span class="n">tup</span><span class="p">)</span>
<span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">'tup after: '</span><span class="p">,</span> <span class="n">tup</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>tup before:  ([],)
tup after:  ([1],)
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">tup</span> <span class="o">=</span> <span class="p">([],)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'tup before: '</span><span class="p">,</span> <span class="n">tup</span><span class="p">)</span>
<span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'tup after: '</span><span class="p">,</span> <span class="n">tup</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>tup before:  ([],)
tup after:  ([1],)
</code></pre>
</div>

<h3 id="explanation">Explanation</h3>

<p><strong>A. Jesse Jiryu Davis</strong> has a nice explanation for this phenomenon (Original source: <a href="http://emptysqua.re/blog/python-increment-is-weird-part-ii/">http://emptysqua.re/blog/python-increment-is-weird-part-ii/</a>)</p>

<p>If we try to extend the list via <code class="highlighter-rouge">+=</code> <em>“then the statement executes <code class="highlighter-rouge">STORE_SUBSCR</code>, which calls the C function <code class="highlighter-rouge">PyObject_SetItem</code>, which checks if the object supports item assignment. In our case the object is a tuple, so <code class="highlighter-rouge">PyObject_SetItem</code> throws the <code class="highlighter-rouge">TypeError</code>. Mystery solved.”</em></p>

<h4 id="one-more-note-about-the-immutable-status-of-tuples-tuples-are-famous-for-being-immutable-however-how-comes-that-this-code-works">One more note about the <code class="highlighter-rouge">immutable</code> status of tuples. Tuples are famous for being immutable. However, how comes that this code works?</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_tup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="n">my_tup</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
<span class="n">my_tup</span> <span class="o">=</span> <span class="n">my_tup</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="p">,)</span>
<span class="k">print</span><span class="p">(</span><span class="n">my_tup</span><span class="p">)</span>
</code></pre>
</div>



<p>What happens “behind” the curtains is that the tuple is not modified, but every time a new object is generated, which will inherit the old “name tag”:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_tup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">my_tup</span><span class="p">))</span>
<span class="n">my_tup</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">my_tup</span><span class="p">))</span>
<span class="n">my_tup</span> <span class="o">=</span> <span class="n">my_tup</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="p">,)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">my_tup</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>4337381840
4357415496
4357289952
</code></pre>
</div>

<h2 id="list-comprehensions-are-fast-but-generators-are-faster">List comprehensions are fast, but generators are faster!?</h2>

<p>“List comprehensions are fast, but generators are faster!?” - No, not really (or significantly, see the benchmarks below). So what’s the reason to prefer one over the other?
- use lists if you want to use the plethora of list methods<br/>
- use generators when you are dealing with huge collections to avoid memory issues</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">timeit</span>

<span class="k">def</span> <span class="nf">plainlist</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">my_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">my_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">my_list</span>

<span class="k">def</span> <span class="nf">listcompr</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">my_list</span>

<span class="k">def</span> <span class="nf">generator</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">my_gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">my_gen</span>

<span class="k">def</span> <span class="nf">generator_yield</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
</code></pre>
</div>

<h4 id="to-be-fair-to-the-list-let-us-exhaust-the-generators">To be fair to the list, let us exhaust the generators:</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_plainlist</span><span class="p">(</span><span class="n">plain_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plain_list</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">test_listcompr</span><span class="p">(</span><span class="n">listcompr</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listcompr</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">test_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">test_generator_yield</span><span class="p">(</span><span class="n">generator_yield</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">generator_yield</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="s">'plain_list:     '</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">test_plainlist</span><span class="p">(</span><span class="n">plainlist</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">listcompr:     '</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">test_listcompr</span><span class="p">(</span><span class="n">listcompr</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">generator:     '</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">test_generator</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">generator_yield:     '</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">test_generator_yield</span><span class="p">(</span><span class="n">generator_yield</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>plain_list:     10 loops, best of 3: 22.4 ms per loop

listcompr:     10 loops, best of 3: 20.8 ms per loop

generator:     10 loops, best of 3: 22 ms per loop

generator_yield:     10 loops, best of 3: 21.9 ms per loop
</code></pre>
</div>

<h2 id="public-vs-private-class-methods-and-name-mangling">Public vs. private class methods and name mangling</h2>

<p>Who has not stumbled across this quote “we are all consenting adults here” in the Python community, yet? Unlike in other languages like C++ (sorry, there are many more, but that’s one I am most familiar with), we can’t really protect class methods from being used outside the class (i.e., by the API user).<br/>
All we can do is to indicate methods as private to make clear that they are better not used outside the class, but it is really up to the class user, since “we are all consenting adults here”!<br/>
So, when we want to mark a class method as private, we can put a single underscore in front of it.<br/>
If we additionally want to avoid name clashes with other classes that might use the same method names, we can prefix the name with a double-underscore to invoke the name mangling.</p>

<p>This doesn’t prevent the class user to access this class member though, but he has to know the trick and also knows that it his own risk…</p>

<p>Let the following example illustrate what I mean:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">my_class</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">public_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Hello public world!'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__private_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Hello private world!'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">call_private_method_in_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__private_method</span><span class="p">()</span>

<span class="n">my_instance</span> <span class="o">=</span> <span class="n">my_class</span><span class="p">()</span>

<span class="n">my_instance</span><span class="o">.</span><span class="n">public_method</span><span class="p">()</span>
<span class="n">my_instance</span><span class="o">.</span><span class="n">_my_class__private_method</span><span class="p">()</span>
<span class="n">my_instance</span><span class="o">.</span><span class="n">call_private_method_in_class</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Hello public world!
Hello private world!
Hello private world!
</code></pre>
</div>

<h2 id="the-consequences-of-modifying-a-list-when-looping-through-it">The consequences of modifying a list when looping through it</h2>

<p>It can be really dangerous to modify a list when iterating through it - this is a very common pitfall that can cause unintended behavior!<br/>
Look at the following examples, and for a fun exercise: try to figure out what is going on before you skip to the solution!</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre>
</div>



<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">b</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre>
</div>



<p><strong>The solution</strong> is that we are iterating through the list index by index, and if we remove one of the items in-between, we inevitably mess around with the indexing, look at the following example, and it will become clear:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre>
</div>



<h2 id="dynamic-binding-and-typos-in-variable-names">Dynamic binding and typos in variable names</h2>

<p>Be careful, dynamic binding is convenient, but can also quickly become dangerous!</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'first list:'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">second list:'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c"># I (intentionally) made typo here!</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>first list:
0
1
2

second list:
2
2
2
</code></pre>
</div>

<h2 id="list-slicing-using-indexes-that-are-out-of-range">List slicing using indexes that are “out of range”</h2>

<p>As we have all encountered it 1 (x10000) time(s) in our live, the infamous <code class="highlighter-rouge">IndexError</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)

&lt;ipython-input-15-eb273dc36fdc&gt; in &lt;module&gt;()
      1 my_list = [1, 2, 3, 4, 5]
----&gt; 2 print(my_list[5])


IndexError: list index out of range
</code></pre>
</div>

<p>But suprisingly, it is not raised when we are doing list slicing, which can be a really pain for debugging:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
</code></pre>
</div>



<h2 id="reusing-global-variable-names-and-unboundlocalerrors">Reusing global variable names and <code class="highlighter-rouge">UnboundLocalErrors</code></h2>

<p>Usually, it is no problem to access global variables in the local scope of a function:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

<span class="n">var</span> <span class="o">=</span> <span class="s">'global'</span>
<span class="n">my_func</span><span class="p">()</span>
</code></pre>
</div>



<p>And is also no problem to use the same variable name in the local scope without affecting the local counterpart:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
    <span class="n">var</span> <span class="o">=</span> <span class="s">'locally changed'</span>

<span class="n">var</span> <span class="o">=</span> <span class="s">'global'</span>
<span class="n">my_func</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</code></pre>
</div>



<p>But we have to be careful if we use a variable name that occurs in the global scope, and we want to access it in the local function scope if we want to reuse this name:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="c"># want to access global variable</span>
    <span class="n">var</span> <span class="o">=</span> <span class="s">'locally changed'</span> <span class="c"># but Python thinks we forgot to define the local variable!</span>

<span class="n">var</span> <span class="o">=</span> <span class="s">'global'</span>
<span class="n">my_func</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

&lt;ipython-input-40-3afd870b7c35&gt; in &lt;module&gt;()
      4
      5 var = 'global'
----&gt; 6 my_func()


&lt;ipython-input-40-3afd870b7c35&gt; in my_func()
      1 def my_func():
----&gt; 2     print(var) # want to access global variable
      3     var = 'locally changed'
      4
      5 var = 'global'


UnboundLocalError: local variable 'var' referenced before assignment
</code></pre>
</div>

<p>In this case, we have to use the <code class="highlighter-rouge">global</code> keyword!</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">var</span>
    <span class="k">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="c"># want to access global variable</span>
    <span class="n">var</span> <span class="o">=</span> <span class="s">'locally changed'</span> <span class="c"># changes the gobal variable</span>

<span class="n">var</span> <span class="o">=</span> <span class="s">'global'</span>

<span class="n">my_func</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</code></pre>
</div>



<h2 id="creating-copies-of-mutable-objects">Creating copies of mutable objects</h2>

<p>Let’s assume a scenario where we want to duplicate sub<code class="highlighter-rouge">list</code>s of values stored in another list. If we want to create independent sub<code class="highlighter-rouge">list</code> object, using the arithmetic multiplication operator could lead to rather unexpected (or undesired) results:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_list1</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span>

<span class="k">print</span><span class="p">(</span><span class="s">'initially ---&gt; '</span><span class="p">,</span> <span class="n">my_list1</span><span class="p">)</span>

<span class="c"># modify the 1st element of the 2nd sublist</span>
<span class="n">my_list1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">'a'</span>
<span class="k">print</span><span class="p">(</span><span class="s">"after my_list1[1][0] = 'a' ---&gt; "</span><span class="p">,</span> <span class="n">my_list1</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>initially ---&gt;  [[1, 2, 3], [1, 2, 3]]
after my_list1[1][0] = 'a' ---&gt;  [['a', 2, 3], ['a', 2, 3]]
</code></pre>
</div>

<p>In this case, we should better create “new” objects:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">my_list2</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

<span class="k">print</span><span class="p">(</span><span class="s">'initially:  ---&gt; '</span><span class="p">,</span> <span class="n">my_list2</span><span class="p">)</span>

<span class="c"># modify the 1st element of the 2nd sublist</span>
<span class="n">my_list2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">'a'</span>
<span class="k">print</span><span class="p">(</span><span class="s">"after my_list2[1][0] = 'a':  ---&gt; "</span><span class="p">,</span> <span class="n">my_list2</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>initially:  ---&gt;  [[1, 2, 3], [1, 2, 3]]
after my_list2[1][0] = 'a':  ---&gt;  [[1, 2, 3], ['a', 2, 3]]
</code></pre>
</div>

<p>And here is the proof:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">my_list1</span><span class="p">,</span> <span class="n">my_list2</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'id my_list1: {}, id my_list2: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>id my_list1: 4350764680, id my_list2: 4350766472
id my_list1: 4350764680, id my_list2: 4350766664
</code></pre>
</div>

<h2 id="key-differences-between-python-2-and-3">Key differences between Python 2 and 3</h2>

<p>There are some good articles already that are summarizing the differences between Python 2 and 3, e.g.,<br/>
- <a href="https://wiki.python.org/moin/Python2orPython3">https://wiki.python.org/moin/Python2orPython3</a>
- <a href="https://docs.python.org/3.0/whatsnew/3.0.html">https://docs.python.org/3.0/whatsnew/3.0.html</a>
- <a href="http://python3porting.com/differences.html">http://python3porting.com/differences.html</a>
- <a href="https://docs.python.org/3/howto/pyporting.html">https://docs.python.org/3/howto/pyporting.html</a><br/>
etc.</p>

<p>But it might be still worthwhile, especially for Python newcomers, to take a look at some of those!
(Note: the the code was executed in Python 3.4.0 and Python 2.7.5 and copied from interactive shell sessions.)</p>

<h3 id="overview---key-differences-between-python-2-and-3">Overview - Key differences between Python 2 and 3</h3>



<h3 id="unicode">Unicode…</h3>

<p>[<a href="#py23_overview">back to Python 2.x vs 3.x overview</a>]</p>

<h4 id="python-2">- Python 2:</h4>

<p>We have ASCII <code class="highlighter-rouge">str()</code> types, separate <code class="highlighter-rouge">unicode()</code>, but no <code class="highlighter-rouge">byte</code> type</p>

<h4 id="python-3">- Python 3:</h4>

<p>Now, we finally have Unicode (utf-8) <code class="highlighter-rouge">str</code>ings, and 2 byte classes: <code class="highlighter-rouge">byte</code> and <code class="highlighter-rouge">bytearray</code>s</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#############</span>
<span class="c"># Python 2</span>
<span class="c">#############</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="s">'is like a python3 str()'</span><span class="p">))</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'unicode'</span><span class="o">&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="s">'byte type does not exist'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'str'</span><span class="o">&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="s">'they are really'</span> <span class="o">+</span> <span class="n">b</span><span class="s">' the same'</span>
<span class="s">'they are really the same'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">b</span><span class="s">'bytearray oddly does exist though'</span><span class="p">))</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'bytearray'</span><span class="o">&gt;</span>

<span class="c">#############</span>
<span class="c"># Python 3</span>
<span class="c">#############</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'strings are now utf-8 </span><span class="se">\u03BC</span><span class="s">nico</span><span class="se">\u0394</span><span class="s">é!'</span><span class="p">)</span>
<span class="n">strings</span> <span class="n">are</span> <span class="n">now</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span> <span class="err">μ</span><span class="n">nico</span><span class="err">Δé!</span>


<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="s">' and we have byte types for storing data'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">bytes</span><span class="s">'&gt;</span><span class="err">

</span><span class="s">&gt;&gt;&gt; type(bytearray(b'</span><span class="n">but</span> <span class="n">also</span> <span class="n">bytearrays</span> <span class="k">for</span> <span class="n">those</span> <span class="n">who</span> <span class="n">prefer</span> <span class="n">them</span> <span class="n">over</span> <span class="n">strings</span><span class="s">'))</span><span class="err">
</span><span class="s">&lt;class '</span><span class="nb">bytearray</span><span class="s">'&gt;</span><span class="err">

</span><span class="s">&gt;&gt;&gt; '</span><span class="n">string</span><span class="s">' + b'</span><span class="nb">bytes</span> <span class="k">for</span> <span class="n">data</span><span class="s">'</span><span class="err">
</span><span class="s">Traceback (most recent call last):s</span><span class="err">
</span><span class="s">  File "&lt;stdin&gt;", line 1, in &lt;module&gt;</span><span class="err">
</span><span class="s">TypeError: Can'</span><span class="n">t</span> <span class="n">convert</span> <span class="s">'bytes'</span> <span class="nb">object</span> <span class="n">to</span> <span class="nb">str</span> <span class="n">implicitly</span>
</code></pre>
</div>

<h3 id="the-print-statement">The print statement</h3>

<p>Very trivial, but this change makes sense, Python 3 now only accepts <code class="highlighter-rouge">print</code>s with proper parentheses - just like the other function calls …</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Python 2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="s">'Hello, World!'</span>
<span class="n">Hello</span><span class="p">,</span> <span class="n">World</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'Hello, World!'</span><span class="p">)</span>
<span class="n">Hello</span><span class="p">,</span> <span class="n">World</span><span class="err">!</span>

<span class="c"># Python 3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'Hello, World!'</span><span class="p">)</span>
<span class="n">Hello</span><span class="p">,</span> <span class="n">World</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="s">'Hello, World!'</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="k">print</span> <span class="s">'Hello, World!'</span>
                        <span class="o">^</span>
<span class="nb">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
</code></pre>
</div>

<p>And if we want to print the output of 2 consecutive print functions on the same line, you would use a comma in Python 2, and a <code class="highlighter-rouge">end=""</code> in Python 3:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Python 2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="s">"line 1"</span><span class="p">,</span> <span class="p">;</span> <span class="k">print</span> <span class="s">'same line'</span>
<span class="n">line</span> <span class="mi">1</span> <span class="n">same</span> <span class="n">line</span>

<span class="c"># Python 3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">"line 1"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">""</span><span class="p">)</span> <span class="p">;</span> <span class="k">print</span> <span class="p">(</span><span class="s">" same line"</span><span class="p">)</span>
<span class="n">line</span> <span class="mi">1</span> <span class="n">same</span> <span class="n">line</span>
</code></pre>
</div>

<h3 id="integer-division">Integer division</h3>

<p>This is a pretty dangerous thing if you are porting code, or executing Python 3 code in Python 2 since the change in integer-division behavior can often go unnoticed.<br/>
So, I still tend to use a <code class="highlighter-rouge">float(3)/2</code> or <code class="highlighter-rouge">3/2.0</code> instead of a <code class="highlighter-rouge">3/2</code> in my Python 3 scripts to save the Python 2 guys some trouble … (PS: and vice versa, you can <code class="highlighter-rouge">from __future__ import division</code> in your Python 2 scripts).</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Python 2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">2</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="mf">1.5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">//</span> <span class="mf">2.0</span>
<span class="mf">1.0</span>

<span class="c"># Python 3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span>
<span class="mf">1.5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">2</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="mf">1.5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span> <span class="o">//</span> <span class="mf">2.0</span>
<span class="mf">1.0</span>
</code></pre>
</div>

<p>###<code class="highlighter-rouge">xrange()</code></p>

<p><code class="highlighter-rouge">xrange()</code> was pretty popular in Python 2.x if you wanted to create an iterable object. The behavior was quite similar to a generator (‘lazy evaluation’), but you could iterate over it infinitely. The advantage was that it was generally faster than <code class="highlighter-rouge">range()</code> (e.g., in a for-loop) - not if you had to iterate over the list multiple times, since the generation happens every time from scratch!<br/>
In Python 3, the <code class="highlighter-rouge">range()</code> was implemented like the <code class="highlighter-rouge">xrange()</code> function so that a dedicated <code class="highlighter-rouge">xrange()</code> function does not exist anymore.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Python 2</span>
<span class="o">&gt;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="s">'for i in range(1000000):'</span> <span class="s">' pass'</span>
<span class="mi">10</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">66</span> <span class="n">msec</span> <span class="n">per</span> <span class="n">loop</span>

    <span class="o">&gt;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="s">'for i in xrange(1000000):'</span> <span class="s">' pass'</span>
<span class="mi">10</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">27.8</span> <span class="n">msec</span> <span class="n">per</span> <span class="n">loop</span>

<span class="c"># Python 3</span>
<span class="o">&gt;</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="s">'for i in range(1000000):'</span> <span class="s">' pass'</span>
<span class="mi">10</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">51.1</span> <span class="n">msec</span> <span class="n">per</span> <span class="n">loop</span>

<span class="o">&gt;</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="s">'for i in xrange(1000000):'</span> <span class="s">' pass'</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/timeit.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">292</span><span class="p">,</span> <span class="ow">in</span> <span class="n">main</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/timeit.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">178</span><span class="p">,</span> <span class="ow">in</span> <span class="n">timeit</span>
    <span class="n">timing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"&lt;timeit-src&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">6</span><span class="p">,</span> <span class="ow">in</span> <span class="n">inner</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
<span class="nb">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s">'xrange'</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</code></pre>
</div>

<h3 id="raising-exceptions">Raising exceptions</h3>

<p>Where Python 2 accepts both notations, the ‘old’ and the ‘new’ way, Python 3 chokes (and raises a <code class="highlighter-rouge">SyntaxError</code> in turn) if we don’t enclose the exception argument in parentheses:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Python 2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">raise</span> <span class="nb">IOError</span><span class="p">,</span> <span class="s">"file error"</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="nb">IOError</span><span class="p">:</span> <span class="nb">file</span> <span class="n">error</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">raise</span> <span class="nb">IOError</span><span class="p">(</span><span class="s">"file error"</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="nb">IOError</span><span class="p">:</span> <span class="nb">file</span> <span class="n">error</span>


<span class="c"># Python 3    </span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">raise</span> <span class="nb">IOError</span><span class="p">,</span> <span class="s">"file error"</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="k">raise</span> <span class="nb">IOError</span><span class="p">,</span> <span class="s">"file error"</span>
                 <span class="o">^</span>
<span class="nb">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">raise</span> <span class="nb">IOError</span><span class="p">(</span><span class="s">"file error"</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="nb">OSError</span><span class="p">:</span> <span class="nb">file</span> <span class="n">error</span>
</code></pre>
</div>

<h3 id="handling-exceptions">Handling exceptions</h3>

<p>Also the handling of exceptions has slightly changed in Python 3. Now, we have to use the <code class="highlighter-rouge">as</code> keyword!</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Python 2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">try</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">blabla</span>
<span class="o">...</span> <span class="k">except</span> <span class="nb">NameError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span> <span class="n">err</span><span class="p">,</span> <span class="s">'--&gt; our error msg'</span>
<span class="o">...</span>
<span class="n">name</span> <span class="s">'blabla'</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span> <span class="o">--&gt;</span> <span class="n">our</span> <span class="n">error</span> <span class="n">msg</span>

<span class="c"># Python 3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">try</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">blabla</span>
<span class="o">...</span> <span class="k">except</span> <span class="nb">NameError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="s">'--&gt; our error msg'</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">name</span> <span class="s">'blabla'</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span> <span class="o">--&gt;</span> <span class="n">our</span> <span class="n">error</span> <span class="n">msg</span>
</code></pre>
</div>

<h3 id="the-next-function-and-next-method">The <code class="highlighter-rouge">next()</code> function and <code class="highlighter-rouge">.next()</code> method</h3>

<p>Where you can use both function and method in Python 2.7.5, the <code class="highlighter-rouge">next()</code> function is all that remain in Python 3!</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Python 2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">my_generator</span> <span class="o">=</span> <span class="p">(</span><span class="n">letter</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s">'abcdefg'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">my_generator</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
<span class="s">'a'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">my_generator</span><span class="p">)</span>
<span class="s">'b'</span>

<span class="c"># Python 3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">my_generator</span> <span class="o">=</span> <span class="p">(</span><span class="n">letter</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s">'abcdefg'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">my_generator</span><span class="p">)</span>
<span class="s">'a'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">my_generator</span><span class="o">.</span><span class="nb">next</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="nb">AttributeError</span><span class="p">:</span> <span class="s">'generator'</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">'next'</span>
</code></pre>
</div>

<h3 id="in-python-3x-for-loop-variables-dont-leak-into-the-global-namespace-anymore">In Python 3.x for-loop variables don’t leak into the global namespace anymore</h3>

<p>This goes back to a change that was made in Python 3.x and is described in <a href="https://docs.python.org/3/whatsnew/3.0.html">What’s New In Python 3.0</a> as follows:</p>

<p>“List comprehensions no longer support the syntactic form <code class="highlighter-rouge">[... for var in item1, item2, ...]</code>. Use <code class="highlighter-rouge">[... for var in (item1, item2, ...)]</code> instead. Also note that list comprehensions have different semantics: they are closer to syntactic sugar for a generator expression inside a <code class="highlighter-rouge">list()</code> constructor, and in particular the loop control variables are no longer leaked into the surrounding scope.”</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">python_version</span>
<span class="k">print</span><span class="p">(</span><span class="s">'This code cell was executed in Python'</span><span class="p">,</span> <span class="n">python_version</span><span class="p">())</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)])</span>
<span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">'-&gt; i in global'</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>This code cell was executed in Python 3.3.5
[0, 1, 2, 3, 4]
1 -&gt; i in global
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">python_version</span>
<span class="k">print</span> <span class="s">'This code cell was executed in Python'</span><span class="p">,</span> <span class="n">python_version</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="s">'-&gt; i in global'</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>This code cell was executed in Python 2.7.6
[0, 1, 2, 3, 4]
4 -&gt; i in global
</code></pre>
</div>

<h4 id="python-3x-prevents-us-from-comparing-unorderable-types">Python 3.x prevents us from comparing unorderable types</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">python_version</span>
<span class="k">print</span> <span class="s">'This code cell was executed in Python'</span><span class="p">,</span> <span class="n">python_version</span><span class="p">()</span>

<span class="k">print</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">'foo'</span>
<span class="k">print</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="s">'foo'</span>
<span class="k">print</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>This code cell was executed in Python 2.7.6
False
True
False
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">python_version</span>
<span class="k">print</span><span class="p">(</span><span class="s">'This code cell was executed in Python'</span><span class="p">,</span> <span class="n">python_version</span><span class="p">())</span>

<span class="k">print</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">'foo'</span><span class="p">)</span>
<span class="k">print</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="s">'foo'</span><span class="p">)</span>
<span class="k">print</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>This code cell was executed in Python 3.3.5



---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

&lt;ipython-input-3-1d774c677f73&gt; in &lt;module&gt;()
      2 print('This code cell was executed in Python', python_version())
      3
----&gt; 4 [1, 2] &gt; 'foo'
      5 (1, 2) &gt; 'foo'
      6 [1, 2] &gt; (1, 2)


TypeError: unorderable types: list() &gt; str()
</code></pre>
</div>

<h2 id="function-annotations---what-are-those--s-in-my-python-code">Function annotations - What are those <code class="highlighter-rouge">-&gt;</code>’s in my Python code?</h2>

<p>Have you ever seen any Python code that used colons inside the parantheses of a function definition?</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foo1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="s">'insert x here'</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="s">'insert x^2 here'</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, World'</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre>
</div>

<p>And what about the fancy arrow here?</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foo2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s">'Hi!'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, World'</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre>
</div>

<p>Q: Is this valid Python syntax?<br/>
A: Yes!</p>

<p>Q: So, what happens if I <em>just call</em> the function?<br/>
A: Nothing!</p>

<p>Here is the proof!</p>









<p>**So, those are function annotations … **<br/>
- the colon for the function parameters<br/>
- the arrow for the return value</p>

<p>You probably will never make use of them (or at least very rarely). Usually, we write good function documentations below the function as a docstring - or at least this is how I would do it (okay this case is a little bit extreme, I have to admit):</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="s">"""
    Case-and punctuation insensitive check if a string is a palindrom.

    Keyword arguments:
        a (str): The string to be checked if it is a palindrome.

    Returns `True` if input string is a palindrome, else False.

    """</span>
    <span class="n">stripped_str</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">my_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">stripped_str</span> <span class="o">==</span> <span class="n">stripped_str</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

</code></pre>
</div>

<p>However, function annotations can be useful to indicate that work is still in progress in some cases. But they are optional and I see them very very rarely.</p>

<p>As it is stated in <a href="http://legacy.python.org/dev/peps/pep-3107/#fundamentals-of-function-annotations">PEP3107</a>:</p>

<ol>
  <li>
    <p>Function annotations, both for parameters and return values, are completely optional.</p>
  </li>
  <li>
    <p>Function annotations are nothing more than a way of associating arbitrary Python expressions with various parts of a function at compile-time.</p>
  </li>
</ol>

<p>The nice thing about function annotations is their <code class="highlighter-rouge">__annotations__</code> attribute, which is dictionary of all the parameters and/or the <code class="highlighter-rouge">return</code> value you annotated.</p>



<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">'y':</span><span class="w"> </span><span class="err">'insert</span><span class="w"> </span><span class="err">x^2</span><span class="w"> </span><span class="err">here',</span><span class="w"> </span><span class="err">'x':</span><span class="w"> </span><span class="err">'insert</span><span class="w"> </span><span class="err">x</span><span class="w"> </span><span class="err">here'</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>





<p><strong>When are they useful?</strong></p>

<p>Function annotations can be useful for a couple of things
- Documentation in general
- pre-condition testing
- <a href="http://legacy.python.org/dev/peps/pep-0362/#annotation-checker">type checking</a></p>

<p>…</p>

<h2 id="abortive-statements-in-finally-blocks">Abortive statements in <code class="highlighter-rouge">finally</code> blocks</h2>

<p>Python’s <code class="highlighter-rouge">try-except-finally</code> blocks are very handy for catching and handling errors. The <code class="highlighter-rouge">finally</code> block is always executed whether an <code class="highlighter-rouge">exception</code> has been raised or not as illustrated in the following example.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">try_finally1</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'in try:'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'do some stuff'</span><span class="p">)</span>
        <span class="nb">float</span><span class="p">(</span><span class="s">'abc'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'an error occurred'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'no error occurred'</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'always execute finally'</span><span class="p">)</span>

<span class="n">try_finally1</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>in try:
do some stuff
an error occurred
always execute finally
</code></pre>
</div>

<p>But can you also guess what will be printed in the next code cell?</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">try_finally2</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"do some stuff in try block"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">"return from try block"</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"do some stuff in finally block"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">"always execute finally"</span>

<span class="k">print</span><span class="p">(</span><span class="n">try_finally2</span><span class="p">())</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>do some stuff in try block
do some stuff in finally block
always execute finally
</code></pre>
</div>

<p>Here, the abortive <code class="highlighter-rouge">return</code> statement in the <code class="highlighter-rouge">finally</code> block simply overrules the <code class="highlighter-rouge">return</code> in the <code class="highlighter-rouge">try</code> block, since <strong><code class="highlighter-rouge">finally</code> is guaranteed to always be executed.</strong> So, be careful using abortive statements in <code class="highlighter-rouge">finally</code> blocks!</p>

<h1 id="assigning-types-to-variables-as-values">Assigning types to variables as values</h1>

<p>I am not yet sure in which context this can be useful, but it is a nice fun fact to know that we can assign types as values to variables.</p>





<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">choice</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">])(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>0 &lt;class 'int'&gt;
1 &lt;class 'int'&gt;
2.0 &lt;class 'float'&gt;
3 &lt;class 'str'&gt;
4 &lt;class 'int'&gt;
</code></pre>
</div>



<p>The main reason why we love to use generators in certain cases (i.e., when we are dealing with large numbers of computations) is that it only computes the next value when it is needed, which is also known as “lazy” evaluation.
However, the first clause of an generator is already checked upon it’s creation, as the following example demonstrates:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">gen_fails</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)

&lt;ipython-input-18-29312e1ece8d&gt; in &lt;module&gt;()
----&gt; 1 gen_fails = (i for i in 1/0)


ZeroDivisionError: division by zero
</code></pre>
</div>

<p>Certainly, this is a nice feature, since it notifies us about syntax erros immediately. However, this is (unfortunately) not the case if we have multiple cases in our generator.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">gen_succeeds</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'But obviously fails when we iterate ...'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gen_succeeds</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)

&lt;ipython-input-20-8a83a1022971&gt; in &lt;module&gt;()
      1 print('But obviously fails when we iterate ...')
----&gt; 2 for i in gen_succeeds:
      3     print(i)


&lt;ipython-input-19-c54c53f2218a&gt; in &lt;genexpr&gt;(.0)
----&gt; 1 gen_succeeds = (i for i in range(5) for j in 1/0)


ZeroDivisionError: division by zero


But obviously fails when we iterate ...
</code></pre>
</div>

<p>##Keyword argument unpacking syntax - <code class="highlighter-rouge">*args</code> and <code class="highlighter-rouge">**kwargs</code></p>

<p>Python has a very convenient “keyword argument unpacking syntax” (often also referred to as “splat”-operators). This is particularly useful, if we want to define a function that can take a arbitrary number of input arguments.</p>

<h4 id="single-asterisk-args">Single-asterisk (*args)</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">a_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'type of args:'</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'args contents:'</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'1st argument:'</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">a_func</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>type of args: &lt;class 'tuple'&gt;
args contents: (0, 1, 'a', 'b', 'c')
1st argument: 0
</code></pre>
</div>

<h4 id="double-asterisk-kwargs">Double-asterisk (**kwargs)</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">b_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'type of kwargs:'</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'kwargs contents: '</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'value of argument a:'</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">'a'</span><span class="p">])</span>

<span class="n">b_func</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>type of kwargs: &lt;class 'dict'&gt;
kwargs contents:  {'d': 4, 'a': 1, 'c': 3, 'b': 2}
value of argument a: 1
</code></pre>
</div>

<h4 id="partially-unpacking-of-iterables">(Partially) unpacking of iterables</h4>
<p>Another useful application of the “unpacking”-operator is the unpacking of lists and other other iterables.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">val1</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">'val1:'</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'vals:'</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>val1: 1
vals: [2, 3, 4, 5]
</code></pre>
</div>



<p>Usually, it is the <code class="highlighter-rouge">__init__</code> method when we think of instanciating a new object from a class. However, it is the static method <code class="highlighter-rouge">__new__</code> (it is not a class method!) that creates and returns a new instance before <code class="highlighter-rouge">__init__()</code> is called.
More specifically, this is what is returned:<br/>
<code class="highlighter-rouge">return super(&lt;currentclass&gt;, cls).__new__(subcls, *args, **kwargs)</code></p>

<p>For more information about the <code class="highlighter-rouge">__new__</code> method, please see the <a href="https://www.python.org/download/releases/2.2/descrintro/#__new__">documentation</a>.</p>

<p>As a little experiment, let us screw with <code class="highlighter-rouge">__new__</code> so that it returns <code class="highlighter-rouge">None</code> and see if <code class="highlighter-rouge">__init__</code> will be executed:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">a_class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">clss</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'excecuted __new__'</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">an_arg</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'excecuted __init__'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">an_arg</span> <span class="o">=</span> <span class="n">an_arg</span>

<span class="n">a_object</span> <span class="o">=</span> <span class="n">a_class</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Type of a_object:'</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">a_object</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>excecuted __new__
Type of a_object: &lt;class 'NoneType'&gt;
</code></pre>
</div>

<p>As we can see in the code above, <code class="highlighter-rouge">__init__</code> requires the returned instance from <code class="highlighter-rouge">__new__</code> in order to called. So, here we just created a <code class="highlighter-rouge">NoneType</code> object.<br/>
Let us override the <code class="highlighter-rouge">__new__</code>, now and let us confirm that <code class="highlighter-rouge">__init__</code> is called now to instantiate the new object”:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">a_class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'excecuted __new__'</span><span class="p">)</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">a_class</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">an_arg</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'excecuted __init__'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">an_arg</span> <span class="o">=</span> <span class="n">an_arg</span>

<span class="n">a_object</span> <span class="o">=</span> <span class="n">a_class</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Type of a_object:'</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">a_object</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'a_object.an_arg: '</span><span class="p">,</span> <span class="n">a_object</span><span class="o">.</span><span class="n">an_arg</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>excecuted __new__
excecuted __init__
Type of a_object: &lt;class '__main__.a_class'&gt;
a_object.an_arg:  1
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'in for'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'in else'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'after for-loop'</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>in for
in else
after for-loop
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'in else'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'after for-loop'</span><span class="p">)</span>
</code></pre>
</div>



<h2 id="else-clauses-conditional-else-and-completion-else">Else-clauses: “conditional else” and “completion else”</h2>

<p>I would claim that the conditional “else” is every programmer’s daily bread and butter. However, there is a second flavor of “else”-clauses in Python, which I will call “completion else” (for reason that will become clear later).<br/>
But first, let us take a look at our “traditional” conditional else that we all are familiar with.</p>

<h3 id="conditional-else">Conditional else:</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># conditional else</span>

<span class="n">a_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="k">if</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, World!'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Bye, World!'</span><span class="p">)</span>
</code></pre>
</div>



<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># conditional else</span>

<span class="n">a_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="k">if</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, World!'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Bye, World!'</span><span class="p">)</span>
</code></pre>
</div>



<p>Why am I showing those simple examples? I think they are good to highlight some of the key points: It is <strong>either</strong> the code under the <code class="highlighter-rouge">if</code> clause that is executed, <strong>or</strong> the code under the <code class="highlighter-rouge">else</code> block, but not both.<br/>
If the condition of the <code class="highlighter-rouge">if</code> clause evaluates to <code class="highlighter-rouge">True</code>, the <code class="highlighter-rouge">if</code>-block is exectured, and if it evaluated to <code class="highlighter-rouge">False</code>, it is the <code class="highlighter-rouge">else</code> block.</p>

<h3 id="completion-else">Completion else</h3>

<p><strong>In contrast</strong> to the <strong>either…or</strong>* situation that we know from the conditional <code class="highlighter-rouge">else</code>, the completion <code class="highlighter-rouge">else</code> is executed if a code block finished.<br/>
To show you an example, let us use <code class="highlighter-rouge">else</code> for error-handling:</p>

<h4 id="completion-else-try-except">Completion else (try-except)</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'first element:'</span><span class="p">,</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'raised IndexError'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'no error in try-block'</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>first element: 1
no error in try-block
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'third element:'</span><span class="p">,</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'raised IndexError'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'no error in try-block'</span><span class="p">)</span>
</code></pre>
</div>



<p>In the code above, we can see that the code under the <strong><code class="highlighter-rouge">else</code>-clause is only executed if the <code class="highlighter-rouge">try-block</code> was executed without encountering an error, i.e., if the <code class="highlighter-rouge">try</code>-block is “complete”.</strong><br/>
The same rule applies to the “completion” <code class="highlighter-rouge">else</code> in while- and for-loops, which you can confirm in the following samples below.</p>

<h4 id="completion-else-while-loop">Completion else (while-loop)</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'in else'</span><span class="p">)</span>
</code></pre>
</div>



<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'completed while-loop'</span><span class="p">)</span>
</code></pre>
</div>



<h4 id="completion-else-for-loop">Completion else (for-loop)</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'completed for-loop'</span><span class="p">)</span>
</code></pre>
</div>



<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'completed for-loop'</span><span class="p">)</span>
</code></pre>
</div>



<h2 id="interning-of-compile-time-constants-vs-run-time-expressions">Interning of compile-time constants vs. run-time expressions</h2>

<p>This might not be particularly useful, but it is nonetheless interesting: Python’s interpreter is interning compile-time constants but not run-time expressions (note that this is implementation-specific).</p>

<p>(Original source: <a href="http://stackoverflow.com/questions/15541404/python-string-interning">Stackoverflow</a>)</p>

<p>Let us have a look at the simple example below. Here we are creating 3 variables and assign the value “Hello” to them in different ways before we test them for identity.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">hello1</span> <span class="o">=</span> <span class="s">'Hello'</span>

<span class="n">hello2</span> <span class="o">=</span> <span class="s">'Hell'</span> <span class="o">+</span> <span class="s">'o'</span>

<span class="n">hello3</span> <span class="o">=</span> <span class="s">'Hell'</span>
<span class="n">hello3</span> <span class="o">=</span> <span class="n">hello3</span> <span class="o">+</span> <span class="s">'o'</span>

<span class="k">print</span><span class="p">(</span><span class="s">'hello1 is hello2:'</span><span class="p">,</span> <span class="n">hello1</span> <span class="ow">is</span> <span class="n">hello2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'hello1 is hello3:'</span><span class="p">,</span> <span class="n">hello1</span> <span class="ow">is</span> <span class="n">hello3</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>hello1 is hello2: True
hello1 is hello3: False
</code></pre>
</div>

<p>Now, how does it come that the first expression evaluates to true, but the second does not?  To answer this question, we need to take a closer look at the underlying byte codes:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dis</span>
<span class="k">def</span> <span class="nf">hello1_func</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">'Hello'</span>
    <span class="k">return</span> <span class="n">s</span>
<span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">hello1_func</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>  3           0 LOAD_CONST               1 ('Hello')
              3 STORE_FAST               0 (s)

  4           6 LOAD_FAST                0 (s)
              9 RETURN_VALUE
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">hello2_func</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">'Hell'</span> <span class="o">+</span> <span class="s">'o'</span>
    <span class="k">return</span> <span class="n">s</span>
<span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">hello2_func</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>  2           0 LOAD_CONST               3 ('Hello')
              3 STORE_FAST               0 (s)

  3           6 LOAD_FAST                0 (s)
              9 RETURN_VALUE
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">hello3_func</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">'Hell'</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">'o'</span>
    <span class="k">return</span> <span class="n">s</span>
<span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">hello3_func</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>  2           0 LOAD_CONST               1 ('Hell')
              3 STORE_FAST               0 (s)

  3           6 LOAD_FAST                0 (s)
              9 LOAD_CONST               2 ('o')
             12 BINARY_ADD
             13 STORE_FAST               0 (s)

  4          16 LOAD_FAST                0 (s)
             19 RETURN_VALUE
</code></pre>
</div>

<p>It looks like that <code class="highlighter-rouge">'Hello'</code> and <code class="highlighter-rouge">'Hell'</code> + <code class="highlighter-rouge">'o'</code> are both evaluated and stored as <code class="highlighter-rouge">'Hello'</code> at compile-time, whereas the third version <br/>
<code class="highlighter-rouge">s = 'Hell'</code><br/>
<code class="highlighter-rouge">s = s + 'o'</code> seems to be not interned.  Let us quickly confirm the behavior with the following code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">hello1_func</span><span class="p">()</span> <span class="ow">is</span> <span class="n">hello2_func</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">hello1_func</span><span class="p">()</span> <span class="ow">is</span> <span class="n">hello3_func</span><span class="p">())</span>
</code></pre>
</div>



<p>Finally, to show that this hypothesis is the answer to this rather unexpected observation, let us <code class="highlighter-rouge">intern</code> the value manually:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">print</span><span class="p">(</span><span class="n">hello1_func</span><span class="p">()</span> <span class="ow">is</span> <span class="n">sys</span><span class="o">.</span><span class="nb">intern</span><span class="p">(</span><span class="n">hello3_func</span><span class="p">()))</span>
</code></pre>
</div>



  </article>


</div></body></html>