<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_demo.gif"><img class="aligncenter wp-image-3709" src="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_demo.gif" alt=""/></a></p>
<p>Last week’s blog post taught us how to <a href="http://www.pyimagesearch.com/2016/02/22/writing-to-video-with-opencv/" target="_blank">write videos to file using OpenCV and Python</a>. This is a great skill to have, but it also raises the question:</p>
<blockquote><p><em><strong>How do I write video clips </strong></em><strong>containing</strong><strong> interesting events</strong><em><strong> to file rather than the </strong></em><strong>entire video</strong><em><strong>?</strong></em></p></blockquote>
<p>In this case, the overall goal is to construct a <em><strong>video synopsis</strong></em>, distilling the most key, salient, and interesting parts of the video stream into a series of short video files.</p>
<p>What actually defines a “key or interesting event” is entirely up to you and your application. Potential examples of key events can include:</p>
<ul>
<li>Motion being detected in a restricted access zone.</li>
<li>An intruder entering your house or apartment.</li>
<li>A car running a stop sign on a busy street by your home.</li>
</ul>
<p>In each of these cases, you’re not interested in the <em>entire</em> video capture — <em><strong>instead, you only want the video clip that contains the action!</strong></em></p>
<p>To see how capturing key event video clips with OpenCV is done (and build your own video synopsis), just keep reading.</p>

<h2>Saving key event video clips with OpenCV</h2>
<p>The purpose of this blog post is to demonstrate how to <em>write short video clips to file</em> when a <em>particular action</em> takes place. We’ll be using our knowledge gained from last week’s blog post on <a href="http://www.pyimagesearch.com/2016/02/22/writing-to-video-with-opencv/" target="_blank">writing video to file with OpenCV</a> to implement this functionality.</p>
<p>As I mentioned at the top of this post, defining “key” and “interesting” events in a video stream is entirely dependent on your application and the overalls goals of what you’re trying to build.</p>
<p>You might be interesting in detecting motion in a room. Monitoring your house. Or creating a system to observe traffic and store clips of motor vehicle drivers breaking the law.</p>
<p>As a simple example of both:</p>
<ol>
<li>Defining a key event.</li>
<li>Writing the video clip to file containing the event.</li>
</ol>
<p>We’ll be processing a video streaming and looking for occurrences of this green ball:</p>
<div id="attachment_3708" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_green_ball.jpg"><img class="size-full wp-image-3708" src="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_green_ball.jpg" alt="Figure 1: An example of the green ball we are going to detect in video streams." srcset="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_green_ball-300x225.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_green_ball.jpg 600w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> An example of the green ball we are going to detect in video streams.</p></div>
<p>If this green ball appears in our video stream, we’ll open up a new file video (based on the timestamp of occurrence), write the clip to file, and then stop the writing process once the ball disappears from our view.</p>
<p>Furthermore, our implementation will have a number of desirable properties, including:</p>
<ol>
<li>Writing frames to our video file a few seconds <strong><em>before</em></strong> the action takes place.</li>
<li>Writing frames to file a few seconds <strong><em>after</em></strong> the action finishes — in both cases, our goal is to not only capture the <em>entire event</em>, but also the <em>context of the event </em>as well.</li>
<li>Utilizing threads to ensure our main program is not slowed down when performing I/O on both the input stream and the output video clip file.</li>
<li>Leveraging built-in Python data structures such as 
			<span id="crayon-56d5b291904e4798349940" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">deque</span></span></span>  and 
			<span id="crayon-56d5b291904f3769853655" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Queue</span></span></span>  so we need not rely on external libraries (other than OpenCV and <a href="https://github.com/jrosebr1/imutils" target="_blank">imutils</a>, of course).</li>
</ol>
<h2>Project structure</h2>
<p>Before we get started implementing our key event video writer, let’s look at the project structure:</p>

		<div id="crayon-56d5b291904f8940235804" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b291904f8940235804-1"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">output</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291904f8940235804-2"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">pyimagesearch</span></p><p class="crayon-line" id="crayon-56d5b291904f8940235804-3"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291904f8940235804-4"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">keyclipwriter</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p><p class="crayon-line" id="crayon-56d5b291904f8940235804-5"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">save_key_events</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Inside the 
			<span id="crayon-56d5b291904fc226032869" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pyimagesearch</span></span></span>  module, we’ll define a class named 
			<span id="crayon-56d5b29190500101288732" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span>  inside the 
			<span id="crayon-56d5b29190503785270262" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">keyclipwriter</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  file. This class will handle accepting frames from an input video stream ad writing them to file in a safe, efficient, and threaded manner.</p>
<p>The driver script, 
			<span id="crayon-56d5b29190507197167820" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">save_key_events</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , will define the criteria of what an “interesting event” is (i.e., the green ball entering the view of the camera), followed by passing these frames on to the 
			<span id="crayon-56d5b2919050a873027317" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span>  which will then create our video synopsis.</p>
<h3>A quick note on Python + OpenCV versions</h3>
<p>This blog post assumes you are using <em>Python 3+</em> and <em>OpenCV 3</em>. As I mentioned in <a href="http://www.pyimagesearch.com/2016/02/22/writing-to-video-with-opencv/" target="_blank">last week’s post</a>, I wasn’t able to get the 
			<span id="crayon-56d5b2919050e291573992" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoWriter</span></span></span>  function to work on my OpenCV 2.4 installation, so after a few hours of hacking around with no luck, I ended up abandoning OpenCV 2.4 for this project and sticking with OpenCV 3.</p>
<p>The code in this lesson is <em>technically</em> compatible with Python 2.7 (again, provided you are using Python 2.7 with OpenCV 3 bindings), but you’ll need to change a few 
			<span id="crayon-56d5b29190512743779842" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">import</span></span></span>  statements (I’ll point these out along the way).</p>
<h3>Writing key/interesting video clips to file with OpenCV</h3>
<p>Let’s go ahead and get started reviewing our 
			<span id="crayon-56d5b29190515242779291" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span>  class:</p>

		<div id="crayon-56d5b29190519848614724" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b29190519848614724-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-2">2</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-4">4</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-6">6</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-8">8</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-10">10</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-12">12</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-14">14</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-16">16</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-18">18</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-20">20</p><p class="crayon-num" data-line="crayon-56d5b29190519848614724-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190519848614724-22">22</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b29190519848614724-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">collections</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">deque</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">threading</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">Thread</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">queue</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">Queue</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">cv2</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-8"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">KeyClipWriter</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-9"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">bufSize</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span><span class="crayon-o">=</span><span class="crayon-cn">1.0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-10"><span class="crayon-h">		</span><span class="crayon-c"># store the maximum buffer size of frames to be kept</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-11"><span class="crayon-h">		</span><span class="crayon-c"># in memory along with the sleep timeout during threading</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-12"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">bufSize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">bufSize</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-13"><span class="crayon-e">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timeout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-14"> </p><p class="crayon-line" id="crayon-56d5b29190519848614724-15"><span class="crayon-h">		</span><span class="crayon-c"># initialize the buffer of frames, queue of frames that</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-16"><span class="crayon-h">		</span><span class="crayon-c"># need to be written to file, video writer, writer thread,</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-17"><span class="crayon-h">		</span><span class="crayon-c"># and boolean indicating whether recording has started or not</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-18"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">frames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">deque</span><span class="crayon-sy">(</span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">bufSize</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-19"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-20"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">writer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></p><p class="crayon-line" id="crayon-56d5b29190519848614724-21"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-k ">thread</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190519848614724-22"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recording</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">False</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start off by importing our required Python packages on <strong>Lines 2-6</strong>. This tutorial assumes you are using Python 3, so if you’re using Python 2.7, you’ll need to change <strong>Line 4</strong> from 
			<span id="crayon-56d5b2919051d726031441" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-e">from </span><span class="crayon-e">queue </span><span class="crayon-e">import </span><span class="crayon-v">Queue</span></span></span>  to simply 
			<span id="crayon-56d5b29190525576507072" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-e">import </span><span class="crayon-v">Queue</span></span></span> .</p>
<p><strong>Line 9</strong> defines the constructor to our 
			<span id="crayon-56d5b29190529393461029" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span> , which accepts two optional parameters:</p>
<ul>
<li>
			<span id="crayon-56d5b2919052c780335989" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bufSize</span></span></span> : The maximum number of frames to be keep cached in an in-memory buffer.</li>
<li>
			<span id="crayon-56d5b29190530970610729" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">timeout</span></span></span> : An integer representing the number of seconds to sleep for when (1) writing video clips to file and (2) there are no frames ready to be written.</li>
</ul>
<p>We then initialize four important variables on <strong>Lines 18-22</strong>:</p>
<ul>
<li>
			<span id="crayon-56d5b29190533345137391" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frames</span></span></span> : A buffer used to a store a maximum of 
			<span id="crayon-56d5b29190537698105986" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">bufSize</span></span></span>  frames that have been most recently read from the video stream.</li>
<li>
			<span id="crayon-56d5b2919053a853713259" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Q</span></span></span> : A “first in, first out” (<a href="https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)" target="_blank">FIFO</a>) Python <a href="https://docs.python.org/3/library/queue.html" target="_blank">Queue data structure</a> used to hold frames that are awaiting to be written to video file.</li>
<li>
			<span id="crayon-56d5b2919053e831578400" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">writer</span></span></span> : An instantiation of the 
			<span id="crayon-56d5b29190542214286937" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoWriter</span></span></span>  class used to actually write frames to the output video file.</li>
<li>
			<span id="crayon-56d5b29190545732382467" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">thread</span></span></span> : A Python 
			<span id="crayon-56d5b29190549904259622" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Thread</span></span></span>  instance that we’ll use when writing videos to file (to avoid costly I/O latency delays).</li>
<li>
			<span id="crayon-56d5b2919054c109375439" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">recording</span></span></span> : Boolean value indicating whether or not we are in “recording mode”.</li>
</ul>
<p>Next up, let’s review the 
			<span id="crayon-56d5b29190550012031941" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">update</span></span></span>  method:</p>

		<div id="crayon-56d5b29190553015782654" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190553015782654-24"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b29190553015782654-25"><span class="crayon-h">		</span><span class="crayon-c"># update the frames buffer</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190553015782654-26"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">frames</span><span class="crayon-sy">.</span><span class="crayon-e">appendleft</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190553015782654-27"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190553015782654-28"><span class="crayon-h">		</span><span class="crayon-c"># if we are recording, update the queue as well</span></p><p class="crayon-line" id="crayon-56d5b29190553015782654-29"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recording</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190553015782654-30"><span class="crayon-h">			</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The 
			<span id="crayon-56d5b29190557965900202" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">update</span></span></span>  function requires a single parameter, the 
			<span id="crayon-56d5b29190560996177721" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  read from our video stream. We take this 
			<span id="crayon-56d5b29190564379062571" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  and store it in our 
			<span id="crayon-56d5b29190567233016189" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frames</span></span></span>  buffer (<strong>Line 26</strong>). And if we are already in recording mode, we’ll store the 
			<span id="crayon-56d5b2919056b379546238" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  in the 
			<span id="crayon-56d5b2919056e848482535" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Queue</span></span></span>  as well so it can be flushed to video file (<strong>Lines 29 and 30</strong>).</p>
<p>In order to kick-off an actual video clip recording, we need a 
			<span id="crayon-56d5b29190572855949936" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">start</span></span></span>  method:</p>

		<div id="crayon-56d5b29190575131580636" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-32">32</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-34">34</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-36">36</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-38">38</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-40">40</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-42">42</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-44">44</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-46">46</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190575131580636-48">48</p><p class="crayon-num" data-line="crayon-56d5b29190575131580636-49">49</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-32"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputPath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">fourcc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">fps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-33"><span class="crayon-h">		</span><span class="crayon-c"># indicate that we are recording, start the video writer,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-34"><span class="crayon-h">		</span><span class="crayon-c"># and initialize the queue of frames that need to be written</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-35"><span class="crayon-h">		</span><span class="crayon-c"># to the video file</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-36"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recording</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-37"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">writer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">VideoWriter</span><span class="crayon-sy">(</span><span class="crayon-v">outputPath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">fourcc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">fps</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-38"><span class="crayon-h">			</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">frames</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">frames</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-39"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">Queue</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-40"> </p><p class="crayon-line" id="crayon-56d5b29190575131580636-41"><span class="crayon-h">		</span><span class="crayon-c"># loop over the frames in the deque structure and add them</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-42"><span class="crayon-h">		</span><span class="crayon-c"># to the queue</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-43"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">frames</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-44"><span class="crayon-h">			</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">frames</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-45"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-46"><span class="crayon-h">		</span><span class="crayon-c"># start a thread write frames to the video file</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-47"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-k ">thread</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">Thread</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">write</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190575131580636-48"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-k ">thread</span><span class="crayon-sy">.</span><span class="crayon-v">daemon</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></p><p class="crayon-line" id="crayon-56d5b29190575131580636-49"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-k ">thread</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>First, we update our 
			<span id="crayon-56d5b2919057a686559531" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">recording</span></span></span>  boolean to indicate that we are in “recording mode”. Then, we initialize the 
			<span id="crayon-56d5b2919057e125654528" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoWriter</span></span></span>  using the supplied 
			<span id="crayon-56d5b29190581346302419" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">outputPath</span></span></span> , 
			<span id="crayon-56d5b29190585994354216" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">fourcc</span></span></span> , and 
			<span id="crayon-56d5b29190589473999770" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">fps</span></span></span>  provided to the 
			<span id="crayon-56d5b2919058d826614927" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">start</span></span></span>  method, along with the frame spatial dimensions (i.e., width and height). For a complete review of the 
			<span id="crayon-56d5b29190590882590640" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoWriter</span></span></span>  parameters, <a href="http://www.pyimagesearch.com/2016/02/22/writing-to-video-with-opencv/" target="_blank">please refer to this blog post</a>.</p>
<p><strong>Line 39</strong> initializes our 
			<span id="crayon-56d5b29190594422729594" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Queue</span></span></span>  used to store the frames ready to be written to file. We then loop over all frames in our 
			<span id="crayon-56d5b29190597247432143" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frames</span></span></span>  buffer and add them to the queue.</p>
<p>Finally, we spawn a separate thread to handle writing frames to video — this way we don’t slow down our main video processing pipeline by waiting for I/O operations to complete.</p>
<p>As noted above, the 
			<span id="crayon-56d5b2919059f414114973" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">start</span></span></span>  method creates a new thread, calling the 
			<span id="crayon-56d5b291905a3465173429" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">write</span></span></span>  method used to write frames inside the 
			<span id="crayon-56d5b291905a8150632595" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Q</span></span></span>  to file. Let’s define this 
			<span id="crayon-56d5b291905ab342956707" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">write</span></span></span>  method:</p>

		<div id="crayon-56d5b291905ae497124319" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-52">52</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-54">54</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-56">56</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-58">58</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-60">60</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-62">62</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-63">63</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-64">64</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-65">65</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-66">66</p><p class="crayon-num" data-line="crayon-56d5b291905ae497124319-67">67</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b291905ae497124319-68">68</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b291905ae497124319-51"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-52"><span class="crayon-h">		</span><span class="crayon-c"># keep looping</span></p><p class="crayon-line" id="crayon-56d5b291905ae497124319-53"><span class="crayon-h">		</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-54"><span class="crayon-h">			</span><span class="crayon-c"># if we are done recording, exit the thread</span></p><p class="crayon-line" id="crayon-56d5b291905ae497124319-55"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recording</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-56"><span class="crayon-h">				</span><span class="crayon-st">return</span></p><p class="crayon-line" id="crayon-56d5b291905ae497124319-57"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-58"><span class="crayon-h">			</span><span class="crayon-c"># check to see if there are entries in the queue</span></p><p class="crayon-line" id="crayon-56d5b291905ae497124319-59"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-sy">.</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-60"><span class="crayon-h">				</span><span class="crayon-c"># grab the next frame in the queue and write it</span></p><p class="crayon-line" id="crayon-56d5b291905ae497124319-61"><span class="crayon-h">				</span><span class="crayon-c"># to the video file</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-62"><span class="crayon-h">				</span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b291905ae497124319-63"><span class="crayon-h">				</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">writer</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-64"> </p><p class="crayon-line" id="crayon-56d5b291905ae497124319-65"><span class="crayon-h">			</span><span class="crayon-c"># otherwise, the queue is empty, so sleep for a bit</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-66"><span class="crayon-h">			</span><span class="crayon-c"># so we don't waste CPU cycles</span></p><p class="crayon-line" id="crayon-56d5b291905ae497124319-67"><span class="crayon-h">			</span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905ae497124319-68"><span class="crayon-h">				</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">sleep</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">timeout</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Line 53</strong> starts an infinite loop that will continue polling for new frames and writing them to file until our video recording has finished.</p>
<p><strong>Lines 55 and 56</strong> make a check to see if the recording should be stopped, and if so, we return from the thread.</p>
<p>Otherwise, if the 
			<span id="crayon-56d5b291905b3879900777" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Q</span></span></span>  is not empty, we grab the next frame and write it to the video file (<strong>Lines 59-63</strong>).</p>
<p>If there are no frames in the 
			<span id="crayon-56d5b291905b7866118323" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Q</span></span></span> , we sleep for a bit so we don’t needlessly waste CPU cycles spinning (<strong>Lines 67 and 68</strong>). This is <em>especially important</em> when using the 
			<span id="crayon-56d5b291905ba842075144" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Queue</span></span></span>  data structure which is <em>thread-safe</em>, implying that we must acquire a lock/semaphore prior to updating the internal buffer. If we don’t call 
			<span id="crayon-56d5b291905be690541099" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">time</span><span class="crayon-sy">.</span><span class="crayon-v">sleep</span></span></span>  when the buffer is empty, then the 
			<span id="crayon-56d5b291905c6435162015" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">write</span></span></span>  and 
			<span id="crayon-56d5b291905c9930335057" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">update</span></span></span>  methods will constantly be fighting for the lock. Instead, it’s best to let the writer sleep for a bit until there are a backlog of frames in the queue that need to be written to file.</p>
<p>We’ll also define a 
			<span id="crayon-56d5b291905cd115312251" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">flush</span></span></span>  method which simply takes all frames left in the 
			<span id="crayon-56d5b291905d1165042036" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Q</span></span></span>  and dumps them to file:</p>

		<div id="crayon-56d5b291905d4107326321" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905d4107326321-70"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">flush</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b291905d4107326321-71"><span class="crayon-h">		</span><span class="crayon-c"># empty the queue by flushing all remaining frames to file</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905d4107326321-72"><span class="crayon-h">		</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-sy">.</span><span class="crayon-e">empty</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b291905d4107326321-73"><span class="crayon-h">			</span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">Q</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905d4107326321-74"><span class="crayon-h">			</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">writer</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>A method like this is used when a video recording has finished and we need to immediately flush all frames to file.</p>
<p>Finally, we define the 
			<span id="crayon-56d5b291905da924400760" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">finish</span></span></span>  method below:</p>

		<div id="crayon-56d5b291905dd504986656" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905dd504986656-76"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">finish</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b291905dd504986656-77"><span class="crayon-h">		</span><span class="crayon-c"># indicate that we are done recording, join the thread,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905dd504986656-78"><span class="crayon-h">		</span><span class="crayon-c"># flush all remaining frames in the queue to file, and</span></p><p class="crayon-line" id="crayon-56d5b291905dd504986656-79"><span class="crayon-h">		</span><span class="crayon-c"># release the writer pointer</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905dd504986656-80"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">recording</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">False</span></p><p class="crayon-line" id="crayon-56d5b291905dd504986656-81"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-k ">thread</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b291905dd504986656-82"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">flush</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b291905dd504986656-83"><span class="crayon-h">		</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">writer</span><span class="crayon-sy">.</span><span class="crayon-e">release</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This method indicates that the recording has been completed, joins the writer thread with the main script, flushes the remaining frames in the 
			<span id="crayon-56d5b291905e3738205863" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">Q</span></span></span> to file, and finally releases the 
			<span id="crayon-56d5b291905eb646485350" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">VideoWriter</span></span></span>  pointer.</p>
<p>Now that we have defined the 
			<span id="crayon-56d5b291905ef675096262" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span>  class, we can move on to the driver script used to implement the “key/interesting event” detection.</p>
<h3>Saving key events with OpenCV</h3>
<p>In order to keep this blog post simple and hands-on, we’ll define our “key event” to be when this green ball enters our video stream:</p>
<div id="attachment_3709" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_demo.gif"><img class="wp-image-3709" src="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_demo.gif" alt="Figure 2: An example of a key/interesting event in a video stream."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> An example of a key/interesting event in a video stream.</p></div>
<p>Once we see this green ball, we will call 
			<span id="crayon-56d5b291905f3416429676" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span>  to write all frames that contain the green ball to file. Essentially, this will give us a set of short video clips that neatly summarizes the events of the <em>entire</em> video stream — in short, <em><strong>a video synopsis</strong></em>.</p>
<p>Of course, you can use this code as a boilerplate/starting point to defining your own actions — we’ll simply use the “green ball” event since we have covered it multiple times before on the PyImageSearch blog, including <a href="http://www.pyimagesearch.com/2015/09/21/opencv-track-object-movement/" target="_blank">tracking object movement</a> and <a href="http://www.pyimagesearch.com/2015/09/14/ball-tracking-with-opencv/" target="_blank">ball tracking</a>.</p>
<p>Before you proceed with the rest of this tutorial, make sure you have the <a href="https://github.com/jrosebr1/imutils" target="_blank">imutils</a> package installed on your system:</p>

		

<p>This will ensure that you can use the 
			<span id="crayon-56d5b291905ff176538600" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  class which creates a <a href="http://www.pyimagesearch.com/2016/01/04/unifying-picamera-and-cv2-videocapture-into-a-single-class-with-opencv/" target="_blank">unified access to both builtin/USB webcams and the Raspberry Pi camera module</a>.</p>
<p>Let’s go ahead and get started. Open up the 
			<span id="crayon-56d5b29190603626995284" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">save_key_events</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  file and insert the following code:</p>

		<div id="crayon-56d5b29190606478860314" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b29190606478860314-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-2">2</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-4">4</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-6">6</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-8">8</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-10">10</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-12">12</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-14">14</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-16">16</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-18">18</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-20">20</p><p class="crayon-num" data-line="crayon-56d5b29190606478860314-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190606478860314-22">22</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b29190606478860314-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">pyimagesearch</span><span class="crayon-sy">.</span><span class="crayon-e">keyclipwriter </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">KeyClipWriter</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">video </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">VideoStream</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">imutils</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-8"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-10"><span class="crayon-c"># construct the argument parse and parse the arguments</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-11"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-12"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-o"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--output"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-13"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"path to output directory"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-14"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-p"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--picamera"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">type</span><span class="crayon-o">=</span><span class="crayon-k ">int</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">default</span><span class="crayon-o">=</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-15"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"whether or not the Raspberry Pi camera should be used"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-16"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-f"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--fps"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">type</span><span class="crayon-o">=</span><span class="crayon-k ">int</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">default</span><span class="crayon-o">=</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-17"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"FPS of output video"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-18"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-c"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--codec"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">type</span><span class="crayon-o">=</span><span class="crayon-k ">str</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">default</span><span class="crayon-o">=</span><span class="crayon-s">"MJPG"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-19"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"codec of output video"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-20"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-b"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--buffer-size"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">type</span><span class="crayon-o">=</span><span class="crayon-k ">int</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">default</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5b29190606478860314-21"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"buffer size of video clip writer"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190606478860314-22"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 2-8</strong> import our necessary Python packages while <strong>Lines 11-22</strong> parse our command line arguments. The set of command line arguments are detailed below:</p>
<ul>
<li>
			<span id="crayon-56d5b2919060a604265381" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">output</span></span></span> : This is the path to the <em>output directory</em> where we will store the output video clips.</li>
<li>
			<span id="crayon-56d5b2919060e714212734" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">picamera</span></span></span> : If you want to use your Raspberry Pi camera (rather than a builtin/USB webcam), then supply a value of 
			<span id="crayon-56d5b29190612605719908" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-i">picamera</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></span></span> . You can read more about accessing both builtin/USB webcams and the Raspberry Pi camera module (without changing a single line of code) <a href="http://www.pyimagesearch.com/2016/01/04/unifying-picamera-and-cv2-videocapture-into-a-single-class-with-opencv/" target="_blank">in this post</a>.</li>
<li>
			<span id="crayon-56d5b29190615639536242" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">fps</span></span></span> : This switch controls the desired FPS of your output video. This value should be similar to the number of frames per second your image processing pipeline can process.</li>
<li>
			<span id="crayon-56d5b29190619570188855" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">codec</span></span></span> : The <a href="http://www.fourcc.org/codecs.php" target="_blank">FourCC</a> codec of the output video clips. Please see the <a href="http://www.pyimagesearch.com/2016/02/22/writing-to-video-with-opencv/" target="_blank">previous post for more information</a>.</li>
<li>
			<span id="crayon-56d5b2919061c886599530" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">buffer</span><span class="crayon-o">-</span><span class="crayon-v">size</span></span></span> : The size of the in-memory buffer used to store the most recently polled frames from the camera sensor. A larger 
			<span id="crayon-56d5b29190620284456542" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">buffer</span><span class="crayon-o">-</span><span class="crayon-v">size</span></span></span>  will allow for more context before and after the “key event” to be included in the output video clip, while a smaller 
			<span id="crayon-56d5b29190623545298472" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">buffer</span><span class="crayon-o">-</span><span class="crayon-v">size</span></span></span>  will store less frames before and after the “key event”.</li>
</ul>
<p>Let’s perform some initialization:</p>

		<div id="crayon-56d5b29190627912189676" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-24">24</p><p class="crayon-num" data-line="crayon-56d5b29190627912189676-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-26">26</p><p class="crayon-num" data-line="crayon-56d5b29190627912189676-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-28">28</p><p class="crayon-num" data-line="crayon-56d5b29190627912189676-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-30">30</p><p class="crayon-num" data-line="crayon-56d5b29190627912189676-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-32">32</p><p class="crayon-num" data-line="crayon-56d5b29190627912189676-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-34">34</p><p class="crayon-num" data-line="crayon-56d5b29190627912189676-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-36">36</p><p class="crayon-num" data-line="crayon-56d5b29190627912189676-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190627912189676-38">38</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-24"><span class="crayon-c"># initialize the video stream and allow the camera sensor to</span></p><p class="crayon-line" id="crayon-56d5b29190627912189676-25"><span class="crayon-c"># warmup</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-26"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">"[INFO] warming up camera..."</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190627912189676-27"><span class="crayon-v">vs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">VideoStream</span><span class="crayon-sy">(</span><span class="crayon-v">usePiCamera</span><span class="crayon-o">=</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"picamera"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-28"><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">2.0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190627912189676-29"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-30"><span class="crayon-c"># define the lower and upper boundaries of the "green" ball in</span></p><p class="crayon-line" id="crayon-56d5b29190627912189676-31"><span class="crayon-c"># the HSV color space</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-32"><span class="crayon-v">greenLower</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">29</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">86</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190627912189676-33"><span class="crayon-v">greenUpper</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-34"> </p><p class="crayon-line" id="crayon-56d5b29190627912189676-35"><span class="crayon-c"># initialize key clip writer and the consecutive number of</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-36"><span class="crayon-c"># frames that have *not* contained any action</span></p><p class="crayon-line" id="crayon-56d5b29190627912189676-37"><span class="crayon-v">kcw</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">KeyClipWriter</span><span class="crayon-sy">(</span><span class="crayon-v">bufSize</span><span class="crayon-o">=</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"buffer_size"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190627912189676-38"><span class="crayon-v">consecFrames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 26-28</strong> initialize our 
			<span id="crayon-56d5b2919062c885310130" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">VideoStream</span></span></span>  and allow the camera sensor to warmup.</p>
<p>From there, <strong>Lines 32 and 33</strong> define the lower and upper color threshold boundaries for the green ball in the HSV color space. For more information on how we defined these color threshold values, <a href="http://www.pyimagesearch.com/2015/09/14/ball-tracking-with-opencv/" target="_blank">please see this post</a>.</p>
<p><strong>Line 37</strong> instantiates our 
			<span id="crayon-56d5b29190634317616301" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span>  using our supplied 
			<span id="crayon-56d5b29190638157389316" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">buffer</span><span class="crayon-o">-</span><span class="crayon-v">size</span></span></span> , along with initializing an integer used to count the number of <i>consecutive frames</i> that <i>have not</i> contained any interesting events.</p>
<p>We are now ready to start processing frames from our video stream:</p>

		<div id="crayon-56d5b2919063b710684920" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-40">40</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-42">42</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-44">44</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-46">46</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-48">48</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-50">50</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-51">51</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-52">52</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-54">54</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-56">56</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-58">58</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-60">60</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b2919063b710684920-62">62</p><p class="crayon-num" data-line="crayon-56d5b2919063b710684920-63">63</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-40"><span class="crayon-c"># keep looping</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-41"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-42"><span class="crayon-h">	</span><span class="crayon-c"># grab the current frame, resize it, and initialize a</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-43"><span class="crayon-h">	</span><span class="crayon-c"># boolean used to indicate if the consecutive frames</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-44"><span class="crayon-h">	</span><span class="crayon-c"># counter should be updated</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-45"><span class="crayon-h">	</span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vs</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-46"><span class="crayon-h">	</span><span class="crayon-v">frame</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">resize</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-cn">600</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-47"><span class="crayon-h">	</span><span class="crayon-v">updateConsecFrames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-48"> </p><p class="crayon-line" id="crayon-56d5b2919063b710684920-49"><span class="crayon-h">	</span><span class="crayon-c"># blur the frame and convert it to the HSV color space</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-50"><span class="crayon-h">	</span><span class="crayon-v">blurred</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">GaussianBlur</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">11</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-51"><span class="crayon-h">	</span><span class="crayon-v">hsv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">blurred</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2HSV</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-52"> </p><p class="crayon-line" id="crayon-56d5b2919063b710684920-53"><span class="crayon-h">	</span><span class="crayon-c"># construct a mask for the color "green", then perform</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-54"><span class="crayon-h">	</span><span class="crayon-c"># a series of dilations and erosions to remove any small</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-55"><span class="crayon-h">	</span><span class="crayon-c"># blobs left in the mask</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-56"><span class="crayon-h">	</span><span class="crayon-v">mask</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">inRange</span><span class="crayon-sy">(</span><span class="crayon-v">hsv</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">greenLower</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">greenUpper</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-57"><span class="crayon-h">	</span><span class="crayon-v">mask</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">erode</span><span class="crayon-sy">(</span><span class="crayon-v">mask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-58"><span class="crayon-h">	</span><span class="crayon-v">mask</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">dilate</span><span class="crayon-sy">(</span><span class="crayon-v">mask</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-59"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-60"><span class="crayon-h">	</span><span class="crayon-c"># find contours in the mask</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-61"><span class="crayon-h">	</span><span class="crayon-v">cnts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">findContours</span><span class="crayon-sy">(</span><span class="crayon-v">mask</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">RETR_EXTERNAL</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919063b710684920-62"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CHAIN_APPROX_SIMPLE</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b2919063b710684920-63"><span class="crayon-h">	</span><span class="crayon-v">cnts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cnts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">is_cv2</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">cnts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On <strong>Line 41</strong> we start to looping over frames from our video stream. <strong>Lines 45 and 46 </strong>read the next 
			<span id="crayon-56d5b29190641878742478" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  from the video stream and then resizes it to have a width of 600 pixels.</p>
<p>Further pre-processing is done on <strong>Lines 50 and 51</strong> by blurring the image slightly and then converting the image from the RGB color space to the HSV color space (so we can apply our color thresholding).</p>
<p>The actual color thresholding is performed on <strong>Line 56</strong> using the 
			<span id="crayon-56d5b29190649312683811" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">inRange</span></span></span>  function. This method finds all pixels <em>p</em> that are 
			<span id="crayon-56d5b2919064d968657425" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">greenLower</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">greenUpper</span></span></span> . We then perform a series of erosions and dilations to remove any small blobs left in the mask.</p>
<p>Finally, <strong>Lines 61-63</strong> find contours in the thresholded image.</p>
<p>If you are confused about any step of this processing pipeline, I would suggest going back to our previous posts on <a href="http://www.pyimagesearch.com/2015/09/14/ball-tracking-with-opencv/" target="_blank">ball tracking</a> and <a href="http://www.pyimagesearch.com/2015/09/21/opencv-track-object-movement/" target="_blank">object movement</a> to further familiarize yourself with the topic.</p>
<p>We are now ready to check and see if the green ball was found in our image:</p>

		<div id="crayon-56d5b29190651857075168" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5b29190651857075168-65">65</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-66">66</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-67">67</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-68">68</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-69">69</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-70">70</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-71">71</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-72">72</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-73">73</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-74">74</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-75">75</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-76">76</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-77">77</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-78">78</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-79">79</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-80">80</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-81">81</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-82">82</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-83">83</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-84">84</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-85">85</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-86">86</p><p class="crayon-num" data-line="crayon-56d5b29190651857075168-87">87</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190651857075168-88">88</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b29190651857075168-65"><span class="crayon-h">	</span><span class="crayon-c"># only proceed if at least one contour was found</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-66"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-67"><span class="crayon-h">		</span><span class="crayon-c"># find the largest contour in the mask, then use it</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-68"><span class="crayon-h">		</span><span class="crayon-c"># to compute the minimum enclosing circle</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-69"><span class="crayon-h">		</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">max</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">contourArea</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-70"><span class="crayon-h">		</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">radius</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">minEnclosingCircle</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-71"><span class="crayon-h">		</span><span class="crayon-v">updateConsecFrames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">radius</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-72"> </p><p class="crayon-line" id="crayon-56d5b29190651857075168-73"><span class="crayon-h">		</span><span class="crayon-c"># only proceed if the redius meets a minimum size</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-74"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">radius</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-75"><span class="crayon-h">			</span><span class="crayon-c"># reset the number of consecutive frames with</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-76"><span class="crayon-h">			</span><span class="crayon-c"># *no* action to zero and draw the circle</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-77"><span class="crayon-h">			</span><span class="crayon-c"># surrounding the object</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-78"><span class="crayon-h">			</span><span class="crayon-v">consecFrames</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-79"><span class="crayon-h">			</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">circle</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">radius</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-80"><span class="crayon-h">				</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-81"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-82"><span class="crayon-h">			</span><span class="crayon-c"># if we are not already recording, start recording</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-83"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">kcw</span><span class="crayon-sy">.</span><span class="crayon-v">recording</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-84"><span class="crayon-h">				</span><span class="crayon-v">timestamp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-k ">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">now</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-85"><span class="crayon-h">				</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"{}/{}.avi"</span><span class="crayon-sy">.</span><span class="crayon-k ">format</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"output"</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-86"><span class="crayon-h">					</span><span class="crayon-v">timestamp</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">"%Y%m%d-%H%M%S"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190651857075168-87"><span class="crayon-h">				</span><span class="crayon-v">kcw</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">VideoWriter_fourcc</span><span class="crayon-sy">(</span><span class="crayon-o">*</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"codec"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190651857075168-88"><span class="crayon-h">					</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"fps"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Line 66</strong> makes a check to ensure that at least one contour was found, and if so, <strong>Line 69 and 70</strong> find the largest contour in the mask (according to the area) and use this contour to compute the minimum enclosing circle.</p>
<p>If the radius of the circle meets a minimum suze of 10 pixels (<strong>Line 74</strong>), then we will assume that we have found the green ball. <strong>Lines 78-80</strong> reset the number of 
			<span id="crayon-56d5b29190657914636495" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">consecFrames</span></span></span>  that do not contain any interesting events (since an interesting event is “currently happening”) and draw a circle highlighting our ball in the frame.</p>
<p>Finally, we make a check if to see if we are currently recording a video clip (<strong>Line 83</strong>). If not, we generate an output filename for the video clip based on the current timestamp and call the 
			<span id="crayon-56d5b29190662603069968" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">start</span></span></span>  method of the 
			<span id="crayon-56d5b29190665545647573" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">KeyClipWriter</span></span></span> .</p>
<p>Otherwise, we’ll assume no key/interesting event has taken place:</p>

		<div id="crayon-56d5b29190668620849430" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-90">90</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-91">91</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-92">92</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-93">93</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-94">94</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-95">95</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-96">96</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-97">97</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-98">98</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-99">99</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-100">100</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-101">101</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-102">102</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-103">103</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-104">104</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-105">105</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-106">106</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-107">107</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-108">108</p><p class="crayon-num" data-line="crayon-56d5b29190668620849430-109">109</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5b29190668620849430-110">110</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-90"><span class="crayon-h">	</span><span class="crayon-c"># otherwise, no action has taken place in this frame, so</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-91"><span class="crayon-h">	</span><span class="crayon-c"># increment the number of consecutive frames that contain</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-92"><span class="crayon-h">	</span><span class="crayon-c"># no action</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-93"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">updateConsecFrames</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-94"><span class="crayon-h">		</span><span class="crayon-v">consecFrames</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-95"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-96"><span class="crayon-h">	</span><span class="crayon-c"># update the key frame clip buffer</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-97"><span class="crayon-h">	</span><span class="crayon-v">kcw</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-98"> </p><p class="crayon-line" id="crayon-56d5b29190668620849430-99"><span class="crayon-h">	</span><span class="crayon-c"># if we are recording and reached a threshold on consecutive</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-100"><span class="crayon-h">	</span><span class="crayon-c"># number of frames with no action, stop recording the clip</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-101"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">kcw</span><span class="crayon-sy">.</span><span class="crayon-e">recording </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">consecFrames</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"buffer_size"</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-102"><span class="crayon-h">		</span><span class="crayon-v">kcw</span><span class="crayon-sy">.</span><span class="crayon-e">finish</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-103"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-104"><span class="crayon-h">	</span><span class="crayon-c"># show the frame</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-105"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Frame"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">frame</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-106"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">0xFF</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-107"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-108"><span class="crayon-h">	</span><span class="crayon-c"># if the `q` key was pressed, break from the loop</span></p><p class="crayon-line" id="crayon-56d5b29190668620849430-109"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-k ">ord</span><span class="crayon-sy">(</span><span class="crayon-s">"q"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b29190668620849430-110"><span class="crayon-h">		</span><span class="crayon-st">break</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>If no interesting event has happened, we update 
			<span id="crayon-56d5b2919066f474913472" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">consecFrames</span></span></span>  and pass the 
			<span id="crayon-56d5b29190677939456711" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  over to our buffer.</p>
<p><strong>Line 101</strong> makes an important check — if we <em>are recording</em> and have reached a sufficient number of <em>consecutive frames</em> <em><strong>with no key event</strong></em>, then we should stop the recording.</p>
<p>Finally, <strong>Lines 105-110</strong> display the output 
			<span id="crayon-56d5b2919067c164087872" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">frame</span></span></span>  to our screen and wait for a keypress.</p>
<p>Our final block of code ensures the video has been successfully closed and then performs a bit of cleanup:</p>

		<div id="crayon-56d5b2919067f957604562" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919067f957604562-112"><span class="crayon-c"># if we are in the middle of recording a clip, wrap it up</span></p><p class="crayon-line" id="crayon-56d5b2919067f957604562-113"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">kcw</span><span class="crayon-sy">.</span><span class="crayon-v">recording</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919067f957604562-114"><span class="crayon-h">	</span><span class="crayon-v">kcw</span><span class="crayon-sy">.</span><span class="crayon-e">finish</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5b2919067f957604562-115"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919067f957604562-116"><span class="crayon-c"># do a bit of cleanup</span></p><p class="crayon-line" id="crayon-56d5b2919067f957604562-117"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">destroyAllWindows</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5b2919067f957604562-118"><span class="crayon-v">vs</span><span class="crayon-sy">.</span><span class="crayon-e">stop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h3>Video synopsis results</h3>
<p>To generate video clips for key events (i.e., the green ball appearing on our video stream), just execute the following command:</p>

		<div id="crayon-56d5b29190686621156129" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5b29190686621156129-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">save_key_events</span><span class="crayon-sy">.</span><span class="crayon-v">py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">output </span><span class="crayon-v">output</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>I’ve included the full <strong>1m 46s</strong> video (<em>without</em> extracting salient clips) below:</p>
<p><iframe src="http://www.youtube.com/embed/QQxf0xV1WK0?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p>After running the 
			<span id="crayon-56d5b2919068e393147455" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">save_key_events</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  script, I now have <strong>4 output videos</strong>, one for each the time green ball was present in my video stream:</p>
<div id="attachment_3710" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_output_files.jpg"><img class="size-full wp-image-3710" src="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_output_files.jpg" alt="Figure 3: Creating a separate video clip for each interesting and key event." srcset="http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_output_files-300x187.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2016/02/key_event_output_files.jpg 600w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Creating a separate video clip for each interesting and key event.</p></div>
<p>The key event video clips are displayed below to demonstrate that our script is working properly, accurately extracting our “interesting events”, and essentially building a series of video clips functioning as a <em>video synopsis:</em></p>
<p><strong>Video clip #1:</strong></p>
<p><iframe src="http://www.youtube.com/embed/ZMit4-HhOM4?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p><strong>Video clip #2:</strong></p>
<p><iframe src="http://www.youtube.com/embed/YGqWgY36HX0?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p><strong>Video clip #3:</strong></p>
<p><iframe src="http://www.youtube.com/embed/tWlV9aAEfLM?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<p><strong>Video clip #4:</strong></p>
<p><iframe src="http://www.youtube.com/embed/sHfOUwjx6Fc?feature=oembed" frameborder="0" allowfullscreen="">VIDEO</iframe></p>
<h2>Summary</h2>
<p>In this blog post, we learned how to save key event video clips to file using OpenCV and Python.</p>
<p>Exactly what defines a “key or interesting event” is entirely dependent on your application and the goals of your overall project. Examples of <em>key events</em> can include:</p>
<ul>
<li>Monitoring your front door for motion detection (i.e., someone entering your house).</li>
<li>Recognizing the face of an intruder as they enter your house.</li>
<li>Reporting unsafe driving outside your home to the authorities.</li>
</ul>
<p>Again, exactly what constitutes a “key event” is near endless. However, regardless of how you define an interesting event, you can still use the Python code detailed in this post to help save these interesting events to file as a shortened video clip.</p>
<p>Using this methodology, you can condense <em><strong>hours</strong></em> of video stream footage into <em><strong>seconds</strong></em> of interesting events, effectively yielding a <strong><em>video synopsis</em></strong> — all generated using Python, computer vision, and image processing techniques.</p>
<p>Anyway, I hope you enjoyed this blog post!</p>
<p>If you did, please consider sharing it on your favorite social media outlet such as <a href="https://www.facebook.com/" target="_blank">Facebook</a>, <a href="https://twitter.com/" target="_blank">Twitter</a>, <a href="https://www.linkedin.com/" target="_blank">LinkedIn</a>, etc. I put <em>a lot</em> of effort into the past two blog posts in this series and I would really appreciate it if you could help spread the word.</p>
<p><em><strong>And before you, be sure to signup for the PyImageSearch Newsletter using the form below to receive email updates when new posts go live!</strong></em></p>
<h2 id="post_downloads">Downloads:</h2>

	</section>
	</div></body></html>