<html><body><div><div class="article--content">

            <blockquote>
                <strong>
                We are available for Go/Python/Haskell/Data Science projects. Drop us a mail at <a href="mailto:team@wearewizards.io">team@wearewizards.io</a>!
                </strong>
            </blockquote>

            <p>Everyone I know who has ever used
<a href="http://hackage.haskell.org/package/QuickCheck/">QuickCheck</a> in anger cannot live without it.
</p>
<p>The basic idea behind QuickCheck is that we write a proposition, e.g.:
<em>Reversing a list twice returns the same as the original list</em>. In
code:</p>



<p>QuickCheck will try to find a counterexample to that proposition by
generating random values for <code>x</code>. And it is very good at finding mean values:</p>




<h3>Shrinking</h3>
<p>The really cool part is that when QuickCheck finds a counterexample it
will attempt to make the example smaller. Lets say we have a broken
reverse function that sorts the list instead. So for the input:</p>



<p>our broken reverse returns:</p>



<p>instead of the correct:</p>



<p>QuickCheck will shrink the input to <code>[2, 0, -1]</code> which still breaks
but is much easier to debug. Neat!</p>
<h2>Calling Python from Haskell</h2>
<p>There is a relatively recent package on Hackage called
<a href="http://hackage.haskell.org/package/pyfi">pyfi</a>. It calls Python
through it's C FFI and passes values by converting them to and from
JSON. It comes with a great tutorial on its
<a href="https://github.com/Russell91/pyfi">github page</a>.</p>
<h2>QuickCheck</h2>
<p>We start with a simple python module:</p>
<div class="highlight"><pre><span class="c"># moremath.py</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</pre></div>


<p>In Haskell every call to Python happens in the IO monad so we have to
use monadic QuickCheck:</p>
<div class="highlight"><pre><span class="c1">-- squarecheck.hs</span>
<span class="kr">import</span> <span class="nn">Python</span>
<span class="kr">import</span> <span class="nn">Test.QuickCheck</span>
<span class="kr">import</span> <span class="nn">Test.QuickCheck.Monadic</span>

<span class="nf">square</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">square</span> <span class="ow">=</span> <span class="n">defVV</span> <span class="s">"from moremath import square as export"</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">quickCheck</span> <span class="o">$</span> <span class="n">monadicIO</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">v</span> <span class="ow">&lt;-</span> <span class="n">pick</span> <span class="n">arbitrary</span>
    <span class="n">r</span> <span class="ow">&lt;-</span> <span class="n">run</span> <span class="o">$</span> <span class="n">square</span> <span class="n">v</span>
    <span class="n">assert</span> <span class="o">$</span> <span class="n">r</span> <span class="o">==</span> <span class="n">v</span> <span class="o">*</span> <span class="n">v</span>
</pre></div>


<p>Now we can run the tests like so:</p>
<div class="highlight"><pre><span class="gp">$</span> runhaskell squarecheck.hs
<span class="go">+++ OK, passed 100 tests.</span>
</pre></div>


<p>That's all there is to it!</p>
<p><strong>Edit:</strong> Someone sent me a link to
<a href="https://github.com/DRMacIver/hypothesis">hypothesis</a> which looks like
a really solid Python version of QuickCheck. The API has been adjusted
to fit into Python. Most importantly, it has a good shrinker!</p>
        </div>

        </div></body></html>