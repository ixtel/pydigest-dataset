<html><body><div><section class="post-content entry-content">
	            

<p>Don’t use Python’s <code>hasattr()</code> unless you’re writing Python 3-<em>only</em> code <em>and</em> understand how it works.</p>

<p><code>hasattr()</code> is a common topic in Python code reviews.  So instead of producing gists for each one, here once and for all:</p>

<p>Do <strong>not</strong>:</p>

<pre><code class="language-python">if hasattr(x, "y"):
    print(x.y)
else:
    print("no y!")
</code></pre>

<p><strong>Do</strong> instead:</p>

<pre><code class="language-python">try:
    print(x.y)
except AttributeError:
    print("no y!")
</code></pre>

<p>or<sup class="footnote-ref" id="fnref:93a0bf14e0f3a9528e0931018574635f:sentinel"><a rel="footnote" href="#fn:93a0bf14e0f3a9528e0931018574635f:sentinel">1</a></sup>:</p>

<pre><code class="language-python">y = getattr(x, "y", None)
if y is not None:
    print(y)
else:
    print("no y!")
</code></pre>

<p><strong>Especially</strong>, if you’re handling classes that aren’t your own.</p>

<p><code>hasattr()</code> also is <em>not</em> faster than <code>getattr()</code> since it goes through the exactly same lookup process and then throws away the result<sup class="footnote-ref" id="fnref:93a0bf14e0f3a9528e0931018574635f:cpython"><a rel="footnote" href="#fn:93a0bf14e0f3a9528e0931018574635f:cpython">2</a></sup>.</p>

<h2 id="why:93a0bf14e0f3a9528e0931018574635f">Why?</h2>

<p>It might seem similar and the extra lines is annoying, but using <code>hasattr()</code> on Python <strong>2</strong> is close to writing:</p>

<pre><code class="language-python">try:
    print(x.y)
except:
    print("no y!")
</code></pre>

<p>Which is almost never what you want because it shadows errors in properties:</p>

<pre><code class="language-pycon">&gt;&gt;&gt; class C(object):
...     @property
...     def y(self):
...         0/0
...
&gt;&gt;&gt; hasattr(C(), "y")
False
</code></pre>

<p>Since in third party classes you can’t know whether an attribute is a property (or becomes one through an update after months or years), this is dangerous.</p>

<p>Do you think that’s no big deal?  Check out this glowing <a href="https://news.ycombinator.com/item?id=10893431">testimonial</a>!  Another visible implication is that using <code>hasattr()</code> on properties <em>does</em> execute their getter function which makes the name misleading.</p>

<hr/>

<p>Python 3 gets it right<sup class="footnote-ref" id="fnref:93a0bf14e0f3a9528e0931018574635f:py3"><a rel="footnote" href="#fn:93a0bf14e0f3a9528e0931018574635f:py3">3</a></sup>:</p>

<pre><code class="language-pycon">&gt;&gt;&gt; class C:
...     @property
...     def y(self):
...         0/0
...
&gt;&gt;&gt; hasattr(C(), "y")
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "&lt;stdin&gt;", line 4, in y
ZeroDivisionError: division by zero
</code></pre>

<p>Which makes it another edge case when writing hybrid code for both Python 2 and 3.  But, would you expect <code>hasattr()</code> to raise that error?</p>

<hr/>

<p>The observant reader might ask, what about <code>AttributeError</code>s?  And indeed: there’s no way to distinguish an <code>AttributeError</code> that is caused by a missing attribute and an <code>AttributeError</code> that is caused by a buggy property.  The outlined approaches reduce your possible errors to only that one and avoid confusing differences in behavior between Python 2 and 3.</p>

<hr/>

<p>For your own code, you could still use <code>hasattr()</code> of course.  But you’d have to keep track of it, remember to fix it if your classes change.  This all adds unnecessary mental burden just to save some typing.</p>

<p><strong>P.S.</strong> Yeah the title changed.  Originally I really wrote this article so I can point people to it in discussions.  I never expected it to hit #1 on Hacker News and I agree that “Considered Harmful” is getting old.  I just didn’t spend too much time worrying about it while hacking it together between getting up and leaving for work; it was just the first thing that popped into my mind.  I didn’t rename it right away as it may have confused people but now the dust has settled, it’s time to move on.</p>




	        </section>

	        
	        
	        
	        
	        
	        
	        
	        
	        
	        
	        
	        
	        
	        

	        </div></body></html>