<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_contrast.jpg"><img class="aligncenter wp-image-968" src="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_contrast.jpg" alt=""/></a></p>
<p>Would you have guessed that I’m a stamp collector?</p>
<p>Just kidding. I’m not.</p>
<p>But let’s play a little game of pretend.</p>
<p>Let’s pretend that we have a huge dataset of stamp images. And we want to take two arbitrary stamp images and compare them to determine if they are identical, or near identical in some way.</p>
<p>In general, we can accomplish this in two ways.</p>
<p>The first method is to use locality sensitive hashing, which I’ll cover in a later blog post.</p>
<p>The second method is to use algorithms such as Mean Squared Error (MSE) or the Structural Similarity Index (SSIM).</p>
<p>In this blog post I’ll show you how to use Python to compare two images using Mean Squared Error and Structural Similarity Index.</p>

<p><strong>OpenCV and Python versions:</strong><br/>
This example will run on<strong> Python 2.7/Python 3.4+</strong> and <strong>OpenCV 2.4.X/OpenCV 3.0+</strong>.</p>
<h1>Our Example Dataset</h1>
<p>Let’s start off by taking a look at our example dataset:</p>
<div id="attachment_964" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_dataset.jpg"><img class="wp-image-964" src="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_dataset.jpg" alt="Figure 1: Our example image dataset. Left: The original image. Middle: The original image with contrast adjustments. Right: The original image with Photoshopped overlay."/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Our example image dataset. <em>Left:</em> The original image. <em>Middle:</em> The original image with contrast adjustments. <em>Right:</em> The original image with Photoshopped overlay.</p></div>
<p>Here you can see that we have three images: <em>(left)</em> our original image of our friends from <em>Jurassic Park</em> going on their first (and only) tour, <em>(middle)</em> the original image with contrast adjustments applied to it, and <em>(right)</em>, the original image with the <em>Jurassic Park</em> logo overlaid on top of it via Photoshop manipulation.</p>
<p>Now, it’s clear to us that the left and the middle images are more “similar” to each other — the one in the middle is just like the first one, only it is “darker”.</p>
<p>But as we’ll find out, Mean Squared Error will actually say the Photoshopped image is more similar to the original than the middle image with contrast adjustments. Pretty weird, right?</p>
<h1>Mean Squared Error vs. Structural Similarity Measure</h1>
<p>Let’s take a look at the Mean Squared error equation:</p>
<div id="attachment_965" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_mse.png"><img class="size-full wp-image-965" src="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_mse.png" alt="Equation 1: Mean Squared Error"/></a><p class="wp-caption-text"><strong>Equation 1:</strong> Mean Squared Error</p></div>
<p>While this equation may look complex, I promise you it’s not.</p>
<p>And to demonstrate this you, I’m going to convert this equation to a Python function:</p>

		<div id="crayon-56d5ae3e9d58e984560327" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ae3e9d58e984560327-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">mse</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">imageB</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d58e984560327-2"><span class="crayon-h">	</span><span class="crayon-c"># the 'Mean Squared Error' between the two images is the</span></p><p class="crayon-line" id="crayon-56d5ae3e9d58e984560327-3"><span class="crayon-h">	</span><span class="crayon-c"># sum of the squared difference between the two images;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d58e984560327-4"><span class="crayon-h">	</span><span class="crayon-c"># NOTE: the two images must have the same dimension</span></p><p class="crayon-line" id="crayon-56d5ae3e9d58e984560327-5"><span class="crayon-h">	</span><span class="crayon-v">err</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">"float"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">imageB</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">"float"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d58e984560327-6"><span class="crayon-h">	</span><span class="crayon-v">err</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">imageA</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d58e984560327-7"><span class="crayon-h">	</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d58e984560327-8"><span class="crayon-h">	</span><span class="crayon-c"># return the MSE, the lower the error, the more "similar"</span></p><p class="crayon-line" id="crayon-56d5ae3e9d58e984560327-9"><span class="crayon-h">	</span><span class="crayon-c"># the two images are</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d58e984560327-10"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">err</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>So there you have it — Mean Squared Error in only four lines of Python code once you take out the comments.</p>
<p>Let’s tear it apart and see what’s going on:</p>
<ul>
<li>On <strong>Line 7</strong> we define our <code>mse</code> function, which takes two arguments: <code>imageA</code> and <code>imageB</code> (i.e. the images we want to compare for similarity).</li>
<li>All the real work is handled on <strong>Line 11</strong>. First we convert the images from unsigned 8-bit integers to floating point, that way we don’t run into any problems with modulus operations “wrapping around”. We then take the difference between the images by subtracting the pixel intensities. Next up, we square these difference (hence mean <em>squared</em> error, and finally sum them up.</li>
<li><strong>Line 12</strong> handles the <em>mean</em> of the Mean Squared Error. All we are doing is dividing our sum of squares by the total number of pixels in the image.</li>
<li>Finally, we return our MSE to the caller one <strong>Line 16</strong>.</li>
</ul>
<p>MSE is dead simple to implement — but when using it for similarity, we can run into problems. The main one being that large distances between pixel intensities <em>do not necessarily</em> mean the contents of the images are dramatically different. I’ll provide some proof for that statement later in this post, but in the meantime, take my word for it.</p>
<p>It’s important to note that a value of 0 for MSE indicates <em>perfect similarity</em>. A value greater than one implies less similarity and will continue to grow as the average difference between pixel intensities increases as well.</p>
<p>In order to remedy some of the issues associated with MSE for image comparison, we have the Structural Similarity Index, developed by <a href="http://www.cns.nyu.edu/pub/eero/wang03-reprint.pdf" target="_blank">Wang et al.</a>:</p>
<div id="attachment_966" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_ssim.png"><img class="size-full wp-image-966" src="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_ssim.png" alt="Equation 2: Structural Similarity Index"/></a><p class="wp-caption-text"><strong>Equation 2:</strong> Structural Similarity Index</p></div>
<p>The SSIM method is clearly more involved than the MSE method, but the gist is that SSIM attempts to model the perceived change in the structural information of the image, whereas MSE is actually estimating the perceived errors. There is a subtle difference between the two, but the results are dramatic.</p>
<p>Furthermore, the equation in Equation 2 is used to compare two <em>windows</em> (i.e. small sub-samples) rather than the <em>entire image</em> as in MSE. Doing this leads to a more robust approach that is able to account for changes in the structure of the image, rather than just the perceived change.</p>
<p>The parameters to Equation 2 include the <em>(x, y)</em> location of the <em>N x N</em> window in each image, the mean of the pixel intensities in the <em>x</em> and <em>y</em> direction, the variance of intensities in the <em>x</em> and <em>y</em> direction, along with the covariance.</p>
<p>Unlike MSE, the SSIM value can vary between -1 and 1, where 1 indicates perfect similarity.</p>
<p>Luckily, as you’ll see, we don’t have to implement this method by hand since <a href="http://scikit-image.org/" target="_blank">scikit-image</a> already has an implementation ready for us.</p>
<p>Let’s go ahead and jump into some code.</p>
<h1>How-To: Compare Two Images Using Python</h1>
<p/>

		<div id="crayon-56d5ae3e9d59e516646187" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ae3e9d59e516646187-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d59e516646187-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">skimage</span><span class="crayon-sy">.</span><span class="crayon-e">measure </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">structural_similarity </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">ssim</span></p><p class="crayon-line" id="crayon-56d5ae3e9d59e516646187-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d59e516646187-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line" id="crayon-56d5ae3e9d59e516646187-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start by importing the packages we’ll need — <code>matplotlib</code> for plotting, NumPy for numerical processing, and <code>cv2</code> for our OpenCV bindings. Our <a href="http://scikit-image.org/docs/dev/api/skimage.measure.html#structural-similarity" target="_blank">Structural Similarity Index</a> method is already implemented for us by scikit-image, so we’ll just use their implementation.</p>

		<div id="crayon-56d5ae3e9d5a7689636322" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-8">8</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-10">10</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-12">12</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-14">14</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-16">16</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-18">18</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-20">20</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-22">22</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-24">24</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-26">26</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-28">28</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-30">30</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-32">32</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-34">34</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-36">36</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5a7689636322-38">38</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5a7689636322-39">39</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-7"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">mse</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">imageB</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-8"><span class="crayon-h">	</span><span class="crayon-c"># the 'Mean Squared Error' between the two images is the</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-9"><span class="crayon-h">	</span><span class="crayon-c"># sum of the squared difference between the two images;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-10"><span class="crayon-h">	</span><span class="crayon-c"># NOTE: the two images must have the same dimension</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-11"><span class="crayon-h">	</span><span class="crayon-v">err</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">"float"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">imageB</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">"float"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-12"><span class="crayon-h">	</span><span class="crayon-v">err</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">imageA</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-13"><span class="crayon-h">	</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-14"><span class="crayon-h">	</span><span class="crayon-c"># return the MSE, the lower the error, the more "similar"</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-15"><span class="crayon-h">	</span><span class="crayon-c"># the two images are</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-16"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">err</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-17"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-18"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">compare_images</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">imageB</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-19"><span class="crayon-h">	</span><span class="crayon-c"># compute the mean squared error and structural similarity</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-20"><span class="crayon-h">	</span><span class="crayon-c"># index for the images</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-21"><span class="crayon-h">	</span><span class="crayon-v">m</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mse</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">imageB</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-22"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ssim</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">imageB</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-23"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-24"><span class="crayon-h">	</span><span class="crayon-c"># setup the figure</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-25"><span class="crayon-h">	</span><span class="crayon-v">fig</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-v">title</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-26"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">suptitle</span><span class="crayon-sy">(</span><span class="crayon-s">"MSE: %.2f, SSIM: %.2f"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-27"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-28"><span class="crayon-h">	</span><span class="crayon-c"># show first image</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-29"><span class="crayon-h">	</span><span class="crayon-v">ax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">add_subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-30"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-v">imageA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cmap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-v">cm</span><span class="crayon-sy">.</span><span class="crayon-v">gray</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-31"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">axis</span><span class="crayon-sy">(</span><span class="crayon-s">"off"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-32"> </p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-33"><span class="crayon-h">	</span><span class="crayon-c"># show the second image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-34"><span class="crayon-h">	</span><span class="crayon-v">ax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">add_subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-35"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-v">imageB</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cmap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-v">cm</span><span class="crayon-sy">.</span><span class="crayon-v">gray</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-36"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">axis</span><span class="crayon-sy">(</span><span class="crayon-s">"off"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-37"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5a7689636322-38"><span class="crayon-h">	</span><span class="crayon-c"># show the images</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5a7689636322-39"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 7-16</strong> define our <code>mse</code> method, which you are already familiar with.</p>
<p>We then define the <code>compare_images</code> function on<b> Line 18</b> which we’ll use to compare two images using both MSE and SSIM. The <code>mse</code> function takes three arguments: <code>imageA</code> and <code>imageB</code>, which are the two images we are going to compare, and then the <code>title</code> of our figure.</p>
<p>We then compute the MSE and SSIM between the two images on<strong> Lines 21 and 22</strong>.</p>
<p><strong>Lines 25-39</strong> handle some simple matplotlib plotting. We simply display the MSE and SSIM associated with the two images we are comparing.</p>

		<div id="crayon-56d5ae3e9d5ac742848111" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5ae3e9d5ac742848111-41"><span class="crayon-c"># load the images -- the original, the original + contrast,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5ac742848111-42"><span class="crayon-c"># and the original + photoshop</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5ac742848111-43"><span class="crayon-v">original</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-s">"images/jp_gates_original.png"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5ac742848111-44"><span class="crayon-v">contrast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-s">"images/jp_gates_contrast.png"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5ac742848111-45"><span class="crayon-v">shopped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-s">"images/jp_gates_photoshopped.png"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5ac742848111-46"> </p><p class="crayon-line" id="crayon-56d5ae3e9d5ac742848111-47"><span class="crayon-c"># convert the images to grayscale</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5ac742848111-48"><span class="crayon-v">original</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">original</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5ac742848111-49"><span class="crayon-v">contrast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">contrast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5ac742848111-50"><span class="crayon-v">shopped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">shopped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 43-45</strong> handle loading our images off disk using OpenCV. We’ll be using our original image (<strong>Line 43</strong>), our contrast adjusted image (<strong>Line 44</strong>), and our Photoshopped image with the Jurassic Park logo overlaid (<strong>Line 45</strong>).</p>
<p>We then convert our images to grayscale on <strong>Lines 48-50</strong>.</p>

		<div id="crayon-56d5ae3e9d5b1742958999" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-52">52</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-53">53</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-54">54</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-56">56</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-58">58</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-60">60</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-62">62</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-63">63</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-64">64</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-65">65</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-66">66</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-67">67</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-68">68</p><p class="crayon-num" data-line="crayon-56d5ae3e9d5b1742958999-69">69</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5ae3e9d5b1742958999-70">70</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-52"><span class="crayon-c"># initialize the figure</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-53"><span class="crayon-v">fig</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-s">"Images"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-54"><span class="crayon-v">images</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">"Original"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">original</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">"Contrast"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">contrast</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">"Photoshopped"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shopped</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-55"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-56"><span class="crayon-c"># loop over the images</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-57"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">images</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-58"><span class="crayon-h">	</span><span class="crayon-c"># show the image</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-59"><span class="crayon-h">	</span><span class="crayon-v">ax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">add_subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-60"><span class="crayon-h">	</span><span class="crayon-v">ax</span><span class="crayon-sy">.</span><span class="crayon-e">set_title</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-61"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cmap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-v">cm</span><span class="crayon-sy">.</span><span class="crayon-v">gray</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-62"><span class="crayon-h">	</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">axis</span><span class="crayon-sy">(</span><span class="crayon-s">"off"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-63"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-64"><span class="crayon-c"># show the figure</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-65"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-66"> </p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-67"><span class="crayon-c"># compare the images</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-68"><span class="crayon-e">compare_images</span><span class="crayon-sy">(</span><span class="crayon-v">original</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">original</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"Original vs. Original"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5ae3e9d5b1742958999-69"><span class="crayon-e">compare_images</span><span class="crayon-sy">(</span><span class="crayon-v">original</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">contrast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"Original vs. Contrast"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5ae3e9d5b1742958999-70"><span class="crayon-e">compare_images</span><span class="crayon-sy">(</span><span class="crayon-v">original</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shopped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"Original vs. Photoshopped"</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Now that our images are loaded off disk, let’s show them. On <strong>Lines 52-65</strong> we simply generate a matplotlib figure, loop over our images one-by-one, and add them to our plot. Our plot is then displayed to us on <strong>Line 65</strong>.</p>
<p>Finally, we can compare our images together using the <code>compare_images</code> function on <strong>Lines 68-70</strong>.</p>
<p>We can execute our script by issuing the following command:</p>

		

<p/>
<h1>Results</h1>
<p>Once our script has executed, we should first see our test case — comparing the original image to itself:</p>
<div id="attachment_967" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_original.jpg"><img class="wp-image-967" src="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_original.jpg" alt="Comparing the two original images together."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Comparing the two original images together.</p></div>
<p>Not surpassingly, the original image is identical to itself, with a value of 0.0 for MSE and 1.0 for SSIM. Remember, as the MSE <em>increases</em> the images are <em>less similar</em>, as opposed to the SSIM where <em>smaller values</em> indicate <em>less similarity</em>.</p>
<p>Now, take a look at comparing the original to the contrast adjusted image:</p>
<div id="attachment_968" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_contrast.jpg"><img class="wp-image-968" src="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_contrast.jpg" alt="Figure 3: Comparing the original and the contrast adjusted image."/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Comparing the original and the contrast adjusted image.</p></div>
<p>In this case, the MSE has increased and the SSIM decreased, implying that the images are less similar. This is indeed true — adjusting the contrast has definitely “damaged” the representation of the image.</p>
<p>But things don’t get interesting until we compare the original image to the Photoshopped overlay:</p>
<div id="attachment_969" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_photoshopped1.jpg"><img class="wp-image-969" src="http://www.pyimagesearch.com/wp-content/uploads/2014/06/compare_original_photoshopped1.jpg" alt="Figure 4: Comparing the original and Photoshopped overlay image."/></a><p class="wp-caption-text"><strong>Figure 4:</strong> Comparing the original and Photoshopped overlay image.</p></div>
<p>Comparing the original image to the Photoshop overlay yields a MSE of 1076 and a SSIM of 0.69.</p>
<p>Wait a second.</p>
<p>A MSE of 1076 is smaller than the previous of 1401. But clearly the Photoshopped overlay is <em>dramatically</em> more different than simply adjusting the contrast! But again, this is a limitation we must accept when utilizing raw pixel intensities globally.</p>
<p>On the other end, SSIM is returns a value of 0.69, which is indeed less than the 0.78 obtained when comparing the original image to the contrast adjusted image.</p>
<h1>Summary</h1>
<p>In this blog post I showed you how to compare two images using Python.</p>
<p>To perform our comparison, we made use of the Mean Squared Error (MSE) and the Structural Similarity Index (SSIM) functions.</p>
<p>While the MSE is substantially faster to compute, it has the major drawback of (1) being applied <em>globally</em> and (2) only estimating the perceived errors of the image.</p>
<p>On the other hand, SSIM, while slower, is able to perceive the change in structural information of the image by comparing local <em>regions</em> of the image instead of globally.</p>
<p>So which method should you use?</p>
<p>It depends.</p>
<p>In general, SSIM will give you better results, but you’ll lose a bit of performance.</p>
<p>But in my opinion, the gain in accuracy is well worth it.</p>
<p>Definitely give both MSE and SSIM a shot and see for yourself!</p>
<h1 id="post_downloads">Downloads:</h1>

	</section>
	</div></body></html>