<html><body><div><section id="content" class="article content"><header><h2 class="entry-title"> Python Facebook tutorial - post to Facebook page in 4 steps </h2><p class="text-muted">11 January 2015</p></header><div class="entry-content"><p>In this tutorial, you will learn how to post to a Facebook page's wall (acting as the page) using Python. It includes step by step instructions to create a new page, register an app with Facebook and some python code. I have a similar <a href="http://nodotcom.org/python-twitter-tutorial.html">Python tutorial for Twitter</a>.</p><h2>Step 1</h2><ul><li>First, <a href="https://www.facebook.com/pages/create/">create a new Facebook page</a>. Select appropriate page type, fill in description and other relevant fields.</li><li>On the new page, go to <code>About</code> tab, and note the <code>Facebook Page ID</code>.</li><li>We will post to this page's wall, acting as the page.</li></ul><h2>Step 2</h2><ul><li>Now create a Facebook App which will be used to access Facebook's <a href="https://developers.facebook.com/docs/graph-api">Graph API</a>.</li><li>Go to <a href="https://developers.facebook.com/apps">Facebook Apps dashboard</a> -&gt; Click <code>Add a New App</code> -&gt; Choose platform <code>WWW</code> -&gt; Choose a new name for your app -&gt; Click <code>Create New Facebook App ID</code> -&gt; <code>Create a New App ID</code> -&gt; Choose <code>Category</code> (I chose "Entertainment") -&gt; Click <code>Create App ID</code> again.</li><li>Go back to <a href="https://developers.facebook.com/apps">Apps dashboard</a> -&gt; Select the new app -&gt; <code>Settings</code> -&gt; <code>Basic</code> -&gt; Enter <code>Contact Email</code>. This is required to take your app out of the sandbox.</li><li>Go to <code>Status &amp; Review</code> -&gt; <code>Do you want to make this app and all its live features available to the general public?</code> -&gt; Toggle the button to <code>Yes</code> -&gt; <code>Make App Public?</code> -&gt; <code>Yes</code>. This will enable others to see posts by your app in their timelines - otherwise, only you will see the wall posts by the app. This took me some very frustating hours to figure out! <a href="http://stackoverflow.com/questions/21946125/how-to-disable-sandbox-mode-in-new-facebook-app-developer">These</a> <a href="http://stackoverflow.com/questions/20706322/how-to-disable-sandbox-mode-for-app-in-new-facebook-developer">two</a> stackoverflow posts were very helpful.</li><li>Now - you should see a green dot next to app's name, and the text <code>This app is public and available to all users</code>.</li><li>Make a note of the <code>App ID</code> and <code>App Secret</code> (Click <code>Show</code> next to it; you will be asked to re-enter your Facebook password).</li></ul><h2>Step 3</h2><ul><li>In this step we will obtain obtain Facebook OAuth token. A <code>long-lived</code> token at that! Read about <a href="https://developers.facebook.com/docs/facebook-login/access-tokens">Facebook access tokens</a>. Some more <a href="https://www.sammyk.me/access-token-handling-best-practices-in-facebook-php-sdk-v4">helpful</a> <a href="http://aseriesoftubes.com/articles/obtaining-facebook-page-access-tokens-the-4-step-program/">articles</a> about Facebook token process.</li><li>Go to <a href="https://developers.facebook.com/tools/explorer/">Graph API Explorer</a> -&gt; In the <code>Application</code> drop down -&gt; Select the app created in Step 2 -&gt; Click <code>Get Access Token</code> -&gt; In <code>Permissions</code> popup go to <code>Extended Permissions</code> tab -&gt; Select <code>manage_pages</code>, and <code>publish_actions</code> These permissions will allow your app to publish posts acting as the page -&gt; Click <code>Get Access Token</code> -&gt; You will see a message saying "{App} would like to post publicly to Facebook for you. Who do you want to share these posts with?" -&gt; I chose <code>Public</code> for maximum visibility - as I wanted to post to a public page.</li><li>You might be asked to <code>Turn On Platform</code> if you disabled it previously, enable it! If you mess this step up, just go to your <a href="https://www.facebook.com/settings?tab=applications">App Settings</a> - remove the app and try again.</li><li>Make a note of the <code>short-lived</code> token shown in Graph API Explorer. </li><li>Facebook has deprecated offline access, the next best thing is <code>long-lived</code> token which expires in 60 days. We will convert the <code>short-lived</code> access token noted above to a <code>long-lived</code> token. <a href="http://stackoverflow.com/questions/10467272/get-long-live-access-token-from-facebook">This</a> helped me figure it out. </li></ul><p>For that, fill in the values in the URL below and open it in a browser:</p><div class="highlight"><pre><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">graph</span><span class="o">.</span><span class="n">facebook</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">oauth</span><span class="o">/</span><span class="n">access_token</span><span class="err">?</span>
  <span class="n">client_id</span><span class="o">=</span><span class="p">{</span><span class="n">APP_ID</span><span class="p">}</span><span class="o">&amp;</span>
  <span class="n">client_secret</span><span class="o">=</span><span class="p">{</span><span class="n">APP_SECRET</span><span class="p">}</span><span class="o">&amp;</span>
  <span class="n">grant_type</span><span class="o">=</span><span class="n">fb_exchange_token</span><span class="o">&amp;</span>
  <span class="n">fb_exchange_token</span><span class="o">=</span><span class="p">{</span><span class="n">EXISTING_ACCESS_TOKEN</span><span class="p">}</span>
</pre></div><ul><li>You should see <code>access_token={...}&amp;expires={...}</code>. This new access_token is the <code>long-lived</code> token we will use in our Python script.</li><li><code>long-lived</code> token will also expire eventually, be prepared to perform this Step 3 again before that happens! If you do not want to deal with that just save the <code>page_access_token</code> computed in Step 4 - and you can use it forever, as according to <a href="https://developers.facebook.com/docs/facebook-login/access-tokens#extendingpagetokens">Facebook's documentation</a> a page access token obtained from <code>long-lived</code> user token will not have any expiry time.</li></ul><h2>Step 4</h2><ul><li>We will use <a href="https://github.com/pythonforfacebook/facebook-sdk">Facebook Python SDK</a> to access Facebook's Graph API. You can install it using pip: <code>pip install facebook-sdk</code> (again, use of virtualenv is highly recommended).</li></ul><p>Finally, this python script will post to Facebook page's wall:</p><div class="highlight"><pre><span class="kn">import</span> <span class="nn">facebook</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="c"># Fill in the values noted in previous steps here</span>
  <span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"page_id"</span>      <span class="p">:</span> <span class="s">"VALUE"</span><span class="p">,</span>  <span class="c"># Step 1</span>
    <span class="s">"access_token"</span> <span class="p">:</span> <span class="s">"VALUE"</span>   <span class="c"># Step 3</span>
    <span class="p">}</span>

  <span class="n">api</span> <span class="o">=</span> <span class="n">get_api</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="s">"Hello, world!"</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">put_wall_post</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_api</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
  <span class="n">graph</span> <span class="o">=</span> <span class="n">facebook</span><span class="o">.</span><span class="n">GraphAPI</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s">'access_token'</span><span class="p">])</span>
  <span class="c"># Get page token to post as the page. You can skip </span>
  <span class="c"># the following if you want to post as yourself. </span>
  <span class="n">resp</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="s">'me/accounts'</span><span class="p">)</span>
  <span class="n">page_access_token</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s">'data'</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">page</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="p">[</span><span class="s">'page_id'</span><span class="p">]:</span>
      <span class="n">page_access_token</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s">'access_token'</span><span class="p">]</span>
  <span class="n">graph</span> <span class="o">=</span> <span class="n">facebook</span><span class="o">.</span><span class="n">GraphAPI</span><span class="p">(</span><span class="n">page_access_token</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">graph</span>
  <span class="c"># You can also skip the above if you get a page token:</span>
  <span class="c"># http://stackoverflow.com/questions/8231877/facebook-access-token-for-pages</span>
  <span class="c"># and make that long-lived token as in Step 3</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
  <span class="n">main</span><span class="p">()</span>
</pre></div><p>Phew, all done!</p><h2>Next steps</h2><p>Allow multiple people to log-in to the app? I am not sure how to exactly do it, but here are a few pointers:</p><ul><li>First step would be to add a login dialogue - instead of Step 3. This will be a popup from facebook.com which will show which permissions your app is requesting.</li><li>The 'login' API call will return a <code>short-lived</code> token. This is the tricky part, user is viewing a facebook.com page right now, how will your app get the auth token? Might be easier to do using their <a href="https://developers.facebook.com/docs/facebook-login/login-flow-for-web/v2.2">Javascript login flow</a>. Other option is to give a <a href="https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/v2.2">redirect URL</a> - which will be called when the popup is closed (and token added as a parameter). </li><li>Once you get the <code>short-lived</code> token, you can follow the tutorial - convert to <code>long-lived</code> and store that in a database - sqlite3 works very well for small prototypes.</li><li>Read these two links to understand more: <a href="https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/v2.2">Facebook.com - Manual login flow</a>, <a href="https://developers.facebook.com/docs/facebook-login/login-flow-for-web/v2.2">Facebook.com Web login flow (javascript)</a>.</li><li>If required, <a href="https://developers.facebook.com/docs/facebook-login/access-tokens#refreshtokens">renew the <code>long-lived</code> token for your users</a>.</li></ul><p>Post to your own wall or wall of a friend?</p><ul><li>You can post to your own wall, read the first example <a href="https://github.com/pythonforfacebook/facebook-sdk">here</a>.</li><li>Posting to friend's wall has been deprecated, most probably due to SPAM :) Read <a href="http://stackoverflow.com/questions/26313026/posting-to-friends-wall-using-facebook-api-python">here</a>.</li></ul></div><footer class="post-info text-muted"><button type="button" class="btn btn-default"><a href="http://nodotcom.org/category/tutorial.html"><p class="fa fa-lg fa-folder-open"/> tutorial</a></button><button type="button" class="btn btn-default"><a href="http://nodotcom.org/tag/python.html"><p class="fa fa-lg fa-tag"/> python</a></button><button type="button" class="btn btn-default"><a href="http://nodotcom.org/tag/facebook.html"><p class="fa fa-lg fa-tag"/> facebook</a></button></footer><p id="disqus_thread"/><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></section></div></body></html>