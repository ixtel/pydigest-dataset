<html><body><div><div class="entry-content clearfix"><p>This is a guest blog post by <strong><a href="https://twitter.com/PurdonKyle">Kyle Purdon</a>â</strong>, a software engineer in Boulder, CO. Kyle is a Python first developer with experience in Ruby, Golang, and many more languages. This post was originally authored on Kyle’s personal blog and included great discussion on <a href="http://www.reddit.com/r/programming/comments/37x1o0/python_ruby_and_golang_a_commandline_application/">Reddit</a>.</p>

<hr/>












<p>In late 2014 I built a tool called <a href="https://github.com/kpurdon/pymr">pymr</a>. I recently felt the need to learn golang and refresh my ruby knowledge so I decided to revisit the idea of pymr and build it in multiple languages. <strong>In this post I will break down the “mr” (merr) application (pymr, gomr, rumr) and present the implementation of specific pieces in each language. I will provide an overall personal preference at the end but will leave the comparison of individual pieces up to you.</strong></p>

<blockquote><p>For those that want to skip directly to the code check out the <a href="https://github.com/realpython/python-ruby-golang">repo</a>.</p></blockquote>

<a name="Application.Structure"/>
<h2>Application Structure</h2>

<p>The basic idea of this application is that you have some set of related directories that you want to execute a single command on. The “mr” tool provides a method for registering directories, and a method for running commands on groups of registered directories. The application has the following components:</p>

<ul>
<li>A command-line interface</li>
<li>A registration command (writes a file with given tags)</li>
<li>A run command (runs a given command on registered directories)</li>
</ul>


<a name="Command-Line.Interface"/>
<h2>Command-Line Interface</h2>

<p>The command line interface for the “mr” tools is:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>pymr --help
</span><span class="line">Usage: pymr <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  --help  Show this message and exit.
</span><span class="line">
</span><span class="line">Commands:
</span><span class="line">  register  register a directory
</span><span class="line">  run       run a given <span class="nb">command </span>in matching...
</span></code></pre></td></tr></table></div></figure>


<p>To compare building the command-line interface let’s take a look at the register command in each language.</p>

<p><strong>Python (pymr)</strong></p>

<p>To build the command line interface in python I chose to use the <a href="http://click.pocoo.org/4/">click</a> package.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="nd">@pymr.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--directory'</span><span class="p">,</span> <span class="s">'-d'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'./'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--tag'</span><span class="p">,</span> <span class="s">'-t'</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--append'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">append</span><span class="p">):</span>
</span><span class="line">    <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>To build the command line interface in ruby I chose to use the <a href="http://whatisthor.com/">thor</a> gem.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">desc</span> <span class="s1">'register'</span><span class="p">,</span> <span class="s1">'Register a directory'</span>
</span><span class="line"><span class="n">method_option</span> <span class="ss">:directory</span><span class="p">,</span>
</span><span class="line">              <span class="ss">aliases</span><span class="p">:</span> <span class="s1">'-d'</span><span class="p">,</span>
</span><span class="line">              <span class="ss">type</span><span class="p">:</span> <span class="ss">:string</span><span class="p">,</span>
</span><span class="line">              <span class="ss">default</span><span class="p">:</span> <span class="s1">'./'</span><span class="p">,</span>
</span><span class="line">              <span class="ss">desc</span><span class="p">:</span> <span class="s1">'Directory to register'</span>
</span><span class="line"><span class="n">method_option</span> <span class="ss">:tag</span><span class="p">,</span>
</span><span class="line">              <span class="ss">aliases</span><span class="p">:</span> <span class="s1">'-t'</span><span class="p">,</span>
</span><span class="line">              <span class="ss">type</span><span class="p">:</span> <span class="ss">:array</span><span class="p">,</span>
</span><span class="line">              <span class="ss">default</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span>
</span><span class="line">              <span class="ss">desc</span><span class="p">:</span> <span class="s1">'Tag/s to register'</span>
</span><span class="line"><span class="n">method_option</span> <span class="ss">:append</span><span class="p">,</span>
</span><span class="line">              <span class="ss">type</span><span class="p">:</span> <span class="ss">:boolean</span><span class="p">,</span>
</span><span class="line">              <span class="ss">desc</span><span class="p">:</span> <span class="s1">'Append given tags to any existing tags?'</span>
</span><span class="line"><span class="k">def</span> <span class="nf">register</span>
</span><span class="line">  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>To build the command line interface in Golang I chose to use the <a href="https://github.com/codegangsta/cli">cli.go</a> package.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="nx">app</span><span class="p">.</span><span class="nx">Commands</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="nx">Name</span><span class="p">:</span>   <span class="s">"register"</span><span class="p">,</span>
</span><span class="line">            <span class="nx">Usage</span><span class="p">:</span>  <span class="s">"register a directory"</span><span class="p">,</span>
</span><span class="line">            <span class="nx">Action</span><span class="p">:</span> <span class="nx">register</span><span class="p">,</span>
</span><span class="line">            <span class="nx">Flags</span><span class="p">:</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
</span><span class="line">                <span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
</span><span class="line">                    <span class="nx">Name</span><span class="p">:</span>  <span class="s">"directory, d"</span><span class="p">,</span>
</span><span class="line">                    <span class="nx">Value</span><span class="p">:</span> <span class="s">"./"</span><span class="p">,</span>
</span><span class="line">                    <span class="nx">Usage</span><span class="p">:</span> <span class="s">"directory to tag"</span><span class="p">,</span>
</span><span class="line">                <span class="p">},</span>
</span><span class="line">                <span class="nx">cli</span><span class="p">.</span><span class="nx">StringFlag</span><span class="p">{</span>
</span><span class="line">                    <span class="nx">Name</span><span class="p">:</span>  <span class="s">"tag, t"</span><span class="p">,</span>
</span><span class="line">                    <span class="nx">Value</span><span class="p">:</span> <span class="s">"default"</span><span class="p">,</span>
</span><span class="line">                    <span class="nx">Usage</span><span class="p">:</span> <span class="s">"tag to add for directory"</span><span class="p">,</span>
</span><span class="line">                <span class="p">},</span>
</span><span class="line">                <span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
</span><span class="line">                    <span class="nx">Name</span><span class="p">:</span>  <span class="s">"append"</span><span class="p">,</span>
</span><span class="line">                    <span class="nx">Usage</span><span class="p">:</span> <span class="s">"append the tag to an existing registered directory"</span><span class="p">,</span>
</span><span class="line">                <span class="p">},</span>
</span><span class="line">            <span class="p">},</span>
</span><span class="line">        <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Registration"/>
<h2>Registration</h2>

<p>The registration logic is as follows:</p>

<ol>
<li>If the user asks to <code>--append</code> read the <code>.[py|ru|go]mr</code> file if it exists.</li>
<li>Merge the existing tags with the given tags.</li>
<li>Write a new <code>.[...]mr</code> file with the new tags.</li>
</ol>


<p>This breaks down into a few small tasks we can compare in each language:</p>

<ul>
<li>Searching for and reading a file.</li>
<li>Merging two items (only keeping the unique set)</li>
<li>Writing a file</li>
</ul>


<a name="File.Search"/>
<h3>File Search</h3>

<p><strong>Python (pymr)</strong></p>

<p>For python this involves the <a href="https://docs.python.org/2/library/os.html">os</a> module.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">pymr_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">'.pymr'</span><span class="p">)</span>
</span><span class="line"><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pymr_file</span><span class="p">):</span>
</span><span class="line">    <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>For ruby this involves the <a href="http://ruby-doc.org/core-1.9.3/File.html">File</a> class.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">rumr_file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">'.rumr'</span><span class="p">)</span>
</span><span class="line"><span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">rumr_file</span><span class="p">)</span>
</span><span class="line">  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>For golang this involves the <a href="http://golang.org/pkg/path/">path</a> package.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="nx">fn</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">directory</span><span class="p">,</span> <span class="s">".gomr"</span><span class="p">)</span>
</span><span class="line"><span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">   <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Unique.Merge"/>
<h3>Unique Merge</h3>

<p><strong>Python (pymr)</strong></p>

<p>For python this involves the use of a <a href="https://docs.python.org/2/library/sets.html">set</a>.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># new_tags and cur_tags are tuples</span>
</span><span class="line"><span class="n">new_tags</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_tags</span> <span class="o">+</span> <span class="n">cur_tags</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>For ruby this involves the use of the <a href="http://ruby-doc.org/core-2.2.0/Array.html#method-i-uniq">.uniq</a> array method.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1"># Edited (5/31)</span>
</span><span class="line"><span class="c1"># old method:</span>
</span><span class="line"><span class="c1">#  new_tags = (new_tags + cur_tags).uniq</span>
</span><span class="line">
</span><span class="line"><span class="c1"># new_tags and cur_tags are arrays</span>
</span><span class="line"><span class="n">new_tags</span> <span class="o">|=</span> <span class="n">cur_tags</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>For golang this involves the use of custom function.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="kd">func</span> <span class="nx">AppendIfMissing</span><span class="p">(</span><span class="nx">slice</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">i</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">string</span> <span class="p">{</span>
</span><span class="line">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ele</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">slice</span> <span class="p">{</span>
</span><span class="line">        <span class="k">if</span> <span class="nx">ele</span> <span class="o">==</span> <span class="nx">i</span> <span class="p">{</span>
</span><span class="line">            <span class="k">return</span> <span class="nx">slice</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tag</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">curTags</span><span class="p">,</span> <span class="s">","</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                <span class="nx">newTags</span> <span class="p">=</span> <span class="nx">AppendIfMissing</span><span class="p">(</span><span class="nx">newTags</span><span class="p">,</span> <span class="nx">tag</span><span class="p">)</span>
</span><span class="line">            <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="File.Read.Write"/>
<h3>File Read/Write</h3>

<p>I tried to choose the simplest possible file format to use in each language.</p>

<p><strong>Python (pymr)</strong></p>

<p>For python this involves the use of the <a href="https://docs.python.org/2/library/pickle.html">pickle</a> module.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># read</span>
</span><span class="line"><span class="n">cur_tags</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pymr_file</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="c"># write</span>
</span><span class="line"><span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">new_tags</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">pymr_file</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>For ruby this involves the use of the <a href="http://ruby-doc.org/stdlib-2.2.1/libdoc/yaml/rdoc/YAML.html">YAML</a> module.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1"># read</span>
</span><span class="line"><span class="n">cur_tags</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">rumr_file</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1"># write</span>
</span><span class="line"><span class="c1"># Edited (5/31)</span>
</span><span class="line"><span class="c1"># old method:</span>
</span><span class="line"><span class="c1">#  File.open(rumr_file, 'w') { |f| f.write new_tags.to_yaml }</span>
</span><span class="line"><span class="no">IO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rumr_file</span><span class="p">,</span> <span class="n">new_tags</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>For golang this involves the use of the <a href="https://github.com/robfig/config">config</a> package.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="c1">// read</span>
</span><span class="line"><span class="nx">cfg</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">ReadDefault</span><span class="p">(</span><span class="s">".gomr"</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1">// write</span>
</span><span class="line"><span class="nx">outCfg</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="mo">0644</span><span class="p">,</span> <span class="s">"gomr configuration file"</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Run..Command.Execution."/>
<h2>Run (Command Execution)</h2>

<p>The run logic is as follows:</p>

<ol>
<li>Recursively walk from the given basepath searching for <code>.[...]mr</code> files</li>
<li>Load a found file, and see if the given tag is in it</li>
<li>Call the given command in the directory of a matching file.</li>
</ol>


<p>This breaks down into a few small tasks we can compare in each language:</p>

<ul>
<li>Recursive Directory Search</li>
<li>String Comparison</li>
<li>Calling a Shell Command</li>
</ul>


<a name="Recursive.Directory.Search"/>
<h3>Recursive Directory Search</h3>

<p><strong>Python (pymr)</strong></p>

<p>For python this involves the <a href="https://docs.python.org/2/library/os.html">os</a> module and <a href="https://docs.python.org/2/library/fnmatch.html">fnmatch</a> module.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">fns</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">basepath</span><span class="p">):</span>
</span><span class="line">        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fns</span><span class="p">,</span> <span class="s">'.pymr'</span><span class="p">):</span>
</span><span class="line">            <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>For ruby this involves the <a href="http://ruby-doc.org/stdlib-2.2.0/libdoc/find/rdoc/Find.html">Find</a> and <a href="http://ruby-doc.org/core-2.2.0/File.html">File</a> classes.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1"># Edited (5/31)</span>
</span><span class="line"><span class="c1"># old method:</span>
</span><span class="line"><span class="c1">#  Find.find(basepath) do |path|</span>
</span><span class="line"><span class="c1">#        next unless File.basename(path) == '.rumr'</span>
</span><span class="line"><span class="no">Dir</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">[</span><span class="ss">:basepath</span><span class="o">]</span><span class="p">,</span> <span class="s1">'**/.rumr'</span><span class="p">)</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
</span><span class="line">  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>For golang this requires the <a href="http://golang.org/pkg/path/filepath/">filepath</a> package and a custom callback function.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="kd">func</span> <span class="nx">RunGomr</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="nx">filepath</span><span class="p">.</span><span class="nx">WalkFunc</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">f</span> <span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span><span class="line">        <span class="o">...</span>
</span><span class="line">        <span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s">".gomr"</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="o">...</span>
</span><span class="line">
</span><span class="line"><span class="nx">filepath</span><span class="p">.</span><span class="nx">Walk</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">RunGomr</span><span class="p">(</span><span class="nx">ctx</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<a name="String.Comparison"/>
<h3>String Comparison</h3>

<p><strong>Python (pymr)</strong></p>

<p>Nothing additional is needed in python for this task.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">cur_tags</span><span class="p">:</span>
</span><span class="line">    <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>Nothing additional is needed in ruby for this task.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">if</span> <span class="n">cur_tags</span><span class="o">.</span><span class="n">include?</span> <span class="n">tag</span>
</span><span class="line">  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>For golang this requires the <a href="http://golang.org/pkg/strings/">strings</a> package.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">cur_tags</span><span class="p">,</span> <span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Calling.a.Shell.Command"/>
<h3>Calling a Shell Command</h3>

<p><strong>Python (pymr)</strong></p>

<p>For python this requires the <a href="https://docs.python.org/2/library/os.html">os</a> module and the <a href="https://docs.python.org/2/library/subprocess.html">subprocess</a> module.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</span><span class="line"><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>For ruby this involves the <a href="http://ruby-doc.org/core-2.2.0/Kernel.html#method-i-system">Kernel</a> module and the Backticks syntax.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1"># Edited (5/31)</span>
</span><span class="line"><span class="c1"># old method</span>
</span><span class="line"><span class="c1">#  puts `bash -c "cd #{base_path} &amp;&amp; #{command}"`</span>
</span><span class="line"><span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="p">{</span> <span class="nb">puts</span> <span class="sb">`</span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="sb">`</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>For golang this involves the <a href="https://golang.org/pkg/os/">os</a> package and the <a href="https://golang.org/pkg/os/exec/">os/exec</a> package.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="nx">os</span><span class="p">.</span><span class="nx">Chdir</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span>
</span><span class="line"><span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">"bash"</span><span class="p">,</span> <span class="s">"-c"</span><span class="p">,</span> <span class="nx">command</span><span class="p">)</span>
</span><span class="line"><span class="nx">stdout</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Output</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Packaging"/>
<h2>Packaging</h2>

<p>The ideal mode of distribution for this tool is via a package. A user could then install it <code>tool install [pymr,rumr,gomr]</code> and have a new command on there systems path to execute. I don’t want to go into packaging systems here, rather I will just show the basic configuration file needed in each language.</p>

<p><strong>Python (pymr)</strong></p>

<p>For python a <code>setup.py</code> is required. Once the package is created and uploaded it can be installed with <code>pip install pymr</code>.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
</span><span class="line">
</span><span class="line"><span class="n">classifiers</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="line">    <span class="s">'Environment :: Console'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'Operating System :: OS Independent'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'Intended Audience :: Developers'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'Programming Language :: Python'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'Programming Language :: Python :: 2'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'Programming Language :: Python :: 2.7'</span>
</span><span class="line"><span class="p">]</span>
</span><span class="line">
</span><span class="line"><span class="n">setuptools_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="s">'install_requires'</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="s">'click&gt;=4,&lt;5'</span>
</span><span class="line">    <span class="p">],</span>
</span><span class="line">    <span class="s">'entry_points'</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="s">'console_scripts'</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="s">'pymr = pymr.pymr:pymr'</span><span class="p">,</span>
</span><span class="line">        <span class="p">]</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="n">setup</span><span class="p">(</span>
</span><span class="line">    <span class="n">name</span><span class="o">=</span><span class="s">'pymr'</span><span class="p">,</span>
</span><span class="line">    <span class="n">description</span><span class="o">=</span><span class="s">'A tool for executing ANY command in a set of tagged directories.'</span><span class="p">,</span>
</span><span class="line">    <span class="n">author</span><span class="o">=</span><span class="s">'Kyle W Purdon'</span><span class="p">,</span>
</span><span class="line">    <span class="n">author_email</span><span class="o">=</span><span class="s">'kylepurdon@gmail.com'</span><span class="p">,</span>
</span><span class="line">    <span class="n">url</span><span class="o">=</span><span class="s">'https://github.com/kpurdon/pymr'</span><span class="p">,</span>
</span><span class="line">    <span class="n">download_url</span><span class="o">=</span><span class="s">'https://github.com/kpurdon/pymr'</span><span class="p">,</span>
</span><span class="line">    <span class="n">version</span><span class="o">=</span><span class="s">'2.0.1'</span><span class="p">,</span>
</span><span class="line">    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
</span><span class="line">    <span class="n">classifiers</span><span class="o">=</span><span class="n">classifiers</span><span class="p">,</span>
</span><span class="line">    <span class="o">**</span><span class="n">setuptools_kwargs</span>
</span><span class="line"><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby (rumr)</strong></p>

<p>For ruby a <code>rumr.gemspec</code> is required. Once the gem is created and uploaded is can be installed with <code>gem install rumr</code>.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">name</span>        <span class="o">=</span> <span class="s1">'rumr'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">version</span>     <span class="o">=</span> <span class="s1">'1.0.0'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">summary</span>     <span class="o">=</span> <span class="s1">'Run system commands in sets'</span> <span class="p">\</span>
</span><span class="line">                  <span class="s1">' of registered and tagged directories.'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">'[Ru]by [m]ulti-[r]epository Tool'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">authors</span>     <span class="o">=</span> <span class="o">[</span><span class="s1">'Kyle W. Purdon'</span><span class="o">]</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">email</span>       <span class="o">=</span> <span class="s1">'kylepurdon@gmail.com'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">files</span>       <span class="o">=</span> <span class="o">[</span><span class="s1">'lib/rumr.rb'</span><span class="o">]</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">homepage</span>    <span class="o">=</span> <span class="s1">'https://github.com/kpurdon/rumr'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">license</span>     <span class="o">=</span> <span class="s1">'GPLv3'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">executables</span> <span class="o">&lt;&lt;</span> <span class="s1">'rumr'</span>
</span><span class="line">  <span class="n">s</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="s1">'thor'</span><span class="p">,</span> <span class="o">[</span><span class="s1">'~&gt;0.19.1'</span><span class="o">]</span><span class="p">)</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Golang (gomr)</strong></p>

<p>For golang the source is simply compiled into a binary that can be redistributed. There is no additional file needed and currently no package repository to push to.</p>

<a name="Conclusion"/>
<h2>Conclusion</h2>

<p>For this tool Golang feels like the wrong choice. I don’t need it to be very performant and I’m not utilizing the native concurrency Golang has to offer. This leaves me with Ruby and Python. For about 80% of the logic my personal preference is a toss-up between the two. Here are the pieces I find better in one language:</p>

<a name="Command-Line.Interface.Declaration"/>
<h3>Command-Line Interface Declaration</h3>

<p>Python is the winner here. The <a href="http://click.pocoo.org/">click</a> libraries decorator style declaration is clean and simple. Keep in mind I have only tried the Ruby <a href="https://github.com/erikhuda/thor">thor</a> gem so there may be better solutions in Ruby. This is also not a commentary on either language, rather that the CLI library I used in python is my preference.</p>

<a name="Recursive.Directory.Search"/>
<h3>Recursive Directory Search</h3>

<p>Ruby is the winner here. I found that this entire section of code was much cleaner and more readable using ruby’s <code>Find.find()</code> and especially the <code>next unless</code> syntax.</p>

<a name="Packaging"/>
<h3>Packaging</h3>

<p>Ruby is the winner here. The <code>rumr.gemspec</code> file is much simpler and the process of building and pushing a gem was much simpler as well. The <a href="http://bundler.io/">bundler</a> tool also makes installing in semi-isolated environments a snap.</p>

<a name="Final.Determination"/>
<h2>Final Determination</h2>

<p>Because of packaging and the recursive directory search preference I would choose Ruby as the tool for this application. However the differences in preference were so minor that Python would be more than fitting as well. Golang however, is not the correct tool here.</p>
</div>


      </div></body></html>