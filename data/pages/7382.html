<html><body><div><div>
<h3>New modules: <cite>tornado.locks</cite> and <cite>tornado.queues</cite><a href="#new-modules-tornado-locks-and-tornado-queues" title="Permalink to this headline">¶</a></h3>
<p>These modules provide classes for coordinating coroutines, merged from
<a href="http://toro.readthedocs.org">Toro</a>.</p>
<p>To port your code from Toro’s queues to Tornado 4.2, import <cite>.Queue</cite>,
<cite>.PriorityQueue</cite>, or <cite>.LifoQueue</cite> from <cite>tornado.queues</cite> instead of from
<code><span>toro</span></code>.</p>
<p>Use <cite>.Queue</cite> instead of Toro’s <code><span>JoinableQueue</span></code>. In Tornado the methods
<cite>~.Queue.join</cite> and <cite>~.Queue.task_done</cite> are available on all queues, not on a
special <code><span>JoinableQueue</span></code>.</p>
<p>Tornado queues raise exceptions specific to Tornado instead of reusing
exceptions from the Python standard library.
Therefore instead of catching the standard <cite>queue.Empty</cite> exception from
<cite>.Queue.get_nowait</cite>, catch the special <cite>tornado.queues.QueueEmpty</cite> exception,
and instead of catching the standard <cite>queue.Full</cite> from <cite>.Queue.get_nowait</cite>,
catch <cite>tornado.queues.QueueFull</cite>.</p>
<p>To port from Toro’s locks to Tornado 4.2, import <cite>.Condition</cite>, <cite>.Event</cite>,
<cite>.Semaphore</cite>, <cite>.BoundedSemaphore</cite>, or <cite>.Lock</cite> from <cite>tornado.locks</cite>
instead of from <code><span>toro</span></code>.</p>
<p>Toro’s <code><span>Semaphore.wait</span></code> allowed a coroutine to wait for the semaphore to
be unlocked <em>without</em> acquiring it. This encouraged unorthodox patterns; in
Tornado, just use <cite>~.Semaphore.acquire</cite>.</p>
<p>Toro’s <code><span>Event.wait</span></code> raised a <code><span>Timeout</span></code> exception after a timeout. In
Tornado, <cite>.Event.wait</cite> raises <cite>tornado.gen.TimeoutError</cite>.</p>
<p>Toro’s <code><span>Condition.wait</span></code> also raised <code><span>Timeout</span></code>, but in Tornado, the <cite>.Future</cite>
returned by <cite>.Condition.wait</cite> resolves to False after a timeout:</p>
<div><div><pre><span/><span>@gen.coroutine</span>
<span>def</span> <span>await_notification</span><span>():</span>
    <span>if</span> <span>not</span> <span>(</span><span>yield</span> <span>condition</span><span>.</span><span>wait</span><span>(</span><span>timeout</span><span>=</span><span>timedelta</span><span>(</span><span>seconds</span><span>=</span><span>1</span><span>))):</span>
        <span>print</span><span>(</span><span>'timed out'</span><span>)</span>
    <span>else</span><span>:</span>
        <span>print</span><span>(</span><span>'condition is true'</span><span>)</span>
</pre></div>
</div>
<p>In lock and queue methods, wherever Toro accepted <code><span>deadline</span></code> as a keyword
argument, Tornado names the argument <code><span>timeout</span></code> instead.</p>
<p>Toro’s <code><span>AsyncResult</span></code> is not merged into Tornado, nor its exceptions
<code><span>NotReady</span></code> and <code><span>AlreadySet</span></code>. Use a <cite>.Future</cite> instead. If you wrote code like
this:</p>
<div><div><pre><span/><span>from</span> <span>tornado</span> <span>import</span> <span>gen</span>
<span>import</span> <span>toro</span>

<span>result</span> <span>=</span> <span>toro</span><span>.</span><span>AsyncResult</span><span>()</span>

<span>@gen.coroutine</span>
<span>def</span> <span>setter</span><span>():</span>
    <span>result</span><span>.</span><span>set</span><span>(</span><span>1</span><span>)</span>

<span>@gen.coroutine</span>
<span>def</span> <span>getter</span><span>():</span>
    <span>value</span> <span>=</span> <span>yield</span> <span>result</span><span>.</span><span>get</span><span>()</span>
    <span>print</span><span>(</span><span>value</span><span>)</span>  <span># Prints "1".</span>
</pre></div>
</div>
<p>Then the Tornado equivalent is:</p>
<div><div><pre><span/><span>from</span> <span>tornado</span> <span>import</span> <span>gen</span>
<span>from</span> <span>tornado.concurrent</span> <span>import</span> <span>Future</span>

<span>result</span> <span>=</span> <span>Future</span><span>()</span>

<span>@gen.coroutine</span>
<span>def</span> <span>setter</span><span>():</span>
    <span>result</span><span>.</span><span>set_result</span><span>(</span><span>1</span><span>)</span>

<span>@gen.coroutine</span>
<span>def</span> <span>getter</span><span>():</span>
    <span>value</span> <span>=</span> <span>yield</span> <span>result</span>
    <span>print</span><span>(</span><span>value</span><span>)</span>  <span># Prints "1".</span>
</pre></div>
</div>
</div>
</div></body></html>