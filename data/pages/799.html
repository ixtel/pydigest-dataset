<html><body><div><div class="content html_format">
      <h4>Введение</h4><p>
Недавно я осознал, что на Хабре нет ни одной статьи, посвящённой прекрасному фреймворку Bottle, которым, кстати говоря, пользуется не мало людей, поэтому в этой статье я попытаюсь рассказать вам о нем.
</p><a name="habracut"/>
<h4>Установка</h4><p>
Bottle — очень легкий фреймворк и помещается всего в один файл — bottle.py. Установить его можно </p><a href="https://pypi.python.org/pypi/bottle">отсюда</a><p>, либо сделать pip install bottle.
 
</p><h4>Возможности</h4><p>
Несмотря на свою минималистичность, Bottle предоставляет довольно широкие возможности, которых на 100% хватает для мелких и средних проектов. Вот список основных возможностей:

</p><h5>Routing</h5><p>
Роутинг в bottle, как и в большинстве фреймворков на питоне, осуществляется с помощью декораторов. Например:
</p><pre><code class="python">@route('/hello/&lt;name&gt;')
def index(name):
    return name
</code></pre><p>
Также динамические url можно составлять на основе регулярных выражений:
</p><pre><code class="python">@route('/news/&lt;number:re:[0-9]*&gt;')
def show_news(number):
    pass
</code></pre>
<h5>Templates</h5><p>
Одна из сильнейших сторон фреймворка — механизм шаблонов. Чтобы воспользоваться шаблонизатором, достаточно написать такую легкую конструкцию:
</p><pre><code class="python">template('template_name', name=name, number=number, foo=bar)
</code></pre><p>
Первый аргумент функции — название файла, в котором содержится текст шаблона (в нашем случае шаблон будет называться template_name.tpl).</p><p>
В самом же файле нам нужно написать название переменной в двух фигурных скобках:
</p><pre><code class="html">Hello, {{name}}, glad to see you!
</code></pre><p>
По-умолчанию сделано так, что если в скобках указан html код, то он не выполнится, во избежание XSS атак. Если же нам это очень надо, можно написать {{!name}}. Также Bottle предоставляет нам очень очень крутую возможность: писать любой python код внутри шаблона. Чтобы вызвать питон, достаточно в начале строки поставить %. Например:
</p><pre><code class="html">%a = 100500
%for i in xrange(a):
    &lt;div class="image_{{i}}"&gt;&lt;img src="......{{i}}.jpg"&gt;&lt;/div&gt;
%end 
</code></pre><p>
Также можно инклюдить шаблоны из шаблонов, что позволяет нам красиво и опрятно содержать шаблоны.
</p><pre><code class="python">%include template_num2 foo=bar, blabla=qweqwe
</code></pre>
<h5>POST-routing и обработка форм</h5><p>
Какой же нормальный фреймворк может существовать без возможности обработки POST запросов с последующей обработкой форм?</p><p>
Механизм для обработки POST запросов абсолютно такой же, как и для обработки GET запросов, просто слово route нужно заменить на post:
</p><pre><code class="python">@post("/url")
def foo():
    pass
</code></pre><p>
Для доступа к формам используются атрибуты полей «name». Например:
</p><pre><code class="html">&lt;input name="age" placeholder="Возраст"&gt;
</code></pre><p>
Чтобы получить содержимое формы, нужно использовать следующую конструкцию:
</p><pre><code class="python">request.forms.get("age")  # Получить содержимое одного поля age
request.forms.getall("age")  # Получить содержимое всех полей age
</code></pre><p>
Также можно обращаться и с файлами:
</p><pre><code class="python">request.files.get("picture")  # Получить один файл из поля picture
request.files.getall("picture")  # Получить все файлы из поля (mult-upload)
</code></pre>
<h5>Cookies</h5><p>
Обращаться с Cookies в bottle очень просто, чтобы установить cookie:
</p><pre><code class="python">response.set_cookie("name", value, max_age=100500)
</code></pre><p>
Чтобы взять значение:
</p><pre><code class="python">request.get_cookie("name")
</code></pre>
<h5>Сервер</h5><p>
В bottle вшит простой http сервер, который пригоден разве что для очень быстрого тестирования одной странички:
</p><pre><code class="python">run(host='localhost', port=8080)
</code></pre><p>
Естественно, что для более крупных проектов использовать его невозможно, поэтому надо как-то связать bottle с apache или nginx. Честно говоря, сам я всегда использую apache, поэтому рассказать могу только про него, но с ngninx все тоже вроде довольно просто. Bottle связывается с Apache через mod_wsgi. Для того, чтобы это реализовать, нужно сделать следующее:
</p><ol>
<li>Создать файл adapter.wsgi с вот таким содержимым <div class="spoiler"><b class="spoiler_title">спойлер</b><div class="spoiler_text"><pre><code class="python">import sys, os, bottle
sys.path.append(os.path.dirname(os.path.abspath(__file__)))
os.chdir(os.path.dirname(os.path.abspath(__file__)))
import index # Основной файл

application = bottle.default_app()
</code></pre>
 </div></div></li>
<li>Установить и включить mod_wsgi</li>
<li>Добавить настройки виртуального хоста <div class="spoiler"><b class="spoiler_title">спойлер</b><div class="spoiler_text"><pre><code class="apache">&lt;VirtualHost *:80&gt;
        DocumentRoot /var/www/foo
&lt;/VirtualHost&gt;

&lt;Directory /var/www/foo&gt;
        Options FollowSymLinks ExecCGI
        AddHandler wsgi-script .wsgi
        Order allow,deny
        AllowOverride All
        Allow from all
&lt;/Directory&gt;
</code></pre>

</div></div></li>
</ol>
<h4>Частые ошибки и их решения</h4>

<h4>Заключение</h4><p>
Естественно, сложно в один пост уместить всю информацию о фреймворке, я написал лишь самое главное. Благо bottle обладает довольно хорошей </p><a href="http://bottlepy.org/docs/0.12/bottle-docs.pdf">документацией</a><p>, так что заходите и читайте. Хороших всем выходных!

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>