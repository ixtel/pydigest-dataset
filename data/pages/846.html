<html><body><div><div class="all_external_links">
          <p>One of the defining properties in Python is its dynamic type system. This is both a blessing and a curse. The benefits are probably obvious to every Python programmer. </p>

<p>One downside is that it lets through a class of simple, but very easy to make, errors, that could be caught easily by the type system. In languages such as Python, these errors easily slip through without a good automated test coverage system.</p>

<p>Another downside is that specifying types directly can help with readability of the code, and is especially useful in documenting an API (be it an external library or an internal component). In Python, for example, the standard practice is to document the types (and meaning) of function arguments and return values in a docstring in a special Sphinx-recognized syntax. So we <em>do</em> have to spell out the types manually, anways, but that's of no use to the interpreter!</p>

<p>This is recognized as a problem to the extent that there are several Python packages attempting to solve it (<a href="https://github.com/prechelt/typecheck-decorator">typecheck-decorator</a>, <a href="https://pypi.python.org/pypi/typecheck3/0.1.0">typecheck3</a>, <a href="https://pypi.python.org/pypi/typechecker/0.1.1">typechecker</a>, <a href="https://github.com/ceronman/typeannotations">typeannotations</a>, with the most active one appearing to be <a href="http://andreacensi.github.io/contracts/">PyContracts</a>), and there's even a Python3 PEP designed to help with it: <a href="http://legacy.python.org/dev/peps/pep-3107/">PEP-3107</a> (although it is general enough that it can be used for other purposes as well, this was one of the primary concerns). In fact, Guido van Rossum posted a series of articles on that very topic way back in 2004 and 2005 (<em>Adding optional static typing to Python</em>, <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=85551">part1</a>, <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=86641">part2</a>, <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=87182">part3</a>, <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=89161">redux</a>).</p>

<p>Since the topic is interesting to me, and this being a series of programming experiments, I decided to implement my own solution to this problem. Although the main motivation was to have fun, I believe the solution might actually be useful in the real world, and that it has some benefits over existing ones: expresivness, clean, readable syntax, and Python 2 support.</p>

<p>Here's how it looks: this snippet defines a function taking two integers, adding them, and returning their result, which is also an integer:</p>
<div class="highlight"><pre><span class="nd">@returns</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="nd">@params</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
<p>Simple, right? Here's a little more complex one:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">MyObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="o">...</span>

<span class="nd">@returns</span><span class="p">({</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="n">MyObject</span><span class="p">]})</span>
<span class="nd">@params</span><span class="p">(</span><span class="n">objs</span><span class="o">=</span><span class="p">[</span><span class="n">MyObject</span><span class="p">]):</span>
<span class="k">def</span> <span class="nf">group_by_name</span><span class="p">(</span><span class="n">objs</span><span class="p">):</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
        <span class="n">groups</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">groups</span>
</pre></div>
<p>Pretty readable, eh?</p>

<p>The type signatures can be arbitrarily complex so it can support the majority of use cases in the real world. The major missing part is support for union types, for arguments which can be of a few distinct types (often, the actual value type and None representing the default value). In these cases, you need to use <code>object</code>, which matches any type.</p>

<p>Since the behaviour doesn't rely on Python 3 annotations, Python 2 is supported as well (in fact, it works on any version of Python from 2.5 onwards).</p>

<p>Another feature I added is logging support and ability to enable or disable the type checks at runtime. This is useful when running code in production, in which you don't neccessarily want to crash the application due to the type check assertion, but you probably want to log the occurrence happening.</p>

<p>Here's an example of a log created when calling the above <code>add</code> function incorrectly:</p>

<p><em>ERROR:typedecorator:File "example.py", line 11, in some_caller: argument a = 'a' doesn't match signature int: add('a', 1)</em></p>

<p>The code for all of this is stable, tested, published on GitHub and available from PyPI. If you want to play with it, head on to <a href="https://github.com/dobarkod/typedecorator">typedecorator repository on GitHub</a> for more docs. If you do try it out, I'd love to hear your comments and suggestions.</p>

<p>I have some ideas about additional stuff that could go into it, which I'll probably cover in some future installment of the programming experiments series, so stay tuned!</p>

        </div>
        </div></body></html>