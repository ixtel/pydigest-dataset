<html><body><div><div class="col-md-12">
				<p dir="ltr">You’re preparing a technical talk on your new favorite open source project to present to your local software meetup group.</p>
<p dir="ltr">—————</p>
<p dir="ltr"><em>How do you proceed? If you choose to create another passe linear slide deck, load up Microsoft PowerPoint. If you decide to build a childhood nostalgia-packed Choose Your Own Adventure presentation, continue reading this blog post.</em></p>
<p dir="ltr">—————</p>
<p dir="ltr">Good choice! To create our Choose Your Own Adventure presentation we’ll use <a href="http://lab.hakim.se/reveal-js/#/">Reveal.js</a>, <a href="http://flask.pocoo.org/">Flask</a>, WebSockets and <a href="https://www.twilio.com/sms">Twilio SMS</a>. Our final product will have decision screens like the following screenshot where SMS votes from the audience are counted and displayed in real-time to determine the next step in the presentation story. Once the votes are tallied the presenter can click the left choice or the right choice to go to the appropriate next slide in the presentation.</p>
<p dir="ltr"><img src="https://lh3.googleusercontent.com/QtJXnC94RoBCR1R6Kxmq0t1BZIrWWgPd1a1mWc7nwreDALqBnLNDEJYNY0dhULVZWn0OrXQxgrErib7VxMMTCiW0fOQLaeLVOjecKAPQTDLoVsMbCiV4yEGLRsD152j8qw" alt=""/></p>
<p dir="ltr">Take a look at the <a href="http://www.djangocon.us/">DjangoCon</a> US 2014 ”<a href="https://www.youtube.com/watch?v=QrFEKghISEI">Choose Your Own Django Deployment Adventure</a>” video if you want to see an example of a Choose Your Own Adventure presentation in action.</p>
<h2 dir="ltr">What we’ll need</h2>
<ul>
<li><a href="http://lab.hakim.se/reveal-js/#/">Reveal.js</a> for browser-based presentations</li>
<li><a href="https://www.python.org/">Python</a> with application dependencies:

</li>
<li><a href="http://redis.io/">Redis</a> for calculating results and short-term vote storage</li>
<li>A <a href="https://twilio.com/try-twilio">Twilio account</a> with an SMS number so audiences can vote which path the presentation should follow</li>
<li><a href="https://ngrok.com/">Ngrok</a> for a secure tunnel to our local server running the presentation</li>
</ul>
<p dir="ltr">Do you want to skip typing out the code yourself? Check out <a href="https://github.com/makaimc/choose-your-own-adventure-presentations">this open source repository on GitHub</a>. The Git repository contains the final code as well as intermediate tags named <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/tree/tutorial-step-1">tutorial-step-1</a>, <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/tree/tutorial-step-2">tutorial-step-2</a> and <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/tree/tutorial-step-3">tutorial-step-3</a> for each section below.</p>
<h2 dir="ltr">Building the Presentation</h2>
<p dir="ltr">Let’s first create the directory structure necessary for our project. The nested subdirectories will look like the following screenshot. Our base directory name and Flask app directory name will be “cyoa”, an acronym for “Choose Your Own Adventure.”</p>
<p dir="ltr"><img src="https://lh3.googleusercontent.com/BaP5njVblCdQFSOgUM51KRDntLcBv7SXCFFyxgInQAOJl-knCxahtQrb2qdKxAh_BiWx1HF9aJHw7MQ_Hdli7JF4NZvRRXGdWftTT-WsCyOm5IxrHY3hQTlTlBF0qmApXg" alt=""/></p>
<p dir="ltr">At the base 
			<span id="crayon-56d59bba9f0a7578013785" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span></span></span> directory create a file named 
			<span id="crayon-56d59bba9f0bc798409239" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">requirements</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span></span></span> with the following content in it. These are the dependencies for our project that we’ll install in a moment.</p>
<p/>

		<div id="crayon-56d59bba9f0c7892409259" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f0c7892409259-1"><span class="crayon-v">Flask</span><span class="crayon-o">==</span><span class="crayon-cn">0.10.1</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0c7892409259-2"><span class="crayon-v">Flask</span><span class="crayon-o">-</span><span class="crayon-v">Script</span><span class="crayon-o">==</span><span class="crayon-cn">2.0.5</span></p><p class="crayon-line" id="crayon-56d59bba9f0c7892409259-3"><span class="crayon-v">Flask</span><span class="crayon-o">-</span><span class="crayon-v">SocketIO</span><span class="crayon-o">==</span><span class="crayon-cn">0.4.1</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0c7892409259-4"><span class="crayon-v">gunicorn</span><span class="crayon-o">==</span><span class="crayon-cn">19.1.1</span></p><p class="crayon-line" id="crayon-56d59bba9f0c7892409259-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0c7892409259-6"><span class="crayon-v">redis</span><span class="crayon-o">==</span><span class="crayon-cn">2.10.3</span></p><p class="crayon-line" id="crayon-56d59bba9f0c7892409259-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0c7892409259-8"><span class="crayon-v">twilio</span><span class="crayon-o">==</span><span class="crayon-cn">3.6.8</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">This application uses Flask to serve up the presentation. The <a href="http://flask-script.readthedocs.org/en/latest/">Flask-Script extension</a> will assist us in creating a manage.py file with helper commands to run the web application. The <a href="https://flask-socketio.readthedocs.org/en/latest/">Flask-SocketIO extension</a> handles the server-side websockets communication.</p>
<p dir="ltr">First create a new virtualenv outside the base project directory to separate your Python dependencies from other apps you’re working on.</p>
<p/>

		

<p/>
<p dir="ltr">Activate the virtualenv before we install the dependencies.</p>
<p/>

		

<p/>
<p dir="ltr">To install these dependencies run the following <a href="https://pip.pypa.io/en/latest/">pip</a> command on the command line.</p>
<p/>

		<div id="crayon-56d59bba9f0e6848042611" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f0e6848042611-1"><span class="crayon-e">pip </span><span class="crayon-v">install</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-v">requirements</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">Create a file named 
			<span id="crayon-56d59bba9f0f0588892209" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> with the following contents.</p>
<p/>

		<div id="crayon-56d59bba9f0fa074785296" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-2">2</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-4">4</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-6">6</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-8">8</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-10">10</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-12">12</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-14">14</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-16">16</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-18">18</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f0fa074785296-20">20</p><p class="crayon-num" data-line="crayon-56d59bba9f0fa074785296-21">21</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">gevent </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">monkey</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-2"><span class="crayon-v">monkey</span><span class="crayon-sy">.</span><span class="crayon-e">patch_all</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-6"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">cyoa </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">socketio</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-7"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">script </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Manager</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Shell</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-8"> </p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-9"><span class="crayon-v">manager</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Manager</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-10"> </p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-11"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">make_shell_context</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-12"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">dict</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-o">=</span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-o">=</span><span class="crayon-v">redis_db</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-14"><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">add_command</span><span class="crayon-sy">(</span><span class="crayon-s">"shell"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Shell</span><span class="crayon-sy">(</span><span class="crayon-v">make_context</span><span class="crayon-o">=</span><span class="crayon-v">make_shell_context</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-15"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-16"><span class="crayon-sy">@</span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">command</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-17"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">runserver</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-18"><span class="crayon-h">    </span><span class="crayon-v">socketio</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"0.0.0.0"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-cn">5001</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f0fa074785296-20"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f0fa074785296-21"><span class="crayon-h">    </span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">The above 
			<span id="crayon-56d59bba9f105175727332" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file will help us run our Flask application with the 
			<span id="crayon-56d59bba9f10f993224498" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">runserver</span></span></span> command once we’ve put more of the pieces in places.</p>
<p dir="ltr">Next create a file 
			<span id="crayon-56d59bba9f119113118636" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> (the 
			<span id="crayon-56d59bba9f123299021240" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span></span></span> subdirectory is where most of our Python code will live other than 
			<span id="crayon-56d59bba9f12d304245028" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>) and add the below code to create the configuration variables we’ll need for our Flask application.</p>
<p/>

		<div id="crayon-56d59bba9f137462514828" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f137462514828-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f137462514828-2"> </p><p class="crayon-line" id="crayon-56d59bba9f137462514828-3"><span class="crayon-c"># General Flask app settings</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f137462514828-4"><span class="crayon-v">DEBUG</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'DEBUG'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f137462514828-5"><span class="crayon-v">SECRET_KEY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'SECRET_KEY'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f137462514828-6"> </p><p class="crayon-line" id="crayon-56d59bba9f137462514828-7"><span class="crayon-c"># Redis connection</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f137462514828-8"><span class="crayon-v">REDIS_SERVER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'REDIS_SERVER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f137462514828-9"><span class="crayon-v">REDIS_PORT</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'REDIS_PORT'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f137462514828-10"><span class="crayon-v">REDIS_DB</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'REDIS_DB'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f137462514828-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f137462514828-12"><span class="crayon-c"># Twilio API credentials</span></p><p class="crayon-line" id="crayon-56d59bba9f137462514828-13"><span class="crayon-v">TWILIO_ACCOUNT_SID</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'TWILIO_ACCOUNT_SID'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f137462514828-14"><span class="crayon-v">TWILIO_AUTH_TOKEN</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'TWILIO_AUTH_TOKEN'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f137462514828-15"><span class="crayon-v">TWILIO_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'TWILIO_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">Here’s a run down of what each of these environment variables specified in 
			<span id="crayon-56d59bba9f142590123754" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> is for:</p>
<ol>
<li>
			<span id="crayon-56d59bba9f14c583650223" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">DEBUG</span></span></span> – True or False for whether Flask should display error messages if something goes wrong</li>
<li>
			<span id="crayon-56d59bba9f155549499924" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">SECRET_KEY</span></span></span> – a long key that should be kept secret</li>
<li>
			<span id="crayon-56d59bba9f160193958631" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">REDIS_SERVER</span></span></span> – in this case likely to be localhost or wherever Redis is running</li>
<li>
			<span id="crayon-56d59bba9f16a450162247" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">REDIS_PORT</span></span></span> – generally set to 6379 for the default Redis port</li>
<li>
			<span id="crayon-56d59bba9f174552270770" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">REDIS_DB</span></span></span> – set to 0</li>
<li>
			<span id="crayon-56d59bba9f17e334226098" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_ACCOUNT_SID</span></span></span> – found on your <a href="https://www.twilio.com/user/account">Twilio account dashboard</a></li>
<li>
			<span id="crayon-56d59bba9f188916543567" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_AUTH_TOKEN</span></span></span> – also found on your <a href="https://www.twilio.com/user/account">Twilio account dashboard</a></li>
<li>
			<span id="crayon-56d59bba9f191951334792" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_NUMBER</span></span></span> – a number you’ve <a href="https://www.twilio.com/phone-numbers">purchased on Twilio</a></li>
</ol>
<p dir="ltr">Set the 
			<span id="crayon-56d59bba9f19c996065462" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">DEBUG</span></span></span> and 
			<span id="crayon-56d59bba9f1a6226858315" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">SECRET_KEY</span></span></span> environment variables now. The Redis and Twilio environment variables will be set in the next section.</p>
<p dir="ltr">Setting up environment variables depends on your operating system. There are guides for every major operating system, whether that is <a href="https://help.ubuntu.com/community/EnvironmentVariables">Ubuntu Linux</a>, <a href="http://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x">Mac OS X</a> and <a href="http://www.computerhope.com/issues/ch000549.htm">Windows</a>.</p>
<p dir="ltr">The next file we need to create is 
			<span id="crayon-56d59bba9f1b0483878522" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>, which will set up the core pieces for our the Flask app.</p>
<p/>

		<div id="crayon-56d59bba9f1ba298033327" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f1ba298033327-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1ba298033327-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">socketio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">SocketIO</span></p><p class="crayon-line" id="crayon-56d59bba9f1ba298033327-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">redis</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1ba298033327-4"> </p><p class="crayon-line" id="crayon-56d59bba9f1ba298033327-5"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">static_url_path</span><span class="crayon-o">=</span><span class="crayon-s">'/static'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1ba298033327-6"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">from_pyfile</span><span class="crayon-sy">(</span><span class="crayon-s">'config.py'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f1ba298033327-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1ba298033327-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">config </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">REDIS_SERVER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">REDIS_PORT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">REDIS_DB</span></p><p class="crayon-line" id="crayon-56d59bba9f1ba298033327-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1ba298033327-10"><span class="crayon-v">redis_db</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">redis</span><span class="crayon-sy">.</span><span class="crayon-e">StrictRedis</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_SERVER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_PORT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_DB</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f1ba298033327-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1ba298033327-12"><span class="crayon-v">socketio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SocketIO</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f1ba298033327-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1ba298033327-14"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">views</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">Next create a file named 
			<span id="crayon-56d59bba9f1c5359579468" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> and put the following code inside.</p>
<p/>

		<div id="crayon-56d59bba9f1cf098240887" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f1cf098240887-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">render_template</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">abort</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1cf098240887-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">jinja2 </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TemplateNotFound</span></p><p class="crayon-line" id="crayon-56d59bba9f1cf098240887-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1cf098240887-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">app</span></p><p class="crayon-line" id="crayon-56d59bba9f1cf098240887-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1cf098240887-6"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/&lt;presentation_name&gt;/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f1cf098240887-7"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">landing</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1cf098240887-8"><span class="crayon-h">    </span><span class="crayon-st">try</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f1cf098240887-9"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'.html'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f1cf098240887-10"><span class="crayon-h">    </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">TemplateNotFound</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f1cf098240887-11"><span class="crayon-h">        </span><span class="crayon-e">abort</span><span class="crayon-sy">(</span><span class="crayon-cn">404</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">For now the above file contains a single view named 
			<span id="crayon-56d59bba9f1d9081154337" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">landing</span></span></span>. This view 
			<span id="crayon-56d59bba9f1e3415956599" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">landing</span></span></span> obtains a presentation name from the URL and checks the 
			<span id="crayon-56d59bba9f1ed439475036" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">templates</span><span class="crayon-o">/</span></span></span> directory for an HTML template file matching that name. If a matching file is found, 
			<span id="crayon-56d59bba9f1f7549133827" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">landing</span></span></span> renders the HTML template. If no file name matches the presentation name in the URL, 
			<span id="crayon-56d59bba9f201654462101" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">landing</span></span></span> returns a 404 HTTP response.</p>
<p dir="ltr">We’re awfully close to getting to fire up this presentation to take a look at it. An HTML template file along with some static files are necessary for displaying the presentation. Create a Reveal.js presentation in templates directory named 
			<span id="crayon-56d59bba9f20c506832812" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">templates</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span>. Add the following HTML inside this file.</p>
<p/>

		<div id="crayon-56d59bba9f219084978709" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f219084978709-1"><span class="crayon-h">        </span>Choose<span class="crayon-h"> </span>Your<span class="crayon-h"> </span>Own<span class="crayon-h"> </span>Adventure<span class="crayon-h"> </span>Presentations<span class="crayon-h"> </span>with<span class="crayon-h"> </span>Reveal<span class="crayon-sy">.</span>js<span class="crayon-o">!</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f219084978709-2"><span class="crayon-h">        </span></p><p class="crayon-line" id="crayon-56d59bba9f219084978709-3"><span class="crayon-h">        </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f219084978709-4"><span class="crayon-h">        </span></p><p class="crayon-line" id="crayon-56d59bba9f219084978709-5"><span class="crayon-h">        </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f219084978709-6"><span class="crayon-h">        </span></p><p class="crayon-line" id="crayon-56d59bba9f219084978709-7"><span class="crayon-h">        </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f219084978709-8"><span class="crayon-h">        </span><span class="crayon-c">&lt;!-- [if lt IE 9]&gt;</span></p><p class="crayon-line" id="crayon-56d59bba9f219084978709-9"><span class="crayon-c">        <span class="crayon-ta">&lt;script </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"lib/js/html5shiv.js"</span><span class="crayon-o">&gt;</span><span class="crayon-ta">&lt;/script&gt;</span></span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f219084978709-10"><span class="crayon-c">        &lt;![endif]--&gt;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<div class="reveal">
<div class="slides">
<section>
<h1>Choose Your Own Adventure!</h1>
<p> </p>
<h3>With SMS voting</h3>
<p> </p>
</section>
<p> </p>
<section>
<div>
<h2>Text “left” or “right” to</h2>
<p/>
<h1>(xxx) 555-1234</h1>
<p> </p>
</div>
<p> </p>

<p> </p>
</section>
<p/>
<section>
<h1>Left</h1>
<p> </p>
</section>
<p/>
<section>
<h1>Right</h1>
<p> </p>
</section>
<p> </p>
</div>
<p> </p>
</div>
<p/>
<p dir="ltr">As you can see in the HTML there are three locally hosted static CSS files and a JavaScript file you’ll need for your project. Download <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/tree/tutorial-step-1/cyoa/static">these files from GitHub</a> or download and extract <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/raw/master/cyoa/static/cyoa.tar.gz">this cyoa.tar.gz archive</a> into the 
			<span id="crayon-56d59bba9f225531184177" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-m">static</span></span></span> directory. The CSS and JavaScript files we need are the following:</p>
<ul>
<li>
			<span id="crayon-56d59bba9f22f008871411" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">js</span><span class="crayon-o">/</span><span class="crayon-v">reveal</span><span class="crayon-sy">.</span><span class="crayon-v">js</span></span></span> – code for creating the beautiful Reveal.js presentation</li>
<li>
			<span id="crayon-56d59bba9f249483857797" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">css</span><span class="crayon-o">/</span><span class="crayon-st">default</span><span class="crayon-sy">.</span><span class="crayon-v">css</span></span></span> – default style for Reveal.js decks</li>
<li>
			<span id="crayon-56d59bba9f253169512818" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">css</span><span class="crayon-o">/</span><span class="crayon-v">reveal</span><span class="crayon-sy">.</span><span class="crayon-v">css</span></span></span> – required for running Reveal.js presentations properly</li>
<li>
			<span id="crayon-56d59bba9f25d442518364" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">css</span><span class="crayon-o">/</span><span class="crayon-v">zenburn</span><span class="crayon-sy">.</span><span class="crayon-v">css</span></span></span> – necessary for syntax highlighting within a presentation</li>
</ul>
<p dir="ltr">With these files in place we can try out the presentation to make sure everything so far is in working order. Fire up Flask with the following command.</p>
<p/>

		<div id="crayon-56d59bba9f268338281023" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f268338281023-1"><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">runserver</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">Now we can view the initial version of the presentation by going to <a href="http://localhost:5001/cyoa/">http://localhost:5001/cyoa/</a> in the browser. Flask will find the 
			<span id="crayon-56d59bba9f272907634631" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> file in the 
			<span id="crayon-56d59bba9f283445379276" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">templates</span></span></span> directly and serve that up so you can view it.</p>
<p dir="ltr">However, the presentation will only come up on your own computer. To access the presentation from other computers you’ll need to deploy to a hosting server or create a localhost tunnel using a tool such as <a href="https://ngrok.com/">Ngrok</a>. Sign up for Ngrok and <a href="https://ngrok.com/download">download the Ngrok tunnel application.</a></p>
<p dir="ltr">Fire up ngrok on port 5001 where our Flask application is running. See <a href="https://www.twilio.com/blog/2014/03/configure-windows-for-local-webhook-testing-using-ngrok.html">this configuring Ngrok post</a> if you’re running Windows. On Linux and Mac OS X Ngrok can be run with the following command when you’re in the directory that ngrok is located in.</p>
<p/>

		

<p/>
<p dir="ltr">You’ll see a screen like the following. Take note of the unique https:// forwarding URL as we’ll need that again in a minute for the Twilio webhook.</p>
<p dir="ltr"><img src="https://lh4.googleusercontent.com/S_-xYhn9Mo72pyj-sJUxk_o4V9jnl8Wu19ZOCnSo8pY9MfIrPcJFkk0uT-gND43WzwdluOEQBGLl7V6YAd1aZ7JAU6KZrQ0BRRq18HTtVg6Pu2JO9JZefoCr_QxjVKj3mg" alt=""/></p>
<p dir="ltr">You can now pull the presentation both from the localhost URL as well as the forwarding URL set up by ngrok.</p>
<h2 dir="ltr">Accepting SMS votes</h2>
<p dir="ltr">So far we’ve written the Python code to serve a Reveal.js presentation and exposed it via a localhost tunnel. Now we need a way for the audience to vote on which path they want the presentation to go. To do that we’ll show a Twilio phone number on the screen and use Twilio SMS to let the audience vote. If you’ve already got an account grab a new or existing phone number, otherwise <a href="https://twilio.com/try-twilio">sign up and upgrade a Twilio account</a>.</p>
<p dir="ltr">We’ll need to set up the message webhook so that each vote SMS to the Twilio number is sent to our Flask app. The Twilio <a href="https://www.twilio.com/user/account/phone-numbers/incoming">number screen</a> should look like the following.</p>
<p dir="ltr"><img src="https://lh6.googleusercontent.com/Or9SJzz-XVLuTFkOaV3AV696aeekec0eNBWz-jVVEg6ys4l_dZojBdU_dqg7Elwr7htaXsLPVYsbFPR9tblCfR9cylseNAVAoLmUmebJTQGNLB41ly8nrppkZFPRiOq0CA" alt="twilio-webhook.png"/></p>
<p dir="ltr">Paste in your Ngrok forwarding URL, which will look like “https://[unique Ngrok code].ngrok.com”, along with “/cyoa/twilio/webhook/” to the Messaging Request URL text box then hit save. For example, if your Ngrok tunnel is “1d4e144c” your URL to paste into the webhook text box should look like the following URL.</p>
<p> </p>
<p dir="ltr"><strong>https://1d4e144c.ngrok.com/cyoa/twilio/webhook/</strong></p>
<p> </p>
<p dir="ltr">Now Twilio will send a POST HTTP request to the ngrok port forwarding URL which will be sent down to your localhost server.</p>
<p dir="ltr">Make sure to update the phone number in your 
			<span id="crayon-56d59bba9f2a5997814232" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">templates</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> presentation file. Look for the line like the following and replace it with your Twilio number.</p>
<p/>

		<div id="crayon-56d59bba9f2b0887871576" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f2b0887871576-1"><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-h"> </span><span class="crayon-e">update </span><span class="crayon-e">your </span><span class="crayon-e">number </span><span class="crayon-v">here</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2b0887871576-2"><span class="crayon-sy">(</span><span class="crayon-v">xxx</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">555</span><span class="crayon-o">-</span><span class="crayon-cn">1234</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">However, we’re not yet ready to accept those incoming SMS votes. First we need to ensure Redis is running and write Python code to persist votes to it.</p>
<p dir="ltr">Ensure that Redis server is installed on your system since that will be our temporary vote storage system. There’s a <a href="http://redis.io/topics/quickstart">quickstart installation guide</a> available for your operating system of choice if you’re unfamiliar with Redis. In that quickstart you just need to go from the beginning through the “Starting Redis” section and you’ll be set for finishing this project.</p>
<p dir="ltr">Let’s add code in our 
			<span id="crayon-56d59bba9f2bb908127875" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file for the Twilio webhook HTTP POST that occurs on an inbound SMS. We’ll increment a counter for each keyword texted in by people in the audience.</p>
<p/>

		<div id="crayon-56d59bba9f2c5389787202" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d59bba9f2c5389787202-1">1</p><p class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-2">2</p><p class="crayon-num" data-line="crayon-56d59bba9f2c5389787202-3">3</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-4">4</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f2c5389787202-5">5</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-6">6</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f2c5389787202-7">7</p><p class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-8">8</p><p class="crayon-num" data-line="crayon-56d59bba9f2c5389787202-9">9</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-10">10</p><p class="crayon-num" data-line="crayon-56d59bba9f2c5389787202-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-12">12</p><p class="crayon-num" data-line="crayon-56d59bba9f2c5389787202-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-14">14</p><p class="crayon-num" data-line="crayon-56d59bba9f2c5389787202-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-16">16</p><p class="crayon-num" data-line="crayon-56d59bba9f2c5389787202-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-18">18</p><p class="crayon-num" data-line="crayon-56d59bba9f2c5389787202-19">19</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-20">20</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f2c5389787202-21">21</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-22">22</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f2c5389787202-23">23</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-24">24</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f2c5389787202-25">25</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-26">26</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f2c5389787202-27">27</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f2c5389787202-28">28</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d59bba9f2c5389787202-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">cgi</span></p><p class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-56d59bba9f2c5389787202-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">render_template</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">abort</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">request</span></p><p class="crayon-line" id="crayon-56d59bba9f2c5389787202-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">jinja2 </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TemplateNotFound</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d59bba9f2c5389787202-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">twilio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">twiml</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f2c5389787202-5"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">rest </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-6"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f2c5389787202-7"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">config </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TWILIO_NUMBER</span></p><p class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-56d59bba9f2c5389787202-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">redis_db</span></p><p class="crayon-line" id="crayon-56d59bba9f2c5389787202-9"> </p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-56d59bba9f2c5389787202-10"><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f2c5389787202-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-12"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/&lt;presentation_name&gt;/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f2c5389787202-13"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">landing</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-14"><span class="crayon-h">    </span><span class="crayon-st">try</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f2c5389787202-15"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'.html'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-16"><span class="crayon-h">    </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">TemplateNotFound</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f2c5389787202-17"><span class="crayon-h">        </span><span class="crayon-e">abort</span><span class="crayon-sy">(</span><span class="crayon-cn">404</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-18"> </p><p class="crayon-line" id="crayon-56d59bba9f2c5389787202-19"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/cyoa/twilio/webhook/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d59bba9f2c5389787202-20"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">twilio_callback</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f2c5389787202-21"><span class="crayon-h">    </span><span class="crayon-v">to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'To'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-22"><span class="crayon-h">    </span><span class="crayon-v">from_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'From'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f2c5389787202-23"><span class="crayon-h">    </span><span class="crayon-v">message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'Body'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-24"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">to</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">TWILIO_NUMBER</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f2c5389787202-25"><span class="crayon-h">        </span><span class="crayon-v">redis_db</span><span class="crayon-sy">.</span><span class="crayon-e">incr</span><span class="crayon-sy">(</span><span class="crayon-k ">cgi</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-26"><span class="crayon-h">    </span><span class="crayon-v">resp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f2c5389787202-27"><span class="crayon-h">    </span><span class="crayon-v">resp</span><span class="crayon-sy">.</span><span class="crayon-e">message</span><span class="crayon-sy">(</span><span class="crayon-s">"Thanks for your vote!"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f2c5389787202-28"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">resp</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">It’d be useful to have a way to clear out votes from Redis in between rehearsals for our presentation. Update 
			<span id="crayon-56d59bba9f2d0117120558" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> with a new function to clear votes from Redis.</p>
<p/>

		<div id="crayon-56d59bba9f2d9382883556" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-2">2</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-4">4</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom" data-line="crayon-56d59bba9f2d9382883556-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-6">6</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-8">8</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-10">10</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-12">12</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-14">14</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-16">16</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-18">18</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-20">20</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d59bba9f2d9382883556-21">21</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-22">22</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f2d9382883556-23">23</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-24">24</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d59bba9f2d9382883556-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-26">26</p><p class="crayon-num" data-line="crayon-56d59bba9f2d9382883556-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f2d9382883556-28">28</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">gevent </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">monkey</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-2"><span class="crayon-v">monkey</span><span class="crayon-sy">.</span><span class="crayon-e">patch_all</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-56d59bba9f2d9382883556-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">redis</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-6"> </p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-7"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">cyoa </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">socketio</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">script </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Manager</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Shell</span></p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-10"><span class="crayon-v">manager</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Manager</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-12"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">make_shell_context</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-13"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">dict</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-o">=</span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-o">=</span><span class="crayon-v">redis_db</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-14"> </p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-15"><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">add_command</span><span class="crayon-sy">(</span><span class="crayon-s">"shell"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Shell</span><span class="crayon-sy">(</span><span class="crayon-v">make_context</span><span class="crayon-o">=</span><span class="crayon-v">make_shell_context</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-16"> </p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-17"><span class="crayon-sy">@</span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">command</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-18"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">runserver</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-19"><span class="crayon-h">    </span><span class="crayon-v">socketio</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"0.0.0.0"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-cn">5001</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-20"> </p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d59bba9f2d9382883556-21"><span class="crayon-sy">@</span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">command</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-22"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">clear_redis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f2d9382883556-23"><span class="crayon-h">    </span><span class="crayon-v">redis_cli</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">redis</span><span class="crayon-sy">.</span><span class="crayon-e">StrictRedis</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-o">=</span><span class="crayon-s">'localhost'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-s">'6379'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-o">=</span><span class="crayon-s">'0'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-24"><span class="crayon-h">    </span><span class="crayon-v">redis_cli</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-s">'left'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d59bba9f2d9382883556-25"><span class="crayon-h">    </span><span class="crayon-v">redis_cli</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-s">'right'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-26"> </p><p class="crayon-line" id="crayon-56d59bba9f2d9382883556-27"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2d9382883556-28"><span class="crayon-h">    </span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">If Flask and ngrok are still running we can test this out now, otherwise fire them up and let’s text either “left” or “right” to your Twilio number.</p>
<p dir="ltr">When you test out SMS inbound text messages you should receive the “Thanks for your vote!” response like in the screenshot below.</p>
<p dir="ltr"><img src="https://lh6.googleusercontent.com/eW7sgqXFz1A2fnTe9JZeWttRUV2AkJEfFESWGzXY4243ly5z7YJD2YWgMbmJ4s9dZSeL1y7bC6jObBsFiotca1gIAZT4hSwzUno9Jr5SZ8Z9lk0Lb0-cKJxVBI6vodXjVg" alt=""/></p>
<p dir="ltr">At this point those inbound text message votes are also being stored in Redis. We’re so close to wrapping up this code at this point let’s write a bit more Python to test that the messages are indeed in Redis and propagate the results to the presentation via websockets.</p>
<h2 dir="ltr">Adding WebSockets for Real-time Updates</h2>
<p dir="ltr">We need one more new Python file to handle the server-side websockets communication. Websockets allow streams of communication between the client and server. In our presentation that allows the vote counts to be updated on the presentation slide as soon as the server emits a new message. Add a file named 
			<span id="crayon-56d59bba9f2e4469014787" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">websockets</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> with the following code to set up the server-side websockets implementation.</p>
<p/>

		<div id="crayon-56d59bba9f2ee924973871" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f2ee924973871-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">socketio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">emit</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2ee924973871-2"> </p><p class="crayon-line" id="crayon-56d59bba9f2ee924973871-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">socketio</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2ee924973871-4"> </p><p class="crayon-line" id="crayon-56d59bba9f2ee924973871-5"><span class="crayon-sy">@</span><span class="crayon-v">socketio</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">'connect'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">namespace</span><span class="crayon-o">=</span><span class="crayon-s">'/cyoa'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2ee924973871-6"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">test_connect</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f2ee924973871-7"><span class="crayon-h">    </span><span class="crayon-r">pass</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2ee924973871-8"> </p><p class="crayon-line" id="crayon-56d59bba9f2ee924973871-9"><span class="crayon-sy">@</span><span class="crayon-v">socketio</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">'disconnect'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">namespace</span><span class="crayon-o">=</span><span class="crayon-s">'/cyoa'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f2ee924973871-10"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">test_disconnect</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f2ee924973871-11"><span class="crayon-h">    </span><span class="crayon-r">pass</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">The above code in the 
			<span id="crayon-56d59bba9f2f8243216247" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">update_count</span></span></span> function allows the websocket clients, in this case the browser that loads the presentation, to connect to the websockets stream and receive future messages.</p>
<p dir="ltr">Add one line to the bottom of 
			<span id="crayon-56d59bba9f301517520886" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> to import the 
			<span id="crayon-56d59bba9f30b530318863" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">websockets</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file we just wrote.</p>
<p/>

		<div id="crayon-56d59bba9f315169459218" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f315169459218-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f315169459218-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">socketio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">SocketIO</span></p><p class="crayon-line" id="crayon-56d59bba9f315169459218-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">redis</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f315169459218-4"> </p><p class="crayon-line" id="crayon-56d59bba9f315169459218-5"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">static_url_path</span><span class="crayon-o">=</span><span class="crayon-s">'/static'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f315169459218-6"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">from_pyfile</span><span class="crayon-sy">(</span><span class="crayon-s">'config.py'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f315169459218-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f315169459218-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">config </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">REDIS_SERVER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">REDIS_PORT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">REDIS_DB</span></p><p class="crayon-line" id="crayon-56d59bba9f315169459218-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f315169459218-10"><span class="crayon-v">redis_db</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">redis</span><span class="crayon-sy">.</span><span class="crayon-e">StrictRedis</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_SERVER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_PORT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_DB</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f315169459218-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f315169459218-12"><span class="crayon-v">socketio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SocketIO</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f315169459218-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f315169459218-14"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">views</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-56d59bba9f315169459218-15"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">websockets</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">Update 
			<span id="crayon-56d59bba9f31e326394105" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> with the following highlighted lines. We’re adding the socketio.emit call so votes are passed via websockets to the presentation.</p>
<p/>

		<div id="crayon-56d59bba9f328576662893" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-2">2</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-4">4</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-6">6</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-8">8</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom" data-line="crayon-56d59bba9f328576662893-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-10">10</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-12">12</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-14">14</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-16">16</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-18">18</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-20">20</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-22">22</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-24">24</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-26">26</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-28">28</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d59bba9f328576662893-29">29</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-30">30</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d59bba9f328576662893-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f328576662893-32">32</p><p class="crayon-num" data-line="crayon-56d59bba9f328576662893-33">33</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f328576662893-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">cgi</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">render_template</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">abort</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">jinja2 </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TemplateNotFound</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">twilio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">twiml</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-5"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">rest </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-6"> </p><p class="crayon-line" id="crayon-56d59bba9f328576662893-7"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">config </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TWILIO_NUMBER</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">redis_db</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-56d59bba9f328576662893-9"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">socketio</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-10"> </p><p class="crayon-line" id="crayon-56d59bba9f328576662893-11"><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-12"> </p><p class="crayon-line" id="crayon-56d59bba9f328576662893-13"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/&lt;presentation_name&gt;/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-14"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">landing</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-15"><span class="crayon-h">    </span><span class="crayon-st">try</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-16"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'.html'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-17"><span class="crayon-h">    </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">TemplateNotFound</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-18"><span class="crayon-h">        </span><span class="crayon-e">abort</span><span class="crayon-sy">(</span><span class="crayon-cn">404</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-19"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-20"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/cyoa/twilio/webhook/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-21"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">twilio_callback</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-22"><span class="crayon-h">    </span><span class="crayon-v">to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'To'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-23"><span class="crayon-h">    </span><span class="crayon-v">from_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'From'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-24"><span class="crayon-h">    </span><span class="crayon-v">message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'Body'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-25"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">to</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">TWILIO_NUMBER</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-26"><span class="crayon-h">        </span><span class="crayon-v">redis_db</span><span class="crayon-sy">.</span><span class="crayon-e">incr</span><span class="crayon-sy">(</span><span class="crayon-k ">cgi</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-27"><span class="crayon-h">        </span><span class="crayon-v">socketio</span><span class="crayon-sy">.</span><span class="crayon-e">emit</span><span class="crayon-sy">(</span><span class="crayon-s">'msg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'div'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-k ">cgi</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-28"><span class="crayon-h">                              </span><span class="crayon-s">'val'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d59bba9f328576662893-29"><span class="crayon-h">                      </span><span class="crayon-v">namespace</span><span class="crayon-o">=</span><span class="crayon-s">'/cyoa'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f328576662893-30"> </p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d59bba9f328576662893-31"><span class="crayon-h">    </span><span class="crayon-v">resp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f328576662893-32"><span class="crayon-h">    </span><span class="crayon-v">resp</span><span class="crayon-sy">.</span><span class="crayon-e">message</span><span class="crayon-sy">(</span><span class="crayon-s">"Thanks for your vote!"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d59bba9f328576662893-33"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">resp</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">Add the highlighted code below to the 
			<span id="crayon-56d59bba9f333134238585" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">templates</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> HTML presentation file. This code relies on the websockets JavaScript library and JQuery that was included with the file when we originally created it.</p>
<p/>

		<div id="crayon-56d59bba9f342603503769" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d59bba9f342603503769-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-2">2</p><p class="crayon-num" data-line="crayon-56d59bba9f342603503769-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-4">4</p><p class="crayon-num" data-line="crayon-56d59bba9f342603503769-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-6">6</p><p class="crayon-num" data-line="crayon-56d59bba9f342603503769-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-8">8</p><p class="crayon-num" data-line="crayon-56d59bba9f342603503769-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-10">10</p><p class="crayon-num" data-line="crayon-56d59bba9f342603503769-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-12">12</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d59bba9f342603503769-13">13</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-14">14</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f342603503769-15">15</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-16">16</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f342603503769-17">17</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-18">18</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f342603503769-19">19</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-20">20</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f342603503769-21">21</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-22">22</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f342603503769-23">23</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-24">24</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f342603503769-25">25</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-26">26</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d59bba9f342603503769-27">27</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-28">28</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d59bba9f342603503769-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d59bba9f342603503769-30">30</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d59bba9f342603503769-1"><span class="crayon-ta">&lt;script </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s">"text/javascript"</span><span class="crayon-o">&gt;</span><span class="crayon-c">// &lt;![CDATA[</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f342603503769-2"><span class="crayon-h">    </span><span class="crayon-v">Reveal</span><span class="crayon-sy">.</span><span class="crayon-e">initialize</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56d59bba9f342603503769-3"><span class="crayon-h">        </span><span class="crayon-v">controls</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f342603503769-4"><span class="crayon-h">        </span><span class="crayon-v">progress</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59bba9f342603503769-5"><span class="crayon-h">        </span><span class="crayon-v">history</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f342603503769-6"><span class="crayon-h">        </span><span class="crayon-v">center</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59bba9f342603503769-7"><span class="crayon-h">        </span><span class="crayon-v">theme</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Reveal</span><span class="crayon-sy">.</span><span class="crayon-e">getQueryHash</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">theme</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f342603503769-8"><span class="crayon-h">        </span><span class="crayon-v">transition</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Reveal</span><span class="crayon-sy">.</span><span class="crayon-e">getQueryHash</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">transition</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-s">'default'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d59bba9f342603503769-9"><span class="crayon-h">        </span><span class="crayon-v">dependencies</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f342603503769-10"><span class="crayon-h">        </span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d59bba9f342603503769-11"><span class="crayon-h">    </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f342603503769-12"> </p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d59bba9f342603503769-13"><span class="crayon-h">    </span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-r">document</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ready</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-14"><span class="crayon-h">        </span><span class="crayon-t">namespace</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'/cyoa'</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f342603503769-15"><span class="crayon-h">        </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">socket</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-e">connect</span><span class="crayon-sy">(</span><span class="crayon-s">'http://'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">document</span><span class="crayon-sy">.</span><span class="crayon-v">domain</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">':'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">location</span><span class="crayon-sy">.</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-t">namespace</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-16"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f342603503769-17"><span class="crayon-h">        </span><span class="crayon-c">/* add and edit choices here */</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-18"><span class="crayon-h">        </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">appropriate_choices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'left'</span><span class="crayon-sy">,</span><span class="crayon-s">'right'</span><span class="crayon-sy">,</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f342603503769-19"> </p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-20"><span class="crayon-h">        </span><span class="crayon-v">socket</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">'msg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f342603503769-21"><span class="crayon-h">            </span><span class="crayon-c">/* ensure valid vote and div exists */</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-22"><span class="crayon-h">            </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">appropriate_choices</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">.</span><span class="crayon-v">div</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f342603503769-23"><span class="crayon-h">                </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">checkDiv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'#'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-sy">.</span><span class="crayon-v">div</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-24"><span class="crayon-h">                </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">checkDiv</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f342603503769-25"><span class="crayon-h">                    </span><span class="crayon-v">checkDiv</span><span class="crayon-sy">.</span><span class="crayon-e">html</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-26"><span class="crayon-h">                </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d59bba9f342603503769-27"><span class="crayon-h">            </span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d59bba9f342603503769-28"><span class="crayon-h">        </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d59bba9f342603503769-29"><span class="crayon-h">    </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d59bba9f342603503769-30"><span class="crayon-c">// ]]&gt;&lt;/script&gt;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p dir="ltr">Fire up Flask with Ngrok again. Check out <a href="http://localhost:5001/cyoa/">http://localhost:5001/cyoa/</a> on your browser and you’ll see the same presentation as before. However, text your vote of ‘left’ or ‘right’ to your number and the votes will appear like in the screenshot below without any page refresh.</p>
<p dir="ltr"><img src="https://lh5.googleusercontent.com/tnp86L8n7EcFeVkAGGpaIfUo22xwCTReaW4qoCLdD2U4lopD1W-U1fmxDJgdqTf1jVMjEI4aF-kmzws5i3FkRYws7fWZ8T_vKpdXL7VtKWFbp7ZKY5iFB_rcjRNTnluvIA" alt=""/></p>
<h2 dir="ltr">Wrapping it up</h2>
<p dir="ltr">You now have a Flask app that can serve up Reveal.js presentations where the audience can interact with the slide on screen by texting in their votes.</p>
<p dir="ltr">Now it’s up to you to create the Choose Your Own Adventure content!</p>
<p dir="ltr">Let me know what new Choose Your Own Adventure presentation stories you come up with or <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/pulls">open a pull request</a> to improve the code base. Contact me via:</p>
<ul>
<li>Email: makai@twilio.com</li>
<li>GitHub: Follow <a href="https://github.com/makaimc">makaimc</a> for repository updates</li>
<li>Twitter: <a href="https://twitter.com/mattmakai">@mattmakai</a></li>
</ul>
			</div>
					</div></body></html>