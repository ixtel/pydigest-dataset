<html><body><div><div dir="ltr" trbidi="on"><h2>Twilio</h2>
<a href="https://www.twilio.com/">Twilio</a><p> is a powerful HTTP API that allows you to build powerful voice and SMS apps. The goal of this blog post is to help make building the SMS applications as simple as possible in django.
</p><p>
There is a already Twilio Python help library available. The open source </p><a href="https://github.com/twilio/twilio-python">twilio-python</a><p> library lets us to write python code to make HTTP requests to the Twilio API.
</p><h2>Installation</h2><p>
The easiest way to install twilio-python library is using </p><a href="http://pip.readthedocs.org/en/latest/quickstart.html">pip</a><p>. </p><a href="http://pip.readthedocs.org/en/latest/quickstart.html">Pip</a><p> is a package manager for python.
</p><p>
Simply run following command in terminal.

</p><pre class="brush: bash">$ pip install twilio
</pre>
<h2>Twilio API Credentails</h2><p>To Integrate twilio API in django application, we need </p><b>TWILIO_ACCOUNT_SID</b><p> and </p><b>TWILIO_AUTH_TOKEN</b><p> variables. These variables can be found by logging into your Twilio account dashboard. These variables are used to communicate with the Twilio API.
</p><p>
You’ll need to add them to your </p><b>settings.py</b><p> file:

</p><pre class="brush: python">TWILIO_ACCOUNT_SID = 'ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
TWILIO_AUTH_TOKEN = 'YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY'
</pre>
<h2>Create a New App</h2><p>
We are going to interact with people using SMS, so I prefer to create an app named </p><b>communication</b><p>. I am assuming, you've already installed Django.
</p><p>
Run following command in terminal.

</p><pre class="brush: bash">$ django-admin.py startapp communcation</pre><p>
We will need to register the new app in our django project.</p><p>
Add it to your INSTALLED_APPS tuple in your settings.py file:

</p><pre class="brush: python">INSTALLED_APPS = (
'django.contrib.auth',
'django.contrib.contenttypes',
'django.contrib.sessions',
'django.contrib.sites',
'django.contrib.messages',
'django.contrib.staticfiles',

‘communication’,
...
)
</pre>
<h2>Create the Model</h2><p>
Now we’ll open up </p><b>communication/models.py</b><p> to start creating models for our app.

</p><pre class="brush: python">class SendSMS(models.Model):
    to_number = models.CharField(max_length=30)
    from_number = models.CharField(max_length=30)
    sms_sid = models.CharField(max_length=34, default="", blank=True)
    account_sid = models.CharField(max_length=34, default="", blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
    sent_at = models.DateTimeField(null=True, blank=True)
    delivered_at = models.DateTimeField(null=True, blank=True)
    status = models.CharField(max_length=20, default="", blank=True)

</pre><p>
and run the </p><b>syncdb</b><p> command after defining the model:

</p><pre class="brush: bash">$ python manage.py syncdb
</pre><p>
It will create the necessary database tables for our app.

</p><h2>Create utils.py file</h2><p>
Create a new file named utils.py and save in </p><b>communication/utils.py</b><p>.
</p><p>
Put the following code in </p><b>communication/utils.py</b><p>:

</p><pre class="brush: python">from django.conf import settings

import twilio
import twilio.rest


def send_twilio_message(to_number, body):
    client = twilio.rest.TwilioRestClient(
        settings.TWILIO_ACCOUNT_SID, settings.TWILIO_AUTH_TOKEN)

    return client.messages.create(
        body=body,
        to=to_number,
        from_=settings.TWILIO_PHONE_NUMBER
    )

</pre>
<h2>Testing send_twilio_message</h2><p>
Open the </p><b>shell</b><p> and run following commands.

</p><pre class="brush: python">&gt;&gt;&gt; from communication.utils import send_twilio_message
&gt;&gt;&gt; sms = send_twilio_message('+15005550006', 'Hello Endpointer,')
&gt;&gt;&gt; print sms.sid
SM97f8ac9321114af1b7fd4463ff8bd038
</pre><p>
Having the sid means that everything in the backend is working fine. And we can proceed to work on the front end.

</p><h2>Create Form</h2><p>Lets create a form to gather the data.  Now open/create up </p><b>communication/forms.py</b><p> to start creating forms for our app. And paste the following code into it:

</p><pre class="brush: python">class SendSMSForm(forms.ModelForm):

    class Meta:
        model = SendSMS
        fields = ('to_number', 'body')

</pre>
<h2>The View CreateView</h2>
<pre class="brush: python">class SendSmsCreateView(CreateView):
    model = SendSMS
    form_class = SendSMSForm
    template_name = 'communication/sendsms_form.html'
    success_url = reverse_lazy('send_sms')

    def form_valid(self, form):
        number = self.cleaned_data['to_number']
        body = self.cleaned_data['body']
        # call twilio
        sent = send_twilio_message(number, body)

        # save form
        send_sms = form.save(commit=False)
        send_sms.from_number = settings.TWILIO_PHONE_NUMBER
        send_sms.sms_sid = sent.sid
        send_sms.account_sid = sent.account_sid
        send_sms.status = sent.status
        send_sms.sent_at = now()
        if sent.price:
            send_sms.price = Decimal(force_text(sent.price))
            send_sms.price_unit = sent.price_unit
        send_sms.save()

    return super(SendSmsCreateView, self).form_valid(form)

</pre>

<h2>Defining URLS</h2><p>The URL configuration tells Django how to match a request’s path to your Python code. Django looks for the URL configuration, defined as urlpatterns, in the </p><b>urls.py</b><p> file in your project:

</p><pre class="brush: python">from django.conf.urls import patterns, url

from .views import SendSmsCreateView

urlpatterns = patterns('',
    url(
        regex=r'^communication/send/sms/$',
        view=SendSmsCreateView.as_view(),
        name='send_sms'
    ),
)
</pre><h2>Creating the Template</h2><p>Now that we’ve defined a URL for our list view, we can try it out. Django includes a server suitable for development purposes that you can use to easily test your project:
</p><p>
If you visit the </p><b>http://127.0.0.1:8000/communication/send/sms/</b><p> in your browser, though, you’ll see an error: </p><b>TemplateDoesNotExist</b><p>.
</p><p>
This is because we have not defined the template file yet. So now create </p><b>sendsms_form.html</b><p> file in </p><b>templates/communication/</b><p> and put the following code in it:

</p><pre class="brush: html"/><p>
Now reload the </p><b>http://127.0.0.1:8000/communication/send/sms/</b><p> in your browser. Assuming everything is okay, you should then see the following form:

</p><p>
Fill out the form, and hit the submit button to send your SMS.

</p><h2>CONCLUSION</h2><p>Congratulations, your SMS is successfully sent. Good luck!</p></div>
</div></body></html>