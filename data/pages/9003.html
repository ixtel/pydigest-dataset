<html><body><div><div class="post-body entry-content">
<p>
By </p><a href="http://jugad2.blogspot.in/p/about-vasudev-ram.html">Vasudev Ram</a><p/><p>
This post is about a new </p><a href="https://google.com/search?q=xtopdf">xtopdf</a><p> app I wrote, called </p><b>PopenToPDF.py</b><p>.
</p><p>
(</p><b>xtopdf</b><p> is my </p><i>PDF generation toolkit, written in Python</i><p>. The toolkit consists of a core library and multiple applications built using it.)
</p><p>
This program, PopenToPDF, shows how to use xtopdf to </p><i>generate PDF output</i><p> from any Python-controlled </p><a href="http://en.wikipedia.org/wiki/Pipeline_(Unix)">Unix pipeline</a><p>. It uses the </p><a href="https://docs.python.org/2/library/subprocess.html">subprocess Python module</a><p>.
</p><p/><p>I had written a few posts earlier about the uses of </p><b>StdinToPDF.py</b><p>, another xtopdf app [1]
</p><p>
(There are many </p><a href="https://en.wikipedia.org/wiki/Pipeline">kinds of pipeline"</a><p>; it is a powerful concept.)
</p><p>
StdinToPDF is an application of xtopdf that can be used at the end of a Unix or Windows pipeline, to publish the text output of the pipeline to PDF.
</p><p>
[1] Here are some of those posts about StdinToPDF:
</p><p>
a) </p><a href="http://jugad2.blogspot.in/2013/12/xtopdf-pdfwriter-can-create-pdf-from.html">PDFWriter can create PDF from standard input</a>
<p>
b) </p><a href="http://jugad2.blogspot.in/2014/10/print-selected-text-pages-to-pdf-with.html">Print selected text pages to PDF with Python, selpg and xtopdf on Linux</a>
<p>
c) </p><a href="http://jugad2.blogspot.in/2015/12/generate-windows-task-list-to-pdf-with.html">Generate Windows Task List to PDF with xtopdf</a>
<p>
PopenToPDF has the same general goal as StdinToPDF (to allow creation of a pipeline whose final output is PDF), but works somewhat differently.
</p><p>
Instead of just being used passively (like StdinToPDF) as the last component in a pipeline run from the command line, PopenToPDf is a Python program that </p><i>itself</i><p> sets up and runs a pipeline (of all the preceding commands, excepting itself), using </p><i>subprocess.Popen</i><p>, and then reads the output of that pipeline, programmatically, and converts the text it reads to PDF. So it is a different approach that may allow for other possibilities for customization.
</p><p>
For the example, I created an input text file of 1000 lines, via a small one-off script. The file is called </p><b>1000-lines.txt</b><p>.
</p><p>
The pipeline (created by PopenToPDF) runs "nl -ba" to add sequential line numbers to each line of the input file. (</p><a href="https://www.google.com/search?q=unix+nl+command">nl</a><p> is a Unix command to number lines.) Then the output is passed to my </p><a href="http://jugad2.blogspot.in/2014/09/my-ibm-developerworks-article.html">selpg utility</a><p> (</p><a href="https://www.google.com/search?q=%22developing+a+linux+command-line+utility%22">a command-line utility in C</a><p>), which is a filter that reads its input and selects only a specified range of pages to pass on to the output. (Full details of the selpg utility, including explanation of its logic, source code, and the build steps, are at the URL in the previous sentence, or at links accessible from that URL.)
</p><p>
(</p><a href="http://sites.harvard.edu/~lib113/reference/unix/writingtools.html">This page on sites.harvard.edu</a><p> is a good resource for Linux command line utility development, and also references my IBM dW article about selpg.)
</p><p>
PopenToPDF sets up the above pipeline (nl -ba piped to selpg), and then reads all the lines from it, adds its own line numbers to the input, and writes it all to a PDF file.
</p><p>
Thus we end up with two sets of line numbers prefixed to each line (in the PDF): the original line numbers added by the nl command, which represents the position of each line extracted from the original file, and the serial numbers (starting from 0) for the subset of lines that PopenToPDF sees.
</p><p>
I did this so that we could verify that the pipeline is extracting the right lines that we specified, by looking at the relative and absolute line numbers in the output (screenshots below).
</p><p>
Here is a screenshot of the first page of the PDF output:

</p><p>
And here is a screenshot of the last page, page 4, of the PDF output:

</p><p>
You can see that the last relative line number (added by PopenToPDF, in the extreme left number column) is 215, and the first was 0 (on the first page), so the number of lines extracted by selpg is 216, which corresponds to what we asked selpg for by specifying a start page of 3 (-s3) and an end page of 5 (-e5), since there are 72 lines per page (the default) and 72 * (5 -3 + 1) = 72 * 3 = 216. You can do a similar calculation for the absolute line numbers shown, to verify that we have extracted not only the right number of pages, but also the right pages.
</p><p>
So this approach (using Popen) can be used to run a pipeline under control of a Python program, read the output of the pipeline, and do some further processing on it. Obviously, it is a generic approach, not limited to producing PDF. It could be used for any other purpose where you want to run a pipeline under program control and do something with the output of the pipeline, in your own Python code.
</p><p>
I'll end with a few points about related topics:
</p><p>
This program is actually an example of a category of data processing operations commonly used in organizations, which can be broadly described as starting with some data source, and passing it through a series of transformations until we have the final output we want.
</p><p>
Often, but not always, the input for these transformations is downloaded from some database or application (of the organization), and/or the output is uploaded to another database or application (also of the organization).
</p><p>
In some of these cases, the process is called </p><a href="http://google.com/search?q=ETL">ETL</a><p>, meaning </p><i>Extract, Transform, Load</i><p>. This operation is also related to </p><i>IT system integration</i><p>.
</p><p>
In general, these tasks can consist of a combination of the use of existing components (programs) and purpose-written code in a compiled or interpreted language. The operation can also consist of a combination of manual and automated steps.
</p><p>
When there is enough uniformity in the data and needed processing rules across runs, using more automation leads to more time and cost savings. Some amount of variation in the data or rules can be handled by parameterization of input and output filenames, database connections, table names, use of conditional logic, etc.
</p><p>
Finally, in the process of writing this program and post (across a couple of sessions), I came across mentions of </p><a href="https://google.com/search?q=microservices">microservices</a><p> in tech forums. </p><b>Microservices</b><p> have been in the news for a while. So I looked up definitions of microservices and realized that they are in some ways similar to Unix pipelines and the </p><a href="https://google.com/search?q=Unix+philosophy">Unix philosophy</a><p> of creating small tools that do one thing well, and then combining them to achieve bigger tasks.
</p><p>
If you're interested in pipes and Python and their intersection, also check out this HN comment by me, which lists multiple other Python pipe-like tools, including one (pipe_controller) by me:

</p><a href="https://news.ycombinator.com/item?id=8737512">Yes, pyp is interesting. So are some other roughly similar Python tools</a>
<p>
- Enjoy.
</p><p>
- </p><a href="http://jugad2.blogspot.in/p/about-vasudev-ram.html">Vasudev Ram - Online Python training and  programming</a> <p/><b><a href="mailto:vasudevram@gmail.com?subject=Email%20me%20about%20your%20new%20products%20and%20services">Signup to hear about new products and services I create.</a></b> <p/><a href="http://jugad2.blogspot.com/search/label/python">Posts about Python</a>  <a href="http://jugad2.blogspot.com/search/label/xtopdf">Posts about xtopdf</a> <p/><p/><a href="https://code.activestate.com/recipes/users/4173351/">My ActiveState recipes</a> <p/>   
<p/>
</div>
</div></body></html>