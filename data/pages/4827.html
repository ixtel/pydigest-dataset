<html><body><div><div id="article-content" class="article">
    <h1 class="title">Tornado и pgettext</h1>
    <p/><p><a href="http://www.lexev.org/2015/tornado-and-pgettext/"><img alt="Tornado и pgettext" src="https://img-fotki.yandex.ru/get/15560/85893628.c68/0_18816d_971d97b2_L.png" title="Tornado и pgettext"/></a></p>
<p>Недавно (26 мая 2015 года) вышел релиз <a href="http://www.tornadoweb.org/en/latest/releases/v4.2.0.html">tornado 4.2</a>. В него вошли разные дополнения, пожалуй основные из них - модули tornado.locks и tornado.queues. Они перекочевали из пакета Toro, подробное описание процесса от Jesse Jiryu Davis в его <a href="http://emptysqua.re/blog/tornado-locks-and-queues/">блоге</a>.</p>
<p>Здесь же хочу рассказать о другой маленькой функции, которая была добавлена с моей помощью - <a href="http://www.tornadoweb.org/en/latest/locale.html#tornado.locale.GettextLocale.pgettext">pgettext</a>.</p>
<p>Она может быть полезна, когда вы создаете перевод для неоднозначных строк. Допустим есть слово "bat", которое нужно вывести либо на английском, либо на русском, в зависимости от языка пользователя. Для этого можно воспользоваться соответствующими функциями перевода.</p>
<p>Например так (html шаблон):</p>
<pre><code>&lt;div&gt;{{_("Bat")}}&lt;/div&gt;
</code></pre>
<p>Далее мы с помощью утилиты xgettext создадим файл перевода, в котором будет что-то такое (подробно про процесс i18n можно почитать <a href="http://www.lexev.org/2015/tornado-internationalization-and-localization/">тут</a>)</p>
<pre><code>msgid "Bat"
msgstr ""
</code></pre>
<p>Теперь на месте пустой строки нам нужно вставить перевод. Но что означает слово "Bat"? В английском языке это слово может означать "летучая мышь", а может "дубина", в зависимости от контекста. Переводчику будет очень трудно понять, что же имелось в виду.</p>
<p>Вот где пригодится функция pgettext, ей в качестве первого аргумента передается контекст фразы:</p>
<pre><code>&lt;div&gt;{{ pgettext("mammal", "Bat") }}&lt;/div&gt;
</code></pre>
<p>При генерации перевода нужно дополнительно указать такие опции для утилиты xgettext:</p>
<pre><code>--keyword=pgettext:1c,2 --keyword=pgettext:1c,2,3
</code></pre>
<p>После этого файл перевода будет выглядеть так:</p>
<pre><code>msgctxt "mammal"
msgid "Bat"
msgstr ""
</code></pre>
<p>Переводчик поймет, что в данном случае имелась в виду именно летучая мышь, поэтому перевод однозначен:</p>
<pre><code>msgctxt "mammal"
msgid "Bat"
msgstr "Летучая мышь"
</code></pre>
<p>Множественные формы так же поддерживаются:</p>
<pre><code>&lt;div&gt;{{ pgettext("mammal", "Bat", "Bats", 2) }}&lt;/div&gt;
</code></pre>
<p>В python коде (не в шаблоне) это будет выглядеть так:</p>
<pre><code>class HomeHandler(tornado.web.RequestHandler):

    def get(self):
        self.render("home.html", text=self.locale.pgettext("mammal", "Bat", "Bats", 2))
</code></pre>
<p>Сам перевод множественных значений:</p>
<pre><code>msgctxt "mammal"
msgid "Bat"
msgid_plural "Bats"
msgstr[0] "Летучая мышь"
msgstr[1] "Летучие мыши"
msgstr[2] "Летучих мышей"
</code></pre>
</div>






</div></body></html>