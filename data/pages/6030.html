<html><body><div><div class="postentry">
				
<p>Решил я сегодня все-таки установить Windows 10 поверх Windows 8.1 на своем десктопном компе. Обновление системы через Windows Update мне так и не прилетело (наверное, Сатья Наделла обижается, что Винду я запускаю от силы раз в месяц, и считает, что мне пока Windows 10 не положена), поэтому я пошел напрямик — скачал образ диска с сайта Microsoft, благо это теперь можно сделать, примонтировал его через виртуальный DVD и запустил setup.exe. Установщик, чуть пошелестев хардом радостно сообщил, что он не только сохранит мои данные и настройки, но еще и весь софт останется на своем месте. Ну что ж, нажимаю кнопку Install и отсаживаюсь на диван читать книжку и наблюдать за установкой удаленно. <img src="http://jenyay.net/blog/wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley"/></p>
<p>Первая фаза установки прошла без проблем, установщик перезагружает систему, чтобы после перезагрузки продолжить свое дело. Сначала все было хорошо. Поскольку у меня кроме Винды установлена еще и Ubuntu, то я вижу знакомый GRUB, выбираю Windows 8, который уже можно назвать Windows 9, поскольку он уже не 8, но еще не 10, и запускается вторая фаза установки с огромным индикатором прогресса.</p>
<p>Мда, прошли времена, когда пользователя развлекали установкой, которой начиналась с фразы «Откиньтесь на спинку кресла…» Теперь на экране было только белое кольцо, которое постепенно окрашивается в голубой цвет (нет ли здесь пропаганды сами знаете чего со стороны госдепа?) с процентами. Ровно на 30% установщик решил перезагрузиться. Ну что ж, имеет право, обновление системы — дело сложное, хотя те же Линуксы обновляются с одной единственной перезагрузкой. Тянусь к клавиатуре, чтобы успеть в загрузчике опять выбрать Windows, и офигеваю — вместо GRUB я вижу черный экран с надписью</p>
<blockquote><p>Error: unknown filesystem.<br/>
grub rescue&gt;</p></blockquote>
<p>Нет, честно говоря, к тому, что Винда попортит загрузчик я был готов, все-таки в Microsoft всегда считали, что кроме Windows других операционных систем на свете не существует, поэтому я не сильно расстроился, а полез с телефона читать, как восстанавливать GRUB, я знал, что это делается не сложно, приходилось это делать во время неудачных обновлений Ubuntu древних версий, когда у меня еще очень хитро были перемешаны разделы на двух хардах. Правда, обычно я это делал через загрузочный диск Ubuntu, а сейчас хотелось пойти более хардкорным путем и восстановить через grub rescue, вроде теоретически это делается еще проще. Теоретически.</p>
<p><span id="more-5242"/></p>
<p>В интернете практически под копирку написаны одни и те же действия, которые нужно сделать, чтобы восстановить загрузчик. Одним из шагов этого восстановления является проверка того, что grub может прочитать файловую систему и вывести список файлов на ней. Трудности возникают лишь в том, что все имена разделов имеют вид:</p>
<blockquote><p>(hd0) (hd0,msdos5) (hd0,msdos3) (hd0,msdos2) (hd0,msdos2)</p></blockquote>
<p>и не понятно, какой раздел что содержит. Кстати, обратили внимание, что пропущен (hd0,msdos4)? Я тоже сразу это заметил, но не придал этому значения. В результате я по очереди пробую все разделы, но на любую команду вида</p>
<blockquote><p>ls (hd0,msdos1)/</p></blockquote>
<p>я получаю ошибку</p>
<blockquote><p>(hd0,msdos1): Filesystem is unknown.</p></blockquote>
<p>Погуглив, и не найдя никакого решения, пришлось идти к ноутбуку, чтобы скачать и записать на болванку загрузочный образ Ubuntu, чтобы уже из полноценной операционной системы восстановить GRUB, как это делал в стародавние времена. Открываю мануал, выполняю первое заклинание, которое должно показать все мои разделы:</p>
<blockquote><p>sudo fdisk -l</p></blockquote>
<p>И понимаю, что я чего-то не понимаю — линуксовых разделов нет: ни системного, ни с данными, ни swap. Чтобы воочию (то есть через GUI) в этом убедиться, запускаю gparted и смотрю карту диска: все разделы, которые были связаны с Линуксом, отмечены как серые — неразмеченные области. Офигеваю от такой наглости разработчиков из Microsoft и пытаюсь понять, что с этим можно сделать. Я уже был готов к тому, чтобы переустановить Ubuntu, смирившись с потерянным временем на установку и настройку софта (благо, все бекапы есть, все можно восстановить), но натыкаюсь на замечательную кроссплатформенную программу <a href="http://www.cgsecurity.org/wiki/TestDisk_Step_By_Step">TestDisk</a>. Качаю ее, запускаю, и в ней через удобный консольный интерфейс (действительно удобный) можно проанализировать имеющиеся разделы. TestDisk без раздумий увидела все мои потерянные разделы, опознала в них два раздела ext4 и один swap и предложила: «Поправить файловую систему?» Я без раздумий ответил «Yes», а TestDisk отрапортовала: «Уже все готово, только перезагрузись для верности». И действительно, gparted показал все мои линуксовые разделы в целости и сохранности (и без перезагрузки).</p>
<p>Ок, перезагружаюсь, и выскакивает привычный GRUB, где есть и Винда, и Ubuntu. Ну, думаю, ладно, пусть Винда доделает свое черное дело, доустанавливает Windows 10, выбираю ее, и она как ни в чем ни бывало продолжает установку с тех самых злосчастных 30%. После этого она еще раз перезагружалась, но на этот раз загрузчик GRUB был на месте.</p>
<p>В результате Винда обновилась, я сразу же отключил все ее троянские функции (по крайней мере из тех, что удалось сходу найти), запустил пару программ, убедился, что OutWiker работает — это была главная цель установки Windows 10, и перезагрузился в родную Ubuntu писать этот пост.</p>
<p>В результате все живы, и Винда, и Линукс. А с Виндой я поиграюсь завтра.</p>
							</div>
			</div></body></html>