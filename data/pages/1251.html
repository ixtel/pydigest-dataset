<html><body><div><article itemprop="articleBody">
    
    
    <p>Many Python web applications run on production with the help of gunicorn or uwsgi. There are however other solutions that may turn out to be even better than the currently popular solutions. One of alternatives is <strong>chaussette</strong> and <strong>circus</strong>. Chaussette is a WSGI server that can serve WSGI applications like your Django project. Circus is an application to control and monitor processes and sockets. It can manage chaussette, celery or other sockets and processes making it a manager of all project services.</p>

<a name="1" class="3" title="Chaussette"/>
<p>You can install <a href="http://chaussette.readthedocs.org">chaussette</a> with pip and run your Django application with:</p>
<p class="box">chaussette my_application.wsgi.application</p>
<p>In case of Django the <strong>wsgi.py</strong> file is used. If you have custom settings files be sure to set the correct one in that file or chaussette may have problems starting your application.</p>
<p>Chaussette on its own won't give much. It need a supervisor or circus to manage it.</p>

<a name="2" class="3" title="Circus"/>
<p><a href="http://circus.readthedocs.org/en/0.11.1/">Circus</a> is a process/socket manager and monitor. It's similar to supervisor but has bit different approach. We can install it via pip and after that we can start configuring it and services it should manage.</p>
<p>Circus <a href="http://circus.readthedocs.org/en/0.11.1/faq/#how-does-circus-stack-compare-to-a-classical-stack">differs from supervisor</a> as it can work as a hub of all of project services. Local circus may manage all local services and servers of the project and be managed by system global supervisor. In a supervisor + gunicorn configuration the gunicorn was making a breach as it and other services where managed by the global supervisor. If you host many applications on one server circus + chaussette may help a lot.</p>


<a name="3" class="4" title="Quick example - Django configuration"/>
<p>Now we can put the chaussette startup code into <strong>circus.ini</strong> so that circus can manage it. Let us start with such circus.ini:</p>
<div class="box"><div class="highlight"><pre>[circus]
endpoint = tcp://127.0.0.1:5555
pubsub_endpoint = tcp://127.0.0.1:5556
stats_endpoint = tcp://127.0.0.1:5557

[watcher:web]
cmd = /path/to/application_virtualenv/bin/chaussette --fd $(circus.sockets.web) my_application.wsgi:application
use_sockets = True
numprocesses = 2

[socket:web]
host = 0.0.0.0
port = 8000
</pre></div>
</div>
<p>The start of the file is circus configuration take from one of the examples, next we have chaussette configuration in the "web" blocks (<q>web</q> is the application name within circus, it may be different). Parameters available for every block are in the documentation.</p>
<p>When we have a finished configuration file we can start circus with:</p>
<p class="box">circusd circus.conf</p>
<p>If it works then we can use is it with nginx using such configuration:</p>


<div class="box"><div class="highlight"><pre>server {
  listen  80;

  location /static/ {
      alias /path/to/static/;
  }
  location /media/ {
      alias /path/to/media/;
  }

  location / {
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;
      proxy_pass http://127.0.0.1:8000;
  }
}
</pre></div>
</div>
<p>Where most important part is the <strong>location /</strong>. <strong>proxy_pass</strong> must be set to the IP/port on which chaussette is listening (configured in <q>socket:web</q>) - in this case we have 8000. Alternative way would be to configure chaussette to use sockets which then would have to be passed to proxy_pass.</p>

<a name="4" class="4" title="Addons"/>
<p><strong>circusctl</strong> is an interactive shell for circus. You can check or restart services managed by circus. After deploying a new version of your app you can even reload and restart everything:</p>
<div class="box"><pre>
circusctl reloadconfig --waiting
circusctl reload --waiting
</pre></div>
<p>For monitoring load you can use <strong>circus-top</strong>, or <a href="http://circus.readthedocs.org/en/latest/for-ops/circusweb/">circus-web</a>.</p>

<p>I hope this quick article will make you interested in chaussette and circus combination for your production configuration.</p>
    
</article>
</div></body></html>