<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-django-skd-smoke" class="anchor" href="#django-skd-smoke" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>django-skd-smoke</h1>
<a href="https://travis-ci.org/steelkiwi/django-skd-smoke"><img src="https://camo.githubusercontent.com/6b8b0a34cb0d9db97f86957857788eb04d30cb88/68747470733a2f2f7472617669732d63692e6f72672f737465656c6b6977692f646a616e676f2d736b642d736d6f6b652e737667" data-canonical-src="https://travis-ci.org/steelkiwi/django-skd-smoke.svg"/>
</a>
<a href="https://coveralls.io/github/steelkiwi/django-skd-smoke?branch=master"><img alt="https://coveralls.io/repos/steelkiwi/django-skd-smoke/badge.svg?branch=master&amp;service=github" src="https://camo.githubusercontent.com/ca8b61d1fb079eb9599712a22d69753843e69b75/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f737465656c6b6977692f646a616e676f2d736b642d736d6f6b652f62616467652e7376673f6272616e63683d6d617374657226736572766963653d676974687562" data-canonical-src="https://coveralls.io/repos/steelkiwi/django-skd-smoke/badge.svg?branch=master&amp;service=github"/></a>
<a href="https://pypi.python.org/pypi/django-skd-smoke"><img src="https://camo.githubusercontent.com/d5505f84146cf7ad8de74b9ba777e4f33475e48f/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f646a616e676f2d736b642d736d6f6b652e737667" data-canonical-src="https://img.shields.io/pypi/l/django-skd-smoke.svg"/>
</a>
<a href="https://pypi.python.org/pypi/django-skd-smoke"><img src="https://camo.githubusercontent.com/6101812fc5e5d1a13bb7c6dcfb7309b13d05c2d8/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f646a616e676f2d736b642d736d6f6b652e737667" data-canonical-src="https://img.shields.io/pypi/v/django-skd-smoke.svg"/>
</a>
<a href="https://pypi.python.org/pypi/django-skd-smoke"><img src="https://camo.githubusercontent.com/be25b71b92d799e2be43d47b927252534e0e9465/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f646a616e676f2d736b642d736d6f6b652e737667" data-canonical-src="https://img.shields.io/pypi/pyversions/django-skd-smoke.svg"/>
</a>
<p>This package is intended for simplification of smoke tests creation.</p>

<a name="user-content-installation"/>

<p>You can get django-skd-smoke by using pip:</p>
<pre>$ pip install django-skd-smoke
</pre>
<a name="user-content-usage"/>

<p>After installation you should create new <code>TestCase</code> derived from
<code>skd_smoke.SmokeTestCase</code> and define your smoke tests configuration.
Please review <a href="#examples">Examples</a> section which demonstrates different usecases.
They are related to <code>example_project</code> directory which contains common
django project.</p>
<a name="user-content-configuration"/>

<p><code>TESTS_CONFIGURATION</code> of your <code>TestCase</code> should contain tuple/list of
tuples for every request with the next structure:</p>
<div class="highlight highlight-source-python"><pre>(url, status, method, {<span class="pl-s"><span class="pl-pds">'</span>comment<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>, <span class="pl-s"><span class="pl-pds">'</span>initialize<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>,
                       <span class="pl-s"><span class="pl-pds">'</span>url_kwargs<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>, <span class="pl-s"><span class="pl-pds">'</span>request_data<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>,
                       <span class="pl-s"><span class="pl-pds">'</span>user_credentials<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>, <span class="pl-s"><span class="pl-pds">'</span>redirect_to<span class="pl-pds">'</span></span>: <span class="pl-c1">None</span>})</pre></div>
<table>





<thead valign="bottom">
<tr><th>Parameter</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>url</td>
<td>plain url or urlname as string</td>
<td>Yes</td>
</tr>
<tr><td>status</td>
<td>expected http status code (200, 404, etc.) as <code>int</code></td>
<td>Yes</td>
</tr>
<tr><td>method</td>
<td>http request method (GET, POST, etc.) as string</td>
<td>Yes</td>
</tr>
<tr><td>comment</td>
<td>string which is added to <code>__doc__</code> of generated test method</td>
<td>No</td>
</tr>
<tr><td>initialize</td>
<td>callable object to do any required initialization</td>
<td>No</td>
</tr>
<tr><td>url_args</td>
<td>list or callable object which returns args list to resolve url using <code>django.shortcuts.resolve_url</code></td>
<td>No</td>
</tr>
<tr><td>url_kwargs</td>
<td>dict or callable object which returns kwargs dict to resolve url using <code>django.shortcuts.resolve_url</code></td>
<td>No</td>
</tr>
<tr><td>request_data</td>
<td>dict or callable object which returns dict to pass it into http method request</td>
<td>No</td>
</tr>
<tr><td>user_credentials</td>
<td>dict or callable object which returns dict to login user using <code>django.test.TestCase.client.login</code></td>
<td>No</td>
</tr>
<tr><td>redirect_to</td>
<td>plain url as string which is checked if only status is one of the next: 301, 302, 303, 307</td>
<td>No</td>
</tr>
</tbody>
</table>
<p><strong>NOTE!</strong> All callables take your <code>TestCase</code> as the first argument so
you can use it to transfer state between them. But take into account that
<strong>order of callbacks usage</strong> is next:</p>
<ol>
<li><code>initialize</code></li>
<li><code>url_kwargs</code></li>
<li><code>user_credentials</code></li>
<li><code>request_data</code></li>
</ol>
<a name="user-content-examples"/>

<p>All examples are taken from <code>example_project</code> package and can be run after
repository cloning.</p>
<dl>
<dt>1. Demonstration of simple requests:</dt>
<dd><ol>
<li>GET 200</li>
<li>GET 200 with request_data as dict</li>
<li>POST 200</li>
<li>POST 302 with request_data as callable</li>
<li>GET 302 (unauthorized access)</li>
<li>GET 200 (authorized access)</li>
<li>POST 405 (method not allowed)</li>
</ol>
</dd>
</dl>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> django.contrib.auth <span class="pl-k">import</span> get_user_model

<span class="pl-k">from</span> skd_smoke <span class="pl-k">import</span> SmokeTestCase


<span class="pl-k">def</span> <span class="pl-en">get_article_data</span>(<span class="pl-smi">testcase</span>):
    <span class="pl-k">return</span> {<span class="pl-s"><span class="pl-pds">'</span>headline<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>new article<span class="pl-pds">'</span></span>}


<span class="pl-k">def</span> <span class="pl-en">get_user_credentials</span>(<span class="pl-smi">testcase</span>):
    username <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>test_user<span class="pl-pds">'</span></span>
    password <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>1234<span class="pl-pds">'</span></span>
    credentials <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>: username, <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>: password}
    User <span class="pl-k">=</span> get_user_model()
    new_user <span class="pl-k">=</span> User.objects.create(<span class="pl-v">username</span><span class="pl-k">=</span>username)
    new_user.set_password(password)
    new_user.save()
    testcase.user <span class="pl-k">=</span> new_user
    <span class="pl-k">return</span> credentials


<span class="pl-k">class</span> <span class="pl-en">SimpleSmokeTestCase</span>(<span class="pl-e">SmokeTestCase</span>):
    <span class="pl-c1">TESTS_CONFIGURATION</span> <span class="pl-k">=</span> (
        (<span class="pl-s"><span class="pl-pds">'</span>home<span class="pl-pds">'</span></span>, <span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,),  <span class="pl-c"># 1</span>
        (<span class="pl-s"><span class="pl-pds">'</span>home<span class="pl-pds">'</span></span>, <span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, {<span class="pl-s"><span class="pl-pds">'</span>request_data<span class="pl-pds">'</span></span>: {<span class="pl-s"><span class="pl-pds">'</span>scrollTop<span class="pl-pds">'</span></span>: <span class="pl-c1">1</span>}}),  <span class="pl-c"># 2</span>
        (<span class="pl-s"><span class="pl-pds">'</span>articles:create<span class="pl-pds">'</span></span>, <span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">'</span>POST<span class="pl-pds">'</span></span>,),  <span class="pl-c"># 3</span>
        (<span class="pl-s"><span class="pl-pds">'</span>articles:create<span class="pl-pds">'</span></span>, <span class="pl-c1">302</span>, <span class="pl-s"><span class="pl-pds">'</span>POST<span class="pl-pds">'</span></span>,
         {<span class="pl-s"><span class="pl-pds">'</span>request_data<span class="pl-pds">'</span></span>: get_article_data}),  <span class="pl-c"># 4</span>
        (<span class="pl-s"><span class="pl-pds">'</span>is_authenticated<span class="pl-pds">'</span></span>, <span class="pl-c1">302</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,),  <span class="pl-c"># 5</span>
        (<span class="pl-s"><span class="pl-pds">'</span>is_authenticated<span class="pl-pds">'</span></span>, <span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,
         {<span class="pl-s"><span class="pl-pds">'</span>user_credentials<span class="pl-pds">'</span></span>: get_user_credentials}),  <span class="pl-c"># 6</span>
        (<span class="pl-s"><span class="pl-pds">'</span>/only_post_request/<span class="pl-pds">'</span></span>, <span class="pl-c1">405</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,),  <span class="pl-c"># 7</span>
    )</pre></div>
<p>2. Usage of <code>initialize</code> callback to create several objects to test objects
list.</p>
<p>Suppose you want to make smoke test for articles list page but initially your
test db does not contain any. You can use <code>initialize</code> callback here to
create several articles.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> skd_smoke <span class="pl-k">import</span> SmokeTestCase

<span class="pl-k">from</span> articles.models <span class="pl-k">import</span> Article


<span class="pl-k">def</span> <span class="pl-en">create_articles</span>(<span class="pl-smi">testcase</span>):
    <span class="pl-k">for</span> i <span class="pl-k">in</span> <span class="pl-c1">range</span>(<span class="pl-c1">3</span>):
        Article.objects.create(<span class="pl-v">headline</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>article #<span class="pl-c1">%s</span><span class="pl-pds">'</span></span> <span class="pl-k">%</span> i)


<span class="pl-k">class</span> <span class="pl-en">ArticlesListSmokeTestCase</span>(<span class="pl-e">SmokeTestCase</span>):
    <span class="pl-c1">TESTS_CONFIGURATION</span> <span class="pl-k">=</span> (
        (<span class="pl-s"><span class="pl-pds">'</span>articles:articles<span class="pl-pds">'</span></span>, <span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,
            {<span class="pl-s"><span class="pl-pds">'</span>initialize<span class="pl-pds">'</span></span>: create_articles}  <span class="pl-c"># pass your func here</span>
        ),
    )</pre></div>
<p>3. Usage of <code>redirect_to</code> setting to test anonymous access of login required
pages.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> django.core.urlresolvers <span class="pl-k">import</span> reverse

<span class="pl-k">from</span> skd_smoke <span class="pl-k">import</span> SmokeTestCase


<span class="pl-k">class</span> <span class="pl-en">RedirectToSmokeTestCase</span>(<span class="pl-e">SmokeTestCase</span>):
    <span class="pl-c1">TESTS_CONFIGURATION</span> <span class="pl-k">=</span> (
        (<span class="pl-s"><span class="pl-pds">'</span>is_authenticated<span class="pl-pds">'</span></span>, <span class="pl-c1">302</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, {
            <span class="pl-s"><span class="pl-pds">'</span>redirect_to<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-c1">%s</span>?next=<span class="pl-c1">%s</span><span class="pl-pds">'</span></span> <span class="pl-k">%</span> (reverse(<span class="pl-s"><span class="pl-pds">'</span>login<span class="pl-pds">'</span></span>),
                                           reverse(<span class="pl-s"><span class="pl-pds">'</span>is_authenticated<span class="pl-pds">'</span></span>)),
            <span class="pl-s"><span class="pl-pds">'</span>comment<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>Anonymous profile access with check of redirect url<span class="pl-pds">'</span></span>
        }),
    )</pre></div>
<p>4. Usage of <code>url_kwargs</code> and <code>user_credentials</code> callbacks to test
authorized access of owner to newly created object.</p>
<p>Suppose you have a model Article which unpublished version can be viewed by
its owner only. You can test this situation by creating of user in
<code>url_kwargs</code> callback and transfering user to <code>user_credentials</code> callback.
Unfortunately, you cannot get password from user model cause it contains
hashed password. So you should return password as plain text.</p>
<p>Lets smoke test two other situations when 404 page is showed. Finally we have
three testcases:</p>
<ol>
<li>Anonymous access should show 404 page.</li>
<li>Some ordinary user access should also show 404 page.</li>
<li>Only owner access returns actual article with status 200.</li>
</ol>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> django.contrib.auth <span class="pl-k">import</span> get_user_model

<span class="pl-k">from</span> skd_smoke <span class="pl-k">import</span> SmokeTestCase

<span class="pl-k">from</span> articles.models <span class="pl-k">import</span> Article


<span class="pl-k">def</span> <span class="pl-en">create_user</span>():
    UserModel <span class="pl-k">=</span> get_user_model()
    new_user <span class="pl-k">=</span> UserModel.objects.create(<span class="pl-v">username</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>test_user<span class="pl-pds">'</span></span>)
    new_user.set_password(<span class="pl-s"><span class="pl-pds">'</span>1234<span class="pl-pds">'</span></span>)
    new_user.save()
    <span class="pl-k">return</span> new_user


<span class="pl-k">def</span> <span class="pl-en">create_unpublished_article</span>(<span class="pl-smi">commit</span><span class="pl-k">=</span><span class="pl-c1">True</span>):
    article <span class="pl-k">=</span> Article(<span class="pl-v">headline</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>unpublished<span class="pl-pds">'</span></span>, <span class="pl-v">published</span><span class="pl-k">=</span><span class="pl-c1">False</span>)
    <span class="pl-k">if</span> commit:
        article.save()
    <span class="pl-k">return</span> article


<span class="pl-k">def</span> <span class="pl-en">create_article_without_owner</span>(<span class="pl-smi">testcase</span>):
    <span class="pl-k">return</span> {<span class="pl-s"><span class="pl-pds">'</span>pk<span class="pl-pds">'</span></span>: create_unpublished_article().pk}


<span class="pl-k">def</span> <span class="pl-en">create_and_return_user_credentials</span>(<span class="pl-smi">testcase</span>):
    user <span class="pl-k">=</span> create_user()
    <span class="pl-k">return</span> {
        <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>: user.username,
        <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>1234<span class="pl-pds">'</span></span>  <span class="pl-c"># User contains hashed password only so we should</span>
                            <span class="pl-c"># return it as plain text</span>
    }


<span class="pl-k">def</span> <span class="pl-en">create_article_with_its_owner</span>(<span class="pl-smi">testcase</span>):
    owner <span class="pl-k">=</span> create_user()
    testcase.owner <span class="pl-k">=</span> owner
    unpublished <span class="pl-k">=</span> create_unpublished_article(<span class="pl-v">commit</span><span class="pl-k">=</span><span class="pl-c1">False</span>)
    unpublished.owner <span class="pl-k">=</span> owner
    unpublished.save()
    <span class="pl-k">return</span> {<span class="pl-s"><span class="pl-pds">'</span>pk<span class="pl-pds">'</span></span>: unpublished.pk}


<span class="pl-k">def</span> <span class="pl-en">get_owner_credentials</span>(<span class="pl-smi">testcase</span>):
    <span class="pl-k">return</span> {
        <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>: testcase.owner.username,
        <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>1234<span class="pl-pds">'</span></span>  <span class="pl-c"># User contains hashed password only</span>
    }


<span class="pl-k">class</span> <span class="pl-en">UnpublishedArticleSmokeTestCase</span>(<span class="pl-e">SmokeTestCase</span>):
    <span class="pl-c1">TESTS_CONFIGURATION</span> <span class="pl-k">=</span> (
        (<span class="pl-s"><span class="pl-pds">'</span>articles:article<span class="pl-pds">'</span></span>, <span class="pl-c1">404</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,
            {<span class="pl-s"><span class="pl-pds">'</span>url_kwargs<span class="pl-pds">'</span></span>: create_article_without_owner,
             <span class="pl-s"><span class="pl-pds">'</span>comment<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>Anonymous access to unpublished article.<span class="pl-pds">'</span></span>}),  <span class="pl-c"># 1</span>

        (<span class="pl-s"><span class="pl-pds">'</span>articles:article<span class="pl-pds">'</span></span>, <span class="pl-c1">404</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,
            {<span class="pl-s"><span class="pl-pds">'</span>url_kwargs<span class="pl-pds">'</span></span>: create_article_without_owner,
             <span class="pl-s"><span class="pl-pds">'</span>user_credentials<span class="pl-pds">'</span></span>: create_and_return_user_credentials,
             <span class="pl-s"><span class="pl-pds">'</span>comment<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>Some user access to unpublished article.<span class="pl-pds">'</span></span>}),  <span class="pl-c"># 2</span>

        (<span class="pl-s"><span class="pl-pds">'</span>articles:article<span class="pl-pds">'</span></span>, <span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,
            {<span class="pl-s"><span class="pl-pds">'</span>url_kwargs<span class="pl-pds">'</span></span>: create_article_with_its_owner,
             <span class="pl-s"><span class="pl-pds">'</span>user_credentials<span class="pl-pds">'</span></span>: get_owner_credentials,
             <span class="pl-s"><span class="pl-pds">'</span>comment<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>Owner access to unpublished article.<span class="pl-pds">'</span></span>}),  <span class="pl-c"># 3</span>
    )</pre></div>
<a name="user-content-license"/>

<p>MIT</p>

</article>
  </div></body></html>