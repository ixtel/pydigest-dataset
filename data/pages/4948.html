<html><body><div><div class="post-text" itemprop="text">

<p>I am writing a function for some existing python code that will be passed a Mechanize browser object as a parameter.</p>

<p>I fill in some details in a form in the browser, and use <code>response = browser.submit()</code> to move the browser to a new page, and collect some information from it.</p>

<p>Unfortunately, I occasionally get the following error:</p>

<p><code>httperror_seek_wrapper: HTTP Error 500: Internal Server Error</code></p>

<p> </p>

<p>I've navigated to the page in my own browser, and sure enough, I occasionally see this error directly, so I think this is a server problem, not anything to do with <code>robots.txt</code>, headers or similar.</p>

<p>The problem is that after submitting, the state of the <code>browser</code> object changes and I can't continue to use it. My first thought was to try taking a deep copy first and use that if I ran into problems, but that gives the error <code>TypeError: object.__new__(cStringIO.StringO) is not safe, use cStringIO.StringO.__new__()</code> as described <a href="http://stackoverflow.com/questions/28835859/cloning-mechanize-browser-yields-to-an-error">here</a>.</p>

<p>I've also tried using <code>browser.back()</code> but get <code>NoneType</code> errors.</p>

<p>Does anyone have a good solution to this?</p>

<p> </p>

<h1>Solution (with thanks to karnesJ.R below):</h1>

<p>A great solution below uses the excellent <code>requests</code> library (docs <a href="http://docs.python-requests.org/en/latest/" rel="nofollow">here</a>). <code>requests</code> has functionality to fill in a form and submit via <code>post</code> or <code>get</code>, which importantly doesn't change the state of the <code>br</code> object.</p>

<p>An <a href="http://savanttools.com/test-http-status-codes" rel="nofollow">excellent website</a> allows us to test various error codes, and has a form interface at the top that I've tested this on. I create a <code>br</code> object at this site, then define a function that selects the form from <code>br</code>, pulls out the relevant information, but does the submit via <code>requests</code> - so that the <code>br</code> object hasn't changed and is re-usable. Error codes cause <code>requests</code> to return rubbish, but don't render the <code>br</code> unusable.</p>

<p>As stated below, this involves a little more setup time, but is well worth it.</p>

<pre><code>import mechanize
import requests

def testErrorCodes(br,theCodes):
    for x in theCodes:

        br.select_form(nr=0)

        theAction = br.action
        payload = {'code': x}

        response = requests.post(theAction, data=payload)
        print response.status_code

br=mechanize.Browser()
br.set_handle_robots(False)
response = br.open("http://savanttools.com/test-http-status-codes")

testErrorCodes(br,[401,402,403,404,500,503,504]) # Prints the error codes 

testErrorCodes(br,[404]) # The browser is still alive and well to be used again!
</code></pre>
    </div>
    </div></body></html>