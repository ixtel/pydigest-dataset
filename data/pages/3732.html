<html><body><div><div class="entry-content">
		<p>In this part of the tutorial, we’re going to manage user authentication using the <span>django-allauth</span> package, which let’s you configure quite a few Social Accounts, including Facebook, Twitter or Google.</p>
<p>The idea is that when a user visits the home page, it can log in (or register) using any of the available social account services. Moreover, the database creates a new User instance every time a user is registered through this process.</p>
<p>In this part we’re going to focus on Google authentication, and as always, we’re going to start writing a test <img src="http://www.marinamele.com/wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley"/></p>
<p><img class="wp-image-764 alignleft" src="http://www.marinamele.com/wp-content/uploads/2015/03/taskbuster_authorization_google-273x300.jpg" alt="Django authorized by Google"/>The outline of this part is:</p>

<p> </p>
<h2><a id="define-write-text"/>Define what we expect and write a Test</h2>
<p>As we haven’t touched the <span>base.html</span> template that came with HTML5 Boilerplate, when we go to the TaskBuster home page we see a top navigation bar with a Sign in form.</p>
<p><a href="http://www.marinamele.com/wp-content/uploads/2015/03/login-bar.png"><img class="alignnone size-full wp-image-742" src="http://www.marinamele.com/wp-content/uploads/2015/03/login-bar.png" alt="login-bar"/></a></p>
<p>We are going to modify it so that only contains a button that says “Sign in with Google”, visible for users that are not logged in, and a “Logout” button for the others.</p>
<p>Let’s write a new functional test in <span>functional_tests/test_allauth.py </span>(you have to create this file):</p>

		<div id="crayon-56b06eb21de40966065547" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-1">1</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-2">2</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-3">3</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-4">4</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-5">5</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-6">6</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-7">7</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-8">8</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-9">9</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-10">10</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-11">11</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-12">12</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-13">13</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-14">14</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-15">15</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-16">16</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-17">17</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-18">18</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-19">19</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-20">20</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-21">21</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-22">22</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-23">23</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-24">24</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-25">25</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-26">26</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-27">27</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-28">28</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-29">29</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-30">30</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-31">31</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-32">32</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-33">33</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-34">34</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-35">35</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-36">36</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-37">37</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-38">38</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-39">39</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-40">40</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-41">41</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-42">42</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-43">43</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-44">44</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-45">45</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-46">46</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-47">47</p><p class="crayon-num" data-line="crayon-56b06eb21de40966065547-48">48</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21de40966065547-1"><span class="crayon-p"># -*- coding: utf-8 -*-</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-2"><span class="crayon-e">from </span><span class="crayon-e">selenium </span><span class="crayon-e">import </span><span class="crayon-e">webdriver</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-3"><span class="crayon-e">from </span><span class="crayon-v">selenium</span><span class="crayon-sy">.</span><span class="crayon-v">webdriver</span><span class="crayon-sy">.</span><span class="crayon-v">common</span><span class="crayon-sy">.</span><span class="crayon-e">by </span><span class="crayon-e">import </span><span class="crayon-e">By</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-4"><span class="crayon-e">from </span><span class="crayon-v">selenium</span><span class="crayon-sy">.</span><span class="crayon-v">webdriver</span><span class="crayon-sy">.</span><span class="crayon-v">support</span><span class="crayon-sy">.</span><span class="crayon-e">ui </span><span class="crayon-e">import </span><span class="crayon-e">WebDriverWait</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-5"><span class="crayon-e">from </span><span class="crayon-v">selenium</span><span class="crayon-sy">.</span><span class="crayon-v">webdriver</span><span class="crayon-sy">.</span><span class="crayon-e">support </span><span class="crayon-e">import </span><span class="crayon-e">expected_conditions </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">EC</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-6"><span class="crayon-e">from </span><span class="crayon-v">selenium</span><span class="crayon-sy">.</span><span class="crayon-v">common</span><span class="crayon-sy">.</span><span class="crayon-e">exceptions </span><span class="crayon-e">import </span><span class="crayon-e">TimeoutException</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-7"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-8"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">core</span><span class="crayon-sy">.</span><span class="crayon-e">urlresolvers </span><span class="crayon-e">import </span><span class="crayon-e">reverse</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-9"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">contrib</span><span class="crayon-sy">.</span><span class="crayon-v">staticfiles</span><span class="crayon-sy">.</span><span class="crayon-e">testing </span><span class="crayon-e">import </span><span class="crayon-e">StaticLiveServerTestCase</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-10"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">translation </span><span class="crayon-e">import </span><span class="crayon-e">activate</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-11"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-12"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-13"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TestGoogleLogin</span><span class="crayon-sy">(</span><span class="crayon-v">StaticLiveServerTestCase</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-14"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-15"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">setUp</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-16"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">webdriver</span><span class="crayon-sy">.</span><span class="crayon-e">Firefox</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-17"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-sy">.</span><span class="crayon-e">implicitly_wait</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-18"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-sy">.</span><span class="crayon-v">wait</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">WebDriverWait</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-19"><span class="crayon-h">        </span><span class="crayon-e">activate</span><span class="crayon-sy">(</span><span class="crayon-s">'en'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-20"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-21"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">tearDown</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-22"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-sy">.</span><span class="crayon-e">quit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-23"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-24"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">element_id</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-25"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-sy">.</span><span class="crayon-v">wait</span><span class="crayon-sy">.</span><span class="crayon-e">until</span><span class="crayon-sy">(</span><span class="crayon-v">EC</span><span class="crayon-sy">.</span><span class="crayon-e">presence_of_element_located</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-26"><span class="crayon-h">                </span><span class="crayon-sy">(</span><span class="crayon-v">By</span><span class="crayon-sy">.</span><span class="crayon-v">ID</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">element_id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-27"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-28"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">get_button_by_id</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">element_id</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-29"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-sy">.</span><span class="crayon-v">wait</span><span class="crayon-sy">.</span><span class="crayon-e">until</span><span class="crayon-sy">(</span><span class="crayon-v">EC</span><span class="crayon-sy">.</span><span class="crayon-e">element_to_be_clickable</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-30"><span class="crayon-h">                </span><span class="crayon-sy">(</span><span class="crayon-v">By</span><span class="crayon-sy">.</span><span class="crayon-v">ID</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">element_id</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-31"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-32"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">get_full_url</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">namespace</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-33"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">live_server_url</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-t">namespace</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-34"> </p><p class="crayon-line" id="crayon-56b06eb21de40966065547-35"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">test_google_login</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-36"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">browser</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_full_url</span><span class="crayon-sy">(</span><span class="crayon-s">"home"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-37"><span class="crayon-h">        </span><span class="crayon-v">google_login</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"google_login"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-38"><span class="crayon-h">        </span><span class="crayon-e">with </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">assertRaises</span><span class="crayon-sy">(</span><span class="crayon-v">TimeoutException</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-39"><span class="crayon-h">            </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"logout"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-40"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">assertEqual</span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-41"><span class="crayon-h">            </span><span class="crayon-v">google_login</span><span class="crayon-sy">.</span><span class="crayon-e">get_attribute</span><span class="crayon-sy">(</span><span class="crayon-s">"href"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-42"><span class="crayon-h">            </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">live_server_url</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"/accounts/google/login"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-43"><span class="crayon-h">        </span><span class="crayon-v">google_login</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-44"><span class="crayon-h">        </span><span class="crayon-e">with </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">assertRaises</span><span class="crayon-sy">(</span><span class="crayon-v">TimeoutException</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-45"><span class="crayon-h">            </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"google_login"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-46"><span class="crayon-h">        </span><span class="crayon-v">google_logout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"logout"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-47"><span class="crayon-h">        </span><span class="crayon-v">google_logout</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21de40966065547-48"><span class="crayon-h">        </span><span class="crayon-v">google_login</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"google_login"</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
The previous test:</p>
<ul>
<li>Initializes a browser in <span>setUp</span>. <span>WebDriverWait</span> is used to make the browser wait a certain amount of time before rising an exception when an element is not found.</li>
<li><span>tearDown</span> just quits the browser</li>
<li><span>get_element_by_id</span> and <span>get_button_by_id</span> are helper functions that use <span>WebDriverWait</span> to find elements by ID. Note that for a button we wait until the element is clickable.</li>
<li><span>get_full_url</span> is another helper function that we used in other tests. It returns the full url given a reverse name.</li>
<li><span>test_google_login</span> is the main test here. It goes to the home page and:
<ul>
<li>checks that the login button is present</li>
<li>checks that the logout button is not present</li>
<li>checks that the login button points to the correct url (<span>/accounts/google/login</span>)</li>
<li>checks that after clicking on the login button, the user gets logged in and it sees the logout button instead.</li>
<li>a click on the logout button should make the user see the login button again.</li>
</ul>
</li>
</ul>
<p>Now that we know what we want, let’s install the <span>allauth</span> package <img src="http://www.marinamele.com/wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley"/></p>
<h2><a id="install-django-allauth"/>Install django-allauth</h2>
<p>Let’s install the package <a href="http://django-allauth.readthedocs.org/en/latest/" target="_blank">django-allauth</a>, which allows users to register and log in using different social accounts like Google or Twitter.</p>

		<div id="crayon-56b06eb21de5f835089018" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21de5f835089018-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">django</span><span class="crayon-o">-</span><span class="crayon-v">allauth</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
which will install several libraries:</p>

		<div id="crayon-56b06eb21de6d665721824" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21de6d665721824-1"><span class="crayon-e">Successfully </span><span class="crayon-e">installed </span><span class="crayon-v">django</span><span class="crayon-o">-</span><span class="crayon-e">allauth </span><span class="crayon-v">python3</span><span class="crayon-o">-</span><span class="crayon-e">openid </span><span class="crayon-v">requests</span><span class="crayon-o">-</span><span class="crayon-e">oauthlib </span><span class="crayon-e">requests </span><span class="crayon-e">defusedxml </span><span class="crayon-e">oauthlib</span></p><p class="crayon-line" id="crayon-56b06eb21de6d665721824-2"><span class="crayon-e">Cleaning </span><span class="crayon-v">up</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
You should add them all into the <span>requirements/base.txt</span> file, and install them into the testing environment.</p>
<p>Note: if the version of <span>django-allauth &lt; 0.20.0</span>, you should install the development version in order to be compatible with Django 1.8, with:</p>

		<div id="crayon-56b06eb21de7a295633464" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21de7a295633464-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-v">install</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">U</span><span class="crayon-h"> </span><span class="crayon-v">git</span><span class="crayon-o">+</span><span class="crayon-v">https</span><span class="crayon-o">:</span><span class="crayon-c">//github.com/pennersr/django-allauth.git</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
</p><h2><a id="settings-file"/>Settings File</h2>
<p>Next, open the <span>settings/base.py</span> file and make sure you have the django.template.context_procesors.request. If you’re using Django 1.7, you’ll have to use allauth context processors (<a href="http://django-allauth.readthedocs.org/en/latest/installation.html" target="_blank">read more</a>):</p>

		<div id="crayon-56b06eb21de87726005603" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-1">1</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-2">2</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-3">3</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-4">4</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-5">5</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-6">6</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-7">7</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-8">8</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-9">9</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-10">10</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-11">11</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-12">12</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-13">13</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-14">14</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-15">15</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-16">16</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-17">17</p><p class="crayon-num" data-line="crayon-56b06eb21de87726005603-18">18</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21de87726005603-1"><span class="crayon-v">TEMPLATES</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-2"><span class="crayon-h">    </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-3"><span class="crayon-h">        </span><span class="crayon-s">'BACKEND'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'django.template.backends.django.DjangoTemplates'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-4"><span class="crayon-h">        </span><span class="crayon-s">'DIRS'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">os</span><span class="crayon-sy">.</span><span class="crayon-v">path</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">BASE_DIR</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"templates"</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-5"><span class="crayon-h">        </span><span class="crayon-s">'APP_DIRS'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-6"><span class="crayon-h">        </span><span class="crayon-s">'OPTIONS'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-7"><span class="crayon-h">            </span><span class="crayon-s">'context_processors'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-8"><span class="crayon-h">                </span><span class="crayon-s">'django.template.context_processors.debug'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-9"><span class="crayon-h">                </span><span class="crayon-s">'django.template.context_processors.request'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-10"><span class="crayon-h">                </span><span class="crayon-s">'django.contrib.auth.context_processors.auth'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-11"><span class="crayon-h">                </span><span class="crayon-s">'django.contrib.messages.context_processors.messages'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-12"><span class="crayon-h">                </span><span class="crayon-s">'django.template.context_processors.i18n'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-13"><span class="crayon-h">                </span><span class="crayon-p"># Required by allauth template tags</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-14"><span class="crayon-h">                </span><span class="crayon-s">"django.core.context_processors.request"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-15"><span class="crayon-h">            </span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-16"><span class="crayon-h">        </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-17"><span class="crayon-h">    </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de87726005603-18"><span class="crayon-sy">]</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
Next, we need to include the Authentication Backend used by allauth:</p>

		<div id="crayon-56b06eb21de94642539786" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21de94642539786-1"><span class="crayon-v">AUTHENTICATION_BACKENDS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56b06eb21de94642539786-2"><span class="crayon-h">    </span><span class="crayon-p"># Default backend -- used to login by username in Django admin</span></p><p class="crayon-line" id="crayon-56b06eb21de94642539786-3"><span class="crayon-h">    </span><span class="crayon-s">"django.contrib.auth.backends.ModelBackend"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de94642539786-4"><span class="crayon-h">    </span><span class="crayon-p"># `allauth` specific authentication methods, such as login by e-mail</span></p><p class="crayon-line" id="crayon-56b06eb21de94642539786-5"><span class="crayon-h">    </span><span class="crayon-s">"allauth.account.auth_backends.AuthenticationBackend"</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21de94642539786-6"><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
And the required apps (including the app for Google):</p>

		<div id="crayon-56b06eb21dea0500293594" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21dea0500293594-1"><span class="crayon-v">INSTALLED_APPS</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-2"><span class="crayon-h">    </span><span class="crayon-p"># The Django sites framework is required</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-3"><span class="crayon-h">    </span><span class="crayon-s">'django.contrib.sites'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-4"><span class="crayon-h">    </span><span class="crayon-s">'allauth'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-5"><span class="crayon-h">    </span><span class="crayon-s">'allauth.account'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-6"><span class="crayon-h">    </span><span class="crayon-s">'allauth.socialaccount'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-7"><span class="crayon-h">    </span><span class="crayon-p"># Login via Google</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-8"><span class="crayon-h">    </span><span class="crayon-s">'allauth.socialaccount.providers.google'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-9"><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-10"> </p><p class="crayon-line" id="crayon-56b06eb21dea0500293594-11"><span class="crayon-v">SITE_ID</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
Note that we are adding these Installed Apps into the existing 
			<span id="crayon-56b06eb21deac967082127" class="crayon-syntax crayon-syntax-inline  crayon-theme-my-crayon-theme-github crayon-theme-my-crayon-theme-github-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">INSTALLED_APPS</span></span></span>  setting using +=.</p>
<p>The <span>SITE_ID</span> parameter is used by the Django sites framework.</p>
<p>Finally, we are going to set the following parameters to customize the authorization process:</p>

		<div id="crayon-56b06eb21deb6542779971" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21deb6542779971-1"><span class="crayon-v">ACCOUNT_USERNAME_REQUIRED</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">False</span></p><p class="crayon-line" id="crayon-56b06eb21deb6542779971-2"><span class="crayon-v">ACCOUNT_EMAIL_VERIFICATION</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"none"</span></p><p class="crayon-line" id="crayon-56b06eb21deb6542779971-3"><span class="crayon-v">SOCIALACCOUNT_QUERY_EMAIL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></p><p class="crayon-line" id="crayon-56b06eb21deb6542779971-4"><span class="crayon-v">LOGIN_REDIRECT_URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"/"</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
This will make allauth to ask for the email (if possible) in the authorization process. It will ask it to Google, without any verification process, and after logging in, it will redirect the user to the home page.</p>
<p>You can find more info about the <a href="http://django-allauth.readthedocs.org/en/latest/configuration.html" target="_blank">available settings here</a>.</p>
<h2><a id="urls"/>Urls</h2>
<p>Next open the <span>taskbuster/urls.py</span> file and add the corresponding urls before the i18n internationalization urls:</p>

		<div id="crayon-56b06eb21dec2822501844" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21dec2822501844-1"><span class="crayon-v">urlpatterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></p><p class="crayon-line" id="crayon-56b06eb21dec2822501844-2"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^(?P&lt;filename&gt;(robots.txt)|(humans.txt))$'</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dec2822501844-3"><span class="crayon-h">        </span><span class="crayon-v">home_files</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">=</span><span class="crayon-s">'home-files'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dec2822501844-4"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^accounts/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-s">'allauth.urls'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dec2822501844-5"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'i18n/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-s">'django.conf.urls.i18n'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21dec2822501844-6"><span class="crayon-sy">]</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
</p><h2><a id="database-migrations"/>Database migrations</h2>
<p>Ok, now we just need to update the database:</p>

		<div id="crayon-56b06eb21decd809108088" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21decd809108088-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-i">check</span></p><p class="crayon-line" id="crayon-56b06eb21decd809108088-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">migrate</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
</p><h2><a id="sites-configuration"/>Sites configuration</h2>
<p>Next, we need to configure the Sites Framework. Run the development server with</p>

		<div id="crayon-56b06eb21ded7419413827" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21ded7419413827-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">runserver</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
and go to the admin interface at <a href="http://127.0.0.1:8000/admin/sites/site" target="_blank">http://127.0.0.1:8000/admin/sites/site</a> and create a Site for the localhost, <span>127.0.0.1:8000</span>, or your website domain for production. If you have an example.com site defined, modify it so it has an id equal to the <span>SITE_ID=1</span> setting variable. Otherwise, if you create a new site, you have to change the settings variable, SITE_ID, with the ID of the site you just created (probably 2).</p>
<p>Note: you need to create a superuser account to access the Django admin. If you don’t have it yet, you can create a new one with:</p>

		<div id="crayon-56b06eb21dee3957683235" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21dee3957683235-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">createsuperuser</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
We are ready to create our Google Application!</p>
<h2><a id="google-app"/>Goolge App Registration</h2>
<p>First, we are going to create a Google App to obtain a key/secret pair. Go to the <a href="https://console.developers.google.com/project" target="_blank">Google Developers Console</a> and click on Create Project. Choose a name for your project and an ID.</p>
<p>Next, click on your newly created project and on the left menu select <span>APIs &amp; auth –&gt; Credentials a</span>nd click on the<span> Consent screen </span>tab. You should provide at least a Name and an Email.</p>
<p>Go back to the <span>Credentials</span> tab and click on <span>Create new Client ID</span>. Select <span>Web Application</span> and use:</p>

		<div id="crayon-56b06eb21def0035266070" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21def0035266070-1">Authorized<span class="crayon-h"> </span>Javascript<span class="crayon-h"> </span>Origins<span class="crayon-sy">:</span> http<span class="crayon-sy">:</span>//127<span class="crayon-sy">.</span>0<span class="crayon-sy">.</span>0<span class="crayon-sy">.</span>1<span class="crayon-sy">:</span>8000/</p><p class="crayon-line" id="crayon-56b06eb21def0035266070-2"> </p><p class="crayon-line" id="crayon-56b06eb21def0035266070-3">Authorized<span class="crayon-h"> </span>Redirect<span class="crayon-h"> </span>Uris<span class="crayon-sy">:</span> http<span class="crayon-sy">:</span>//127<span class="crayon-sy">.</span>0<span class="crayon-sy">.</span>0<span class="crayon-sy">.</span>1<span class="crayon-sy">:</span>8000/accounts/google/login/callback/</p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
Note that the redirect URI proposed automatically is different from the one written here <img src="http://www.marinamele.com/wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley"/></p>
<p>This app will work in our development and testing environment. You should create another Client/secret pair for production, and change <span>http://127.0.0.1:8000/</span> by your website domain.</p>
<p>Great! We have our Google App ready, so let’s configure the Django part!</p>
<h2><a id="allauth-django-configuration"/>Allauth Django Configuration</h2>
<p>Create a Social Application for Google at <a href="http://127.0.0.1:8000/admin/socialaccount/socialapp/" target="_blank">http://127.0.0.1:8000/admin/socialaccount/socialapp</a>, with the following properties:</p>
<ul>
<li><span>Provider</span>: Google</li>
<li><span>Name</span>: Google (or something similar)</li>
<li><span>Client ID</span>: your application Client ID (obtained in the Developers Console at APIs &amp; auth –&gt; Credentials).</li>
<li><span>Secret Key</span>: your application Client Secret</li>
<li><span>Key</span>: not needed (leave blank).</li>
<li>Select the corresponding <span>site</span>.</li>
</ul>
<p>Finally, just save the instance.</p>
<h2><a id="test-user-flow"/>Testing the user flow</h2>
<p>Ok, now we are ready to run our tests!</p>

		<div id="crayon-56b06eb21defd245502311" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21defd245502311-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-e">test </span><span class="crayon-v">functional_tests</span><span class="crayon-sy">.</span><span class="crayon-v">test_allauth</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
First, it fails because the home page doesn’t have an element with an id equal to <span>google_login</span>.</p>
<p>Let’s edit the <span>taskbuster/templates/base.html</span> file and find the <span>navigation bar</span>. There you should replace the form tag by the following code:</p>

		<div id="crayon-56b06eb21df08022688875" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df08022688875-1"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"navbar-collapse collapse"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-2"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"navbar-form navbar-right"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-3"><span class="crayon-h">    </span><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">is_authenticated</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-4"><span class="crayon-h">      </span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"logout"</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"/accounts/logout"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"btn btn-success"</span><span class="crayon-o">&gt;</span><span class="crayon-e">Logout</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">a</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-5"><span class="crayon-h">    </span><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-6"><span class="crayon-h">      </span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-s">"google_login"</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"/accounts/google/login"</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"btn btn-success"</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-7"><span class="crayon-h">        </span><span class="crayon-e">Sign</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">with</span><span class="crayon-h"> </span><span class="crayon-e">Google</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-8"><span class="crayon-h">      </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">a</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-9"><span class="crayon-h">    </span><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-st">endif</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-10"><span class="crayon-h">  </span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-56b06eb21df08022688875-11"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">!</span><span class="crayon-o">--</span><span class="crayon-o">/</span><span class="crayon-sy">.</span><span class="crayon-v">navbar</span><span class="crayon-o">-</span><span class="crayon-v">collapse</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-o">&gt;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
We have included some logic here, to display the Sign in button only when the user is not logged in, and the logout button otherwise.</p>
<p>If you run the tests again, you’ll see that we get an Internal Error after clicking on the Sign in button. This is because the testing database doesn’t have a Google App defined (the testing database is empty!). Let’s change this!</p>
<p>As in the development database we only have a Site, a Google App and the admin user, we are going to use it to dump its data to create a fixture.</p>
<p>First, create the folder fixutres:</p>

		<div id="crayon-56b06eb21df15900813002" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df15900813002-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">mkdir </span><span class="crayon-v">taskbuster</span><span class="crayon-o">/</span><span class="crayon-v">fixtures</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
and next, create the fixture with</p>

		<div id="crayon-56b06eb21df21518664186" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df21518664186-1"><span class="crayon-sy">$</span> <span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">dumpdata</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-i">indent</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">natural</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-v">contenttypes</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-v">auth</span><span class="crayon-sy">.</span><span class="crayon-v">Permission</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">taskbuster</span><span class="crayon-o">/</span><span class="crayon-v">fixtures</span><span class="crayon-o">/</span><span class="crayon-v">allauth_fixture</span><span class="crayon-sy">.</span><span class="crayon-v">json</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
Open you <span>.gitignore</span> file and add a line to omit this folder, as it contains sensitive information</p>

		<div id="crayon-56b06eb21df2d001391775" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df2d001391775-1"><span class="crayon-p"># .gitignore</span></p><p class="crayon-line" id="crayon-56b06eb21df2d001391775-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56b06eb21df2d001391775-3"><span class="crayon-v">taskbuster</span><span class="crayon-o">/</span><span class="crayon-v">fixtures</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
Next, we need to load this fixture in our tests. In your <span>settings/testing.py</span> file indicate the fixture folder</p>

		<div id="crayon-56b06eb21df39028623222" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df39028623222-1"><span class="crayon-v">FIXTURE_DIRS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span></p><p class="crayon-line" id="crayon-56b06eb21df39028623222-2"><span class="crayon-h">    </span><span class="crayon-v">os</span><span class="crayon-sy">.</span><span class="crayon-v">path</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">BASE_DIR</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fixtures'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56b06eb21df39028623222-3"><span class="crayon-h">    </span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
and at the beginning of your test class, include the fixture as</p>

		<div id="crayon-56b06eb21df43936030718" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df43936030718-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TestGoogleLogin</span><span class="crayon-sy">(</span><span class="crayon-v">StaticLiveServerTestCase</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21df43936030718-2"> </p><p class="crayon-line" id="crayon-56b06eb21df43936030718-3"><span class="crayon-h">    </span><span class="crayon-v">fixtures</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'allauth_fixture'</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56b06eb21df43936030718-4"> </p><p class="crayon-line" id="crayon-56b06eb21df43936030718-5"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">setUp</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21df43936030718-6"><span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
Ok, try again to run your tests.</p>

		<div id="crayon-56b06eb21df4e817481500" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df4e817481500-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-e">test </span><span class="crayon-v">functional_tests</span><span class="crayon-sy">.</span><span class="crayon-v">test_allauth</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
This time you’ll see the Google Authorization page, where the user should indicate its username and password to log in, and the test fails as it can’t find the logout button.</p>
<p>Let’s make the test to insert our credentials. Create the file <span>taskbuster/fixtures/google_user.json</span> and write</p>

		<div id="crayon-56b06eb21df5b982667682" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df5b982667682-1"><span class="crayon-sy">{</span><span class="crayon-s">"Email"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"example@gmail.com"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"Passwd"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"example_psw"</span><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
where you should insert a valid Google Credentials. As this file is located under the fixtures folder, it won’t be in the git repository.</p>
<p>Note that the keys <span>Email</span> and <span>Passwd</span> are the html element ids of the Google login form.</p>
<p>Next, add the following method inside the test, that will be called after clicking on the Sign in button:</p>

		<div id="crayon-56b06eb21df66372017695" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-1">1</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-2">2</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-3">3</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-4">4</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-5">5</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-6">6</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-7">7</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-8">8</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-9">9</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-10">10</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-11">11</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-12">12</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-13">13</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-14">14</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-15">15</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-16">16</p><p class="crayon-num" data-line="crayon-56b06eb21df66372017695-17">17</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df66372017695-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TestGoogleLogin</span><span class="crayon-sy">(</span><span class="crayon-v">StaticLiveServerTestCase</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-2"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-3"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">user_login</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-4"><span class="crayon-h">        </span><span class="crayon-e">import </span><span class="crayon-e">json</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-5"><span class="crayon-e">        </span><span class="crayon-e">with </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-s">"taskbuster/fixtures/google_user.json"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-6"><span class="crayon-h">            </span><span class="crayon-v">credentials</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">json</span><span class="crayon-sy">.</span><span class="crayon-e">loads</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-7"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"Email"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">send_keys</span><span class="crayon-sy">(</span><span class="crayon-v">credentials</span><span class="crayon-sy">[</span><span class="crayon-s">"Email"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-8"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_button_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"next"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-9"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_element_by_id</span><span class="crayon-sy">(</span><span class="crayon-s">"Passwd"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">send_keys</span><span class="crayon-sy">(</span><span class="crayon-v">credentials</span><span class="crayon-sy">[</span><span class="crayon-s">"Passwd"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-10"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">btn </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">"signIn"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"submit_approve_access"</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-11"><span class="crayon-h">            </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">get_button_by_id</span><span class="crayon-sy">(</span><span class="crayon-v">btn</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-12"><span class="crayon-h">        </span><span class="crayon-st">return</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-13"><span class="crayon-h">    </span><span class="crayon-e">def </span><span class="crayon-e">test_google_login</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-14"><span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-15"><span class="crayon-h">        </span><span class="crayon-v">google_login</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-16"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">user_login</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56b06eb21df66372017695-17"><span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
Ok, if you run this test again you’ll see the following message in the browser:</p>
<p><a href="http://www.marinamele.com/wp-content/uploads/2015/03/test_redirect_uri.png"><img class="size-full wp-image-751 aligncenter" src="http://www.marinamele.com/wp-content/uploads/2015/03/test_redirect_uri.png" alt="test_redirect_uri"/></a></p>
<p>indicating that the redirect URI at <span>http://localhost:8081</span> is not valid. This is because we registered a different url, <span>http://127.0.0.1:8000</span>, and not the one that is used by tests.</p>
<p>Go back into the Developers Console and register the url <span>http://localhost:8081</span> and the corresponding callback url in your app.</p>
<p>Next, open the <span>taskbuster/fixtures/allauth_fixture.json</span>, and replace all occurrences of <span>127.0.0.1:8000</span> for <span>localhost:8081</span> (I counted 3).</p>
<p>Run the test again.</p>
<p>Yes! the authorization process was successful <img src="http://www.marinamele.com/wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley"/></p>
<p>But… when the <span>Logout</span> button is clicked, you are redirected to another url, with a confirmation form in it.</p>
<p>In order to omit this step, edit the <span>taskbuster/urls.py</span> file and add the following line before including <span>allauth.urls</span>:</p>

		<div id="crayon-56b06eb21df75561850292" class="crayon-syntax crayon-theme-my-crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen no-popup minimize scroll-mouseover">
		
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56b06eb21df75561850292-1"><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^accounts/logout/$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'django.contrib.auth.views.logout'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'next_page'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>
This will make the user to go back to the home page after clicking the <span>Logout</span> button.</p>
<p>Ok, run your tests again, this time it should work! <img src="http://www.marinamele.com/wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley"/></p>
<p>Well Done!!</p>
<p>Can you try to configure another Social Account? Like Twitter, LinkedIn or Facebook?</p>
<p/>
<p class="g-post" data-href="https://plus.google.com/+MarinaMeleMesseguer/posts/3KfWZbmNrrD"/>
<h2>What’s next?</h2>
<p>Now, you can:</p>

<p>Please, +1 and share if useful! Thanks! <img src="http://www.marinamele.com/wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley"/></p>
			</div>
	</div></body></html>