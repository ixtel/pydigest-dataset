<html><body><div><div class="blog-content">

                        

                            
                        



                        
                            
                                <h2 id="_1">Введение</h2>
<blockquote>
<p>Этим уроком открывается цикл практических занятий по написанию тестов с применением различных инструментов.</p>
</blockquote>
<p>unittest - инструмент для тестирования в Python.
Это стандартный модуль для написания юнит-тестов на Python. Unittest это порт JUnit с Java. Иными словами, и в коде модуля, и при написании тестов легко прослеживается ООП стиль, что весьма удобно для тестирования процедур и классов.</p>
<p>Документация доступна по следующим ссылкам: <a href="https://docs.python.org/3/library/unittest.html">python3</a>, <a href="https://docs.python.org/2/library/unittest.html">python2</a></p>
<p>В данном инструменте много возможностей: проверки (<strong>assert</strong>*), декораторы, позволяющие пропустить отдельный тест (<strong>@skip</strong>, <strong>@skipIf</strong>) или обозначить сломанные тесты (<strong>@expectedFailure</strong>) и этим не заканчивается список. Использование assert'ов с лихвой покрывает нужды при написании тестов.</p>
<h2 id="unittest">Описание unittest</h2>
<p>Полезная черта unittest - автоматизированное тестирование.  Есть и другие:</p>
<ul>
<li>можно собирать тесты в группы</li>
<li>собирать результаты выполнения тестов (например, для отчета)</li>
<li>ООП стиль позволяет уменьшить дублирование кода при схожих объектах тестирования </li>
</ul>
<p>В использовании unittest присутствуют несколько концепций</p>
<h3 id="test-case">test case</h3>
<p>test case -это наименьшая единица тестирования. Он проверяет конкретный ответ для конкретного набора входных данных.</p>
<h3 id="test-suite">test suite</h3>
<p>test suite представляет собой сборник тестовых случаев, тестовых наборов. Используется для агрегирования тестов, которые должны выполняться вместе.</p>
<h3 id="test-fixture">test fixture</h3>
<p>test fixture - это фиксированное состояние объектов используемых в качестве исходного при выполнении тестов.</p>
<p>Цель использования fixture - если у вас сложный test case, то подготовка нужного состояния легко может занимать много ресурсов (например, вы считаете функцию с определенной точностью и каждый следующий знак точности в расчетах занимает день). Используя fixture (на сленге - фикстуры) предварительную подготовку состояния пропускаем и сразу преступаем к тестированию. </p>
<p>Test fixute может выступать, например, в виде:
- состояние базы данных
- набор переменных среды
- набор файлов с необходимым содержанием.</p>
<h3 id="test-runner">test runner</h3>
<p>test runner - это компонент, который организует выполнение тестов и предоставляет результат пользователю.</p>
<h2 id="_2">Рекомендации к написанию тестов</h2>
<p>При написании тестов следует исходить из следующих принципов:</p>
<ul>
<li>Работа теста не должна зависеть от результатов работы других тестов.</li>
<li>Тест должен использовать данные, специально для него подготовленные, и никакие другие.</li>
<li>Тест не должен требовать ввода от пользователя</li>
<li>Тесты не должны перекрывать друг друга (не надо писать одинаковые тесты 20 раз). Можно писать частично перекрывающие тесты.</li>
<li>Нашел баг -&gt; напиши тест</li>
<li>Тесты надо поддерживать в рабочем состоянии</li>
<li>Модульные тесты не должны проверять производительность сущности (класса, функции)</li>
<li>Тесты должны проверять не только то, что сущность работает корректно на корректных данных, но и то что ведет себя адекватно при некорректных данных.</li>
<li>Тесты надо запускать регулярно</li>
</ul>
<h2 id="_3">Практика</h2>
<p>К написанию тестов стоит относится также как и к основному коду. </p>
<p>Написание тестов является хорошей инвестицией в будущее программы:</p>
<ul>
<li>Когда ваша программа становится настолько большой, что не помещается целиком у вас в голове, то это отличный звоночек, что стоит покрывать все тестами</li>
<li>Если сейчас ваша программа не испытывает проблем, то через какое-то время библиотеки, которые вы используете, могут начать обновляться без обратной совместимости. Вот здесь-то тесты помогут</li>
<li>Когда вы занимаетесь рефакторингом кода - тесты помогут не сломать лишнего</li>
</ul>
<p>Есть и другие причины писать тесты. В целом, практика показывает, что до тестов надо дорасти - в какой-то момент приходит понимание зачем же тратить на них время.</p>
<p>В качестве примеров использования unittest продемонстрирую и опишу основные возможности модуля. На мой взгляд это те 20% которые помогут сделать 80% результата.</p>
<h3 id="no1">Пример синтаксиса №1</h3>
<p>Рассмотрим следующий код:</p>
<div class="codehilite"><pre><span class="c"># -*- encoding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">TestUM</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_numbers_3_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_strings_a_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">'a'</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'aaa'</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>В данном примере показан общий шаблон для большинства тестов - здесь и наследование от TestCase, здесь и два простых теста, а также перегрузка встроенных в TestCase методов:</p>
<ul>
<li>Метод def setUp(self)  вызывается <em>ПЕРЕД</em> каждым тестом.</li>
<li>Метод def tearDown(self) вызывается <em>ПОСЛЕ</em> каждого теста</li>
</ul>
<p>Список подобных готовых функций такой:</p>
<ul>
<li>setUp – подготовка прогона теста; вызывается перед каждым тестом.</li>
<li>tearDown – вызывается после того, как тест был запущен и результат записан. Метод запускается даже в случае исключения (exception) в теле теста.</li>
<li>setUpClass – метод вызывается перед запуском всех тестов класса.</li>
<li>tearDownClass – вызывается после прогона всех тестов класса.</li>
<li>setUpModule – вызывается перед запуском всех классов модуля.</li>
<li>tearDownModule – вызывается после прогона всех тестов модуля.</li>
</ul>
<p>Если запустить скрипт:</p>



<p>То получим:</p>
<div class="codehilite"><pre><span class="n">python</span> <span class="n">example</span><span class="o">.</span><span class="n">py</span>
<span class="o">..</span>
<span class="o">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">2</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.000</span><span class="n">s</span>


<span class="n">OK</span>
</pre></div>


<p>Теперь мы знаем как писать тест, как запускать. Перейдем к освещению вариантов использования тестов.</p>
<h3 id="no2-no">Пример синтаксиса №2 - №...</h3>
<div class="codehilite"><pre><span class="c"># -*- encoding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">TestUM</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">testAssertTrue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Вызывает ошибку если значение аргумента != True</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testFailUnless</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Устаревнее название для assertTrue()</span>
<span class="sd">        Вызывает ошибку если значение аргумента != True</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failUnless</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testFailIf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Устаревшая функция, теперь называется assertFalse()</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failIf</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testAssertFalse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Если значение аргумент != False, то кидает ошибку</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testEqual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Проверка равенства двух аргументов</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failUnlessEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testNotEqual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Проверка НЕ равенства двух аргументов</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failIfEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testEqualFail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Ругается если значение аргументов равно</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failIfEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testNotEqualFail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Ругается если значение аргументов не равно</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failUnlessEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testNotAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Старое название функции.</span>
<span class="sd">        Теперь называется assertNotAlmostEqual()</span>
<span class="sd">        Сравнивает два аргумента с округлением, можно задать это округление</span>
<span class="sd">        Ругается если значения равны</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failIfAlmostEqual</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">3.3</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Старое название функции</span>
<span class="sd">        Теперь называется assertAlmostEqual()</span>
<span class="sd">        Сравнивает два аргумента с округлением, можно задать это округление</span>
<span class="sd">        Ругается если значения не равны</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failUnlessAlmostEqual</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">3.3</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>Прямо в док-строках описал когда выбрасывают ошибки эти проверки. В примере показаны как новые названия, так и их старые аналоги (в старых проектах такие еще встречаются)</p>
<h3 id="_4">Практические примеры</h3>
<p>Перейдем к более практическим примерам. На них и рассмотрим еще некоторые важные способности unittest</p>
<ul>
<li>Как тестировать конструктор?</li>
<li>Как тестировать структуры данных?</li>
<li>Как тестировать работу с БД?</li>
</ul>
<h4 id="_5"><strong>Как тестировать конструктор?</strong></h4>
<p>Приведу пример, как можно протестировать конструктор</p>
<div class="codehilite"><pre><span class="c"># -*- encoding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">foo</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">"foo is not equal to 1!"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyClass2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">TestFoo</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">testInsufficientArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">foo</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failUnlessRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">MyClass</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">MyClass2</span><span class="p">,</span> <span class="p">(</span><span class="s">"fsa"</span><span class="p">,</span> <span class="s">"fds"</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>В коде видно, что есть класс, в конструкторе которого кидается исключение если значение аргумента не удовлетворяет условию. 
Это условие ловится функцией self.assertRaises или ее старым названием self.failUnlessRaises</p>
<p>Во втором примере показан тест на количество аргументов в классе.</p>
<h4 id="_6"><strong>Как тестировать структуру данных?</strong></h4>
<p>Продемонстрирую пример тестирования структуры данных. В данном случае есть класс Point, в котором хранится два float’а x,y. А дальше весь код такой же как и для других тестов.</p>
<div class="codehilite"><pre><span class="c"># -*- encoding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'({0}, {1})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">))</span> <span class="k">else</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">))</span> <span class="k">else</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">TestPoint</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="mi">6</span><span class="p">)),</span> <span class="s">"Полученные значения не являются вещественными!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                         <span class="s">"Полученные значения не являются вещественными!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="mi">6</span><span class="p">)),</span> <span class="s">"Полученные значения не являются вещественными!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)),</span>
                         <span class="s">"Полученные значения не являются вещественными!!!"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="o">==</span> <span class="s">"(5.0, 6.0)"</span><span class="p">,</span> <span class="s">"Неправильный вывод на экран!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="s">"(6.0, 10.0)"</span><span class="p">,</span> <span class="s">"Неправильный вывод на экран!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span> <span class="o">==</span> <span class="s">"(5.0, 6.0)"</span><span class="p">,</span> <span class="s">"Неправильный вывод на экран!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span> <span class="o">==</span> <span class="s">"(-5.0, -6.0)"</span><span class="p">,</span> <span class="s">"Неправильный вывод на экран!!!"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span>
                        <span class="s">"Данные две точки равны, а в результате тестирования, они оказались неравными!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
                         <span class="s">"Данные две точки неравны, а в результате тестирования, они оказались равными!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span>
                         <span class="s">"Данные две точки неравны, а в результате тестирования, они оказались равными!!!"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_ne</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span>
                         <span class="s">"Данные две точки равны, а в результате тестирования, они оказались неравными!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span>
                        <span class="s">"Данные две точки неравны, а в результате тестирования, они оказались равными!!!"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span>
                        <span class="s">"Данные две точки неравны, а в результате тестирования, они оказались равными!!!"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<h4 id="_7"><strong>Как тестировать работу с БД?</strong></h4>
<p>Примера под тестирование БД не приведу, однако, расскажу об общих соображениях.</p>
<p>Работа с базой не так проста, как с обычной функцией, ведь база - это не просто программный код, база данных - это объект, сохраняющий своё состояние. И если мы начнём в процессе тестирования изменять данные в базе, то после каждого теста база будет изменяться. Это может помешать последующим тестам и необратимо испортить базу данных.</p>
<p>Ключ к решению проблемы - транзакции. Одна из особенностей этого механизма состоит в том, что до тех пор пока транзакция не завершена, вы всегда можете отменить все изменения и вернуть базу в состояние на момент начала транзакции.
Алгоритм такой:</p>
<ol>
<li>открываем транзакцию;</li>
<li>если нужно, выполняем подготовительные действия для тестирования;</li>
<li>выполняем модульный тест (или просто запускаем сценарий, работу которого хотим проверить);</li>
<li>проверяем результат работы сценария;</li>
<li>отменяем транзакцию, возвращая базу данных в исходное состояние.</li>
</ol>
<p>Даже если в тестируемом коде останутся незакрытые транзакции, внешний ROLLBACK всё равно откатит все изменения корректно.</p>
<p>По-мимо транзакций стоит обратить внимание, что тестирование следует делать на тестовой базе данных. Идеальным случаем будет полная инициализация окружения перед исполнением теста.</p>
<h2 id="_8">Выводы</h2>
<p>В уроке описаны базовые элементы работы с unittest. Не были затронуты статусы тестов, отчеты о тестировании. Однако, данной теории хватит для написания тестов. Давайте это сейчас и проверим, переходите к практике.</p>
                            
                        



                        

                            
                            <footer class="post-info">
                                <span class="label label-default">Дата</span>
                            <span class="published">
                                <i class="fa fa-calendar"/><time>
                                2016-02-11 10:52:50</time>
                            </span>


                                <span class="label label-default">Категории</span>

                                
                                    
                                        
                                            <a href="/blog/category/python-%D1%83%D1%80%D0%BE%D0%BA%D0%B8/">Python уроки</a>
                                            , 
                                        
                                            <a href="/blog/category/uchebnye-materialy/">Учебные материалы</a>
                                            
                                        
                                    
                                


                                <span class="label label-default">Теги</span>

                                <a href="/blog/tag/%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/">тестирование</a>
                                         / 
                                    

                                        <a href="/blog/tag/%D1%83%D1%80%D0%BE%D0%BA/">урок</a>
                                         / 
                                    

                                        <a href="/blog/tag/test/">test</a>
                                         / 
                                    

                                        <a href="/blog/tag/unittest/">unittest</a>
                                         / 
                                    

                                        <a href="/blog/tag/unit/">unit</a>

                            </footer>
                        


                        
                            
                        

                        
                            
                            <a class="btn btn-sm share-twitter" target="_blank" href="http://twitter.com/home?status=https%3A//pynsk.ru/blog/2016/02/11/unit-test/%20Python%20%D1%83%D1%80%D0%BE%D0%BA%D0%B8%3A%20%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E%20unittest">Опубликовать в Twitter</a>
                            <a class="btn btn-sm share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=https://pynsk.ru/blog/2016/02/11/unit-test/&amp;t=Python%20%D1%83%D1%80%D0%BE%D0%BA%D0%B8%3A%20%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E%20unittest">Опубликовать в Facebook</a>
                        

                        
                            
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        


                        <hr/>
                        
                        <hr/>

                        
                            

            </div>

        </div></body></html>