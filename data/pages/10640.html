<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-django-field-history" class="anchor" href="#django-field-history" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>django-field-history</h1>
<a href="https://badge.fury.io/py/django-field-history"><img src="https://camo.githubusercontent.com/ff8802e4d7fe7129425566d42c3a3e3db8e025fd/68747470733a2f2f62616467652e667572792e696f2f70792f646a616e676f2d6669656c642d686973746f72792e737667" data-canonical-src="https://badge.fury.io/py/django-field-history.svg"/>
</a>
<a href="http://django-field-history.readthedocs.org/en/latest/?badge=latest"><img alt="Documentation Status" src="https://camo.githubusercontent.com/0423cfb77b81e98c2685bc22e1cd1401e23094ac/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f646a616e676f2d6669656c642d686973746f72792f62616467652f3f76657273696f6e3d6c6174657374" data-canonical-src="https://readthedocs.org/projects/django-field-history/badge/?version=latest"/></a>
<a href="https://travis-ci.org/grantmcconnaughey/django-field-history"><img alt="https://travis-ci.org/grantmcconnaughey/django-field-history.svg?branch=master" src="https://camo.githubusercontent.com/89dcd83df3442cf83c8caaf14431522dbb8f75f1/68747470733a2f2f7472617669732d63692e6f72672f6772616e746d63636f6e6e6175676865792f646a616e676f2d6669656c642d686973746f72792e7376673f6272616e63683d6d6173746572" data-canonical-src="https://travis-ci.org/grantmcconnaughey/django-field-history.svg?branch=master"/></a>
<a href="https://coveralls.io/github/grantmcconnaughey/django-field-history?branch=master"><img alt="https://coveralls.io/repos/github/grantmcconnaughey/django-field-history/badge.svg?branch=master" src="https://camo.githubusercontent.com/6b03cccf0a0812001f5b632042213af670ccd2bc/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f6772616e746d63636f6e6e6175676865792f646a616e676f2d6669656c642d686973746f72792f62616467652e7376673f6272616e63683d6d6173746572" data-canonical-src="https://coveralls.io/repos/github/grantmcconnaughey/django-field-history/badge.svg?branch=master"/></a>
<p>A Django app to track changes to a model field. For Python 2.7/3.2+ and Django 1.8+.</p>
<a name="user-content-documentation"/>
<h2><a id="user-content-documentation" class="anchor" href="#documentation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Documentation</h2>
<p>The full documentation is at <a href="https://django-field-history.readthedocs.org">https://django-field-history.readthedocs.org</a>.</p>
<a name="user-content-features"/>
<h2><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Features</h2>
<ul>
<li>Keeps a history of all changes to a particular model's field.</li>
<li>Stores the field's name, value, date and time of change, and the user that changed it.</li>
<li>Works with all model field types (except <code>ManyToManyField</code>).</li>
</ul>
<a name="user-content-quickstart"/>
<h2><a id="user-content-quickstart" class="anchor" href="#quickstart" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Quickstart</h2>
<p>Install django-field-history:</p>
<pre>pip install django-field-history
</pre>
<p>Be sure to put it in INSTALLED_APPS.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">INSTALLED_APPS</span> <span class="pl-k">=</span> [
    <span class="pl-c"># other apps...</span>
    <span class="pl-s"><span class="pl-pds">'</span>field_history<span class="pl-pds">'</span></span>,
]</pre></div>
<p>Then add it to your models.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> field_history.tracker <span class="pl-k">import</span> FieldHistoryTracker

<span class="pl-k">class</span> <span class="pl-en">PizzaOrder</span>(<span class="pl-e">models</span>.<span class="pl-e">Model</span>):
    <span class="pl-c1">STATUS_CHOICES</span> <span class="pl-k">=</span> (
        (<span class="pl-s"><span class="pl-pds">'</span>ORDERED<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Ordered<span class="pl-pds">'</span></span>),
        (<span class="pl-s"><span class="pl-pds">'</span>COOKING<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Cooking<span class="pl-pds">'</span></span>),
        (<span class="pl-s"><span class="pl-pds">'</span>COMPLETE<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Complete<span class="pl-pds">'</span></span>),
    )
    status <span class="pl-k">=</span> models.CharField(<span class="pl-v">max_length</span><span class="pl-k">=</span><span class="pl-c1">64</span>, <span class="pl-v">choices</span><span class="pl-k">=</span><span class="pl-c1">STATUS_CHOICES</span>)

    field_history <span class="pl-k">=</span> FieldHistoryTracker([<span class="pl-s"><span class="pl-pds">'</span>status<span class="pl-pds">'</span></span>])</pre></div>
<p>Now each time you change the order's status field information about that change will be stored in the database.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> field_history.models <span class="pl-k">import</span> FieldHistory

<span class="pl-c"># No FieldHistory objects yet</span>
<span class="pl-k">assert</span> FieldHistory.objects.count() <span class="pl-k">==</span> <span class="pl-c1">0</span>

<span class="pl-c"># Creating an object will make one</span>
pizza_order <span class="pl-k">=</span> PizzaOrder.objects.create(<span class="pl-v">status</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>ORDERED<span class="pl-pds">'</span></span>)
<span class="pl-k">assert</span> FieldHistory.objects.count() <span class="pl-k">==</span> <span class="pl-c1">1</span>

<span class="pl-c"># This object has some fields on it</span>
history <span class="pl-k">=</span> FieldHistory.objects.get()
<span class="pl-k">assert</span> history.object <span class="pl-k">==</span> pizza_order
<span class="pl-k">assert</span> history.field_name <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>status<span class="pl-pds">'</span></span>
<span class="pl-k">assert</span> history.field_value <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>ORDERED<span class="pl-pds">'</span></span>
<span class="pl-k">assert</span> history.date_created <span class="pl-k">is</span> <span class="pl-k">not</span> <span class="pl-c1">None</span>

<span class="pl-c"># You can query FieldHistory using the get_{field_name}_history()</span>
<span class="pl-c"># method added to your model</span>
histories <span class="pl-k">=</span> pizza_order.get_status_history()
<span class="pl-k">assert</span> <span class="pl-c1">list</span>(FieldHistory.objects.all()) <span class="pl-k">==</span> <span class="pl-c1">list</span>(histories)

<span class="pl-c"># Or using the custom FieldHistory manager</span>
histories2 <span class="pl-k">=</span> FieldHistory.objects.get_for_model_and_field(pizza_order, <span class="pl-s"><span class="pl-pds">'</span>status<span class="pl-pds">'</span></span>)
<span class="pl-k">assert</span> <span class="pl-c1">list</span>(histories) <span class="pl-k">==</span> <span class="pl-c1">list</span>(histories2)

<span class="pl-c"># Updating that particular field creates a new FieldHistory</span>
pizza_order.status <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>COOKING<span class="pl-pds">'</span></span>
pizza_order.save()
<span class="pl-k">assert</span> FieldHistory.objects.count() <span class="pl-k">==</span> <span class="pl-c1">2</span>

updated_history <span class="pl-k">=</span> histories.latest()
<span class="pl-k">assert</span> updated_history.object <span class="pl-k">==</span> pizza_order
<span class="pl-k">assert</span> updated_history.field_name <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>status<span class="pl-pds">'</span></span>
<span class="pl-k">assert</span> updated_history.field_value <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>COOKING<span class="pl-pds">'</span></span>
<span class="pl-k">assert</span> updated_history.date_created <span class="pl-k">is</span> <span class="pl-k">not</span> <span class="pl-c1">None</span></pre></div>
<a name="user-content-management-commands"/>
<h2><a id="user-content-management-commands" class="anchor" href="#management-commands" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Management Commands</h2>
<p>django-field-history comes with a few management commands.</p>
<a name="user-content-createinitialfieldhistory"/>
<h3><a id="user-content-createinitialfieldhistory" class="anchor" href="#createinitialfieldhistory" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>createinitialfieldhistory</h3>
<p>This command will inspect all of the models in your application and create <code>FieldHistory</code> objects for the models that have a <code>FieldHistoryTracker</code>. Run this the first time you install django-field-history.</p>
<pre>python manage.py createinitialfieldhistory
</pre>
<a name="user-content-renamefieldhistory"/>
<h3><a id="user-content-renamefieldhistory" class="anchor" href="#renamefieldhistory" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>renamefieldhistory</h3>
<p>Use this command after changing a model field name of a field you track with <code>FieldHistoryTracker</code>:</p>
<pre>python manage.py renamefieldhistory --model=app_label.model_name --from_field=old_field_name --to_field=new_field_name
</pre>
<p>For instance, if you have this model:</p>
<pre>class Person(models.Model):
    username = models.CharField(max_length=255)

    field_history = FieldHistoryTracker(['username'])
</pre>
<p>And you change the <code>username</code> field name to <code>handle</code>:</p>
<pre>class Person(models.Model):
    handle = models.CharField(max_length=255)

    field_history = FieldHistoryTracker(['handle'])
</pre>
<p>You will need to also update the <code>field_name</code> value in all <code>FieldHistory</code> objects that point to this model:</p>
<pre>python manage.py renamefieldhistory --model=myapp.Person --from_field=username --to_field=handle
</pre>
<a name="user-content-storing-which-user-changed-the-field"/>
<h2><a id="user-content-storing-which-user-changed-the-field" class="anchor" href="#storing-which-user-changed-the-field" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Storing Which User Changed the Field</h2>
<p>There are two ways to store the user that changed your model field. The simplest way is to use <strong>the logged in user</strong> that made the request. To do this, add the <code>FieldHistoryMiddleware</code> class to your <code>MIDDLEWARE_CLASSES</code> setting:</p>
<pre>MIDDLEWARE_CLASSES = (
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "field_history.middleware.FieldHistoryMiddleware",
)
</pre>
<p>Alternatively, you can add a <code>_field_history_user</code> property to the model that has fields you are tracking. This property should return the user you would like stored on <code>FieldHistory</code> when your field is updated.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-en">Pizza</span>(<span class="pl-e">models</span>.<span class="pl-e">Model</span>):
    name <span class="pl-k">=</span> models.CharField(<span class="pl-v">max_length</span><span class="pl-k">=</span><span class="pl-c1">255</span>)
    updated_by <span class="pl-k">=</span> models.ForeignKey(<span class="pl-s"><span class="pl-pds">'</span>auth.User<span class="pl-pds">'</span></span>)

    field_history <span class="pl-k">=</span> FieldHistoryTracker([<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>])

    <span class="pl-en">@</span><span class="pl-c1">property</span>
    <span class="pl-k">def</span> <span class="pl-en">_field_history_user</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        <span class="pl-k">return</span> <span class="pl-v">self</span>.updated_by</pre></div>
<a name="user-content-running-tests"/>
<h2><a id="user-content-running-tests" class="anchor" href="#running-tests" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Running Tests</h2>
<p>Does the code actually work?</p>
<pre>source &lt;YOURVIRTUALENV&gt;/bin/activate
(myenv) $ pip install -r requirements-test.txt
(myenv) $ python runtests.py
</pre>

</article>
  </div></body></html>