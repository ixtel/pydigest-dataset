<html><body><div><div class="post-body entry-content"><p>
By </p><a href="jugad2.blogspot.com/p/about-vasudev-ram.html">Vasudev Ram</a>
<a href=""/>
<p>
While browsing some Python posts on the Net, I saw one that made use of the </p><a href="https://docs.python.org/2/library/sys.html#sys._getframe">sys._getframe() function</a><p>. I had seen that function before, and remembered that it returns information about currently active </p><a href="https://en.wikipedia.org/wiki/Call_stack">stack frames</a><p>. So I looked up the docs for </p><b>sys._getframe()</b><p>, thinking that it might be possible to </p><b>use it within a function</b><p>, to </p><b>find that function's caller</b><p>. Turned out that it could. I also googled for terms like "</p><b>find the name of the calling function in python</b><p>", and found two relevant </p><b>Stack Overflow</b><p> (SO) posts:

</p><a href="http://stackoverflow.com/questions/900392/getting-the-caller-function-name-inside-another-function-in-python">Getting the caller function name inside another function in Python?</a>

<a href="http://stackoverflow.com/questions/2654113/python-how-to-get-the-callers-method-name-in-the-called-method">Python: How to get the caller's method name in the called method?</a>
<p>
It can be done by using either </p><b>inspect.stack()</b><p> or </p><b>sys._getframe()</b><p>. (The </p><a href="https://docs.python.org/2/library/inspect.html">inspect module</a><p> in Python's standard library supports that (finding a function's caller via stack frames), as well as some other useful introspection techniques.)
</p><p>
(I had blogged a couple of times about inspect, earlier, here:

</p><a href="http://jugad2.blogspot.in/2013/05/python-inspect-module-is-powerful.html">Python's inspect module is powerful</a>
<p>
and here:

</p><a href="http://jugad2.blogspot.in/2013/11/using-inspectgetargvalues-to-debug.html">Using inspect.getargvalues to debug Python programs</a>
<p>
)
</p><p>
So I tried out the SO code examples and slightly modified them to make these two small programs that print the name of the caller, and the caller's caller.
</p><p>
Here is the first program:
</p><pre>'''
File: find_callers.py
Run with: python find_callers.py
'''

import sys

def foo():
    print "I am foo, calling bar:"
    bar()

def bar():
    print "I am bar, calling baz:"
    baz()

def baz():
    print "I am baz:"
    caller = sys._getframe(1).f_code.co_name
    callers_caller = sys._getframe(2).f_code.co_name
    print "I was called from", caller
    print caller, "was called from", callers_caller

foo()
</pre><p>When run, this program outputs:
</p><pre>I am foo, calling bar:
I am bar, calling baz:
I am baz:
I was called from bar
bar was called from foo
</pre><p>
The second program is similar to the one above, except that, just for fun and to do it differently, I defined part of the overall </p><b>code expression as a string</b><p>, </p><b>interpolated</b><p> the argument (2 or 3) into it using </p><a href="https://docs.python.org/2/library/stdtypes.html#string-formatting">Python</a><p> string </p><a href="https://docs.python.org/2/library/string.html#formatstrings">formatting</a><p>, and then </p><a href="https://www.google.com/search?q=python+eval+function">eval()</a><p>'ed the resulting string. Note that since there is now an additional function call (eval), I had to change the arguments to sys._getframe() from </p><b>1 and 2</b><p> to </p><b>2 and 3</b><p>:
</p><pre># File: find_callers_with_eval.py
# Run with: python find_callers_with_eval.py

import sys

getframe_expr = 'sys._getframe({}).f_code.co_name'

def foo():
    print "I am foo, calling bar:"
    bar()

def bar():
    print "I am bar, calling baz:"
    baz()

def baz():
    print "I am baz:"
    caller = eval(getframe_expr.format(2))
    callers_caller = eval(getframe_expr.format(3))
    print "I was called from", caller
    print caller, "was called from", callers_caller

foo()
</pre><p>The output of this second program was identical to the first.
</p><p>
Note that the Python documentation says:
</p><p>
[ CPython implementation detail: This function should be used for internal and specialized purposes only. It is not guaranteed to exist in all implementations of Python. ]
</p><p>
Also, use eval() with care, and only on trusted code.

</p><p/><p>- </p><a href="http://jugad2.blogspot.in/p/about-vasudev-ram.html">Vasudev Ram - Online Python training and  programming</a> <p/><p>Dancing Bison Enterprises</p><p/><p/><b><a href="mailto:vasudevram@gmail.com?subject=Email%20me%20about%20your%20new%20products%20and%20services">Signup to hear about new products and services that I create.</a></b> <p/><a href="http://jugad2.blogspot.com/search/label/python">Posts about Python</a>  <a href="http://jugad2.blogspot.com/search/label/xtopdf">Posts about xtopdf</a> <p/>   
<p/>
</div>
</div></body></html>