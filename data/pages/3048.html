<html><body><div><body id="readabilityBody"><h2>Automating Pylint via Jenkins and Gerrit</h2>

<p>Static analysis and sticking to a style guide helps everyone stay on the same page, especially when your team comes from diverse code backgrounds. Choosing a static analysis and style guide is the easy part, of course--sticking to it is another story altogether.</p>

<p>To get everyone onboard, I integrated our Jenkins server with Gerrit to automatically run pylint (our choice for static analysis - not perfect, but it helps) on incoming reviews and post results. There're a handful of guides around the web that teach how to setup Jenkins to run a job on Gerrit events, but not a lot of information on custom messages back to Gerrit, or automating static analysis.</p>

<p>Let's get started.</p>

<h3>Integrating Jenkins and Gerrit</h3>

<p>Install plugins: Gerrit Trigger, GIT Plugin</p>

<h4>Configure Gerrit Trigger plugin:</h4>

<ol>
<li>Click 'Manage Jenkins' on the left at the Jenkins Dashboard</li>
<li>Click 'Gerrit Trigger'</li>
<li>Click 'Add New Server' on the left</li>
<li>Type in a name for your server, select 'Gerrit Server with Default Config' and click "Ok"</li>
<li>Fill out the fields with your Gerrit host information. </li>
<li>You'll need to copy over your Jenkins ssh key into Gerrit (and provide proper access rights in gerrit! 'Stream Events: ALLOW for Event Streaming Users')</li>
<li>Major parts to fill out: 'Hostname', 'Frontend URL', 'Username'</li>
<li>Click 'Test Connection'</li>
<li>If connection fails, try connecting via terminal to your gerrit host (using SSH).
<img src="http://i.imgur.com/QUM1zz0.png" alt=""/><br/></li>
</ol>

<h4>Configure your Jenkins Job to use Gerrit Trigger:</h4>

<ol>
<li>Create a new Jenkins Job</li>
<li>Under Source Code Management, select 'Git'</li>
<li>Set 'repository URL' to your Gerrit host, including your project
(<em>protocol</em>://<em>username</em>@<em>hostname</em>:<em>port</em>/<em>project</em>/<em>path</em>)
   ex: ssh://tester@gerrit<em>host:29418/Auto/automation</em>test</li>
<li>Select your credentials that you use to connect to gerrit (we use SSH)</li>
<li>Click 'Advanced'</li>
<li>Set 'Refspec' to '$GERRIT_REFSPEC'</li>
<li>Set 'Branch Specifier' to '$GERRIT_BRANCH'</li>
<li>Click 'Add', then select 'choosing strategy', and change it to 'Gerrit Trigger'
<img src="http://i.imgur.com/jmexAle.png" alt=""/><br/></li>
<li>Select 'Gerrit Event' as a Build Trigger</li>
</ol>

<h4>Under 'Gerrit Trigger' Section:</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">Still in the same jenkins job configuration
</code></pre></div>
<ol>
<li>Select your server you created earlier under 'Choose a Server'</li>
<li>Select 'Silent Mode'</li>
<li>Choose you want to trigger on (We use Patchset Created, excluding trivial rebases and 'no code changes'). 
<img src="http://i.imgur.com/tR08BFM.png" alt=""/></li>
<li>Beneath 'Dynamic Trigger Configuration' --- DO NOT SELECT THE CHECKBOX:
    Choose 'Path' On the left dropdown, in the box put '<strong>'. On the right, select 'Path' again,   and '</strong>' in the text box. 
<img src="http://i.imgur.com/AkzmSCV.png" alt=""/></li>
</ol>

<h4>In the Build section:</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">Use 'execute shell': 'gpylinter.py'
</code></pre></div>


<p>Lint is a python package to assist with automatic code reviews. It provides the following tools:</p>

<ol>
<li>Get a list of files changed between the active gerrit branch and the specified gerrit review.</li>
<li>Lint the original files in the active gerrit branch.</li>
<li>Checkout the current review ID</li>
<li>Lint the changed files. </li>
<li>Analyze the results according to specified validators.</li>
<li>Post the results of the validation to gerrit via SSH (+1/-1 score assigned, including a message). </li>
</ol>

<p>Lint uses the environmental variables set by Gerrit Trigger to do almost all of the configuration. You can still use it via command-line (with options!) for manual testing. </p>

<p>You can also add a checkers to validators, which are simple functions to compare lint data that are passed to the validator.</p>
</body></div></body></html>