<html><body><div><div class="entry-content">

                

                <p>В модуле <code>datetime</code> есть <code>now()</code> - метод, который возвращает текущее время. Применяется метод часто, например, создаем новую запись в базе данных - в лог пишем запись от текущего времени.</p>
<p>Вот только такой код оттестировать не всегда просто - иногда надо чтобы <code>now()</code> возвращал конкретное время.
Для этого случая есть <code>freezegun</code>:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">freezegun</span> <span class="kn">import</span> <span class="n">freeze_time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="nd">@freeze_time</span><span class="p">(</span><span class="s2">"2012-01-14"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>

<span class="c1"># Or a unittest TestCase - freezes for every test, from the start of setUpClass to the end of tearDownClass</span>

<span class="nd">@freeze_time</span><span class="p">(</span><span class="s2">"1955-11-12"</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_the_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1955</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

<span class="c1"># Or any other class - freezes around each callable (may not work in every case)</span>

<span class="nd">@freeze_time</span><span class="p">(</span><span class="s2">"2012-01-14"</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Tester</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_the_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
</pre></div>


<p>Ссылка на репозиторий: <a href="https://github.com/spulec/freezegun">https://github.com/spulec/freezegun</a></p>
            </div>
            
</div></body></html>