<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-typedecorator" class="anchor" href="#typedecorator" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Typedecorator</h1>

<p>A decorator-based implementation of type checks for Python.</p>

<p><a href="https://travis-ci.org/dobarkod/typedecorator?branch=master"><img src="https://camo.githubusercontent.com/271cff0b01c6c97fad0d67188ca74bf48bda4349/68747470733a2f2f7472617669732d63692e6f72672f646f6261726b6f642f747970656465636f7261746f722e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/dobarkod/typedecorator.svg?branch=master"/></a></p>

<p>Provides <code>@params</code>, <code>@returns</code> and <code>@void</code> decorators for describing
the type of the function arguments and return values. If the types mismatch,
an exception can be thrown, the mismatch can be logged, or it can be ignored.</p>

<p>Example:</p>

<pre><code>@returns({str: int})
@params(data={str: int}, key=str, val=int)
def add_to_data(data, key, val):
    data[key] = val
    return data
</code></pre>

<p>Works on Python 2.5+ and Python 3.2+.</p>

<h2><a id="user-content-quickstart" class="anchor" href="#quickstart" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Quickstart</h2>

<p>Install the package using pip:</p>

<pre><code>pip install typedecorator
</code></pre>

<p>You can now start using it in your code</p>

<pre><code># import the decorators and the typecheck setup function
from typedecorator import params, returns, setup_typecheck

# decorate your functions
@returns(int)
@params(a=int, b=int)
def add(a, b):
    return a + b

# set up the type checking
setup_typecheck()

add(1, 2)  # works fine
add('one', 2)  # will raise a TypeError
</code></pre>

<p>You ony need to call <code>setup_typecheck</code> once to enable it and optionally
configure exceptions thrown and logging level. You can use it multiple
time to change, disable, or re-enable typechecks at runtime. See the
Setup section for more information.</p>

<h2><a id="user-content-type-signatures" class="anchor" href="#type-signatures" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Type Signatures</h2>

<p>Both <code>@params</code> and <code>@returns</code> take type signatures that can describe both
simple and complex types. The <code>@void</code> decorator is a shorthand for
<code>@returns(type(None))</code>, describing a function returning nothing.</p>

<p>A type signature can be:</p>

<ol>
<li><p>A type, such as <code>int</code>, <code>str</code>, <code>bool</code>, <code>object</code>, <code>dict</code>, <code>list</code>, or a
custom class, requiring that the value be of specified type or a subclass of
the specified type. Since every type is a subclass of <code>object</code>, <code>object</code>
matches any type.</p></li>
<li><p>A list containing a single element, requiring that the value be a list of
values, all matching the type signature of that element. For example, a type
signature specifying a list of integers would be <code>[int]</code>.</p></li>
<li><p>A tuple containing one or more elements, requiring that the value be a tuple
whose elements match the type signatures of each element of the tuple. For
eample, type signature <code>(int, str, bool)</code> matches tuples whose first element
is an integer, second a string and third a boolean value.</p></li>
<li><p>A dictionary containing a single element, requiring that the value be a
dictionary with keys of type matching the dict key, and values of type
matching the dict value. For example, <code>{str:object}</code> describes a dictionary
with string keys, and anything as values.</p></li>
<li><p>A set containing a single element, requiring that the value be a set
with elements of type matching the set element. For example, <code>{str}</code> matches
any set consisting solely of strings.</p></li>
<li><p><code>xrange</code> (or <code>range</code> in Python 3), matching any iterable (including
generators and lists).</p></li>
<li><p>An instance of <code>typedecorator.Union</code>, requiring that the value be of any of
the types listed when creating the <code>Union</code> instance. For example,
<code>Union(int, str, type(None))</code> matches integers, strings and <code>None</code>.</p></li>
<li><p>An instance of <code>typedecorator.Nullable</code>, requiring that the value is either
of the type specified when creating the <code>Nullable</code> instance, or None. For
example, <code>Nullable(str)</code> matches strings and <code>None</code>.</p></li>
<li><p>A string containing the type name. This is useful in places where the
type is not yet available when the decorator is wrapping the function, for
example in method definitions (where class is not yet available)</p></li>
</ol>

<p>These rules are recursive, so it is possible to construct arbitrarily
complex type signatures. Here are a few examples:</p>

<ul>
<li><p><code>{str: (int, [MyClass])}</code> - dictionary with string keys, where values are
tuples with first element being an integer, and a second being a list
of instances of MyClass</p></li>
<li><p><code>{str: types.FunctionType}</code> - dictionary mapping strings to functions</p></li>
<li><p><code>{xrange}</code> - set of iterators</p></li>
<li><p><code>{str: Union(int, float)}</code> - dictionary mapping strings to values
that are either integers or floating point numbers</p></li>
<li><p><code>MyObject</code> - any type named <em>MyObject</em> (more precisely,
any type whose <code>__name__</code> attribute is equal to <code>MyObject</code>)</p></li>
</ul>

<p>Note that <code>[object]</code> is the same as <code>list</code>, <code>{object:object}</code> is the same
as <code>dict</code> and <code>{object}</code> is the same as  <code>set</code>.</p>

<h2><a id="user-content-setup" class="anchor" href="#setup" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Setup</h2>

<p>The function <code>setup_typecheck</code> takes care of enabling, disabling, and
configuring type checks at "compile" (parse) time and at runtime.</p>

<p>The function takes three optional arguments:</p>

<ul>
<li><code>enabled</code> - whether to enable checks of any kind (default: <code>True</code>)</li>
<li><code>exception</code> - which exception to raise if type check fails (default:
<code>TypeError</code>), or <code>None</code> to disable raising the exception</li>
<li><code>loglevel</code> - the log level at which to log the type error (see the
standard <code>logging</code> module for possible levels), or <code>None</code> to disable type
error logging.</li>
</ul>

<p>By default, the type checking system is inactive unless activated through
this function. However, the type-checking wrappers are in place, so the
type checking can be enabled or disabled at runtime (multiple times).
These wrappers do incur a very small but real performance cost. If you
want to disable the checks at "compile" time, call this function with
<code>enabled=False</code> <em>before</em> defining any functions or methods using the
typecheck decorator.</p>

<p>For example, if you have a <code>config.py</code> file with <code>USE_TYPECHECK</code> constant
specifying whether you want the type checks enabled:</p>

<pre><code>#!/usr/bin/env python

from typecheck import setup_typecheck, params
import config

setup_typecheck(enabled=config.USE_TYPECHECK)

@params(a=int, b=int):
def add(a, b):
    return a + b
</code></pre>

<p>Note that in this case, the checks cannot be enabled at runtime.</p>

<h2><a id="user-content-type-checking-methods" class="anchor" href="#type-checking-methods" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Type checking methods</h2>

<p>When using <code>@params</code> with instance methods, you should specify <code>object</code> as
the type of the <code>self</code> argument. This is required because when the decorator
is executing, the class itself still isn't created so the type that <code>self</code>
will have doesn't exist yet.</p>

<p>There is no problem in using a catch-all <code>object</code> type though, since Python
will enforce correct type for the instance upon method invocation anyways.</p>

<p>When using <code>@params</code> on a class method, there is no problem since the class
itself is instance of the <code>type</code> type.</p>

<p>But there's still a problem if a method takes additional parameters
that must be instances of the same class, or if it returns an instance of
the class. In this case, and in any other case where the type might not
be available at the time of decorator running, a string specifying the type
name can be used instead. Using strings should be avoided in other cases,
because they're more prone to type errors (the existence of the type is never
checked, the check only does a name match).</p>

<p>When combining type checking decorators with <code>@classmethod</code>, <code>@staticmethod</code>
or <code>@property</code> decorators, the type checking decorators must run first (ie.
be "closer" to the body of the function being defined).</p>

<p>Here's an example:</p>

<pre><code>class Accumulator(object):
    sum = 0

    @void
    @params(self=object, a=int)
    def add(self, a):
        self.sum = self.sum + a

    @classmethod
    @returns(int)
    @params(cls=type, a=int, b=int)
    def add2(cls, a, b):
        return a + b

    @property
    @returns(int)
    def total(self):
        return self.sum

    @returns('Accumulator')
    @params(self=object, other='Accumulator')
    def __add__(self, other):
        result = Accumulator()
        result.sum = self.sum + other.sum
        return result
</code></pre>

<h2><a id="user-content-mocking" class="anchor" href="#mocking" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Mocking</h2>

<p>Since the type signatures compare the actual value types, the parameters
can't be mocked. To minimize the problem, <code>Mock</code> type from <code>mock</code> library
(the most used mocking library in Python, and part of Python 3 standard
library) is special cased - an instance of <code>Mock</code> (or any of its subclasses,
such as <code>MagicMock</code>) will pass any check.</p>

<h2><a id="user-content-python-3-annotations" class="anchor" href="#python-3-annotations" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Python 3 annotations</h2>

<p>If used with Python 3, the parameters and return type signatures can also
be specified using the Python 3 function annotation syntax. To enable these,
use the <code>@typed</code> decorator on an annotated function. For example:</p>

<pre><code>@typed
def add_to_data(data: {str: int}, key: str, val: int) -&gt; {str: int}:
    data[key] = val
    return data
</code></pre>

<p>The behaviour is identical as if <code>@params</code> and <code>@returns</code> were used, the only
difference is in nicer syntax.</p>

<h2><a id="user-content-license" class="anchor" href="#license" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>License</h2>

<p>Copyright (C) 2014. Senko Rasic <a href="mailto:senko.rasic@goodcode.io">senko.rasic@goodcode.io</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</article>
  </div></body></html>