<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04.jpg"><img class="aligncenter wp-image-3399" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04.jpg" alt="mrz_output_04" srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04-300x236.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a></p>
<p>Today’s blog post wouldn’t be possible without <strong><a href="http://www.pyimagesearch.com/pyimagesearch-gurus/" target="_blank">PyImageSearch Gurus</a> </strong>member, Hans Boone. Hans is working on a computer vision project to automatically detect <a href="https://en.wikipedia.org/wiki/Machine-readable_passport" target="_blank">Machine-readable Zones</a> (MRZs) in passport images — <em>much like the region detected in the image above</em>.</p>
<p>The MRZ region in passports or travel cards fall into two classes: <em>Type 1 </em>and <em>Type 3</em>. Type 1 MRZs are three lines, with each line containing 30 characters. The Type 3 MRZ only has two lines, but each line contains 44 characters. In either case, the MRZ encodes identifying information of a given citizen, including the type of passport, passport ID, issuing country, name, nationality, expiration date, etc.</p>
<p>Inside the PyImageSearch Gurus course, Hans showed me his progress on the project and I immediately became interested. I’ve always wanted to apply computer vision algorithms to passport images (mainly just for fun), but lacked the dataset to do so. Given the personal identifying information a passport contains, I obviously couldn’t write a blog post on the subject and share the images I used to develop the algorithm.</p>
<p>Luckily, Hans agreed to share some of the sample/specimen passport images he has access to — <em>and I jumped at the chance to play with these images</em>.</p>
<p>Now, before we get to far, it’s important to note that these passports are not “real” in the sense that they can be linked to an actual human being. But they are <em>genuine</em> passports that were generated using fake names, addresses, etc. for developers to work with.</p>
<p>You might think that in order to detect the MRZ region of a passport that you need a bit of machine learning, perhaps using the <a href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">Linear SVM + HOG</a> framework to construct an “MRZ detector” — <em>but that would be overkill</em>.</p>
<p>Instead, we can perform MRZ detection using only <strong><em>basic image processing techniques</em></strong> such as <i>thresholding</i>, <em>morphological operations</em>, and <em>contour properties</em>. In the remainder of this blog post, I’ll detail my own take on how to apply these methods to detect the MRZ region of a passport.</p>

<h2>Detecting machine-readable zones in passport images</h2>
<p>Let’s go ahead and get this project started. Open up a new file, name it 
			<span id="crayon-56d58fbe11e6e654556953" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect_mrz</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> , and insert the following code:</p>

		<div id="crayon-56d58fbe11e7a858560959" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e7a858560959-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">imutils </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">paths</span></p><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">numpy </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">np</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e7a858560959-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">imutils</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e7a858560959-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e7a858560959-8"><span class="crayon-c"># construct the argument parse and parse the arguments</span></p><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-9"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e7a858560959-10"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-i"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--images"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"path to images directory"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-11"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e7a858560959-12"> </p><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-13"><span class="crayon-c"># initialize a rectangular and square structuring kernel</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e7a858560959-14"><span class="crayon-v">rectKernel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">getStructuringElement</span><span class="crayon-sy">(</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">MORPH_RECT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">13</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11e7a858560959-15"><span class="crayon-v">sqKernel</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">getStructuringElement</span><span class="crayon-sy">(</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">MORPH_RECT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">21</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">21</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 2-6</strong> import our necessary packages. I’ll assume you already have OpenCV installed. You’ll also need <a href="https://github.com/jrosebr1/imutils" target="_blank">imutils</a>, my collection of convenience functions to make basic image processing operations with OpenCV easier. You can install 
			<span id="crayon-56d58fbe11e7f653394074" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">imutils</span></span></span>  using 
			<span id="crayon-56d58fbe11e83806925194" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pip</span></span></span> :</p>

		

<p>From there, <strong>Lines 9-11</strong> handle parsing our command line argument. We only need a single switch here, 
			<span id="crayon-56d58fbe11e8a979481197" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">images</span></span></span> , which is the path to the directory containing the passport images we are going to process.</p>
<p>Finally, <strong>Lines 14 and 15</strong> initialize two kernels which we’ll later use when applying <em>morphological operations</em>, specifically the <em>closing operation</em>. For the time being, simply note that the first kernel is rectangular with a width approximately <em>3x</em> larger than the height. The second kernel is square. These kernels will allow us to close gaps between MRZ characters and openings between MRZ lines.</p>
<p>Now that our command line arguments are parsed, we can start looping over each of the images in our dataset and process them:</p>

		<div id="crayon-56d58fbe11e8e998648233" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58fbe11e8e998648233-17"><span class="crayon-c"># loop over the input image paths</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e8e998648233-18"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">imagePath </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">paths</span><span class="crayon-sy">.</span><span class="crayon-e">list_images</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"images"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d58fbe11e8e998648233-19"><span class="crayon-h">	</span><span class="crayon-c"># load the image, resize it, and convert it to grayscale</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e8e998648233-20"><span class="crayon-h">	</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">imagePath</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11e8e998648233-21"><span class="crayon-h">	</span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">resize</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-o">=</span><span class="crayon-cn">600</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e8e998648233-22"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11e8e998648233-23"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e8e998648233-24"><span class="crayon-h">	</span><span class="crayon-c"># smooth the image using a 3x3 Gaussian, then apply the blackhat</span></p><p class="crayon-line" id="crayon-56d58fbe11e8e998648233-25"><span class="crayon-h">	</span><span class="crayon-c"># morphological operator to find dark regions on a light background</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e8e998648233-26"><span class="crayon-h">	</span><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">GaussianBlur</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11e8e998648233-27"><span class="crayon-h">	</span><span class="crayon-v">blackhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">morphologyEx</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">MORPH_BLACKHAT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rectKernel</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Lines 20 and 21</strong> loads our original image from disk and resizes it to have a maximum height of 600 pixels. You can see an example of an original image below:</p>
<div id="attachment_3400" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_original.jpg"><img class="wp-image-3400" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_original.jpg" alt="Figure 1: Our original passport image that we are trying to detect the MRZ in."/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Our original passport image that we are trying to detect the MRZ in.</p></div>
<p>Gaussian blurring is applied on <strong>Line 26</strong> to reduce high frequency noise. We then apply a <em>blackhat morphological operation</em> to the blurred, grayscale image on <strong>Line 27</strong>.</p>
<p>A blackhat operator is used to reveal <em>dark regions</em> (i.e., MRZ text) against <em>light backgrounds</em> (i.e., the background of the passport itself). Since the passport text is always black on a light background (at least in terms of this dataset), a blackhat operation is appropriate. Below you can see the output of applying the blackhat operator:</p>
<div id="attachment_3404" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_blackhat.jpg"><img class="wp-image-3404" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_blackhat.jpg" alt="Figure 2: Applying the blackhat morphological operator reveals the black MRZ text against the light passport background."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Applying the blackhat morphological operator reveals the black MRZ text against the light passport background.</p></div>
<p>The next step in MRZ detection is to compute the gradient magnitude representation of the blackhat image using the Scharr operator:</p>

		<div id="crayon-56d58fbe11e94609288773" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58fbe11e94609288773-29"><span class="crayon-h">	</span><span class="crayon-c"># compute the Scharr gradient of the blackhat image and scale the</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e94609288773-30"><span class="crayon-h">	</span><span class="crayon-c"># result into the range [0, 255]</span></p><p class="crayon-line" id="crayon-56d58fbe11e94609288773-31"><span class="crayon-h">	</span><span class="crayon-v">gradX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">Sobel</span><span class="crayon-sy">(</span><span class="crayon-v">blackhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ddepth</span><span class="crayon-o">=</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CV_32F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dx</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dy</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ksize</span><span class="crayon-o">=</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e94609288773-32"><span class="crayon-h">	</span><span class="crayon-v">gradX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">absolute</span><span class="crayon-sy">(</span><span class="crayon-v">gradX</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11e94609288773-33"><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">minVal</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxVal</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">min</span><span class="crayon-sy">(</span><span class="crayon-v">gradX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">max</span><span class="crayon-sy">(</span><span class="crayon-v">gradX</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e94609288773-34"><span class="crayon-h">	</span><span class="crayon-v">gradX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">gradX</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">minVal</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">maxVal</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">minVal</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">"uint8"</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Here we compute the <a href="https://en.wikipedia.org/wiki/Sobel_operator#Alternative_operators" target="_blank">Scharr gradient</a> along the <em>x</em>-axis of the <b><i>blackhat</i></b> image, revealing regions of the image that are not only <em>dark against a light background</em>, but also contain <em>vertical changes in the gradient</em>, such as the MRZ text region. We then take this gradient image and scale it back into the range <em>[0, 255]</em> using min/max scaling:</p>
<div id="attachment_3405" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_gradient_x.jpg"><img class="wp-image-3405" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_gradient_x.jpg" alt="Figure 3: Applying Scharr operator to our blackhat image reveals regions that contain strong vertical changes in gradient."/></a><p class="wp-caption-text"><strong>Figure 3:</strong> Applying Scharr operator to our blackhat image reveals regions that contain strong vertical changes in gradient.</p></div>
<p>While it isn’t entirely obvious why we apply this step, I will say that it’s <em>extremely helpful</em> in reducing false-positive MRZ detections. Without it, we can accidentally mark embellished or designed regions of the passport as the MRZ. I will leave this as an exercise to you to verify that computing the gradient of the blackhat image can improve MRZ detection accuracy.</p>
<p>The next step is to try to detect the actual <em>lines</em> of the MRZ:</p>

		<div id="crayon-56d58fbe11e9a772762915" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e9a772762915-36"><span class="crayon-h">	</span><span class="crayon-c"># apply a closing operation using the rectangular kernel to close</span></p><p class="crayon-line" id="crayon-56d58fbe11e9a772762915-37"><span class="crayon-h">	</span><span class="crayon-c"># gaps in between letters -- then apply Otsu's thresholding method</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11e9a772762915-38"><span class="crayon-h">	</span><span class="crayon-v">gradX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">morphologyEx</span><span class="crayon-sy">(</span><span class="crayon-v">gradX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">MORPH_CLOSE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rectKernel</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11e9a772762915-39"><span class="crayon-h">	</span><span class="crayon-v">thresh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">threshold</span><span class="crayon-sy">(</span><span class="crayon-v">gradX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">THRESH_BINARY</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">THRESH_OTSU</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>First, we apply a <em>closing operation</em> using our rectangular kernel. This closing operation is meant to close gaps in between MRZ characters. We then apply thresholding using <a href="https://en.wikipedia.org/wiki/Otsu%27s_method" target="_blank">Otsu’s method</a> to automatically threshold the image:</p>
<div id="attachment_3406" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_horizontal_closing.jpg"><img class="wp-image-3406" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_horizontal_closing.jpg" alt="Figure 4: Applying a closing operation using a rectangular kernel (that is wider than it is tall) to close gaps in between the MRZ characters"/></a><p class="wp-caption-text"><strong>Figure 4:</strong> Applying a closing operation using a rectangular kernel (that is wider than it is tall) to close gaps in between the MRZ characters</p></div>
<p>As we can see from the figure above, each of the MRZ lines is present in our threshold map.</p>
<p>The next step is to close the gaps between the actual lines, giving us one large rectangular region that corresponds to the MRZ:</p>

		<div id="crayon-56d58fbe11ea0200586140" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58fbe11ea0200586140-41"><span class="crayon-h">	</span><span class="crayon-c"># perform another closing operation, this time using the square</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11ea0200586140-42"><span class="crayon-h">	</span><span class="crayon-c"># kernel to close gaps between lines of the MRZ, then perform a</span></p><p class="crayon-line" id="crayon-56d58fbe11ea0200586140-43"><span class="crayon-h">	</span><span class="crayon-c"># series of erosions to break apart connected components</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11ea0200586140-44"><span class="crayon-h">	</span><span class="crayon-v">thresh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">morphologyEx</span><span class="crayon-sy">(</span><span class="crayon-v">thresh</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">MORPH_CLOSE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sqKernel</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11ea0200586140-45"><span class="crayon-h">	</span><span class="crayon-v">thresh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">erode</span><span class="crayon-sy">(</span><span class="crayon-v">thresh</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-o">=</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Here we perform another closing operation, this time using our square kernel. This kernel is used to close gaps between the individual lines of the MRZ, giving us one large region that corresponds to the MRZ. A series of erosions  are then performed to break apart connected components that may have been joined during the closing operation. These erosions are also helpful in removing small blobs that are irrelevant to the MRZ.</p>
<div id="attachment_3407" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_vertical_closing.jpg"><img class="wp-image-3407" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_vertical_closing.jpg" alt="Figure 5: A second closing operation is performed, this time using a square kernel to close the gaps in between individual MRZ lines."/></a><p class="wp-caption-text"><strong>Figure 5:</strong> A second closing operation is performed, this time using a square kernel to close the gaps in between individual MRZ lines.</p></div>
<p>For some passport scans, the border of the passport may have become attached to the MRZ region during the closing operations. To remedy this, we set 5% of the left and right borders of the image to zero (i.e., black):</p>

		<div id="crayon-56d58fbe11ea6545510620" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58fbe11ea6545510620-47"><span class="crayon-h">	</span><span class="crayon-c"># during thresholding, it's possible that border pixels were</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11ea6545510620-48"><span class="crayon-h">	</span><span class="crayon-c"># included in the thresholding, so let's set 5% of the left and</span></p><p class="crayon-line" id="crayon-56d58fbe11ea6545510620-49"><span class="crayon-h">	</span><span class="crayon-c"># right borders to zero</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11ea6545510620-50"><span class="crayon-h">	</span><span class="crayon-v">p</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11ea6545510620-51"><span class="crayon-h">	</span><span class="crayon-v">thresh</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">p</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11ea6545510620-52"><span class="crayon-h">	</span><span class="crayon-v">thresh</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">p</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>You can see the output of our border removal below.</p>
<div id="attachment_3408" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_border_removal.jpg"><img class="wp-image-3408" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_border_removal.jpg" alt="Figure 6: Setting 5% of the left and right border pixels to zero, ensuring that the MRZ region is not attached to the scanned margin of the passport."/></a><p class="wp-caption-text"><strong>Figure 6:</strong> Setting 5% of the left and right border pixels to zero, ensuring that the MRZ region is not attached to the scanned margin of the passport.</p></div>
<p>Compared to <strong>Figure 5</strong> above, you can now see that the border has been removed.</p>
<p>The last step is to find the contours in our thresholded image and use contour properties to identify the MRZ:</p>

		<div id="crayon-56d58fbe11eac418601367" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-54">54</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-55">55</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-56">56</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-57">57</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-58">58</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-59">59</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-60">60</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-61">61</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-62">62</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-63">63</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-64">64</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-65">65</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-66">66</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-67">67</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-68">68</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-69">69</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-70">70</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-71">71</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-72">72</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-73">73</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-74">74</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-75">75</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-76">76</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-77">77</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-78">78</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-79">79</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-80">80</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-81">81</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-82">82</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-83">83</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-84">84</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-85">85</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-86">86</p><p class="crayon-num" data-line="crayon-56d58fbe11eac418601367-87">87</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d58fbe11eac418601367-88">88</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-54"><span class="crayon-h">	</span><span class="crayon-c"># find contours in the thresholded image and sort them by their</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-55"><span class="crayon-h">	</span><span class="crayon-c"># size</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-56"><span class="crayon-h">	</span><span class="crayon-v">cnts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">findContours</span><span class="crayon-sy">(</span><span class="crayon-v">thresh</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">RETR_EXTERNAL</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-57"><span class="crayon-h">		</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CHAIN_APPROX_SIMPLE</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-58"><span class="crayon-h">	</span><span class="crayon-v">cnts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">sorted</span><span class="crayon-sy">(</span><span class="crayon-v">cnts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">contourArea</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">reverse</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-59"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-60"><span class="crayon-h">	</span><span class="crayon-c"># loop over the contours</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-61"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cnts</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-62"><span class="crayon-h">		</span><span class="crayon-c"># compute the bounding box of the contour and use the contour to</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-63"><span class="crayon-h">		</span><span class="crayon-c"># compute the aspect ratio and coverage ratio of the bounding box</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-64"><span class="crayon-h">		</span><span class="crayon-c"># width to the width of the image</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-65"><span class="crayon-h">		</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">boundingRect</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-66"><span class="crayon-h">		</span><span class="crayon-v">ar</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-67"><span class="crayon-h">		</span><span class="crayon-v">crWidth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-68"> </p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-69"><span class="crayon-h">		</span><span class="crayon-c"># check to see if the aspect ratio and coverage width are within</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-70"><span class="crayon-h">		</span><span class="crayon-c"># acceptable criteria</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-71"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ar</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">crWidth</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0.75</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-72"><span class="crayon-h">			</span><span class="crayon-c"># pad the bounding box since we applied erosions and now need</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-73"><span class="crayon-h">			</span><span class="crayon-c"># to re-grow it</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-74"><span class="crayon-h">			</span><span class="crayon-v">pX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.03</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-75"><span class="crayon-h">			</span><span class="crayon-v">pY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.03</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-76"><span class="crayon-h">			</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">pX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">pY</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-77"><span class="crayon-h">			</span><span class="crayon-sy">(</span><span class="crayon-k ">w</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">pX</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">pY</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-78"> </p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-79"><span class="crayon-h">			</span><span class="crayon-c"># extract the ROI from the image and draw a bounding box</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-80"><span class="crayon-h">			</span><span class="crayon-c"># surrounding the MRZ</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-81"><span class="crayon-h">			</span><span class="crayon-v">roi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">[</span><span class="crayon-v">y</span><span class="crayon-o">:</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-82"><span class="crayon-h">			</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">rectangle</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-83"><span class="crayon-h">			</span><span class="crayon-st">break</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-84"> </p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-85"><span class="crayon-h">	</span><span class="crayon-c"># show the output images</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-86"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d58fbe11eac418601367-87"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"ROI"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">roi</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d58fbe11eac418601367-88"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On <strong>Line 56 and 57</strong> we compute the contours (i.e., outlines) of our thresholded image. We then take these contours and sort them based on their size in descending order (implying that the <em>largest contours</em> are <em>first</em> in the list).</p>
<p>On <strong>Line 61</strong> we start looping over our sorted list of contours. For each of these contours, we’ll compute the bounding box (<strong>Line 65</strong>) and use it to compute two properties: the <em>aspect ratio</em> and the <em>coverage ratio</em>. The aspect ratio is simply the width of the bounding box divided by the height. The coverage ratio is the width of the bounding box divided by the width of the actual image.</p>
<p>Using these two properties we can make a check on <strong>Line 71</strong> to see if we are examining the MRZ region. The MRZ is rectangular, with a width that is much larger than the height. The MRZ should also span at least 75% of the input image.</p>
<p>Provided these two cases hold,<strong> Lines 72-82</strong> use the <em>(x, y)</em>-coordinates of the bounding box to extract the MRZ and draw the bounding box on our input image.</p>
<p>Finally, <strong>Lines 86-88</strong> display our results.</p>
<h2>Results</h2>
<p>To see our MRZ detector in action, just execute the following command:</p>

		<div id="crayon-56d58fbe11eb3529866065" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d58fbe11eb3529866065-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">detect_mrz</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">images </span><span class="crayon-v">examples</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Below you can see of an example of a successful MRZ detection, with the MRZ outlined in green:</p>
<div id="attachment_3399" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04.jpg"><img class="wp-image-3399" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04.jpg" alt="Figure 7: On the left, we have our input image. And on the right, we have the MRZ region that has been successfully detected." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04-300x236.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_04.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 7:</strong> On the <em>left</em>, we have our input image. And on the <em>right</em>, we have the MRZ region that has been successfully detected.</p></div>
<p>Here is another example of detecting the Machine-readable Zone in a passport image using Python and OpenCV:</p>
<div id="attachment_3409" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_01.jpg"><img class="wp-image-3409" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_01.jpg" alt="Figure 8: Applying MRZ detection to a scanned passport." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_01-300x233.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_01.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 8:</strong> Applying MRZ detection to a scanned passport.</p></div>
<p>It doesn’t matter if the MRZ region is at the top or the bottom of the image. By applying morphological operations, extracting contours, and computing contour properties, we are able to extract the MRZ without a problem.</p>
<p>The same is true for the following image:</p>
<div id="attachment_3410" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_02.jpg"><img class="wp-image-3410" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_02.jpg" alt="Figure 9: Detecting machine-readable zones in images using computer vision." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_02-300x238.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_02.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 9:</strong> Detecting machine-readable zones in images using computer vision.</p></div>
<p>Let’s give another image a try:</p>
<div id="attachment_3411" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_03.jpg"><img class="wp-image-3411" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_03.jpg" alt="Figure 10: Again, we are able to detect the MRZ in the passport scan using basic image processing techniques." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_03-300x236.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_03.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 10:</strong> Again, we are able to detect the MRZ in the passport scan using basic image processing techniques.</p></div>
<p>Up until now we have only seen Type 1 MRZs that contain three lines. However, our method works just as well with Type 3 MRZs that contain only two lines:</p>
<div id="attachment_3412" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_05.jpg"><img class="wp-image-3412" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_05.jpg" alt="Figure 11: Detecting the MRZ in a Type 3 passport image using Python and OpenCV." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_05-300x226.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_05.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 11:</strong> Detecting the MRZ in a Type 3 passport image using Python and OpenCV.</p></div>
<p>Here’s another example of detecting a Type 3 MRZ:</p>
<div id="attachment_3413" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_06.jpg"><img class="wp-image-3413" src="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_06.jpg" alt="Figure 12: Applying computer vision and image processing to detect machine-readable zones in images." srcset="http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_06-300x224.jpg 300w, http://www.pyimagesearch.com/wp-content/uploads/2015/11/mrz_output_06.jpg 1000w" sizes="(max-width: 600px) 100vw, 600px"/></a><p class="wp-caption-text"><strong>Figure 12:</strong> Applying computer vision and image processing to detect machine-readable zones in images.</p></div>
<h2>Summary</h2>
<p>In this blog post we learned how to detect Machine-readable Zones (MRZs) in passport scans using only basic image processing techniques, namely:</p>
<ul>
<li>Thresholding.</li>
<li>Gradients.</li>
<li>Morphological operations (specifically, <em>closings</em> and <em>erosions</em>).</li>
<li>Contour properties.</li>
</ul>
<p>These operations, while simple, allowed us to detect the MRZ regions in images <em>without</em> having to rely on more advanced feature extraction and machine learning methods such as <a href="http://www.pyimagesearch.com/2014/11/10/histogram-oriented-gradients-object-detection/" target="_blank">Linear SVM + HOG</a> for object detection.</p>
<p>Remember, when faced with a challenging computer vision problem — <strong><em>always consider the problem and your assumptions!</em></strong><em> </em>As this blog post demonstrates, you might be surprised what basic image processing functions used in tandem can accomplish.</p>
<p>Once again, a big thanks to <strong><a href="http://www.pyimagesearch.com/pyimagesearch-gurus/" target="_blank">PyImageSearch Gurus</a></strong> member, Hans Boone, who supplied us with these example passport images! Thanks Hans!</p>
<h2 id="post_downloads">Downloads:</h2>

	</section>
	</div></body></html>