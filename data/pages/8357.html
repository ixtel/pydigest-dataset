<html><body><div><div>
    <p><img alt="Django admin is, you know, magic" src="./images/django-pony.png"/></p>


<p>This writing is inspired by a comment on Reddit concerning my <a href="./when-you-shouldnt-use-the-django-admin.html">recent post</a>:</p>
<blockquote>
<p><span class="dquo">“</span>The problem is that everyone I speak to seems to think the opposite - that
the admin is super-limited, inflexible and hard to customize.”</p>
<p>— <cite><a href="https://www.reddit.com/r/django/comments/3sfg0x/when_you_shouldnt_use_the_django_admin/">andybak</a> on Reddit</cite></p>
</blockquote>
<p>I’m about to break this prejudice right now. The Django admin is a really
brilliant piece of software, which can significantly speed up your development.</p>
<p>Here are some tips about the Django admin, which I’ve found to be quite useful.</p>


<p><small>
(A bit of terminology for those of us who isn’t that familiar with the Django admin)</small></p>
<blockquote>
<p><strong>Changeform</strong> is the page where you can edit the object.</p>
<p><strong>Changelist</strong> is the page which lists all objects of specific kind. You can filter and execute actions on the subset of objects. Clicking on the object in the changelist usually gets you to that object’s changeform.
</p>
</blockquote>
<p>To make the tips more practical, let’s try to solve some almost-real-life
problems. So say we have a simple site where visitors post pictures of cute
animals and leave comments on them. Should be quite popular, shouldn’t it?</p>
<h3>Tip #1: The Django admin is not just for Django sites</h3>
<p>While the admin interface plays very well with the rest of Django framework,
it’s very easy to use it with, say, the legacy database or the site which has
an awkward admin interface. And quite often it’s the best way of testing if
Django will suit your needs.</p>
<p>All you need is to:</p>
<ol>
<li>Create a new application in your Django project and make sure you’ve
   configured the connection to the legacy <span class="caps">DB</span> in your <code>DATABASES</code> setting.</li>
<li>Define your data tables as Django models. A pretty useful <code>manage.py
   inspectdb</code> command does exactly what its name implies: inpects the existing
   database and prints out the auto-generated Django models.</li>
<li>Create an <code>admin.py</code> file and put there, er, the admin stuff. More on this
   in a moment.</li>
</ol>
<p>Speaking of our animals’ site, it is written in <a href="https://en.wikipedia.org/wiki/Brainfuck">Brainf*ck</a>, so the admin
interface looks like… You know, not that good.  To fix it, we resembled
the database structure with several Django models and put together a simple
admin interface:</p>
<div class="highlight"><pre><span class="c"># models.py</span>
<span class="k">class</span> <span class="nc">Picture</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">DOG</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">CAT</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ANIMAL_KIND_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">DOG</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">),</span>
        <span class="p">(</span><span class="n">CAT</span><span class="p">,</span> <span class="s">'cat'</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'pictures'</span><span class="p">)</span>
    <span class="n">animal_kind</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">ANIMAL_KIND_CHOICES</span><span class="p">)</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">'animals'</span><span class="p">)</span>
    <span class="n">is_promoted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'comments'</span><span class="p">)</span>
    <span class="n">picture</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Picture</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'comments'</span><span class="p">)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">editors_note</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

<span class="c"># admin.py</span>
<span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'photo'</span><span class="p">,</span> <span class="s">'animal_kind'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'is_promoted'</span><span class="p">,</span> <span class="p">)</span>


<span class="k">class</span> <span class="nc">AuthorAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="p">)</span>


<span class="k">class</span> <span class="nc">CommentAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'picture'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="p">)</span>
</pre></div>


<h3>Tip #2: Filter your data the way you like</h3>
<p>A lot of people use the Django admin’s ability to filter on specific fields.
You know, put a field name to the <code>list_filter</code> attribute and here we go. But it’s
also extremely easy to create a custom filters!</p>
<p>Suppose eventually you decide to promote all the authors having 100+ posts.
But how do we distinguish them? Let’s create a filter and add it to the our changelist.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ProductiveAuthorsFilter</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">SimpleListFilter</span><span class="p">):</span>
    <span class="n">parameter_name</span> <span class="o">=</span> <span class="s">'is_productive'</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">'Productive author'</span>
    <span class="n">YES</span><span class="p">,</span> <span class="n">NO</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>

    <span class="c"># Number of comments for an author to be considered a productive one</span>
    <span class="n">THRESHOLD</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">lookups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">model_admin</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">YES</span><span class="p">,</span> <span class="s">'yes'</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NO</span><span class="p">,</span> <span class="s">'no'</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Count</span><span class="p">(</span><span class="s">'comments'</span><span class="p">))</span>

        <span class="c"># Note the syntax. This way we avoid touching the queryset if our</span>
        <span class="c"># filter is not used at all.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">YES</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">comments__count__gte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">THRESHOLD</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">comments__count__lt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">THRESHOLD</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">queryset</span>


<span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filters</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ProductiveAuthorsFilter</span><span class="p">]</span>
</pre></div>


<p>Now we can easily select our core authors. How do we actually promote them then?
Let’s move on to the next section.</p>
<h3>Tip #3: Put the common stuff to ‘actions’</h3>
<p>This one is a true godsend for content managers. Remember the ‘actions’ toolbox
at the top of each model’s list? It would be very handy if we select some
pictures and make them “promoted” with a single click, right? Let’s
implement it:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s">'promote'</span><span class="p">,</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">promote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="n">queryset</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">is_promoted</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'The posts are promoted'</span><span class="p">)</span>
    <span class="n">promote</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">'Promote the pictures'</span>
</pre></div>


<p>And that’s it! No longer opening each form one by one! Plus, it’s quite easy
to extend our action further, adding, for example, an intermediate form. Django
docs have an <a href="https://docs.djangoproject.com/en/1.8/ref/contrib/admin/actions/#actions-that-provide-intermediate-pages">excellent section</a> on this.</p>
<h3>Tip #4: Search on all fields you need</h3>
<p>Okay, filters are cool but let’s focus a bit on the search facility. In almost all
installations I’ve seen the search box is used for searching across one model’s
fields. But the Django search really shines when you realize it can handle the
relationships. So assume we want it to search in pictures’ titles, authors’
names and comments’ texts. How do we achieve that?</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'author__name'</span><span class="p">,</span> <span class="s">'comments__text'</span><span class="p">,</span> <span class="p">)</span>
</pre></div>


<p>Just don’t forget to add some full-text indices, if your database is big enough.</p>
<h3>Tip #5: View an object’s page – an easy way</h3>
<p>A very common need is to view the object’s public page on site. By default you
have to browse to the object’s form and then click on the “View on site” button.
That’s how to make it a bit easier:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_fields</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="s">'object_link'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">object_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s">u'&lt;a href="{url}"&gt;open&lt;/a&gt;'</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="n">object_link</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">'View on site'</span>
</pre></div>


<p>This snippet adds a “View on site” link to each object in the list. Here we
assume you’ve already implemented the <code>get_absolute_url()</code> method on your
model. If not - go ahead and do it, it’ll save you much time. And you’ll
probably want to move this snippet to a mixin, or a shared base admin class.</p>
<h3>Tip #6: Edit fields in-place right on the list page</h3>
<p>Suppose we need to put an editor’s note to each comment. And naturally enough,
we don’t want to open each comment’s changeform. To implement this, adjust your ModelAdmin a bit:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">CommentAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'picture'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'editors_note'</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">list_editable</span> <span class="o">=</span> <span class="p">(</span><span class="s">'editors_note'</span><span class="p">,</span> <span class="p">)</span>
</pre></div>


<p>That’s literally all. Now you can open a comments list, filter it down
to your needs, and start writing notes away.</p>
<h3>Tip #7: Customize your totals with the data you really need</h3>
<p>There’s a totals line at the bottom of each changelist. Imagine we’d like to
separate the counts of dogs’ and cats’ pics. This functionality will take a bit
more of code: we have to override the changelist itself, as well as the html
template (more on <a href="https://docs.djangoproject.com/en/1.9/ref/contrib/admin/#overriding-admin-templates">template overriding</a>).</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.admin.views.main</span> <span class="kn">import</span> <span class="n">ChangeList</span>

<span class="k">class</span> <span class="nc">PicturesChangeList</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ChangeList</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PicturesChangeList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">totals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_list</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
            <span class="n">dogs_count</span><span class="o">=</span><span class="n">Sum</span><span class="p">(</span><span class="n">Case</span><span class="p">(</span><span class="n">When</span><span class="p">(</span><span class="n">animal_kind</span><span class="o">=</span><span class="n">Picture</span><span class="o">.</span><span class="n">DOG</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">output_field</span><span class="o">=</span><span class="n">IntegerField</span><span class="p">())),</span>
            <span class="n">cats_count</span><span class="o">=</span><span class="n">Sum</span><span class="p">(</span><span class="n">Case</span><span class="p">(</span><span class="n">When</span><span class="p">(</span><span class="n">animal_kind</span><span class="o">=</span><span class="n">Picture</span><span class="o">.</span><span class="n">CAT</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">output_field</span><span class="o">=</span><span class="n">IntegerField</span><span class="p">())))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totals</span> <span class="o">=</span> <span class="n">totals</span>


<span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_changelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PicturesChangeList</span>
</pre></div>


<p>and the template:</p>
<div class="highlight"><pre>{% extends 'admin/change_list.html' %}
{% block result_list %}
    {{ block.super }}
    <span class="nt">&lt;p&gt;</span>
        There are
        <span class="nt">&lt;strong&gt;</span>
            {{ cl.totals.dogs_count|default:'none' }} dogs and
            {{ cl.totals.cats_count|default:'none' }} cats
        <span class="nt">&lt;/strong&gt;</span>
        on this page.
    <span class="nt">&lt;/p&gt;</span>
{% endblock %}
</pre></div>


<h3>Tip #8: Readonly admin interface for some of us</h3>
<p>Guess what? Your grandma wants to take a look at all these cuties, and she
loves the Django admin interface she watched over your shoulder. But you’re sure she
will ruin the whole site if there is a single button. Okay, let’s put together
the grandma-proof™ readonly admin interface (who’s said “databrowse”?):</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">GrandmaProofAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_readonly_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">'granny'</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">GrandmaProofAdmin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_readonly_fields</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">GrandmaProofAdmin</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>


<p>Now you can safely grant your granny the <code>change pictures</code> permission in order
to see the pictures list. Note that this solution surely will not suit any
serious usage - you’ll need to handle <a href="https://gist.github.com/aaugustin/1388243">some more cases</a>.</p>
<h3>Tip #9: Per-object custom actions</h3>
<p>Sometimes you want to execute a certain action on only one object. The
‘actions’ toolbox surely makes it possible, but ticking the object, selecting
the action, clicking on a button… There should be a more convenient way,
shouldn’t it? Let’s reduce all that stuff to actually clicking on a button.</p>
<p>This time we will be implementing another granny’s big idea. She’d like to send
an email to some authors, showing all her love.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_fields</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="s">'mail_link'</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">mail_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'admin:myapp_pictures_mail_author'</span><span class="p">,</span>
                       <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'pk'</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s">'&lt;a href="{url}"&gt;{title}&lt;/a&gt;'</span><span class="p">,</span>
                           <span class="n">url</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'send mail'</span><span class="p">)</span>
    <span class="n">mail_link</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">'Show some love'</span>
    <span class="n">mail_link</span><span class="o">.</span><span class="n">allow_tags</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">'^(?P&lt;pk&gt;\d+)/sendaletter/?$'</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">admin_site</span><span class="o">.</span><span class="n">admin_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail_view</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">'myapp_pictures_mail_author'</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">urls</span> <span class="o">+</span> <span class="nb">super</span><span class="p">(</span><span class="n">PictureAdmin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mail_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Picture</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'pk'</span><span class="p">])</span>
        <span class="n">send_mail</span><span class="p">(</span><span class="s">'Feel the granny</span><span class="se">\'</span><span class="s">s love'</span><span class="p">,</span> <span class="s">'Hey, she loves your pet!'</span><span class="p">,</span>
                  <span class="s">'granny@yoursite.com'</span><span class="p">,</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'The letter is on its way'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'admin:myapp_picture_changelist'</span><span class="p">))</span>
</pre></div>


<p>Hope now she’s happy. A link has appeared along each object’s fields, allowing
her to send a mail by simply clicking it.</p>
<h3>Bonus Tip: Reduce queries by adding a single line to your admin</h3>
<p>The most common tip about the Django admin (and Django in general) is
(worthily) the <code>select_related</code> stuff. Ok, ok, you all know it. Preload the
related objects by passing their names to the <code>list_select_related</code> ModelAdmin
attribute.  But did you know you haven’t to specify all your relations? Just
set it to <code>True</code>, and Django will automatically preload foreign objects:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">PictureAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_select_related</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<p>So guys, that’s it, hope you’ve liked it. Got any cool tips? Go ahead and share
your favorite ones in comments!</p>

  </div>
  </div></body></html>