<html><body><div><div class="content html_format"><p>
      Тема онлайн торгов (будь то форекс, акции, полезные ископаемые) обычно вызывает интерес. Но вместе с тем многие люди думают: «я в этом не разбираюсь, мне спец. терминология неизвестна. Да и непонятно, как начать». Вот над этим мы и поработаем! К концу статьи у вас будет достаточно знаний и примеров, чтобы начать играть на финансовых рынках. </p>
<p>
Покроем следующие моменты:
</p><ul>
<li>Суть биржевой игры;</li>
<li>Брокеры;</li>
<li>API для торговли/Пример робота;</li>
<li>Деплоймент онлайн;</li>
<li>Заключительные мысли.</li>
</ul>
<a name="habracut"/>
<h4>Суть биржевой игры</h4><p>
Есть много теорий и объяснений. Но мы подойдем к вопросу с точки зрения софтверщика и понятия об уровнях абстракции. Очень просто (но вместе с тем правдиво) суть игры в следующем: есть график некоей (псевдо?) случайной величины (цены). Известна её история за довольно большой период. Стоит задача предсказания движения (вверх или вниз). Всё. Реально. То, что делают трейдеры — предсказывают, пойдет цена вверх или вниз и делают на это ставки (оpen trades): покупают (buy/long) какое-то количество «продукта» (instrument) в надежде на поход вверх, или продают (sell/short) в надежде, что пойдет вниз.</p><p>
После какого-то времени (если цена изменилась значительно) open trades закрывают и получают в результате прибыть (угадали с движением) или убыток (не угадали).
</p><p>
Сделку можно закрыть руками, а можно автоматичеки (order): можно заранее задекларировать — если цена достигнет такого-то уровня, то закрыть trade.
</p><p>
Доступ к рынку для совершения сделок предоставляет брокер. И за это он взимают плату за каждую сделку.
</p><p>
Подкованные теорией, мы можем опять вернуться в область, далекую от финансов и сказать: хей! да мы же просто ищем сигнал в шуме! Сейчас по быстрому разложим в ряд Фурье, определим частоты и озолотимся!
</p><p>
Всё верно, так всё и есть. Игра началась.

</p><h4>Брокеры</h4><p>
Есть много брокеров, которые специализируются на частных лицах. Они отличают набором инструментов доступных для торгов, ценами на услуги, надежностью, возможность создания роботов.
</p><p>
Я не буду давать сравнительный анализ. Сразу дам лучшего — Oanda. Почему Oanda:

</p><ul>
<li> Репутация;</li>
<li> Возможность открыть сделку в 1 доллар и нет требований к размеру trade (некоторые брокеры обязывают делать его кратным большим величинам);</li>
<li> Низкая цена за сделки (узкий spread);</li>
<li> Огромное количество инструментов: валюты, драг металлы и нефть, индексы;</li>
<li> Возможность торговать через API;</li>
<li> Ввод вывод денег возможен через PayPal.</li>
</ul>
<p>
Для того, чтобы торговать, надо создать учетную запись на Oanda. Для начала — тренировочную (fxtrade practice). В меню «Manage API Access» нужно указать, что на вашем счету возможна торговля через API. После этого вам сгенерят секретный токен для использования в RESTful вызовах.

</p><h4>API для торговли</h4>
<img src="https://habrastorage.org/getpro/habr/post_images/95b/1d6/6c5/95b1d66c5f2bd76d676c787ae05c6865.jpg" alt="image"/>

<a href="http://developer.oanda.com/docs/">developer.oanda.com/docs</a><p> — RESTful </p><p>
Примеры: </p><a href="http://developer.oanda.com/docs/v1/code-samples/">developer.oanda.com/docs/v1/code-samples</a> 
<p>
Я буду использовать Python 2.7 и библиотеку </p><a href="http://docs.python-requests.org/en/latest/">requests</a><p>.
</p><p>
Для того, чтобы торговать, нам нужно:

</p><h5>Получать информацию о цене. Робот должен знать, что происходит</h5>
<pre><code class="python">def connect_to_stream():
    try:
        s = requests.Session()
        url = "https://stream-fxpractice.oanda.com/v1/prices"
        headers = {'Authorization' : 'Bearer ' + "YOUR TOKEN",
                   #'X-Accept-Datetime-Format' : 'unix'
                  }
        params = {'instruments' : "EUR_USD,AUD_JPY", 'accountId' : "YOUR ACC ID"}
        req = requests.Request('GET', url, headers = headers, params = params)
        pre = req.prepare()
        resp = s.send(pre, stream = True, verify = False, timeout=20)
        return resp
    except Exception as e:
        s.close()
        print "Caught exception when connecting to stream\n" + str(e) 
</code></pre>
<p>
Эта функция позволит соединиться к потоку цен на EUR/USD и AUD/JPY.
</p><p>
Теперь мы можем их считывать:

</p><pre><code class="python"> try: #infinite loop on receiving events about price. on each tick Strategy function is called
         for line in response.iter_lines(1):
             if line:
                 msg = json.loads(line)         
                 if msg.has_key("instrument") or msg.has_key("tick"): 
                       strategy(msg['tick']['instrument'], msg['tick']['time'], msg['tick']['ask'])
    except Exception as e:
         print "something gone bad " +str(e)
         return

</code></pre>

<h5>Теперь нам нужен мозг. Принятие решений</h5>
<img src="https://habrastorage.org/getpro/habr/post_images/512/175/0fb/5121750fbe6f6ee3684319d20fbc1132.jpg" alt="image"/>
<p>
Как видно, в функцию стратегии передается информация о названии инструмента, цена и время. </p><p>
Мы можем решать в функции </p><b>strategy</b><p>: а что нам делать с этой новой инфой? Проигнорировать? Или, может, открыть новую сделку?
</p><p>
Вот здесь пригодится, что вы — программист. Изобретайте! Есть числовой ряд — ищете закономерности, анализируйте, да всё, что угодно.
</p><p>
Допустим, робот подумал и сказал: точно цена пойдет вверх! Чувствую своей shiny metal ass!

</p><h5>Тогда нам нужна возможность заключить сделку</h5>
<pre><code class="python">def order(instr, take_profit, stop_loss):
    try:
         url = "https://" + "api-fxpractice.oanda.com" + "/v1/accounts/"+"YOUR ACC"+"/orders"
        
         headers = {'Authorization' : 'Bearer ' + "YOUR TOKEN",
                    #'X-Accept-Datetime-Format' : 'unix'
                    "Content-Type" : "application/x-www-form-urlencoded"
                  }
    
         params = urllib.urlencode({
                                    "instrument" : instr,           # инструмент, по которому открывает сделку
                                    "units" : 10,                       # сколько единиц покупаем
                                    "type" : 'market',                # прям сейчас исполнить!
                                    "side" : "buy",                     #  считаем, что цена пойдет вверх ("sell"  если думаем что вниз)
                                    "takeProfit" : take_profit     #   насколько цена должна пройти вверх, чтобы наша жадность удовлетворилась, и мы закрыли бы сделку. и считали профит
                                    "stopLoss" : stop_loss       # насколько цена может опуститься, прежде чем наш страх скажет "ты чё?!! дальше только хуже будет. закрывай немедля. фиг с ними с потерями"
                                    	})
                                	
         req =requests.post(url, data=params, headers=headers)
         for line in req.iter_lines(1):
          print "order responce: ", line
    except Exception as e:
         print "Caught exception when connecting to orders\n" + str(e) 

</code></pre>
<p>
Вот, в общем-то, и всё. Мы научились получать информацию о цене и, исходя из этого, открывать сделки с фиксированными целями.

</p><h4>Деплоймент онлайн</h4><p>
Открыл для себя наличие vps по бросовым ценам. Например, ftpit.com. Взял тот, что за 2 доллара в месяц.</p><p>
Этот хостиг без проблем держит на себе 3-х моих роботов, которые день и ночь пытаются одолеть толстосумов с Wall Street. Плюс к этому есть свой SMTP server и небольшой сайт.

</p><h4>Заключительные мысли</h4><p>
Торговля на финансовых рынках может стать замечательным хобби, которое не только дает возможность программировать, но и приобщиться к огромной онлайн игре, в которой каждый день много новостей, мнений, событий, страха, жадности и надежды!
</p><p>
Если у вас есть вопросы — отвечу с радостью и в меру сил.

</p><img src="https://habrastorage.org/getpro/habr/post_images/829/dea/8e2/829dea8e259fd18c232e19a17274b84a.gif" alt="image"/>

<h4>UPDATE</h4><p>
Очень рекомендую оставаться на practice account хотя бы 1 год</p><p>
не торопитесь вводить настоящие деньги</p><p>
если Вы будете видеть, что у вас прям «прёт» и все получается, то просто замониторьте счет вот здесь — </p><a href="http://www.forexfactory.com/trades.php">forexfactory.com</a><p>
если будет стабильный результат даже на демо счете — инвесторы сами вас будут искать и предлагать деньги в управление

</p><h4>UPDATE 2</h4><p>
Вспомнил кто еще любил сыграть на финасовых рынках — </p><a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BC%D0%BF%D0%B0%D0%BD%D0%B8%D1%8F_%D0%AE%D0%B6%D0%BD%D1%8B%D1%85_%D0%BC%D0%BE%D1%80%D0%B5%D0%B9">сэр Исаак Ньютон (тот самый :))</a>
      <p class="clear"/>
    </div>

    
  </div></body></html>