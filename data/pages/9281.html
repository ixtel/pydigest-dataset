<html><body><div><div class="entry-content clearfix"><p>About a year ago I began a job where building command-line applications was a common occurrence. At that time I had used <a href="https://docs.python.org/3/library/argparse.html">argparse</a> quite a bit and wanted to explore what other options were available. I found that the most popular alternatives available were <a href="http://click.pocoo.org/5/">click</a> and <a href="http://docopt.org/">docopt</a>. During my exploration I also found that other than each libraries “why use me” section there was not much available for a complete comparison of the three libraries. Now there is – this blog post!</p>









<p><em>This is a guest blog post by <a href="https://twitter.com/PurdonKyle">Kyle Purdon</a>​, an Application Engineer at <a href="https://bitly.com/pages/careers">Bitly</a> in Denver.</em></p>

<p>If you want to, you can head directly to the <a href="https://github.com/kpurdon/greeters">source</a> though it really won’t do much good without the comparisons and step-by-step construction presented in this article.</p>

<p>This article uses the following versions of the libraries:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python --version
</span><span class="line">Python 3.4.3
</span><span class="line"><span class="c"># argparse is a Python core library</span>
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>pip list <span class="p">|</span> grep click
</span><span class="line">click <span class="o">(</span>5.1<span class="o">)</span>
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>pip list <span class="p">|</span> grep docopt
</span><span class="line">docopt <span class="o">(</span>0.6.2<span class="o">)</span>
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>pip list <span class="p">|</span> grep invoke
</span><span class="line">invoke <span class="o">(</span>0.10.1<span class="o">)</span>
</span><span class="line"><span class="c"># ignore this for now, it's a special surprise for later!</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Command-Line.Example"/>
<h2>Command-Line Example</h2>

<p>The command-line application that we are creating will have the following interface:</p>

<p><code>python [file].py [command] [options] NAME</code></p>

<a name="Basic.Usage"/>
<h3>Basic Usage</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python <span class="o">[</span>file<span class="o">]</span>.py hello Kyle
</span><span class="line">Hello, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python <span class="o">[</span>file<span class="o">]</span>.py goodbye Kyle
</span><span class="line">Goodbye, Kyle!
</span></code></pre></td></tr></table></div></figure>


<a name="Usage.w..Options..Flags."/>
<h3>Usage w/ Options (Flags)</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python <span class="o">[</span>file<span class="o">]</span>.py hello --greeting<span class="o">=</span>Wazzup Kyle
</span><span class="line">Whazzup, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python <span class="o">[</span>file<span class="o">]</span>.py goodbye --greeting<span class="o">=</span>Later Kyle
</span><span class="line">Later, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python <span class="o">[</span>file<span class="o">]</span>.py hello --caps Kyle
</span><span class="line">HELLO, KYLE!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python <span class="o">[</span>file<span class="o">]</span>.py hello --greeting<span class="o">=</span>Wazzup --caps Kyle
</span><span class="line">WAZZUP, KYLE!
</span></code></pre></td></tr></table></div></figure>


<p>This article will compare each libraries method for implementing the following features:</p>

<ol>
<li>Commands (hello, goodbye)</li>
<li>Arguments (name)</li>
<li>Options/Flags (—greeting=&lt;str&gt;, —caps)</li>
</ol>


<p>Additional features:</p>

<ol>
<li>Version Printing (<code>-v/--version</code>)</li>
<li>Automated Help Messages</li>
<li>Error Handling</li>
</ol>


<p>As you would expect <em>argparse</em>, <em>docopt</em>, and <em>click</em> implement all of these features (as any complete command-line library would). This fact means that the actual implementation of these features is what we will compare. Each library takes a very different approach that lends to a very interesting comparison – <em>argparse=standard</em>, <em>docopt=docstrings</em>, <em>click=decorators</em>.</p>

<a name="Bonus.Sections"/>
<h2>Bonus Sections</h2>

<ol>
<li>I’ve been curious about using task-runner libraries like <a href="https://fabric.readthedocs.org/en/latest/">fabric</a> and it’s python3 replacement <a href="https://invoke.readthedocs.org/en/latest/">invoke</a> to create simple command-line interfaces, so I will try and put the same interface together with <em>invoke</em>.</li>
<li>A few extra steps are needed when packaging command-line applications, so I’ll cover those steps as well!</li>
</ol>


<a name="Commands"/>
<h2>Commands</h2>

<p>Let’s begin by setting up the basic skeleton (no arguments or options) for each library.</p>

<a name="Argparse"/>
<h3>Argparse</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">argparse</span>
</span><span class="line">
</span><span class="line"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="line"><span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="n">hello_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'goodbye'</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this we now have two commands (<code>hello</code> and <code>goodbye</code>) and a built-in help message. Notice that the help message changes when run as an option on the command hello.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python argparse/commands.py --help
</span><span class="line">usage: commands.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">{</span>hello,goodbye<span class="o">}</span> ...
</span><span class="line">
</span><span class="line">positional arguments:
</span><span class="line">  <span class="o">{</span>hello,goodbye<span class="o">}</span>
</span><span class="line">
</span><span class="line">optional arguments:
</span><span class="line">  -h, --help       show this <span class="nb">help </span>message and <span class="nb">exit</span>
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python argparse/commands.py hello --help
</span><span class="line">usage: commands.py hello <span class="o">[</span>-h<span class="o">]</span>
</span><span class="line">
</span><span class="line">optional arguments:
</span><span class="line">  -h, --help  show this <span class="nb">help </span>message and <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Docopt"/>
<h3>Docopt</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">"""Greeter.</span>
</span><span class="line">
</span><span class="line"><span class="sd">Usage:</span>
</span><span class="line"><span class="sd">  commands.py hello</span>
</span><span class="line"><span class="sd">  commands.py goodbye</span>
</span><span class="line"><span class="sd">  commands.py -h | --help</span>
</span><span class="line">
</span><span class="line"><span class="sd">Options:</span>
</span><span class="line"><span class="sd">  -h --help     Show this screen.</span>
</span><span class="line"><span class="sd">"""</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this we, again, have two commands (<code>hello</code>, <code>goodbye</code>) and a built-in help message. Notice that the help message <strong>DOES NOT</strong> change when run as an option on the <code>hello</code> command. In addition we <strong>do not</strong> need to explicitly specify the <code>commands.py -h | --help</code> in the <code>Options</code> section to get a help command. However, if we don’t they will not show up in the output help message as options.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/commands.py --help
</span><span class="line">Greeter.
</span><span class="line">
</span><span class="line">Usage:
</span><span class="line">  commands.py hello
</span><span class="line">  commands.py goodbye
</span><span class="line">  commands.py -h <span class="p">|</span> --help
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  -h --help     Show this screen.
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/commands.py hello --help
</span><span class="line">Greeter.
</span><span class="line">
</span><span class="line">Usage:
</span><span class="line">  commands.py hello
</span><span class="line">  commands.py goodbye
</span><span class="line">  commands.py -h <span class="p">|</span> --help
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  -h --help     Show this screen.
</span></code></pre></td></tr></table></div></figure>


<a name="Click"/>
<h3>Click</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">click</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@click.group</span><span class="p">()</span>
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="k">pass</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="k">pass</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="k">pass</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">greet</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this we now have two commands (<code>hello</code>, <code>goodbye</code>) and a built-in help message. Notice that the help message changes when run as an option on the <code>hello</code> command.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python click/commands.py --help
</span><span class="line">Usage: commands.py <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  --help  Show this message and exit.
</span><span class="line">
</span><span class="line">Commands:
</span><span class="line">  goodbye
</span><span class="line">  hello
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python click/commands.py hello --help
</span><span class="line">Usage: commands.py hello <span class="o">[</span>OPTIONS<span class="o">]</span>
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  --help  Show this message and exit.
</span></code></pre></td></tr></table></div></figure>


<p>Even at this point you can see that we have very different approaches to constructing a basic command-line application. Next let’s add the <em>NAME</em> argument, and the logic to ouput the result from each tool.</p>

<a name="Arguments"/>
<h2>Arguments</h2>

<p>In this section we will be adding new logic to the same code shown in the previous section. We’ll add comments to new lines stating their purpose. Arguments (aka positional arguments) are required inputs to a command-line application. In this case we are adding a required <code>name</code> argument so that the tool can greet a specific person.</p>

<a name="Argparse"/>
<h3>Argparse</h3>

<p>To add an argument to a subcommand we use the <code>add_argument</code> method. And in order to execute the correct logic, when a command is called, we use the <code>set_defaults</code> method to set a default function. Finally we execute the default function by calling <code>args.func(args)</code> after we parse the arguments at runtime.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">argparse</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, {0}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Goodbye, {0}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="line"><span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="n">hello_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>  <span class="c"># add the name argument</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">hello</span><span class="p">)</span>  <span class="c"># set the default function to hello</span>
</span><span class="line">
</span><span class="line"><span class="n">goodbye_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'goodbye'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">goodbye</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span class="line">    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>  <span class="c"># call the default function</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python argparse/arguments.py hello Kyle
</span><span class="line">Hello, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python argparse/arguments.py hello --help
</span><span class="line">usage: arguments.py hello <span class="o">[</span>-h<span class="o">]</span> name
</span><span class="line">
</span><span class="line">positional arguments:
</span><span class="line">  name
</span><span class="line">
</span><span class="line">optional arguments:
</span><span class="line">  -h, --help  show this <span class="nb">help </span>message and <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Docopt"/>
<h3>Docopt</h3>

<p>In order to add an option, we add a <code>&lt;name&gt;</code> to the docstring. The <code>&lt;&gt;</code> are used to designate a positional argument. In order to execute the correct logic we must check if the command (treated as an argument) is <code>True</code> at runtime <code>if arguments['hello']:</code>, then call the correct function.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">"""Greeter.</span>
</span><span class="line">
</span><span class="line"><span class="sd">Usage:</span>
</span><span class="line"><span class="sd">  basic.py hello &lt;name&gt;</span>
</span><span class="line"><span class="sd">  basic.py goodbye &lt;name&gt;</span>
</span><span class="line"><span class="sd">  basic.py (-h | --help)</span>
</span><span class="line">
</span><span class="line"><span class="sd">Options:</span>
</span><span class="line"><span class="sd">  -h --help     Show this screen.</span>
</span><span class="line">
</span><span class="line"><span class="sd">"""</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, {0}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Goodbye, {0}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="c"># if an argument called hello was passed, execute the hello logic.</span>
</span><span class="line">    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'hello'</span><span class="p">]:</span>
</span><span class="line">        <span class="n">hello</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;name&gt;'</span><span class="p">])</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'goodbye'</span><span class="p">]:</span>
</span><span class="line">        <span class="n">goodbye</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;name&gt;'</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/arguments.py hello Kyle
</span><span class="line">Hello, Kyle
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/arguments.py hello --help
</span><span class="line">Greeter.
</span><span class="line">
</span><span class="line">Usage:
</span><span class="line">  basic.py hello &lt;name&gt;
</span><span class="line">  basic.py goodbye &lt;name&gt;
</span><span class="line">  basic.py <span class="o">(</span>-h <span class="p">|</span> --help<span class="o">)</span>
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  -h --help     Show this screen.
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Note that the help message is not specific to the subcommand, rather it is the entire docstring for the program.</p></blockquote>

<a name="Click"/>
<h3>Click</h3>

<p>In order to add an argument to a <em>click</em> command we use the <code>@click.argument</code> decorator. In this case we are just passing the argument name, but there are <a href="http://click.pocoo.org/5/arguments/">many more options</a> some of which we’ll use later. Since we are decorating the logic (function) with the argument we don’t need to do anything to set or make a call to the correct logic.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">click</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@click.group</span><span class="p">()</span>
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="k">pass</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>  <span class="c"># add the name argument</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, {0}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'name'</span><span class="p">]))</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Goodbye, {0}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'name'</span><span class="p">]))</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">greet</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python click/arguments.py hello Kyle
</span><span class="line">Hello, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python click/arguments.py hello --help
</span><span class="line">Usage: arguments.py hello <span class="o">[</span>OPTIONS<span class="o">]</span> NAME
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  --help  Show this message and exit.
</span></code></pre></td></tr></table></div></figure>


<a name="Flags.Options"/>
<h2>Flags/Options</h2>

<p>In this section we will again be adding new logic to the same code shown in the previous section. We’ll add comments to new lines stating there purpose. Options are non-required inputs that can be given to alter the execution of a command-line application. Flags are a boolean only (<code>True</code>/<code>False</code>) subset of options. For example: <code>--foo=bar</code> will pass <code>bar</code> as the value for the <code>foo</code> option and <code>--baz</code> (if defined as a flag) will pass the value of <code>True</code> is the option is given, or <code>False</code> if not.</p>

<p>For this example we are going to add the <code>--greeting=[greeting]</code> option, and the <code>--caps</code> flag. The <code>greeting</code> option will have default values of <code>Hello</code> and <code>Goodbye</code> and allow the user to pass in a custom greeting. For example given <code>--greeting=Wazzup</code> the tool will respond with <code>Wazzup, [name]!</code>. The <code>--caps</code> flag will uppercase the entire response if given. For example given <code>--caps</code> the tool will respond with <code>HELLO, [NAME]!</code>.</p>

<a name="Argparse"/>
<h3>Argparse</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">argparse</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="c"># since we are now passing in the greeting</span>
</span><span class="line"><span class="c"># the logic has been consolidated to a single greet function</span>
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">greeting</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">caps</span><span class="p">:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="line"><span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="n">hello_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="c"># add greeting option w/ default</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">)</span>
</span><span class="line"><span class="c"># add a flag (default=False)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">greet</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">goodbye_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'goodbye'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Goodbye'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">greet</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span class="line">    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python argparse/options.py hello --greeting<span class="o">=</span>Wazzup Kyle
</span><span class="line">Wazzup, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python argparse/options.py hello --caps Kyle
</span><span class="line">HELLO, KYLE!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python argparse/options.py hello --greeting<span class="o">=</span>Wazzup --caps Kyle
</span><span class="line">WAZZUP, KYLE!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python argparse/options.py hello --help
</span><span class="line">usage: options.py hello <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--greeting GREETING<span class="o">]</span> <span class="o">[</span>--caps<span class="o">]</span> name
</span><span class="line">
</span><span class="line">positional arguments:
</span><span class="line">  name
</span><span class="line">
</span><span class="line">optional arguments:
</span><span class="line">  -h, --help           show this <span class="nb">help </span>message and <span class="nb">exit</span>
</span><span class="line">  --greeting GREETING
</span><span class="line">  --caps
</span></code></pre></td></tr></table></div></figure>


<a name="Docopt"/>
<h3>Docopt</h3>

<p>Once we hit the case of adding options with defaults, we hit a snag with the basic implementation of commands in <em>docopt</em>. Let’s continue just to illustrate the issue.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">"""Greeter.</span>
</span><span class="line">
</span><span class="line"><span class="sd">Usage:</span>
</span><span class="line"><span class="sd">  basic.py hello &lt;name&gt; [--caps] [--greeting=&lt;str&gt;]</span>
</span><span class="line"><span class="sd">  basic.py goodbye &lt;name&gt; [--caps] [--greeting=&lt;str&gt;]</span>
</span><span class="line"><span class="sd">  basic.py (-h | --help)</span>
</span><span class="line">
</span><span class="line"><span class="sd">Options:</span>
</span><span class="line"><span class="sd">  -h --help         Show this screen.</span>
</span><span class="line"><span class="sd">  --caps            Uppercase the output.</span>
</span><span class="line"><span class="sd">  --greeting=&lt;str&gt;  Greeting to use [default: Hello].</span>
</span><span class="line">
</span><span class="line"><span class="sd">"""</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">'--greeting'</span><span class="p">],</span>
</span><span class="line">                                <span class="n">args</span><span class="p">[</span><span class="s">'&lt;name&gt;'</span><span class="p">])</span>
</span><span class="line">    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s">'--caps'</span><span class="p">]:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, see what happens when we run the following commands:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/options.py hello Kyle
</span><span class="line">Hello, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/options.py goodbye Kyle
</span><span class="line">Hello, Kyle!
</span></code></pre></td></tr></table></div></figure>


<p>What?! Because we can only set a single default for the <code>--greeting</code> option both of our <code>Hello</code> and <code>Goodbye</code> commands now respond with <code>Hello, Kyle!</code>. In order for us to make this work we’ll need to follow the <a href="https://github.com/docopt/docopt/tree/master/examples/git">git example</a> docopt provides. The refactored code is shown below:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">"""usage: greet [--help] &lt;command&gt; [&lt;args&gt;...]</span>
</span><span class="line">
</span><span class="line"><span class="sd">options:</span>
</span><span class="line"><span class="sd">  -h --help         Show this screen.</span>
</span><span class="line">
</span><span class="line"><span class="sd">commands:</span>
</span><span class="line"><span class="sd">   hello       Say hello</span>
</span><span class="line"><span class="sd">   goodbye     Say goodbye</span>
</span><span class="line">
</span><span class="line"><span class="sd">"""</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
</span><span class="line">
</span><span class="line"><span class="n">HELLO</span> <span class="o">=</span> <span class="s">"""usage: basic.py hello [options] [&lt;name&gt;]</span>
</span><span class="line">
</span><span class="line"><span class="s">  -h --help         Show this screen.</span>
</span><span class="line"><span class="s">  --caps            Uppercase the output.</span>
</span><span class="line"><span class="s">  --greeting=&lt;str&gt;  Greeting to use [default: Hello].</span>
</span><span class="line"><span class="s">"""</span>
</span><span class="line">
</span><span class="line"><span class="n">GOODBYE</span> <span class="o">=</span> <span class="s">"""usage: basic.py goodbye [options] [&lt;name&gt;]</span>
</span><span class="line">
</span><span class="line"><span class="s">  -h --help         Show this screen.</span>
</span><span class="line"><span class="s">  -"""</span><span class="n">usage</span><span class="p">:</span> <span class="n">greet</span> <span class="p">[</span><span class="o">--</span><span class="n">help</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">args</span><span class="o">&gt;...</span><span class="p">]</span>
</span><span class="line">
</span><span class="line"><span class="n">options</span><span class="p">:</span>
</span><span class="line">  <span class="o">-</span><span class="n">h</span> <span class="o">--</span><span class="n">help</span>         <span class="n">Show</span> <span class="n">this</span> <span class="n">screen</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="n">commands</span><span class="p">:</span>
</span><span class="line">   <span class="n">hello</span>       <span class="n">Say</span> <span class="n">hello</span>
</span><span class="line">   <span class="n">goodbye</span>     <span class="n">Say</span> <span class="n">goodbye</span>
</span><span class="line">
</span><span class="line"><span class="sd">"""</span>
</span><span class="line">
</span><span class="line"><span class="sd">from docopt import docopt</span>
</span><span class="line">
</span><span class="line"><span class="sd">HELLO = """</span><span class="n">usage</span><span class="p">:</span> <span class="n">basic</span><span class="o">.</span><span class="n">py</span> <span class="n">hello</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">  <span class="o">-</span><span class="n">h</span> <span class="o">--</span><span class="n">help</span>         <span class="n">Show</span> <span class="n">this</span> <span class="n">screen</span><span class="o">.</span>
</span><span class="line">  <span class="o">--</span><span class="n">caps</span>            <span class="n">Uppercase</span> <span class="n">the</span> <span class="n">output</span><span class="o">.</span>
</span><span class="line">  <span class="o">--</span><span class="n">greeting</span><span class="o">=&lt;</span><span class="nb">str</span><span class="o">&gt;</span>  <span class="n">Greeting</span> <span class="n">to</span> <span class="n">use</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">Hello</span><span class="p">]</span><span class="o">.</span>
</span><span class="line"><span class="sd">"""</span>
</span><span class="line">
</span><span class="line"><span class="sd">GOODBYE = """</span><span class="n">usage</span><span class="p">:</span> <span class="n">basic</span><span class="o">.</span><span class="n">py</span> <span class="n">goodbye</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">  <span class="o">-</span><span class="n">h</span> <span class="o">--</span><span class="n">help</span>         <span class="n">Show</span> <span class="n">this</span> <span class="n">screen</span><span class="o">.</span>
</span><span class="line">  <span class="o">--</span><span class="n">caps</span>            <span class="n">Uppercase</span> <span class="n">the</span> <span class="n">output</span><span class="o">.</span>
</span><span class="line">  <span class="o">--</span><span class="n">greeting</span><span class="o">=&lt;</span><span class="nb">str</span><span class="o">&gt;</span>  <span class="n">Greeting</span> <span class="n">to</span> <span class="n">use</span> <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">Goodbye</span><span class="p">]</span><span class="o">.</span>
</span><span class="line"><span class="s">"""</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="s">def greet(args):</span>
</span><span class="line"><span class="s">    output = '{0}, {1}!'.format(args['--greeting'],</span>
</span><span class="line"><span class="s">                                args['&lt;name&gt;'])</span>
</span><span class="line"><span class="s">    if args['--caps']:</span>
</span><span class="line"><span class="s">        output = output.upper()</span>
</span><span class="line"><span class="s">    print(output)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="s">if __name__ == '__main__':</span>
</span><span class="line"><span class="s">    arguments = docopt(__doc__, options_first=True)</span>
</span><span class="line">
</span><span class="line"><span class="s">    if arguments['&lt;command&gt;'] == 'hello':</span>
</span><span class="line"><span class="s">        greet(docopt(HELLO))</span>
</span><span class="line"><span class="s">    elif arguments['&lt;command&gt;'] == 'goodbye':</span>
</span><span class="line"><span class="s">        greet(docopt(GOODBYE))</span>
</span><span class="line"><span class="s">    else:</span>
</span><span class="line"><span class="s">        exit("{0} is not a command. </span><span class="se">\</span>
</span><span class="line"><span class="s">          See 'options.py --help'.".format(arguments['&lt;command&gt;']))</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see the <code>hello</code>|<code>goodbye</code> subcommands are now there own docstrings tied to the variables <code>HELLO</code> and <code>GOODBYE</code>. When the tool is executed it uses a new argument, <code>command</code>, to decide which to parse. Not only does this correct the problem we had with only one default, but we now have subcommand specific help messages as well.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/options.py --help
</span><span class="line">usage: greet <span class="o">[</span>--help<span class="o">]</span> &lt;<span class="nb">command</span>&gt; <span class="o">[</span>&lt;args&gt;...<span class="o">]</span>
</span><span class="line">
</span><span class="line">options:
</span><span class="line">  -h --help         Show this screen.
</span><span class="line">
</span><span class="line">commands:
</span><span class="line">   hello       Say hello
</span><span class="line">   goodbye     Say goodbye
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/options.py hello --help
</span><span class="line">usage: basic.py hello <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>&lt;name&gt;<span class="o">]</span>
</span><span class="line">
</span><span class="line">  -h --help         Show this screen.
</span><span class="line">  --caps            Uppercase the output.
</span><span class="line">  --greeting<span class="o">=</span>&lt;str&gt;  Greeting to use <span class="o">[</span>default: Hello<span class="o">]</span>.
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/options.py hello Kyle
</span><span class="line">Hello, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/options.py goodbye Kyle
</span><span class="line">Goodbye, Kyle!
</span></code></pre></td></tr></table></div></figure>


<p>In addition all of our new options/flags are working as well:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/options.py hello --greeting<span class="o">=</span>Wazzup Kyle
</span><span class="line">Wazzup, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/options.py hello --caps Kyle
</span><span class="line">HELLO, KYLE!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/options.py hello --greeting<span class="o">=</span>Wazzup --caps Kyle
</span><span class="line">WAZZUP, KYLE!
</span></code></pre></td></tr></table></div></figure>


<a name="Click"/>
<h3>Click</h3>

<p>To add the <code>greeting</code> and <code>caps</code> options we use the <code>@click.option</code> decorator. Again, since we have default greetings now we have pulled the logic out into a single function (<code>def greeter(**kwargs):</code>).</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">click</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'greeting'</span><span class="p">],</span>
</span><span class="line">                                <span class="n">kwargs</span><span class="p">[</span><span class="s">'name'</span><span class="p">])</span>
</span><span class="line">    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">'caps'</span><span class="p">]:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@click.group</span><span class="p">()</span>
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="k">pass</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="c"># add an option with 'Hello' as the default</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">)</span>
</span><span class="line"><span class="c"># add a flag (is_flag=True)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line"><span class="c"># the application logic has been refactored into a single function</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Goodbye'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">greet</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python click/options.py hello --greeting<span class="o">=</span>Wazzup Kyle
</span><span class="line">Wazzup, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python click/options.py hello --greeting<span class="o">=</span>Wazzup --caps Kyle
</span><span class="line">WAZZUP, KYLE!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python click/options.py hello --caps Kyle
</span><span class="line">HELLO, KYLE!
</span></code></pre></td></tr></table></div></figure>


<a name="Version.Option..--version."/>
<h2>Version Option (—version)</h2>

<p>In this section we’ll be showing how to add a <code>--version</code> argument to each of our tools. For simplicity we’ll just hardcode the version number to <em>1.0.0</em>. Keep in mind that in a production application, you will want to pull this from the installed application. One way to achieve this is with this simple process:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">&gt;&gt;&gt; import pkg_resources
</span><span class="line">&gt;&gt;&gt; pkg_resources.get_distribution<span class="o">(</span><span class="s2">"click"</span><span class="o">)</span>.version
</span><span class="line">&gt;&gt;&gt; <span class="s1">'5.1'</span>
</span><span class="line"><span class="c"># replace click with the name of your tool</span>
</span></code></pre></td></tr></table></div></figure>


<p>A second option for determining the version would be to have an automated version-bumping software change the version number defined in the file when a new version is released. This is possible with <a href="https://pypi.python.org/pypi/bumpversion">bumpversion</a>. But this approach is not recommended as it’s easy to get out of sync. Generally, it’s best practice to keep a version number in as few places as possible.</p>

<p>Since the implementation of adding a hard-coded version option is fairly simple we will use <code>...</code> to denote skipped sections of the code from the last section.</p>

<a name="Argparse"/>
<h3>Argparse</h3>

<p>For <em>argparse</em> we again need to use the <code>add_argument</code> method, this time with the <code>action='version'</code> parameter and a value for <code>version</code> passed in. We apply this method to the root parser (instead of the <code>hello</code> or <code>goodbye</code> subparsers).</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">...</span>
</span><span class="line"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="line"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--version'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'version'</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line"><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python argparse/version.py --version
</span><span class="line">1.0.0
</span></code></pre></td></tr></table></div></figure>


<a name="Docopt"/>
<h3>Docopt</h3>

<p>In order to add <code>--version</code> to <em>docopt</em> we add it as an option to our primary docstring. In addition we add the <code>version</code> parameter to our first call to docopt (parsing the primary docstring).</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">"""usage: greet [--help] &lt;command&gt; [&lt;args&gt;...]</span>
</span><span class="line">
</span><span class="line"><span class="sd">options:</span>
</span><span class="line"><span class="sd">  -h --help         Show this screen.</span>
</span><span class="line"><span class="sd">  --version         Show the version.</span>
</span><span class="line">
</span><span class="line"><span class="sd">commands:</span>
</span><span class="line"><span class="sd">   hello       Say hello</span>
</span><span class="line"><span class="sd">   goodbye     Say goodbye</span>
</span><span class="line">
</span><span class="line"><span class="sd">"""</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
</span><span class="line">
</span><span class="line"><span class="o">...</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">options_first</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line">    <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/version.py --version
</span><span class="line">1.0.0
</span></code></pre></td></tr></table></div></figure>


<a name="Click"/>
<h3>Click</h3>

<p><em>Click</em> provides us with a convenient <code>@click.version_option</code> decorator. To add this we decorate our <code>greet</code> function (main <code>@click.group</code> function).</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">...</span>
</span><span class="line"><span class="nd">@click.group</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.version_option</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python click/version.py --version
</span><span class="line">version.py, version 1.0.0
</span></code></pre></td></tr></table></div></figure>


<a name="Improving.Help..-h.--help."/>
<h2>Improving Help (-h/—help)</h2>

<p>The final step to completing our application is to improve the help documentation for each of the tools. We’ll want to make sure that we can access help with both <code>-h</code> and <code>--help</code> and that each <em>argument</em> and <em>option</em> have some level of description.</p>

<a name="Argparse"/>
<h3>Argparse</h3>

<p>By default <em>argparse</em> provides us with both <code>-h</code> and <code>--help</code> so we don’t need to add anything for that. However our current help documentation for the subcommands is lacking information on what <code>--caps</code> and <code>--greeting</code> do and what the <code>name</code> argument is.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python argparse/version.py hello -h
</span><span class="line">usage: version.py hello <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--greeting GREETING<span class="o">]</span> <span class="o">[</span>--caps<span class="o">]</span> name
</span><span class="line">
</span><span class="line">positional arguments:
</span><span class="line">  name
</span><span class="line">
</span><span class="line">optional arguments:
</span><span class="line">  -h, --help           show this <span class="nb">help </span>message and <span class="nb">exit</span>
</span><span class="line">  --greeting GREETING
</span><span class="line">  --caps
</span></code></pre></td></tr></table></div></figure>


<p>In order to add more information we use the <code>help</code> parameter of the <code>add_argument</code> method.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">...</span>
</span><span class="line">
</span><span class="line"><span class="n">hello_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'name of the person to greet'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">greet</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">goodbye_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'goodbye'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'name of the person to greet'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now when we provide the help flag we get a much more complete result:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python argparse/help.py hello -h
</span><span class="line">usage: help.py hello <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--greeting GREETING<span class="o">]</span> <span class="o">[</span>--caps<span class="o">]</span> name
</span><span class="line">
</span><span class="line">positional arguments:
</span><span class="line">  name                 name of the person to greet
</span><span class="line">
</span><span class="line">optional arguments:
</span><span class="line">  -h, --help           show this <span class="nb">help </span>message and <span class="nb">exit</span>
</span><span class="line">  --greeting GREETING  word to use <span class="k">for </span>the greeting
</span><span class="line">  --caps               uppercase the output
</span></code></pre></td></tr></table></div></figure>


<a name="Docopt"/>
<h3>Docopt</h3>

<p>This section is where <em>docopt</em> shines. Because we wrote the documentation as the definition of the command-line interface itself, we already have the help documentation completed. In addition <code>-h</code> and <code>--help</code> are already provided.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/help.py hello -h
</span><span class="line">usage: basic.py hello <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>&lt;name&gt;<span class="o">]</span>
</span><span class="line">
</span><span class="line">  -h --help         Show this screen.
</span><span class="line">  --caps            Uppercase the output.
</span><span class="line">  --greeting<span class="o">=</span>&lt;str&gt;  Greeting to use <span class="o">[</span>default: Hello<span class="o">]</span>.
</span></code></pre></td></tr></table></div></figure>


<a name="Click"/>
<h3>Click</h3>

<p>Adding help documentation to <em>click</em> is very similar to <em>argparse</em>. We need to add the <code>help</code> parameter to all of our <code>@click.option</code> decorators.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">...</span>
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Goodbye'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, <em>click</em> <strong>DOES NOT</strong> provide us <code>-h</code> by default. We need to use the <code>context_settings</code> parameter to override the default <code>help_option_names</code>.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">click</span>
</span><span class="line">
</span><span class="line"><span class="n">CONTEXT_SETTINGS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">help_option_names</span><span class="o">=</span><span class="p">[</span><span class="s">'-h'</span><span class="p">,</span> <span class="s">'--help'</span><span class="p">])</span>
</span><span class="line">
</span><span class="line"><span class="o">...</span>
</span><span class="line">
</span><span class="line"><span class="nd">@click.group</span><span class="p">(</span><span class="n">context_settings</span><span class="o">=</span><span class="n">CONTEXT_SETTINGS</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.version_option</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="k">pass</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the <em>click</em> help documentation is complete.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python click/help.py hello -h
</span><span class="line">Usage: help.py hello <span class="o">[</span>OPTIONS<span class="o">]</span> NAME
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  --greeting TEXT  word to use <span class="k">for </span>the greeting
</span><span class="line">  --caps           uppercase the output
</span><span class="line">  -h, --help       Show this message and exit.
</span></code></pre></td></tr></table></div></figure>


<a name="Error.Handling"/>
<h2>Error Handling</h2>

<p>Error handling is an important part of any application. This section will explore the default error handling of each application and implement additional logic if needed. We’ll explore three error cases:</p>

<ol>
<li>Not enough required arguments given.</li>
<li>Invalid options/flags given.</li>
<li>A flag with a value is given.</li>
</ol>


<a name="Argparse"/>
<h3>Argparse</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python argparse/final.py hello
</span><span class="line">usage: final.py hello <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--greeting GREETING<span class="o">]</span> <span class="o">[</span>--caps<span class="o">]</span> name
</span><span class="line">final.py hello: error: the following arguments are required: name
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python argparse/final.py --badoption hello Kyle
</span><span class="line">usage: final.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--version<span class="o">]</span> <span class="o">{</span>hello,goodbye<span class="o">}</span> ...
</span><span class="line">final.py: error: unrecognized arguments: --badoption
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python argparse/final.py hello --caps<span class="o">=</span>notanoption Kyle
</span><span class="line">usage: final.py hello <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--greeting GREETING<span class="o">]</span> <span class="o">[</span>--caps<span class="o">]</span> name
</span><span class="line">final.py hello: error: argument --caps: ignored explicit argument <span class="s1">'notanoption'</span>
</span></code></pre></td></tr></table></div></figure>


<p>Not very exciting, as <em>argparse</em> handles all of our error cases out of the box.</p>

<a name="Docopt"/>
<h3>Docopt</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/final.py hello
</span><span class="line">Hello, None!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/final.py hello --badoption Kyle
</span><span class="line">usage: basic.py hello <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>&lt;name&gt;<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Unfortunatly, we have a bit of work to get <em>docopt</em> to an acceptable minimum level of error handling. The reccomended method for validation in <em>docopt</em> is the <a href="https://pypi.python.org/pypi/schema">schema</a> module. *Make sure to install – <code>pip install schema</code>. In addition they provide a very basic <a href="https://github.com/docopt/docopt/blob/master/examples/validation_example.py">validation example</a>. The following is our application with schema validation:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">...</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">schema</span> <span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">SchemaError</span><span class="p">,</span> <span class="n">Optional</span>
</span><span class="line"><span class="o">...</span>
</span><span class="line">    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">({</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'hello'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'goodbye'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="s">'&lt;name&gt;'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'--help'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">):</span> <span class="nb">str</span>
</span><span class="line">    <span class="p">})</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">        <span class="k">try</span><span class="p">:</span>
</span><span class="line">            <span class="n">args</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class="line">            <span class="k">return</span> <span class="n">args</span>
</span><span class="line">        <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class="line">            <span class="nb">exit</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'hello'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">HELLO</span><span class="p">)))</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'goodbye'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">GOODBYE</span><span class="p">)))</span>
</span><span class="line"><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this validation in place we now get some error messages.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python docopt/validation.py hello
</span><span class="line">None should be instance of &lt;class <span class="s1">'str'</span>&gt;
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/validation.py hello --greeting Kyle
</span><span class="line">None should be instance of &lt;class <span class="s1">'str'</span>&gt;
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python docopt/validation.py hello --caps<span class="o">=</span>notanoption Kyle
</span><span class="line">--caps must not have an argument
</span><span class="line">usage: basic.py hello <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>&lt;name&gt;<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>While these messages are not very descriptive and may be hard to debug for larger applications, it’s better than no validation at all. The schema module does provide other mechanisms for adding more descriptive error messages but we won’t cover those here.</p>

<a name="Click"/>
<h3>Click</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>python click/final.py hello
</span><span class="line">Usage: final.py hello <span class="o">[</span>OPTIONS<span class="o">]</span> NAME
</span><span class="line">
</span><span class="line">Error: Missing argument <span class="s2">"name"</span>.
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python click/final.py hello --badoption Kyle
</span><span class="line">Error: no such option: --badoption
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>python click/final.py hello --caps<span class="o">=</span>notanoption Kyle
</span><span class="line">Error: --caps option does not take a value
</span></code></pre></td></tr></table></div></figure>


<p>Just like <em>argparse</em>, <em>click</em> handles error input by default.</p>

<hr/>


<p><strong>With that, we have completed the construction of the command-line application we set out to build. Before we conclude let’s take a look at another possible option.</strong></p>

<a name="Invoke"/>
<h2>Invoke</h2>

<p>Can we use <a href="https://invoke.readthedocs.org/en/latest/">invoke</a>, a simple task running library, to build the greeter command-line application? Let’s find out!</p>

<p>To start let’s begin with the simplest version of the greeter:</p>

<p><em>tasks.py</em></p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Hello, {0}!'</span><span class="o">.</span> <span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'Goodbye, {0}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this very simple file we get a two tasks and very minimal help. From the same directory as <em>tasks.py</em> we get the following results:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>invoke -l
</span><span class="line">Available tasks:
</span><span class="line">
</span><span class="line">  goodbye
</span><span class="line">  hello
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>invoke hello Kyle
</span><span class="line">Hello, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>invoke goodbye Kyle
</span><span class="line">Goodbye, Kyle!
</span></code></pre></td></tr></table></div></figure>


<p>Now let’s add in our options/flags – <code>--greeting</code> and <code>--caps</code>. In addition, we can pull out the greeting logic into it’s own function, just as we did with the other tools.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">caps</span><span class="p">:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">'Goodbye'</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we actually have the complete interface we designated in the beginning!</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>invoke hello Kyle
</span><span class="line">Hello, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>invoke hello --greeting<span class="o">=</span>Wazzup Kyle
</span><span class="line">Wazzup, Kyle!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>invoke hello --greeting<span class="o">=</span>Wazzup --caps Kyle
</span><span class="line">WAZZUP, KYLE!
</span><span class="line">
</span><span class="line"><span class="nv">$ </span>invoke hello --caps Kyle
</span><span class="line">HELLO, KYLE!
</span></code></pre></td></tr></table></div></figure>


<a name="Help.Documentation"/>
<h3>Help Documentation</h3>

<p>In order to compete with <em>argparse</em>, <em>docopt</em>, and <em>click</em>, we’ll also need to be able to add complete help documentation. Luckily this is also available in <em>invoke</em> by using the <code>help</code> parameter of the <code>@task</code> decorator and adding docstrings to the decorated functions.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">...</span>
</span><span class="line">
</span><span class="line"><span class="n">HELP</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="s">'name'</span><span class="p">:</span> <span class="s">'name of the person to greet'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'greeting'</span><span class="p">:</span> <span class="s">'word to use for the greeting'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'caps'</span><span class="p">:</span> <span class="s">'uppercase the output'</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">HELP</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class="line">    <span class="sd">"""</span>
</span><span class="line"><span class="sd">    Say hello.</span>
</span><span class="line"><span class="sd">    """</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">HELP</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">'Goodbye'</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class="line">    <span class="sd">"""</span>
</span><span class="line"><span class="sd">    Say goodbye.</span>
</span><span class="line"><span class="sd">    """</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>invoke --help hello
</span><span class="line">Usage: inv<span class="o">[</span>oke<span class="o">]</span> <span class="o">[</span>--core-opts<span class="o">]</span> hello <span class="o">[</span>--options<span class="o">]</span> <span class="o">[</span>other tasks here ...<span class="o">]</span>
</span><span class="line">
</span><span class="line">Docstring:
</span><span class="line">  Say hello.
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  -c, --caps                     uppercase the output
</span><span class="line">  -g STRING, --greeting<span class="o">=</span>STRING   word to use <span class="k">for </span>the greeting
</span><span class="line">  -n STRING, --name<span class="o">=</span>STRING       name of the person to greet
</span><span class="line">  -v, --version
</span></code></pre></td></tr></table></div></figure>


<a name="Version.Option"/>
<h3>Version Option</h3>

<p>Implementing a <code>--version</code> option is not quite as simple and comes with a caveat. The basics are that we will add <code>version=False</code> as an option to each of the tasks that calls a new <code>print_version</code> function if <code>True</code>. In order to make this work we cannot have any positional arguments without defaults or we get:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>invoke hello --version
</span><span class="line"><span class="s1">'hello'</span> did not receive all required positional arguments!
</span></code></pre></td></tr></table></div></figure>


<p>Also note that we are calling <code>--version</code> on our commands <code>hello</code> and <code>goodbye</code> because <em>invoke</em> itself has a version command:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>invoke --version
</span><span class="line">Invoke 0.10.1
</span></code></pre></td></tr></table></div></figure>


<p>The completed implementation of a version command follows:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="o">...</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">print_version</span><span class="p">():</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line">    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">HELP</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class="line">    <span class="sd">"""</span>
</span><span class="line"><span class="sd">    Say hello.</span>
</span><span class="line"><span class="sd">    """</span>
</span><span class="line">    <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
</span><span class="line">        <span class="n">print_version</span><span class="p">()</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we are able to ask invoke for the version of our tool:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>invoke hello --version
</span><span class="line">1.0.0
</span></code></pre></td></tr></table></div></figure>


<a name="Conclusion"/>
<h2>Conclusion</h2>

<p>To review, let’s take a look at the final version of each of the tools we created.</p>

<a name="Argparse"/>
<h3>Argparse</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">argparse</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">greeting</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">caps</span><span class="p">:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span class="line"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--version'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'version'</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line"><span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="n">hello_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'name of the person to greet'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line"><span class="n">hello_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">greet</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">goodbye_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">'goodbye'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'name of the person to greet'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line"><span class="n">goodbye_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">greet</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span class="line">    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Docopt"/>
<h3>Docopt</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">"""usage: greet [--help] &lt;command&gt; [&lt;args&gt;...]</span>
</span><span class="line">
</span><span class="line"><span class="sd">options:</span>
</span><span class="line"><span class="sd">  -h --help         Show this screen.</span>
</span><span class="line"><span class="sd">  --version         Show the version.</span>
</span><span class="line">
</span><span class="line"><span class="sd">commands:</span>
</span><span class="line"><span class="sd">   hello       Say hello</span>
</span><span class="line"><span class="sd">   goodbye     Say goodbye</span>
</span><span class="line">
</span><span class="line"><span class="sd">"""</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">schema</span> <span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">SchemaError</span><span class="p">,</span> <span class="n">Optional</span>
</span><span class="line">
</span><span class="line"><span class="n">HELLO</span> <span class="o">=</span> <span class="s">"""usage: basic.py hello [options] [&lt;name&gt;]</span>
</span><span class="line">
</span><span class="line"><span class="s">  -h --help         Show this screen.</span>
</span><span class="line"><span class="s">  --caps            Uppercase the output.</span>
</span><span class="line"><span class="s">  --greeting=&lt;str&gt;  Greeting to use [default: Hello].</span>
</span><span class="line"><span class="s">"""</span>
</span><span class="line">
</span><span class="line"><span class="n">GOODBYE</span> <span class="o">=</span> <span class="s">"""usage: basic.py goodbye [options] [&lt;name&gt;]</span>
</span><span class="line">
</span><span class="line"><span class="s">  -h --help         Show this screen.</span>
</span><span class="line"><span class="s">  --caps            Uppercase the output.</span>
</span><span class="line"><span class="s">  --greeting=&lt;str&gt;  Greeting to use [default: Goodbye].</span>
</span><span class="line"><span class="s">"""</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">'--greeting'</span><span class="p">],</span>
</span><span class="line">                                <span class="n">args</span><span class="p">[</span><span class="s">'&lt;name&gt;'</span><span class="p">])</span>
</span><span class="line">    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s">'--caps'</span><span class="p">]:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">options_first</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">({</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'hello'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'goodbye'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="s">'&lt;name&gt;'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'--help'</span><span class="p">):</span> <span class="nb">bool</span><span class="p">,</span>
</span><span class="line">        <span class="n">Optional</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">):</span> <span class="nb">str</span>
</span><span class="line">    <span class="p">})</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span class="line">        <span class="k">try</span><span class="p">:</span>
</span><span class="line">            <span class="n">args</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class="line">            <span class="k">return</span> <span class="n">args</span>
</span><span class="line">        <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class="line">            <span class="nb">exit</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'hello'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">HELLO</span><span class="p">)))</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'goodbye'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">GOODBYE</span><span class="p">)))</span>
</span><span class="line">    <span class="k">else</span><span class="p">:</span>
</span><span class="line">        <span class="nb">exit</span><span class="p">(</span><span class="s">"{0} is not a command. See 'options.py --help'."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Click"/>
<h3>Click</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">click</span>
</span><span class="line">
</span><span class="line"><span class="n">CONTEXT_SETTINGS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">help_option_names</span><span class="o">=</span><span class="p">[</span><span class="s">'-h'</span><span class="p">,</span> <span class="s">'--help'</span><span class="p">])</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'greeting'</span><span class="p">],</span>
</span><span class="line">                                <span class="n">kwargs</span><span class="p">[</span><span class="s">'name'</span><span class="p">])</span>
</span><span class="line">    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">'caps'</span><span class="p">]:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@click.group</span><span class="p">(</span><span class="n">context_settings</span><span class="o">=</span><span class="n">CONTEXT_SETTINGS</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.version_option</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="k">pass</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@greet.command</span><span class="p">()</span>
</span><span class="line"><span class="nd">@click.argument</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--greeting'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'Goodbye'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'word to use for the greeting'</span><span class="p">)</span>
</span><span class="line"><span class="nd">@click.option</span><span class="p">(</span><span class="s">'--caps'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'uppercase the output'</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="line">    <span class="n">greeter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">greet</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Invoke"/>
<h3>Invoke</h3>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">):</span>
</span><span class="line">    <span class="n">output</span> <span class="o">=</span> <span class="s">'{0}, {1}!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">caps</span><span class="p">:</span>
</span><span class="line">        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="n">HELP</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="s">'name'</span><span class="p">:</span> <span class="s">'name of the person to greet'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'greeting'</span><span class="p">:</span> <span class="s">'word to use for the greeting'</span><span class="p">,</span>
</span><span class="line">    <span class="s">'caps'</span><span class="p">:</span> <span class="s">'uppercase the output'</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">print_version</span><span class="p">():</span>
</span><span class="line">    <span class="k">print</span><span class="p">(</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line">    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">HELP</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class="line">    <span class="sd">"""</span>
</span><span class="line"><span class="sd">    Say hello.</span>
</span><span class="line"><span class="sd">    """</span>
</span><span class="line">    <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
</span><span class="line">        <span class="n">print_version</span><span class="p">()</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="nd">@task</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="n">HELP</span><span class="p">)</span>
</span><span class="line"><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s">'Goodbye'</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class="line">    <span class="sd">"""</span>
</span><span class="line"><span class="sd">    Say goodbye.</span>
</span><span class="line"><span class="sd">    """</span>
</span><span class="line">    <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
</span><span class="line">        <span class="n">print_version</span><span class="p">()</span>
</span><span class="line">    <span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">,</span> <span class="n">caps</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<a name="My.Recomendation"/>
<h3>My Recomendation</h3>

<p>Now, to get this out of the way, my personal go-to library is <em>click</em>. I have been using it on large, multi-command, complex interfaces for the last year. (Credit goes to <a href="https://twitter.com/kwbeam">@kwbeam</a> for introducing me to <em>click</em>). I prefer the decorator approach and think it lends a very clean, composable interface. That being said, let’s evaluate each option fairly.</p>

<a name="arparse"/>
<h3>arparse</h3>

<p><strong><em>Arparse</em> is the standard library (included with Python) for creating command-line utilities.</strong> For that fact alone, it is arguably the most used of the tools examined here. <em>Argparse</em> is also very simple to use as lots of <em>magic</em> (implicit work that happens behind the scenes) is used to construct the interface. For example, both arguments and options are defined using the <code>add_arguments</code> method and <em>argparse</em> figures out which is which behind the scenes.</p>

<a name="docopt"/>
<h3>docopt</h3>

<p><strong>If you think writing documentation is great, <em>docopt</em> is for you!</strong> In addition <em>docopt</em> has implementations for <a href="https://github.com/docopt">many other languages</a> – meaning you can learn one library and use it across many languages. The downside of <em>docopt</em> is that it is very structured in the way you have to define your command-line interface. (Some might say this is a good thing!)</p>

<a name="click"/>
<h3>click</h3>

<p>I’ve already said that I really like <em>click</em> and have been using it in production for over a year. <strong>I encourage you to read the very complete <a href="http://click.pocoo.org/5/why/">Why Click?</a> documentation.</strong> In fact, that documentation is what inspired this blog post! The decorator style implementation of <em>click</em> is very simple to use and since you are decorating the function you want executed, it makes it very easy to read the code and figure out what is going to be executed. In addition, <em>click</em> supports advanced features like callbacks, command nesting, and more. <em>Click</em> is based on a fork of the now deprecated <a href="https://docs.python.org/2/library/optparse.html">optparse</a> library.</p>

<a name="invoke"/>
<h3>invoke</h3>

<p><strong>Invoke surprised me in this comparison.</strong> I thought that a library designed for task execution might not be able to easily match full command-line libraries – but it did! That being said, I would not recommend using it for this type of work as you will certainly run into limitations for anything more complex than the example presented here.</p>

<a name="Bonus:.Packaging"/>
<h2>Bonus: Packaging</h2>

<p>Since not everyone is packaging up there python source with <a href="https://pypi.python.org/pypi/setuptools">setuptools</a> (or other solutions), we decided not to make this a core component of the article. In addition, we don’t want to cover <em>packaging</em> as a complete topic. If you want to learn more about packaging with setuptools <a href="https://packaging.python.org/en/latest/">go here</a> or with conda <a href="http://conda.pydata.org/docs/building/build.html">go here</a> or you can read my previous <a href="http://kylepurdon.com/blog/packaging-python-basics-with-continuum-analytics-conda.html">blog post</a> on conda packaging. <strong>What we will cover here is how to use the <em>entry_points</em> option to make a command-line application an executable command on install</strong>.</p>

<a name="Entry.Point.Basics"/>
<h3>Entry Point Basics</h3>

<p>An <a href="https://packaging.python.org/en/latest/distributing.html?highlight=entry_points#entry-points">entry_point</a> is essentially a map to a single function in your code that will be given a command on your system PATH. An entry_point has the form – <code>command = package.module:function</code></p>

<p>The best way to explain this is to just look at our <em>click</em> example and add an entry point.</p>

<a name="Packaging.Click.Commands"/>
<h3>Packaging Click Commands</h3>

<p><em>Click</em> makes packaging simple, as by default we are calling a single function when we execute our program:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">greet</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>In addition to the rest of the <em>setup.py</em> (not covered here), we would add the following to create an <em>entry_point</em> for our <em>click</em> application.</p>

<p>Assuming the following directory structure-</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">greeter/
</span><span class="line">├── greet
</span><span class="line">│   ├── __init__.py
</span><span class="line">│   └── cli.py       &lt;-- the same as our final.py
</span><span class="line">└── setup.py
</span></code></pre></td></tr></table></div></figure>


<p>-we will create the following <em>entry_point</em>:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
</span><span class="line">    <span class="s">'console_scripts'</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="s">'greet=greet.cli:greet'</span><span class="p">,</span>  <span class="c"># command=package.module:function</span>
</span><span class="line">    <span class="p">],</span>
</span><span class="line"><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>When a user installs the package created with this <em>entry_point</em>, <em>setuptools</em> will create the following executable script (called <code>greet</code>) and place it on the PATH of the user’s system.</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c">#!/usr/bin/python</span>
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="kn">import</span> <span class="nn">sys</span>
</span><span class="line">    <span class="kn">from</span> <span class="nn">greet.cli</span> <span class="kn">import</span> <span class="n">greet</span>
</span><span class="line">
</span><span class="line">    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">greet</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>After installation the user will now be able to run the following:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>greet --help
</span><span class="line">Usage: greet <span class="o">[</span>OPTIONS<span class="o">]</span> COMMAND <span class="o">[</span>ARGS<span class="o">]</span>...
</span><span class="line">
</span><span class="line">Options:
</span><span class="line">  --version   Show the version and exit.
</span><span class="line">  -h, --help  Show this message and exit.
</span><span class="line">
</span><span class="line">Commands:
</span><span class="line">  goodbye
</span><span class="line">  hello
</span></code></pre></td></tr></table></div></figure>


<a name="Packaging.Argparse.Commands"/>
<h3>Packaging Argparse Commands</h3>

<p>The only thing we need to do differently from <em>click</em> is to pull all of the application initialization into a single function that we can call in our <em>entry_point</em>.</p>

<p>This:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span class="line">    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Becomes:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span class="line">    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">greet</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can use the same pattern for the <em>entry_point</em> we defined for <em>click</em>.</p>

<a name="Packaging.Docopt.Commands"/>
<h3>Packaging Docopt Commands</h3>

<p>Packaging <em>docopt</em> commands requires the same process as <em>argparse</em>.</p>

<p>This:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">options_first</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'hello'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">HELLO</span><span class="p">))</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'goodbye'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">GOODBYE</span><span class="p">))</span>
</span><span class="line">    <span class="k">else</span><span class="p">:</span>
</span><span class="line">        <span class="nb">exit</span><span class="p">(</span><span class="s">"{0} is not a command. See 'options.py --help'."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Becomes:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
</span><span class="line">    <span class="n">arguments</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">options_first</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'hello'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">HELLO</span><span class="p">))</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'goodbye'</span><span class="p">:</span>
</span><span class="line">        <span class="n">greet</span><span class="p">(</span><span class="n">docopt</span><span class="p">(</span><span class="n">GOODBYE</span><span class="p">))</span>
</span><span class="line">    <span class="k">else</span><span class="p">:</span>
</span><span class="line">        <span class="nb">exit</span><span class="p">(</span><span class="s">"{0} is not a command. See 'options.py --help'."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s">'&lt;command&gt;'</span><span class="p">]))</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
</span><span class="line">    <span class="n">greet</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

</div>


      </div></body></html>