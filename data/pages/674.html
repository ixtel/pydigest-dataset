<html><body><div><div class="col-md-12">
				<p id="docs-internal-guid-0e1ef0f8-193e-47c5-0200-909a5e3f739f" dir="ltr"><a href="http://twilioinc.wpengine.com/2014/03/introducing-twilio-developer-evangelist-paul-hallett.html/me_wooty" rel="attachment wp-att-13086"><img class="alignright size-medium wp-image-13086" src="https://www.twilio.com/blog/wp-content/uploads/2014/03/me_wooty-224x300.jpg" alt="me_wooty"/></a><a href="https://www.djangoproject.com/">Django</a> is often referred to as a “batteries included” Python web framework due to the many features that come with it out-of-the-box. It is becoming an increasingly popular choice for developers who want to build web applications in Python.</p>
<p>Django is my personal choice when developing web apps as I love the huge collection of contributed libraries and the great community developing the software. When I think about how <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" title="Model View Controller" target="_blank">MVC</a> web frameworks should work; Django fits it almost perfectly. Let’s build a simple application that responds with an SMS message when you send an SMS message to it.</p>
<h3>What You’ll Learn</h3>
<p>In this post we’re going to use Django to build a simple SMS application:</p>
<ul>
<li>Linking a Twilio phone number to your Django web application</li>
<li>Responding to an SMS message with some basic TwiML</li>
<li>Using twilio-python to build responses pythonically</li>
<li>Using Django-twilio to make Django respond securely</li>
</ul>
<h3>Connecting Twilio to a Django View</h3>
<p>Twilio uses <a href="https://www.twilio.com/platform/webhooks">webhooks</a> to talk to our application: when Twilio receives an SMS it sends a HTTP request to a URL on our web application. We then return a response which Twilio transforms into an SMS message or a phone call.<br/>
<a href="http://twilioinc.wpengine.com/2014/04/building-a-simple-sms-message-application-with-twilio-and-django-2.html/twilioanddjango" rel="attachment wp-att-13170"><img class="aligncenter size-full wp-image-13170" src="https://www.twilio.com/blog/wp-content/uploads/2014/03/TwilioandDjango.png" alt="TwilioandDjango"/></a></p>
<p>Just like any device in the telephony network, you’re going to need a phone number in order to send and receive SMS. You can head over to the Twilio account portal and <a href="https://www.twilio.com/user/account/phone-numbers/incoming">get one for free</a> on a trial account. We need to set our URL in the account portal in the Request URL field in our phone number configuration:</p>
<p><a href="http://twilioinc.wpengine.com/2014/04/building-a-simple-sms-message-application-with-twilio-and-django-2.html/twiliomessaging" rel="attachment wp-att-13171"><img class="aligncenter size-full wp-image-13171" src="https://www.twilio.com/blog/wp-content/uploads/2014/03/TwilioMessaging.png" alt="TwilioMessaging"/></a></p>
<p>We’ll be using the 
			<span id="crayon-56d5a0c750f6c853702049" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-o">/</span><span class="crayon-v">sms</span><span class="crayon-o">/</span></span></span> url for this tutorial. If you want to host your local development environment on the web, I recommend using <a href="https://www.twilio.com/blog/2013/10/test-your-webhooks-locally-with-ngrok.html">ngrok</a>.</p>
<p>When it receives the request from Twilio, Django will check the URL configuration to decide which view to pass the request information. The view then sends our response back to Twilio.</p>
<p>We’re going to need to start a new Django project for this, so run the following code in terminal to set one up:</p>

		<div id="crayon-56d5a0c750f82585360279" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c750f82585360279-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-o">-</span><span class="crayon-v">admin</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-e">startproject </span><span class="crayon-v">djtwilio</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We’re using the project name 
			<span id="crayon-56d5a0c750f8c140553277" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">djtwilio</span></span></span> (mostly because it sounds like a bad ass disk jockey) but you’re welcome to use your own name for the project. Just remember to substitute 
			<span id="crayon-56d5a0c750f96192459462" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">djtwilio</span></span></span> for your project name throughout the code.</p>
<p>We’ll need to define the urls in our URL configuration before we code anything else, otherwise the request won’t go anywhere:</p>

		<div id="crayon-56d5a0c750f9f686306271" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-2">2</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-4">4</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-6">6</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-8">8</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-10">10</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-12">12</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-14">14</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-16">16</p><p class="crayon-num" data-line="crayon-56d5a0c750f9f686306271-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c750f9f686306271-18">18</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-1"><span class="crayon-p"># urls.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-2"> </p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-3"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">conf</span><span class="crayon-sy">.</span><span class="crayon-e">urls </span><span class="crayon-e">import </span><span class="crayon-v">patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">include</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">url</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-4"> </p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-5"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">contrib </span><span class="crayon-e">import </span><span class="crayon-e">admin</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-6"><span class="crayon-v">admin</span><span class="crayon-sy">.</span><span class="crayon-e">autodiscover</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-8"><span class="crayon-v">urlpatterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">patterns</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-9"><span class="crayon-h">    </span><span class="crayon-p"># Examples:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-10"><span class="crayon-h">    </span><span class="crayon-p"># url(r'^$', 'djtwilio.views.home', name='home'),</span></p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-11"><span class="crayon-h">    </span><span class="crayon-p"># url(r'^blog/', include('blog.urls')),</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-12"> </p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-13"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^admin/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">include</span><span class="crayon-sy">(</span><span class="crayon-v">admin</span><span class="crayon-sy">.</span><span class="crayon-v">site</span><span class="crayon-sy">.</span><span class="crayon-v">urls</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-14"> </p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-15"><span class="crayon-h">    </span><span class="crayon-p"># Here we add our Twilio URLs</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-16"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^sms/$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'djtwilio.views.sms'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a0c750f9f686306271-17"><span class="crayon-h">    </span><span class="crayon-e">url</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'^ring/$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'djtwilio.views.ring'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750f9f686306271-18"><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Here we have set the configuration to link the /sms/ url to the sms_received view. In Django this view can be a function. You can also use class-based views, but for this example we’re using function-based views.</p>
<h3>Responding to Twilio requests and Building TwiML</h3>
<p>We can now start building our view function in the 
			<span id="crayon-56d5a0c750fa9287915512" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file:</p>

		<div id="crayon-56d5a0c750fb3384720472" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c750fb3384720472-1"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">http </span><span class="crayon-e">import </span><span class="crayon-e">HttpResponse</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750fb3384720472-2"> </p><p class="crayon-line" id="crayon-56d5a0c750fb3384720472-3"><span class="crayon-e">def </span><span class="crayon-e">sms</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Django view functions must always take at least one parameter: the request object. This is passed to the function with information such as HTTP header parameters, form POST data and a bunch of other stuff. We’re not interested in this just yet but Django requires it.</p>
<p>Twilio uses <a href="https://www.twilio.com/docs/api/twiml">TwiML</a>; a collection of XML tags that Twilio interprets as instructions.</p>
<p>This means we can create a string like this:</p>

		<div id="crayon-56d5a0c750fbd381216755" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c750fbd381216755-1"><span class="crayon-h">    </span><span class="crayon-e ">twiml</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s ">'&lt;Response&gt;&lt;Message&gt;Hello from your Django app!&lt;/Message&gt;&lt;/Response&gt;'</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>And Twilio will transform it into an SMS message, just like magic. Here our <a href="https://www.twilio.com/docs/api/twiml/sms/your_response">response</a> is a <a href="https://www.twilio.com/docs/api/twiml/sms/message">message</a> with some simple text. TwiML makes these complex telephony actions stupidly simple to implement.</p>
<p>Finally we return our TwiML string in a HttpResponse object. This is the standard method for sending HTTP responses in Django:</p>

		<div id="crayon-56d5a0c750fc7461186998" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c750fc7461186998-1"><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">HttpResponse</span><span class="crayon-sy">(</span><span class="crayon-v">twiml</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">content_type</span><span class="crayon-o">=</span><span class="crayon-s">'text/xml'</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Because we are returning XML, HTTP standards say we should set the content type to 
			<span id="crayon-56d5a0c750fd1028161594" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">text</span><span class="crayon-o">/</span><span class="crayon-v">xml</span></span></span>. We want to follow the rules of the web, after all.</p>
<p>Startup the server through the command line:</p>

		<div id="crayon-56d5a0c750fda972332685" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c750fda972332685-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">runserver</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h3>CSRF exemption</h3>
<p>Now if you try to send an SMS to the number linked to this view you’ll see an error.</p>
<p>Oh no! Twilio has a great app monitor which keeps track of errors for you, so you can see where things are going wrong. If we look at this error in the <a href="https://www.twilio.com/user/account/developer-tools/app-monitor">app monitor</a> you’ll see this:</p>
<p><a href="http://twilioinc.wpengine.com/2014/04/building-a-simple-sms-message-application-with-twilio-and-django-2.html/messagesid-2" rel="attachment wp-att-13175"><img class="aligncenter size-full wp-image-13175" src="https://www.twilio.com/blog/wp-content/uploads/2014/03/MessageSID1.png" alt="MessageSID"/></a></p>
<p>Further investigation of this error will show that we’ve received a 403 forbidden response.</p>
<p>Because Django is strict about security, especially when it comes to HTTP POST requests, it requires a <a href="https://docs.djangoproject.com/en/dev/ref/contrib/csrf/">CSRF token</a> to validate the requests. To get around this you need to add a 
			<span id="crayon-56d5a0c750fe5435706719" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">csrf_exempt</span></span></span> <a href="https://docs.djangoproject.com/en/dev/topics/http/decorators/">decorator</a> to the line above your view function:</p>

		<div id="crayon-56d5a0c750fee853772426" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c750fee853772426-1"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">decorators</span><span class="crayon-sy">.</span><span class="crayon-e">csrf </span><span class="crayon-e">import </span><span class="crayon-v">csrf</span><span class="crayon-sy">_</span>exempt</p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750fee853772426-2"> </p><p class="crayon-line" id="crayon-56d5a0c750fee853772426-3"><span class="crayon-sy">@</span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c750fee853772426-4"><span class="crayon-e">def </span><span class="crayon-e">sms</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c750fee853772426-5"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The Django developers reading this are probably worried about using 
			<span id="crayon-56d5a0c750ff8880650846" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">csrf_exempt</span></span></span> on this view as it disables any authentication and security checking. We’d never want to do this in production so we’re just using it as an example here. We’ll provide a Twilio-specific secure solution further on.</p>
<p>The final code (including imports) to reply to an SMS message looks like this:</p>

		<div id="crayon-56d5a0c751001255842749" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c751001255842749-1"><span class="crayon-p"># views.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751001255842749-2"> </p><p class="crayon-line" id="crayon-56d5a0c751001255842749-3"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">decorators</span><span class="crayon-sy">.</span><span class="crayon-e">csrf </span><span class="crayon-e">import </span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751001255842749-4"><span class="crayon-e">from </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">http </span><span class="crayon-e">import </span><span class="crayon-i">HttpResponse</span></p><p class="crayon-line" id="crayon-56d5a0c751001255842749-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751001255842749-6"><span class="crayon-sy">@</span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line" id="crayon-56d5a0c751001255842749-7"><span class="crayon-e">def </span><span class="crayon-e">sms</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751001255842749-8"><span class="crayon-h">    </span><span class="crayon-v">twiml</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'&lt;Response&gt;&lt;Message&gt;Hello from your Django app!&lt;/Message&gt;&lt;/Response&gt;'</span></p><p class="crayon-line" id="crayon-56d5a0c751001255842749-9"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">HttpResponse</span><span class="crayon-sy">(</span><span class="crayon-v">twiml</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">content_type</span><span class="crayon-o">=</span><span class="crayon-s">'text/xml'</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>If we try sending an SMS message to our number now we can see if we get a response.<br/>
<a href="http://twilioinc.wpengine.com/2014/04/building-a-simple-sms-message-application-with-twilio-and-django-2.html/djtwilio" rel="attachment wp-att-13174"><img class="aligncenter size-full wp-image-13174" src="https://www.twilio.com/blog/wp-content/uploads/2014/03/DJTwilio.png" alt="DJTwilio"/></a></p>
<p>Boom. It works.</p>
<h3>Introducing twilio-python</h3>
<p>Wouldn’t it be easier if we didn’t have to remember which TwiML verbs to use? Sometimes those strings can be huge and the chances of writing malformed XML increases the bigger the responses get.</p>
<p>Twilio provides <a href="https://www.twilio.com/docs/libraries">helper libraries</a> in a variety of languages such as Python, Ruby, Java and C#. The <a href="http://twilio-python.readthedocs.org/en/latest/#installation">twilio-python</a> package can help us build TwiML responses with its Response class.</p>
<p>We can install twilio-python using <a href="http://www.pip-installer.org/">pip</a>:</p>

		<div id="crayon-56d5a0c75100c507141269" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c75100c507141269-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">twilio</span><span class="crayon-o">-</span><span class="crayon-v">python</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Let’s see how twilio-python can make our previous code example easier.</p>

		<div id="crayon-56d5a0c751015853213095" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c751015853213095-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">decorators</span><span class="crayon-sy">.</span><span class="crayon-e">csrf </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751015853213095-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">django</span><span class="crayon-sy">.</span><span class="crayon-e">http </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">HttpResponse</span></p><p class="crayon-line" id="crayon-56d5a0c751015853213095-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751015853213095-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">twiml </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">Response</span></p><p class="crayon-line" id="crayon-56d5a0c751015853213095-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751015853213095-6"><span class="crayon-sy">@</span><span class="crayon-e">csrf_exempt</span></p><p class="crayon-line" id="crayon-56d5a0c751015853213095-7"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">sms</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751015853213095-8"><span class="crayon-h">    </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c751015853213095-9"><span class="crayon-h">    </span><span class="crayon-v">r</span><span class="crayon-sy">.</span><span class="crayon-e">message</span><span class="crayon-sy">(</span><span class="crayon-s">'Hello from your Django app!'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751015853213095-10"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">HttpResponse</span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-sy">.</span><span class="crayon-e">toxml</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">content_type</span><span class="crayon-o">=</span><span class="crayon-s">'text/xml'</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>That gives us cleaner code which is also pretty <a href="http://www.python.org/dev/peps/pep-0020/">pythonic</a> too. No need to write any XML: we just add different verbs to a response object and return it when we’re done.</p>
<h3>Django-Twilio To The Rescue</h3>
<p>The twilio-python package makes is easy to build TwiML, but what about Django-specific features? And what about that big security hole with CSRF tokens? Is there a way we can make it easier to use twilio in Django? There is indeed!</p>
<p><a href="http://django-twilio.readthedocs.org">Django-twilio</a>, by <a href="http://www.rdegges.com/">Randall Degges</a>, provides a collection of decorators for views that return TwiML or receive information from Twilio. We can use these decorators to clean up the code in our view function even more.</p>
<p>Just like twilio-python, we can install it with pip:</p>

		<div id="crayon-56d5a0c751020818435482" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c751020818435482-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">django</span><span class="crayon-o">-</span><span class="crayon-v">twilio</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Here is the previous code example modified one last time to include django-twilio and it’s features:</p>

		<div id="crayon-56d5a0c751029473527961" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c751029473527961-1"><span class="crayon-p"># views.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751029473527961-2"> </p><p class="crayon-line" id="crayon-56d5a0c751029473527961-3"><span class="crayon-p"># -*- coding: utf-8 -*-</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751029473527961-4"><span class="crayon-e">from </span><span class="crayon-v">django_twilio</span><span class="crayon-sy">.</span><span class="crayon-e">decorators </span><span class="crayon-e">import </span><span class="crayon-e">twilio_view</span></p><p class="crayon-line" id="crayon-56d5a0c751029473527961-5"><span class="crayon-e">from </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">twiml </span><span class="crayon-e">import </span><span class="crayon-i">Response</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751029473527961-6"> </p><p class="crayon-line" id="crayon-56d5a0c751029473527961-7"><span class="crayon-sy">@</span><span class="crayon-e">twilio_view</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751029473527961-8"><span class="crayon-e">def </span><span class="crayon-e">sms</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c751029473527961-9"><span class="crayon-h">    </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751029473527961-10"><span class="crayon-h">    </span><span class="crayon-v">r</span><span class="crayon-sy">.</span><span class="crayon-e">message</span><span class="crayon-sy">(</span><span class="crayon-s">'Hello from your Django app!'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c751029473527961-11"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">r</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The 
			<span id="crayon-56d5a0c751033880846205" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">twilio_view</span></span></span> decorator view provides some major benefits:<br/>
1. It ensures requests sent to the view originate from only twilio.com, this prevents attackers from spoofing a request to the view.<br/>
2. It turns off CSRF exemption in favour of the security in number 1, which is actually far more secure.<br/>
3. It sends your response back in a HttpResponse object with the appropriate content type.<br/>
4. Finally, it works in Django debug mode. You can test views just like a normal web page, even with the twilio_view decorator, just set DEBUG = True.</p>
<h3>Discovering Twilio Content In The Request</h3>
<p>Now that we can reply to an SMS, let’s figure out what Twilio sent to us in the request and reply with a personalised reply. This is one of my favourite features of Twilio: all the data delivered to you looks like a normal HTTP POST or GET <a href="https://www.twilio.com/docs/api/twiml/sms/twilio_request#request-parameters">request</a>.</p>
<p>At the top of our views, add the new imports:</p>

		<div id="crayon-56d5a0c75104e550956268" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c75104e550956268-1"><span class="crayon-e">from </span><span class="crayon-v">django_twilio</span><span class="crayon-sy">.</span><span class="crayon-e">decorators </span><span class="crayon-e">import </span><span class="crayon-e">twilio_view</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c75104e550956268-2"><span class="crayon-e">from </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">twiml </span><span class="crayon-e">import </span><span class="crayon-v">Response</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>With Django we can grab content in the request POST headers with the following code:</p>

		<div id="crayon-56d5a0c751058533751195" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c751058533751195-1"><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">POST</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'Body'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>This looks at the HTTP request data and returns the sms content (the Body value), otherwise it just returns an empty string. We can then send back a personalised message:</p>

		<div id="crayon-56d5a0c751062604271465" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c751062604271465-1"><span class="crayon-v">msg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Hey %s, how are you today?'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751062604271465-2"><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c751062604271465-3"><span class="crayon-v">r</span><span class="crayon-sy">.</span><span class="crayon-e">message</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c751062604271465-4"><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">r</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>So when a I send an SMS message with my name I will get an SMS reply like this:</p>
<p><em>Hello Paul, how are you today?</em></p>
<p>The complete code for this, with new lines highlighted:</p>

		<div id="crayon-56d5a0c75106c804160668" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c75106c804160668-1"><span class="crayon-p"># views.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c75106c804160668-2"> </p><p class="crayon-line" id="crayon-56d5a0c75106c804160668-3"><span class="crayon-e">from </span><span class="crayon-v">django_twilio</span><span class="crayon-sy">.</span><span class="crayon-e">decorators </span><span class="crayon-e">import </span><span class="crayon-e">twilio_view</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c75106c804160668-4"><span class="crayon-e">from </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">twiml </span><span class="crayon-e">import </span><span class="crayon-i">Response</span></p><p class="crayon-line" id="crayon-56d5a0c75106c804160668-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c75106c804160668-6"><span class="crayon-sy">@</span><span class="crayon-e">twilio_view</span></p><p class="crayon-line" id="crayon-56d5a0c75106c804160668-7"><span class="crayon-e">def </span><span class="crayon-e">sms</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c75106c804160668-8"><span class="crayon-h">    </span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">POST</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'Body'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c75106c804160668-9"><span class="crayon-h">    </span><span class="crayon-v">msg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Hey %s, how are you today?'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c75106c804160668-10"><span class="crayon-h">    </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c75106c804160668-11"><span class="crayon-h">    </span><span class="crayon-v">r</span><span class="crayon-sy">.</span><span class="crayon-e">message</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c75106c804160668-12"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">r</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<h3>What’s Next?</h3>
<p>We’ve demonstrated the basics of receiving and responding to SMS messages with Twilio and Django. You should now have the foundations required to build complex systems that leverage the telephony system: SMS opt-in/out subscription services, providing surveys via SMS or even SMS text adventure games like <a href="https://en.wikipedia.org/wiki/Zork">zork</a>. Go and explore with the Twilio API and see what you can build; it <a href="https://www.twilio.com/try-twilio">costs nothing to try it out</a>.</p>
<p>This code for this article can be found on <a href="https://github.com/phalt/twilio-django-part-1">Github</a>, so feel free to fork it and use it as a basis for your own app.</p>
<p>We’ll be continuing this series of posts related to Django in a few weeks by demonstrating how to build conference centres. Until then my fellow Djangonauts: enjoy your new skills.</p>
			</div>
					</div></body></html>