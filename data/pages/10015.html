<html><body><div><div id="example">
<h3>Example</h3>
<pre><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">from</span> <span class="nn">aiohttp_riak</span> <span class="kn">import</span> <span class="n">RiakHTTP</span><span class="p">,</span> <span class="n">Bucket</span>

<span class="n">async</span> <span class="k">def</span> <span class="nf">riak_requests</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">Bucket</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s1">'example'</span><span class="p">)</span>

    <span class="c1"># Secondary indexes</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">'example_bin'</span><span class="p">,</span> <span class="s1">'ex'</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'example_int'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">'val'</span><span class="p">,</span> <span class="p">[</span><span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'key2'</span><span class="p">,</span> <span class="s1">'val2'</span><span class="p">,</span> <span class="p">[</span><span class="n">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'key3'</span><span class="p">,</span> <span class="s1">'val3'</span><span class="p">,</span> <span class="n">indexes</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'KEYS'</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">'example_bin'</span><span class="p">,</span> <span class="s1">'ex'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'INDEX_BIN'</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">'example_int'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'INDEX_INT'</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>


    <span class="k">print</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'key2'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'DEL'</span><span class="p">,</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'key2'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'key2'</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">'BUCKETS'</span><span class="p">,</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">buckets</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'PING'</span><span class="p">,</span> <span class="n">await</span> <span class="n">client</span><span class="o">.</span><span class="n">ping</span><span class="p">())</span>

    <span class="n">props</span> <span class="o">=</span> <span class="n">await</span> <span class="n">bucket</span><span class="o">.</span><span class="n">props</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'PROPS'</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">rh</span> <span class="o">=</span> <span class="n">RiakHTTP</span><span class="p">(</span><span class="s1">'127.0.0.1'</span><span class="p">,</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
    <span class="n">riak_requests</span><span class="p">(</span><span class="n">rh</span><span class="p">))</span>

<span class="n">rh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
</div>
</div></body></html>