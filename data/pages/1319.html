<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-twitter-most-followed" class="anchor" href="#twitter-most-followed" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Twitter Most Followed</h1>

<h2><a id="user-content-rationale" class="anchor" href="#rationale" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Rationale</h2>

<p><strong>How to Find Out Who's Popular on Twitter.</strong> And why there's no point in doing it</p>

<blockquote>
<p>It’s easy if you consider the whole Twitterverse. You just look at the number of followers, and you’ll get @katyperry, @justinbieber, and @BarackObama. No surprise there, right?</p>

<p>But what if you want to focus on a particular group of Twitter users? Let’s take the Hacker News community. Which are the most followed accounts by the HNers? This is not a trivial exercise and we need a different approach, but if you’re a HNer, the result will be just as predictable.</p>
</blockquote>

<p>Read the whole story here: <a href="https://medium.com/@ducu/how-to-find-out-whos-popular-on-twitter-d659884fd942">https://medium.com/@ducu/how-to-find-out-whos-popular-on-twitter-d659884fd942</a></p>

<h2><a id="user-content-approach" class="anchor" href="#approach" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Approach</h2>

<p>Let's take the Hacker News community as our target group.</p>

<p>There is a Twitter account named <a href="https://twitter.com/newsyc20/">@newsyc20</a> (Hacker News 20 - "Tweeting Hacker News stories as soon as they reach 20 points."). We consider this as our <strong>source</strong>, and the followers of @newsyc20 as the HNers, our <strong>target group</strong>. To find out the top most followed accounts by our target group members, we get the complete lists of who each of them is following (aka friends), then we aggregate all those lists, counting the occurrences of each friend.</p>

<p>You can realize that the most followed account will be exactly @newsyc20, because all the members are following it. But who's on the 2nd and 3rd place? Who's in the top 100 most followed? This is what we're going to find out by running the routine below, a transcript from <a href="https://github.com/ducu/twitter-most-followed/blob/master/main.py">main.py</a></p>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># Step 1: Identify the source</span>
source_name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>newsyc20<span class="pl-pds">'</span></span> <span class="pl-c"># target group source</span>
source_id, source_data <span class="pl-k">=</span> load_user_data(<span class="pl-v">screen_name</span><span class="pl-k">=</span>source_name)

<span class="pl-c"># Step 2: Load target group members</span>
followers <span class="pl-k">=</span> load_followers(source_id) <span class="pl-c"># target group</span>

<span class="pl-c"># Step 3: Load friends of target group members</span>
<span class="pl-k">for</span> follower_id <span class="pl-k">in</span> followers:
    load_friends(<span class="pl-v">user_id</span><span class="pl-k">=</span>follower_id)

<span class="pl-c"># Step 4: Aggregate friends into top most followed</span>
aggregate_friends() <span class="pl-c"># count friend occurrences</span>
top_most_followed(<span class="pl-c1">100</span>) <span class="pl-c"># display results</span></pre></div>

<h2><a id="user-content-requirements" class="anchor" href="#requirements" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Requirements</h2>

<p>The Python script in this repo uses <a href="https://dev.twitter.com/docs/api/1.1">Twitter REST API</a> to get the data, and <a href="http://redis.io/">Redis</a> to store and aggregate it. To use Twitter API you need <a href="https://apps.twitter.com/">an existing application</a>, and <a href="https://dev.twitter.com/docs/auth/obtaining-access-tokens">some access tokens</a>.</p>

<p>There are a couple of performance issues though when dealing with big data sets.</p>

<p><strong>Twitter API Rate Limits</strong></p>

<p>We have 13.3K members in our HNers target group. In order to load the friends for each of these members (step 3), we're calling the Twitter API <a href="https://dev.twitter.com/docs/api/1.1/get/friends/ids">friends/ids</a> method. This method is rate limited at 15 calls/15 minutes/token. We have to perform about 15.3K calls, since one call returns at most 5000 items. The problem is that with a single access token, it would take 10 days and 16 hours to get all this data.</p>

<p><a href="https://github.com/tweepy/tweepy/">Tweepy</a> is the preferred Twitter API client for Python, and the current release works with a single access token. But here's a fork I created especially to extend Tweepy so it works with several access tokens in a round robin fashion transparently - <a href="https://github.com/svven/tweepy">https://github.com/svven/tweepy</a>. Using about four dozen tokens, the overall retrieval time was reduced to 5 hours (2 hours work time, 3 hours sleep). With about hundred tokens added to <code>RateLimitHandler</code>, you would get maximum efficiency out of a single Tweepy API object. See how it's done in <code>get_api()</code> from <a href="https://github.com/ducu/twitter-most-followed/blob/master/twitter.py">twitter.py</a>.</p>

<p><strong>Redis ZUNIONSTORE</strong></p>

<p>After storing all this data, we have about 12.4K simple sets of friend ids in Redis, one set for each of our target group members. We are short of almost 1K sets because there are that many protected Twitter accounts so we cannot get their friends from Twitter API. There's an average of 1.3K items per set, ranging from 1 to 8.6M maximum items, a total of 16.2M items.</p>

<p>Aggregating all these sets can be easily done using the <a href="http://redis.io/commands/ZUNIONSTORE">ZUNIONSTORE</a> command with the default weight of 1. See <code>RedisStorage.set_most_followed()</code> method in <a href="https://github.com/ducu/twitter-most-followed/blob/master/storage.py">storage.py</a>. The problem is that for this workload, ZUNIONSTORE took more than 1 hour to execute on my 4GB machine. That was surprisingly slow, having a recent stable release of Redis, ver 2.8.9.</p>

<p>It turned out that a <a href="https://github.com/antirez/redis/pull/1786">performance patch</a> for this command has been recently added, but it is only available in the beta 8 release of Redis, ver 3.0.0. You can read about it in the <a href="https://raw.githubusercontent.com/antirez/redis/3.0/00-RELEASENOTES">release notes</a>. Having installed this, running the ZUNIONSTORE on the same data set took less than 2 minutes.</p>

<hr/>

<p>To conclude, in order to run this exercise for a big data set, make sure you have a bunch of access tokens that you can use in <a href="https://github.com/ducu/twitter-most-followed/blob/master/config.py">config.py</a>, and install <a href="https://github.com/antirez/redis/archive/3.0.0-beta8.tar.gz">Redis 3.0.0 beta 8</a>. Then <code>pip install -r requirements.txt</code> in your <a href="http://virtualenv.readthedocs.org/en/latest/virtualenv.html">virtualenv</a> so you have following packages</p>

<pre><code>hiredis==0.1.4
redis==2.10.1
git+https://github.com/svven/tweepy.git#egg=tweepy
</code></pre>

<h2><a id="user-content-credits" class="anchor" href="#credits" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Credits</h2>

<p>Thanks to Jeff Miller (<a href="https://twitter.com/JeffMiller">@JeffMiller</a>) for @newsyc20. It's one of the best Hacker News Twitter bots. Jeff actually did a similar analysis on the Hacker News community, but with a slightly different <a href="http://talkfast.org/2010/07/28/twitter-users-most-followed-by-readers-of-hacker-news/">approach</a>.</p>

<p>Many thanks also to Josiah Carlson (<a href="https://twitter.com/dr_josiah">@dr_josiah</a>) for his valuable support on Redis related issues.</p>

<h2><a id="user-content-results" class="anchor" href="#results" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Results</h2>

<p>Finally here's the top 100 most followed accounts by the Hacker News community.</p>

<p>Followers and Friends columns show the total count.<br/>
Popularity equals the number of followers only from within our HNers target group. The results are ranked by this value. Protected Twitter accounts were not considered, that's where the difference between @newsyc20 popularity (12476) and followers count (13377) is coming from.</p>

<p>I created a Twitter list with this top 100 for your convenience.
You can subscribe to it here - <a href="https://twitter.com/ducu/lists/hners-most-followed">https://twitter.com/ducu/lists/hners-most-followed</a></p>

<p><a href="mailto:alexandru.stanciu@gmail.com?Subject=Twitter%20Most%20Followed">Drop me a line</a> if you want more data, I have the complete top HNers' most followed, or if you need any help running this exercise. You can easily change the starting source, just replace 'newsyc20' in main.py with any other Twitter handle, and find out the results for yourself.</p>

<p>Cheers, <a href="https://twitter.com/ducu">@ducu</a></p>


</article>
  </div></body></html>