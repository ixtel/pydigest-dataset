<html><body><div><div class="entry-content">

                

                <p>PIL - мощная библиотека для работы с изображениями. С помощью этой библиотеки можно выделять необходимые части картинок, конвертировать между форматами, рисовать, накладывать слои. </p>
<p>В качестве наложения слоев хочется привести удачно позаимствованный пример наложения водяного знака на изображение</p>
<div class="highlight"><pre><span class="c1"># coding=utf-8</span>

<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageEnhance</span>

<span class="sd">"""</span>
<span class="sd">image - картинка, на которую накладываете изображение</span>
<span class="sd">watermark - картинка, которую накладываете</span>
<span class="sd">opacity - прозрачность</span>
<span class="sd">wm_interval - интервал между изображениями watermark</span>


<span class="sd">!!! watermark накладывается рекурсивно по всему полю изображения. Функция возвращает уже готовое изображение, которое надо еще сохранить.</span>
<span class="sd">!!! если что-то не получается, сперва проверьте, может ли ваш PIL обрабатывать изображения jpeg, png, gif. бывает что PIL установлен, но всем любимые форматы вовсе не поддерживает, т.к. не (корректно) установлен libjpeg и т.п.</span>


<span class="sd">"""</span>

<span class="k">def</span> <span class="nf">add_watermark</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">watermark</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wm_interval</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

    <span class="k">assert</span> <span class="n">opacity</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">opacity</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">opacity</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">watermark</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s1">'RGBA'</span><span class="p">:</span>
            <span class="n">watermark</span> <span class="o">=</span> <span class="n">watermark</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">'RGBA'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">watermark</span> <span class="o">=</span> <span class="n">watermark</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">watermark</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">ImageEnhance</span><span class="o">.</span><span class="n">Brightness</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">.</span><span class="n">enhance</span><span class="p">(</span><span class="n">opacity</span><span class="p">)</span>
        <span class="n">watermark</span><span class="o">.</span><span class="n">putalpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'RGBA'</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">watermark</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">wm_interval</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">watermark</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">wm_interval</span><span class="p">):</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">watermark</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">composite</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span>  <span class="n">image</span><span class="p">,</span>  <span class="n">layer</span><span class="p">)</span>



<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"asd.jpg"</span><span class="p">)</span>
    <span class="n">watermark</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"watermark.png"</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">add_watermark</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">watermark</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'result.png'</span><span class="p">)</span>
</pre></div>


<p>Результат</p>
<p><img alt="Image" src="http://old.pynsk.ru/images/posts/watermark_result.png"/></p>
            </div>
            
</div></body></html>