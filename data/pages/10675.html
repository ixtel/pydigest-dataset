<html><body><div><div class="blog-content">

                        

                            
                        



                        
                            
                                <blockquote>
<p>Уже давно фраза "я тебя вычислю по IP" реальна. </p>
</blockquote>
<p>Хочется представить очень простой инструмент для определения местоположения по IP - GeoIP.
Рассматривать GeoIP стоит как базу данных соответствия интернет и физических адресов. 
Базы могут отличатся точностью - одна точно определяет страну, а друга может дать точность до улицы.</p>
<p>Одним из лидеров в этой области - MaxMind. Компания выпускает несколько баз, в том числе и бесплатную.</p>
<blockquote>
<p>Базы можно скачать по ссылке <a href="https://dev.maxmind.com/geoip/legacy/geolite/">https://dev.maxmind.com/geoip/legacy/geolite/</a></p>
</blockquote>
<p>Популярные языки (такие как С, Java, Python, PHP) поддерживают работу с продуктом (есть набор привязок и к другим языкам). Но не только языки - nginx отлично работает с GeoIP (и apache2 тоже).</p>
<p>Пример на Python (модуль <code>geoip</code>):</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">geoip2.database</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">geoip2</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="s">'/path/to/GeoLite2-City.mmdb'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Replace "city" with the method corresponding to the database</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># that you are using, e.g., "country".</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">city</span><span class="p">(</span><span class="s">'128.101.101.101'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">iso_code</span>
<span class="s">'US'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">name</span>
<span class="s">'United States'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s">'zh-CN'</span><span class="p">]</span>
<span class="s">u'美国'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">subdivisions</span><span class="o">.</span><span class="n">most_specific</span><span class="o">.</span><span class="n">name</span>
<span class="s">'Minnesota'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">subdivisions</span><span class="o">.</span><span class="n">most_specific</span><span class="o">.</span><span class="n">iso_code</span>
<span class="s">'MN'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">name</span>
<span class="s">'Minneapolis'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">postal</span><span class="o">.</span><span class="n">code</span>
<span class="s">'55455'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">latitude</span>
<span class="mf">44.9733</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">longitude</span>
<span class="o">-</span><span class="mf">93.2323</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<p>Как видно из примера, в базе хранится много полезного. </p>
<p>Приведу примеры использования базы GeoIP:</p>
<ul>
<li>С помощью nginx определять страну пользователя и делать редирект на необходимую языковую версию сайта</li>
<li>Для решения задачи http://pynsk.ru/tasks/9/ (Cистема "умная страница")</li>
<li>Реализация таргетирования контента/рекламы</li>
</ul>
<p>Ссылки:</p>

                            
                        



                        

                            
                            <footer class="post-info">
                                <span class="label label-default">Дата</span>
                            <span class="published">
                                <i class="fa fa-calendar"/><time>
                                2016-02-13 12:00:00</time>
                            </span>


                                <span class="label label-default">Категории</span>

                                
                                    
                                        
                                            <a href="/blog/category/poleznye-instrumenty/">Полезные инструменты</a>
                                            
                                        
                                    
                                


                                <span class="label label-default">Теги</span>

                                <a href="/blog/tag/geoip/">geoip</a>
                                         / 
                                    

                                        <a href="/blog/tag/maxmind/">maxmind</a>

                            </footer>
                        


                        
                            
                        

                        
                            
                            <a class="btn btn-sm share-twitter" target="_blank" href="http://twitter.com/home?status=https%3A//pynsk.ru/blog/2016/02/13/geoip/%20%D0%9F%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D1%8B%D0%B5%20%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B%3A%20GeoIP%20-%20%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%8F%D0%B5%D0%BC%20%D0%B3%D0%BE%D1%80%D0%BE%D0%B4%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%20%D0%BF%D0%BE%20IP">Опубликовать в Twitter</a>
                            <a class="btn btn-sm share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=https://pynsk.ru/blog/2016/02/13/geoip/&amp;t=%D0%9F%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D1%8B%D0%B5%20%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B%3A%20GeoIP%20-%20%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%8F%D0%B5%D0%BC%20%D0%B3%D0%BE%D1%80%D0%BE%D0%B4%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%20%D0%BF%D0%BE%20IP">Опубликовать в Facebook</a>
                        

                        
                            
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        


                        <hr/>
                        
                        <hr/>

                        
                            

            </div>

        </div></body></html>