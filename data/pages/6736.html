<html><body><div><div class="content html_format"><p>
      Предположим, у вас есть Ubuntu, в котором нужно развернуть Nginx с Flask-приложением. Вам необходимо использовать WSGI сервер, например, Gunicorn. Gunicorn (Green Unicorn) — WSGI HTTP сервер на Python для UNIX систем. Представляю вольный перевод статьи Onur Güzel </p><a href="http://www.onurguzel.com/how-to-run-flask-applications-with-nginx-using-gunicorn/">«How to Run Flask Applications with Nginx Using Gunicorn»</a><p>, где шаг за шагом показано процесс развертывания.
</p><a name="habracut"/><hr/>
<h2>Шаг 0: Требования</h2><p>
Мы будет использовать virtualenv для работы с виртуальным окружением Python и pip для работы с Python-пакетами. Установим их введя в терминал следующую команду:

</p><pre><code class="bash">sudo apt-get install python-virtualenv python-pip
</code></pre><p>
Создадим виртуальное окружение и активируем его:

</p><pre><code class="bash">virtualenv hello
source hello/bin/activate
</code></pre><p>
Замечаем, что у нас prompt теперь начинается с названия виртуальной среды.
</p><hr/>
<h2>Шаг 1: Приложение</h2><p>
Установим Flask:

</p><pre><code class="bash">pip install Flask
</code></pre><p>
После установки Flask, используя pip, вы можете написать следующий код в </p><i>hello.py</i><p> и запустить его:

</p><pre><code class="python">from flask import Flask
app = Flask(__name__)
@app.route('/')
def hello():
    return "Hello world!"
 
if __name__ == '__main__':
    app.run()
</code></pre><p>
Flask имеет встроенный веб-сервер, который позволяет запускать приложения. Тем не менее, он не является масштабируемым и не подходит для production. С другой стороны, есть Gunicorn, который является готовым к использованию для production и обеспечивает масштабируемость. 
</p><hr/>
<h2>Шаг 2: Gunicorn</h2><p>
Установим Gunicorn:

</p><pre><code class="bash">pip install gunicorn
</code></pre><p>
Для того чтобы наше Flask-приложение работало с Gunicorn, нужно добавить 2 и 9 строки из кода в </p><i>hello.py</i><p>:

</p><pre><code class="python">from flask import Flask
from werkzeug.contrib.fixers import ProxyFix
app = Flask(__name__)
 
@app.route('/')
def hello():
    return "Hello world!"

app.wsgi_app = ProxyFix(app.wsgi_app)
if __name__ == '__main__':
    app.run()
</code></pre><p>
Теперь мы можем запустить приложение с Gunicorn:

</p><pre><code class="bash">gunicorn hello:app
</code></pre><p>
Где </p><i>hello</i><p> это имя python-файла(без расширения). И </p><i>app</i><p> это имя Flask-объекта. 
</p><hr/>
<h2>Шаг 3: Nginx</h2><p>
Создадим новую конфигурацию сервера и сохраним файл в:
</p><i>/etc/nginx/sites-available/hello.conf</i><p>
Содержимое </p><i>hello.conf</i><p>:

</p><pre><code class="nginx">server {
    listen 80;
    server_name hello.itu24.com;
 
    root /path/to/hello;
 
    access_log /path/to/hello/logs/access.log;
    error_log /path/to/hello/logs/error.log;
 
    location / {
        proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        if (!-f $request_filename) {
            proxy_pass http://127.0.0.1:8000;
            break;
        }
    }
}
</code></pre><p>
Создадим символическую ссылку для директории sites-enabled:

</p><pre><code class="bash">sudo ln -s /etc/nginx/sites-available/hello.conf /etc/nginx/sites-enabled/
</code></pre><p>
Проверим конфигурацию на ошибки:

</p><pre><code class="bash">nginx -t
</code></pre><p>
Если с конфигурацией все нормально, вы можете перезапустить Nginx и получить развернутое приложение.
      </p><p class="clear"/>
    </div>

    
  </div></body></html>