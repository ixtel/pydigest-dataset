<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-xpyth" class="anchor" href="#xpyth" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>xpyth</h1>

<p>A module for querying the DOM tree and writing XPath expressions using native Python syntax.</p>

<h4><a id="user-content-disclaimer" class="anchor" href="#disclaimer" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Disclaimer</h4>

<p><strong>xpyth</strong> is poorly tested, has known issues, and in general should not be used in production.</p>

<h2><a id="user-content-example-usage" class="anchor" href="#example-usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Example usage</h2>

<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> xpyth <span class="pl-k">import</span> xpath, <span class="pl-c1">DOM</span>, <span class="pl-c1">X</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> xpath(<span class="pl-c1">X</span> <span class="pl-k">for</span> <span class="pl-c1">X</span> <span class="pl-k">in</span> <span class="pl-c1">DOM</span> <span class="pl-k">if</span> <span class="pl-c1">X</span>.name <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>main<span class="pl-pds">'</span></span>)
<span class="pl-s"><span class="pl-pds">"</span>//*[@name='main']<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> xpath(span <span class="pl-k">for</span> div <span class="pl-k">in</span> <span class="pl-c1">DOM</span> <span class="pl-k">for</span> span <span class="pl-k">in</span> div <span class="pl-k">if</span> div.id <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>main<span class="pl-pds">'</span></span>)
<span class="pl-s"><span class="pl-pds">"</span>//div[@id='main']//span<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> xpath(a <span class="pl-k">for</span> a <span class="pl-k">in</span> <span class="pl-c1">DOM</span> <span class="pl-k">if</span> <span class="pl-s"><span class="pl-pds">'</span>.com<span class="pl-pds">'</span></span> <span class="pl-k">not</span> <span class="pl-k">in</span> a.href)
<span class="pl-s"><span class="pl-pds">"</span>//a[not(contains(@href, '.com'))]<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> xpath(a.href <span class="pl-k">for</span> a <span class="pl-k">in</span> <span class="pl-c1">DOM</span> <span class="pl-k">if</span> <span class="pl-c1">any</span>(p <span class="pl-k">for</span> p <span class="pl-k">in</span> a.ancestors <span class="pl-k">if</span> p.id))
<span class="pl-s"><span class="pl-pds">"</span>//a[./ancestor::p[@id]]/@href<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> xpath(<span class="pl-c1">X</span>.data<span class="pl-k">-</span>bind <span class="pl-k">for</span> <span class="pl-c1">X</span> <span class="pl-k">in</span> <span class="pl-c1">DOM</span> <span class="pl-k">if</span> <span class="pl-c1">X</span>.data<span class="pl-k">-</span>bind <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>1<span class="pl-pds">'</span></span>)
<span class="pl-s"><span class="pl-pds">"</span>//*[@data-bind='1']/@data-bind<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> xpath(
<span class="pl-c1">...</span>     form.action 
<span class="pl-c1">...</span>     <span class="pl-k">for</span> form <span class="pl-k">in</span> <span class="pl-c1">DOM</span> 
<span class="pl-c1">...</span>     <span class="pl-k">if</span> <span class="pl-c1">all</span>(
<span class="pl-c1">...</span>         <span class="pl-c1">input</span> 
<span class="pl-c1">...</span>         <span class="pl-k">for</span> <span class="pl-c1">input</span> <span class="pl-k">in</span> form.children 
<span class="pl-c1">...</span>         <span class="pl-k">if</span> <span class="pl-c1">input</span>.value <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>
<span class="pl-c1">...</span>     )
<span class="pl-c1">...</span> )
<span class="pl-s"><span class="pl-pds">"</span>//form[not(./input[not(@value='a')])]/@action<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> allowed_ids <span class="pl-k">=</span> <span class="pl-c1">list</span>(<span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>)
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> xpath(<span class="pl-c1">X</span> <span class="pl-k">for</span> <span class="pl-c1">X</span> <span class="pl-k">in</span> <span class="pl-c1">DOM</span> <span class="pl-k">if</span> <span class="pl-c1">X</span>.id <span class="pl-k">in</span> allowed_ids)
<span class="pl-s"><span class="pl-pds">"</span>//*[@id='a' or @id='b' or @id='c']<span class="pl-pds">"</span></span></pre></div>

<h2><a id="user-content-motivation" class="anchor" href="#motivation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Motivation</h2>

<p>XPath is the de facto standard in querying XML and HTML documents. In Python (and most other languages), XPath expressions are represented as strings; this not only constitutes a potential security threat, but also means that developers are denied standard text-editor and IDE features such as syntax highlighting and autocomplete when writing XPaths. Furthermore, having to become familiar with XPath (or CSS selectors) presents a barrier to entry for developers who want to interact with the web.</p>

<p><a href="https://msdn.microsoft.com/en-us/library/bb397933.aspx">Great inroads</a> have been made in various programming languages in allowing the use of native list-comprehension-like syntax to generate SQL queries. <strong>xpyth</strong> piggybacks off one such effort, <a href="http://ponyorm.com/">Pony</a>, to extend this functionality to XPath. <strong>Now anyone familiar with Python comprehension syntax can query XML/HTML documents quickly and easily</strong>. Moreover, <strong>xpyth</strong> integrates with the popular <a href="http://lxml.de/">lxml</a> library to enable developers to go beyond the querying capabilities of XPath (when necessary).</p>

<h2><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h2>

<pre><code>easy_install xpyth
</code></pre>

<p><strong>xpyth</strong> has the following dependencies:</p>

<pre><code>lxml (3.4.2)
pony (0.6.1)
</code></pre>

<h2><a id="user-content-use-with-lxml" class="anchor" href="#use-with-lxml" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Use with lxml</h2>

<p><strong>xpyth</strong> supports querying lxml <code>ElementTree</code>s using the <code>query</code> function. For example, given a document</p>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">html</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">'</span>main<span class="pl-pds">'</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">'</span>main<span class="pl-pds">'</span></span>&gt;
        &lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">'</span>http://www.google.com<span class="pl-pds">'</span></span>&gt;Google&lt;/<span class="pl-ent">a</span>&gt;
        &lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">'</span>http://www.chasestevens.com<span class="pl-pds">'</span></span>&gt;Not Google&lt;/<span class="pl-ent">a</span>&gt;
        &lt;<span class="pl-ent">p</span>&gt;Lorem ipsum&lt;/<span class="pl-ent">p</span>&gt;
        &lt;<span class="pl-ent">p</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>&gt;no numbers here&lt;/<span class="pl-ent">p</span>&gt;
        &lt;<span class="pl-ent">p</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">'</span>numbers_only<span class="pl-pds">'</span></span>&gt;123&lt;/<span class="pl-ent">p</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">'</span>secondary<span class="pl-pds">'</span></span>&gt;
        &lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">'</span>http://www.google.org<span class="pl-pds">'</span></span>&gt;Google Charity&lt;/<span class="pl-ent">a</span>&gt;
        &lt;<span class="pl-ent">a</span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">'</span>http://www.chasestevens.org<span class="pl-pds">'</span></span>&gt;Broken link!&lt;/<span class="pl-ent">a</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>

<p>accessible as the <code>ElementTree</code> <code>tree</code>, the following can be executed:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c1">len</span>(query(a <span class="pl-k">for</span> a <span class="pl-k">in</span> tree))
<span class="pl-c1">4</span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> query(a <span class="pl-k">for</span> a <span class="pl-k">in</span> tree <span class="pl-k">if</span> <span class="pl-s"><span class="pl-pds">'</span>Not Google<span class="pl-pds">'</span></span> <span class="pl-k">not</span> <span class="pl-k">in</span> a.text)[<span class="pl-c1">0</span>].attrib.get(<span class="pl-s"><span class="pl-pds">'</span>href<span class="pl-pds">'</span></span>)
<span class="pl-s"><span class="pl-pds">"</span>http://www.google.com<span class="pl-pds">"</span></span>
<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-c1">next</span>(
<span class="pl-c1">...</span>     node 
<span class="pl-c1">...</span>     <span class="pl-k">for</span> node <span class="pl-k">in</span> 
<span class="pl-c1">...</span>     query(
<span class="pl-c1">...</span>         p 
<span class="pl-c1">...</span>         <span class="pl-k">for</span> p <span class="pl-k">in</span> 
<span class="pl-c1">...</span>         tree 
<span class="pl-c1">...</span>         <span class="pl-k">if</span> p.id
<span class="pl-c1">...</span>     ) 
<span class="pl-c1">...</span>     <span class="pl-k">if</span> re.match(<span class="pl-sr"><span class="pl-k">r</span><span class="pl-pds">'</span><span class="pl-c1">\D</span><span class="pl-k">+</span><span class="pl-pds">'</span></span>, node.attrib.get(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>))
<span class="pl-c1">...</span> ).text
<span class="pl-s"><span class="pl-pds">"</span>123<span class="pl-pds">"</span></span></pre></div>

<h2><a id="user-content-known-issues" class="anchor" href="#known-issues" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Known Issues</h2>



<h2><a id="user-content-contacts" class="anchor" href="#contacts" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Contacts</h2>


</article>
  </div></body></html>