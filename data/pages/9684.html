<html><body><div><div><p>If enabled, the worker sends messages about what the worker is doing.
These messages are called “events”.
The events are used by real-time monitors to show what the
cluster is doing, but they are not very useful for monitoring
over a longer period of time.  Snapshots
lets you take “pictures” of the clusters state at regular intervals.
This can then be stored in a database to generate statistics
with, or even monitoring over longer time periods.</p>
<p>django-celery now comes with a Celery monitor for the Django
Admin interface. To use this you need to run the django-celery
snapshot camera, which stores snapshots to the database at configurable
intervals.</p>
<p>To use the Django admin monitor you need to do the following:</p>
<ol>
<li><p>Create the new database tables:</p>
<blockquote>
<div><div><div><pre><span/><span>$</span> python manage.py syncdb
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Start the django-celery snapshot camera:</p>
<blockquote>
<div><div><div><pre><span/><span>$</span> python manage.py celerycam
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Open up the django admin to monitor your cluster.</p>
</li>
</ol>
<p>The admin interface shows tasks, worker nodes, and even
lets you perform some actions, like revoking and rate limiting tasks,
and shutting down worker nodes.</p>
<p>There’s also a Debian init.d script for <code><span>events</span></code> available,
see <span>daemonizing</span> for more information.</p>
<p>New command-line arguments to celeryev:</p>
<blockquote>
<div><ul>
<li><code><span>-c|--camera</span></code>: Snapshot camera class to use.</li>
<li><code><span>--logfile|-f</span></code>: Log file</li>
<li><code><span>--loglevel|-l</span></code>: Log level</li>
<li><code><span>--maxrate|-r</span></code>: Shutter rate limit.</li>
<li><code><span>--freq|-F</span></code>: Shutter frequency</li>
</ul>
</div></blockquote>
<p>The <code><span>--camera</span></code> argument is the name of a class used to take
snapshots with. It must support the interface defined by
<code><span>celery.events.snapshot.Polaroid</span></code>.</p>
<p>Shutter frequency controls how often the camera thread wakes up,
while the rate limit controls how often it will actually take
a snapshot.
The rate limit can be an integer (snapshots/s), or a rate limit string
which has the same syntax as the task rate limit strings (<cite>“200/m”</cite>,
<cite>“10/s”</cite>, <cite>“1/h”,</cite> etc).</p>
<p>For the Django camera case, this rate limit can be used to control
how often the snapshots are written to the database, and the frequency
used to control how often the thread wakes up to check if there’s
anything new.</p>
<p>The rate limit is off by default, which means it will take a snapshot
for every <code><span>--frequency</span></code> seconds.</p>
</div></div></body></html>