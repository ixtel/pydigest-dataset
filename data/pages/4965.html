<html><body><div><article id="post-9" class="post-9 post type-post status-publish format-standard hentry category-uncategorised">
	
	<header class="entry-header">
		<h1 class="entry-title">Download from dropbox and post in slack</h1>	</header>

	<div class="entry-content">
		<p>We’ve been running a fork of <a href="https://github.com/llimllib/limbo" target="_blank">Limbo </a>on our slack team for a while now. We’ve also been using our #general channel as a “landing page” for our team, with helpful information in it, to help new members. After getting annoyed at having to repost the welcome message every 10k messages (being on a free team) I decided to write a script to do it automatically.</p>
<p>Required Libraries:</p>
<ul>
<li>requests</li>
<li>shutil</li>
<li>docx</li>
<li>Limbo</li>
</ul>
<pre>def handle_message(event, server):
    # ignore bot messages and edits
    subtype = event.get("subtype", "")
    with open("msg_count.txt", "r+") as f:
        try:
            msg_count = int(f.read().strip())
        except Exception:
            msg_count = 0


    # My code starts here.
    msg_count +=1
    msg_count %= 10000

    with open("msg_count.txt", "w+") as f:
        f.write(str(msg_count))

    if not msg_count:
        url = "https://www.dropbox.com/s/folder/filename.docx?dl=1" #dl=1 is important! 
        data = requests.get(url, stream=True)
        with open("message.docx", "wb") as f:
            shutil.copyfileobj(data.raw, f)
            
        document = docx.Document("message.docx")
        text=""
        for paragraph in document.paragraphs:
            text += "{}\n".format(paragraph.text)
            
        server.slack.rtm_send_message("channel_id", text)
    # After this line, it continues and looks for the messages, and plugins that are relevant.</pre>
<p> </p>
<p> </p>
<p> </p>
	</div>

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="http://code.tetraetc.com/2015/06/17/download-from-dropbox-and-post-in-slack/" rel="bookmark"><time class="entry-date published updated" datetime="2015-06-17T13:29:58+00:00">June 17, 2015</time></a></span><span class="byline"><span class="author vcard"><span class="screen-reader-text">Author </span><a class="url fn n" href="http://code.tetraetc.com/author/tetraetc/">tetraetc</a></span></span>			</footer>

</article>

</div></body></html>