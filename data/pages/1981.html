<html><body><div><article class="col-md-10 col-md-offset-1">
            


<p>Data analysis libraries for Python keep getting better and better. <code>pandas</code>
is now on 0.15, <code>scikit-learn</code> continues to pick up converts, and a number of
visualization libraries have started to emerge: for example, our own baby, <a href="../posts/ggplot-for-python.html" target="_blank"><code>ggplot</code></a>, 
and others like <a href="http://web.stanford.edu/~mwaskom/software/seaborn/" target="_blank">seaborn</a>.
But there's still one subject that's practically synonymous with data analysis
where there aren't any new, killer libraries: databases.</p>
<p>There are some <a href="http://docs.python-guide.org/en/latest/scenarios/db/" target="_blank">great Python database libraries</a>
(<a href="http://www.sqlalchemy.org/" target="_blank">SQLAlchemy</a> instantly comes to mind), but none
are focused on using Python as a means of exploring and analyzing data.</p>
<h3>Introducing <code>db.py</code></h3>
<p>So today we're introducing <a href="https://github.com/yhat/db.py" target="_blank">db.py</a>, a library
built for doing exactly that! <code>db.py</code> does handy stuff like:</p>
<ul>
<li>Manages/remembers your db connection strings</li>
<li>Lets you easily search through your schema</li>
<li>Allows for tab-completion for table and column names</li>
<li>Integrates with IPython, <code>pandas</code>, and is built for interactive programming</li>
<li>Works with most relational databases</li>
</ul>
<p>To get started, just run:</p>
<pre><code>$ pip install db.py
</code></pre>
<h3>Connecting to your Database</h3>
<p>First things first: you need to connect to your database. This can be much 
tricker than it should be. Dealing with connection strings is never fun--how 
many times have you forgotten your password (or even your username) for a
database. <code>db.py</code> makes it as straight forward as possible and will always 
revert to "reasonable defaults". For example, the default MySQL port is 3306. If
you forget to specify a port, <code>db.py</code> will use 3306 as a default.</p>
<pre><code>&gt;&gt;&gt; from db import DB
&gt;&gt;&gt; db = DB(username="kermit", password="rainbowconnection", hostname="db.themuppets.com",
            dbname="muppetdb", dbtype="mysql")
Refreshing schema. Please wait...done!
&gt;&gt;&gt; db
DB[mysql][db.themuppets.com]:3306 &gt; kermit@muppetdb
</code></pre>
<p><code>db.py</code> will also save your credentials so you don't have to paste them into 
every script. Now you'll never have to remember any of that connection stuff
again.</p>
<pre><code>&gt;&gt;&gt; db.save_credentials(profile="muppets")
</code></pre>
<p>Open a new session, load your profile, and voilà!</p>
<pre><code>&gt;&gt;&gt; from db import DB
&gt;&gt;&gt; db = DB(profile="muppets")
Refreshing schema. Please wait...done!
&gt;&gt;&gt; db
DB[mysql][db.themuppets.com]:3306 &gt; kermit@muppetdb
</code></pre>
<p><img alt="" src="../static/img/xhibit-db.jpg"/>
</p><center>And by database we mean dotfile.</center>
<h3>Exploring Tables and Columns</h3>
<p>Ever forget the name of a column? Or even forget the names of what table you're 
trying to query? Me too. <code>db.py</code> comes with a set of functions for navigating
your database's schema.</p>
<p><strong>NOTE</strong>: For this post we're going to use the <a href="http://chinookdatabase.codeplex.com/" target="_blank">Chinook Database</a>.
It ships with <code>db.py</code> and is commonly used as an example database.</p>
<pre><code>&gt;&gt;&gt; from db import DemoDB # this is the Chinook DB and is used in the db.py docs/examples
&gt;&gt;&gt; db = DemoDB()
Indexing schema. This will take a second...finished!
&gt;&gt;&gt; db.find_table("A*")
+--------+--------------------------+
| Table  | Columns                  |
+--------+--------------------------+
| Album  | AlbumId, Title, ArtistId |
| Artist | ArtistId, Name           |
+--------+--------------------------+
</code></pre>
<p><img alt="" src="../static/img/simpsons-sql.gif"/></p>
<p>Ever forget how to join your company's <code>prod_users</code>, <code>prod_trans_monthly</code>,
and <code>prod_accounts</code> tables together? (a better question might be: have you
<em>ever</em> remembered?)</p>
<p><img alt="" src="../static/img/southpark-sql.png"/></p>
<p>No worries, <code>db.py</code> has got you covered!</p>
<pre><code>&gt;&gt;&gt; db.tables.Artist
+----------------------------------------------------------+
|                          Artist                          |
+----------+---------------+--------------+----------------+
| Column   | Type          | Foreign Keys | Reference Keys |
+----------+---------------+--------------+----------------+
| ArtistId | INTEGER       |              | Album.ArtistId |
| Name     | NVARCHAR(120) |              |                |
+----------+---------------+--------------+----------------+
&gt;&gt;&gt; db.find_column("*Id")
+---------------+---------------+---------+
| Table         |  Column Name  | Type    |
+---------------+---------------+---------+
| Album         |    AlbumId    | INTEGER |
| Album         |    ArtistId   | INTEGER |
| Artist        |    ArtistId   | INTEGER |
| Customer      |  SupportRepId | INTEGER |
| Customer      |   CustomerId  | INTEGER |
| Employee      |   EmployeeId  | INTEGER |
| Genre         |    GenreId    | INTEGER |
| Invoice       |   InvoiceId   | INTEGER |
| Invoice       |   CustomerId  | INTEGER |
| InvoiceLine   |   InvoiceId   | INTEGER |
| InvoiceLine   |    TrackId    | INTEGER |
| InvoiceLine   | InvoiceLineId | INTEGER |
| MediaType     |  MediaTypeId  | INTEGER |
| Playlist      |   PlaylistId  | INTEGER |
| PlaylistTrack |    TrackId    | INTEGER |
| PlaylistTrack |   PlaylistId  | INTEGER |
| Track         |  MediaTypeId  | INTEGER |
| Track         |    TrackId    | INTEGER |
| Track         |    AlbumId    | INTEGER |
| Track         |    GenreId    | INTEGER |
+---------------+---------------+---------+
</code></pre>
<h3>Tab Completion</h3>
<p><code>db.py</code> also identifies and loads schema info about all of the tables in your 
database and makes them attributes of the <code>DB()</code>. It works with IPython's
type-ahead functionality, so when you're mucking around in IPython Notebook 
or in Terminal, you'll be able to see all of the tables and columns in your 
database.</p>
<p><img alt="" src="../static/img/dbpy-type-ahead.png"/></p>
<p>You can also take a look at all of your tables by accessing the <code>tables</code>
variable.</p>
<pre><code>&gt;&gt;&gt; db.tables
+---------------+----------------------------------------------------------------------------------+
| Table         | Columns                                                                          |
+---------------+----------------------------------------------------------------------------------+
| Album         | AlbumId, Title, ArtistId                                                         |
| Artist        | ArtistId, Name                                                                   |
| Customer      | CustomerId, FirstName, LastName, Company, Address, City, State, Country, PostalC |
|               | ode, Phone, Fax, Email, SupportRepId                                             |
| Employee      | EmployeeId, LastName, FirstName, Title, ReportsTo, BirthDate, HireDate, Address, |
|               |  City, State, Country, PostalCode, Phone, Fax, Email                             |
| Genre         | GenreId, Name                                                                    |
| Invoice       | InvoiceId, CustomerId, InvoiceDate, BillingAddress, BillingCity, BillingState, B |
|               | illingCountry, BillingPostalCode, Total                                          |
| InvoiceLine   | InvoiceLineId, InvoiceId, TrackId, UnitPrice, Quantity                           |
| MediaType     | MediaTypeId, Name                                                                |
| Playlist      | PlaylistId, Name                                                                 |
| PlaylistTrack | PlaylistId, TrackId                                                              |
| Track         | TrackId, Name, AlbumId, MediaTypeId, GenreId, Composer, Milliseconds, Bytes, Uni |
|               | tPrice                                                                           |
+---------------+----------------------------------------------------------------------------------+
</code></pre>
<h3>IPython and <code>pandas</code></h3>
<p><code>db.py</code> is built with popular Scientific Python tools in mind--namely 
<code>pandas</code> and IPython. We've tried to make it as friendly as possible for those 
of you doing interactive computing: this means friendly <strong>repr's</strong>!</p>
<pre><code>&gt;&gt;&gt; db.tables.Artist
</code></pre>
<p/><table border="1">
    <tr>
        <th>Column</th>
        <th>Type</th>
        <th>Foreign Keys</th>
        <th>Reference Keys</th>
    </tr>
    <tr>
        <td>ArtistId</td>
        <td>INTEGER</td>
        <td/>
        <td>Album.ArtistId</td>
    </tr>
    <tr>
        <td>Name</td>
        <td>NVARCHAR(120)</td>
        <td/>
        <td/>
    </tr>
</table>
<pre><code>&gt;&gt;&gt; db.tables.Track
</code></pre>
<p/><table border="1">
    <tr>
        <th>Column</th>
        <th>Type</th>
        <th>Foreign Keys</th>
        <th>Reference Keys</th>
    </tr>
    <tr>
        <td>TrackId</td>
        <td>INTEGER</td>
        <td/>
        <td>InvoiceLine.TrackId, PlaylistTrack.TrackId</td>
    </tr>
    <tr>
        <td>Name</td>
        <td>NVARCHAR(200)</td>
        <td/>
        <td/>
    </tr>
    <tr>
        <td>AlbumId</td>
        <td>INTEGER</td>
        <td>Album.AlbumId</td>
        <td/>
    </tr>
    <tr>
        <td>MediaTypeId</td>
        <td>INTEGER</td>
        <td>MediaType.MediaTypeId</td>
        <td/>
    </tr>
    <tr>
        <td>GenreId</td>
        <td>INTEGER</td>
        <td>Genre.GenreId</td>
        <td/>
    </tr>
    <tr>
        <td>Composer</td>
        <td>NVARCHAR(220)</td>
        <td/>
        <td/>
    </tr>
    <tr>
        <td>Milliseconds</td>
        <td>INTEGER</td>
        <td/>
        <td/>
    </tr>
    <tr>
        <td>Bytes</td>
        <td>INTEGER</td>
        <td/>
        <td/>
    </tr>
    <tr>
        <td>UnitPrice</td>
        <td>NUMERIC(10,2)</td>
        <td/>
        <td/>
    </tr>
</table>
<pre><code>&gt;&gt;&gt; df = db.tables.Artist.all()
&gt;&gt;&gt; df.head()
</code></pre>
<p/><div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th/>
      <th>ArtistId</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 1</td>
      <td>             AC/DC</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 2</td>
      <td>            Accept</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 3</td>
      <td>         Aerosmith</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 4</td>
      <td> Alanis Morissette</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 5</td>
      <td>   Alice In Chains</td>
    </tr>
  </tbody>
</table>
</div>
<h3>Querying data</h3>
<p>Executing queries in libraries like <code>psycopg2</code> can be frustrating. Managing
connections, cursors, and rollbacks isn't exactly intuitive. <code>db.py</code> operates on
a much higher level, and makes executing queries simple.</p>
<pre><code>&gt;&gt;&gt; db.query("select * from Artist limit 10;")
   ArtistId                  Name
0         1                 AC/DC
1         2                Accept
2         3             Aerosmith
3         4     Alanis Morissette
4         5       Alice In Chains
5         6  Antônio Carlos Jobim
6         7          Apocalyptica
7         8            Audioslave
8         9              BackBeat
9        10          Billy Cobham
&gt;&gt;&gt; with open("myscript.sql", "w") as f:
...     f.write("select * from Artist;")
&gt;&gt;&gt; df = db.query_from_file("myscript.sql")
</code></pre>
<h3>Managing Credentials</h3>
<p>You know those really obscure database hostnames and passwords that your sys 
admin sets up? Well instead of copying and pasting them into all of your 
scripts, <code>db.py</code> lets you save credentials so you can use them later.</p>
<pre><code>&gt;&gt;&gt; db = DB(username="kermit", password="rainbowconnection", hostname="dw.themuppets.com", dbtype="mysql")
&gt;&gt;&gt; db.save_credentials(profile="muppetdw")
# in a new session
&gt;&gt;&gt; db = DB(profile="muppetdw") # voila!
</code></pre>
<p><img alt="" src="../static/img/shit-password.jpg"/></p>
<h3>Hope you like it</h3>
<p>We're still working on support for MS SQL. If you have ideas for features or are
interested in getting the latest updates, check out the <a href="https://github.com/yhat/db.py/"><code>db.py</code> github page</a>.</p>
<p><em>Special thanks to <a href="https://github.com/ebressert" target="_blank">Eli Bressert</a> from <a href="https://www.stitchfix.com/" target="_blank">StichFix</a>
for giving us the idea for <code>db.py</code>!</em></p>

        </article>
    </div></body></html>