<html><body><div><div class="content html_format">
      <a href="http://instacod.es/84797"><img src="https://habrastorage.org/getpro/habr/post_images/e92/c66/ac2/e92c66ac2bdb4dc727c3f61db75d189f.png"/></a>

<a href="http://eugeny.github.io/pyfence/">PyFence</a><p> — самопальная утилита-библиотека, которая позволяет следить за соответствием типов во время отладки вашего проекта. PyFence берет информацию о типах из docstring'ов функций в </p><a href="http://pythonhosted.org/an_example_pypi_project/sphinx.html#function-definitions">стандартном формате Sphinx</a><p>. То есть, если у вас уже есть документация, больше ничего делать для использования PyFence не нужно!
</p><p>
Например, возьмем следующий класс:
</p><a name="habracut"/>

<pre><code class="python">class RationalFormatter (object):
    def format(self, number):
        """
        Stringifies a number to numerator/denominator format
        Example::

            &gt;&gt;&gt; print(RationalFormatter().format(1.25))
            5/4

        :param number: input number
        :type  number: float
        :raises      : None
        :rtype       : str
        """
        return '%i/%i' % number.as_integer_ratio()

    def display(self, number):
        print(str(number) + ' = ' + self.format(number))
</code></pre>
<p>
Метод </p><b>format</b><p> представляет число в виде дроби, используя метод </p><b>float.as_integer_ratio()<br/>
</b><p>
Пробуем:

</p><pre><code class="python">&gt;&gt;&gt; from formatter import RationalFormatter
&gt;&gt;&gt; f = RationalFormatter()
&gt;&gt;&gt; f.display(1.25)
1.25 = 5/4
</code></pre>
<p>
Вроде работает? Однако все сломается, если передать </p><b>int</b><p>, ведь </p><b>int</b><p>, к сожалению,</p><b> .as_integer_ratio()</b><p> не содержит.

</p><pre><code class="python">&gt;&gt;&gt; f.display(5)
Traceback (most recent call last):
  File "example.py", line 5, in &lt;module&gt;
    f.display(5)
  File "/home/eugeny/Work/pyfence/example_formatter.py", line 18, in display
    print(str(number) + ' = ' + self.format(number))
  File "/home/eugeny/Work/pyfence/example_formatter.py", line 15, in format
    return '%i/%i' % number.as_integer_ratio()
AttributeError: 'int' object has no attribute 'as_integer_ratio'
</code></pre>
<p>
Впрочем, при использовании PyFence такую проблему можно было бы заметить гораздо раньше:

</p><pre><code class="python">$ pip install pyfence
...
$ fence example.py --fence:strict,stop
1.25 = 5/4
 *** PyFence ERROR ---------------------------
 *** PyFence ERROR PyFence verification failed
 *** PyFence ERROR  :: example_formatter.RationalFormatter.format(&lt;example_formatter.RationalFormatter object at 0x7ff097a47d10&gt;, 5)
 *** PyFence ERROR in example_formatter.py:2
 *** PyFence ERROR number was 5 (int) instead of ['float']
 *** PyFence ERROR Aborting
</code></pre>
<p>
Кроме того, PyFence может проверять типы возникающих в функциях/методах исключений и возвращаемые типы.</p><p>
Можно также импортировать модуль pyfence в самом проекте, в этом случае не придется использовать отдельную утилиту </p><b>fence</b><p>.</p><p>
Разумеется, использовать fence стоит только при разработке, а не в продакшне, так как из-за проверок возможно падение производительности.
</p><p>
Я буду очень благодарен любому </p><a href="https://github.com/Eugeny/pyfence/issues">фидбеку</a><p> и </p><a href="https://github.com/Eugeny/pyfence">Pull Request'ам</a><p>!

      
      </p><p class="clear"/>
    </div>

    
  </div></body></html>