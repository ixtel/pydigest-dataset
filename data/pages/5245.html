<html><body><div><div class="post-text" itemprop="text">
<p>This is a scenario for <a href="https://docs.chef.io" rel="nofollow">Chef-server</a> and <a href="https://docs.chef.io/chef_search.html" rel="nofollow">search</a>.</p>

<p>You will have to change your recipe that installs ambari agent to obtain IP of ambari server dynamically.</p>

<p>First you run recipes that configure your ambari server. When Chef has successfully run there it populates some information about the node to Chef-server, including recipes and roles that were applied to that particular node. You can go to chef-server and check the node attributes, particularly "recipes" attribute.</p>

<p>Now change your ambari agent recipe. I don't know how exactly agent's configuration file looks like but we are interested only in one line, where the IP of the master server is set.</p>

<p>Create a template of the configuration file and add it to the cookbook. Replace the harcoded master IP value with <code>&lt;%= @master_ip %&gt;</code></p>

<p>Change the ambari agent recipe so that it set's this value correctly:</p>

<pre><code># search for the server node. I expect server node was configured with
# ambari::server recipe. If not, change it to the appropriate value and
# don't fortget to escape colons.
ambari_server_node = search( :node, 'recipes:ambari\:\:server' )

# now create the configuration file on ambari agent node from 
# the previously created template and pass the value for the @master_ip
# variable
template '/right/path/on/target/node/config.file' do
  [...]
  variables( :master_ip =&gt; ambari_server_node['ipaddress'] )
end
</code></pre>
    </div>
    </div></body></html>