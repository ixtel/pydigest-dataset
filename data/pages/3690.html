<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-django-sequere" class="anchor" href="#django-sequere" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>django-sequere</h1>
<a href="http://travis-ci.org/thoas/django-sequere"><img alt="Build Status" src="https://camo.githubusercontent.com/47d130e78832ac8677d6a0751f417ca091e19489/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f74686f61732f646a616e676f2d736571756572652e706e673f6272616e63683d6d6173746572" data-canonical-src="https://secure.travis-ci.org/thoas/django-sequere.png?branch=master"/></a>
<p>A Django application to implement a follow system and a timeline using multiple backends (db, redis, etc.).</p>
<p>The timeline engine can be found in <code>sequere.contrib.timeline</code>.</p>
<a name="user-content-installation"/>
<h2><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h2>
<ol>
<li><p>Either check out the package from <a href="https://github.com/thoas/django-sequere">GitHub</a> or it pull from a release via PyPI</p>
<pre>pip install django-sequere
</pre>
</li>
<li><p>Add <code>sequere</code> to your <code>INSTALLED_APPS</code></p>
</li>
</ol>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">INSTALLED_APPS</span> <span class="pl-k">=</span> (
    <span class="pl-s"><span class="pl-pds">'</span>sequere<span class="pl-pds">'</span></span>,
)</pre></div>
<a name="user-content-usage"/>
<h2><a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage</h2>
<p>In Sequere any resources can follow any resources and vice versa.</p>
<p>Let's say you have two models:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># models.py</span>

<span class="pl-k">from</span> django.db <span class="pl-k">import</span> models

<span class="pl-k">class</span> <span class="pl-en">User</span>(<span class="pl-e">models</span>.<span class="pl-e">Model</span>):
    username <span class="pl-k">=</span> models.CharField(<span class="pl-v">max_length</span><span class="pl-k">=</span><span class="pl-c1">150</span>)


<span class="pl-k">class</span> <span class="pl-en">Project</span>(<span class="pl-e">models</span>.<span class="pl-e">Model</span>):
    name <span class="pl-k">=</span> models.CharField(<span class="pl-v">max_length</span><span class="pl-k">=</span><span class="pl-c1">150</span>)</pre></div>
<p>Now you to register them in sequere to identify them when a resource is following
another one.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># sequere_registry.py</span>

<span class="pl-k">from</span> .models <span class="pl-k">import</span> Project, User

<span class="pl-k">import</span> sequere

sequere.register(User)
sequere.register(Project)</pre></div>
<p>Sequere uses the same concepts as <a href="https://docs.djangoproject.com/en/dev/ref/contrib/admin/">Django Admin</a>, so if you have already used it,
you will not be lost.</p>
<p>You can now use Sequere like any other application, let's play with it:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> sequere.models <span class="pl-k">import</span> (follow, unfollow, get_followings_count, is_following,
                                    get_followers_count, get_followers, get_followings)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> myapp.models <span class="pl-k">import</span> User, Project

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> user <span class="pl-k">=</span> User.objects.create(<span class="pl-v">username</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>thoas<span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> project <span class="pl-k">=</span> Project.objects.create(<span class="pl-v">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>La classe americaine<span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> follow(user, project)  <span class="pl-c"># thoas will now follow "La classe americaine"</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> is_following(user, project)
<span class="pl-c1">True</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> get_followers_count(project)
<span class="pl-c1">1</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> get_followings_count(user)
<span class="pl-c1">1</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> get_followers(user)
[]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> get_followers(project)
[(<span class="pl-k">&lt;</span>User: thoas<span class="pl-k">&gt;</span>, datetime.datetime(<span class="pl-c1">2013</span>, <span class="pl-c1">10</span>, <span class="pl-c1">25</span>, <span class="pl-c1">4</span>, <span class="pl-c1">41</span>, <span class="pl-c1">31</span>, <span class="pl-c1">612067</span>))]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> get_followings(user)
[(<span class="pl-k">&lt;</span>Project: La classe americaine, datetime.datetime(<span class="pl-c1">2013</span>, <span class="pl-c1">10</span>, <span class="pl-c1">25</span>, <span class="pl-c1">4</span>, <span class="pl-c1">41</span>, <span class="pl-c1">31</span>, <span class="pl-c1">612067</span>))]</pre></div>
<p>If you are as lazy as me to provide the original instance in each sequere calls, use <code>SequereMixin</code></p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># models.py</span>

<span class="pl-k">from</span> django.db <span class="pl-k">import</span> models

<span class="pl-k">from</span> sequere.mixin <span class="pl-k">import</span> SequereMixin

<span class="pl-k">class</span> <span class="pl-en">User</span>(<span class="pl-e">SequereMixin</span>, <span class="pl-e">models</span>.<span class="pl-e">Model</span>):
    username <span class="pl-k">=</span> models.Charfield(<span class="pl-v">max_length</span><span class="pl-k">=</span><span class="pl-c1">150</span>)

<span class="pl-k">class</span> <span class="pl-en">Project</span>(<span class="pl-e">SequereMixin</span>, <span class="pl-e">models</span>.<span class="pl-e">Model</span>):
    name <span class="pl-k">=</span> models.Charfield(<span class="pl-v">max_length</span><span class="pl-k">=</span><span class="pl-c1">150</span>)</pre></div>
<p>Now you can use calls directly from the instance:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> myapp.models <span class="pl-k">import</span> User, Project

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> user <span class="pl-k">=</span> User.objects.create(<span class="pl-v">username</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>thoas<span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> project <span class="pl-k">=</span> Project.objects.create(name<span class="pl-s"><span class="pl-pds">'</span>La classe americaine<span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> user.follow(project)  <span class="pl-c"># thoas will now follow "La classe americaine"</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> user.is_following(project)
<span class="pl-c1">True</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> project.get_followers_count()
<span class="pl-c1">1</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> user.get_followings_count()
<span class="pl-c1">1</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> user.get_followers()
[]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> project.get_followers()
[(<span class="pl-k">&lt;</span>User: thoas<span class="pl-k">&gt;</span>, datetime.datetime(<span class="pl-c1">2013</span>, <span class="pl-c1">10</span>, <span class="pl-c1">25</span>, <span class="pl-c1">4</span>, <span class="pl-c1">41</span>, <span class="pl-c1">31</span>, <span class="pl-c1">612067</span>))]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> user.get_followings()
[(<span class="pl-k">&lt;</span>Project: La classe americaine, datetime.datetime(<span class="pl-c1">2013</span>, <span class="pl-c1">10</span>, <span class="pl-c1">25</span>, <span class="pl-c1">4</span>, <span class="pl-c1">41</span>, <span class="pl-c1">31</span>, <span class="pl-c1">612067</span>))]</pre></div>
<p>So much fun!</p>
<a name="user-content-backends"/>
<h2><a id="user-content-backends" class="anchor" href="#backends" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Backends</h2>
<a name="user-content-sequere-backends-database-databasebackend"/>
<h3><a id="user-content-sequerebackendsdatabasedatabasebackend" class="anchor" href="#sequerebackendsdatabasedatabasebackend" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>sequere.backends.database.DatabaseBackend</h3>
<p>A database backend to store your follows in you favorite database using the Django's
ORM.</p>
<p>To use this backend you will have to add <code>sequere.backends.database</code> to your <code>INSTALLED_APPS</code></p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">INSTALLED_APPS</span> <span class="pl-k">=</span> (
    <span class="pl-s"><span class="pl-pds">'</span>sequere<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>sequere.backends.database<span class="pl-pds">'</span></span>,
)</pre></div>
<p>The follower will be identified by the couple (from_identifier, from_object_id)
and the following by (to_identifier, to_object_id).</p>
<p>Each identifiers are taken from the registry. For example, if you want to create
a custom identifier key from a model you can customized it like so:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># sequere_registry.py</span>

<span class="pl-k">from</span> myapp.models <span class="pl-k">import</span> Project

<span class="pl-k">from</span> sequere.base <span class="pl-k">import</span> ModelBase

<span class="pl-k">import</span> sequere


<span class="pl-k">class</span> <span class="pl-en">ProjectSequere</span>(<span class="pl-e">ModelBase</span>):
    identifier <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>projet<span class="pl-pds">'</span></span> <span class="pl-c"># the french way ;)</span>

sequere.registry(Project, ProjectSequere)</pre></div>
<a name="user-content-sequere-backends-redis-redisbackend"/>
<h3><a id="user-content-sequerebackendsredisredisbackend" class="anchor" href="#sequerebackendsredisredisbackend" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>sequere.backends.redis.RedisBackend</h3>
<p>We are using exclusively <a href="http://redis.io/commands#sorted_set">Sorted Sets</a> in this Redis implementation.</p>
<p>Create a uid for a new resource</p>
<pre>INCR sequere:global:uid    =&gt;  1
SET sequere:uid:{identifier}:{id} 1
HMSET sequere:uid::{id} identifier {identifier} object_id {id}
</pre>
<p>Store followers count</p>
<pre>INCR sequere:uid:{to_uid}:followers:count =&gt; 1
INCR sequere:uid:{to_uid}:followers:{from_identifier}:count =&gt; 1
</pre>
<p>Store followings count</p>
<pre>INCR sequere:uid:{from_uid}:followings:count =&gt; 1
INCR sequere:uid:{from_uid}:followings:{to_identifier}:count =&gt; 1
</pre>
<p>Add a new follower</p>
<pre>ZADD sequere:uid:{to_uid}:followers {from_uid} {timestamp}
ZADD sequere:uid:{to_uid}:followers:{from_identifier} {from_uid} {timestamp}
</pre>
<p>Add a new following</p>
<pre>ZADD sequere:uid:{from_uid}:followings {to_uid} {timestamp}
ZADD sequere:uid:{from_uid}:followings{to_identifier} {to_uid} {timestamp}
</pre>
<p>Retrieve the followers uids</p>
<pre>ZRANGEBYSCORE sequere:uid:{uid}:followers -inf +inf
</pre>
<p>Retrieve the followings uids</p>
<pre>ZRANGEBYSCORE sequere:uid:{uid}:followings =inf +inf
</pre>
<p>With this implementation you can retrieve your followers ordered</p>
<pre>ZREVRANGEBYSCORE sequere:uid:{uid}:followers +inf -inf
</pre>
<a name="user-content-timeline"/>
<h2><a id="user-content-timeline" class="anchor" href="#timeline" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Timeline</h2>
<p>The timeline engine is directly based on <code>sequere</code> resources system.</p>
<a name="user-content-concept"/>
<h3><a id="user-content-concept" class="anchor" href="#concept" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Concept</h3>
<p>A <code>Timeline</code> is basically a list of <code>Action</code>.</p>
<p>An <code>Action</code> is represented by:</p>
<ul>
<li><code>actor</code> which is the actor of the action</li>
<li><code>verb</code> which is the action name</li>
<li><code>target</code> which is the target of the action (not required)</li>
<li><code>date</code> which is the date when the action has been done</li>
</ul>
<a name="user-content-id1"/>
<h3><a id="user-content-installation-1" class="anchor" href="#installation-1" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h3>
<p>You have to follow installation instructions of <code>sequere</code> first before installing
<code>sequere.contrib.timeline</code>.</p>
<p>Add <code>sequere.contrib.timeline</code> to your <code>INSTALLED_APPS</code></p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">INSTALLED_APPS</span> <span class="pl-k">=</span> (
    <span class="pl-s"><span class="pl-pds">'</span>sequere.contrib.timeline<span class="pl-pds">'</span></span>,
)</pre></div>
<p><code>sequere.contrib.timeline</code> requires <a href="http://www.celeryproject.org/">celery</a> to work properly,
so you will have to install it.</p>
<a name="user-content-id2"/>
<h3><a id="user-content-usage-1" class="anchor" href="#usage-1" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage</h3>
<p>You have to register your actions based on your resources, for example</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># sequere_registry.py</span>

<span class="pl-k">from</span> .models <span class="pl-k">import</span> Project, User

<span class="pl-k">from</span> sequere.contrib.timeline <span class="pl-k">import</span> Action
<span class="pl-k">from</span> sequere <span class="pl-k">import</span> register
<span class="pl-k">from</span> sequere.base <span class="pl-k">import</span> ModelBase


<span class="pl-c"># actions</span>
<span class="pl-k">class</span> <span class="pl-en">JoinAction</span>(<span class="pl-e">Action</span>):
    verb <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>join<span class="pl-pds">'</span></span>


<span class="pl-k">class</span> <span class="pl-en">LikeAction</span>(<span class="pl-e">Action</span>):
    verb <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>like<span class="pl-pds">'</span></span>

<span class="pl-c"># resources</span>
<span class="pl-k">class</span> <span class="pl-en">ProjectSequere</span>(<span class="pl-e">ModelBase</span>):
    identifier <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>project<span class="pl-pds">'</span></span>

<span class="pl-k">class</span> <span class="pl-en">UserSequere</span>(<span class="pl-e">ModelBase</span>):
    identifier <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>

    actions <span class="pl-k">=</span> (JoinAction, LikeAction, )

<span class="pl-c"># register resources</span>
register(User, UserSequere)
register(Project, ProjectSequere)</pre></div>
<p>Now we have registered our actions we can play with the timeline API</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> sequere.models <span class="pl-k">import</span> (follow, unfollow)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> sequere.contrib.timeline <span class="pl-k">import</span> Timeline

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> myapp.models <span class="pl-k">import</span> User, Project

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> <span class="pl-k">from</span> myapp.sequere_registry <span class="pl-k">import</span> JoinAction, LikeAction

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> thoas <span class="pl-k">=</span> User.objects.create(<span class="pl-v">username</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>thoas<span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> project <span class="pl-k">=</span> Project.objects.create(<span class="pl-v">name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>La classe americaine<span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline <span class="pl-k">=</span> Timeline(thoas) <span class="pl-c"># create a timeline</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline.save(JoinAction(<span class="pl-v">actor</span><span class="pl-k">=</span>thoas)) <span class="pl-c"># save the action in the timeline</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline.get_private()
[<span class="pl-k">&lt;</span>JoinAction: thoas join<span class="pl-k">&gt;</span>]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span>: timeline.get_public()
[<span class="pl-k">&lt;</span>JoinAction: thoas join<span class="pl-k">&gt;</span>]</pre></div>
<p>When the resource is the actor of its own action then we push the action both
in <strong>private</strong> and <strong>public</strong> timelines.</p>
<p>Now we have to test the system with the follow process</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> newbie <span class="pl-k">=</span> User.objects.create(<span class="pl-v">username</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>newbie<span class="pl-pds">'</span></span>)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> follow(newbie, thoas) <span class="pl-c"># newbie is now following thoas</span>

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> Timeline(newbie).get_private() <span class="pl-c"># thoas actions now appear in the private timeline of newbie</span>
[<span class="pl-k">&lt;</span>JoinAction: thoas join<span class="pl-k">&gt;</span>]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> Timeline(newbie).get_public()
[]</pre></div>
<p>When <strong>A</strong> is following <strong>B</strong> we copy actions of <strong>B</strong> in the private
timeline of <strong>A</strong>, <a href="http://www.celeryproject.org/">celery</a> is needed to handle these asynchronous tasks.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> unfollow(newbie, thoas)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> Timeline(newbie).get_private()
[]</pre></div>
<p>When <strong>A</strong> is unfollowing <strong>B</strong> we delete the actions of <strong>B</strong> in the private
timeline of <strong>A</strong>.</p>
<p>As you may have noticed the <code>JoinAction</code> is an action which does not need a target,
some actions will need target, <code>sequere.contrib.timeline</code> provides a quick way
to query actions for a specific target.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline <span class="pl-k">=</span> Timeline(thoas)

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline.save(LikeAction(<span class="pl-v">actor</span><span class="pl-k">=</span>thoas, <span class="pl-v">target</span><span class="pl-k">=</span>project))

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline.get_private()
[<span class="pl-k">&lt;</span>JoinAction: thoas join<span class="pl-k">&gt;</span>, <span class="pl-k">&lt;</span>LikeAction: thoas like La classe americaine<span class="pl-k">&gt;</span>]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline.get_private(<span class="pl-v">target</span><span class="pl-k">=</span>Project) <span class="pl-c"># only retrieve actions with Project resource as target</span>
[<span class="pl-k">&lt;</span>LikeAction: thoas like La classe americaine<span class="pl-k">&gt;</span>]

<span class="pl-k">&gt;&gt;</span><span class="pl-k">&gt;</span> timeline.get_private(<span class="pl-v">target</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>project<span class="pl-pds">'</span></span>) <span class="pl-c"># only retrieve actions with 'project' identifier as target</span>
[<span class="pl-k">&lt;</span>LikeAction: thoas like La classe americaine<span class="pl-k">&gt;</span>]</pre></div>
<a name="user-content-configuration"/>
<h2><a id="user-content-configuration" class="anchor" href="#configuration" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Configuration</h2>
<a name="user-content-sequere-backend-class"/>
<h3><a id="user-content-sequere_backend_class" class="anchor" href="#sequere_backend_class" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_BACKEND_CLASS</code></h3>
<p>The backend used to store follows</p>
<p>Defaults to <code>sequere.backends.database.DatabaseBackend</code>.</p>
<a name="user-content-sequere-redis-connection"/>
<h3><a id="user-content-sequere_redis_connection" class="anchor" href="#sequere_redis_connection" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_REDIS_CONNECTION</code></h3>
<p>A dictionary of parameters to pass to the to Redis client, e.g.:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_REDIS_CONNECTION</span> <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">'</span>host<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>localhost<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>port<span class="pl-pds">'</span></span>: <span class="pl-c1">6379</span>,
    <span class="pl-s"><span class="pl-pds">'</span>db<span class="pl-pds">'</span></span>: <span class="pl-c1">0</span>,
}</pre></div>
<p>Alternatively you can use a URL to do the same:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_REDIS_CONNECTION</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>redis://username:password@localhost:6379/0<span class="pl-pds">'</span></span></pre></div>
<a name="user-content-sequere-redis-connection-class"/>
<h3><a id="user-content-sequere_redis_connection_class" class="anchor" href="#sequere_redis_connection_class" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_REDIS_CONNECTION_CLASS</code></h3>
<p>An (optional) dotted import path to a connection to use, e.g.:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_REDIS_CONNECTION_CLASS</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>myproject.myapp.mockup.Connection<span class="pl-pds">'</span></span></pre></div>
<a name="user-content-sequere-redis-prefix"/>
<h3><a id="user-content-sequere_redis_prefix" class="anchor" href="#sequere_redis_prefix" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_REDIS_PREFIX</code></h3>
<p>The (optional) prefix to be used for the key when storing in the Redis database.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_REDIS_PREFIX</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sequere:myproject:<span class="pl-pds">'</span></span></pre></div>
<p>Defaults to <code>sequere:</code>.</p>
<a name="user-content-sequere-timeline-connection-class"/>
<h3><a id="user-content-sequere_timeline_connection_class" class="anchor" href="#sequere_timeline_connection_class" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_TIMELINE_CONNECTION_CLASS</code></h3>
<p>An (optional) dotted import path to a connection to use, e.g.:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_TIMELINE_CONNECTION_CLASS</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>myproject.myapp.mockup.Connection<span class="pl-pds">'</span></span></pre></div>
<a name="user-content-sequere-timeline-redis-connection"/>
<h3><a id="user-content-sequere_timeline_redis_connection" class="anchor" href="#sequere_timeline_redis_connection" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_TIMELINE_REDIS_CONNECTION</code></h3>
<p>A dictionary of parameters to pass to the to Redis client, e.g.:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_TIMELINE_REDIS_CONNECTION</span> <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">'</span>host<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>localhost<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>port<span class="pl-pds">'</span></span>: <span class="pl-c1">6379</span>,
    <span class="pl-s"><span class="pl-pds">'</span>db<span class="pl-pds">'</span></span>: <span class="pl-c1">0</span>,
}</pre></div>
<p>Alternatively you can use a URL to do the same:</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_TIMELINE_REDIS_CONNECTION</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>redis://username:password@localhost:6379/0<span class="pl-pds">'</span></span></pre></div>
<a name="user-content-sequere-timeline-redis-prefix"/>
<h3><a id="user-content-sequere_timeline_redis_prefix" class="anchor" href="#sequere_timeline_redis_prefix" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_TIMELINE_REDIS_PREFIX</code></h3>
<p>The (optional) prefix to be used for the key when storing in the Redis database.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_TIMELINE_REDIS_PREFIX</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sequere:myproject:timeline<span class="pl-pds">'</span></span></pre></div>
<p>Defaults to <code>sequere:timeline</code>.</p>
<a name="user-content-sequere-timeline-nydus-connection"/>
<h3><a id="user-content-sequere_timeline_nydus_connection" class="anchor" href="#sequere_timeline_nydus_connection" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><code>SEQUERE_TIMELINE_NYDUS_CONNECTION</code></h3>
<p><a href="https://github.com/disqus/nydus">nydus</a> can be used to scale like a pro.</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c1">SEQUERE_TIMELINE_NYDUS_CONNECTION</span> <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">'</span>backend<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>nydus.db.backends.redis.Redis<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>router<span class="pl-pds">'</span></span>: <span class="pl-s"><span class="pl-pds">'</span>nydus.db.routers.keyvalue.PartitionRouter<span class="pl-pds">'</span></span>,
    <span class="pl-s"><span class="pl-pds">'</span>hosts<span class="pl-pds">'</span></span>: {
        <span class="pl-c1">0</span>: {<span class="pl-s"><span class="pl-pds">'</span>db<span class="pl-pds">'</span></span>: <span class="pl-c1">0</span>},
        <span class="pl-c1">1</span>: {<span class="pl-s"><span class="pl-pds">'</span>db<span class="pl-pds">'</span></span>: <span class="pl-c1">1</span>},
        <span class="pl-c1">2</span>: {<span class="pl-s"><span class="pl-pds">'</span>db<span class="pl-pds">'</span></span>: <span class="pl-c1">2</span>},
    }
}</pre></div>
<p><code>sequere.contrib.timeline</code> supports both <a href="https://github.com/andymccurdy/redis-py">redis-py</a> and <a href="https://github.com/disqus/nydus">nydus</a>.</p>
<p>If this settings is provided in your Django project then <a href="https://github.com/disqus/nydus">nydus</a> will be needed
as an additional dependency.</p>
<a name="user-content-resources"/>
<h2><a id="user-content-resources" class="anchor" href="#resources" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Resources</h2>


</article>
  </div></body></html>