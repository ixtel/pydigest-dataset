<html><body><div><div class="entry-content" itemprop="articleBody">
    
        <p><code>metaclasses</code> and the <code>type</code> keyword are each examples of little used (and,
thus, not well understood by most) Python constructs.  In this article, we'll 
explore the different, erm, "types" of <code>type()</code> and how the Little-known use of 
<code>type</code> relates to <code>metaclasses</code>. 
</p>
<h2>Are You My Type?</h2>
<p>The first use of <code>type()</code> is the most widely known and used: to determine the
type of an object. Here, Python novices commonly interrupt and say, "But I
thought Python didn't have types!" On the contrary, <em>everything</em> in Python has a
type (even the types!) because <em>everything is an object</em>. Let's look at a few examples:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">int</span><span class="s">'&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="s">'foo'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">str</span><span class="s">'&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">float</span><span class="s">'&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">type</span><span class="s">'&gt;</span>
</pre></div>


<h3>The type of <code>type</code></h3>
<p>Everything is as expected, until we check the type of <code>float</code>. <code>&lt;class 'type'&gt;</code>?
What is that? Well, odd, but let's continue:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">pass</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">type</span><span class="s">'&gt;</span>
</pre></div>


<p>Ah! <code>&lt;class 'type'&gt;</code> again. Apparently the type of all classes themselves is
<code>type</code> (regardless of if they're built-in or user-defined). What about the type
of <code>type</code> itself?</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">type</span><span class="s">'&gt;</span>
</pre></div>


<p>Well, it had to end somewhere. <code>type</code> is the type of all types, including
itself. In actuality, <code>type</code> is a <code>metaclass</code>, or "a thing that builds
classes". Classes, like <code>list()</code>, build instances of that class, as 
in <code>my_list = list()</code>. In the same way, <code>metaclasses</code> build types, like <code>Foo</code> in:</p>



<h3>Roll Your Own Metaclass</h3>
<p>Just like regular classes, <code>metaclasses</code> can be user-defined. To use it, you set
a class's <code>__metaclass__</code> attribute to the <code>metaclass</code> you built. A <code>metaclass</code>
can be any <code>callable</code>, as long as it returns a type. Usually, you'll assign a
class's <code>__metaclass__</code> to a function that, at some point, uses a variant of <code>type</code>
we've not yet discussed: the three parameter variety used to create classes.</p>
<h2>The Darker Side of <code>type</code></h2>
<p>As mentioned, it turns out that <code>type</code> has a totally separate use, when called with three
arguments. <code>type(name, bases, dict)</code> creates a <em>new</em> type, programmatically. If
I had the following code:</p>



<p>We could achieve the exact same effect with the following:</p>
<div class="codehilite"><pre><span class="n">Foo</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">'Foo'</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{})</span>
</pre></div>


<p><code>Foo</code> is now referencing a class named "Foo", whose base class is <code>object</code>
(classes created with <code>type</code>, if specified without a base class, are
automatically made new-style classes).</p>
<p>That's all well and good, but what if we want to add member functions to Foo?
This is easily achieved by setting attributes of Foo, like so:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">always_false</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="n">Foo</span><span class="o">.</span><span class="n">always_false</span> <span class="o">=</span> <span class="n">always_false</span>
</pre></div>


<p>We could have done it all in one go with the following:</p>
<div class="codehilite"><pre><span class="n">Foo</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">'Foo'</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s">'always_false'</span><span class="p">:</span> <span class="n">always_false</span><span class="p">})</span>
</pre></div>


<p>Of course, the <code>bases</code> parameter is a list of base classes of <code>Foo</code>. We've been
leaving it empty, but it's perfectly valid to create a new class derived from
<code>Foo</code>, again using <code>type</code> to create it:</p>
<div class="codehilite"><pre><span class="n">FooBar</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">'FooBar'</span><span class="p">,</span> <span class="p">(</span><span class="n">Foo</span><span class="p">),</span> <span class="p">{})</span>
</pre></div>


<h3>When Is This Ever Useful?</h3>
<p>Once explained to someone, <code>type</code> and <code>metaclasses</code> are one of those topics
where the very next question is, "OK, so when would I use it?". The answer is, 
not very often at all. However, there <em>are</em> times when creating classes 
dynamically with <code>type</code> is the appropriate solution. Let's take a look at an 
example.</p>
<p><a href="http://www.github.com/jeffknupp/sandman">sandman</a> is a library I wrote to
automatically generate a REST API and web-based admin interface for existing
databases (without requiring any boilerplate code). Much of the heavy lifting 
is done by SQLAlchemy, an ORM framework.</p>
<p>There is only one way to register a database table with SQLAlchemy: create a 
<code>Model</code> class describing the table (not unlike Django's models).  To get 
SQLAlchemy to recognize a table, a class for that table must be created
in some way. Since <code>sandman</code> doesn't have any advanced knowledge of the 
database structure, it can't rely on pre-made model classes to register tables.
Rather, it needs to introspect the database and create these classes on the fly.
Sound familiar? Any time you're creating new classes dynamically, <code>type</code> is 
the correct/only choice.</p>
<p>Here's the relevant code from <a href="https://www.github.com/jeffknupp/sandman">sandman</a>:</p>
<div class="codehilite"><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">current_app</span><span class="o">.</span><span class="n">endpoint_classes</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">():</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="p">(</span><span class="n">sandman_model</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">),</span>
                <span class="p">{</span><span class="s">'__tablename__'</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
        <span class="n">register</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
</pre></div>


<p>As you can see, if the user has not manually created a model class for a table, it 
is automatically created with a <code>__tablename__</code> attribute set to the name of the
table (used by SQLAlchemy to match tables to classes).</p>
<h2>In Summary</h2>
<p>In this article, we discussed the two uses of <code>type</code>, <code>metaclasses</code>, and when
the alternate use of <code>type</code> is required. Although <code>metaclasses</code> are a somewhat
confusing concept, hopefully you now have a good base off of which you can build
through further study.</p>
        <small>Posted on <time datetime="2013-12-28 10:02:00" pubdate="" data-updated="true" itemprop="datePublished">Dec 28, 2013</time> by <span itemprop="author"> Jeff Knupp</span></small>
    <p class="meta">
    <a href="/blog/2013/12/20/your-database-just-got-its-own-website" title="Previous Post: Your Database Just Got Its Own Website">Â« Previous Post: Your Database Just Got Its Own Website</a>
    </p>
      

</div>
</div></body></html>