<html><body><div><div class="blog-content">

                        

                            
                        



                        
                            
                                <h3 id="_1">Управление светодиодом на одноплатном компьютере</h3>
<p>В продолжение статьи про одноплатные компьютеры мы приступим к их рассмотрению и работы с ними более детально (примеры будут показаны на платах Raspberry Pi (RPi), OrangePi и PcDuino). Начнем с управления светодиодом. В этом и дальнейших материалах будут использоваться за основу давно существующие материалы и будут использованы для создания наших проектов. </p>
<p><strong>Начнем мы с управления светодиодом. Будут представлены несколько методов управления и возможные варианты в дальнейших ваших разработках.</strong>    </p>
<p>Чтобы общаться с любыми внешними устройствами и управлять ими, Raspberry Pi имеет на борту интерфейс, называемый <a href="https://ru.wikipedia.org/wiki/GPIO">GPIO</a>. Это аббревиатура от General Purpose Input Output,а по-русски это низкоуровневый интерфейс ввода-вывода прямого управления. В зависимости от версии платы Raspberry на плате выведено <a href="http://elinux.org/RPi_Low-level_peripherals#General_Purpose_Input.2FOutput_.28GPIO.29">26 или 40 разьемов</a>. 
Через этот интерфейс Raspberry может слушать и отдавать команды любому внешнему устройству.</p>
<p><strong><em>При работе с GPIO важно учитывать пару моментов:</em></strong></p>
<blockquote>
<ol>
<li>Рабочее напряжение всех выводов — 3,3 В. Случайная подача на вход GPIO большего напряжения (даже 5 В с соседнего штырька разъема) приводит к выходу из строя не только этого вывода, но и вообще всего Raspberry Pi.</li>
<li>Контакты разъема P1 и нумерация портов GPIO не совпадает, поэтому при программировании надо всегда помнить, какая из нумераций используется. Еще более они не совпадают в первой версии Raspberry (надеюсь, сейчас, если не прилагать дополнительных усилий, купить удастся только новую модель).</li>
<li>Дополнительным пунктом надо отметить, что нумерация самих GPIO в Raspberry Pi идет с пропусками.</li>
<li>GPIO выводы небуферизованны и незащищены, поэтому короткое замыкание представляет опасность для всего RPi, поэтому будьте осторожны!</li>
<li>Все программы, которые обращаются к GPIO контактам должны быть запущены с правами администратора, иначе вы получите сообщение об ошибке.</li>
</ol>
</blockquote>
<p><strong>Для наших экспериментов понадобятся:</strong></p>
<ul>
<li>светодиод (1 шт.);</li>
<li>резисторы на 220 Ом (1 шт.) и 10 кОм (2 шт.);</li>
<li>кнопка без фиксатора (2 шт.). </li>
</ul>
<h3 id="_2">Помигаем светодиодом сначала.</h3>
<p>Соберем схему на макетной беспаечной плате.  </p>
<p><img alt="Схема подключения led" src="http://pynsk.ru/media/uploads/Posts/2_iron-1.jpg"/>   </p>
<p>Теперь создадим файл с расширением py например led.py и внесем в него следующий код:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="kn">as</span> <span class="nn">GPIO</span> 
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p><strong>Разберем что этот код делает:</strong></p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="kn">as</span> <span class="nn">GPIO</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>


<p>Импортируем необходимые модули для работы с GPIO и временем.</p>



<p>Устанавливаем способ нумерации выводов GPIO.<br/>
GPIO.BCM – будет использоваться нумерация GPIO выводов системы-на-кристалле Broadcom, являющейся ядром Raspberry Pi.   GPIO.BOARD – будет использоваться нумерация разъема на плате. Мы используем нумерацию GPIO.</p>



<p>Конфигурируем выводы на вход или выход.<br/>
GPIO.setup(22, GPIO.OUT) - конфигурируем как выход<br/>
GPIO.setup(22, GPIO.IN) - конфигурируем как выход  </p>
<p>С помощью необязательного параметра pull_up_down функции setup можно включить <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%B4%D1%82%D1%8F%D0%B3%D0%B8%D0%B2%D0%B0%D1%8E%D1%89%D0%B8%D0%B9_%D1%80%D0%B5%D0%B7%D0%B8%D1%81%D1%82%D0%BE%D1%80">подтягивающий резистор</a> к питанию или к земле:<br/>
GPIO.setup(22, GPIO.IN, pull_up_down=GPIO.PUD_UP) - подтяжка к питанию, 3,3 В;<br/>
GPIO.setup(22, GPIO.IN, pull_up_down=GPIO.PUD_DOWN) - подтяжка к земле, 0 В;<br/>
GPIO.setup(22, GPIO.IN, pull_up_down=GPIO.PUD_OFF) - подтяжка выключена.</p>
<div class="codehilite"><pre>while True:
    GPIO.output(22,True)
    time.sleep(1)
    GPIO.output(22,False)
    time.sleep(1)
</pre></div>


<p>Создаем цикл, который будет включать светодиод на 1 секунду, подовая питание или "1" (True) на 22 контакт GPIO и затем выключать на 1 секунду. <br/>
Запустим через терминал наш файл и увидим в работе наш светодиод.</p>
<h3 id="_3">Дополним нашу программу возможностью управлять нашим светодиодом с помощью двух кнопок. Одна кнопка будет включать, а вторая выключать.</h3>
<p>Соберем схему на макетной беспаечной плате.  </p>
<p><img alt="Схема подключения led и двух кнопок" src="http://pynsk.ru/media/uploads/Posts/2_iron-2.jpg"/>  </p>
<p>Создадим файл led_button.py и внесем в него следующий код:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="kn">as</span> <span class="nn">GPIO</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">GPIO</span><span class="o">.</span><span class="n">setwarnings</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="n">button_on</span> <span class="o">=</span> <span class="mi">4</span> <span class="c">#Кнопка 1 - ON</span>
<span class="n">button_off</span> <span class="o">=</span> <span class="mi">17</span> <span class="c">#Кнопка 2 - OFF</span>
<span class="n">led</span> <span class="o">=</span> <span class="mi">22</span>

<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>

<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">button_on</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">button_off</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">button_on</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">led</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"Led ON"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">button_off</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">led</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"Led OFF"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
</pre></div>


<p><strong>Разберем что этот код делает:</strong></p>
<div class="codehilite"><pre>while True:
    if GPIO.input(button_on) == False:
        GPIO.output(led,True)
        print ("Led ON")
        time.sleep(0.4)

    if GPIO.input(button_off) == False:
        GPIO.output(led,False)
        print ("Led OFF")
        time.sleep(0.4)
</pre></div>


<p>Создадим цикл, который будет отвечать за взаимодействие наших кнопок и светодиода. </p>
<p>Если Кнопка №1 - ON/Кнопка №2 - OFF нажата включить/выключить светодиод, сделать паузу на 0.4 секунды (т.к человек нажимает кнопку с небольшой задержкой, во избежание вывода лишней информации в консоль дополним код небольшой задержкой) и вывести в консоль информацию , что мы включили/выключили светодиод.</p>
<p>Файлы для Fritzing:</p>

                            
                        



                        

                            
                            <footer class="post-info">
                                <span class="label label-default">Дата</span>
                            <span class="published">
                                <i class="fa fa-calendar"/><time>
                                2016-02-04 18:45:28</time>
                            </span>


                                <span class="label label-default">Категории</span>

                                
                                    
                                        
                                            <a href="/blog/category/zheleznyj-python/">Железный Python</a>
                                            
                                        
                                    
                                


                                <span class="label label-default">Теги</span>

                                

                            </footer>
                        


                        
                            
                        

                        
                            
                            <a class="btn btn-sm share-twitter" target="_blank" href="http://twitter.com/home?status=https%3A//pynsk.ru/blog/2016/02/04/python-arm-1/%20Python%20%D0%B4%D0%BB%D1%8F%20ARM.%20%D0%9C%D0%B8%D0%B3%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B2%D0%B5%D1%82%D0%BE%D0%B4%D0%B8%D0%BE%D0%B4%D0%B0.%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201">Опубликовать в Twitter</a>
                            <a class="btn btn-sm share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=https://pynsk.ru/blog/2016/02/04/python-arm-1/&amp;t=Python%20%D0%B4%D0%BB%D1%8F%20ARM.%20%D0%9C%D0%B8%D0%B3%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B2%D0%B5%D1%82%D0%BE%D0%B4%D0%B8%D0%BE%D0%B4%D0%B0.%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201">Опубликовать в Facebook</a>
                        

                        
                            
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        


                        <hr/>
                        
                        <hr/>

                        
                            

            </div>

        </div></body></html>