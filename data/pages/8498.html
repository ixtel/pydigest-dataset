<html><body><div><div id="jwt-authentication-for-pyramid">
<h2>JWT authentication for Pyramid</h2>
<p>This package implements an authentication policy for Pyramid that using  <a href="http://jwt.io/" rel="nofollow">JSON
Web Tokens</a>. This standard (<a href="https://tools.ietf.org/html/rfc7519" rel="nofollow">RFC 7519</a>) is often used to secure backens APIs.
The excellent <a href="https://pyjwt.readthedocs.org/en/latest/" rel="nofollow">PyJWT</a> library is
used for the JWT encoding / decoding logic.</p>
<p>Enabling JWT support in a Pyramid application is very simple:</p>
<pre><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.authorization</span> <span class="kn">import</span> <span class="n">ACLAuthorizationPolicy</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
    <span class="c1"># Pyramid requires an authorization policy to be active.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_authorization_policy</span><span class="p">(</span><span class="n">ACLAuthorizationPolicy</span><span class="p">())</span>
    <span class="c1"># Enable JWT authentication.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">'pyramid_jwt'</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_jwt_authentication_policy</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">)</span>
</pre>
<p>This will set a JWT authentication policy using the <cite>Authorization</cite> HTTP header
with a <cite>JWT</cite> scheme to retrieve tokens. Using another HTTP header is trivial:</p>
<pre><span class="n">config</span><span class="o">.</span><span class="n">set_jwt_authentication_policy</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">,</span> <span class="n">http_header</span><span class="o">=</span><span class="s1">'X-My-Header'</span><span class="p">)</span>
</pre>
<p>To make creating valid tokens easier a new <tt>create_jwt_token</tt> method is
added to the request. You can use this in your view to create tokens. A simple
authentication view for a REST backend could look something like this:</p>
<pre><span class="nd">@view_config</span><span class="p">(</span><span class="s1">'login'</span><span class="p">,</span> <span class="n">request_method</span><span class="o">=</span><span class="s1">'POST'</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">'json'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">login</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">'login'</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>  <span class="c1"># You will need to implement this.</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'result'</span><span class="p">:</span> <span class="s1">'ok'</span><span class="p">,</span>
            <span class="s1">'token'</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">create_jwt_token</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'result'</span><span class="p">:</span> <span class="s1">'error'</span>
        <span class="p">}</span>
</pre>
<p>Since JWT is typically used via HTTP headers and does not use cookies the
standard <tt>remember()</tt> and <tt>forget()</tt> functions from Pyramid are not useful.
Trying to use them while JWT authentication is enabled will result in a warning.</p>
<div id="settings">
<h3>Settings</h3>
<p>There are a number of flags that specify how tokens are created and verified.
You can either set this in your .ini-file, or pass/override them directly to the
<tt>config.set_jwt_authentication_policy()</tt> function.</p>
<table>
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr><th>Parameter</th>
<th>ini-file entry</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr><td>private_key</td>
<td>jwt.private_key</td>
<td> </td>
<td>Key used to hash or sign tokens.</td>
</tr>
<tr><td>public_key</td>
<td>jwt.public_key</td>
<td> </td>
<td>Key used to verify token signatures. Only
used with assymetric algorithms.</td>
</tr>
<tr><td>algorithm</td>
<td>jwt.algorithm</td>
<td>HS512</td>
<td>Hash or encryption algorithm</td>
</tr>
<tr><td>expiration</td>
<td>jwt.expiration</td>
<td> </td>
<td>Number of seconds (or a datetime.timedelta
instance) before a token expires.</td>
</tr>
<tr><td>leeway</td>
<td>jwt.leeway</td>
<td>0</td>
<td>Number of seconds a token is allowed to be
expired before it is rejected.</td>
</tr>
<tr><td>http_header</td>
<td>jwt.http_header</td>
<td>Authorization</td>
<td>HTTP header used for tokens</td>
</tr>
<tr><td>auth_type</td>
<td>jwt.auth_type</td>
<td>JWT</td>
<td>Authentication type used in Authorization
header. Unused for other HTTP headers.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></body></html>