<html><body><div><div id="wikitext">
<p/> 

<p class="vspace"/><h3>Содержание</h3>
<p class="vspace"/><h3><a name="intro" id="intro"/> Введение</h3>
<p>Как вы, наверное, знаете, все программы можно условно разделить на консольные и использующие графический интерфейс (сервисы под Windows и демоны под Linux не будем брать в расчет). Параметры запуска, задаваемые через командную строку, чаще всего используют консольные программы, хотя программы с графическим интерфейсом тоже не брезгуют этой возможностью. Наверняка в жизни каждого программиста была ситуация, когда приходилось разбирать параметры командной строки, как правило, это не самая интересная часть программы, но без нее не обойтись. Эта статья посвящена тому, как Python облегчает жизнь программистам при решении этой задачи благодаря своей стандартной библиотеке argparse. 
</p>
<p class="vspace">В дальнейшем все примеры я буду приводить с расчетом на Python 3.3, но практически все то же самое можно использовать и в Python 2.7, хотя для запуска на Python 2.7 примеры придется исправить, в основном добавить символ "u" перед началом строк.
</p>
<p class="vspace"/><h3><a name="noargparse" id="noargparse"/> Примеры без использования argparse</h3>
<p>Путь для начала у нас есть простейший скрипт на Python. Для определенности назовем скрипт <em>coolprogram.py</em>, это будет классический Hello World, над которым мы будем работать в дальнейшем.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock1">
  <div class="sourceblocktext"><p class="python"><span class="co1">#!/usr/bin/python</span><br/>
<span class="co1"># -*- coding: UTF-8 -*-</span><br/>
<br/>
<span class="kw1">if</span> __name__ == <span class="st0">"__main__"</span>:<br/>
    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span></p></div>
  
</div>

<p class="vspace">Мы завершили эту сложнейшую программу и отдали ее заказчику, он доволен, но просит добавить в нее возможность указывать имя того, кого приветствуем, причем этот параметр может быть не обязательным. Т.е. программа может использоваться двумя путями:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock2">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py<br/>
<br/>
или<br/>
<br/>
$ python coolprogram.py Вася</p></div>
  
</div>

<p class="vspace">Первое, что приходит на ум при решении такой задачи, просто воспользоваться переменной <em>argv</em> из модуля <em>sys</em>. Напомню, что <em>sys.argv</em>  содержит список параметров, переданных программе через командную строку, причем нулевой элемент списка - это имя нашего скрипта. Т.е. если у нас есть следующий скрипт с именем <em>params.py</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock3">
  <div class="sourceblocktext"><p class="python"><span class="co1">#!/usr/bin/python</span><br/>
<span class="co1"># -*- coding: UTF-8 -*-</span><br/>
<br/>
<span class="kw1">import</span> <span class="kw3">sys</span><br/>
<br/>
<span class="kw1">if</span> __name__ == <span class="st0">"__main__"</span>:<br/>
    <span class="kw1">for</span> param <span class="kw1">in</span> <span class="kw3">sys</span>.<span class="me1">argv</span>:<br/>
        <span class="kw1">print</span> <span class="br0">(</span>param<span class="br0">)</span></p></div>
  
</div>

<p class="vspace">и мы запускаем его с помощью команды
</p>
<p class="vspace"/>


<p class="vspace">то в консоль будет выведена единственная строка:
</p>
<p class="vspace"/>


<p class="vspace">Если же мы добавим несколько параметров,
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock6">
  <div class="sourceblocktext"><p class="text">python params.py param1 param2 param3</p></div>
  
</div>

<p class="vspace">то эти параметры мы увидим в списке <em>sys.argv</em>, начиная с первого элемента:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock7">
  <div class="sourceblocktext"><p class="text">params.py<br/>
param1<br/>
param2<br/>
param3</p></div>
  
</div>

<p class="vspace">Здесь можно обратить внимание на то, что ссылка на интерпретатор Python в список этих параметров не входит, хотя он также присутствует в строке вызова нашего скрипта.
</p>
<p class="vspace">Вернемся к нашей задаче. Погрузившись в код на неделю, мы могли бы выдать заказчику следующий скрипт:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock8">
  <div class="sourceblocktext"><p class="python"><span class="co1">#!/usr/bin/python</span><br/>
<span class="co1"># -*- coding: UTF-8 -*-</span><br/>
<br/>
<span class="kw1">import</span> <span class="kw3">sys</span><br/>
<br/>
<span class="kw1">if</span> __name__ == <span class="st0">"__main__"</span>:<br/>
    <span class="kw1">if</span> <span class="kw2">len</span> <span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">1</span>:<br/>
        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="br0">)</span> <span class="br0">)</span><br/>
    <span class="kw1">else</span>:<br/>
        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span></p></div>
  
</div>

<p class="vspace">Теперь, если программа вызывается с помощью команды
</p>
<p class="vspace"/>


<p class="vspace">то результат будет прежний
</p>
<p class="vspace"/>


<p class="vspace">а если мы добавим параметр:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock11">
  <div class="sourceblocktext"><p class="text">python coolprogram.py Вася</p></div>
  
</div>

<p class="vspace">то программа поприветствует некоего Васю:
</p>
<p class="vspace"/>


<p class="vspace">Пока все легко и никаких проблем не возникает. Теперь предположим, что требования заказчика вновь изменились, и на этот раз он хочет, чтобы имя приветствуемого человека передавалось после именованного параметра <em>--name</em> или <em>-n</em>, причем нужно следить, что в командной строке передано только одно имя. С этого момента у нас начнется вермишель из конструкций <em>if</em>.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock13">
  <div class="sourceblocktext"><p class="python"><span class="co1">#!/usr/bin/python</span><br/>
<span class="co1"># -*- coding: UTF-8 -*-</span><br/>
<br/>
<span class="kw1">import</span> <span class="kw3">sys</span><br/>
<br/>
<span class="kw1">if</span> __name__ == <span class="st0">"__main__"</span>:<br/>
    <span class="kw1">if</span> <span class="kw2">len</span> <span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">)</span> == <span class="nu0">1</span>:<br/>
        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span><br/>
    <span class="kw1">else</span>:<br/>
        <span class="kw1">if</span> <span class="kw2">len</span> <span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">)</span> <span class="sy0">&lt;</span> <span class="nu0">3</span>:<br/>
            <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Ошибка. Слишком мало параметров."</span><span class="br0">)</span><br/>
            <span class="kw3">sys</span>.<span class="me1">exit</span> <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><br/>
<br/>
        <span class="kw1">if</span> <span class="kw2">len</span> <span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">3</span>:<br/>
            <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Ошибка. Слишком много параметров."</span><span class="br0">)</span><br/>
            <span class="kw3">sys</span>.<span class="me1">exit</span> <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><br/>
<br/>
        param_name = <span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><br/>
        param_value = <span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><br/>
<br/>
        <span class="kw1">if</span> <span class="br0">(</span>param_name == <span class="st0">"--name"</span> <span class="kw1">or</span><br/>
                param_name == <span class="st0">"-n"</span><span class="br0">)</span>:<br/>
            <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>param_value<span class="br0">)</span> <span class="br0">)</span><br/>
        <span class="kw1">else</span>:<br/>
            <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Ошибка. Неизвестный параметр '{}'"</span>.<span class="me1">format</span> <span class="br0">(</span>param_name<span class="br0">)</span> <span class="br0">)</span><br/>
            <span class="kw3">sys</span>.<span class="me1">exit</span> <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span></p></div>
  
</div>

<p class="vspace">Здесь мы проверяем ситуацию, что мы вообще не передали ни одного параметра, потом проверяем, что дополнительных параметров у нас ровно два, что они называются именно <em>--name</em> или <em>-n</em>, и, если нас все устраивает, выводим приветствие.
</p>
<p class="vspace">Как видите, код превратился в тихий ужас. Изменить логику работы в нем в дальнейшем будет очень сложно, а при увеличении количества параметров нужно будет срочно применять объектно-ориентированные меры по отделению логики работы программы от разбора командной строки. Разбор командной строки мы могли бы выделить в отдельный класс (или классы), но мы этого здесь делать не будем, поскольку все уже сделано в стандартной библиотеке Python, которая называется <strong>argparse</strong>.
</p>
<p class="vspace"/><h3><a name="using" id="using"/> Использование библиотеки argparse</h3>
<h4><a name="first" id="first"/> Первый пример</h4>
<p>Как как было сказано выше, стандартная библиотека <em>argparse</em> предназначена для облегчения разбора командной строки. На нее можно возложить проверку переданных параметров: их количество и обозначения, а уже после того, как эта проверка будет выполнена автоматически, использовать полученные параметры в логике своей программы.
</p>
<p class="vspace">Основа работы с командной строкой в библиотеке <em>argparse</em> является класс <em>ArgumentParser</em>. У его конструктора и методов довольно много параметров, все их рассматривать не будем, поэтому в дальнейшем рассмотрим работу этого класса на примерах, попутно обсуждая различные параметры.
</p>
<p class="vspace">Простейший принцип работы с <em>argparse</em> следующий:
</p>
<p class="vspace"/><ol><li>Создаем экземпляр класса <em>ArgumentParser</em>.
</li><li>Добавляем в него информацию об ожидаемых параметрах с помощью метода <em>add_argument</em> (по одному вызову на каждый параметр).
</li><li>Разбираем командную строку  помощью метода <em>parse_args</em>, передавая ему полученные параметры командной строки (кроме нулевого элемента списка <em>sys.argv</em>).
</li><li>Начинаем использовать полученные параметры.
</li></ol><p class="vspace">Для начала перепишем программу <em>coolprogram.py</em> с единственным параметром так, чтобы она использовала библиотеку <em>argparse</em>. Напомню, что данном случае мы ожидаем следующий синтаксис параметров:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock14">
  <div class="sourceblocktext"><p class="text">python coolprogram.py [Имя]</p></div>
  
</div>

<p class="vspace">Здесь [Имя] является необязательным параметром.
</p>
<p class="vspace">Наша программа с использованием <em>argparse</em> может выглядеть следующим образом:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock15">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'name'</span>, nargs=<span class="st0">'?'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># print (namespace)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">if</span> namespace.<span class="me1">name</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">else</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">На первый взгляд эта программа работает точно так же, как и раньше, хотя есть отличия, но мы их рассмотрим чуть позже. Пока разберемся с тем, что мы понаписали в программе.
</p>
<p class="vspace">Создание парсера вынесено в отдельную функцию, поскольку эта часть программы в будущем будет сильно изменяться и разрастаться. На строке 9 мы создали экземпляр класса <em>ArgumentParser</em> с параметрами по умолчанию. Что это за параметры, опять же, поговорим чуть позже.
</p>
<p class="vspace">На строке 10 мы добавили ожидаемый параметр в командной строке с помощью метода <em>add_argument</em>. При этом такой параметр будет считаться позиционным, т.е. он должен стоять именно на этом месте и у него не будет никаких предварительных обозначений (мы их добавим позже в виде '-n' или '--name'). Если бы мы не добавили именованный параметр <em>nargs='?</em>', то этот параметр был бы обязательным. <em>nargs</em> может принимать различные значения. Если бы мы ему присвоили целочисленное значение больше 0, то это бы означало, что мы ожидаем ровно такое же количество передаваемых параметров (точнее, считалось бы, что первый параметр ожидал бы список из N элементов, разделенных пробелами, этот случай мы рассмотрим позже). Также этот параметр может принимать значение '?', '+', '*' и  <em>argparse.REMAINDER</em>. Мы их не будем рассматривать, поскольку они важны в сочетании с необязательными именованными параметрами, которые могут располагаться как до, так и после нашего позиционного параметра. Тогда этот параметр будет показывать как интерпретировать список параметров, где будет заканчиваться один список параметров и начинаться другой.
</p>
<p class="vspace">Итак, мы создали парсер, после чего можно вызвать его метод <em>parse_args</em> для разбора командной строки. Если мы не укажем никакого параметра, это будет означать равносильно тому, что мы передадим в него все параметры из <em>sys.argv</em> кроме нулевого, который содержит имя нашей программы. т.е.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock16">
  <div class="sourceblocktext"><p class="python"><span class="kw3">parser</span>.<span class="me1">parse_args</span> <span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></div>
  
</div>

<p class="vspace">В качестве результата мы получим экземпляр класса <em>Namespace</em>, который будет содержать в качестве члена имя нашего параметра. Теперь можно раскомментировать строку 19 в приведенном выше примере, чтобы посмотреть, чему же равны наши параметры.
</p>
<p class="vspace">Если мы это сделаем и запустим программу с переданным параметром
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock17">
  <div class="sourceblocktext"><p class="text">python coolprogram.py Вася</p></div>
  
</div>

<p class="vspace">, то увидим его в пространстве имен.
</p>
<p class="vspace"/>


<p class="vspace">Если же теперь мы запустим программу без дополнительных параметров, то это значение будет равно None:
</p>
<p class="vspace"/>


<p class="vspace">Мы можем изменить значение по умолчанию, что позволит нам несколько сократить программу. Пусть по умолчанию используется слово 'мир', ведь мы его приветствуем, если параметры не переданы. Для этого воспользуемся дополнительным именованным параметром <em>default</em> в методе <em>add_argument</em>.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock20">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'name'</span>, nargs=<span class="st0">'?'</span>, default=<span class="st0">'мир'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span> <span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># print (namespace)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Программа продолжает работать точно также, как и раньше. Вы, наверное, заметили, что в предыдущем примере в метод <em>parse_args</em>  на строке 17 передаются параметры командной строки из <em>sys.argv</em>. Это сделано для того, чтобы показать, что список параметров мы можем передавать явно, при необходимости мы его можем предварительно обработать, хотя это вряд ли понадобится, ведь почти всю обработку можно возложить на плечи библиотеки <em>argparse</em>.
</p>
<p class="vspace"/><h4><a name="optional" id="optional"/> Добавляем именованные параметры</h4>
<p>Теперь снова переделаем нашу программу таким образом, чтобы использовать именованные параметры. Напомню, что согласно последнему желанию (в смысле, для данной программы) заказчика имя приветствуемого человека должно передаваться после параметра <em>--name</em> или <em>-n</em>. С помощью <em>pyparse</em> сделать это проще простого - достаточно в качестве первых двух параметров метода <em>add_argument</em> передать эти имена параметров.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock21">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, default=<span class="st0">'мир'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># print (namespace)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь, если мы запустим программу без параметров, то увидим знакомое "Привет, мир!", а если мы запустим программу с помощью команды
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock22">
  <div class="sourceblocktext"><p class="text">python coolprogram.py -n Вася</p></div>
  
</div>

<p class="vspace">или 
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock23">
  <div class="sourceblocktext"><p class="text">python coolprogram.py --name Вася</p></div>
  
</div>

<p class="vspace">То приветствовать программа будет Васю. Обратите внимание, что теперь в методе <em>add_argument</em> мы убрали параметр <em>nargs='?<strong>, поскольку </strong>все именованные параметры считаются необязательными</em>'. А если они не обязательные, то возникает вопрос, как поведет себя argparse, если этот параметр не передан? Для этого уберем параметр <em>default</em> в <em>add_argument</em>.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock24">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Если теперь запустить программу без параметров, то увидим приветствие великого <em>None</em>:
</p>
<p class="vspace"/>


<p class="vspace">Таким образом, <strong>если значение по умолчанию не указано, то оно считается равным <em>None</em>.</strong>
</p>
<p class="vspace">Раньше мы на это не обращали внимание, но нужно все-таки сказать, что <em>argparse</em> по умолчанию заточен для создания интерфейса командной строки именно в стиле UNIX, где именованные параметры начинаются с символов "-" или "--". Если такой параметр попытаться называть в стиле Windows (например, "/name"), то будет брошено исключение:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock26">
  <div class="sourceblocktext"><p class="text">ValueError: invalid option string '/name': must start with a character '-'</p></div>
  
</div>

<p class="vspace">На самом деле буквально с помощью одного параметра мы можем заставить работать <em>argparse</em> в стиле Windows, но это выходит за рамки статьи, поэтому мы везде будем использовать стиль UNIX.
</p>
<p class="vspace">До этого мы задавали два имени для одного и того же параметра: длинное имя, начинающееся с "--" (<em>--name</em>) и короткое сокращение, начинающее ся с "-" (<em>-n</em>). При этом получение значение параметра из пространства имен осуществляется по длинному имени:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock27">
  <div class="sourceblocktext"><p class="python"><span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></div>
  
</div>

<p class="vspace">Если мы не зададим длинное имя, то придется обращаться к параметру через его короткое имя (<em>n</em>):
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock28">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">n</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">При этом пространство имен будет выглядеть как:
</p>
<p class="vspace"/>


<p class="vspace">Хорошо, с уменьшением количества имен параметров разобрались, но мы можем еще и увеличить количество имен, например, мы можем добавить для того же параметра еще новое имя <em>--username</em>, для этого достаточно его добавить следующим параметром метода <em>add_argument</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock30">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, <span class="st0">'--username'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь мы можем использовать три варианта передачи параметров:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock31">
  <div class="sourceblocktext"><p class="text">python coolprogram.py -n Вася<br/>
python coolprogram.py --name Вася<br/>
python coolprogram.py --username Вася</p></div>
  
</div>

<p class="vspace">Все три варианта равнозначны, при этом надо обратить внимание, что при получении значения этого параметра используется первое длинное имя, т.е. <em>name</em>. Пространство имен при использовании всех трех вариантов вызова программы будет выглядеть одинаково:
</p>
<p class="vspace"/>


<p class="vspace"/><h4><a name="list" id="list"/> Параметры как списки</h4>
<p>До сих пор мы ожидали, что в качестве значения параметра выступает строка, но бывают ситуации, когда необходимо, чтобы в качестве значения параметра принимался список строк. Например, пусть нам теперь нужно изменить программу так, чтобы мы могли приветствовать нескольких человек. Первое, что приходит на ум - это вручную разобрать строку после имени параметра, т.е.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock33">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, default=<span class="st0">'мир'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="kw1">for</span> name <span class="kw1">in</span> namespace.<span class="me1">name</span>.<span class="me1">split</span><span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>name<span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Но это не самое лучшее решение, поскольку если пользователь захочет передать несколько параметров после <em>--name</em>, то ему придется оборачивать список имен в кавычки:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock34">
  <div class="sourceblocktext"><p class="text">python coolprogram.py --name "Вася Оля Петя"</p></div>
  
</div>

<p class="vspace">Поскольку, если написать просто 
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock35">
  <div class="sourceblocktext"><p class="text">python coolprogram.py --name Вася Оля Петя</p></div>
  
</div>

<p class="vspace">, то <em>argparse</em> решит, что "Оля Петя" - это отдельные параметры, имя для которых не задано, и напишет ошибку:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock36">
  <div class="sourceblocktext"><p class="text">error: unrecognized arguments: Оля Петя</p></div>
  
</div>

<p class="vspace">Чтобы указать библиотеке <em>argparse</em>, что значений параметров у нас может быть несколько, вспомним уже используемый нами параметр <em>nargs</em>. Но если в прошлый раз в качестве его значения мы использовали значение "?", обозначающее, что у нас может быть 0 или 1 значение, то теперь мы будем использовать значение <em>nargs='+</em>', обозначающее, что мы ожидаем одно или более значение (по аналогии с регулярными выражениями).
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock37">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="kw1">for</span> name <span class="kw1">in</span> namespace.<span class="me1">name</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>name<span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Обратите внимание, что здесь в качестве значения по умолчанию используется <strong>список</strong> из одного слова.
</p>
<p class="vspace">Теперь, если мы выполним эту программу с помощью команды
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock38">
  <div class="sourceblocktext"><p class="text">python coolprogram.py --name Вася Оля Петя</p></div>
  
</div>

<p class="vspace">То программа нам выведет:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock39">
  <div class="sourceblocktext"><p class="text">Namespace(name=['Вася', 'Оля', 'Петя'])<br/>
Привет, Вася!<br/>
Привет, Оля!<br/>
Привет, Петя!</p></div>
  
</div>

<p class="vspace">Таким образом, мы возложили задачу разделения параметров на плечи <em>argparse</em>. Напомню, что <em>nargs</em> может принимать и другие значения, в том числе целое число <em>N</em>, обозначающее, что мы ожидаем ровно <em>N</em> значений.
</p>
<p class="vspace"/><h4><a name="choices" id="choices"/> Выбор из вариантов</h4>
<p>Представим себе еще один случай. Пусть у нас есть консольная программа, наподобие <a class="urllink" href="http://www.imagemagick.org/script/index.php">ImageMagick</a>, то есть работающая с графикой. Наверняка эта программа будет поддерживать ограниченное количество форматов графических файлов. В этом случае может понадобиться ограничить значения некоторого параметра заранее заданным списком значений (например, gif, png, jpg). Разумеется, такую несложную проверку мы могли бы сделать и сами, но лучше пусть этим займется <em>argparse</em>. Для этого достаточно в метод <em>add_argument</em> передать еще один параметр - <em>choices</em>, который принимает список возможных значений параметра. 
</p>
<p class="vspace">Чтобы не удаляться от наших предыдущих примеров, изменим последнюю программу таким образом, чтобы она могла приветствовать только лишь заранее очерченных круг лиц (неких Васю, Олю или Петю). Сделать это абсолютно несложно:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock40">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, choices=<span class="br0">[</span><span class="st0">'Вася'</span>, <span class="st0">'Оля'</span>, <span class="st0">'Петя'</span><span class="br0">]</span>, default=<span class="st0">'Оля'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь, если мы передадим в качестве параметра одно из перечисленных имен, то программа будет работать, как и прежде, однако незнакомых людей она откажется приветствовать:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock41">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py --name Вася<br/>
<br/>
Namespace(name='Вася')<br/>
Привет, Вася!<br/>
<br/>
$ python coolprogram.py --name Иван<br/>
<br/>
usage: coolprogram.py [-h] [-n {Вася,Оля,Петя}]<br/>
coolprogram.py: error: argument -n/--name: invalid choice: 'Иван' (choose from 'Вася', 'Оля', 'Петя')</p></div>
  
</div>

<p class="vspace">Иногда может быть полезным в качестве значения параметра <em>choices</em> использовать список целых чисел, полученных с помощью стандартной функции <em>range</em>.
</p>
<p class="vspace"/><h4><a name="type" id="type"/> Указание типов параметров</h4>
<p>До сих пор мы в качестве входных параметров использовали строки, что логично, поскольку на самом нижнем уровне все входные параметры считаются строками. Однако часто на практике в качестве параметров хотелось бы использовать другие типы: целые числа или числа с плавающей точкой. Конечно, не проблема вручную преобразовать строку в нужный тип или написать ошибку в случае, если этого сделать невозможно. Однако, даже такую мелочь можно переложить на <em>argparse</em>. Для этого достаточно добавить еще один именованный параметр в метод <em>add_argument</em>, а именно параметр <em>type</em>, который будет указывать ожидаемый тип значения параметра. Изменим пример таким образом, чтобы в качестве входного параметра с именем <em>-c</em> или <em>--count</em> принималось целое число, которое обозначает, сколько раз нужно вывести строку "Привет, мир!" (временно забудем про параметры <em>-n</em> и <em>--name</em>).
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock42">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, default=<span class="nu0">1</span>, <span class="kw2">type</span>=<span class="kw2">int</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="kw1">for</span> _ <span class="kw1">in</span> <span class="kw2">range</span> <span class="br0">(</span>namespace.<span class="me1">count</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Нас здесь больше всего интересует 9-я строка, где мы указали ожидаемый тип параметра. Обратите внимание, что в качестве значения параметра <em>type</em> мы передали не строку, а стандартную функцию преобразования в целое число. В остальном там нет никаких особенностей. 
</p>
<p class="vspace">В следующем блоке показан пример работы этой программы:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock43">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py --count 5<br/>
<br/>
Namespace(count=5)<br/>
Привет, мир!<br/>
Привет, мир!<br/>
Привет, мир!<br/>
Привет, мир!<br/>
Привет, мир!</p></div>
  
</div>

<p class="vspace">Здесь мы видим, что в пространстве имен параметр <em>count</em> сразу записан как целое число (без кавычек). Если же мы попытаемся передать в качестве параметра какую-то строку, которую преобразовать в целое число невозможно, то мы получим ошибку:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock44">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py --count Абырвалг<br/>
<br/>
usage: coolprogram.py [-h] [-c COUNT]<br/>
coolprogram.py: error: argument -c/--count: invalid int value: 'Абырвалг'</p></div>
  
</div>

<p class="vspace"/><h4><a name="files" id="files"/> Имена файлов как параметры</h4>
<p>Но это не все возможности параметра <em>type</em>. Во многих программах в качестве входных параметров используются имена файлов, которые нужно прочитать. При этом имена файлов передают обычно не просто так, эти файлы или читают, или в них что-то пишут, а, как известно, открытие файла - это лотерея, может быть он откроется, а может и нет, здесь всегда надо ловить исключения. А раз это такая частая операция, то <em>argparse</em> позволяет и это автоматизировать.
</p>
<p class="vspace">Для примера напишем программу, которая просто выводит содержимое текстового файла, имя которого задается после именованного параметра <em>-n</em> или <em>--name</em> Для работы программы понадобится дополнительный файл "text.txt" для простоты в кодировке UTF-8.
</p>
<p class="vspace">Для того, чтобы указать <em>argparse</em>, что в качестве входного параметра мы ожидаем файл, который должен быть открыт для чтения, в метод <em>add_argument</em> нужно передать параметр <em>type</em>, равный <em>open</em> (опять же, это стандартная функция для открытия файла, а не строка). Использование этого параметра показано ниже:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock45">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, <span class="kw2">type</span>=<span class="kw2">open</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    text = namespace.<span class="me1">name</span>.<span class="me1">read</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>text<span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Если вы запустите этот пример, то кроме содержимого файла, переданного в качестве параметра <em>--name</em>, увидите, что пространство имен <em>namespace</em> будет содержать уже открытый файл:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock46">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py --name text.txt<br/>
<br/>
Namespace(name=&lt;_io.TextIOWrapper name='text.txt' mode='r' encoding='UTF-8'&gt;)<br/>
Содержимое текстового файла</p></div>
  
</div>

<p class="vspace">Если же мы укажем имя несуществующего файла, то получим исключение:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock47">
  <div class="sourceblocktext"><div class="text"><ol><li class="li1"><p class="de1">$ python coolprogram.py --name invalid.txt</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">Traceback (most recent call last):</p></li>
<li class="li1"><p class="de1">  File "coolprogram.py", line 16, in &lt;module&gt;</p></li>
<li class="li2"><p class="de2">    namespace = parser.parse_args(sys.argv[1:])</p></li>
<li class="li1"><p class="de1">  File "/usr/lib/python3.3/argparse.py", line 1714, in parse_args</p></li>
<li class="li1"><p class="de1">    args, argv = self.parse_known_args(args, namespace)</p></li>
<li class="li1"><p class="de1">  File "/usr/lib/python3.3/argparse.py", line 1746, in parse_known_args</p></li>
<li class="li1"><p class="de1">    namespace, args = self._parse_known_args(args, namespace)</p></li>
<li class="li2"><p class="de2">  File "/usr/lib/python3.3/argparse.py", line 1952, in _parse_known_args</p></li>
<li class="li1"><p class="de1">    start_index = consume_optional(start_index)</p></li>
<li class="li1"><p class="de1">  File "/usr/lib/python3.3/argparse.py", line 1892, in consume_optional</p></li>
<li class="li1"><p class="de1">    take_action(action, args, option_string)</p></li>
<li class="li1"><p class="de1">  File "/usr/lib/python3.3/argparse.py", line 1804, in take_action</p></li>
<li class="li2"><p class="de2">    argument_values = self._get_values(action, argument_strings)</p></li>
<li class="li1"><p class="de1">  File "/usr/lib/python3.3/argparse.py", line 2247, in _get_values</p></li>
<li class="li1"><p class="de1">    value = self._get_value(action, arg_string)</p></li>
<li class="li1"><p class="de1">  File "/usr/lib/python3.3/argparse.py", line 2276, in _get_value</p></li>
<li class="li1"><p class="de1">    result = type_func(arg_string)</p></li>
<li class="li2"><p class="de2">FileNotFoundError: [Errno 2] No such file or directory: 'invalid.txt'</p></li>
</ol></div></div>
  
</div>

<p class="vspace">Как видно из строк 4-5, исключение будет брошено при попытке разобрать параметры с помощью метода <em>parse_args</em>. Сначала кажется странным, что argparse не обрабатывает такую простую ситуацию, бросая такое некрасивое исключение. Казалось бы, почему бы библиотеке самой его не обработать и не вывести ошибку, как это было сделано при использовании параметра <em>type=int</em>? 
</p>
<p class="vspace">Несмотря на то, что использование параметра <em>type=open</em> описано в документации, на мой взгляд его лучше не использовать в таком виде, поскольку <em>argparse</em> предлагает более красивое решение этой проблемы. Достаточно в качестве параметра <em>type</em> передать не функцию <em>open</em>, а экземпляр класса, полученного с помощью функции <em>argparse.FileType</em>, предназначенной для безопасной попытки открытия файла.
</p>
<p class="vspace">Функция <em>argparse.FileType</em> выглядит следующим образом и напоминает упрощенную версию функции <em>open</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock48">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1">argparse.<span class="me1">FileType</span><span class="br0">(</span>mode=<span class="st0">'r'</span>, bufsize=-<span class="nu0">1</span>, encoding=<span class="kw2">None</span>, errors=<span class="kw2">None</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Здесь первый параметр задает режим открытия файла ('r' - чтение, 'w' - запись и т.д. по аналогии с функцией <em>open</em>), второй задает размер буфера, если нужно использовать буферизированое чтение, третий параметр задает кодировку открываемого файла, а последний - действие в случае ошибки декодирования файла. Эта функция создает экземпляр класса, предназначенного для работы с файлами.
</p>
<p class="vspace">Таким образом, мы можем исправить предыдущий пример:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock49">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, <span class="kw2">type</span>=argparse.<span class="me1">FileType</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    text = namespace.<span class="me1">name</span>.<span class="me1">read</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>text<span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь, если пользователь попытается передать имя несуществующего файла, то он увидит не большой страшный листинг исключения, а внятную ошибку:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock50">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py --name invalid.txt<br/>
<br/>
usage: coolprogram.py [-h] [-n NAME]<br/>
coolprogram.py: error: argument -n/--name: can't open 'invalid.txt': [Errno 2] No such file or directory: 'invalid.txt'</p></div>
  
</div>

<p class="vspace">Аналогично мы можем принимать имя файла для записи, при этом только надо не забыть передать в фукнцию <em>argparse.FileType</em> в качестве первого параметра строку 'w'.
</p>
<p class="vspace"/><h4><a name="required" id="required"/> Обязательные именованные параметры</h4>
<p>До сих пор мы говорили, что позиционные параметры у нас обязательные. Напомню, что позиционными считаются те параметры, имена которых не начинаются с символов "-" или "--". Почему они называются позиционными, поговорим чуть позже, когда перейдем к разделу про разбор нескольких параметров.
</p>
<p class="vspace">Т.е. следующая программа у нас должна обязательно получить один параметр:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock51">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'name'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">А поскольку параметр у нас не именованный (не начинается с символов "-" или "--"), то мы не должны в командной строке указывать имя параметра. Если же мы не укажем обязательный позиционный параметр, то <em>argparse</em> нам выведет понятную ошибку, а не будет бросать исключения. В следующем блоке показаны два случая использования этого скрипта: с переданным параметром и без него.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock52">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py Вася<br/>
<br/>
Namespace(name='Вася')<br/>
Привет, Вася!<br/>
<br/>
<br/>
$ python coolprogram.py<br/>
<br/>
usage: coolprogram.py [-h] name<br/>
coolprogram.py: error: the following arguments are required: name</p></div>
  
</div>

<p class="vspace">Теперь вернемся к примеру, где мы этот параметр сделали именованным:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock53">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Именованные параметры по умолчанию считаются необязательными, если мы его не укажем, то получим в качестве результата работы:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock54">
  <div class="sourceblocktext"><p class="text">Namespace(name=None)<br/>
Привет, None!</p></div>
  
</div>

<p class="vspace">Если же нас такое поведение не устраивает, мы можем указать, что этот параметр является обязательным, для этого достаточно в метод <em>add_argument</em> добавить параметр <em>required=True</em>
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock55">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span>, required=<span class="kw2">True</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь при попытке запустить программу без параметров пользователь увидит ошибку:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock56">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py<br/>
<br/>
usage: coolprogram.py [-h] -n NAME<br/>
coolprogram.py: error: the following arguments are required: -n/--name</p></div>
  
</div>

<p class="vspace"/><h4><a name="flags" id="flags"/> Параметры как флаги</h4>
<p>Иногда может возникнуть желание добавить параметры, которые должны работать как флаги, т.е. они или были указаны, или нет. Например, пусть у нас есть простейшая программа "Hello World", но если мы ей укажем параметр "--goodbye" или "-g", то программа не только поздоровается, но и попрощается с миром. :)
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock57">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py<br/>
<br/>
Привет, мир!<br/>
<br/>
<br/>
$ python coolprogram.py --goodbye<br/>
<br/>
Привет, мир!<br/>
Прощай, мир!</p></div>
  
</div>

<p class="vspace">Для того, чтобы смоделировать такое поведение нам понадобится еще один параметр метода <em>add_argument</em>, который мы до этого не использовали. Этот аргумент называется <em>action</em>, который предназначен для выполнения некоторых действий над значениями переданного параметра. Мы не будем подробно рассматривать все возможные действия, поскольку многие из них довольно специфические и требуют подробного рассмотрения, и в двух словах их не объяснишь, поэтому рассмотрим только один из вариантов использования этого параметра.
</p>
<p class="vspace">С формальной точки зрения, если мы явно не указываем значения параметра <em>action</em>, то он равен строке <em>"store"</em>, это означает, что парсер должен просто хранить полученные значения переменных, это происходило во всех приведенных выше примерах.
</p>
<p class="vspace">Для начала мы воспользуемся другим значением параметра <em>action</em>, а именно строкой <em>"store_const"</em>, которая обозначает, что если данный параметр указан, то он всегда будет принимать значение, указанное в другом параметре метода <em>add_argument</em> - <em>const</em>. Если этот параметр указан не будет, то его значение будет равно <em>None</em>.
</p>
<p class="vspace">Напишем наш новый Hello/goodbye World:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock58">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-g'</span>, <span class="st0">'--goodbye'</span>, action=<span class="st0">'store_const'</span>, const=<span class="kw2">True</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">if</span> namespace.<span class="me1">goodbye</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Прощай, мир!"</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь посмотрим, как он работает, и проследим за значением параметра <em>goodbye</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock59">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py<br/>
<br/>
Namespace(goodbye=None)<br/>
Привет, мир!<br/>
<br/>
<br/>
$ python coolprogram.py --goodbye<br/>
<br/>
Namespace(goodbye=True)<br/>
Привет, мир!<br/>
Прощай, мир!</p></div>
  
</div>

<p class="vspace">Если нас смущает, что без указания параметра <em>--goodbye</em> его значение равно <em>None</em>, а не <em>False</em>, то мы можем воспользоваться уже знакомым нам параметром <em>default</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock60">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-g'</span>, <span class="st0">'--goodbye'</span>, action=<span class="st0">'store_const'</span>, const=<span class="kw2">True</span>, default=<span class="kw2">False</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">if</span> namespace.<span class="me1">goodbye</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Прощай, мир!"</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь, если этот параметр не указан, то он будет равен <em>False</em>, в остальном поведение не изменилось:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock61">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py<br/>
<br/>
Namespace(goodbye=False)<br/>
Привет, мир!<br/>
<br/>
<br/>
$ python coolprogram.py --goodbye<br/>
<br/>
Namespace(goodbye=True)<br/>
Привет, мир!<br/>
Прощай, мир!</p></div>
  
</div>

<p class="vspace">Может возникнуть вопрос, почему бы просто не использовать параметр <em>default</em>, зачем нужен еще <em>action</em>? Но одним <em>default</em> мы не обойдемся, поскольку <em>action</em> со значением <em>store</em> (значение по умолчанию для него) подразумевает, что если параметр (в данном случае <em>--goodbye</em>) указан, то после него должно идти какое-то значение, а параметр <em>default</em> позволит указать значение этого параметра только при отсутствии <em>--goodbye</em>.
</p>
<p class="vspace">Поскольку используемый выше прием для создания флагов довольно часто используется, предусмотрено значение параметра <em>action</em>, позволяющее не указывать значение <em>const</em> для булевых значений: <em>store_true</em> и <em>store_false</em>. При использовании этих значений указанный параметр командной строки будет принимать соответственно <em>True</em> или <em>False</em>, если он указан. В данном случае мы можем воспользоваться значением <em>action="store_true"</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock62">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-g'</span>, <span class="st0">'--goodbye'</span>, action=<span class="st0">'store_true'</span>, default=<span class="kw2">False</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, мир!"</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">if</span> namespace.<span class="me1">goodbye</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Прощай, мир!"</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Результат работы скрипта не изменится.
</p>
<p class="vspace"/><h4><a name="several" id="several"/> Использование нескольких параметров</h4>
<p>До сих пор во всех примерах мы задавали лишь один параметр, обязательный или необязательный, поскольку нас интересовало в первую очередь то, какие свойства могут быть у параметров. В этом разделе мы рассмотрим случаи, когда программа ожидает несколько параметров, что чаще всего и бывает.
</p>
<p class="vspace">Для добавления второго, третьего и т.д. параметра необходимо повторно вызвать метод <em>add_argument</em> класса <em>ArgumentParser</em>, описав с помощью переданных значений свойства ожидаемого параметра.
</p>
<p class="vspace">Например, следующий скрипт ожидает два позиционных параметра - имя приветствуемого человека и число, обозначающее, сколько раз его нужно поприветствовать. В данном случае оба позиционных параметра будут являться обязательными. Причем, первый параметр всегда задает имя, а второй - количество, в данном примере поменять местами мы их не можем, отсюда и название таких параметров - "позиционные".
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock63">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'name'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">for</span> _ <span class="kw1">in</span> <span class="kw2">range</span> <span class="br0">(</span>namespace.<span class="me1">count</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Различные способы запуска такой программы показано ниже. В пером случае все задано корректно, а в остальных случаях есть ошибки: сначала аргументы перепутаны местами, вследствие чего второй параметр не удалось преобразовать в целое число, затем забыли передать один из параметров:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock64">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py Петя 3<br/>
<br/>
Namespace(count=3, name='Петя')<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
<br/>
<br/>
$ python coolprogram.py 3 Петя<br/>
<br/>
usage: coolprogram.py [-h] name count<br/>
coolprogram.py: error: argument count: invalid int value: 'Петя'<br/>
<br/>
<br/>
$ python coolprogram.py Петя<br/>
<br/>
usage: coolprogram.py [-h] name count<br/>
coolprogram.py: error: the following arguments are required: count</p></div>
  
</div>

<p class="vspace">Лично я недолюбливаю позиционные параметры как раз из-за того, что надо запоминать, в каком порядке они идут. Давайте сделаем их оба именованными, в этом случае порядок их передачи будет не важен, правда, при этом придется больше вводить символов, поскольку нужно будет вводить имена параметров.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock65">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-n'</span>, <span class="st0">'--name'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">for</span> _ <span class="kw1">in</span> <span class="kw2">range</span> <span class="br0">(</span>namespace.<span class="me1">count</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь параметры можно менять местами, ведь имена параметров все-равно заданы.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock66">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py --name Петя --count 3<br/>
<br/>
Namespace(count=3, name='Петя')<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
<br/>
<br/>
$ python coolprogram.py --count 3 --name Петя<br/>
<br/>
Namespace(count=3, name='Петя')<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
Привет, Петя!</p></div>
  
</div>

<p class="vspace">А как быть, если у нас имеются и позиционные, и необязательные именованные параметры? 
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock67">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'name'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw3">parser</span>.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">for</span> _ <span class="kw1">in</span> <span class="kw2">range</span> <span class="br0">(</span>namespace.<span class="me1">count</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>namespace.<span class="me1">name</span><span class="br0">)</span> <span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">В каком порядке мы должны передавать параметры? Сначала позиционные параметры, а потом именованные или наоборот? На самом деле это не важно, оба варианта будут работать:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock68">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py Петя --count 3<br/>
<br/>
Namespace(count=3, name='Петя')<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
<br/>
$ python coolprogram.py --count 3 Петя<br/>
<br/>
Namespace(count=3, name='Петя')<br/>
Привет, Петя!<br/>
Привет, Петя!<br/>
Привет, Петя!</p></div>
  
</div>

<p class="vspace"/><h4><a name="subparsers" id="subparsers"/> Использование подпарсеров</h4>
<p>Как вы уже поняли, библиотека <em>argparse</em> - достаточно мощная штука, выполняющая практически полностью разбор параметров командной строки и их проверку. Мы рассмотрели достаточно много примеров ее использования, но нельзя не упомянуть об еще одной возможности, а именно о подпарсерах (subparsers). Понять, что это такое проще на примере других программ. 
</p>
<p class="vspace">Наверняка вы постоянно пользуетесь какой-нибудь системой контроля версий вроде svn, git, bzr или чем-то подобным. И хотя для них написано множество графических оболочек, надеюсь, вы хоть раз запускали их из консоли. Какие особенности у этих программ с точки зрения командной строки? А особенность заключается в том, что у них в качестве первого параметра всегда выступает имя команды, за которой следуют параметры, специфические именно для этой команды. Например:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock69">
  <div class="sourceblocktext"><p class="text">$ git add -A<br/>
$ git commit -a -m "Текст коммита"</p></div>
  
</div>

<p class="vspace">Причем для каждой такой команды свои параметры, они могут иметь одинаковые имена, но обозначать разные вещи. Вот такое разделение на команды и позволяют сделать подпарсеры.
</p>
<p class="vspace">Изменим нашу программу для вывода "Hello / goodbye world" таким образом, чтобы команда <em>hello</em> говорила программе, что нужно поприветствовать тех людей, список которых передан в параметре <em>--names</em> или <em>-n</em>, а команда <em>goodbye</em> указывала программе, что нужно попрощаться с миром столько раз, какое число передано с помощью параметра <em>--count</em> или <em>-c</em>. Поскольку у нас для каждой команды используется только один параметр, возможно, стоило бы его сделать позиционным, чтобы не набирать его имя, но именованные параметры более наглядны, особенно для демонстрации.
</p>
<p class="vspace">Чтобы реализовать таое поведение нужно выполнить несколько шагов:
</p>
<p class="vspace"/><ol><li>Создать экземпляр класса <em>ArgumentParser</em> (назовем его корневым парсером).
</li><li>Создать хранилище подпарсеров с помощью метода <em>add_subparsers</em> класса <em>ArgumentParser</em> (результатом будет экземпляр внутреннего класса <em>_SubParsersAction</em>).
</li><li>Создать вложенный парсер с помощью метода <em>add_parser</em> класса хранилища парсеров. Результатом вызова каждого метода <em>add_parser</em> будет экземпляр класса <em>ArgumentParser</em>, уже знакомый нам.
</li><li>Для каждого созданного вложенного парсера заполнить информацию об ожидаемых параметров с помощью все того же метода <em>add_argument</em>.
</li><li>Получить пространство имен с помощью метода <em>parse_args</em> класса <em>ArgumentParser</em> (корневого парсера).
</li><li>Использовать полученное пространство имен так же, как и раньше с той лишь разницей, что в нем будет храниться имя переданной команды и параметры, специфические для нее.
</li></ol><p class="vspace">Вот как выглядит текст программы для описанного чуть выше "Hello / goodbye world":
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock70">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    subparsers = <span class="kw3">parser</span>.<span class="me1">add_subparsers</span> <span class="br0">(</span>dest=<span class="st0">'command'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    hello_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'hello'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    hello_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--names'</span>, <span class="st0">'-n'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    goodbye_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'goodbye'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    goodbye_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">def</span> run_hello <span class="br0">(</span>namespace<span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="st0">"""</span></p></li>
<li class="li1"><p class="de1"><span class="st0">    Выполнение команды hello</span></p></li>
<li class="li1"><p class="de1"><span class="st0">    """</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">for</span> name <span class="kw1">in</span> namespace.<span class="me1">names</span>:</p></li>
<li class="li2"><p class="de2">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Привет, {}!"</span>.<span class="me1">format</span> <span class="br0">(</span>name<span class="br0">)</span> <span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">def</span> run_goodbye <span class="br0">(</span>namespace<span class="br0">)</span>:</p></li>
<li class="li2"><p class="de2">    <span class="st0">"""</span></p></li>
<li class="li1"><p class="de1"><span class="st0">    Выполнение команды goodbye</span></p></li>
<li class="li1"><p class="de1"><span class="st0">    """</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">for</span> _ <span class="kw1">in</span> <span class="kw2">range</span> <span class="br0">(</span>namespace.<span class="me1">count</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Прощай, мир!"</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">if</span> namespace.<span class="me1">command</span> == <span class="st0">"hello"</span>:</p></li>
<li class="li1"><p class="de1">        run_hello <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    <span class="kw1">elif</span> namespace.<span class="me1">command</span> == <span class="st0">"goodbye"</span>:</p></li>
<li class="li1"><p class="de1">        run_goodbye <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">else</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw1">print</span> <span class="br0">(</span><span class="st0">"Что-то пошло не так..."</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">В реальной программе каждую команду неплохо было бы обернуть в отдельный класс, но здесь для простоты мы обойдемся обычной функцией. 
</p>
<p class="vspace">Думаю, что код достаточно лаконичный, чтобы по нему не было особых вопросов. Единственное, на что хочется обратить внимание, это то, что при создании хранилища подпарсеров с помощью метода <em>add_subparsers</em> мы использовали именованный параметр <em>dest = 'command</em>', который указывает, что имя переданной команды в пространстве имен будет храниться под именем <em>command</em>. В принципе, этот параметр является необязательным, и если его не указать, то имя переданной команды не попадет в пространство имен, но в этом случае получить имя команды будет затруднительно.
</p>
<p class="vspace">Давайте теперь посмотрим, как работает приведенная выше программа, особенно обратите внимание на содержимое пространства имен:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock71">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py hello --names Татьяна Александр Иван<br/>
<br/>
Namespace(command='hello', names=['Татьяна', 'Александр', 'Иван'])<br/>
Привет, Татьяна!<br/>
Привет, Александр!<br/>
Привет, Иван!<br/>
<br/>
<br/>
$ python coolprogram.py goodbye --count 3<br/>
<br/>
Namespace(command='goodbye', count=3)<br/>
Прощай, мир!<br/>
Прощай, мир!<br/>
Прощай, мир!<br/>
<br/>
<br/>
$ python coolprogram.py<br/>
<br/>
Namespace(command=None)<br/>
Что-то пошло не так...</p></div>
  
</div>

<p class="vspace"/><h4><a name="help" id="help"/> Оформление справки</h4>
<p>До сих пор мы старались как можно больше работы возложить на <em>argparse</em> и при этом радовались, что эта стандартная библиотека может сама проверять переданные параметры на ошибки, и в случае их возникновения выдавать нам сообщения о них. Но, честно говоря, эти сообщения по умолчанию не особо информативны для конечного пользователя. К тому же он не всегда может помнить о требуемых параметрах. В этом случае правильный пользователь вызывает справку по программе. Так уж исторически сложилось, что в UNIX-подобных операционных системах для вызова справки по программе помимо знаменитой программы <em>man</em> используется специальный параметр командной строки <em>--help</em> или <em>-h</em>, причем эти справки как правило выглядят примерно одинаково по оформлению. Чтобы было понятно, о чем я говорю, вызовем такую справку для программы <em>htop</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock72">
  <div class="sourceblocktext"><p class="text">$ htop -h<br/>
<br/>
htop 1.0.2 - (C) 2004-2011 Hisham Muhammad<br/>
Released under the GNU GPL.<br/>
<br/>
-C --no-color               Use a monochrome color scheme<br/>
-d --delay=DELAY            Set the delay between updates, in tenths of seconds<br/>
-h --help                   Print this help screen<br/>
-s --sort-key=COLUMN        Sort by COLUMN (try --sort-key=help for a list)<br/>
-u --user=USERNAME          Show only processes of a given user<br/>
-p --pid=PID,[,PID,PID...]  Show only the given PIDs<br/>
-v --version          Print version info<br/>
<br/>
Long options may be passed with a single dash.<br/>
<br/>
Press F1 inside htop for online help.<br/>
See 'man htop' for more information.</p></div>
  
</div>

<p class="vspace">В эту справку входит название программы, ее версия, копирайт, возможно, описание того, что она делает, и список ожидаемых параметров командной строки - обязательные и не очень.
</p>
<p class="vspace">Нам, как программистам, будет приятно узнать, что библиотека <em>argparse</em> для любой программы, ее использующей, автоматически создает такую справку, правда, по умолчанию она выглядит не самым впечатляющим образом, но ее можно (нужно) доработать напильником.
</p>
<p class="vspace">Далее мы будем заниматься оформлением нашего последнего скрипта. Даже если мы ничего не будем для этого предпринимать, то справка все-равно будет создана, чтобы ее увидеть запустим скрипт с параметром <em>--help</em> (можно и просто <em>-h</em>):
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock73">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py --help<br/>
<br/>
usage: coolprogram.py [-h] {hello,goodbye} ...<br/>
<br/>
positional arguments:<br/>
  {hello,goodbye}<br/>
<br/>
optional arguments:<br/>
  -h, --help       show this help message and exit</p></div>
  
</div>

<p class="vspace">Мы также можем получить справку о каждой команде (подпарсере):
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock74">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py hello --help<br/>
<br/>
usage: coolprogram.py hello [-h] [--names NAMES [NAMES ...]]<br/>
<br/>
optional arguments:<br/>
  -h, --help            show this help message and exit<br/>
  --names NAMES [NAMES ...], -n NAMES [NAMES ...]<br/>
<br/>
<br/>
$ python coolprogram.py goodbye --help<br/>
<br/>
usage: coolprogram.py goodbye [-h] [-c COUNT]<br/>
<br/>
optional arguments:<br/>
  -h, --help            show this help message and exit<br/>
  -c COUNT, --count COUNT</p></div>
  
</div>

<p class="vspace">Для того, чтобы повлиять на внешний вид выводимой справки, используются дополнительные параметры конструкторе <em>ArgumentParser</em>, а также в методах <em>add_argument</em>, <em>add_subparsers</em> и <em>add_parser</em>. 
</p>
<p class="vspace">Прежде чем браться за код, сведем в один список основные параметры, влияющие на внешний вид справки.
</p>
<p class="vspace"/><ul><li>Чтобы изменить выводимое имя программы, используется параметр <em>prog</em> конструктора класса <em>ArgumentParser</em>. Если этот параметр не указан, в качестве имени программы берется значение <em>sys.argv[0]</em>.
<p class="vspace"/></li><li>Чтобы добавить краткое описание программы, используется параметр <em>description</em> конструктора класса <em>ArgumentParser</em>.
<p class="vspace"/></li><li>Чтобы добавить пояснения после списка всех возможных параметров, используется параметр <em>epilog</em> конструктора класса <em>ArgumentParser</em>.
<p class="vspace"/></li><li>Чтобы добавить описание параметра, используется параметр <em>help</em> метода <em>add_argument</em>.
<p class="vspace"/></li><li>Чтобы изменить имя аргумента параметра (не имя самого параметра!), используется параметр <em>metavar</em> метода <em>add_argument</em>.
<p class="vspace"/></li><li>Чтобы добавить описание к группе подпарсеров (мы до сих пор использовали только одну группу подпарсеров, создаваемых с помощью метода <em>add_subparsers</em>, но, в принципе, их может быть несколько), используется параметр <em>description</em> метода <em>add_subparsers</em>.
<p class="vspace"/></li><li>Чтобы изменить заголовок группы подпарсеров (по умолчанию используется имя "subcommands"), используется параметр <em>title</em> метода <em>add_subparsers</em>.
<p class="vspace"/></li><li>Чтобы изменить оформление списка возможных команд подпарсера, используется параметр <em>metavar</em> метода <em>add_subparsers</em>. По умолчанию список команд выводится в фигурных скобках: {command1, command2, ...}
</li></ul><p class="vspace">Это еще не полный список того, как можно изменять внешний вид справки, но это основные моменты, которые понадобятся в первую очередь.
</p>
<p class="vspace">Давайте постепенно изменять нашу программу и смотреть на полученный результат. Сначала добавим описание для программы в целом.
</p>
<p class="vspace">Чтобы не отвлекаться на реализацию отдельных команд, далее приведен только код создания парсера, остальная часть программы осталась неизменной.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock75">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span></p></li>
<li class="li1"><p class="de1">            prog = <span class="st0">'coolprogram'</span>, </p></li>
<li class="li1"><p class="de1">            description = <span class="st0">''</span><span class="st0">'Это очень полезная программа, </span></p></li>
<li class="li2"><p class="de2"><span class="st0">которая позволяет поприветствовать нужных людей, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">или попрощаться... со всеми.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            epilog = <span class="st0">''</span><span class="st0">'(c) Jenyay 2014. Автор программы, как всегда, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">не несет никакой ответственности ни за что.'</span><span class="st0">''</span></p></li>
<li class="li1"><p class="de1">            <span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    subparsers = <span class="kw3">parser</span>.<span class="me1">add_subparsers</span> <span class="br0">(</span>dest=<span class="st0">'command'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    hello_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'hello'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    hello_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--names'</span>, <span class="st0">'-n'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    goodbye_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'goodbye'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    goodbye_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Посмотрим, как теперь выглядит справка по программе:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock76">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py -h<br/>
usage: coolprogram [-h] {hello,goodbye} ...<br/>
<br/>
Это очень нужная программа, которая позволяет поприветствовать нужных людей,<br/>
или попрощаться... со всеми.<br/>
<br/>
positional arguments:<br/>
  {hello,goodbye}<br/>
<br/>
optional arguments:<br/>
  -h, --help       show this help message and exit<br/>
<br/>
(c) Jenyay 2014. Автор программы, как всегда, не несет никакой ответственности<br/>
ни за что.</p></div>
  
</div>

<p class="vspace">Оставим в стороне философский вопрос о том, на каком языке писать справку по программе, для простоты и наглядности мы будем везде использовать русский язык. Еще можно обратить внимание на то, что при выводе описаний были проигнорированы все переносы строк внутри многострочной конструкции '''...''', так что можно смело разбивать описания на несколько строк, а не писать их в одну строку в тысячу сто символов.
</p>
<p class="vspace">Теперь добавим описания команд и их параметров.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock77">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span></p></li>
<li class="li1"><p class="de1">            prog = <span class="st0">'coolprogram'</span>, </p></li>
<li class="li1"><p class="de1">            description = <span class="st0">''</span><span class="st0">'Это очень полезная программа, </span></p></li>
<li class="li2"><p class="de2"><span class="st0">которая позволяет поприветствовать нужных людей, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">или попрощаться... со всеми.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            epilog = <span class="st0">''</span><span class="st0">'(c) Jenyay 2014. Автор программы, как всегда, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">не несет никакой ответственности ни за что.'</span><span class="st0">''</span></p></li>
<li class="li1"><p class="de1">            <span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    subparsers = <span class="kw3">parser</span>.<span class="me1">add_subparsers</span> <span class="br0">(</span>dest = <span class="st0">'command'</span>, </p></li>
<li class="li1"><p class="de1">            title = <span class="st0">'Возможные команды'</span>,</p></li>
<li class="li1"><p class="de1">            description = <span class="st0">'Команды, которые должны быть в качестве первого параметра %(prog)s'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    hello_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'hello'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    hello_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--names'</span>, <span class="st0">'-n'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Список приветствуемых людей'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    goodbye_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'goodbye'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    goodbye_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span>,</p></li>
<li class="li2"><p class="de2">            <span class="kw2">help</span> = <span class="st0">'Сколько раз попрощаться с миром'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь справка по программе и по ее командам выглядит следующим образом:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock78">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py -h<br/>
usage: coolprogram [-h] {hello,goodbye} ...<br/>
<br/>
Это очень полезная программа, которая позволяет поприветствовать нужных людей,<br/>
или попрощаться... со всеми.<br/>
<br/>
optional arguments:<br/>
  -h, --help       show this help message and exit<br/>
<br/>
Возможные команды:<br/>
  Команды, которые должны быть в качестве первого параметра coolprogram<br/>
<br/>
  {hello,goodbye}<br/>
<br/>
(c) Jenyay 2014. Автор программы, как всегда, не несет никакой ответственности<br/>
ни за что.</p></div>
  
</div>

<p class="vspace"/>
<div class="sourceblock " id="sourceblock79">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py hello -h<br/>
usage: coolprogram hello [-h] [--names NAMES [NAMES ...]]<br/>
<br/>
optional arguments:<br/>
  -h, --help            show this help message and exit<br/>
  --names NAMES [NAMES ...], -n NAMES [NAMES ...]<br/>
                        Список приветствуемых людей</p></div>
  
</div>

<p class="vspace"/>
<div class="sourceblock " id="sourceblock80">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py goodbye -h<br/>
usage: coolprogram goodbye [-h] [-c COUNT]<br/>
<br/>
optional arguments:<br/>
  -h, --help            show this help message and exit<br/>
  -c COUNT, --count COUNT<br/>
                        Сколько раз попрощаться с миром</p></div>
  
</div>

<p class="vspace">В коде выше мы использовали специальный символ подстановки <em>%(prog)s</em>, который заменяется в тексте на имя программы, указанное с помощью параметра <em>prog</em> конструктора <em>ArgumentParser</em>.
</p>
<p class="vspace">Теперь обратим свой взор на имена значений параметров. По умолчанию они совпадают с именем параметра, но написаны заглавными буквами. В данной программе еще можно понять, что под этими названиями подразумевается, но лучше дать им более осмысленные имена. Для этого воспользуемся параметром <em>metavar</em>.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock81">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span></p></li>
<li class="li1"><p class="de1">            prog = <span class="st0">'coolprogram'</span>, </p></li>
<li class="li1"><p class="de1">            description = <span class="st0">''</span><span class="st0">'Это очень полезная программа, </span></p></li>
<li class="li2"><p class="de2"><span class="st0">которая позволяет поприветствовать нужных людей, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">или попрощаться... со всеми.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            epilog = <span class="st0">''</span><span class="st0">'(c) Jenyay 2014. Автор программы, как всегда, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">не несет никакой ответственности ни за что.'</span><span class="st0">''</span></p></li>
<li class="li1"><p class="de1">            <span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    subparsers = <span class="kw3">parser</span>.<span class="me1">add_subparsers</span> <span class="br0">(</span>dest = <span class="st0">'command'</span>, </p></li>
<li class="li1"><p class="de1">            title = <span class="st0">'Возможные команды'</span>,</p></li>
<li class="li1"><p class="de1">            description = <span class="st0">'Команды, которые должны быть в качестве первого параметра %(prog)s'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    hello_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'hello'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    hello_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--names'</span>, <span class="st0">'-n'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Список приветствуемых людей'</span>,</p></li>
<li class="li1"><p class="de1">            metavar = <span class="st0">'ИМЯ'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    goodbye_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'goodbye'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    goodbye_parser.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Сколько раз попрощаться с миром'</span>,</p></li>
<li class="li1"><p class="de1">            metavar = <span class="st0">'КОЛИЧЕСТВО'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь справка стала чуть более симпатичной:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock82">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py hello -h<br/>
<br/>
usage: coolprogram hello [-h] [--names ИМЯ [ИМЯ ...]]<br/>
<br/>
optional arguments:<br/>
  -h, --help            show this help message and exit<br/>
  --names ИМЯ [ИМЯ ...], -n ИМЯ [ИМЯ ...]<br/>
                        Список приветствуемых людей</p></div>
  
</div>

<p class="vspace"/>
<div class="sourceblock " id="sourceblock83">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py goodbye -h<br/>
<br/>
usage: coolprogram goodbye [-h] [-c КОЛИЧЕСТВО]<br/>
<br/>
optional arguments:<br/>
  -h, --help            show this help message and exit<br/>
  -c КОЛИЧЕСТВО, --count КОЛИЧЕСТВО<br/>
                        Сколько раз попрощаться с миром</p></div>
  
</div>

<p class="vspace">Однако, что-то справку все-таки портит. Мы практически все русифицировали, остались непереведенными только фразы "usage" и "optional arguments". Займемся сейчас второй фразой.
</p>
<p class="vspace">Ее перевести будет уже чуть сложнее, но не сильно. На самом деле все параметры по умолчанию не только принадлежат какому-то парсеру, но и могут объединяться по группам. Если группы явно не заданы, то параметры попадают в одну из групп: "positional arguments" или "optional arguments". Но мы можем создать и свою группу с помощью метода <em>add_argument_group</em>. Этот метод возвращает экземпляр класса группы (экземпляр внутреннего класса <em>_ArgumentGroup</em>), после чего мы должны, как и прежде, вызывать метод <em>add_argument</em> для добавления параметров, но уже не парсера, а группы. Это показано в следующем примере:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock84">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span></p></li>
<li class="li1"><p class="de1">            prog = <span class="st0">'coolprogram'</span>, </p></li>
<li class="li1"><p class="de1">            description = <span class="st0">''</span><span class="st0">'Это очень полезная программа, </span></p></li>
<li class="li2"><p class="de2"><span class="st0">которая позволяет поприветствовать нужных людей, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">или попрощаться... со всеми.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            epilog = <span class="st0">''</span><span class="st0">'(c) Jenyay 2014. Автор программы, как всегда, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">не несет никакой ответственности ни за что.'</span><span class="st0">''</span></p></li>
<li class="li1"><p class="de1">            <span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    subparsers = <span class="kw3">parser</span>.<span class="me1">add_subparsers</span> <span class="br0">(</span>dest = <span class="st0">'command'</span>, </p></li>
<li class="li1"><p class="de1">            title = <span class="st0">'Возможные команды'</span>,</p></li>
<li class="li1"><p class="de1">            description = <span class="st0">'Команды, которые должны быть в качестве первого параметра %(prog)s'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    hello_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'hello'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2">    hello_group = hello_parser.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    hello_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--names'</span>, <span class="st0">'-n'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Список приветствуемых людей'</span>,</p></li>
<li class="li1"><p class="de1">            metavar = <span class="st0">'ИМЯ'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    goodbye_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'goodbye'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    goodbye_group = goodbye_parser.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    goodbye_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span>,</p></li>
<li class="li2"><p class="de2">            <span class="kw2">help</span> = <span class="st0">'Сколько раз попрощаться с миром'</span>,</p></li>
<li class="li1"><p class="de1">            metavar = <span class="st0">'КОЛИЧЕСТВО'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь справка по параметрам будет выглядеть следующим образом:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock85">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py hello -h<br/>
<br/>
usage: coolprogram hello [-h] [--names ИМЯ [ИМЯ ...]]<br/>
<br/>
optional arguments:<br/>
  -h, --help            show this help message and exit<br/>
<br/>
Параметры:<br/>
  --names ИМЯ [ИМЯ ...], -n ИМЯ [ИМЯ ...]<br/>
                        Список приветствуемых людей</p></div>
  
</div>

<p class="vspace">Уже лучше, однако группа "optional arguments" никуда не делась, поскольку параметр <em>--help</em> / <em>-h</em> был добавлен библиотекой еще до того, как мы создали группу. Выход из этой ситуации простой. Во-первых, надо сказать классу <em>ArgumentParser</em>, что нам его встроенная справка не нужна, для этого в конструктор передадим еще один параметр <em>add_help=False</em>. Также надо не забыть добавить параметр <em>add_help = False</em> в метод <em>add_parser</em> для каждого подпарсера. Затем добавим параметр <em>--help</em> / <em>-h</em> вручную. Самим нам оформлять справку не придется, поскольку при добавлении этого параметра мы передадим в метод <em>add_argument</em> параметр <em>action='help</em>', который указывает, что при получении этого параметра нужно отобразить справку.
</p>
<p class="vspace">Теперь наш код создания парсера выглядит следующим образом:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock86">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем класс парсера</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span></p></li>
<li class="li1"><p class="de1">            prog = <span class="st0">'coolprogram'</span>, </p></li>
<li class="li2"><p class="de2">            description = <span class="st0">''</span><span class="st0">'Это очень полезная программа, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">которая позволяет поприветствовать нужных людей, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">или попрощаться... со всеми.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            epilog = <span class="st0">''</span><span class="st0">'(c) Jenyay 2014. Автор программы, как всегда, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">не несет никакой ответственности ни за что.'</span><span class="st0">''</span>,</p></li>
<li class="li2"><p class="de2">            add_help = <span class="kw2">False</span></p></li>
<li class="li1"><p class="de1">            <span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем группу параметров для родительского парсера,</span></p></li>
<li class="li1"><p class="de1">    <span class="co1"># ведь у него тоже должен быть параметр --help / -h</span></p></li>
<li class="li2"><p class="de2">    parent_group = <span class="kw3">parser</span>.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    parent_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--help'</span>, <span class="st0">'-h'</span>, action=<span class="st0">'help'</span>, <span class="kw2">help</span>=<span class="st0">'Справка'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="co1"># Создаем группу подпарсеров</span></p></li>
<li class="li1"><p class="de1">    subparsers = <span class="kw3">parser</span>.<span class="me1">add_subparsers</span> <span class="br0">(</span>dest = <span class="st0">'command'</span>, </p></li>
<li class="li1"><p class="de1">            title = <span class="st0">'Возможные команды'</span>,</p></li>
<li class="li1"><p class="de1">            description = <span class="st0">'Команды, которые должны быть в качестве первого параметра %(prog)s'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="co1"># Создаем парсер для команды hello</span></p></li>
<li class="li1"><p class="de1">    hello_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'hello'</span>, </p></li>
<li class="li1"><p class="de1">            add_help = <span class="kw2">False</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем новую группу параметров</span></p></li>
<li class="li2"><p class="de2">    hello_group = hello_parser.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Добавляем параметры</span></p></li>
<li class="li1"><p class="de1">    hello_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--names'</span>, <span class="st0">'-n'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Список приветствуемых людей'</span>,</p></li>
<li class="li2"><p class="de2">            metavar = <span class="st0">'ИМЯ'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    hello_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--help'</span>, <span class="st0">'-h'</span>, action=<span class="st0">'help'</span>, <span class="kw2">help</span>=<span class="st0">'Справка'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="co1"># Создаем парсер для команды goodbye</span></p></li>
<li class="li1"><p class="de1">    goodbye_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'goodbye'</span>, add_help = <span class="kw2">False</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем новую группу параметров</span></p></li>
<li class="li1"><p class="de1">    goodbye_group = goodbye_parser.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Добавляем параметры</span></p></li>
<li class="li1"><p class="de1">    goodbye_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Сколько раз попрощаться с миром'</span>,</p></li>
<li class="li1"><p class="de1">            metavar = <span class="st0">'КОЛИЧЕСТВО'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    goodbye_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--help'</span>, <span class="st0">'-h'</span>, action=<span class="st0">'help'</span>, <span class="kw2">help</span>=<span class="st0">'Справка'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Выглядит почти идеально:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock87">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py hello -h<br/>
<br/>
usage: coolprogram hello [--names ИМЯ [ИМЯ ...]] [--help]<br/>
<br/>
Параметры:<br/>
  --names ИМЯ [ИМЯ ...], -n ИМЯ [ИМЯ ...]<br/>
                        Список приветствуемых людей<br/>
  --help, -h            Справка</p></div>
  
</div>

<p class="vspace"/>
<div class="sourceblock " id="sourceblock88">
  <div class="sourceblocktext"><p class="text">$ py3 coolprogram.py goodbye -h<br/>
<br/>
usage: coolprogram goodbye [-c КОЛИЧЕСТВО] [--help]<br/>
<br/>
Параметры:<br/>
  -c КОЛИЧЕСТВО, --count КОЛИЧЕСТВО<br/>
                        Сколько раз попрощаться с миром<br/>
  --help, -h            Справка</p></div>
  
</div>

<p class="vspace">Не забыли мы и про справку для корневого парсера:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock89">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py -h<br/>
usage: coolprogram [--help] {hello,goodbye} ...<br/>
<br/>
Это очень полезная программа, которая позволяет поприветствовать нужных людей,<br/>
или попрощаться... со всеми.<br/>
<br/>
Параметры:<br/>
  --help, -h       Справка<br/>
<br/>
Возможные команды:<br/>
  Команды, которые должны быть в качестве первого параметра coolprogram<br/>
<br/>
  {hello,goodbye}<br/>
<br/>
(c) Jenyay 2014. Автор программы, как всегда, не несет никакой ответственности<br/>
ни за что.</p></div>
  
</div>

<p class="vspace">Осталось сделать самую малость - добавить описания для команд. Для этого воспользуемся параметрами <em>help</em> и <em> description</em> метода <em>add_parser</em>.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock90">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем класс парсера</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span></p></li>
<li class="li1"><p class="de1">            prog = <span class="st0">'coolprogram'</span>, </p></li>
<li class="li2"><p class="de2">            description = <span class="st0">''</span><span class="st0">'Это очень полезная программа, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">которая позволяет поприветствовать нужных людей, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">или попрощаться... со всеми.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            epilog = <span class="st0">''</span><span class="st0">'(c) Jenyay 2014. Автор программы, как всегда, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">не несет никакой ответственности ни за что.'</span><span class="st0">''</span>,</p></li>
<li class="li2"><p class="de2">            add_help = <span class="kw2">False</span></p></li>
<li class="li1"><p class="de1">            <span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем группу параметров для родительского парсера,</span></p></li>
<li class="li1"><p class="de1">    <span class="co1"># ведь у него тоже должен быть параметр --help / -h</span></p></li>
<li class="li2"><p class="de2">    parent_group = <span class="kw3">parser</span>.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    parent_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--help'</span>, <span class="st0">'-h'</span>, action=<span class="st0">'help'</span>, <span class="kw2">help</span>=<span class="st0">'Справка'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="co1"># Создаем группу подпарсеров</span></p></li>
<li class="li1"><p class="de1">    subparsers = <span class="kw3">parser</span>.<span class="me1">add_subparsers</span> <span class="br0">(</span>dest = <span class="st0">'command'</span>, </p></li>
<li class="li1"><p class="de1">            title = <span class="st0">'Возможные команды'</span>,</p></li>
<li class="li1"><p class="de1">            description = <span class="st0">'Команды, которые должны быть в качестве первого параметра %(prog)s'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="co1"># Создаем парсер для команды hello</span></p></li>
<li class="li1"><p class="de1">    hello_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'hello'</span>, </p></li>
<li class="li1"><p class="de1">            add_help = <span class="kw2">False</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Запуск в режиме "Hello, world!"'</span>,</p></li>
<li class="li1"><p class="de1">            description = <span class="st0">''</span><span class="st0">'Запуск в режиме "Hello, world!". </span></p></li>
<li class="li2"><p class="de2"><span class="st0">В этом режиме программа приветствует список людей, переданных в качестве параметра.'</span><span class="st0">''</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем новую группу параметров</span></p></li>
<li class="li1"><p class="de1">    hello_group = hello_parser.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="co1"># Добавляем параметры</span></p></li>
<li class="li1"><p class="de1">    hello_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--names'</span>, <span class="st0">'-n'</span>, nargs=<span class="st0">'+'</span>, default=<span class="br0">[</span><span class="st0">'мир'</span><span class="br0">]</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Список приветствуемых людей'</span>,</p></li>
<li class="li1"><p class="de1">            metavar = <span class="st0">'ИМЯ'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    hello_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--help'</span>, <span class="st0">'-h'</span>, action=<span class="st0">'help'</span>, <span class="kw2">help</span>=<span class="st0">'Справка'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем парсер для команды goodbye</span></p></li>
<li class="li1"><p class="de1">    goodbye_parser = subparsers.<span class="me1">add_parser</span> <span class="br0">(</span><span class="st0">'goodbye'</span>, </p></li>
<li class="li2"><p class="de2">            add_help = <span class="kw2">False</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Запуск в режиме "Goodbye, world!"'</span>,</p></li>
<li class="li1"><p class="de1">            description = <span class="st0">''</span><span class="st0">'В этом режиме программа прощается с миром.'</span><span class="st0">''</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем новую группу параметров</span></p></li>
<li class="li2"><p class="de2">    goodbye_group = goodbye_parser.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Добавляем параметры</span></p></li>
<li class="li1"><p class="de1">    goodbye_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'-c'</span>, <span class="st0">'--count'</span>, <span class="kw2">type</span>=<span class="kw2">int</span>, default=<span class="nu0">1</span>,</p></li>
<li class="li1"><p class="de1">            <span class="kw2">help</span> = <span class="st0">'Сколько раз попрощаться с миром'</span>,</p></li>
<li class="li2"><p class="de2">            metavar = <span class="st0">'КОЛИЧЕСТВО'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    goodbye_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--help'</span>, <span class="st0">'-h'</span>, action=<span class="st0">'help'</span>, <span class="kw2">help</span>=<span class="st0">'Справка'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">return</span> <span class="kw3">parser</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Теперь справка выглядит полностью законченной:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock91">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py -h<br/>
<br/>
usage: coolprogram [--help] {hello,goodbye} ...<br/>
<br/>
Это очень полезная программа, которая позволяет поприветствовать нужных людей,<br/>
или попрощаться... со всеми.<br/>
<br/>
Параметры:<br/>
  --help, -h       Справка<br/>
<br/>
Возможные команды:<br/>
  Команды, которые должны быть в качестве первого параметра coolprogram<br/>
<br/>
  {hello,goodbye}<br/>
    hello          Запуск в режиме "Hello, world!"<br/>
    goodbye        Запуск в режиме "Goodbye, world!"<br/>
<br/>
(c) Jenyay 2014. Автор программы, как всегда, не несет никакой ответственности<br/>
ни за что.</p></div>
  
</div>

<p class="vspace"/>
<div class="sourceblock " id="sourceblock92">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py hello -h<br/>
<br/>
usage: coolprogram hello [--names ИМЯ [ИМЯ ...]] [--help]<br/>
<br/>
Запуск в режиме "Hello, world!". В этом режиме программа приветствует список<br/>
людей, переданных в качестве параметра.<br/>
<br/>
Параметры:<br/>
  --names ИМЯ [ИМЯ ...], -n ИМЯ [ИМЯ ...]<br/>
                        Список приветствуемых людей<br/>
  --help, -h            Справка</p></div>
  
</div>

<p class="vspace"/>
<div class="sourceblock " id="sourceblock93">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py goodbye -h<br/>
<br/>
usage: coolprogram goodbye [-c КОЛИЧЕСТВО] [--help]<br/>
<br/>
В этом режиме программа прощается с миром.<br/>
<br/>
Параметры:<br/>
  -c КОЛИЧЕСТВО, --count КОЛИЧЕСТВО<br/>
                        Сколько раз попрощаться с миром<br/>
  --help, -h            Справка</p></div>
  
</div>

<p class="vspace">И чтобы окончательно навести порядок, не мешало бы добавить еще один параметр в родительский парсер, а именно параметр <em>--version</em> для показа текущей версии программы. Это легко реализуется благодаря параметру <em>action='version</em>' метода <em>add_argument</em>.
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock94">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="co1">#!/usr/bin/python</span></p></li>
<li class="li1"><p class="de1"><span class="co1"># -*- coding: UTF-8 -*-</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"><span class="kw1">import</span> <span class="kw3">sys</span></p></li>
<li class="li2"><p class="de2"><span class="kw1">import</span> argparse</p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">version = <span class="st0">"1.2.1"</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2"><span class="kw1">def</span> createParser <span class="br0">(</span><span class="br0">)</span>:</p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем класс парсера</span></p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = argparse.<span class="me1">ArgumentParser</span><span class="br0">(</span></p></li>
<li class="li1"><p class="de1">            prog = <span class="st0">'coolprogram'</span>, </p></li>
<li class="li1"><p class="de1">            description = <span class="st0">''</span><span class="st0">'Это очень полезная программа, </span></p></li>
<li class="li2"><p class="de2"><span class="st0">которая позволяет поприветствовать нужных людей, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">или попрощаться... со всеми.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            epilog = <span class="st0">''</span><span class="st0">'(c) Jenyay 2014. Автор программы, как всегда, </span></p></li>
<li class="li1"><p class="de1"><span class="st0">не несет никакой ответственности ни за что.'</span><span class="st0">''</span>,</p></li>
<li class="li1"><p class="de1">            add_help = <span class="kw2">False</span></p></li>
<li class="li2"><p class="de2">            <span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="co1"># Создаем группу параметров для родительского парсера,</span></p></li>
<li class="li1"><p class="de1">    <span class="co1"># ведь у него тоже должен быть параметр --help / -h</span></p></li>
<li class="li1"><p class="de1">    parent_group = <span class="kw3">parser</span>.<span class="me1">add_argument_group</span> <span class="br0">(</span>title=<span class="st0">'Параметры'</span><span class="br0">)</span></p></li>
<li class="li2"><p class="de2"> </p></li>
<li class="li1"><p class="de1">    parent_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--help'</span>, <span class="st0">'-h'</span>, action=<span class="st0">'help'</span>, <span class="kw2">help</span>=<span class="st0">'Справка'</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    parent_group.<span class="me1">add_argument</span> <span class="br0">(</span><span class="st0">'--version'</span>, </p></li>
<li class="li1"><p class="de1">            action=<span class="st0">'version'</span>, </p></li>
<li class="li2"><p class="de2">            <span class="kw2">help</span> = <span class="st0">'Вывести номер версии'</span>,</p></li>
<li class="li1"><p class="de1">            version=<span class="st0">'%(prog)s {}'</span>.<span class="me1">format</span> <span class="br0">(</span>version<span class="br0">)</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">Для наглядности номер версии будет храниться в глобальной переменной <em>version</em>, а воспользуемся мы ей в строках 28-31, где опять используется символ подстановки <em>%(prog)s</em>, который, напомню, обозначает имя программы, после которого мы добавим номер версии. Воспользуемся этим параметром:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock95">
  <div class="sourceblocktext"><p class="text">$ pythono coolprogram.py --version<br/>
<br/>
coolprogram 1.2.1</p></div>
  
</div>

<p class="vspace">А справка по параметрам теперь выглядит следующим образом:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock96">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py -h<br/>
<br/>
usage: coolprogram [--help] [--version] {hello,goodbye} ...<br/>
<br/>
Это очень полезная программа, которая позволяет поприветствовать нужных людей,<br/>
или попрощаться... со всеми.<br/>
<br/>
Параметры:<br/>
  --help, -h       Справка<br/>
  --version        Вывести номер версии<br/>
<br/>
Возможные команды:<br/>
  Команды, которые должны быть в качестве первого параметра coolprogram<br/>
<br/>
  {hello,goodbye}<br/>
    hello          Запуск в режиме "Hello, world!"<br/>
    goodbye        Запуск в режиме "Goodbye, world!"<br/>
<br/>
(c) Jenyay 2014. Автор программы, как всегда, не несет никакой ответственности<br/>
ни за что.</p></div>
  
</div>

<p class="vspace">И последнее, что нам осталось научиться делать со справкой - это принудительно ее выводить, например, при вводе пользователем каких-то неправильных комбинаций параметров (в том числе, когда он вводит взаимоисключающие параметры).
</p>
<p class="vspace">Сейчас у нас в случае, если пользователь не вводит никакую команду, выводится текст: "Что-то пошло не так...", но буквально одной строкой мы изменим это поведение таким образом, чтобы в этом случае выводилась справка. Для этого достаточно вызвать метод <em>print_help</em> класса <em>ArgumentParser</em>:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock97">
  <div class="sourceblocktext"><div class="python"><ol><li class="li1"><p class="de1"><span class="kw1">if</span> __name__ == <span class="st0">'__main__'</span>:</p></li>
<li class="li1"><p class="de1">    <span class="kw3">parser</span> = createParser<span class="br0">(</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    namespace = <span class="kw3">parser</span>.<span class="me1">parse_args</span><span class="br0">(</span><span class="kw3">sys</span>.<span class="me1">argv</span><span class="br0">[</span><span class="nu0">1</span>:<span class="br0">]</span><span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li2"><p class="de2">    <span class="kw1">print</span> <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1"> </p></li>
<li class="li1"><p class="de1">    <span class="kw1">if</span> namespace.<span class="me1">command</span> == <span class="st0">"hello"</span>:</p></li>
<li class="li1"><p class="de1">        run_hello <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">elif</span> namespace.<span class="me1">command</span> == <span class="st0">"goodbye"</span>:</p></li>
<li class="li2"><p class="de2">        run_goodbye <span class="br0">(</span>namespace<span class="br0">)</span></p></li>
<li class="li1"><p class="de1">    <span class="kw1">else</span>:</p></li>
<li class="li1"><p class="de1">        <span class="kw3">parser</span>.<span class="me1">print_help</span><span class="br0">(</span><span class="br0">)</span></p></li>
</ol></div></div>
  
</div>

<p class="vspace">В остальном програма осталась без изменений. Попробуем запустить ее без параметров:
</p>
<p class="vspace"/>
<div class="sourceblock " id="sourceblock98">
  <div class="sourceblocktext"><p class="text">$ python coolprogram.py<br/>
<br/>
Namespace(command=None)<br/>
usage: coolprogram [--help] [--version] {hello,goodbye} ...<br/>
<br/>
Это очень полезная программа, которая позволяет поприветствовать нужных людей,<br/>
или попрощаться... со всеми.<br/>
<br/>
Параметры:<br/>
  --help, -h       Справка<br/>
  --version        Вывести номер версии<br/>
<br/>
Возможные команды:<br/>
  Команды, которые должны быть в качестве первого параметра coolprogram<br/>
<br/>
  {hello,goodbye}<br/>
    hello          Запуск в режиме "Hello, world!"<br/>
    goodbye        Запуск в режиме "Goodbye, world!"<br/>
<br/>
(c) Jenyay 2014. Автор программы, как всегда, не несет никакой ответственности<br/>
ни за что.</p></div>
  
</div>

<p class="vspace">Как видите, оформление справки занимает довольно много места, но по сути в этом нет ничего сложного, нужно просто заполнить нужные параметры.
</p>
<p class="vspace"/><h3><a name="outro" id="outro"/> Заключение</h3>
<p>Наконец-то эта статья заканчивается. Интересно, много ли людей почитали до этих строк, их хочется поблагодарить за терпение. 
</p>
<p class="vspace">В этой статье мы рассмотрели основные возможности стандартной Python-библиотеки <em>argparse</em>, посмотрели, как она упрощает жизнь по сравнению с ручным разбором параметров, научились создавать именованные и позиционные параметры, рассмотрели различные варианты их использования, в том числе в виде флагов, а также научились создавать команды и оформлять справку.
</p>
<p class="vspace">Несмотря на большой объем статьи, некоторые вопросы все-равно остались "за бортом". Например, мы не рассмотрели "склеивание" параметров (когда вместо git add -a -m "..." вы пишете просто git -am "..."). Проигнорировали классы, позволяющие еще более углубиться в оформление справки, не рассмотрели некоторые возможности параметра <em>action</em> метода <em>add_argument</em>, а также не поговорили о том, что на самом деле можно изменить формат параметров вида "-h" на формат вида "/h", принятый в Windows. Но все эти вопросы описаны в справке, в которой только надо найти описание нужной возможности.
</p>
<p class="vspace">Не мешало бы еще рассмотреть альтернативные нестандартные библиотеки для разбора командной строки, но это уже тема для отдельной статьи.
</p>
<p class="vspace">Спасибо за внимание, жду ваших комментариев и оценок.
</p>
<p class="vspace"><a name="comments" id="comments"/>
<br/> </p> 

<p class="vspace"/>

<hr/>
<div class="messagehead">
<p class="vspace"><strong>Дмитрий</strong> <span>29.01.2014 - 10:56</span>
</p></div>
<div class="messageitem">
<p>Очень основательная статья, Вы молодец! Спасибо!
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Sergey</strong> <span>01.02.2014 - 11:30</span>
</p></div>
<div class="messageitem">
<p>Замечательная статья!!! Читается и понимается на одном дыхании <img src="/pub/guibuttons/happy.gif" border="0" alt="happy smiley" title="happy smiley" class="smiley"/> . Для новичка то что нужно.
<br/>Хотелось увидеть аналогичные статьи по альтернативным модулям в будущем. Например по модулю logger...
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Анастасия</strong> <span>15.05.2014 - 16:09</span>
</p></div>
<div class="messageitem">
<p>Очень полезная статья. Автору, огромное спасибо!
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Николай</strong> <span>10.07.2014 - 14:20</span>
</p></div>


<div class="messageitem">
<p><img src="/pub/guibuttons/cool.gif" border="0" alt="cool smiley" title="cool smiley" class="smiley"/> респект 
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Александр</strong> <span>30.07.2014 - 13:05</span>
</p></div>
<div class="messageitem">
<p>Спасибо! Отличная статья!
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Сергій</strong> <span>12.08.2014 - 14:13</span>
</p></div>
<div class="messageitem">
<p>Неймовірна стаття! Все чітко, зрозуміло і детально розібрано. Бажаю Вам успіхів у подальших працях :)
</p></div>

<div class="messageitem">
<p>Это неоценимая помощь как в реализации нужного поведения, так и в придании профессионального вида моим скромным творениям. 
<br/>Огромное спасибо автору.
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Богдан</strong> <span>24.09.2014 - 12:04</span>
</p></div>
<div class="messageitem">
<p>Спасибо за статью, очень пригодилась!
</p></div>

<div class="messageitem">
<p>Большое спасибо. Очень пригодилась статья, всё доступно и понятно. По шагам улучшила свой код
</p></div>

<div class="messageitem">
<p>Статья очень помогла слезть с input-ов и научила вводить параметры в консоли
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Николай</strong> <span>04.02.2015 - 20:01</span>
</p></div>
<div class="messageitem">
<p>Огромное вам спасибо! Сохранил в закладки
</p></div>
<div class="messageitem"> 
<p><strong>для полоноты необходимо продолжение</strong>
</p></div>
<div class="messageitem">
<p>1. Спасибо за текст.
<br/>2. Как раз необходимо что-то типа:
</p><pre>  -с12-24 (вырезание колонок у задаваемых текстовых файлов; 
  -F1,2,5,8 (указываю с ком строке какие файлы открывать, под каждой "циферкой" для простоты набивки "спрятано" известное имя файла и их не больше 8-и и указано должно быть хотя бы одно имя, ещё может быть типа   -F2-6  т.е. работать в файлами с первого по шестой)
  -n1-12 это как в линукс команде head -n20-30  или tail, здесь надо указать не более какого-то числа строк (например, 35 наверное это дефолт обработка) 
</pre><p>...всего... 
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Владимир</strong> <span>03.12.2015 - 17:06</span>
</p></div>


<div class="messageitem">
<p>Здравсттвуйте! Помогите пожалуйста, я в командной строке питона вводил по одной команде, она выполнялась, и так набралась куча таких. Скажите, пожалуйста, как сохранить все команды, которые я написал?
<br/>Спасибо!
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong> <span>01.03.2016 - 09:26</span>
</p></div>
<div class="messageitem">
<p>Нужно набрать следующую команду:
</p>
<p class="vspace">import readline
<br/>readline.write_history_file('filename.py')
</p>
<p class="vspace">Но если такая задача стоит часто, лучше использовать IPython / Jupyter - <a class="urllink" href="http://ipython.org/">http://ipython.org/</a>
</p></div>
<p class="vspace"/>
</div>

			</div></body></html>