<html><body><div><div class="entry-content"><p><a href="http://artandlogic.com/wp-content/uploads/2014/07/pyramid-positive.png"><img class="aligncenter  wp-image-8424" alt="pyramid-positive" src="http://artandlogic.com/wp-content/uploads/2014/07/pyramid-positive-1024x235.png"/></a></p><p><a href="http://docs.formalchemy.org/pyramid_formalchemy/">pyramid_formalchemy</a> provides a CRUD interface for Pyramid based on FormAlchemy. Which is to say it looks at your SQLAlchemy models and automagically generates an HTML interface to create, read, update and delete instances of those models from the database, very much like Django’s admin interface. That sounds pretty cool, doesn’t it? In this post I will demonstrate how to get it up and running and then start customizing the forms.</p><p><a href="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy1.png"><img class="alignnone size-full wp-image-8413" alt="blogpost_formalchemy1" src="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy1.png"/></a></p><p><span class="more-anchor" id="more-8412"/></p><p>The <a href="http://www.pylonsproject.org/projects/pyramid/faq">Pyramid FAQ</a> suggests you use pyramid_formalchemy if you want a Django style admin interface for Pyramid. I tried it and found that while the documentation is terrible it looks like pyramid_formalchemy could be a good way to do this. It didn’t come out perfectly straight away, and it took some detective work to figure out how to customize it at all, but it looks like it’s actually quite easy to customize in any way you would like.</p><p>There’s also <a href="https://github.com/RedTurtle/fa.bootstrap">fa.bootstrap</a> which looks nice, and I think is based on pyramid_formalchemy, but I didn’t try, and I’m not sure what the license is.</p><h2>A Quick Introduction</h2><p>I will create a toy Pyramid app that I can use to keep track of which rock climbing routes I’ve climbed. This will involve first setting up a Pyramid app with sqlalchemy and pyramid_formalchemy, and then creating a sqlalchemy model class to store the info in the database, allowing pyramid_formalchemy to provide the forms to add and edit the information. So following along with the pyramid_formalchemy docs:</p><h4>Create The App And Get It Up And Running</h4><pre class="brush: bash; title: ; notranslate" title="">
$ # create the python environment and install necessary packages
$ mkvirtualenv formalchemy
$ pip install six
$ pip install pyramid_formalchemy
$ pip install pyramid_fanstatic
$ pip install fa.jquery
</pre><p>that’s <code>pyramid_fanstatic</code>, not <code>pyramid_fantastic</code> . . .</p><pre class="brush: bash; title: ; notranslate" title="">
$ # use Pyramid's pcreate to start a Pyramid app with sqlalchemy scaffolding.
$ pcreate -s alchemy rockclimber
</pre><p>as the docs say, update setup.py to add <code>'pyramid_formalchemy'</code> to <code>install_requires</code></p><pre class="brush: bash; title: ; notranslate" title="">
$ # now add the pyramid_formalchemy scaffolding
$ python setup.py develop
$ cd ..
$ pcreate -s pyramid_fa rockclimber
</pre><p>as README_FORMALCHEMY.txt says, add<br/> <code>config.include('rockclimber.fainit')</code><br/> to rockclimber/<strong>init</strong>.py: <code>main()</code></p><pre class="brush: bash; title: ; notranslate" title="">
$ # a missing dependency apparently
$ pip install couchdbkit
$ # run Pyramid's autogenerated db initialization script to create a sqlite db and tables.
$ initialize_rockclimber_db development.ini
$ # run the development web server
$ pserve development.ini
</pre><p>visit localhost:6543/admin</p><p><a href="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy1.png"><img class="alignnone size-full wp-image-8413" alt="blogpost_formalchemy1" src="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy1.png"/></a></p><p>and woo! that’s pretty fancy! the dummy MyModel class that the alchemy scaffold creates is available to CRUD.</p><h4>Add My Own Model</h4><p>So now it’s time for my rock climbing route model.<br/> add to rockclimber/models.py</p><pre class="brush: python; title: ; notranslate" title="">
from sqlalchemy import Boolean, Date

class Route(Base):
    '''
    A SQLAlchemy model class that will persist in the database
    all the information about a rock climbing route that I want
    to keep track of.
    '''
    __tablename__ = 'routes'
    id = Column(Integer, primary_key=True)
    name = Column(Text)
    rating = Column(Text)
    guidebook = Column(Text)
    route_type = Column(Text)
    is_indoor = Column(Boolean, default=False)
    location = Column(Text)
    date_climbed = Column(Date)
    climbing_partners = Column(Text)
    is_lead = Column(Boolean, default=True)
    notes = Column(Text)
</pre><pre class="brush: bash; title: ; notranslate" title="">
$ # recreate the database, and restart the web server
$ rm rockclimber.sqlite
$ initialize_rockclimber_db
$ pserve development.ini
</pre><p><a href="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy2.png"><img class="alignnone size-full wp-image-8414" alt="blogpost_formalchemy2" src="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy2.png"/></a></p><p>nice! So that was easy. There are a couple of things wrong with this though, the dates months are weird and it would be nice to have Route Type be a select.</p><h4>Add A Select Input And A Better Renderer For The Date</h4><p>One of the files created when the pyramid_fa scaffold was run was called faforms.py. If we make that file look like this:</p><pre class="brush: python; title: ; notranslate" title="">
from formalchemy import forms
from formalchemy import tables

from rockclimber import models

class FieldSet(forms.FieldSet):
    pass

class Grid(tables.Grid):
    pass

route_type_options = [('', ''), ('boulder', 'boulder'), ('sport', 'sport'), ('trad', 'trad')]
# Create a specially named instance of FieldSet that pyramid_formalchemy will find and use for
# the Route model.
Route = FieldSet(models.Route)
Route.configure(
        options=[
            Route.route_type.dropdown(options=route_type_options),
            Route.date_climbed.date(),
            ]
        )
</pre><p><a href="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy3.png"><img class="alignnone size-full wp-image-8415" alt="blogpost_formalchemy3" src="http://artandlogic.com/wp-content/uploads/2014/07/blogpost_formalchemy3.png"/></a></p><p>then we get a dropdown for route and avoid the month problem by using a different renderer for date altogether. There’s still a problem with the dropdown where the current value isn’t selected when you edit the model though.</p><p>So there we have it. You should take my solution for the dropdown and date rendering with a grain of salt as I’m not by any means an expert. This did seem to me to be the way you’re supposed to do it because the scaffold creates the faforms.py and then the pyramid_formalchemy views.py does this sort of thing:</p><pre class="brush: python; title: ; notranslate" title="">
350     @actions.action()
351     def new(self):
352         fs = self.get_fieldset(suffix='Add')
</pre><p>and:</p><pre class="brush: python; title: ; notranslate" title="">
 231         def get_fieldset(self, suffix='', id=None):
 232             """return a ``FieldSet`` object bound to the correct record for ``id``.
 233             """
 234             request = self.request
 235             model = id and request.model_instance or request.model_class
 236             form_name = request.model_name + suffix
 237             fs = getattr(request.forms, form_name, None)
 238             if fs is None:
 239                 fs = getattr(request.forms, request.model_name,
 240                              self.fieldset_class)
</pre><p>which is to say that on Add it first looks for an instance of a FieldSet named <code>RouteAdd</code> in faforms.py and then, if it fails to find that, for an instance of a FieldSet named <code>Route</code> in the same place, before using a default <code>FieldSet</code>.</p><h2>Would I Use This For Real?</h2><p>So, the documentation is bad. I couldn’t find a bunch of tutorials or articles about it when googling for help, and some of the stuff I did find was out of date. The <a href="https://groups.google.com/forum/#!topic/formalchemy/">FormAlchemy google group</a> I found had posts mostly between 2007 – 2012 (although more recent posts did have responses) which suggests it’s not currently very actively used. <code>pyramid_formalchemy</code> <a href="https://github.com/FormAlchemy/pyramid_formalchemy">last got a commit in April 2013</a>. There’s an obvious glaring problem with the out of the box date renderer.</p><p>On the other hand pyramid_formalchemy and FormAlchemy seem mature and fully featured. It was quite easy to get up and running and quite easy to customize once I understood what I needed to do. I was able to create a useful app in a couple of hours (even with all the googling) typing very few lines of code. Which is awesome.</p><p>I plan on using it again. Have you tried (and perhaps had better success with?) any other packages that solve this problem?</p><div id="ts-fab-below" class="ts-fab-wrapper"><span class="screen-reader-text">The following two tabs change content below.</span><div class="ts-fab-tabs"><div class="ts-fab-tab" id="ts-fab-latest-posts-below"><div class="ts-fab-text"><div class="ts-fab-header"><h4>Latest posts by Francis Bull <span class="latest-see-all">(<a href="http://artandlogic.com/author/fran112358/" rel="nofollow">see all</a>)</span></h4></div></div></div></div></div><p id="jp-relatedposts" class="jp-relatedposts"><h3 class="jp-relatedposts-headline"><em>Related</em></h3></p><p>Tags: <a href="http://artandlogic.com/tag/django/" rel="tag">Django</a>, <a href="http://artandlogic.com/tag/pyramid/" rel="tag">pyramid</a>, <a href="http://artandlogic.com/tag/python/" rel="tag">python</a></p> </div>  </div></body></html>