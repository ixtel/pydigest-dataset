<html><body><div><div class="pf-content"><p>I thought it would be fun to try out a few different Python object relational mappers (ORMs) besides SQLAlchemy. I recently stumbled across a project known as <a href="https://github.com/coleifer/peewee" target="_blank">peewee</a>. For this article, we will take the examples from my <a href="http://www.blog.pythonlibrary.org/2012/07/01/a-simple-sqlalchemy-0-7-0-8-tutorial/" target="_blank">SQLAlchemy tutorial</a> and port it to peewee to see how it stands up. The peewee project supports sqlite, postgres and MySQL out of the box, which isn’t as flexible as SQLAlchemy, but it’s not bad either. You can also use peewee with the Flask web framework, via a handy <a href="https://github.com/coleifer/flask-peewee/" target="_blank">Flask-peewee plugin</a>.</p>
<p>Anyway, let’s start playing around with this fun little library!</p>
<p><span id="more-4158"/></p>
<hr/>
<h3>Getting Started</h3>
<p>
</p><p>First of all, you will need to go get peewee. Fortunately it’s really easy if you have pip installed:</p>
<p><code><br/>
pip install peewee<br/>
</code></p>
<p>Once that’s installed, we’re good to go!</p>
<hr/>
<h3>Creating the Database</h3>
<p>
</p><p>Creating a database with peewee is extremely easy. In fact, it’s easier to create the database in peewee than it is in SQLAlchemy. All you need to do is call peewee’s <strong>SqliteDatabase</strong> method and pass it the path of the file or “:memory:” if you want an in-memory database. Let’s create a database to hold information about our music collection. We’ll create two tables: Artist and Album.</p>
<pre class="python"><span># models.py</span>
<span>import</span> peewee
 
database = peewee.<span>SqliteDatabase</span><span>(</span><span>"wee.db"</span><span>)</span>
 
<span>########################################################################</span>
<span>class</span> Artist<span>(</span>peewee.<span>Model</span><span>)</span>:
    <span>""</span><span>"
    ORM model of the Artist table
    "</span><span>""</span>
    name = peewee.<span>CharField</span><span>(</span><span>)</span>
 
    <span>class</span> Meta:
        database = database
 
<span>########################################################################</span>
<span>class</span> Album<span>(</span>peewee.<span>Model</span><span>)</span>:
    <span>""</span><span>"
    ORM model of album table
    "</span><span>""</span>
    artist = peewee.<span>ForeignKeyField</span><span>(</span>Artist<span>)</span>
    title = peewee.<span>CharField</span><span>(</span><span>)</span>
    release_date = peewee.<span>DateTimeField</span><span>(</span><span>)</span>
    publisher = peewee.<span>CharField</span><span>(</span><span>)</span>
    media_type = peewee.<span>CharField</span><span>(</span><span>)</span>
 
    <span>class</span> Meta:
        database = database
 
 
<span>if</span> __name__ == <span>"__main__"</span>:
    <span>try</span>:
        Artist.<span>create_table</span><span>(</span><span>)</span>
    <span>except</span> peewee.<span>OperationalError</span>:
        <span>print</span> <span>"Artist table already exists!"</span>
 
    <span>try</span>:
        Album.<span>create_table</span><span>(</span><span>)</span>
    <span>except</span> peewee.<span>OperationalError</span>:
        <span>print</span> <span>"Album table already exists!"</span></pre>
<p>This code is pretty straight-forward. All we’re doing here is creating two classes that define our tables. We set the fields (or columns) and we connect the database to the models via the nested class, Meta. Then we call the class directly to create the tables. This is a little strange as you normally do not call a class directly like this, but instead create an instance of the class. However, this is the recommended procedure according to peewee’s <a href="http://nbviewer.ipython.org/gist/coleifer/d3faf30bbff67ce5f70c" target="_blank">documentation</a> and it works quite well. Now we’re ready to learn how to add some data to our database.</p>
<hr/>
<h3>How to Insert / Add Data to Your Tables</h3>
<p>
</p><p>Inserting data into our database proves to be pretty easy as well. Let’s take a look:</p>
<pre class="python"><span># add_data.py</span>
 
<span>import</span> <span>datetime</span>
<span>import</span> peewee
 
<span>from</span> models <span>import</span> Album, Artist
 
new_artist = Artist.<span>create</span><span>(</span>name=<span>"Newsboys"</span><span>)</span>
album_one = Album<span>(</span>artist=new_artist,
                  title=<span>"Read All About It"</span>,
                  release_date=<span>datetime</span>.<span>date</span><span>(</span><span>1988</span>,<span>12</span>,<span>01</span><span>)</span>,
                  publisher=<span>"Refuge"</span>,
                  media_type=<span>"CD"</span><span>)</span>
album_one.<span>save</span><span>(</span><span>)</span>
 
albums = <span>[</span><span>{</span><span>"artist"</span>: new_artist,
           <span>"title"</span>: <span>"Hell is for Wimps"</span>,
           <span>"release_date"</span>: <span>datetime</span>.<span>date</span><span>(</span><span>1990</span>,<span>07</span>,<span>31</span><span>)</span>,
           <span>"publisher"</span>: <span>"Sparrow"</span>,
           <span>"media_type"</span>: <span>"CD"</span>
           <span>}</span>,
          <span>{</span><span>"artist"</span>: new_artist,
           <span>"title"</span>: <span>"Love Liberty Disco"</span>, 
           <span>"release_date"</span>: <span>datetime</span>.<span>date</span><span>(</span><span>1999</span>,<span>11</span>,<span>16</span><span>)</span>,
           <span>"publisher"</span>: <span>"Sparrow"</span>,
           <span>"media_type"</span>: <span>"CD"</span>
          <span>}</span>,
          <span>{</span><span>"artist"</span>: new_artist,
           <span>"title"</span>: <span>"Thrive"</span>,
           <span>"release_date"</span>: <span>datetime</span>.<span>date</span><span>(</span><span>2002</span>,<span>03</span>,<span>26</span><span>)</span>,
           <span>"publisher"</span>: <span>"Sparrow"</span>,
           <span>"media_type"</span>: <span>"CD"</span><span>}</span>
          <span>]</span>
 
<span>for</span> album <span>in</span> albums:
    a = Album<span>(</span><span>**</span>album<span>)</span>
    a.<span>save</span><span>(</span><span>)</span>
 
bands = <span>[</span><span>"MXPX"</span>, <span>"Kutless"</span>, <span>"Thousand Foot Krutch"</span><span>]</span>
<span>for</span> band <span>in</span> bands:
    artist = Artist.<span>create</span><span>(</span>name=band<span>)</span>
    artist.<span>save</span><span>(</span><span>)</span></pre>
<p>Here we call the class’s <strong>create</strong> method to add a band or record. The class supports an <strong>insert_many</strong> method too, but whenever I tried to save the data via the <strong>save()</strong> method, I received an <strong>OperationalError</strong> message. If you happen to figure out how to do this, drop me a line in the comments and I’ll update this article. As a workaround, I just looped over a list of dictionaries and added the records that way. </p>
<p><strong>Update</strong>: The author of peewee got back to me on <a href="http://www.reddit.com/r/Python/comments/2bblm4/an_intro_to_peewee_another_python_orm/">reddit</a> and gave me this solution for adding many records at once:</p>
<pre class="python">albums = <span>[</span><span>{</span><span>"artist"</span>: new_artist,
           <span>"title"</span>: <span>"Hell is for Wimps"</span>,
           <span>"release_date"</span>: <span>datetime</span>.<span>date</span><span>(</span><span>1990</span>,<span>07</span>,<span>31</span><span>)</span>,
           <span>"publisher"</span>: <span>"Sparrow"</span>,
           <span>"media_type"</span>: <span>"CD"</span>
           <span>}</span>,
          <span>{</span><span>"artist"</span>: new_artist,
           <span>"title"</span>: <span>"Love Liberty Disco"</span>, 
           <span>"release_date"</span>: <span>datetime</span>.<span>date</span><span>(</span><span>1999</span>,<span>11</span>,<span>16</span><span>)</span>,
           <span>"publisher"</span>: <span>"Sparrow"</span>,
           <span>"media_type"</span>: <span>"CD"</span>
          <span>}</span>,
          <span>{</span><span>"artist"</span>: new_artist,
           <span>"title"</span>: <span>"Thrive"</span>,
           <span>"release_date"</span>: <span>datetime</span>.<span>date</span><span>(</span><span>2002</span>,<span>03</span>,<span>26</span><span>)</span>,
           <span>"publisher"</span>: <span>"Sparrow"</span>,
           <span>"media_type"</span>: <span>"CD"</span><span>}</span>
          <span>]</span>
Album.<span>insert_many</span><span>(</span>albums<span>)</span>.<span>execute</span><span>(</span><span>)</span></pre>
<p>Now we’re ready to learn how to modify records in the database!</p>
<hr/>
<h3>Using Basic Queries to Modify Records with peewee</h3>
<p>
</p><p>Modifying your records is a pretty common occurance in the database world. The peewee project makes modifying your data pretty easy. Here’s some code to demonstrate how:</p>
<pre class="python"><span># edit_data.py</span>
 
<span>import</span> peewee
 
<span>from</span> models <span>import</span> Album, Artist
 
band = Artist.<span>select</span><span>(</span><span>)</span>.<span>where</span><span>(</span>Artist.<span>name</span>==<span>"Kutless"</span><span>)</span>.<span>get</span><span>(</span><span>)</span>
<span>print</span> band.<span>name</span>
 
<span># shortcut method</span>
band = Artist.<span>get</span><span>(</span>Artist.<span>name</span>==<span>"Kutless"</span><span>)</span>
<span>print</span> band.<span>name</span>
 
<span># change band name</span>
band.<span>name</span> = <span>"Beach Boys"</span>
band.<span>save</span><span>(</span><span>)</span>
 
album = Album.<span>select</span><span>(</span><span>)</span>.<span>join</span><span>(</span>Artist<span>)</span>.<span>where</span><span>(</span>
    <span>(</span>Album.<span>title</span>==<span>"Thrive"</span><span>)</span> <span>&amp;</span> <span>(</span>Artist.<span>name</span> == <span>"Newsboys"</span><span>)</span>
    <span>)</span>.<span>get</span><span>(</span><span>)</span>
album.<span>title</span> = <span>"Step Up to the Microphone"</span>
album.<span>save</span><span>(</span><span>)</span></pre>
<p>Basically we just have to query the tables to get the artist or album that we want to modify. The first two queries do the same thing, but one is shorter than the other. This is because peewee provides a shortcut method for doing queries. To actually change the record, we just set the returned object’s properties to something else. In this case, we changed the band’s name from “Kutless” to “Beach Boys”.  </p>
<p>The last query demonstrates how to create a SQL join that allows us get a match across two tables. This is great if you happen to own two CDs with the same title but you only want the query to return the album associated with the band called “Newsboys”.</p>
<p>These queries a little hard to follow, so you can break them up into smaller pieces. Here’s one example:</p>
<pre class="python">query = Album.<span>select</span><span>(</span><span>)</span>.<span>join</span><span>(</span>Artist<span>)</span>
qry_filter = <span>(</span>Album.<span>title</span>==<span>"Step Up to the Microphone"</span><span>)</span> <span>&amp;</span> <span>(</span>Artist.<span>name</span> == <span>"Newsboys"</span><span>)</span>
album = query.<span>where</span><span>(</span>qry_filter<span>)</span>.<span>get</span><span>(</span><span>)</span></pre>
<p>This is easier to follow and debug. You can use a similar trick with SQLAlchemy’s queries too.</p>
<hr/>
<h3>How to Delete Records in peewee</h3>
<p>
</p><p>Removing a record from a table in peewee takes very little code. Check it out:</p>
<pre class="python"><span># del_data.py</span>
 
<span>from</span> models <span>import</span> Artist
 
band = Artist.<span>get</span><span>(</span>Artist.<span>name</span>==<span>"MXPX"</span><span>)</span>
band.<span>delete_instance</span><span>(</span><span>)</span></pre>
<p>All we had to do was query for the record we wanted to delete. Once we had the instance, we just called its <strong>delete_instance</strong> method and that removed the record. It’s really that simple!</p>
<hr/>
<h3>Wrapping Up</h3>
<p>
</p><p>The peewee project is pretty cool. It’s biggest downside is the limited number of database backends that it supports. However, the project is simpler to use than SQLAlchemy, which I think is amazing. The peewee project’s documentation is quite good and well worth a read to understand all the other functionality that’s not covered in this tutorial. Give it a try and see what you think!</p>
<hr/>
<h3>Additional Resources</h3>
<p>
</p>
</div>	</div></body></html>