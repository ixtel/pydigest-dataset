<html><body><div><div class="postcontents">
                    <p>Orator 0.5 is now out. This version introduces database migrations and attributes accessors and mutators.</p>

<h2 id="why-the-change-of-name">Why the change of name?</h2>

<p>This ORM project was inspired by the <a href="http://laravel.com/docs/master/eloquent">Eloquent</a> ORM of the <a href="http://laravel.com">Laravel</a> PHP framework. So when I started it I took
the same name for the project. However, as I have been pointed out, it would likely lead to confusion and conflict
when searching information about it. That’s why I decided to change the name to <strong>Orator</strong>.</p>

<p>What it means is that the <code>eloquent</code> package is now <strong>deprecated</strong> and that the 0.5 version will be the last. It is therefore highly encouraged
to use the <code>orator</code> package instead.</p>

<h2 id="database-migrations">Database migrations</h2>

<p>Migrations are a type of version control for your database. They allow a team to modify the database schema and stay up to date on the current schema state. Migrations are typically paired with the Schema Builder to easily manage your database’s schema.</p>

<div class="note">
<p>For the migrations to actually work, you need a configuration file describing your databases in a <code>DATABASES</code> dict, like so:</p>
<pre>
<code class="python">DATABASES = {
    'mysql': {
        'driver': 'mysql',
        'host': 'localhost',
        'database': 'database',
        'username': 'root',
        'password': '',
        'prefix': ''
    }
}
</code>
</pre>
<p>This file needs to be specified when using migrations commands.</p>
</div>

<h3 id="creating-migrations">Creating migrations</h3>

<p>To create a migration, you can use the <code>migrations:make</code> command on the Orator CLI:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">orator migrations:make create_users_table -c databases.py</code></pre></div>

<p>This will create a migration file that looks like this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">orator.migrations</span> <span class="kn">import</span> <span class="n">Migration</span>


<span class="k">class</span> <span class="nc">CreateTableUsers</span><span class="p">(</span><span class="n">Migration</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Run the migrations.</span>
<span class="sd">        """</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Revert the migrations.</span>
<span class="sd">        """</span>
        <span class="k">pass</span></code></pre></div>

<p>By default, the migration will be placed in a <code>migrations</code> folder relative to where the command has been executed, and will contain a timestamp which allows the framework to determine the order of the migrations.</p>

<p>If you want the migrations to be stored in another folder, use the <code>--path/-p</code> option:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">orator migrations:make create_users_table -c databases.py -p my/path/to/migrations</code></pre></div>

<p>The <code>--table</code> and <code>--create</code> options can also be used to indicate the name of the table, and whether the migration will be creating a new table:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">orator migrations:make add_votes_to_users_table -c databases.py --table<span class="o">=</span>users

orator migrations:make create_users_table -c databases.py --table<span class="o">=</span>users --create</code></pre></div>

<p>These commands would respectively create the following migrations:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">orator.migrations</span> <span class="kn">import</span> <span class="n">Migration</span>


<span class="k">class</span> <span class="nc">AddVotesToUsersTable</span><span class="p">(</span><span class="n">Migration</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Run the migrations.</span>
<span class="sd">        """</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Revert the migrations.</span>
<span class="sd">        """</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">pass</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">orator.migrations</span> <span class="kn">import</span> <span class="n">Migration</span>


<span class="k">class</span> <span class="nc">CreateTableUsers</span><span class="p">(</span><span class="n">Migration</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Run the migrations.</span>
<span class="sd">        """</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">increments</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">timestamps</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Revert the migrations.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span></code></pre></div>

<h3 id="running-migrations">Running migrations</h3>

<p>To run all outstanding migrations, just use the <code>migrations:run</code> command:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">orator migrations:run -c databases.py</code></pre></div>

<h3 id="rolling-back-migrations">Rolling back migrations</h3>

<h4 id="rollback-the-last-migration-operation">Rollback the last migration operation</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">orator migrations:rollback -c databases.py</code></pre></div>

<h4 id="rollback-all-migrations">Rollback all migrations</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">eloquent migrations:reset -c databases.py</code></pre></div>

<h3 id="getting-migrations-status">Getting migrations status</h3>

<p>To see the status of the migrations, just use the migrations:status command:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">orator migrations:status -c databases.py</code></pre></div>

<p>This would output something like this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">+----------------------------------------------------+------+
<span class="p">|</span> Migration                                          <span class="p">|</span> Ran? <span class="p">|</span>
+----------------------------------------------------+------+
<span class="p">|</span> 2015_05_02_04371430559457_create_users_table       <span class="p">|</span> Yes  <span class="p">|</span>
<span class="p">|</span> 2015_05_04_02361430725012_add_votes_to_users_table <span class="p">|</span> No   <span class="p">|</span>
+----------------------------------------------------+------+</code></pre></div>

<h2 id="accessors--mutators">Accessors &amp; mutators</h2>

<p>Orator provides a convenient way to transform your model attributes when getting or setting them.</p>

<h3 id="defining-an-accessor">Defining an accessor</h3>

<p>Simply use the <code>accessor</code> decorator on your model to declare an accessor:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">orator.orm</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">accessor</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="nd">@accessor</span>
    <span class="k">def</span> <span class="nf">first_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">first_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_attribute</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">first_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">first_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></code></pre></div>

<p>In the example above, the <code>first_name</code> column has an accessor.</p>

<div class="note">
<p>The name of the decorated function <strong>must</strong> match the name of the column being accessed.</p>
</div>

<h3 id="defining-a-mutator">Defining a mutator</h3>

<p>Mutators are declared in a similar fashion:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">orator.orm</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">mutator</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="nd">@mutator</span>
    <span class="k">def</span> <span class="nf">first_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_raw_attribute</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code></pre></div>

<div class="note">
<p>If the column being mutated already has an accessor, you can use it has a mutator:</p>
<pre>
<code class="python">from orator.orm import Model, accessor


    class User(Model):

        @accessor
        def first_name(self):
            first_name = self.get_raw_attribute('first_name')

            return first_name[0].upper() + first_name[1:]

        @first_name.mutator
        def set_first_name(self, value):
            self.set_raw_attribute(value.lower())
</code>
</pre>
<p>The inverse is also possible:</p>
<pre>
<code class="python">from orator.orm import Model, mutator


    class User(Model):

        @mutator
        def first_name(self, value):
            self.set_raw_attribute(value.lower())

        @first_name.accessor
        def get_first_name(self):
            first_name = self.get_raw_attribute('first_name')

            return first_name[0].upper() + first_name[1:]
</code>
</pre>
</div>

<h3 id="appendable-attributes">Appendable attributes</h3>

<p>When converting a model to a dictionary or a JSON string, you may occasionally need to add dictionary attributes that do not have a corresponding column in your database.
To do so, simply define an <code>accessor</code> for the value:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="nd">@accessor</span>
    <span class="k">def</span> <span class="nf">is_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_attribute</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span> <span class="o">==</span> <span class="s">'yes'</span></code></pre></div>

<p>Once you have created the accessor, just add the value to the <code>__appends__</code> property on the model:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">__append__</span> <span class="o">=</span> <span class="p">[</span><span class="s">'is_admin'</span><span class="p">]</span>

    <span class="nd">@accessor</span>
    <span class="k">def</span> <span class="nf">is_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_attribute</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span> <span class="o">==</span> <span class="s">'yes'</span></code></pre></div>

<p>Once the attribute has been added to the <code>__appends__</code> list, it will be included in both the model’s dictionary and JSON forms.
Attributes in the <code>__appends__</code> list respect the <code>__visible__</code> and <code>__hidden__</code> configuration on the model.</p>

<p>There is a lot more you can do with Orator, just give a look at the <a href="http://orator.readthedocs.org">documentation</a>
to see all available features.</p>

<h2 id="whats-next">What’s next?</h2>

<p>Finally, here are some features targeted for future versions (actual roadmap to be determined):</p>



<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">def</span> <span class="nf">check_user</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="n">User</span><span class="o">.</span><span class="n">creating</span><span class="p">(</span><span class="n">check_user</span><span class="p">)</span></code></pre></div>

<ul>
  <li>Extra functionalities, like caching.</li>
</ul>

                </div>
                </div></body></html>