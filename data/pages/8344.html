<html><body><div><div id="overview">
<h2>Overview</h2>
<pre><span class="kn">from</span> <span class="nn">peppertext</span> <span class="kn">import</span> <span class="n">Hypertext</span><span class="p">,</span> <span class="n">SimpleURLField</span><span class="p">,</span> <span class="n">resolve</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">selector</span>

<span class="nd">@register</span>
<span class="k">class</span> <span class="nc">GoogleBlogPage</span><span class="p">(</span><span class="n">Hypertext</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">SimpleURLField</span><span class="p">(</span>
        <span class="s2">"https://googleblog.blogspot.kr/{year}/{month}/{title}.html"</span>
    <span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">".title[itemprop=name]"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">".post-body"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</pre>
<p>It resolves given headers, url and query string to hypertext object.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="s2">"https://googleblog.blogspot.kr/2015/11/google-gobble-thanksgiving-trends-on.html"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span>
<span class="o">&lt;</span><span class="n">GoogleBlogPage</span> <span class="n">at</span> <span class="mh">0x108a4d1f0</span> <span class="o">&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span>
<span class="s1">'Google gobble: Thanksgiving trends on Search'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="p">[</span><span class="s1">'body'</span><span class="p">]</span>
<span class="s1">'In just a few hours, people across the U.S. will be settling...'</span>
</pre>
<p>You can create GoogleBlogPage object with profile variables which are declared as
fields in <cite>GoogleBlogPage</cite> class.</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">GoogleBlogPage</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">year</span><span class="o">=</span><span class="s2">"2015"</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">month</span><span class="o">=</span><span class="s2">"11"</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">title</span><span class="o">=</span><span class="s2">"google-gobble-thanksgiving-trends-on"</span>
<span class="o">...</span> <span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span>
<span class="s1">'Google gobble: Thanksgiving trends on Search'</span>
</pre>
</div>
<div id="selectors">
<h2>Selectors</h2>
<pre><span class="k">class</span> <span class="nc">GoogleBlogPage</span><span class="p">(</span><span class="n">Hypertext</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">".title[itemprop=name]"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="c1"># ...</span>
</pre>
<p>Selectors process a document which is returned from server as response.
In the <cite>GoogleBlogPage</cite> example above, <cite>title</cite> selector parses document and
find an element specified with <cite>“.title[itemprop=name]”</cite> css selector.
You can access the value title with subscribing the <cite>GoogleBlogPage</cite> object
with selector name.</p>
<pre><span class="n">document</span> <span class="o">=</span> <span class="n">pq</span><span class="p">(</span><span class="s2">"""&lt;div&gt;
    &lt;a href="http://example.com"&gt;Link1&lt;/a&gt;
    &lt;a href="http://example.com/dahokan"&gt;Link2&lt;/a&gt;
    &lt;a href="http://example.com/manoha"&gt;Link3&lt;/a&gt;
&lt;/div&gt;"""</span><span class="p">)</span>

<span class="n">find_selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>
<span class="n">selected_els</span> <span class="o">=</span> <span class="n">find_selector</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">[</span><span class="n">pq</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s2">"href"</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">selected_els</span><span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">"http://example.com"</span><span class="p">,</span>
        <span class="s2">"http://example.com/dahokan"</span><span class="p">,</span>
        <span class="s2">"http://example.com/manoha"</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre>
<div id="find">
<h3><cite>find</cite></h3>
<p>Select html elements which match to given css selector string.</p>
</div>
<div id="attribute">
<h3><cite>attribute</cite></h3>
<p>Get an element’s attribute value with given attribute name.</p>
</div>
<div id="text">
<h3><cite>text</cite></h3>
<p>Select the html element’s inner text value.</p>
</div>

<div id="sub">
<h3><cite>sub</cite></h3>
<pre><span class="n">sub_selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">"\d+"</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
</pre>
<p>Do regex substitution.</p>
</div>
<div id="cast">
<h3><cite>cast</cite></h3>
<pre><span class="n">int_cast_selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre>
<p>Pass the data to the function given as a parameter.</p>
</div>
</div>
</div></body></html>