<html><body><div><div class="entry-content clearfix"><p><strong>Let’s look at how to bootstrap a Django Project pre-loaded with the basic requirements needed in order to quickly get a project up and running.</strong> Further, beyond the project structure, most bootstrapped projects also take care of setting up the development and production environment settings, without troubling the user much – so we’ll look at that as well.</p>









<p>We’ll be using the popular <a href="https://github.com/pydanny/cookiecutter-django">cookiecutter-django</a> as the bootstrapper for our Django Project along with <a href="https://www.docker.com/">Docker</a> to manage our application environment.</p>

<p>Let’s begin!</p>

<a name="Local.Setup"/>
<h2>Local Setup</h2>

<p>Start by installing <a href="https://github.com/audreyr/cookiecutter">cookiecutter</a> globally:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>pip install <span class="nv">cookiecutter</span><span class="o">==</span>1.3.0
</span></code></pre></td></tr></table></div></figure>


<p>Now execute the following command to generate a bootstrapped django project:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>cookiecutter https://github.com/pydanny/cookiecutter-django.git
</span></code></pre></td></tr></table></div></figure>


<p>This command runs cookiecutter with the <a href="https://github.com/pydanny/cookiecutter-django">cookiecutter-django</a> repo, allowing us to enter project-specific details:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">Cloning into <span class="s1">'cookiecutter-django'</span>...
</span><span class="line">remote: Counting objects: 4810, <span class="k">done</span>.
</span><span class="line">remote: Compressing objects: 100% <span class="o">(</span>7/7<span class="o">)</span>, <span class="k">done</span>.
</span><span class="line">remote: Total 4810 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 4803
</span><span class="line">Receiving objects: 100% <span class="o">(</span>4810/4810<span class="o">)</span>, 844.79 KiB <span class="p">|</span> 582.00 KiB/s, <span class="k">done</span>.
</span><span class="line">Resolving deltas: 100% <span class="o">(</span>3039/3039<span class="o">)</span>, <span class="k">done</span>.
</span><span class="line">Checking connectivity... <span class="k">done</span>.
</span><span class="line">project_name <span class="o">[</span>project_name<span class="o">]</span>: django_cookiecutter_docker
</span><span class="line">repo_name <span class="o">[</span>django_cookiecutter_docker<span class="o">]</span>: django_cookiecutter_docker
</span><span class="line">author_name <span class="o">[</span>Your Name<span class="o">]</span>: Michael Herman
</span><span class="line">email <span class="o">[</span>Your email<span class="o">]</span>: michael@realpython.com
</span><span class="line">description <span class="o">[</span>A short description of the project.<span class="o">]</span>: Tutorial on bootstrapping django projects
</span><span class="line">domain_name <span class="o">[</span>example.com<span class="o">]</span>: example.com
</span><span class="line">version <span class="o">[</span>0.1.0<span class="o">]</span>: 0.1.0
</span><span class="line">timezone <span class="o">[</span>UTC<span class="o">]</span>: UTC
</span><span class="line">now <span class="o">[</span>2015/11/04<span class="o">]</span>: 2015/11/04
</span><span class="line">year <span class="o">[</span>2015<span class="o">]</span>: 2015
</span><span class="line">use_whitenoise <span class="o">[</span>y<span class="o">]</span>: y
</span><span class="line">use_celery <span class="o">[</span>n<span class="o">]</span>: n
</span><span class="line">use_mailhog <span class="o">[</span>n<span class="o">]</span>: n
</span><span class="line">use_sentry <span class="o">[</span>n<span class="o">]</span>: n
</span><span class="line">use_newrelic <span class="o">[</span>n<span class="o">]</span>: n
</span><span class="line">use_opbeat <span class="o">[</span>n<span class="o">]</span>: n
</span><span class="line">windows <span class="o">[</span>n<span class="o">]</span>: n
</span><span class="line">use_python2 <span class="o">[</span>n<span class="o">]</span>: n
</span></code></pre></td></tr></table></div></figure>


<a name="Project.Structure"/>
<h3>Project Structure</h3>

<p>Take a quick look at the generated project structure, taking specific note of the following directories:</p>

<ol>
<li>“config” includes all the settings for our local and production environments.</li>
<li>“requirements” contains all the requirement files – <em>base.txt</em>, <em>local.txt</em>, <em>production.txt</em>, <em>test.txt</em> – which you can make changes to and then install via <code>pip install -r file_name</code>.</li>
<li>“django_cookiecutter_docker” is the main project directory which consists of the “static”, “contrib” and “templates” directories along with the <code>users</code> app containing the models and boilerplate code associated with user authentication.</li>
</ol>


<a name="Docker.Setup"/>
<h2>Docker Setup</h2>

<p>Start by downloading and then installing the <a href="https://www.docker.com/docker-toolbox">Docker Toolbox</a> (v<a href="https://github.com/docker/toolbox/releases/tag/v1.9.1f">1.9.1f</a>) to obtain virtualbox and the required Docker components:</p>

<ul>
<li>docker 1.9.1</li>
<li>docker-machine 0.5.4</li>
<li>docker-compose 1.5.2</li>
</ul>


<a name="Docker.Machine"/>
<h3>Docker Machine</h3>

<p>Once installed, create a new Docker host within the root of the newly created Django Project:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine create -d virtualbox dev
</span><span class="line"><span class="nv">$ </span><span class="nb">eval</span> <span class="s2">"$(docker-machine env dev)"</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><strong>NOTE</strong>: <code>dev</code> can be named anything you want. For example, if you have more than one development environment, you could name them <code>djangodev1</code>, <code>djangodev2</code>, and so forth.</p></blockquote>

<p>To view all Machines, run:</p>

<figure class="code"><figcaption><span/></figcaption></figure>


<p>You can also view the IP of the <code>dev</code> Machine by running:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine ip dev
</span></code></pre></td></tr></table></div></figure>


<p>Finally, let’s create a “/data” partition within the VM itself so that changes are persistent:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine ssh dev
</span><span class="line"><span class="nv">$ </span>sudo su
</span><span class="line"><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'ln -sfn /mnt/sda1/data /data'</span> &gt;&gt; /var/lib/boot2docker/bootlocal.sh
</span></code></pre></td></tr></table></div></figure>


<a name="Docker.Compose"/>
<h3>Docker Compose</h3>

<p>Now we can fire everything up – e.g., Django and Postgres – via Docker Compose:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose -f dev.yml build
</span><span class="line"><span class="nv">$ </span>docker-compose -f dev.yml up -d
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Running Windows? Hit this error – <code>Interactive mode is not yet supported on Windows</code>? See <a href="https://realpython.com/blog/python/development-and-deployment-of-cookiecutter-django-via-docker/#comment-2442262433">this comment</a>.</p></blockquote>

<p>The first build will take a while. Due to <a href="https://docs.docker.com/engine/articles/dockerfile_best-practices/#build-cache">caching</a>, subsequent builds will run much faster.</p>

<a name="Sanity.Check"/>
<h2>Sanity Check</h2>

<p>Now we can test our Django Project by applying the migrations and then running the server:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose -f dev.yml run django python manage.py makemigrations
</span><span class="line"><span class="nv">$ </span>docker-compose -f dev.yml run django python manage.py migrate
</span><span class="line"><span class="nv">$ </span>docker-compose -f dev.yml run django python manage.py createsuperuser
</span></code></pre></td></tr></table></div></figure>


<p>Navigate to the <code>dev</code> IP (port 8000) in your browser to view the Project quick start page with debugging mode on and many more development environment oriented features installed and running.</p>

<p>Kill the server, initialize a new git repo, commit, and PUSH to GitHub.</p>

<a name="Deployment.Setup"/>
<h2>Deployment Setup</h2>

<p>So, we have successfully set up our Django Project locally using cookiecutter-django and served it up using the traditional <em>manage.py</em> command line utility via Docker.</p>

<p>In this section, we move on to the deployment part, where the role of a web server comes into play. We will be setting up a Docker Machine on a <a href="https://www.digitalocean.com/?refcode=d8f211a4b4c2">Digital Ocean</a> droplet, with Postgres as our database and <a href="http://nginx.org/">Nginx</a> as our web server.</p>

<p>Along with this, we will be making use of <a href="http://gunicorn.org/">gunicorn</a> instead of Django’s single-threaded development server to run the server process.</p>

<a name="Why.Nginx."/>
<h3>Why Nginx?</h3>

<p>Apart from being a high-performance HTTP server, which almost every good web server out in the market is, Nginx has some really good features that make it stand out from the rest – namely that it:</p>

<ul>
<li>Can couple as a <a href="https://en.wikipedia.org/wiki/Reverse_proxy">reverse proxy server</a>,</li>
<li>Can host more than one site,</li>
<li>Has an asynchronous way of handling web requests, which means that since it doesn’t rely on threads to handle web requests, it has a higher performance while handling multiple requests.</li>
</ul>


<a name="Why.Gunicorn."/>
<h3>Why Gunicorn?</h3>

<p><a href="http://gunicorn.org/">Gunicorn</a> is a Python WSGI HTTP server that can be easily customized and provides better performance in terms of reliability than Django’s single-threaded development server within production environments.</p>

<a name="Digital.Ocean.Setup"/>
<h3>Digital Ocean Setup</h3>

<p>We will be using a <a href="https://www.digitalocean.com/?refcode=d8f211a4b4c2">Digital Ocean</a> server for this tutorial. After you <a href="https://www.digitalocean.com/?refcode=d8f211a4b4c2">sign up</a> (if necessary), <a href="https://www.digitalocean.com/community/tutorials/how-to-use-the-digitalocean-api-v2">generate</a> a Personal Access Token, and then run the following command:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-machine create <span class="se">\</span>
</span><span class="line">-d digitalocean <span class="se">\</span>
</span><span class="line">--digitalocean-access-token<span class="o">=</span>ADD_YOUR_TOKEN_HERE <span class="se">\</span>
</span><span class="line">prod
</span></code></pre></td></tr></table></div></figure>


<p>This should only take few minutes to provision the Digital Ocean droplet and set up a new Docker Machine called <code>prod</code>. While you wait, navigate to the <a href="https://cloud.digitalocean.com">Digital Ocean Control Panel</a>; you should see a new droplet being created, again, called <code>prod</code>.</p>

<p>Once done, there should now be two machines running, one locally (<code>dev</code>) and one on Digital Ocean (<code>prod</code>). Run <code>docker-machine ls</code> to confirm:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">NAME   ACTIVE   DRIVER         STATE     URL                         SWARM   DOCKER   ERRORS
</span><span class="line">dev    *        virtualbox     Running   tcp://192.168.99.100:2376           v1.9.1
</span><span class="line">prod   -        digitalocean   Running   tcp://159.203.77.132:2376           v1.9.1
</span></code></pre></td></tr></table></div></figure>


<p>Set <code>prod</code> as the active machine and then load the Docker environment into the shell:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span><span class="nb">eval</span> <span class="s2">"$(docker-machine env prod)"</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Docker.Compose..take.2."/>
<h3>Docker Compose (take 2)</h3>

<p>Start by renaming <em>env.example</em> to <em>.env</em>. Update the <code>DJANGO_ALLOWED_HOSTS</code> variable to match the Digital Ocean IP address – i.e., <code>DJANGO_ALLOWED_HOSTS=159.203.77.132</code>. Keep the remaining defaults for now.</p>

<p>Now we can create the build and then fire up the services in the cloud:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose build
</span><span class="line"><span class="nv">$ </span>docker-compose up -d
</span></code></pre></td></tr></table></div></figure>


<a name="Sanity.Check..take.2."/>
<h3>Sanity Check (take 2)</h3>

<p>Apply all the migrations:</p>

<figure class="code"><figcaption><span/></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="nv">$ </span>docker-compose run django python manage.py makemigrations
</span><span class="line"><span class="nv">$ </span>docker-compose run django python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>That’s it!</p>

<p>Now just visit your server’s IP address, associated with the Digital Ocean droplet, and view it in the browser.</p>

<p>You should be good to go.</p>

<hr/>


<p>For further reference just grab the code from the <a href="https://github.com/realpython/django_cookiecutter_deploy">repository</a>. Thanks a lot for reading! Looking forward to your questions.</p>
</div>


      </div></body></html>