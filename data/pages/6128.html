<html><body><div><div class="section" id="powerpoint-file-basics">
<h2>PowerPoint File Basics</h2>
<p>Python-pptx can create blank PowerPoint files but most people are going to
prefer working with a predefined template that you can customize with your own content.
Python-pptx’s <span class="caps">API</span> supports this process quite simply as long as you know a few
things about your template.</p>
<p>Before diving into some code samples, there are two key components you need to
understand: <strong>Slide Layouts</strong> and <strong>Placeholders</strong>. In the images below you can see
an example of two different layouts as well as the template’s placeholders where
you can populate your content.</p>
<p>In the image below, you can see that we are using Layout 0 and there is one placeholder
on the slide at index 1.</p>

<p>In this image, we use Layout 1 for a completely different look.</p>

<p>In order to make your life easier with your own templates, I created a simple
standalone script that takes a template and marks it up with the various elements.</p>
<p>I won’t explain all the code line by line but you can see <a class="reference external" href="https://github.com/chris1610/pbpython/blob/master/code/analyze_ppt.py">analyze_ppt.py</a> on
github. Here is the function that does the bulk of the work:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">analyze_ppt</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="sd">""" Take the input file and analyze the structure.</span>
<span class="sd">    The output file contains marked up information to make it easier</span>
<span class="sd">    for generating future powerpoint templates.</span>
<span class="sd">    """</span>
    <span class="n">prs</span> <span class="o">=</span> <span class="n">Presentation</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="c"># Each powerpoint file has multiple layouts</span>
    <span class="c"># Loop through them all and  see where the various elements are</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prs</span><span class="o">.</span><span class="n">slide_layouts</span><span class="p">):</span>
        <span class="n">slide</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slides</span><span class="o">.</span><span class="n">add_slide</span><span class="p">(</span><span class="n">prs</span><span class="o">.</span><span class="n">slide_layouts</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="c"># Not every slide has to have a title</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">title</span>
            <span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">'Title for Layout {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"No Title for Layout {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="c"># Go through all the placeholders and identify them by index and type</span>
        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">slide</span><span class="o">.</span><span class="n">placeholders</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">is_placeholder</span><span class="p">:</span>
                <span class="n">phf</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">placeholder_format</span>
                <span class="c"># Do not overwrite the title which is just a special placeholder</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">'Title'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                        <span class="n">shape</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">'Placeholder index:{} type:{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phf</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"{} has no text attribute"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phf</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'{} {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phf</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<p>The basic flow of this function is to loop through and create an example of
every layout included in the source PowerPoint file. Then on each slide, it will
populate the title (if it exists). Finally, it will iterate through all of the
placeholders included in the template and show the index of the placeholder as
well as the type.</p>
<p>If you want to try it yourself:</p>
<div class="highlight"><pre>python analyze_ppt.py simple-template.ppt simple-template-markup.ppt
</pre></div>
<p>Refer to the <a class="reference external" href="https://github.com/chris1610/pbpython/blob/master/output/simple-template.pptx">input</a> and <a class="reference external" href="https://github.com/chris1610/pbpython/blob/master/output/simple-template-markup.pptx">output</a> files to see what you get.</p>
</div>
<div class="section" id="creating-your-own-powerpoint">
<h2>Creating your own PowerPoint</h2>
<p>For the dataset and analysis, I will be replicating the analysis in
<a class="reference external" href="http://pbpython.com/pandas-pivot-report.html">Generating Excel Reports from a Pandas Pivot Table</a>. The article explains
the pandas data manipulation in more detail so it will be helpful to make sure
you are comfortable with it before going too much deeper into the code.</p>
<p>Let’s get things started with the inputs and basic shell of the program:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">pptx</span> <span class="kn">import</span> <span class="n">Presentation</span>
<span class="kn">from</span> <span class="nn">pptx.util</span> <span class="kn">import</span> <span class="n">Inches</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>

<span class="c"># Functions go here</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">report_data</span> <span class="o">=</span> <span class="n">create_pivot</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">create_chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">"report-image.png"</span><span class="p">)</span>
    <span class="n">create_ppt</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">infile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">outfile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">report_data</span><span class="p">,</span> <span class="s">"report-image.png"</span><span class="p">)</span>
</pre></div>
<p>After we create our command line args, we read the source Excel file into a
pandas DataFrame. Next, we use that DataFrame as an input to create the
Pivot_table summary of the data:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">create_pivot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">index_list</span><span class="o">=</span><span class="p">[</span><span class="s">"Manager"</span><span class="p">,</span> <span class="s">"Rep"</span><span class="p">,</span> <span class="s">"Product"</span><span class="p">],</span>
                 <span class="n">value_list</span><span class="o">=</span><span class="p">[</span><span class="s">"Price"</span><span class="p">,</span> <span class="s">"Quantity"</span><span class="p">]):</span>
    <span class="sd">"""</span>
<span class="sd">    Take a DataFrame and create a pivot table</span>
<span class="sd">    Return it as a DataFrame pivot table</span>
<span class="sd">    """</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_list</span><span class="p">,</span>
                           <span class="n">values</span><span class="o">=</span><span class="n">value_list</span><span class="p">,</span>
                           <span class="n">aggfunc</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">table</span>
</pre></div>
<p>Consult the <a class="reference external" href="http://pbpython.com/pandas-pivot-report.html">Generating Excel Reports from a Pandas Pivot Table</a> if this does
not make sense to you.</p>
<p>The next piece of the analysis is creating a simple bar chart of sales performance
by account:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">create_chart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">""" Create a simple bar chart saved to the filename based on the dataframe</span>
<span class="sd">    passed to the function</span>
<span class="sd">    """</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'total'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'Quantity'</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s">'Price'</span><span class="p">]</span>
    <span class="n">final_plot</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Name'</span><span class="p">)[</span><span class="s">'total'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">order</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'barh'</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">final_plot</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="c"># Size is the same as the PowerPoint placeholder</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">'tight'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
<p>Here is a scaled down version of the image:</p>

<p>We have a chart and a pivot table completed. Now we are going to embed that information
into a new PowerPoint file based on a given PowerPoint template file.</p>
<p>Before I go any farther, there are a couple of things to note. You need to know what
layout you would like to use as well as where you want to populate your content.
In looking at the output of <code class="code">
analyze_ppt.py</code>
 we know that the title slide
is layout 0 and that it has a title attribute and a subtitle at placeholder 1.</p>
<p>Here is the start of the function that we use to create our output PowerPoint:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">create_ppt</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">report_data</span><span class="p">,</span> <span class="n">chart</span><span class="p">):</span>
    <span class="sd">""" Take the input powerpoint file and use it as the template for the output</span>
<span class="sd">    file.</span>
<span class="sd">    """</span>
    <span class="n">prs</span> <span class="o">=</span> <span class="n">Presentation</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="c"># Use the output from analyze_ppt to understand which layouts and placeholders</span>
    <span class="c"># to use</span>
    <span class="c"># Create a title slide first</span>
    <span class="n">title_slide_layout</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slide_layouts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">slide</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slides</span><span class="o">.</span><span class="n">add_slide</span><span class="p">(</span><span class="n">title_slide_layout</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">title</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">placeholders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Quarterly Report"</span>
    <span class="n">subtitle</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Generated on {:%m-</span><span class="si">%d</span><span class="s">-%Y}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
</pre></div>
<p>This code creates a new presentation based on our input file, adds a
single slide and populates the title and subtitle on the slide. It looks like this:</p>

<p>Pretty cool huh?</p>
<p>The next step is to embed our picture into a slide.</p>
<p>From our previous analysis, we know that the graph slide we want to use is
layout index 8, so we create a new slide, add a title then add a picture into
placeholder 1. The final step adds a subtitle at placeholder 2.</p>
<div class="highlight"><pre><span class="c"># Create the summary graph</span>
<span class="n">graph_slide_layout</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slide_layouts</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="n">slide</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slides</span><span class="o">.</span><span class="n">add_slide</span><span class="p">(</span><span class="n">graph_slide_layout</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">title</span>
<span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Sales by account"</span>
<span class="n">placeholder</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">placeholders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pic</span> <span class="o">=</span> <span class="n">placeholder</span><span class="o">.</span><span class="n">insert_picture</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span>
<span class="n">subtitle</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">placeholders</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">subtitle</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Results consistent with last quarter"</span>
</pre></div>
<p>Here is our masterpiece:</p>

<p>For the final portion of the presentation, we will create a table for each
manager with their sales performance.</p>
<p>Here is an image of what we’re going to achieve:</p>

<p>Creating tables in PowerPoint is a good news / bad news story. The good news
is that there is an <span class="caps">API</span> to create one. The bad news is that you can’t easily
convert a pandas DataFrame to a table using the built in <span class="caps">API</span>. However, we
are very fortunate that someone has already done all the hard work for us
and created <a class="reference external" href="https://github.com/robintw/PandasToPowerpoint">PandasToPowerPoint</a>.</p>
<p>This excellent piece of code takes a DataFrame and converts it to a PowerPoint
compatible table. I have taken the liberty of including a portion of it in
my script. The original has more functionality that I am not using so I
encourage you to check out the repo and use it in your own code.</p>
<div class="highlight"><pre><span class="c"># Create a slide for each manager</span>
<span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">report_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">slide</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slides</span><span class="o">.</span><span class="n">add_slide</span><span class="p">(</span><span class="n">prs</span><span class="o">.</span><span class="n">slide_layouts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">title</span>
    <span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Report for {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">manager</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">Inches</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">Inches</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">Inches</span><span class="p">(</span><span class="mf">9.25</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">Inches</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="c"># Flatten the pivot table by resetting the index</span>
    <span class="c"># Create a table on the slide</span>
    <span class="n">df_to_table</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="n">report_data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
                <span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="n">prs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<p>The code takes each manager out of the pivot table and builds a simple DataFrame
that contains the summary data. Then uses the <code class="code">
df_to_table</code>
 to convert
the DataFrame into a PowerPoint compatible table.</p>
<p>If you want to run this on your own, the full code would look something like this:</p>
<div class="highlight"><pre>python create_ppt.py simple-template.pptx sales-funnel.xlsx myreport.pptx
</pre></div>
<p>All of the relevant files are available in the <a class="reference external" href="https://github.com/chris1610/pbpython">github repository</a>.</p>
</div>
</div></body></html>