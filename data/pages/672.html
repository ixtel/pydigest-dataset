<html><body><div><div class="entry-content" itemprop="mainContentOfPage">
<h2>With thousands of icons being uploaded to <a href="https://www.iconfinder.com">Iconfinder.com</a> every month, the risk of pirated content also increases. To keep out the swindlers we have been working on a new clever image duplication technique.</h2>
<p><span id="more-4462"/></p>
<p>One of the features that came out of our <a href="/iconfinder-hackathon-day-1/">little hackaton</a> and will be rolling out in the next couple of weeks is the ability to detect duplicate icons upon submission. So, for example if a user downloads an existing icon and tries to re-upload it in order to sell it and make a profit (yes, we had some of those cases) we will be able to detect it as a duplicate of an already existing icon and mark the account as fraudulent.</p>
<p>A frequently used solution to identify if a given file already exists in a large collection of files is to calculate a hash for each individual file in the dataset, store the hashes in a database and then when we want to locate a particular file calculate the hash for that file and look up to see if it’s hash value exists in the database.</p>
<h2>Picking a hashing algorithm</h2>
<p>A commonly used type of hash algorithms for this are the cryptographic hashing algorithms. Implementations of the most common used ones like MD5, SHA-1, SHA-256 are available in the standard library of almost any programming language and they are really easy to use and work really well for the most simple use cases.</p>
<p>For instance, in Python you would simply import the <tt class="docutils literal">hashlib</tt> module and call a function to generate the hash value for a particular string or file.</p>
<div id="crayon-56d5a0c5dfdb8178749670" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfdb8178749670-1"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">hashlib</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdb8178749670-2"> </p><p class="crayon-line" id="crayon-56d5a0c5dfdb8178749670-3"><span class="crayon-h">    </span><span class="crayon-c"># Calculating the hash value of a string.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdb8178749670-4"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">hashlib</span><span class="crayon-sy">.</span><span class="crayon-k ">md5</span><span class="crayon-sy">(</span><span class="crayon-s">'The quick brown fox jumps over the lazy dog'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">hexdigest</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdb8178749670-5"><span class="crayon-h">    </span><span class="crayon-s">'9e107d9d372bb6826bd81d3542a419d6'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdb8178749670-6"> </p><p class="crayon-line" id="crayon-56d5a0c5dfdb8178749670-7"><span class="crayon-h">    </span><span class="crayon-c"># Loading an image file into memory and calculating it's hash value.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdb8178749670-8"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">image_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">'data/cat_grumpy_orig.png'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdb8178749670-9"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">hashlib</span><span class="crayon-sy">.</span><span class="crayon-k ">md5</span><span class="crayon-sy">(</span><span class="crayon-i">image_file</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">hexdigest</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdb8178749670-10"><span class="crayon-h">    </span><span class="crayon-s">'3e1f6e9f2689d59b9ed28bcdab73455f'</span></p></div></td>
</tr>
</table>
</div>
</div>

<p>This would work fine and dandy if we were sure the files uploaded aren’t tampered with but due to the nature of how cryptographic hashing algorithms work even the slightest change to the input will result in an <a href="http://en.wikipedia.org/wiki/Avalanche_effect">avalanche effect</a> so the generated hash of the new file will be totally different from the one of the original file.</p>
<p>Let’s take an example where we add a period at the end of the sentence.</p>
<div id="crayon-56d5a0c5dfdc6770848884" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfdc6770848884-1"><span class="crayon-h">    </span><span class="crayon-c"># Original text.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdc6770848884-2"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">hashlib</span><span class="crayon-sy">.</span><span class="crayon-k ">md5</span><span class="crayon-sy">(</span><span class="crayon-s">'The quick brown fox jumps over the lazy dog'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">hexdigest</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdc6770848884-3"><span class="crayon-h">    </span><span class="crayon-s">'9e107d9d372bb6826bd81d3542a419d6'</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdc6770848884-4"> </p><p class="crayon-line" id="crayon-56d5a0c5dfdc6770848884-5"><span class="crayon-h">    </span><span class="crayon-c"># Slight modification of the text.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdc6770848884-6"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">hashlib</span><span class="crayon-sy">.</span><span class="crayon-k ">md5</span><span class="crayon-sy">(</span><span class="crayon-s">'The quick brown fox jumps over the lazy dog.'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">hexdigest</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdc6770848884-7"><span class="crayon-h">    </span><span class="crayon-s">'e4d909c290d0fb1ca068ffaddf22cbd0'</span></p></div></td>
</tr>
</table>
</div>
</div>

<p>As you can see in the example above, the values <tt class="docutils literal">9e107d9d372bb6826bd81d3542a419d6</tt> and <tt class="docutils literal">e4d909c290d0fb1ca068ffaddf22cbd0</tt> are almost completely different (except for few characters).</p>
<p>In the case of images if the background color is changed, the image is cropped or rotated or if just one pixel is modified out of the original image, we won’t be able to match the hash of the image to an already existing one. This is not really practical since we want to detect similar images, even if they have been modified a little.</p>
<p>For example when we modify the color of the nose on the cat the computed hash value will be mostly different.</p>
<div id="attachment_4515" class="wp-caption alignleft"><a href="/wp-content/uploads/2014/04/cat_grumpy_orig.png"><img class="size-full wp-image-4515" alt="Original image" src="/wp-content/uploads/2014/04/cat_grumpy_orig.png.pagespeed.ce.DKikVpT0GC.png"/></a><p class="wp-caption-text">Original image</p></div>
<p/><div id="attachment_4512" class="wp-caption alignleft"><a href="/wp-content/uploads/2014/04/cat_grumpy_modif.png"><img class="size-full wp-image-4512" alt="Modified image" src="/wp-content/uploads/2014/04/cat_grumpy_modif.png.pagespeed.ce.Ql__tmYIOK.png"/></a><p class="wp-caption-text">Modified image</p></div>

<div id="crayon-56d5a0c5dfdce486219102" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfdce486219102-1"><span class="crayon-h">    </span><span class="crayon-c"># Load the original image into memory and calculate it's hash value.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdce486219102-2"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">image_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">'data/cat_grumpy_orig.png'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdce486219102-3"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">hashlib</span><span class="crayon-sy">.</span><span class="crayon-k ">md5</span><span class="crayon-sy">(</span><span class="crayon-i">image_file</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">hexdigest</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdce486219102-4"><span class="crayon-h">    </span><span class="crayon-s">'3e1f6e9f2689d59b9ed28bcdab73455f'</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdce486219102-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdce486219102-6"><span class="crayon-h">    </span><span class="crayon-c"># Load the modified image into memory and calculate it's hash value.</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdce486219102-7"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">image_file_modified</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">'data/cat_grumpy_modif.png'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdce486219102-8"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">hashlib</span><span class="crayon-sy">.</span><span class="crayon-k ">md5</span><span class="crayon-sy">(</span><span class="crayon-i">image_file_modified</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">hexdigest</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdce486219102-9"><span class="crayon-h">    </span><span class="crayon-s">'12d1b9409c3e8e0361c24beaee9c0ab1'</span></p></div></td>
</tr>
</table>
</div>
</div>

<p>
What we needed for our use case is a </p><em>perceptual</em><p> hashing algorithm. A perceptual hashing algorithm that takes a fingerprint of a multimedia file by deriving it from various features from its content so it can take into account transformations on a given input and yet be flexible enough to distinguish between dissimilar files.
</p><p>There are a number of perceptual hashing algorithms but the one that I’m gonna present is the <a href="http://www.hackerfactor.com/blog/index.php?/archives/529-Kind-of-Like-That.html">dHash</a> (difference hashing) algorithm which computes the difference in brightness between adjacent pixels, identifying the relative gradient direction.</p>
<h2>dHash</h2>
<p>Before we dive into the algorithm, let’s start with some basics. A color image is comprised out of red, green and blue (RGB) pixels and we can think of it as a list of sets of red, green and blue values. For example, let’s take an image, load it using Python’s imaging library (<a href="http://www.pythonware.com/products/pil/">PIL</a>) and print the pixel values.</p>
<p/><div id="attachment_4518" class="wp-caption aligncenter"><a href="/wp-content/uploads/2014/04/test_image.jpg"><img class="size-medium wp-image-4518" alt="Test image" src="/wp-content/uploads/2014/04/test_image-300x300.jpg.pagespeed.ce.JxHQjSEXKB.jpg"/></a><p class="wp-caption-text">Test image</p></div>

<div id="crayon-56d5a0c5dfdd6942993469" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">
<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-2">2</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-4">4</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-6">6</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-8">8</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-10">10</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-12">12</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-14">14</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-16">16</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-18">18</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdd6942993469-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdd6942993469-20">20</p></div>
</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-1"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">PIL </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">Image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-2"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">test_image</span><span class="crayon-h">  </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">'data/test_image.jpg'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-4"><span class="crayon-h">    </span><span class="crayon-c"># The image is an RGB image with a size of 8x8 pixels.</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-5"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-s">'Image Mode: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">test_image</span><span class="crayon-sy">.</span><span class="crayon-e">mode</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-6"><span class="crayon-e">    </span><span class="crayon-e">Image </span><span class="crayon-i">Mode</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">RGB</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-7"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-s">'Width: %s px, Height: %s px'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">test_image</span><span class="crayon-sy">.</span><span class="crayon-v">size</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_image</span><span class="crayon-sy">.</span><span class="crayon-v">size</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-8"><span class="crayon-h">    </span><span class="crayon-i">Width</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-i">px</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Height</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-i">px</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-10"><span class="crayon-h">    </span><span class="crayon-c"># Get the pixel values from the image and print them into rows based on</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-11"><span class="crayon-h">    </span><span class="crayon-c"># the image's width.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-12"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-i">width</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_image</span><span class="crayon-sy">.</span><span class="crayon-i">size</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-13"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">pixels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">list</span><span class="crayon-sy">(</span><span class="crayon-v">test_image</span><span class="crayon-sy">.</span><span class="crayon-e">getdata</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-14"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-i">width</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-15"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">   </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-v">pixels</span><span class="crayon-sy">[</span><span class="crayon-i">col</span><span class="crayon-o">:</span><span class="crayon-i">col</span><span class="crayon-o">+</span><span class="crayon-i">width</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-16"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-17"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-18"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">212</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">45</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">45</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">51</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">92</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">154</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">130</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">183</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">47</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdd6942993469-19"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-cn">206</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">210</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">198</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">131</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">78</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">131</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">156</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">180</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">117</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">155</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">201</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdd6942993469-20"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-cn">104</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">133</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">170</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">215</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">130</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">153</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">155</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">155</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">104</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">142</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">191</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></p></div></td>
</tr>
</table>
</div>
</div>

<p>
The first three pixels have an intensity value of 255 for red, green and blue respectively and 0 for other values, white has all three values at their maximum intensity (255) and black has all three values at their lowest intensity (0). The rest of the color pixels are a combination of red, green and blue at different intensities.
</p><p>Now let’s get back on track, the dHash algorithm has four steps, I’m gonna go through each one and illustrate it’s effects on the original and modified image.</p>
<h3>1. Grayscale the image.</h3>
<p>By grayscaling the image we reduce each pixel value to a luminous intensity value. For example, a white pixel (255, 255, 255) will be reduced to an intensity value of 255 and a black pixel (0, 0, 0) will be reduced to an intensity value of 0.</p>
<div id="attachment_4516" class="wp-caption alignleft"><a href="/wp-content/uploads/2014/04/cat_grumpy_orig_step_1.png"><img class="size-full wp-image-4516" alt="Original image (after step 1)" src="/wp-content/uploads/2014/04/cat_grumpy_orig_step_1.png.pagespeed.ce.dpnTokpaoA.png"/></a><p class="wp-caption-text">Original image (after step 1)</p></div>
<div id="attachment_4513" class="wp-caption alignleft"><a href="/wp-content/uploads/2014/04/cat_grumpy_modif_step_1.png"><img class="size-full wp-image-4513" alt="Modified image (after step 1)" src="/wp-content/uploads/2014/04/cat_grumpy_modif_step_1.png.pagespeed.ce.EG7HjzMSQE.png"/></a><p class="wp-caption-text">Modified image (after step 1)</p></div>
<h3>2. Shrink the image to a common size.</h3>
<p>By shrinking the image to a common base size, for example 9×8 pixels, where the width is 1px larger than the height (you’ll understand why the odd size in step 3). This way we remove all the high frequencies and details of the image and we are left with a sample size of 72 intensity values. This also means that resizing or stretching an image won’t affect it’s hash value, all images are normalized to a common size.</p>
<div id="attachment_4517" class="wp-caption alignleft"><a href="/wp-content/uploads/2014/04/cat_grumpy_orig_step_2.png"><img class="size-full wp-image-4517" alt="Original image (after step 2)" src="/wp-content/uploads/2014/04/cat_grumpy_orig_step_2.png.pagespeed.ce.vGzzQd-mk9.png"/></a><p class="wp-caption-text">Original image (after step 2)</p></div>
<div id="attachment_4514" class="wp-caption alignleft"><a href="/wp-content/uploads/2014/04/cat_grumpy_modif_step_2.png"><img class="size-full wp-image-4514" alt="Modified image (after step 2)" src="/wp-content/uploads/2014/04/cat_grumpy_modif_step_2.png.pagespeed.ce.g76QzyGiSC.png"/></a><p class="wp-caption-text">Modified image (after step 2)</p></div>
<h3>3. Compare adjacent pixels.</h3>
<p>After the previous two steps we are left with a list containing intensity values, we then compare each intensity value to it’s adjacent value for each row resulting in an array of binary values.</p>
<div id="crayon-56d5a0c5dfde1373506194" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-1"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">PIL </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">Image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde1373506194-2"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">img</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">'data/cat_grumpy_orig_after_step_2.png'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-3"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-i">width</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">img</span><span class="crayon-sy">.</span><span class="crayon-i">size</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde1373506194-4"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">pixels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">list</span><span class="crayon-sy">(</span><span class="crayon-v">img</span><span class="crayon-sy">.</span><span class="crayon-e">getdata</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-5"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-i">width</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde1373506194-6"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">   </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-v">pixels</span><span class="crayon-sy">[</span><span class="crayon-i">col</span><span class="crayon-o">:</span><span class="crayon-i">col</span><span class="crayon-o">+</span><span class="crayon-i">width</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-7"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde1373506194-8"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">253</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">248</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-9"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">253</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">248</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde1373506194-10"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">253</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">248</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">222</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-11"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">248</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">222</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde1373506194-12"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">222</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">177</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-13"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">222</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">177</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde1373506194-14"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">254</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">222</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">177</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">225</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde1373506194-15"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">222</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">177</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">184</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">225</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">]</span></p></div></td>
</tr>
</table>
</div>
</div>

<p>The first value (254) will be compared to the second value (254), the second value to the third and so on, giving us 8 boolean values per row.</p>
<div id="crayon-56d5a0c5dfde9248498084" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">
<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-2">2</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-4">4</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-6">6</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-8">8</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-10">10</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-12">12</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-14">14</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfde9248498084-16">16</p><p class="crayon-num" data-line="crayon-56d5a0c5dfde9248498084-17">17</p></div>
</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-1"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">difference</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-2"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-i">height</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-3"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">   </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-i">width</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-4"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">     </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">col</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-i">width</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-5"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">       </span><span class="crayon-v">difference</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">pixels</span><span class="crayon-sy">[</span><span class="crayon-i">col</span><span class="crayon-o">+</span><span class="crayon-i">row</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">pixels</span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-i">col</span><span class="crayon-o">+</span><span class="crayon-i">row</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-6"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-7"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-i">width</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-8"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h">   </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-v">difference</span><span class="crayon-sy">[</span><span class="crayon-i">col</span><span class="crayon-o">:</span><span class="crayon-i">col</span><span class="crayon-o">+</span><span class="crayon-sy">(</span><span class="crayon-i">width</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-9"><span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-10"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-11"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-12"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-13"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-14"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-15"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfde9248498084-16"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfde9248498084-17"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">]</span></p></div></td>
</tr>
</table>
</div>
</div>

<p/>
<h3>4. Convert the difference into bits.</h3>
<p>To make the hash easy to store and use, we convert it into a hexadecimal string. A True value will have a binary value of 1 and a False value will have one of 0.</p>
<h2>Python implementation</h2>
<p>A full implementation of the algorithm in Python:</p>
<div id="crayon-56d5a0c5dfdf0451073329" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">
<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-2">2</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-4">4</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-6">6</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-8">8</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-10">10</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-12">12</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-14">14</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-16">16</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-18">18</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-20">20</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-22">22</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-24">24</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-26">26</p><p class="crayon-num" data-line="crayon-56d5a0c5dfdf0451073329-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a0c5dfdf0451073329-28">28</p></div>
</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-1"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">dhash</span><span class="crayon-sy">(</span><span class="crayon-i">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hash_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-2"><span class="crayon-h">        </span><span class="crayon-c"># Grayscale and shrink the image in one step.</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-3"><span class="crayon-h">        </span><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-e">convert</span><span class="crayon-sy">(</span><span class="crayon-s">'L'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">resize</span><span class="crayon-sy">(</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-4"><span class="crayon-h">            </span><span class="crayon-sy">(</span><span class="crayon-i">hash_size</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">hash_size</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-5"><span class="crayon-h">            </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-i">ANTIALIAS</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-6"><span class="crayon-h">        </span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-8"><span class="crayon-h">        </span><span class="crayon-v">pixels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">list</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-e">getdata</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-10"><span class="crayon-h">        </span><span class="crayon-c"># Compare adjacent pixels.</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-11"><span class="crayon-h">        </span><span class="crayon-v">difference</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-12"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-i">hash_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-13"><span class="crayon-h">            </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-i">hash_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-14"><span class="crayon-h">                </span><span class="crayon-v">pixel_left</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-e">getpixel</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-i">col</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">row</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-15"><span class="crayon-h">                </span><span class="crayon-v">pixel_right</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-e">getpixel</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-i">col</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">row</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-16"><span class="crayon-h">                </span><span class="crayon-v">difference</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-i">pixel_left</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">pixel_right</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-17"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-18"><span class="crayon-h">        </span><span class="crayon-c"># Convert the binary array to a hexadecimal string.</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-19"><span class="crayon-h">        </span><span class="crayon-v">decimal_value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-20"><span class="crayon-h">        </span><span class="crayon-v">hex_string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-21"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">index</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">enumerate</span><span class="crayon-sy">(</span><span class="crayon-i">difference</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-22"><span class="crayon-h">            </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">value</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-23"><span class="crayon-h">                </span><span class="crayon-i">decimal_value</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-i">index</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-24"><span class="crayon-h">            </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">index</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-25"><span class="crayon-h">                </span><span class="crayon-v">hex_string</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-k ">hex</span><span class="crayon-sy">(</span><span class="crayon-i">decimal_value</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">rjust</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'0'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-26"><span class="crayon-h">                </span><span class="crayon-v">decimal_value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf0451073329-27"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf0451073329-28"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-i">hex_string</span><span class="crayon-sy">)</span></p></div></td>
</tr>
</table>
</div>
</div>

<p/>
<h2>Comparing hashes</h2>
<p>In the most simple case where the images differ only slightly the hashes most likely will be the same so we can directly compare them.</p>
<div id="crayon-56d5a0c5dfdf8815072099" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfdf8815072099-1"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">PIL </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">Image</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf8815072099-2"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">utility </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">dhash</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">hamming_distance</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf8815072099-3"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">orig</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">'data/cat_grumpy_orig.png'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf8815072099-4"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">modif</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-s">'data/cat_grumpy_modif.png'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf8815072099-5"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">dhash</span><span class="crayon-sy">(</span><span class="crayon-i">orig</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf8815072099-6"><span class="crayon-h">    </span><span class="crayon-s">'4c8e3366c275650f'</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf8815072099-7"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">dhash</span><span class="crayon-sy">(</span><span class="crayon-i">modif</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf8815072099-8"><span class="crayon-h">    </span><span class="crayon-s">'4c8e3366c275650f'</span></p><p class="crayon-line" id="crayon-56d5a0c5dfdf8815072099-9"><span class="crayon-h">    </span><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">dhash</span><span class="crayon-sy">(</span><span class="crayon-i">orig</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">dhash</span><span class="crayon-sy">(</span><span class="crayon-i">modif</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdf8815072099-10"><span class="crayon-h">    </span><span class="crayon-t">True</span></p></div></td>
</tr>
</table>
</div>
</div>

<p>If we kept an SQL database with our hashes and we wanted to see if the ’4c8e3366c275650f’ hash existed in our database we could simply do something like this:</p>
<div id="crayon-56d5a0c5dfdfe974117621" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfdfe974117621-1"><span class="crayon-h">    </span><span class="crayon-st">SELECT</span><span class="crayon-h"> </span>pk,<span class="crayon-h"> </span><span class="crayon-st">hash</span>,<span class="crayon-h"> </span>file_path<span class="crayon-h"> </span><span class="crayon-st">FROM</span><span class="crayon-h"> </span>image_hashes</p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfdfe974117621-2"><span class="crayon-h">        </span><span class="crayon-st">WHERE</span><span class="crayon-h"> </span><span class="crayon-st">hash</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'4c8e3366c275650f'</span>;</p></div></td>
</tr>
</table>
</div>
</div>

<p>Now, in the case that the images differ a bit more and the hashes are not exactly the same we need to compare them by calculating the minimum number of substitutions required to change one string into the other, this is called a hamming distance.</p>
<p>On <a href="http://en.wikipedia.org/wiki/Hamming_distance">the Wikipedia page</a> there is some sample Python code that computes the hamming distance between two string but we can calculate the hamming distance and query based on it directly in MySQL:</p>
<div id="crayon-56d5a0c5dfe04652111467" class="crayon-syntax crayon-theme-arduino-ide-copy crayon-font-consolas crayon-os-mac print-yes" data-settings=" minimize scroll-mouseover">

<p class="crayon-info"/>
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">

</td>
<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a0c5dfe04652111467-1"><span class="crayon-h">    </span><span class="crayon-st">SELECT</span><span class="crayon-h"> </span>pk,<span class="crayon-h"> </span><span class="crayon-st">hash</span>,<span class="crayon-h"> </span><span class="crayon-e ">BIT_COUNT</span>(</p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfe04652111467-2"><span class="crayon-h">        </span><span class="crayon-e ">CONV</span>(<span class="crayon-st">hash</span>,<span class="crayon-h"> </span>16,<span class="crayon-h"> </span>10)<span class="crayon-h"> </span>^<span class="crayon-h"> </span><span class="crayon-e ">CONV</span>(<span class="crayon-s">'4c8e3366c275650f'</span>,<span class="crayon-h"> </span>16,<span class="crayon-h"> </span>10)</p><p class="crayon-line" id="crayon-56d5a0c5dfe04652111467-3"><span class="crayon-h">    </span>)<span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span>hamming_distance</p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfe04652111467-4"><span class="crayon-h">        </span><span class="crayon-st">FROM</span><span class="crayon-h"> </span>image_hashes</p><p class="crayon-line" id="crayon-56d5a0c5dfe04652111467-5"><span class="crayon-h">        </span><span class="crayon-st">HAVING</span><span class="crayon-h"> </span>hamming_distance<span class="crayon-h"> </span><span class="crayon-h">&lt;</span><span class="crayon-h"> </span>4</p><p class="crayon-line crayon-striped-line" id="crayon-56d5a0c5dfe04652111467-6"><span class="crayon-h">        </span><span class="crayon-st">ORDER BY</span><span class="crayon-h"> </span>hamming_distance<span class="crayon-h"> </span><span class="crayon-st">ASC</span>;</p></div></td>
</tr>
</table>
</div>
</div>

<p>It will do a binary XOR of the two values, the first one from the database and the second one the one that we query, and count the bits that are different amongst the two values. Because BIT_COUNT works only on integers and we stored the hash as a hex string (base 16) we have to convert it to a decimal value (base 10), the same goes for the value that we want to query by.</p>
<h2>Ending words</h2>
<p>Even though I’ve presented the algorithm using Python snippets the algorithm is pretty general and can be implemented in any other programming language.</p>
<p>As I said in the introduction, we will be using the algorithm in the future on <a href="http://www.iconfinder.com">Iconfinder</a> to warn us if a submitted icon already exists in our collection but it can also have other practical uses. For example, because images with similar features have the hamming distance of their hashes close, it can also be used as a basic recommendation system where the recommended images are within a certain hashing distance of the current image.</p>
</div>

</div></body></html>