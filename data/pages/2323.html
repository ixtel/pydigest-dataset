<html><body><div><div class="wrap" id="course-wrapper">
        <div class="course-section" id="learning-django-and-angularjs"><h1>Learning Django and AngularJS</h1><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;django-intro&quot;,&quot;provider&quot;:&quot;youtube&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:null,&quot;video&quot;:{&quot;id&quot;:47,&quot;provider_name&quot;:&quot;youtube&quot;,&quot;provider_id&quot;:&quot;PNDtcUe8DlY&quot;,&quot;slug&quot;:&quot;django-intro&quot;,&quot;pro&quot;:false,&quot;course_id&quot;:9,&quot;created_at&quot;:&quot;2015-09-20T08:52:26.252Z&quot;,&quot;updated_at&quot;:&quot;2015-09-20T08:52:26.252Z&quot;,&quot;thumbnail_url&quot;:null}}"/><p>In this tutorial you will build a simplified Google+ clone called “Not Google Plus” with Django and AngularJS.</p><p>Before we hit the proverbial books and learn to build a rich, modern web application with Django and Angular, let's take a moment to explore the motivations behind this tutorial and how you can get the most out of it.</p>
<h2 id="what-is-the-goal-of-this-tutorial">What is the goal of this tutorial?</h2>
<p>Here at Thinkster, we strive to create high value, in depth content while maintaining a low barrier to entry. We release this content for free with the hope that you find it both exciting as well as informative.</p><p>Each tutorial we release has a specific goal. In this tutorial, that goal is to give you a brief overview of how Django and AngularJS play together and how these technologies can be combined to build amazing web applications. Furthermore, we place a heavy emphasis on building good engineering habits. This includes everything from considering the tradeoffs that come from making architectural decisions, to maintaining high quality code throughout your project. While these things may not sound like fun, they are key to becoming a well-rounded software developer.</p>
<h2 id="who-is-this-tutorial-for">Who is this tutorial for?</h2>
<p>Every author must answer this difficult question. Our goal is to make this tutorial useful  for novices as well as experienced developers.</p><p>For those of you who are in the early days of your software development careers, we have tried to be thorough and logical in our explanations as possible, while still making the text flow fluidly; we try to avoid making intuitive leaps where doing so makes sense.</p><p>For those of you who have been around the block a few times, and perhaps are just interested in learning more about Django or AngularJS, we know you don't need the basics explained to you. One of our goals when writing this tutorial was to make it easy to skim. This allows you to use your existing knowledge to speed up the reading process and identify where unfamiliar concepts are presented so you can grok them quickly and move on.</p><p>We want to make this tutorial accessible to anyone with enough interest to take the time necessary to learn and understand the concepts presented.</p>
<h2 id="a-brief-interlude-about-formatting">A brief interlude about formatting</h2>
<p>Throughout this tutorial, we strive to maintain consistent formatting. This section details what that formatting looks like and what it means.</p>
<ul>
<li>When presenting a new code snippet, we will present the snippet in it's entirety and then walk through it line-by-line as necessary to cover new concepts.</li>
<li>Variable names and file names appear in-line with special formatting: <code>thinkster_django_angular/settings.py</code>.</li>
<li><p>Longer code snippets will appear on their own lines:</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">is_this_google_plus</span><span class="p">()</span><span class="o">:</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">False</span>
</pre></div></li>
<li><p>Terminal commands also appear on their own line, prefixed by a <code>$</code>:</p><div class="highlight"><pre><span class="nv">$ </span>python manage.py runserver
</pre></div></li>
<li><p>Unless otherwise specified, you should assume that all terminal commands are run from the root directory of your project.</p></li>
</ul>

<h2 id="a-word-on-code-style">A word on code style</h2>
<p>Where possible, we opt to follow style guides created by the Django and Angular communities.</p><p>For Django, we follow <a href="http://legacy.python.org/dev/peps/pep-0008/" target="_blank">PEP8</a> strictly and try our best to adhere to <a href="https://docs.djangoproject.com/en/1.7/internals/contributing/writing-code/coding-style/" target="_blank">Django Coding style</a>.</p><p>For AngularJS, we have adopted John Papa's <a href="https://github.com/johnpapa/angularjs-styleguide" target="_blank">AngularJS Style Guide</a>. We also adhere to <a href="https://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml" target="_blank">Google's JavaScript Style Guide</a> where it makes sense to do so.</p>
<h2 id="a-humble-request-for-feedback">A humble request for feedback</h2>
<p>At the risk of sounding cliche, we would not have a reason to make this tutorial if not for you. Because we believe that your success is our success, we invite you to contact us with any thoughts you have about the tutorial. You can reach us via Twitter at <a href="http://twitter.com/jamesbrwr" target="_blank">@jamesbrwr</a> or <a href="http://twitter.com/gothinkster" target="_blank">@GoThinkster</a>, or by emailing <a href="mailto:support@thinkster.io" target="_blank">support@thinkster.io</a>.</p><p>We welcome criticism openly and accept praise if you believe it is warranted. We're interested in knowing what you like, what you don't like, what you want to know more about, and anything else you feel is relevant.</p><p>If you are too busy to reach out to us, that's OK. We know that learning takes a lot of work. If, on the other hand, you want to help us build something amazing, we await your mail.</p>
<h2 id="a-final-word-before-we-begin">A final word before we begin</h2>
<p>It is our experience that the developers who gain the most from our tutorials are the ones who take an active approach to their learning.</p><p>We <strong>strongly</strong> recommend you type out the code for yourself. When you copy and paste code, you don’t interact with it and that interaction is in turn what makes you a better developer.</p><p>In addition to typing the code yourself, do not be afraid to get your hands dirty; jump in and play around, break things and build missing features. If you encounter a bug, explore and figure out what is causing it. These are the obstacles we as engineers must tackle multiple times a day, and have thus learned to embrace these explorations as the best source of learning.</p><p>Let's build some software.</p></div><div class="course-section" id="setting-up-your-environment"><h1>Setting up your environment</h1><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;setup-environment&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/2d2cbda4859ce95a077cbcf7f0e6fc8971ac6288.jpg&quot;}"/><p>The application we will be building requires a non-trivial amount of boilerplate. Instead of spending time setting up your environment, which is not the purpose of this tutorial, we have created a boilerplate project to get you started.</p><p>You can find the boilerplate project on Github at <a href="https://github.com/brwr/thinkster-django-angular-boilerplate" target="_blank">brwr/thinkster-django-angular-boilerplate</a>. The repository includes a list of commands you need to run to get everything running.</p><p>Go ahead and follow the setup instructions now.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;set_up_envrionment&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Follow the instructions to set up your environment&quot;,&quot;isFirst&quot;:true}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>If all went well running the server with <code>python manage.py runserver</code> should allow you to visit <code>http://localhost:8000/</code> in your browser. The page will be blank except for the navigation bar at the top. The links in the navigation bar currently do nothing.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_environment&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make sure your environment is running by visiting \u003ccode\u003ehttp://localhost:8000/\u003c/code\u003e&quot;}"/></div><div class="course-section" id="extending-django-s-built-in-user-model"><h1>Extending Django's built-in User model</h1><p>Django has a built-in <code>User</code> model that offers a lot of functionality. The problem with <code>User</code> is that the model cannot be extended to include more information. For example, we will be giving our users a tagline to display on their profile. <code>User</code> does not have a tagline attribute and we cannot add one ourselves.</p><p><code>User</code> inherits from <code>AbstractBaseUser</code>. That is where <code>User</code> gets most of it's functionality. By creating a new model called <code>Account</code> and inheriting from <code>AbstractBaseUser</code>, we will get the necessary functionality of <code>User</code> (password hashing, session management, etc) and be able to extend <code>Account</code> to include extra information, such as a tagline.</p><p>In Django, the concept of an "app" is used to organize code in a meaningful way. An app is a module that houses code for models, view, serializers, etc that are all related in some way. By way of example, our first step in building our Django and AngularJS web application will be to create an app called <code>authentication</code>. The <code>authentication</code> app will contain the code relevent to the <code>Account</code> model we just talked about as well as views for logging in, logging out and register.</p><p>Make a new app called <code>authentication</code> by running the following command:</p><div class="highlight"><pre><span class="nv">$ </span>python manage.py startapp authentication
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;startapp_authentication&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a Django app named \u003ccode\u003eauthentication\u003c/code\u003e&quot;}"/>
<h2 id="creating-the-account-model">Creating the Account model</h2>
<p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;account-manager&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/999da9c32c7babd920879bca5784c9be5c535fe5.jpg&quot;}"/><p>To get started, we will create the <code>Account</code> model we just talked about.</p><p>Open <code>authentication/models.py</code> in your favorite text editor and edit it to reflect the following:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">AbstractBaseUser</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">AbstractBaseUser</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">tagline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">140</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">is_admin</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">AccountManager</span><span class="p">()</span>

    <span class="n">USERNAME_FIELD</span> <span class="o">=</span> <span class="s">'email'</span>
    <span class="n">REQUIRED_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'username'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span>

    <span class="k">def</span> <span class="nf">get_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;create_user_profile_model&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new model in \u003ccode\u003eauthentication/models.py\u003c/code\u003e called \u003ccode\u003eAccount\u003c/code\u003e&quot;}"/><p>Let's take a closer look at each attribute and method in turn.</p><div class="highlight"><pre><span class="vg">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">EmailField</span><span class="p">(</span><span class="vg">unique</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>

<span class="err">#</span><span class="w"> </span><span class="o">...</span>

<span class="vg">USERNAME_FIELD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">'email'</span>
</pre></div><p>Django's built-in <code>User</code> requires a username. That username is used for logging the user in. By contrast, our application will use the user's email address for this purpose.</p><p>To tell Django that we want to treat the email field as the username for this model, we set the <code>USERNAME_FIELD</code> attribute to <code>email</code>. The field specified by <code>USERNAME_FIELD</code> must be unique, so we pass the <code>unique=True</code> argument in the email field.</p><div class="highlight"><pre><span class="vg">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">CharField</span><span class="p">(</span><span class="vg">max_length</span><span class="o">=</span><span class="il">40</span><span class="p">,</span><span class="w"> </span><span class="vg">unique</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>
</pre></div><p>Even though we will log in with our email address, we still want the user to have a username. We need some to display on their posts and profile page. We will also use the username in our URLs, so the username must be unique. To this end, we pass the <code>unique=True</code> argument in the username field.</p><div class="highlight"><pre><span class="vg">first_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">CharField</span><span class="p">(</span><span class="vg">max_length</span><span class="o">=</span><span class="il">40</span><span class="p">,</span><span class="w"> </span><span class="vg">blank</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>
<span class="vg">last_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">CharField</span><span class="p">(</span><span class="vg">max_length</span><span class="o">=</span><span class="il">40</span><span class="p">,</span><span class="w"> </span><span class="vg">blank</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>
</pre></div><p>Ideally we should have a more personal way to reference our users. Because we understand that not all users are comfortable giving out their personal details, we make the <code>first_name</code> and <code>last_name</code> fields optional by passing the <code>blank=True</code> argument.</p><div class="highlight"><pre><span class="vg">tagline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">CharField</span><span class="p">(</span><span class="vg">max_length</span><span class="o">=</span><span class="il">140</span><span class="p">,</span><span class="w"> </span><span class="vg">blank</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>
</pre></div><p>As mentioned before, the <code>tagline</code> attribute will be displayed on the user's profile. This gives the profile a hint of the user's personally, so it is worth including.</p><div class="highlight"><pre><span class="vg">created_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">DateTimeField</span><span class="p">(</span><span class="vg">auto_now_add</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>
<span class="vg">updated_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">DateTimeField</span><span class="p">(</span><span class="vg">auto_now</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>
</pre></div><p>The <code>created_at</code> field records the time that the <code>Account</code> object was created. By passing <code>auto_now_add=True</code> to <code>models.DateTimeField</code>, we are telling Django that this field should be automatically set when the object is created and non-editable after that.</p><p>Similar to <code>created_at</code>, <code>updated_at</code> is automatically set by Django. The difference between <code>auto_now_add=True</code> and <code>auto_now=True</code> is that <code>auto_now=True</code> causes the field to update each time the object is saved.</p><div class="highlight"><pre><span class="vg">objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">AccountManager</span><span class="p">()</span>
</pre></div><p>When you want to get a model instance in Django, you use an expression of the form <code>Model.objects.get(**kwargs)</code>. The <code>objects</code> attribute here is a <code>Manager</code> class whose name typically follows the <code>&lt;model name&gt;Manager</code> convention. In our case, we will create an <code>AccountManager</code> class. We will do this momentarily.</p><div class="highlight"><pre><span class="vg">REQUIRED_FIELDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="c1">'username']</span>
</pre></div><p>We will be displaying the username in multiple places. To this end, having a username is not optional, so we include it in the <code>REQUIRED_FIELDS</code> list. Normally the <code>required=True</code> argument would accomplish this goal, but because this model is replacing the <code>User</code> model, Django requires us to specify required fields in this way.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">__unicode__</span><span class="p">(</span><span class="vg">self</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">email</span>
</pre></div><p>When working in the shell, as we will see shortly, the default string representation of an <code>Account</code> object looks something like <code>&lt;Account: Account&gt;</code>. Because we will have many different accounts, this is not very helpful. Overwriting <code>__unicode__()</code> will change this default behavior. Here we choose to show the user's email instead. The string representation of an account with the email <code>james@notgoogleplus.com</code> will now look like <code>&lt;Account: james@notgoogleplus.com&gt;</code>.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">get_full_name</span><span class="p">(</span><span class="vg">self</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="c1">' '.join([self.first_name, self.last_name])</span>

<span class="vg">def</span><span class="w"> </span><span class="vg">get_short_name</span><span class="p">(</span><span class="vg">self</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">first_name</span>
</pre></div><p><code>get_full_name()</code> and <code>get_short_name()</code> are Django conventions. We won't be using either of these methods, but it is still a good idea to include them to comply with Django conventions.</p>
<h2 id="making-a-manager-class-for-account">Making a Manager class for Account</h2>
<p>When substituting a customer user model, it is required that you also define a related <code>Manager</code> class the overrides the <code>create_user()</code> and <code>create_superuser()</code> methods.</p><p>With <code>authentication/models.py</code> still open, add the following class above the <code>Account</code> class:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">BaseUserManager</span>


<span class="k">class</span> <span class="nc">AccountManager</span><span class="p">(</span><span class="n">BaseUserManager</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Users must have a valid email address.'</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'username'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Users must have a valid username.'</span><span class="p">)</span>

        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span>
            <span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalize_email</span><span class="p">(</span><span class="n">email</span><span class="p">),</span> <span class="n">username</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">account</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">account</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">account</span>

    <span class="k">def</span> <span class="nf">create_superuser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">account</span><span class="o">.</span><span class="n">is_admin</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">account</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">account</span>
</pre></div><p>Like we did with <code>Account</code>, let's step through this file line-by-line. We will only cover new information.</p><div class="highlight"><pre><span class="vg">if</span><span class="w"> </span><span class="vg">not</span><span class="w"> </span><span class="nl">email:</span>
<span class="w">    </span><span class="vg">raise</span><span class="w"> </span><span class="vg">ValueError</span><span class="p">(</span><span class="c1">'Users must have a valid email address.')</span>

<span class="vg">if</span><span class="w"> </span><span class="vg">not</span><span class="w"> </span><span class="vg">kwargs</span><span class="o">.</span><span class="vg">get</span><span class="p">(</span><span class="c1">'username'):</span>
<span class="w">    </span><span class="vg">raise</span><span class="w"> </span><span class="vg">ValueError</span><span class="p">(</span><span class="c1">'Users must have a valid username.')</span>
</pre></div><p>Because users are required to have both an email and a username, we should raise an error if either of these attributes are missing.</p><div class="highlight"><pre><span class="vg">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">model</span><span class="p">(</span>
<span class="w">    </span><span class="vg">email</span><span class="o">=</span><span class="vg">self</span><span class="o">.</span><span class="vg">normalize_email</span><span class="p">(</span><span class="vg">email</span><span class="p">),</span><span class="w"> </span><span class="vg">username</span><span class="o">=</span><span class="vg">kwargs</span><span class="o">.</span><span class="vg">get</span><span class="p">(</span><span class="c1">'username')</span>
<span class="p">)</span>
</pre></div><p>Since we haven't defined a <code>model</code> attribute on the <code>AccountManager</code> class, <code>self.model</code> refers to the <code>model</code> attribute of <code>BaseUserManager</code>. This defaults to <code>settings.AUTH_USER_MODEL</code>, which we will change in just a moment to point to the <code>Account</code> class.</p><div class="highlight"><pre><span class="vg">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">create_account</span><span class="p">(</span><span class="vg">email</span><span class="p">,</span><span class="w"> </span><span class="vg">password</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="vg">kwargs</span><span class="p">)</span>

<span class="vg">account</span><span class="o">.</span><span class="vg">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">True</span>
<span class="vg">account</span><span class="o">.</span><span class="vg">save</span><span class="p">()</span>
</pre></div><p>Writing the same thing more than once sucks. Instead of copying all of the code from <code>create_account</code> and pasting it in <code>create_superuser</code>, we simply let <code>create_user</code> handle the actual creation. This frees up <code>create_superuser</code> to only worry about turning an <code>Account</code> into a superuser.</p>
<h2 id="changing-the-django-auth_user_model-setting">Changing the Django AUTH_USER_MODEL setting</h2>
<p>Even though we have created this <code>Account</code> model, the command <code>python manage.py createsuperuser</code> (which we will talk more about shortly) still creates <code>User</code> objects. This is because, at this point, Django still believes that <code>User</code> is the model we want to use for authentication.</p><p>To set things straight and start using <code>Account</code> as our authentication model, we have to update <code>settings.AUTH_USER_MODEL</code>.</p><p>Open <code>thinkster_django_angular_tutorial/settings.py</code> and add the following to the end of the file:</p><div class="highlight"><pre><span class="vg">AUTH_USER_MODEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">'authentication.Account'</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;auth_user_model_setting&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Change \u003ccode\u003esettings.AUTH_USER_MODEL\u003c/code\u003e to use \u003ccode\u003eAccount\u003c/code\u003e instead of \u003ccode\u003eUser\u003c/code\u003e&quot;}"/><p>This line tells Django to look in the <code>authentication</code> app and find a model named <code>Account</code>. </p>
<h2 id="installing-your-first-app">Installing your first app</h2>
<p>In Django, you must explicitly declare which apps are being used. Since we haven't added our <code>authentication</code> app to the list of installed apps yet, we will do that now.</p><p>Open <code>thinkster_django_angular_boilerplate/settings.py</code> and append <code>'authentication',</code> to <code>INSTALLED_APPS</code> like so:</p><div class="highlight"><pre><span class="vg">INSTALLED_APPS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">...</span><span class="p">,</span>
<span class="w">    </span><span class="c1">'authentication',</span>
<span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;install_authentication_app&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Install the \u003ccode\u003eauthentication\u003c/code\u003e app&quot;}"/>
<h2 id="migrating-your-first-app">Migrating your first app</h2>
<p>When Django 1.7 was released, it  was like Christmas in September! Migrations had finally arrived!</p><p>Anyone with a background in Rails will find the concept of migrations familiar. In short, migrations handle the SQL needed to update the schema of our database so you don't have to. By way of example, consider the <code>Account</code> model we just created. These models need to be stored in the database, but our database doesn't have a table for <code>Account</code> objects yet. What do we do? We create our first migration! The migration will handle adding the tables to the database and offer us a way to rollback the changes if we make a mistake.</p><p>When you're ready, generate the migrations for the <code>authentication</code> app and apply them:</p><div class="highlight"><pre><span class="nv">$ </span>python manage.py makemigrations
Migrations <span class="k">for</span> <span class="s1">'authentication'</span>:
    0001_initial.py:
        - Create model Account
<span class="nv">$ </span>python manage.py migrate
Operations to perform:
    Synchronize unmigrated apps: rest_framework
    Apply all migrations: admin, authentication, contenttypes, auth, sessions
Synchronizing apps without migrations:
    Creating tables...
    Installing custom SQL...
    Installing indexes...
Running migrations:
    Applying authentication.0001_initial... OK
</pre></div><p>{info}
From now on, the output from migration commands will not be included for brevity.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;initial_migration&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Generate the migrations for the \u003ccode\u003eauthentication\u003c/code\u003e app and apply them&quot;}"/>
<h2 id="making-yourself-a-superuser">Making yourself a superuser</h2>
<p>Let's talk more about the <code>python manage.py createsuperuser</code> command from a few minutes ago.</p><p>Different users have different levels of access in any given application. Some users are admins and can do anywhere, while some are just regular users whose actions should be limited. In Django, a super user is the highest level of access you can have. Because we want the ability to work will all facets of our application, we will create a super user. That is what <code>python manage.py createsuperuser</code> does.</p><p>After running the command, Django will prompt you for some information and create an <code>Account</code> with superuser access. Go ahead and give it a try.</p><div class="highlight"><pre><span class="nv">$ </span>python manage.py createsuperuser
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;create_superuser&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new super user \u003ccode\u003eAccount\u003c/code\u003e&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>To make sure everything is properly configured, let's take a quick break and open Django's shell:</p><p>You should see a new prompt: <code>&gt;&gt;&gt;</code>. Inside the shell, we can get the <code>Account</code> we just created like so:</p><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">authentication.models</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'created_at'</span><span class="p">)</span>
</pre></div><p>If everything went well, you should be able to access the various attributes of your <code>Account</code> object:</p><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="vg">a</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="vg">a</span><span class="o">.</span><span class="vg">email</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="vg">a</span><span class="o">.</span><span class="vg">username</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;get_new_account&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Access the \u003ccode\u003eAccount\u003c/code\u003e object you just created&quot;}"/></div><div class="course-section" id="serializing-the-account-model"><h1>Serializing the Account Model</h1><p>The AngularJS application we are going to build will make AJAX requests to the server to get the data it intends to display. Before we can send that data back to the client, we need to format it in a way that the client can understand; in this case, we choose JSON. The process of transforming Django models to JSON is called serialization and that is what we will talk about now.</p><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;serialize-account-model&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/1dd5e9b5ff15492149cf88964e8cefcb0cccdafb.jpg&quot;}"/><p>As the model we want to serialize is called <code>Account</code>, the serializer we will create is going to be called <code>AccountSerializer</code>.</p>
<h2 id="django-rest-framework">Django REST Framework</h2>
<p>As part of the boilerplate project you cloned earlier, we have included a project called Django REST Framework. Django REST Framework is a toolkit that provides a number of features common to most web applications, including serializers. We will make use of these features throughout the tutorial to save us both time and frustration. Our first look at Django REST Framework starts here.</p>
<h2 id="accountserializer">AccountSerializer</h2>
<p>Before we write our serializers, let's create a <code>serializers.py</code> file inside our <code>authentication</code> app:</p><div class="highlight"><pre><span class="nv">$ </span>touch authentication/serializers.py
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;create_serializers_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a \u003ccode\u003eserializers.py\u003c/code\u003e file inside the \u003ccode\u003eauthentication\u003c/code\u003e app&quot;}"/><p>Open <code>authentication/serializers.py</code> and add the following code and imports:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">update_session_auth_hash</span>

<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">authentication.models</span> <span class="kn">import</span> <span class="n">Account</span>


<span class="k">class</span> <span class="nc">AccountSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">confirm_password</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'created_at'</span><span class="p">,</span> <span class="s">'updated_at'</span><span class="p">,</span>
                  <span class="s">'first_name'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'tagline'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">,</span>
                  <span class="s">'confirm_password'</span><span class="p">,)</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'created_at'</span><span class="p">,</span> <span class="s">'updated_at'</span><span class="p">,)</span>

        <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'username'</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">tagline</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'tagline'</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">tagline</span><span class="p">)</span>

            <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">password</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'password'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">confirm_password</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'confirm_password'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">password</span> <span class="ow">and</span> <span class="n">confirm_password</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="n">confirm_password</span><span class="p">:</span>
                <span class="n">instance</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
                <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'request'</span><span class="p">),</span> <span class="n">instance</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">instance</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;create_account_serializer&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a serializer called \u003ccode\u003eAccountSerializer\u003c/code\u003e in \u003ccode\u003eauthentication/serializers.py\u003c/code\u003e&quot;}"/><p>{info}
From here on, we will declare imports that are used in each snippet. These may already be present in the file. If so, they do not need to be added a second time.</p><p>Let's take a closer look.</p><div class="highlight"><pre><span class="vg">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">serializers</span><span class="o">.</span><span class="vg">CharField</span><span class="p">(</span><span class="vg">write_only</span><span class="o">=</span><span class="vg">True</span><span class="p">,</span><span class="w"> </span><span class="vg">required</span><span class="o">=</span><span class="vg">False</span><span class="p">)</span>
<span class="vg">confirm_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">serializers</span><span class="o">.</span><span class="vg">CharField</span><span class="p">(</span><span class="vg">write_only</span><span class="o">=</span><span class="vg">True</span><span class="p">,</span><span class="w"> </span><span class="vg">required</span><span class="o">=</span><span class="vg">False</span><span class="p">)</span>
</pre></div><p>Instead of including <code>password</code> in the <code>fields</code> tuple, which we will talk about in a few minutes, we explicitly define the field at the top of the <code>AccountSerializer</code> class. The reason we do this is so we can pass the <code>required=False</code> argument. Each field in <code>fields</code> is required, but we don't want to update the user's password unless they provide a new one.</p><p><code>confirm_pssword</code> is similar to <code>password</code> and is used only to make sure the user didn't make a typo on accident.</p><p>Also note the use of the <code>write_only=True</code> argument. The user's password, even in it's hashed and salted form, should not be visible to the client in the AJAX response.</p><p>The <code>Meta</code> sub-class defines metadata the serializer requires to operate. We have defined a few common attributes of the <code>Meta</code> class here.</p><p>Because this serializers inherits from <code>serializers.ModelSerializer</code>, it should make sense that we must tell it which model to serialize. Specifying the model creates a guarantee that only attributes of that model or explicitly created fields can be serialized. We will cover serializing model attributes now and explicitly created fields shortly.</p><div class="highlight"><pre><span class="vg">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="c1">'id', 'email', 'username', 'created_at', 'updated_at',</span>
<span class="w">          </span><span class="c1">'first_name', 'last_name', 'tagline', 'password',</span>
<span class="w">          </span><span class="c1">'confirm_password',)</span>
</pre></div><p>The <code>fields</code> attribute of the <code>Meta</code> class is where we specify which attributes of the <code>Account</code> model should be serialized. We must be careful when specifying which fields to serialize because some fields, like <code>is_superuser</code>, should not be available to the client for security reasons.</p><div class="highlight"><pre><span class="vg">read_only_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="c1">'created_at', 'updated_at',)</span>
</pre></div><p>If you recall, when we created the <code>Account</code> model, we made the <code>created_at</code> and <code>updated_at</code> fields self-updating. Because of this feature, we add them to a list of fields that should be read-only.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">create</span><span class="p">(</span><span class="vg">self</span><span class="p">,</span><span class="w"> </span><span class="vg">validated_data</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">...</span>

<span class="vg">def</span><span class="w"> </span><span class="vg">update</span><span class="p">(</span><span class="vg">self</span><span class="p">,</span><span class="w"> </span><span class="vg">instance</span><span class="p">,</span><span class="w"> </span><span class="vg">validated_data</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">...</span>
</pre></div><p>Earlier we mentioned that we sometimes want to turn JSON into a Python object. This is called deserialization and it is handled by the <code>.create()</code> and <code>.update()</code> methods. When creating a new object, such as an <code>Account</code>, <code>.create()</code> is used. When we later update that <code>Account</code>, <code>.update()</code> is used.</p><div class="highlight"><pre><span class="vg">instance</span><span class="o">.</span><span class="vg">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">attrs</span><span class="o">.</span><span class="vg">get</span><span class="p">(</span><span class="c1">'username', instance.username)</span>
<span class="vg">instance</span><span class="o">.</span><span class="vg">tagline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">attrs</span><span class="o">.</span><span class="vg">get</span><span class="p">(</span><span class="c1">'tagline', instance.tagline)</span>
</pre></div><p>We will let the user update their username and tagline attributes for now. If these keys are present in the arrays dictionary, we will use the new value. Otherwise, the current value of the <code>instance</code> object is used. Here, <code>instance</code> is of type <code>Account</code>.</p><div class="highlight"><pre><span class="vg">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">validated_data</span><span class="o">.</span><span class="vg">get</span><span class="p">(</span><span class="c1">'password', None)</span>
<span class="vg">confirm_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">validated_data</span><span class="o">.</span><span class="vg">get</span><span class="p">(</span><span class="c1">'confirm_password', None)</span>

<span class="vg">if</span><span class="w"> </span><span class="vg">password</span><span class="w"> </span><span class="vg">and</span><span class="w"> </span><span class="vg">confirm_password</span><span class="w"> </span><span class="vg">and</span><span class="w"> </span><span class="vg">password</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nl">confirm_password:</span>
<span class="w">    </span><span class="vg">instance</span><span class="o">.</span><span class="vg">set_password</span><span class="p">(</span><span class="vg">password</span><span class="p">)</span>
<span class="w">    </span><span class="vg">instance</span><span class="o">.</span><span class="vg">save</span><span class="p">()</span>
</pre></div><p>Before updating the user's password, we need to confirm they have provided values for both the <code>password</code> and <code>password_confirmation</code> field. We then check to make sure these two fields have equivelant values.</p><p>After we verify that the password should be updated, we much use <code>Account.set_password()</code> to perform the update. <code>Account.set_password()</code> takes care of storing passwords in a secure way. It is important to note that we must explicitly save the model after updating the password.</p><p>{info}
This is a naive implementation of how to validate a password. I would not recommend using this in a real-world system, but for our purposes this does nicely.</p><div class="highlight"><pre><span class="vg">update_session_auth_hash</span><span class="p">(</span><span class="vg">self</span><span class="o">.</span><span class="vg">context</span><span class="o">.</span><span class="vg">get</span><span class="p">(</span><span class="c1">'request'), instance)</span>
</pre></div><p>When a user's password is updated, their session authentication hash must be explicitly updated. If we don't do this here, the user will not be authenticated on their next request and will have to log in again.</p>
<h2 id="checkpoint">Checkpoint</h2>
<p>By now we should have no problem seeing the serialized JSON of an <code>Account</code> object. Open up the Django shell again by running <code>python manage.py shell</code> and try typing the following commands:</p><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">authentication.models</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">authentication.serializers</span> <span class="kn">import</span> <span class="n">AccountSerializer</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'created_at'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serialized_account</span> <span class="o">=</span> <span class="n">AccountSerializer</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serialized_account</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'email'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serialized_account</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_auth_serializers&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make sure your \u003ccode\u003eAccountSerializer\u003c/code\u003e serializer is working&quot;}"/></div><div class="course-section" id="registering-new-users"><h1>Registering new users</h1><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;register-user-1&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/299b2cecd4b49d1a5f3eba48c1837503236ea184.jpg&quot;}"/><p>At this point we have the models and serializers needed to represent users. Now we need to build an authentication system. This involves creating the various views and interfaces for registering, logging in and logging out. We will also touch on an <code>Authentication</code> service with AngularJS and a few different controllers.</p><p>Because we can't log in users that don't exist, it makes sense to start with registration. </p><p>To register a user, we need an API endpoint that will create an <code>Account</code> object, an AngularJS service to make an AJAX request to the API and a registration form. Let's make the API endpoint first.</p>
<h2 id="making-the-account-api-viewset">Making the account API viewset</h2>
<p>Open <code>authentication/views.py</code> and replace it's contents with the following code:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span><span class="p">,</span> <span class="n">viewsets</span>

<span class="kn">from</span> <span class="nn">authentication.models</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="kn">from</span> <span class="nn">authentication.permissions</span> <span class="kn">import</span> <span class="n">IsAccountOwner</span>
<span class="kn">from</span> <span class="nn">authentication.serializers</span> <span class="kn">import</span> <span class="n">AccountSerializer</span>


<span class="k">class</span> <span class="nc">AccountViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">lookup_field</span> <span class="o">=</span> <span class="s">'username'</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">AccountSerializer</span>

    <span class="k">def</span> <span class="nf">get_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="n">permissions</span><span class="o">.</span><span class="n">SAFE_METHODS</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">(),)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">(),)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">(),</span> <span class="n">IsAccountOwner</span><span class="p">(),)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer_class</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="o">**</span><span class="n">serializer</span><span class="o">.</span><span class="n">validated_data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">validated_data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
            <span class="s">'status'</span><span class="p">:</span> <span class="s">'Bad request'</span><span class="p">,</span>
            <span class="s">'message'</span><span class="p">:</span> <span class="s">'Account could not be created with received data.'</span>
        <span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;create_account_viewset&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a viewset called \u003ccode\u003eAccountViewSet\u003c/code\u003e in \u003ccode\u003eauthentication/views.py\u003c/code\u003e&quot;}"/><p>Let's step through this snippet line-by-line:</p><div class="highlight"><pre><span class="vg">class</span><span class="w"> </span><span class="vg">AccountViewSet</span><span class="p">(</span><span class="vg">viewsets</span><span class="o">.</span><span class="vg">ModelViewSet</span><span class="p">)</span><span class="o">:</span>
</pre></div><p>Django REST Framework offers a feature called viewsets. A viewset, as the name implies, is a set of views. Specifically, the <code>ModelViewSet</code> offers an interface for listing, creating, retrieving, updating and destroying objects of a given model.</p><div class="highlight"><pre><span class="vg">lookup_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">'username'</span>
<span class="vg">queryset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">Account</span><span class="o">.</span><span class="vg">objects</span><span class="o">.</span><span class="vg">all</span><span class="p">()</span>
<span class="vg">serializer_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">AccountSerializer</span>
</pre></div><p>Here we define the query set and the serialzier that the viewset will operate on. Django REST Framework uses the specified queryset and serializer to perform the actions listed above. Also note that we specify the <code>lookup_field</code> attribute. As mentioned earlier, we will use the <code>username</code> attribute of the <code>Account</code> model to look up accounts instead of the <code>id</code> attribute. Overriding <code>lookup_field</code> handles this for us.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">get_permissions</span><span class="p">(</span><span class="vg">self</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">if</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">request</span><span class="o">.</span><span class="vg">method</span><span class="w"> </span><span class="vg">in</span><span class="w"> </span><span class="vg">permissions</span><span class="o">.</span><span class="nl">SAFE_METHODS:</span>
<span class="w">        </span><span class="vg">return</span><span class="w"> </span><span class="p">(</span><span class="vg">permissions</span><span class="o">.</span><span class="vg">AllowAny</span><span class="p">(),)</span>

<span class="w">    </span><span class="vg">if</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">request</span><span class="o">.</span><span class="vg">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="c1">'POST':</span>
<span class="w">        </span><span class="vg">return</span><span class="w"> </span><span class="p">(</span><span class="vg">permissions</span><span class="o">.</span><span class="vg">AllowAny</span><span class="p">(),)</span>

<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="p">(</span><span class="vg">permissions</span><span class="o">.</span><span class="vg">IsAuthenticated</span><span class="p">(),</span><span class="w"> </span><span class="vg">IsAccountOwner</span><span class="p">(),)</span>
</pre></div><p>The only user that should be able to call dangerous methods (such as <code>update()</code> and <code>delete()</code>) is the owner of the account. We first check if the user is authenticated and then call a custom permission that we will write in just a moment. This case does not hold when the HTTP method is <code>POST</code>. We want to allow any user to create an account.</p><p>If the HTTP method of the request ('GET', 'POST', etc) is "safe", then anyone can use that endpoint.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">create</span><span class="p">(</span><span class="vg">self</span><span class="p">,</span><span class="w"> </span><span class="vg">request</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">serializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">serializer_class</span><span class="p">(</span><span class="vg">data</span><span class="o">=</span><span class="vg">request</span><span class="o">.</span><span class="vg">data</span><span class="p">)</span>

<span class="w">    </span><span class="vg">if</span><span class="w"> </span><span class="vg">serializer</span><span class="o">.</span><span class="vg">is_valid</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="vg">Account</span><span class="o">.</span><span class="vg">objects</span><span class="o">.</span><span class="vg">create_user</span><span class="p">(</span><span class="o">**</span><span class="vg">serializer</span><span class="o">.</span><span class="vg">validated_data</span><span class="p">)</span>

<span class="w">        </span><span class="vg">return</span><span class="w"> </span><span class="vg">Response</span><span class="p">(</span><span class="vg">serializer</span><span class="o">.</span><span class="vg">validated_data</span><span class="p">,</span><span class="w"> </span><span class="vg">status</span><span class="o">=</span><span class="vg">status</span><span class="o">.</span><span class="vg">HTTP_201_CREATED</span><span class="p">)</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">Response</span><span class="p">({</span>
<span class="w">        </span><span class="c1">'status': 'Bad request',</span>
<span class="w">        </span><span class="c1">'message': 'Account could not be created with received data.'</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="vg">status</span><span class="o">=</span><span class="vg">status</span><span class="o">.</span><span class="vg">HTTP_400_BAD_REQUEST</span><span class="p">)</span>
</pre></div><p>When you create an object using the serializer's <code>.save()</code> method, the object's attributes are set literally. This means that a user registering with the password <code>'password'</code> will have their password stored as <code>'password'</code>. This is bad for a couple of reasons: 1) Storing passwords in plain text is a massive security issue. 2) Django hashes and salts passwords before comparing them, so the user wouldn't be able to log in using <code>'password'</code> as their password.</p><p>We solve this problem by overriding the <code>.create()</code> method for this viewset and using <code>Account.objects.create_user()</code> to create the <code>Account</code> object.</p>
<h2 id="making-the-isaccountowner-permission">Making the IsAccountOwner permission</h2>
<p>Let's create the <code>IsAccountOwner()</code> permission from the view we just made.</p><p>Create a file called <code>authentication/permissions.py</code> with the following content:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span>


<span class="k">class</span> <span class="nc">IsAccountOwner</span><span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">BasePermission</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">has_object_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">account</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">account</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;is_account_owner_permission&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a permission called \u003ccode\u003eIsAccountOwner\u003c/code\u003e in \u003ccode\u003eauthentication/permissions.py\u003c/code\u003e&quot;}"/><p>This is a pretty basic permission. If there is a user associated with the current request, we check whether that user is the same object as <code>account</code>. If there is no user associated with this request, we simply return <code>False</code>.</p>
<h2 id="adding-an-api-endpoint">Adding an API endpoint</h2>
<p>Now that we have created the view, we need to add it to the URLs file. Open <code>thinkster_django_angular_boilerplate/urls.py</code> and update it to look like so:</p><div class="highlight"><pre><span class="c"># .. Imports</span>
<span class="kn">from</span> <span class="nn">rest_framework_nested</span> <span class="kn">import</span> <span class="n">routers</span>

<span class="kn">from</span> <span class="nn">authentication.views</span> <span class="kn">import</span> <span class="n">AccountViewSet</span>

<span class="n">router</span> <span class="o">=</span> <span class="n">routers</span><span class="o">.</span><span class="n">SimpleRouter</span><span class="p">()</span>
<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">r'accounts'</span><span class="p">,</span> <span class="n">AccountViewSet</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
     <span class="s">''</span><span class="p">,</span>
    <span class="c"># ... URLs</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api/v1/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">router</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>

    <span class="n">url</span><span class="p">(</span><span class="s">'^.*$'</span><span class="p">,</span> <span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span>
<span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;url_account_view_set&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add an API endpoint for \u003ccode\u003eAccountViewSet\u003c/code\u003e&quot;}"/><p>{info}
It is very important that the last URL in the above snippet always be the last URL. This is known as a passthrough or catch-all route. It accepts all requests not matched by a previous rule and passes the request through to AngularJS's router for processing. The order of other URLS is normally insignificant.</p>
<h2 id="an-angular-service-for-registering-new-users">An Angular service for registering new users</h2>
<p>With the API endpoint in place, we can create an AngularJS service that will handle communication between the client and the server.</p><p>Make a file in <code>static/javascripts/authentication/services/</code> called <code>authentication.service.js</code> and add the following code:</p><p>{info}
Feel free to leave the comments out of your own code. It takes a lot of time to type them all out!</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* Authentication</span>
<span class="cm">* @namespace thinkster.authentication.services</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">authentication</span><span class="p">.</span><span class="n">services</span><span class="p">')</span>
    <span class="p">.</span><span class="n">factory</span><span class="p">('</span><span class="n">Authentication</span><span class="p">',</span> <span class="n">Authentication</span><span class="p">);</span>

  <span class="n">Authentication</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">cookies</span><span class="p">',</span> <span class="p">'</span><span class="err">$</span><span class="n">http</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace Authentication</span>
<span class="cm">  * @returns {Factory}</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">Authentication</span><span class="p">(</span><span class="err">$</span><span class="n">cookies</span><span class="p">,</span> <span class="err">$</span><span class="n">http</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">    * @name Authentication</span>
<span class="cm">    * @desc The Factory to be returned</span>
<span class="cm">    */</span>
    <span class="k">var</span> <span class="n">Authentication</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nl">register:</span> <span class="n">register</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">Authentication</span><span class="p">;</span>

    <span class="c1">////////////////////</span>

    <span class="cm">/**</span>
<span class="cm">    * @name register</span>
<span class="cm">    * @desc Try to register a new user</span>
<span class="cm">    * @param {string} username The username entered by the user</span>
<span class="cm">    * @param {string} password The password entered by the user</span>
<span class="cm">    * @param {string} email The email entered by the user</span>
<span class="cm">    * @returns {Promise}</span>
<span class="cm">    * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">register</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">post</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="p">',</span> <span class="p">{</span>
        <span class="nl">username:</span> <span class="n">username</span><span class="p">,</span>
        <span class="nl">password:</span> <span class="n">password</span><span class="p">,</span>
        <span class="nl">email:</span> <span class="n">email</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_authentication_service&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a factory called \u003ccode\u003eAuthentication\u003c/code\u003e in \u003ccode\u003estatic/javascripts/authentication/services/authentication.service.js\u003c/code\u003e&quot;}"/><p>Let's step through this line-by-line:</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.authentication.services')</span>
</pre></div><p>AngularJS supports the use of modules. Modularization is a great feature because it promotes encapsulation and loose coupling. We make thorough use of Angular's module system throughout the tutorial. For now, all you need to know is that this service is in the <code>thinkster.authentication.services</code> module.</p><div class="highlight"><pre><span class="o">.</span><span class="vg">factory</span><span class="p">(</span><span class="c1">'Authentication', Authentication);</span>
</pre></div><p>This line registers a factory named <code>Authentication</code> on the module from the previous line. </p><div class="highlight"><pre><span class="vg">function</span><span class="w"> </span><span class="vg">Authentication</span><span class="p">(</span><span class="err">$</span><span class="vg">cookies</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="vg">http</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</pre></div><p>Here we define the factory we just registered. We inject the <code>$cookies</code> and <code>$http</code> services as a dependency. We will be using <code>$cookies</code> later.</p><div class="highlight"><pre><span class="vg">var</span><span class="w"> </span><span class="vg">Authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">register:</span><span class="w"> </span><span class="vg">register</span>
<span class="p">};</span>
</pre></div><p>This is personal preference, but I find it's more readable to define your service as a named object and then return it, leaving the details lower in the file. </p><div class="highlight"><pre><span class="vg">function</span><span class="w"> </span><span class="vg">register</span><span class="w"> </span><span class="p">(</span><span class="vg">username</span><span class="p">,</span><span class="w"> </span><span class="vg">password</span><span class="p">,</span><span class="w"> </span><span class="vg">email</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</pre></div><p>At this point, the <code>Authentication</code> service has only one method: <code>register</code>, which takes a <code>username</code>, <code>password</code>, and <code>email</code>. We will add more methods to the service as we move forward.</p><div class="highlight"><pre><span class="vg">return</span><span class="w"> </span><span class="err">$</span><span class="vg">http</span><span class="o">.</span><span class="vg">post</span><span class="p">(</span><span class="c1">'/api/v1/accounts/', {</span>
<span class="w">  </span><span class="nl">username:</span><span class="w"> </span><span class="vg">username</span><span class="p">,</span>
<span class="w">  </span><span class="nl">password:</span><span class="w"> </span><span class="vg">password</span><span class="p">,</span>
<span class="w">  </span><span class="nl">email:</span><span class="w"> </span><span class="vg">email</span>
<span class="p">});</span>
</pre></div><p>As mentioned before, we need to make an AJAX request to the API endpoint we made. As data, we include the <code>username</code>, <code>password</code> and <code>email</code> parameters this method received. We have no reason to do anything special with the response, so we will let the caller of <code>Authentication.register</code> handle the callback.</p>
<h2 id="making-an-interface-for-registering-new-users">Making an interface for registering new users</h2>
<p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;register-user-2&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/06da6e685ac2b4aa483bf76397a1b4225880c256.jpg&quot;}"/><p>Let's begin creating the interface users will use to register. Begin by creating a file in <code>static/templates/authentication/</code> called <code>register.html</code> with the following content: </p><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4 col-md-offset-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Register<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"well"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">role=</span><span class="s">"form"</span> <span class="na">ng-submit=</span><span class="s">"vm.register()"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"register__email"</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"register__email"</span> <span class="na">ng-model=</span><span class="s">"vm.email"</span> <span class="na">placeholder=</span><span class="s">"ex. john@notgoogle.com"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"register__username"</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"register__username"</span> <span class="na">ng-model=</span><span class="s">"vm.username"</span> <span class="na">placeholder=</span><span class="s">"ex. john"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"register__password"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"register__password"</span> <span class="na">ng-model=</span><span class="s">"vm.password"</span> <span class="na">placeholder=</span><span class="s">"ex. thisisnotgoogleplus"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_register_template&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a \u003ccode\u003eregister.html\u003c/code\u003e template&quot;}"/><p>We won't go into much detail this time because this is pretty basic HTML. A lot of the classes come from Bootstrap, which is included by the boilerplate project. There are only two lines that we are going to pay attention to:</p><div class="highlight"><pre><span class="o">&lt;</span><span class="vg">form</span><span class="w"> </span><span class="vg">role</span><span class="o">=</span><span class="s2">"form"</span><span class="w"> </span><span class="vg">ng</span><span class="o">-</span><span class="vg">submit</span><span class="o">=</span><span class="s2">"vm.register()"</span><span class="o">&gt;</span>
</pre></div><p>This is the line responsible for calling <code>$scope.register</code>, which we set up in our controller. <code>ng-submit</code> will call <code>vm.register</code> when the form is submitted. If you have used Angular before, you are probably used to using <code>$scope</code>. In this tutorial, we choose to avoid using <code>$scope</code> where possible in favor of <code>vm</code> for ViewModel. See the <a href="https://github.com/johnpapa/angularjs-styleguide#controllers" target="_blank">Controllers</a> section of John Papa's AngularJS Style Guide for more on this.</p><div class="highlight"><pre><span class="o">&lt;</span><span class="vg">input</span><span class="w"> </span><span class="vg">type</span><span class="o">=</span><span class="s2">"email"</span><span class="w"> </span><span class="vg">class</span><span class="o">=</span><span class="s2">"form-control"</span><span class="w"> </span><span class="vg">id</span><span class="o">=</span><span class="s2">"register__email"</span><span class="w"> </span><span class="vg">ng</span><span class="o">-</span><span class="vg">model</span><span class="o">=</span><span class="s2">"vm.email"</span><span class="w"> </span><span class="vg">placeholder</span><span class="o">=</span><span class="s2">"ex. john@notgoogle.com"</span><span class="w"> </span><span class="o">/&gt;</span>
</pre></div><p>On each <code>&lt;input /&gt;</code>, you will see another directive, <code>ng-model</code>. <code>ng-model</code> is responsible for storing the value of the input on the ViewModel. This is how we get the username, password, and email when <code>vm.register</code> is called.</p>
<h2 id="controlling-the-interface-with-registercontroller">Controlling the interface with RegisterController</h2>
<p>With a service and interface in place, we need a controller to hook the two together. The controller we create, <code>RegisterController</code> will allow us to call the <code>register</code> method of the <code>Authentication</code> service when a user submits the form we've just built.</p><p>Create a file in <code>static/javascripts/authentication/controllers/</code> called <code>register.controller.js</code> and add the following:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* Register controller</span>
<span class="cm">* @namespace thinkster.authentication.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">authentication</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">RegisterController</span><span class="p">',</span> <span class="n">RegisterController</span><span class="p">);</span>

  <span class="n">RegisterController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">location</span><span class="p">',</span> <span class="p">'</span><span class="err">$</span><span class="n">scope</span><span class="p">',</span> <span class="p">'</span><span class="n">Authentication</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace RegisterController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">RegisterController</span><span class="p">(</span><span class="err">$</span><span class="n">location</span><span class="p">,</span> <span class="err">$</span><span class="n">scope</span><span class="p">,</span> <span class="n">Authentication</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">register</span> <span class="o">=</span> <span class="n">register</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">    * @name register</span>
<span class="cm">    * @desc Register a new user</span>
<span class="cm">    * @memberOf thinkster.authentication.controllers.RegisterController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">register</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Authentication</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">email</span><span class="p">,</span> <span class="n">vm</span><span class="p">.</span><span class="n">password</span><span class="p">,</span> <span class="n">vm</span><span class="p">.</span><span class="n">username</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_register_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a controller named \u003ccode\u003eRegisterController\u003c/code\u003e in \u003ccode\u003estatic/javascripts/authentication/controllers/register.controller.js\u003c/code\u003e&quot;}"/><p>As usual, we will skip over the familiar and talk about new concepts.</p><div class="highlight"><pre><span class="o">.</span><span class="vg">controller</span><span class="p">(</span><span class="c1">'RegisterController', RegisterController);</span>
</pre></div><p>This is similar to the way we registered our service. The difference is that, this time, we are registering a controller.</p><p><code>vm</code> allows the template we just created to access the <code>register</code> method we define later in the controller.</p><div class="highlight"><pre><span class="vg">Authentication</span><span class="o">.</span><span class="vg">register</span><span class="p">(</span><span class="vg">vm</span><span class="o">.</span><span class="vg">email</span><span class="p">,</span><span class="w"> </span><span class="vg">vm</span><span class="o">.</span><span class="vg">password</span><span class="p">,</span><span class="w"> </span><span class="vg">vm</span><span class="o">.</span><span class="vg">username</span><span class="p">);</span>
</pre></div><p>Here we call the service we created a few minutes ago. We pass in a username, password and email from <code>vm</code>. </p>
<h2 id="registration-routes-and-modules">Registration Routes and Modules</h2>
<p>Let's set up some client-side routing so users of the app can navigate to the register form.</p><p>Create a file in <code>static/javascripts</code> called <code>thinkster.routes.js</code> and add the following:</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.routes')</span>
<span class="w">    </span><span class="o">.</span><span class="vg">config</span><span class="p">(</span><span class="vg">config</span><span class="p">);</span>

<span class="w">  </span><span class="vg">config</span><span class="o">.</span><span class="err">$</span><span class="vg">inject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="c1">'$routeProvider'];</span>

<span class="w">  </span><span class="o">/**</span>
<span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">name</span><span class="w"> </span><span class="vg">config</span>
<span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">desc</span><span class="w"> </span><span class="vg">Define</span><span class="w"> </span><span class="vg">valid</span><span class="w"> </span><span class="vg">application</span><span class="w"> </span><span class="vg">routes</span>
<span class="w">  </span><span class="o">*/</span>
<span class="w">  </span><span class="vg">function</span><span class="w"> </span><span class="vg">config</span><span class="p">(</span><span class="err">$</span><span class="vg">routeProvider</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">$</span><span class="vg">routeProvider</span><span class="o">.</span><span class="vg">when</span><span class="p">(</span><span class="c1">'/register', {</span>
<span class="w">      </span><span class="nl">controller:</span><span class="w"> </span><span class="c1">'RegisterController', </span>
<span class="w">      </span><span class="nl">controllerAs:</span><span class="w"> </span><span class="c1">'vm',</span>
<span class="w">      </span><span class="nl">templateUrl:</span><span class="w"> </span><span class="c1">'/static/templates/authentication/register.html'</span>
<span class="w">    </span><span class="p">})</span><span class="o">.</span><span class="vg">otherwise</span><span class="p">(</span><span class="c1">'/');</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_register_route&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Define a route for the registration form&quot;}"/><p>There are a few points we should touch on here.</p><p>Angular, like just about any framework you can imagine, allows you to edit it's configuration. You do this with a <code>.config</code> block. </p><div class="highlight"><pre><span class="vg">function</span><span class="w"> </span><span class="vg">config</span><span class="p">(</span><span class="err">$</span><span class="vg">routeProvider</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</pre></div><p>Here, we are injecting <code>$routeProvider</code> as a dependency, which will let us add routing to the client.</p><div class="highlight"><pre><span class="err">$</span><span class="vg">routeProvider</span><span class="o">.</span><span class="vg">when</span><span class="p">(</span><span class="c1">'/register', {</span>
</pre></div><p><code>$routeProvider.when</code> takes two arguments: a path and an options object. Here we use <code>/register</code> as the path because thats where we want the registration form to show up.</p><div class="highlight"><pre><span class="nl">controller:</span><span class="w"> </span><span class="c1">'RegisterController',</span>
<span class="nl">controllerAs:</span><span class="w"> </span><span class="c1">'vm',</span>
</pre></div><p>One key you can include in the options object is <code>controller</code>. This will map a certain controller to this route. Here we use the <code>RegisterController</code> controller we made earlier. <code>controllerAs</code> is another option. This is required to use the <code>vm</code> variable. In short, we are saying that we want to refer to the controller as <code>vm</code> in the template.</p><div class="highlight"><pre><span class="nl">templateUrl:</span><span class="w"> </span><span class="c1">'/static/templates/authentication/register.html'</span>
</pre></div><p>The other key we will use is <code>templateUrl</code>. <code>templateUrl</code> takes a string of the URL where the template we want to use for this route can be found.</p><p>We will add more routes as we move forward, but it's possible a user will enter a URL that we don't support. When this happens, <code>$routeProvider.otherwise</code> will redirect the user to the path specified; in this case, '/'.</p>
<h2 id="setting-up-angularjs-modules">Setting up AngularJS modules</h2>
<p>Let us quickly discuss modules in AngularJS.</p><p>In Angular, you must define modules prior to using them. So far we need to define <code>thinkster.authentication.services</code>, <code>thinkster.authentication.controllers</code>, and <code>thinkster.routes</code>. Because <code>thinkster.authentication.services</code> and <code>thinkster.authentication.controllers</code> are submodules of <code>thinkster.authentication</code>, we need to create a <code>thinkster.authentication</code> module as well.</p><p>Create a file in <code>static/javascripts/authentication/</code> called <code>authentication.module.js</code> and add the following:</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.authentication', [</span>
<span class="w">      </span><span class="c1">'thinkster.authentication.controllers',</span>
<span class="w">      </span><span class="c1">'thinkster.authentication.services'</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.authentication.controllers', []);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.authentication.services', ['ngCookies']);</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_authentication_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Define the \u003ccode\u003ethinkster.authentication\u003c/code\u003e module and it\u0026#39;s dependencies&quot;}"/><p>There are a couple of interesting syntaxes to note here.</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.authentication', [</span>
<span class="w">    </span><span class="c1">'thinkster.authentication.controllers',</span>
<span class="w">    </span><span class="c1">'thinkster.authentication.services'</span>
<span class="w">  </span><span class="p">]);</span>
</pre></div><p>This syntax defines the module <code>thinkster.authentication</code> with <code>thinkster.authentication.controllers</code> and <code>thinkster.authentication.services</code> as dependencies.</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.authentication.controllers', []);</span>
</pre></div><p>This syntax defines the module <code>thinkster.authentication.controllers</code> with no dependencies.</p><p>Now we need define to include <code>thinkster.authentication</code> and <code>thinkster.routes</code> as dependencies of <code>thinkster</code>.</p><p>Open <code>static/javascripts/thinkster.js</code>, define the required modules, and include them as dependencies of the <code>thinkster</code> module. Note that <code>thinkster.routes</code> relies on <code>ngRoute</code>, which is included with the boilerplate project.</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster', [</span>
<span class="w">      </span><span class="c1">'thinkster.routes',</span>
<span class="w">      </span><span class="c1">'thinkster.authentication'</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.routes', ['ngRoute']);</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_thinkster_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Update the \u003ccode\u003ethinkster\u003c/code\u003e module to include it\u0026#39;s new dependencies&quot;}"/>
<h2 id="hash-routing">Hash routing</h2>
<p>By default, Angular uses a feature called hash routing. If you've ever seen a URL that looks like <code>www.google.com/#/search</code> then you know what I'm talking about. Again, this is personal preference, but I think those are incredibly ugly. To get rid of hash routing, we can enabled <code>$locationProvider.html5Mode</code>. In older browsers that do not support HTML5 routing, Angular will intelligently fall back to hash routing.</p><p>Create a file in <code>static/javascripts/</code> called <code>thinkster.config.js</code> and give it the following content:</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.config')</span>
<span class="w">    </span><span class="o">.</span><span class="vg">config</span><span class="p">(</span><span class="vg">config</span><span class="p">);</span>

<span class="w">  </span><span class="vg">config</span><span class="o">.</span><span class="err">$</span><span class="vg">inject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="c1">'$locationProvider'];</span>

<span class="w">  </span><span class="o">/**</span>
<span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">name</span><span class="w"> </span><span class="vg">config</span>
<span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">desc</span><span class="w"> </span><span class="vg">Enable</span><span class="w"> </span><span class="vg">HTML5</span><span class="w"> </span><span class="vg">routing</span>
<span class="w">  </span><span class="o">*/</span>
<span class="w">  </span><span class="vg">function</span><span class="w"> </span><span class="vg">config</span><span class="p">(</span><span class="err">$</span><span class="vg">locationProvider</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">$</span><span class="vg">locationProvider</span><span class="o">.</span><span class="vg">html5Mode</span><span class="p">(</span><span class="vg">true</span><span class="p">);</span>
<span class="w">    </span><span class="err">$</span><span class="vg">locationProvider</span><span class="o">.</span><span class="vg">hashPrefix</span><span class="p">(</span><span class="c1">'!');</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_html5mode_config&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Enable HTML5 routing for AngularJS&quot;}"/><p>As mentioned, enabling <code>$locationProvider.html5Mode</code> gets rid of the hash sign in the URL. The other setting here, <code>$locationProvider.hashPrefix</code>, turns the <code>#</code> into a <code>#!</code>. This is mostly for the benefit of search engines.</p><p>Because we are using a new module here, we need to open up <code>static/javascripts/thinkster.js</code>, define the module, and include is as a dependency for the <code>thinkster</code> module.</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster', [</span>
<span class="w">    </span><span class="c1">'thinkster.config',</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="w">  </span><span class="p">]);</span>

<span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.config', []);</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_config_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Define the \u003ccode\u003ethinkster.config\u003c/code\u003e module&quot;}"/>
<h2 id="include-new-js-files">Include new .js files</h2>
<p>In this chapter so far, we have already created a number of new JavaScript files. We need to include these in the client by adding them to <code>templates/javascripts.html</code> inside the <code>{% compress js %}</code> block.</p><p>Open <code>templates/javascripts.html</code> and add the following above the <code>{% endcompress %}</code> tag:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/thinkster.config.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/thinkster.routes.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/authentication/authentication.module.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/authentication/services/authentication.service.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/authentication/controllers/register.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_javascripts&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add the new JavaScript files to \u003ccode\u003etemplates/javascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="handling-csrf-protection">Handling CSRF protection</h2>
<p>Because we are using session-based authentication, we have to worry about CSRF protection. We don't go into detail on CSRF here because it's outside the scope of this tutorial, but suffice it to say that CSRF is very bad.</p><p>Django, by default, stores a CSRF token in a cookie named <code>csrftoken</code> and expects a header with the name <code>X-CSRFToken</code> for any dangerous HTTP request (<code>POST</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>). We can easily configure Angular to handle this.</p><p>Open up <code>static/javascripts/thinkster.js</code> and add the following under your module definitions:</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster')</span>
<span class="w">  </span><span class="o">.</span><span class="vg">run</span><span class="p">(</span><span class="vg">run</span><span class="p">);</span>

<span class="vg">run</span><span class="o">.</span><span class="err">$</span><span class="vg">inject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="c1">'$http'];</span>

<span class="o">/**</span>
<span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">name</span><span class="w"> </span><span class="vg">run</span>
<span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">desc</span><span class="w"> </span><span class="vg">Update</span><span class="w"> </span><span class="vg">xsrf</span><span class="w"> </span><span class="err">$</span><span class="vg">http</span><span class="w"> </span><span class="vg">headers</span><span class="w"> </span><span class="vg">to</span><span class="w"> </span><span class="vg">align</span><span class="w"> </span><span class="vg">with</span><span class="w"> </span><span class="vg">Django</span><span class="c1">'s defaults</span>
<span class="o">*/</span>
<span class="vg">function</span><span class="w"> </span><span class="vg">run</span><span class="p">(</span><span class="err">$</span><span class="vg">http</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">$</span><span class="vg">http</span><span class="o">.</span><span class="vg">defaults</span><span class="o">.</span><span class="vg">xsrfHeaderName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">'X-CSRFToken';</span>
<span class="w">  </span><span class="err">$</span><span class="vg">http</span><span class="o">.</span><span class="vg">defaults</span><span class="o">.</span><span class="vg">xsrfCookieName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">'csrftoken';</span>
<span class="p">}</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_run_csrf&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Configure AngularJS CSRF settings&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>Try registering a new user by running your server (<code>python manage.py runserver</code>), visiting <code>http://localhost:8000/register</code> in your browser and filling out the form.</p><p>If the registration worked, you can view the new <code>Account</code> object created by opening the shell (<code>python manage.py shell</code>) and running the following commands:</p><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">authentication.models</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'created_at'</span><span class="p">)</span>
</pre></div><p>The <code>Account</code> object returned should match the one you just created.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_register_account&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Register a new user at \u003ccode\u003ehttp://localhost:8000/register\u003c/code\u003e and confirm the \u003ccode\u003eAccount\u003c/code\u003e object was created&quot;}"/></div><div class="course-section" id="logging-users-in"><h1>Logging users in</h1><p>Now that users can register, they need a way to log in. As it turns out, this is part of what we are missing from our registration system. Once a user registers, we should automatically log them in.</p><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;log-user-in&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/a53f308550818ae11d1b7c8569f46ea6da05fe17.jpg&quot;}"/><p>To get started, we will create views for logging in and logging out. Once those are done we will progress in a fashion similar to the registration systems: services, controllers, etc.</p>
<h2 id="making-the-login-api-view">Making the login API view</h2>
<p>Open up <code>authentication/views.py</code> and add the following:</p><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span>

<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">status</span><span class="p">,</span> <span class="n">views</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">views</span><span class="o">.</span><span class="n">APIView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

        <span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'email'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'password'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="n">account</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
                <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>

                <span class="n">serialized</span> <span class="o">=</span> <span class="n">AccountSerializer</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serialized</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
                    <span class="s">'status'</span><span class="p">:</span> <span class="s">'Unauthorized'</span><span class="p">,</span>
                    <span class="s">'message'</span><span class="p">:</span> <span class="s">'This account has been disabled.'</span>
                <span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
                <span class="s">'status'</span><span class="p">:</span> <span class="s">'Unauthorized'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="s">'Username/password combination invalid.'</span>
            <span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_login_view&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a view called \u003ccode\u003eLoginView\u003c/code\u003e in \u003ccode\u003eauthentication/views.py\u003c/code\u003e&quot;}"/><p>This is a longer snippet than we've seen in the past, but we will approach it the same way: by talking about what's new and ignoring what we have already encountered.</p><div class="highlight"><pre><span class="w"> </span><span class="vg">class</span><span class="w"> </span><span class="vg">LoginView</span><span class="p">(</span><span class="vg">views</span><span class="o">.</span><span class="vg">APIView</span><span class="p">)</span><span class="o">:</span>
</pre></div><p>You will notice that we are not using a generic view this time. Because this view does not perfect a generic activity like creating or updating an object, we must start with something more basic. Django REST Framework's <code>views.APIView</code> is what we use. While <code>APIView</code> does not handle everything for us, it does give us much more than standard Django views do. In particular, <code>views.APIView</code> are made specifically to handle AJAX requests. This turns out to save us a lot of time.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">post</span><span class="p">(</span><span class="vg">self</span><span class="p">,</span><span class="w"> </span><span class="vg">request</span><span class="p">,</span><span class="w"> </span><span class="vg">format</span><span class="o">=</span><span class="vg">None</span><span class="p">)</span><span class="o">:</span>
</pre></div><p>Unlike generic views, we must handle each HTTP verb ourselves. Logging in should typically be a <code>POST</code> request, so we override the <code>self.post()</code> method.</p><div class="highlight"><pre><span class="vg">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">authenticate</span><span class="p">(</span><span class="vg">email</span><span class="o">=</span><span class="vg">email</span><span class="p">,</span><span class="w"> </span><span class="vg">password</span><span class="o">=</span><span class="vg">password</span><span class="p">)</span>
</pre></div><p>Django provides a nice set of utilities for authenticating users. The <code>authenticate()</code> method is the first utility we will cover. <code>authenticate()</code> takes an email and a password. Django then checks the database for an <code>Account</code> with email <code>email</code>. If one is found, Django will try to verify the given password. If the username and password are correct, the <code>Account</code> found by <code>authenticate()</code> is returned. If either of these steps fail, <code>authenticate()</code> will return <code>None</code>.</p><div class="highlight"><pre><span class="vg">if</span><span class="w"> </span><span class="vg">account</span><span class="w"> </span><span class="vg">is</span><span class="w"> </span><span class="vg">not</span><span class="w"> </span><span class="nl">None:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">...</span>
<span class="nl">else:</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">Response</span><span class="p">({</span>
<span class="w">        </span><span class="c1">'status': 'Unauthorized',</span>
<span class="w">        </span><span class="c1">'message': 'Username/password combination invalid.'</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="vg">status</span><span class="o">=</span><span class="vg">status</span><span class="o">.</span><span class="vg">HTTP_401_UNAUTHORIZED</span><span class="p">)</span>
</pre></div><p>In the event that <code>authenticate()</code> returns <code>None</code>, we respond with a <code>401</code> status code and tell the user that the email/password combination they provided is invalid.</p><div class="highlight"><pre><span class="vg">if</span><span class="w"> </span><span class="vg">account</span><span class="o">.</span><span class="nl">is_active:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">...</span>
<span class="nl">else:</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">Response</span><span class="p">({</span>
<span class="w">        </span><span class="c1">'status': 'Unauthorized',</span>
<span class="w">        </span><span class="c1">'message': 'This account has been disabled.'</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="vg">status</span><span class="o">=</span><span class="vg">status</span><span class="o">.</span><span class="vg">HTTP_401_UNAUTHORIZED</span><span class="p">)</span>
</pre></div><p>If the user's account is for some reason inactivate, we respond with a <code>401</code> status code. Here we simply say that the account has been disabled.</p><p>If <code>authenticate()</code> success and the user is active, then we use Django's <code>login()</code> utility to create a new session for this user.</p><div class="highlight"><pre><span class="vg">serialized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">AccountSerializer</span><span class="p">(</span><span class="vg">account</span><span class="p">)</span>

<span class="vg">return</span><span class="w"> </span><span class="vg">Response</span><span class="p">(</span><span class="vg">serialized</span><span class="o">.</span><span class="vg">data</span><span class="p">)</span>
</pre></div><p>We want to store some information about this user in the browser if the login request succeeds, so we serialize the <code>Account</code> object found by <code>authenticate()</code> and return the resulting JSON as the response.</p>
<h2 id="adding-a-login-api-endpoint">Adding a login API endpoint</h2>
<p>Just as we did with <code>AccountViewSet</code>, we need to add a route for <code>LoginView</code>.</p><p>Open up <code>thinkster_django_angular_boilerplate/urls.py</code> and add the following URL between <code>^/api/v1/</code> and <code>^</code>:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">authentication.views</span> <span class="kn">import</span> <span class="n">LoginView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
    <span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api/v1/auth/login/$'</span><span class="p">,</span> <span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'login'</span><span class="p">),</span>
    <span class="c"># ...</span>
<span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;url_login&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add an API endpoint for \u003ccode\u003eLoginView\u003c/code\u003e&quot;}"/>
<h2 id="authentication-service">Authentication Service</h2>
<p>Let's add some more methods to our <code>Authentication</code> service. We will do this in two stages. First we will add a <code>login()</code> method and then we will add some utility methods for storing session data in the browser.</p><p>Open <code>static/javascripts/authentication/services/authentication.service.js</code> and add the following method to the <code>Authentication</code> object we created earlier:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name login</span>
<span class="cm"> * @desc Try to log in with email `email` and password `password`</span>
<span class="cm"> * @param {string} email The email entered by the user</span>
<span class="cm"> * @param {string} password The password entered by the user</span>
<span class="cm"> * @returns {Promise}</span>
<span class="cm"> * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">post</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">login</span><span class="o">/</span><span class="p">',</span> <span class="p">{</span>
    <span class="nl">email:</span> <span class="n">email</span><span class="p">,</span> <span class="nl">password:</span> <span class="n">password</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div><p>Make sure to expose it as part of the service:</p><div class="highlight"><pre><span class="vg">var</span><span class="w"> </span><span class="vg">Authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">login:</span><span class="w"> </span><span class="vg">login</span><span class="p">,</span>
<span class="w">  </span><span class="nl">register:</span><span class="w"> </span><span class="vg">register</span>
<span class="p">};</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_authentication_service_login&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add a \u003ccode\u003elogin\u003c/code\u003e method to your \u003ccode\u003eAuthentication\u003c/code\u003e service&quot;}"/><p>Much like the <code>register()</code> method from before, <code>login()</code> returns makes an AJAX request to our API and returns a promise.</p><p>Now let's talk about a few utility methods we need for managing session information on the client.</p><p>We want to display information about the currently authenticated user in the navigation bar at the top of the page. This means we will need a way to store the response returned by <code>login()</code>. We will also need a way to retrieve the authenticated user. We need need a way to unauthenticate the user in the browser. Finally, it would be nice to have an easy way to check if the current user is authenticated.</p><p><em>NOTE: Unauthenticating is different from logging out. When a user logs out, we need a way to remove all remaining session data from the client.</em></p><p>Given these requirements, I suggest three methods: <code>getAuthenticatedAccount</code>, <code>isAuthenticated</code>, <code>setAuthenticatedAccount</code>, and <code>unauthenticate</code>.</p><p>Let's implement these now. Add each of the following functions to the <code>Authentication</code> service:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name getAuthenticatedAccount</span>
<span class="cm"> * @desc Return the currently authenticated account</span>
<span class="cm"> * @returns {object|undefined} Account if authenticated, else `undefined`</span>
<span class="cm"> * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">getAuthenticatedAccount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="err">$</span><span class="n">cookies</span><span class="p">.</span><span class="n">authenticatedAccount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="no">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="err">$</span><span class="n">cookies</span><span class="p">.</span><span class="n">authenticatedAccount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><p>If there is no <code>authenticatedAccount</code> cookie (set in <code>setAuthenticatedAccount()</code>), then return; otherwise return the parsed user object from the cookie.</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name isAuthenticated</span>
<span class="cm"> * @desc Check if the current user is authenticated</span>
<span class="cm"> * @returns {boolean} True is user is authenticated, else false.</span>
<span class="cm"> * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">isAuthenticated</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">!!</span><span class="err">$</span><span class="n">cookies</span><span class="p">.</span><span class="n">authenticatedAccount</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>Return the boolean value of the <code>authenticatedAccount</code> cookie. </p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name setAuthenticatedAccount</span>
<span class="cm"> * @desc Stringify the account object and store it in a cookie</span>
<span class="cm"> * @param {Object} user The account object to be stored</span>
<span class="cm"> * @returns {undefined}</span>
<span class="cm"> * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">setAuthenticatedAccount</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="p">{</span>
  <span class="err">$</span><span class="n">cookies</span><span class="p">.</span><span class="n">authenticatedAccount</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">account</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><p>Set the <code>authenticatedAccount</code> cookie to a stringified version of the <code>account</code> object.</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name unauthenticate</span>
<span class="cm"> * @desc Delete the cookie where the user object is stored</span>
<span class="cm"> * @returns {undefined}</span>
<span class="cm"> * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">unauthenticate</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">delete</span> <span class="err">$</span><span class="n">cookies</span><span class="p">.</span><span class="n">authenticatedAccount</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>Remove the <code>authenticatedAccount</code> cookie.</p><p>Again, don't forget to expose these methods as part of the service:</p><div class="highlight"><pre><span class="vg">var</span><span class="w"> </span><span class="vg">Authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">getAuthenticatedAccount:</span><span class="w"> </span><span class="vg">getAuthenticatedAccount</span><span class="p">,</span>
<span class="w">  </span><span class="nl">isAuthenticated:</span><span class="w"> </span><span class="vg">isAuthenticated</span><span class="p">,</span>
<span class="w">  </span><span class="nl">login:</span><span class="w"> </span><span class="vg">login</span><span class="p">,</span>
<span class="w">  </span><span class="nl">register:</span><span class="w"> </span><span class="vg">register</span><span class="p">,</span>
<span class="w">  </span><span class="nl">setAuthenticatedAccount:</span><span class="w"> </span><span class="vg">setAuthenticatedAccount</span><span class="p">,</span>
<span class="w">  </span><span class="nl">unauthenticate:</span><span class="w"> </span><span class="vg">unauthenticate</span>
<span class="p">};</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_authentication_service_utilities&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add \u003ccode\u003egetAuthenticatedAccount\u003c/code\u003e, \u003ccode\u003eisAuthenticated\u003c/code\u003e, \u003ccode\u003esetAuthenticatedAccount\u003c/code\u003e, and \u003ccode\u003eunauthenticate\u003c/code\u003e methods to your \u003ccode\u003eAuthentication\u003c/code\u003e service&quot;}"/><p>Before we move on to the login interface, let's quickly update the <code>login</code> method of the <code>Authentication</code> service to use one of these new utility methods. Replace <code>Authentication.login</code> with the following:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name login</span>
<span class="cm"> * @desc Try to log in with email `email` and password `password`</span>
<span class="cm"> * @param {string} email The email entered by the user</span>
<span class="cm"> * @param {string} password The password entered by the user</span>
<span class="cm"> * @returns {Promise}</span>
<span class="cm"> * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">post</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">login</span><span class="o">/</span><span class="p">',</span> <span class="p">{</span>
    <span class="nl">email:</span> <span class="n">email</span><span class="p">,</span> <span class="nl">password:</span> <span class="n">password</span>
  <span class="p">}).</span><span class="n">then</span><span class="p">(</span><span class="n">loginSuccessFn</span><span class="p">,</span> <span class="n">loginErrorFn</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">   * @name loginSuccessFn</span>
<span class="cm">   * @desc Set the authenticated account and redirect to index</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">loginSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Authentication</span><span class="p">.</span><span class="n">setAuthenticatedAccount</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>

    <span class="n">window</span><span class="p">.</span><span class="n">location</span> <span class="o">=</span> <span class="sc">'/'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * @name loginErrorFn</span>
<span class="cm">   * @desc Log "Epic failure!" to the console</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">loginErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">Epic</span> <span class="n">failure</span><span class="o">!</span><span class="p">');</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;update_authentication_login&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Update \u003ccode\u003eAuthentication.login\u003c/code\u003e to use our new utility methods&quot;}"/>
<h2 id="making-a-login-interface">Making a login interface</h2>
<p>We now have <code>Authentication.login()</code> to log a user in, so let's create the login form. Open up <code>static/templates/authentication/login.html</code> and add the following HTML:</p><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4 col-md-offset-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Login<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"well"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">role=</span><span class="s">"form"</span> <span class="na">ng-submit=</span><span class="s">"vm.login()"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">ng-show=</span><span class="s">"error"</span> <span class="na">ng-bind=</span><span class="s">"error"</span><span class="nt">&gt;&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"login__email"</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"login__email"</span> <span class="na">ng-model=</span><span class="s">"vm.email"</span> <span class="na">placeholder=</span><span class="s">"ex. john@example.com"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"login__password"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"login__password"</span> <span class="na">ng-model=</span><span class="s">"vm.password"</span> <span class="na">placeholder=</span><span class="s">"ex. thisisnotgoogleplus"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_login_template&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a \u003ccode\u003elogin.html\u003c/code\u003e template&quot;}"/>
<h2 id="controlling-the-login-interface-with-logincontroller">Controlling the login interface with LoginController</h2>
<p>Create a file in <code>static/javascripts/authentication/controllers/</code> called <code>login.controller.js</code> and add the following contents:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* LoginController</span>
<span class="cm">* @namespace thinkster.authentication.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">authentication</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">LoginController</span><span class="p">',</span> <span class="n">LoginController</span><span class="p">);</span>

  <span class="n">LoginController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">location</span><span class="p">',</span> <span class="p">'</span><span class="err">$</span><span class="n">scope</span><span class="p">',</span> <span class="p">'</span><span class="n">Authentication</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace LoginController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">LoginController</span><span class="p">(</span><span class="err">$</span><span class="n">location</span><span class="p">,</span> <span class="err">$</span><span class="n">scope</span><span class="p">,</span> <span class="n">Authentication</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">login</span> <span class="o">=</span> <span class="n">login</span><span class="p">;</span>

    <span class="n">activate</span><span class="p">();</span>

    <span class="cm">/**</span>
<span class="cm">    * @name activate</span>
<span class="cm">    * @desc Actions to be performed when this controller is instantiated</span>
<span class="cm">    * @memberOf thinkster.authentication.controllers.LoginController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">activate</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// If the user is authenticated, they should not be here.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">Authentication</span><span class="p">.</span><span class="n">isAuthenticated</span><span class="p">())</span> <span class="p">{</span>
        <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @name login</span>
<span class="cm">    * @desc Log the user in</span>
<span class="cm">    * @memberOf thinkster.authentication.controllers.LoginController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">login</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Authentication</span><span class="p">.</span><span class="n">login</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">email</span><span class="p">,</span> <span class="n">vm</span><span class="p">.</span><span class="n">password</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_login_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a controller called \u003ccode\u003eLoginController\u003c/code\u003e in \u003ccode\u003estatic/javascripts/authentication/controllers/login.controller.js\u003c/code\u003e&quot;}"/><p>Let's look at the <code>activate</code> function.</p><div class="highlight"><pre><span class="vg">function</span><span class="w"> </span><span class="vg">activate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="vg">If</span><span class="w"> </span><span class="vg">the</span><span class="w"> </span><span class="vg">user</span><span class="w"> </span><span class="vg">is</span><span class="w"> </span><span class="vg">authenticated</span><span class="p">,</span><span class="w"> </span><span class="vg">they</span><span class="w"> </span><span class="vg">should</span><span class="w"> </span><span class="vg">not</span><span class="w"> </span><span class="vg">be</span><span class="w"> </span><span class="vg">here</span><span class="o">.</span>
<span class="w">  </span><span class="vg">if</span><span class="w"> </span><span class="p">(</span><span class="vg">Authentication</span><span class="o">.</span><span class="vg">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">$</span><span class="vg">location</span><span class="o">.</span><span class="vg">url</span><span class="p">(</span><span class="c1">'/');</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div><p>You will start to notice that we use a function called <code>activate</code> a lot throughout this tutorial. There is nothing inherently special about this name; we chose a standard name for the function that will be run when any given controller is instantiated.</p><p>As the comment suggests, if a user is already authenticated, they have no business on the login page. We solve this by redirecting the user to the index page. </p><p>We should do this on the registration page too. When we wrote the registration controller, we didn't have <code>Authentication.isAuthenticated()</code>. We will update <code>RegisterController</code> shortly.</p>
<h2 id="back-to-registercontroller">Back to RegisterController</h2>
<p>Taking a step back, let's add a check to <code>RegisterController</code> and redirect the user if they are already authenticated.</p><p>Open <code>static/javascripts/authentication/controllers/register.controller.js</code> and add the following just inside the definition of the controller:</p><div class="highlight"><pre><span class="vg">activate</span><span class="p">();</span>

<span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">name</span><span class="w"> </span><span class="vg">activate</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">desc</span><span class="w"> </span><span class="vg">Actions</span><span class="w"> </span><span class="vg">to</span><span class="w"> </span><span class="vg">be</span><span class="w"> </span><span class="vg">performed</span><span class="w"> </span><span class="vg">when</span><span class="w"> </span><span class="vg">this</span><span class="w"> </span><span class="vg">controller</span><span class="w"> </span><span class="vg">is</span><span class="w"> </span><span class="vg">instantiated</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="vg">memberOf</span><span class="w"> </span><span class="vg">thinkster</span><span class="o">.</span><span class="vg">authentication</span><span class="o">.</span><span class="vg">controllers</span><span class="o">.</span><span class="vg">RegisterController</span>
<span class="w"> </span><span class="o">*/</span>
<span class="vg">function</span><span class="w"> </span><span class="vg">activate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="vg">If</span><span class="w"> </span><span class="vg">the</span><span class="w"> </span><span class="vg">user</span><span class="w"> </span><span class="vg">is</span><span class="w"> </span><span class="vg">authenticated</span><span class="p">,</span><span class="w"> </span><span class="vg">they</span><span class="w"> </span><span class="vg">should</span><span class="w"> </span><span class="vg">not</span><span class="w"> </span><span class="vg">be</span><span class="w"> </span><span class="vg">here</span><span class="o">.</span>
<span class="w">  </span><span class="vg">if</span><span class="w"> </span><span class="p">(</span><span class="vg">Authentication</span><span class="o">.</span><span class="vg">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">$</span><span class="vg">location</span><span class="o">.</span><span class="vg">url</span><span class="p">(</span><span class="c1">'/');</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_register_controller_auth&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Redirect authenticated users to the index view in \u003ccode\u003eRegisterController\u003c/code\u003e&quot;}"/><p>If you remember, we also talked about logging a user in automatically when they register. Since we are already updating registration related content, let's update the <code>register</code> method in the <code>Authentication</code> service.</p><p>Replace <code>Authentication.register</code> when the following:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* @name register</span>
<span class="cm">* @desc Try to register a new user</span>
<span class="cm">* @param {string} email The email entered by the user</span>
<span class="cm">* @param {string} password The password entered by the user</span>
<span class="cm">* @param {string} username The username entered by the user</span>
<span class="cm">* @returns {Promise}</span>
<span class="cm">* @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm">*/</span>
<span class="k">function</span> <span class="n">register</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">post</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="p">',</span> <span class="p">{</span>
    <span class="nl">username:</span> <span class="n">username</span><span class="p">,</span>
    <span class="nl">password:</span> <span class="n">password</span><span class="p">,</span>
    <span class="nl">email:</span> <span class="n">email</span>
  <span class="p">}).</span><span class="n">then</span><span class="p">(</span><span class="n">registerSuccessFn</span><span class="p">,</span> <span class="n">registerErrorFn</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">  * @name registerSuccessFn</span>
<span class="cm">  * @desc Log the new user in</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">registerSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Authentication</span><span class="p">.</span><span class="n">login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">  * @name registerErrorFn</span>
<span class="cm">  * @desc Log "Epic failure!" to the console</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">registerErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">Epic</span> <span class="n">failure</span><span class="o">!</span><span class="p">');</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_register_controller_login&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Update \u003ccode\u003eAuthentication.register\u003c/code\u003e&quot;}"/>
<h2 id="making-a-route-for-the-login-interface">Making a route for the login interface</h2>
<p>The next step is to create the client-side route for the login form.</p><p>Open up <code>static/javascripts/thinkster.routes.js</code> and add a route for the login form:</p><div class="highlight"><pre><span class="err">$</span><span class="vg">routeProvider</span><span class="o">.</span><span class="vg">when</span><span class="p">(</span><span class="c1">'/register', {</span>
<span class="w">  </span><span class="nl">controller:</span><span class="w"> </span><span class="c1">'RegisterController', </span>
<span class="w">  </span><span class="nl">controllerAs:</span><span class="w"> </span><span class="c1">'vm',</span>
<span class="w">  </span><span class="nl">templateUrl:</span><span class="w"> </span><span class="c1">'/static/templates/authentication/register.html'</span>
<span class="p">})</span><span class="o">.</span><span class="vg">when</span><span class="p">(</span><span class="c1">'/login', {</span>
<span class="w">  </span><span class="nl">controller:</span><span class="w"> </span><span class="c1">'LoginController',</span>
<span class="w">  </span><span class="nl">controllerAs:</span><span class="w"> </span><span class="c1">'vm',</span>
<span class="w">  </span><span class="nl">templateUrl:</span><span class="w"> </span><span class="c1">'/static/templates/authentication/login.html'</span>
<span class="p">})</span><span class="o">.</span><span class="vg">otherwise</span><span class="p">(</span><span class="c1">'/');</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_login_route&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add a route for \u003ccode\u003eLoginController\u003c/code\u003e&quot;}"/><p>{info}
See how you can chain calls to <code>$routeProvider.when()</code>? Going forward, we will ignore old routes for brevity. Just keep in mind that these calls should be chained and that the first route matched will take control.</p>
<h2 id="include-new-js-files">Include new .js files</h2>
<p>If you can believe it, we've only created one new JavaScript file since the last time: <code>login.controller.js</code>. Let's add it to <code>javascripts.html</code> with the other JavaScript files:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/authentication/controllers/login.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_javascripts_login&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003elogin.controller.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>Open <code>http://localhost:8000/login</code> in your browser and log in with the user you created earlier. If this works, the page should redirect to <code>http://localhost:8000/</code> and the navigation bar should change.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_login&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Log in with one of the users you created earlier by visiting \u003ccode\u003ehttp://localhost:8000/login\u003c/code\u003e&quot;}"/></div><div class="course-section" id="logging-users-out"><h1>Logging users out</h1><p>Given that users can register and login, we can assume they will want a way to log out. People get mad when they can't log out.</p><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;log-user-out&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/4537683f7eb97a4d8ba3b1c082da03acbaeb23cd.jpg&quot;}"/>
<h2 id="making-a-logout-api-view">Making a logout API view</h2>
<p>Let's implement the last authentication-related API view.</p><p>Open up <code>authentication/views.py</code> and add the following imports and class:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">logout</span>

<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span>

<span class="k">class</span> <span class="nc">LogoutView</span><span class="p">(</span><span class="n">views</span><span class="o">.</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">({},</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_logout_view&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a view called \u003ccode\u003eLogoutView\u003c/code\u003e in \u003ccode\u003eauthentication/views.py\u003c/code\u003e&quot;}"/><p>There are only a few new things to talk about this time.</p><div class="highlight"><pre><span class="vg">permission_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="vg">permissions</span><span class="o">.</span><span class="vg">IsAuthenticated</span><span class="p">,)</span>
</pre></div><p>Only authenticated users should be able to hit this endpoint. Django REST Framework's <code>permissions.IsAuthenticated</code> handles this for us. If you user is not authenticated, they will get a <code>403</code> error.</p><p>If the user is authenticated, all we need to do is call Django's <code>logout()</code> method.</p><div class="highlight"><pre><span class="vg">return</span><span class="w"> </span><span class="vg">Response</span><span class="p">({},</span><span class="w"> </span><span class="vg">status</span><span class="o">=</span><span class="vg">status</span><span class="o">.</span><span class="vg">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</pre></div><p>There isn't anything reasonable to return when logging out, so we just return an empty response with a <code>200</code> status code.</p><p>Moving on to the URLs.</p><p>Open up <code>thinkster_django_angular_boilerplate/urls.py</code> again and add the following import and URL:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">authentication.views</span> <span class="kn">import</span> <span class="n">LogoutView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
    <span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api/v1/auth/logout/$'</span><span class="p">,</span> <span class="n">LogoutView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'logout'</span><span class="p">),</span>
    <span class="c">#...</span>
<span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_url_logout&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create an API endpoint for \u003ccode\u003eLogoutView\u003c/code\u003e&quot;}"/>
<h2 id="logout-angularjs-service">Logout: AngularJS Service</h2>
<p>The final method you need to add to your <code>Authentication</code> service is the <code>logout()</code> method.</p><p>Add the following method to the <code>Authentication</code> service in <code>authentication.service.js</code>:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name logout</span>
<span class="cm"> * @desc Try to log the user out</span>
<span class="cm"> * @returns {Promise}</span>
<span class="cm"> * @memberOf thinkster.authentication.services.Authentication</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">logout</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">post</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">logout</span><span class="o">/</span><span class="p">')</span>
    <span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">logoutSuccessFn</span><span class="p">,</span> <span class="n">logoutErrorFn</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">   * @name logoutSuccessFn</span>
<span class="cm">   * @desc Unauthenticate and redirect to index with page reload</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">logoutSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Authentication</span><span class="p">.</span><span class="n">unauthenticate</span><span class="p">();</span>

    <span class="n">window</span><span class="p">.</span><span class="n">location</span> <span class="o">=</span> <span class="sc">'/'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * @name logoutErrorFn</span>
<span class="cm">   * @desc Log "Epic failure!" to the console</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">logoutErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">Epic</span> <span class="n">failure</span><span class="o">!</span><span class="p">');</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><p>As always, remember to expose <code>logout</code> as part of the <code>Authentication</code> service:</p><div class="highlight"><pre><span class="vg">var</span><span class="w"> </span><span class="vg">Authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">getAuthenticatedUser:</span><span class="w"> </span><span class="vg">getAuthenticatedUser</span><span class="p">,</span>
<span class="w">  </span><span class="nl">isAuthenticated:</span><span class="w"> </span><span class="vg">isAuthenticated</span><span class="p">,</span>
<span class="w">  </span><span class="nl">login:</span><span class="w"> </span><span class="vg">login</span><span class="p">,</span>
<span class="w">  </span><span class="nl">logout:</span><span class="w"> </span><span class="vg">logout</span><span class="p">,</span>
<span class="w">  </span><span class="nl">register:</span><span class="w"> </span><span class="vg">register</span><span class="p">,</span>
<span class="w">  </span><span class="nl">setAuthenticatedUser:</span><span class="w"> </span><span class="vg">setAuthenticatedUser</span><span class="p">,</span>
<span class="w">  </span><span class="nl">unauthenticate:</span><span class="w"> </span><span class="vg">unauthenticate</span>
<span class="p">};</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_authentication_service_logout&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add a \u003ccode\u003elogout()\u003c/code\u003e method to your \u003ccode\u003eAuthentication\u003c/code\u003e service&quot;}"/>
<h2 id="controlling-the-navigation-bar-with-navbarcontroller">Controlling the navigation bar with NavbarController</h2>
<p>There will not actually be a <code>LogoutController</code> or <code>logout.html</code>. Instead, the navigation bar already contains a logout link for authenticated users. We will create a <code>NavbarController</code> for handling the logout buttons <code>onclick</code> functionality and we will update the link itself with an <code>ng-click</code> attribute.</p><p>Create a file in <code>static/javascripts/layout/controllers/</code> called <code>navbar.controller.js</code> and add the following to it:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* NavbarController</span>
<span class="cm">* @namespace thinkster.layout.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">NavbarController</span><span class="p">',</span> <span class="n">NavbarController</span><span class="p">);</span>

  <span class="n">NavbarController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">scope</span><span class="p">',</span> <span class="p">'</span><span class="n">Authentication</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace NavbarController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">NavbarController</span><span class="p">(</span><span class="err">$</span><span class="n">scope</span><span class="p">,</span> <span class="n">Authentication</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">logout</span> <span class="o">=</span> <span class="n">logout</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">    * @name logout</span>
<span class="cm">    * @desc Log the user out</span>
<span class="cm">    * @memberOf thinkster.layout.controllers.NavbarController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">logout</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Authentication</span><span class="p">.</span><span class="n">logout</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_navbar_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a \u003ccode\u003eNavbarController\u003c/code\u003e in \u003ccode\u003estatic/javascripts/layout/controllers/navbar.controller.js\u003c/code\u003e&quot;}"/><p>Open <code>templates/navbar.html</code> and add an <code>ng-controller</code> directive with the value <code>NavbarController as vm</code> to the <code>&lt;nav /&gt;</code> tag like so:</p><div class="highlight"><pre><span class="o">&lt;</span><span class="vg">nav</span><span class="w"> </span><span class="vg">class</span><span class="o">=</span><span class="s2">"navbar navbar-default"</span><span class="w"> </span><span class="vg">role</span><span class="o">=</span><span class="s2">"navigation"</span><span class="w"> </span><span class="vg">ng</span><span class="o">-</span><span class="vg">controller</span><span class="o">=</span><span class="s2">"NavbarController as vm"</span><span class="o">&gt;</span>
</pre></div><p>While you have <code>templates/navbar.html</code> open, go ahead and find the logout link and add <code>ng-click="vm.logout()"</code> to it like so:</p><div class="highlight"><pre><span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"javascript:void(0)"</span> <span class="na">ng-click=</span><span class="s">"vm.logout()"</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_navbar_template_update&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Update \u003ccode\u003enavbar.html\u003c/code\u003e to include the \u003ccode\u003eng-controller\u003c/code\u003e and \u003ccode\u003eng-click\u003c/code\u003e directives where appropriate&quot;}"/>
<h2 id="layout-modules">Layout modules</h2>
<p>We need to add a few new modules this time around.</p><p>Create a file in <code>static/javascripts/layout/</code> called <code>layout.module.js</code> and give it the following contents:</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.layout', [</span>
<span class="w">      </span><span class="c1">'thinkster.layout.controllers'</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.layout.controllers', []);</span>
<span class="p">})();</span>
</pre></div><p>And don't forget to update <code>static/javascripts/thinkster.js</code> also:</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster', [</span>
<span class="w">    </span><span class="c1">'thinkster.config',</span>
<span class="w">    </span><span class="c1">'thinkster.routes',</span>
<span class="w">    </span><span class="c1">'thinkster.authentication',</span>
<span class="w">    </span><span class="c1">'thinkster.layout'</span>
<span class="w">  </span><span class="p">]);</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_static_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Define new \u003ccode\u003ethinkster.layout\u003c/code\u003e and \u003ccode\u003ethinkster.layout.controllers\u003c/code\u003e modules&quot;}"/>
<h2 id="including-new-js-files">Including new .js files</h2>
<p>This time around there are a couple new JavaScript files to include. Open up <code>javascripts.html</code> and add the following:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/layout/layout.module.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/layout/controllers/navbar.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;include_javascript_static&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include new JavaScript files in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>If you visit <code>http://localhost:8000/</code> in your browser, you should still be logged in. If not, you will need to log in again.</p><p>You can confirm the logout functionality is working by clicking the logout button in the navigation bar. This should refresh the page and update the navigation bar to it's logged out view.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_logout&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Log out of your account by using the logout button in the navigation bar&quot;}"/></div><div class="course-section" id="making-a-post-model"><h1>Making a Post model</h1><p>In this section we will make a new app and create a <code>Post</code> model similar to a status on Facebook or a tweet on Twitter. After we create our model we will move on to serializing <code>Post</code>s and then we will create a few new endpoints for our API.</p><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;making-post-model&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/afc3e2826b2edd66550fe18b655802eb5194fa71.jpg&quot;}"/>
<h2 id="making-a-posts-app">Making a posts app</h2>
<p>First things first: go ahead and create a new app called <code>posts</code>.</p><div class="highlight"><pre><span class="nv">$ </span>python manage.py startapp posts
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_app_posts&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new app named \u003ccode\u003eposts\u003c/code\u003e&quot;}"/><p>Remember: whenever you create a new app you have to add it to the <code>INSTALLED_APPS</code> setting. Open <code>thinkster_django_angular_boilerplate/settings.py</code> and modify it like so:</p><div class="highlight"><pre><span class="vg">INSTALLED_APPS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">...</span>
<span class="w">    </span><span class="c1">'posts',</span>
<span class="p">)</span>
</pre></div>
<h2 id="making-the-post-model">Making the Post model</h2>
<p>After you create the <code>posts</code> app Django made a new file called <code>posts/models.py</code>. Go ahead and open it up and add the following:</p><p>from django.db import models</p><p>from authentication.models import Account</p><div class="highlight"><pre><span class="vg">class</span><span class="w"> </span><span class="vg">Post</span><span class="p">(</span><span class="vg">models</span><span class="o">.</span><span class="vg">Model</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">ForeignKey</span><span class="p">(</span><span class="vg">Account</span><span class="p">)</span>
<span class="w">    </span><span class="vg">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">TextField</span><span class="p">()</span>

<span class="w">    </span><span class="vg">created_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">DateTimeField</span><span class="p">(</span><span class="vg">auto_now_add</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>
<span class="w">    </span><span class="vg">updated_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">DateTimeField</span><span class="p">(</span><span class="vg">auto_now</span><span class="o">=</span><span class="vg">True</span><span class="p">)</span>

<span class="w">    </span><span class="vg">def</span><span class="w"> </span><span class="vg">__unicode__</span><span class="p">(</span><span class="vg">self</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="vg">return</span><span class="w"> </span><span class="c1">'{0}'.format(self.content)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_model_post&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new model called \u003ccode\u003ePost\u003c/code\u003e in \u003ccode\u003eposts/models.py\u003c/code\u003e&quot;}"/><p>Our method of walking through the code line-by-line is working well so far. Why mess with a good thing? Let's do it.</p><div class="highlight"><pre><span class="vg">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">models</span><span class="o">.</span><span class="vg">ForeignKey</span><span class="p">(</span><span class="vg">Account</span><span class="p">)</span>
</pre></div><p>Because each <code>Account</code> can have many <code>Post</code> objects, we need to set up a many-to-one relation.</p><p>The way to do this in Django is with using a <code>ForeignKey</code> field to associate each <code>Post</code> with a <code>Account</code>. </p><p>Django is smart enough to know the foreign key we've set up here should be reversible. That is to say, given a <code>Account</code>, you should be able to access that user's <code>Post</code>s. In Django these <code>Post</code> objects can be accessed through <code>Account.post_set</code> (not <code>Account.posts</code>).</p><p>Now that the model exists, don't forget to migrate.</p><div class="highlight"><pre><span class="nv">$ </span>python manage.py makemigrations
<span class="nv">$ </span>python manage.py migrate
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_model_post_migrate&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make migrations for \u003ccode\u003ePost\u003c/code\u003e and apply them&quot;}"/>
<h2 id="serializing-the-post-model">Serializing the Post model</h2>
<p>Create a new file in <code>posts/</code> called <code>serializers.py</code> and add the following:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">authentication.serializers</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="kn">from</span> <span class="nn">posts.models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">PostSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">AccountSerializer</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'content'</span><span class="p">,</span> <span class="s">'created_at'</span><span class="p">,</span> <span class="s">'updated_at'</span><span class="p">)</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'created_at'</span><span class="p">,</span> <span class="s">'updated_at'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_validation_exclusions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">exclusions</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PostSerializer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_validation_exclusions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">exclusions</span> <span class="o">+</span> <span class="p">[</span><span class="s">'author'</span><span class="p">]</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_serializer_postserializer&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new serializer called \u003ccode\u003ePostSerializer\u003c/code\u003e in \u003ccode\u003eposts/serializers.py\u003c/code\u003e&quot;}"/><p>There isn't much here that's new, but there is one line in particular I want to look at.</p><div class="highlight"><pre><span class="vg">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">AccountSerializer</span><span class="p">(</span><span class="vg">read_only</span><span class="o">=</span><span class="vg">True</span><span class="p">,</span><span class="w"> </span><span class="vg">required</span><span class="o">=</span><span class="vg">False</span><span class="p">)</span>
</pre></div><p>We explicitly defined a number of fields in our <code>AccountSerializer</code> from before, but this definition is a little different.</p><p>When serializing a <code>Post</code> object, we want to include all of the author's information. Within Django REST Framework, this is known as a nested relationship. Basically, we are serializing the <code>Account</code> related to this <code>Post</code> and including it in our JSON.</p><p>We pass <code>read_only=True</code> because we should not be updating an <code>Account</code> object with a <code>PostSerializer</code>. We also set <code>required=False</code> here because we will set the author of this post automatically.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">get_validation_exclusions</span><span class="p">(</span><span class="vg">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="vg">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="vg">kwargs</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">exclusions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">super</span><span class="p">(</span><span class="vg">PostSerializer</span><span class="p">,</span><span class="w"> </span><span class="vg">self</span><span class="p">)</span><span class="o">.</span><span class="vg">get_validation_exclusions</span><span class="p">()</span>

<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">exclusions</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="c1">'author']</span>
</pre></div><p>For the same reason we use <code>required=False</code>, we must also add <code>author</code> to the list of validations we wish to skip.</p>
<h2 id="making-api-views-for-post-objects">Making API views for Post objects</h2>
<p>The next step in creating <code>Post</code> objects is adding an API endpoint that will handle performing actions on the <code>Post</code> model such as create or update.</p><p>Replace the contents of <code>posts/views.py</code> with the following:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span><span class="p">,</span> <span class="n">viewsets</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="kn">from</span> <span class="nn">posts.models</span> <span class="kn">import</span> <span class="n">Post</span>
<span class="kn">from</span> <span class="nn">posts.permissions</span> <span class="kn">import</span> <span class="n">IsAuthorOfPost</span>
<span class="kn">from</span> <span class="nn">posts.serializers</span> <span class="kn">import</span> <span class="n">PostSerializer</span>


<span class="k">class</span> <span class="nc">PostViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-created_at'</span><span class="p">)</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">PostSerializer</span>

    <span class="k">def</span> <span class="nf">get_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="n">permissions</span><span class="o">.</span><span class="n">SAFE_METHODS</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">(),)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">(),</span> <span class="n">IsAuthorOfPost</span><span class="p">(),)</span>

<span class="k">def</span> <span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PostViewSet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">perform_create</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">AccountPostsViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'author'</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">PostSerializer</span>

    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">account_username</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author__username</span><span class="o">=</span><span class="n">account_username</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer_class</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_viewset_post&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a \u003ccode\u003ePostViewSet\u003c/code\u003e viewset&quot;}"/><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_viewset_account_post&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make an \u003ccode\u003eAccountPostsViewSet\u003c/code\u003e viewset&quot;}"/><p>Do these views look similar? They aren't that different than the ones we made to create <code>User</code> objects.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">perform_create</span><span class="p">(</span><span class="vg">self</span><span class="p">,</span><span class="w"> </span><span class="vg">serializer</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">serializer</span><span class="o">.</span><span class="vg">save</span><span class="p">(</span><span class="vg">author</span><span class="o">=</span><span class="vg">self</span><span class="o">.</span><span class="vg">request</span><span class="o">.</span><span class="vg">user</span><span class="p">)</span>

<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="vg">super</span><span class="p">(</span><span class="vg">PostViewSet</span><span class="p">,</span><span class="w"> </span><span class="vg">self</span><span class="p">)</span><span class="o">.</span><span class="vg">perform_create</span><span class="p">(</span><span class="vg">serializer</span><span class="p">)</span>
</pre></div><p><code>perform_create</code> is called before the model of this view is saved.</p><p>When a <code>Post</code> object is created it has to be associated with an author. Making the author type in their own username or id when creating adding a post to the site would be a bad experience, so we handle this association for them with the <code>perform_create</code> hook. We simply grab the user associated with this request and make them the author of this <code>Post</code>.</p><div class="highlight"><pre><span class="vg">def</span><span class="w"> </span><span class="vg">get_permissions</span><span class="p">(</span><span class="vg">self</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="vg">if</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">request</span><span class="o">.</span><span class="vg">method</span><span class="w"> </span><span class="vg">in</span><span class="w"> </span><span class="vg">permissions</span><span class="o">.</span><span class="nl">SAFE_METHODS:</span>
<span class="w">        </span><span class="vg">return</span><span class="w"> </span><span class="p">(</span><span class="vg">permissions</span><span class="o">.</span><span class="vg">AllowAny</span><span class="p">(),)</span>
<span class="w">    </span><span class="vg">return</span><span class="w"> </span><span class="p">(</span><span class="vg">permissions</span><span class="o">.</span><span class="vg">IsAuthenticated</span><span class="p">(),</span><span class="w"> </span><span class="vg">IsAuthorOfPost</span><span class="p">(),)</span>
</pre></div><p>Similar to the permissions we used for the <code>Account</code> viewset, dangerous HTTP methods require the user be authenticated and authorized to make changes to this <code>Post</code>. We will created the <code>IsAuthorOfPost</code> permission shortly. If the HTTP method is safe, we allow anyone to access this view.</p><div class="highlight"><pre><span class="vg">class</span><span class="w"> </span><span class="vg">AccountPostsViewSet</span><span class="p">(</span><span class="vg">viewsets</span><span class="o">.</span><span class="vg">ViewSet</span><span class="p">)</span><span class="o">:</span>
</pre></div><p>This viewset will be used to list the posts associated with a specific <code>Account</code>.</p><div class="highlight"><pre><span class="vg">queryset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">self</span><span class="o">.</span><span class="vg">queryset</span><span class="o">.</span><span class="vg">filter</span><span class="p">(</span><span class="vg">author__username</span><span class="o">=</span><span class="vg">account_username</span><span class="p">)</span>
</pre></div><p>Here we filter our queryset based on the author's username. The <code>account_username</code> argument will be supplied by the router we will create in a few minutes.</p>
<h2 id="making-the-isauthorofpost-permission">Making the IsAuthorOfPost permission</h2>
<p>Create <code>permissions.py</code> in the <code>posts/</code> directory with the following content:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span>


<span class="k">class</span> <span class="nc">IsAuthorOfPost</span><span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">BasePermission</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">has_object_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">post</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_permission_isauthenticatedandownsobject&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new permission called \u003ccode\u003eIsAuthenticatedAndOwnsObject\u003c/code\u003e in \u003ccode\u003eposts/permissions.py\u003c/code\u003e&quot;}"/><p>We will skip the explanation for this. This permission is almost identical to the one we made previously.</p>
<h2 id="making-an-api-endpoint-for-posts">Making an API endpoint for posts</h2>
<p>With the views created, it's time to add the endpoints to our API.</p><p>Open <code>thinkster_django_angular_boilerplate/urls.py</code> and add the following import:</p><div class="highlight"><pre><span class="kn">from</span> <span class="nn">posts.views</span> <span class="kn">import</span> <span class="n">AccountPostsViewSet</span><span class="p">,</span> <span class="n">PostViewSet</span>
</pre></div><p>Now add these lines just above <code>urlpatterns = patterns(</code>:</p><div class="highlight"><pre><span class="vg">router</span><span class="o">.</span><span class="vg">register</span><span class="p">(</span><span class="vg">r</span><span class="c1">'posts', PostViewSet)</span>

<span class="vg">accounts_router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">routers</span><span class="o">.</span><span class="vg">NestedSimpleRouter</span><span class="p">(</span>
<span class="w">    </span><span class="vg">router</span><span class="p">,</span><span class="w"> </span><span class="vg">r</span><span class="c1">'accounts', lookup='account'</span>
<span class="p">)</span>
<span class="vg">accounts_router</span><span class="o">.</span><span class="vg">register</span><span class="p">(</span><span class="vg">r</span><span class="c1">'posts', AccountPostsViewSet)</span>
</pre></div><p><code>accounts_router</code> provides the nested routing need to access the posts for a specific <code>Account</code>. You should also now add <code>accounts_router</code> to <code>urlpatterns</code> like so:</p><div class="highlight"><pre><span class="vg">urlpatterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">patterns</span><span class="p">(</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="o">...</span>

<span class="w">  </span><span class="vg">url</span><span class="p">(</span><span class="vg">r</span><span class="c1">'^api/v1/', include(router.urls)),</span>
<span class="w">  </span><span class="vg">url</span><span class="p">(</span><span class="vg">r</span><span class="c1">'^api/v1/', include(accounts_router.urls)),</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="o">...</span>
<span class="p">)</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_url_postviewset&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make an API endpoint for the \u003ccode\u003ePostViewSet\u003c/code\u003e viewset&quot;}"/><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;django_url_accountpostsviewset&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make an API endpoint for the \u003ccode\u003eAccountPostsViewSet\u003c/code\u003e viewset&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>At this point, feel free to open up your shell with <code>python manage.py shell</code> and play around with creating and serializing <code>Post</code> objects.</p><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">authentication.models</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">posts.models</span> <span class="kn">import</span> <span class="n">Post</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">posts.serializers</span> <span class="kn">import</span> <span class="n">PostSerializer</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'created_at'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">'I promise this is not Google Plus!'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serialized_post</span> <span class="o">=</span> <span class="n">PostSerializer</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serialized_post</span><span class="o">.</span><span class="n">data</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_create_post&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Play around with the \u003ccode\u003ePost\u003c/code\u003e model and \u003ccode\u003ePostSerializer\u003c/code\u003e serializer in Django\u0026#39;s shell&quot;}"/><p>We will confirm the views are working at the end of the next section.</p></div><div class="course-section" id="rendering-post-objects"><h1>Rendering Post objects</h1><p>Until now, the index page has been empty. Now that we have handled authentication and the backend details for the <code>Post</code> model, it's time to give our users something to interact with. We will do this by creating a service that handles retrieving and creating <code>Post</code>s and some controllers and directives for handling how the data is displayed.</p><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;render-post-object&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/d84177f0f3d3de8f07d731553b771456b893a038.jpg&quot;}"/>
<h2 id="a-module-for-posts">A module for posts</h2>
<p>Let's define the posts modules.</p><p>Create a file in <code>static/javascripts/posts</code> called <code>posts.module.js</code> and add the following:</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.posts', [</span>
<span class="w">      </span><span class="c1">'thinkster.posts.controllers',</span>
<span class="w">      </span><span class="c1">'thinkster.posts.directives',</span>
<span class="w">      </span><span class="c1">'thinkster.posts.services'</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.posts.controllers', []);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.posts.directives', ['ngDialog']);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.posts.services', []);</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Define the \u003ccode\u003ethinkster.posts\u003c/code\u003e module&quot;}"/><p>Remember to add <code>thinkster.posts</code> as a dependency of <code>thinkster</code> in <code>thinkster.js</code>:</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster', [</span>
<span class="w">    </span><span class="c1">'thinkster.config',</span>
<span class="w">    </span><span class="c1">'thinkster.routes',</span>
<span class="w">    </span><span class="c1">'thinkster.authentication',</span>
<span class="w">    </span><span class="c1">'thinkster.layout',</span>
<span class="w">    </span><span class="c1">'thinkster.posts'</span>
<span class="w">  </span><span class="p">]);</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_module_dep_thinkster&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add \u003ccode\u003ethinkster.posts\u003c/code\u003e as a dependency of the \u003ccode\u003ethinkster\u003c/code\u003e module&quot;}"/><p>There are two things worth noting about this module.</p><p>First, we have created a module named <code>thinkster.posts.directives</code>. As you probably guessed, this means we will introduce the concept of directives to our app in this chapter.</p><p>Secondly, the <code>thinkster.posts.directives</code> module requires the <code>ngDialog</code> module. <code>ngDialog</code> is included in the boilerplate project and handles the display of modals. We will use a modal in the next chapter when we write the code for creating new posts.</p><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/posts/posts.module.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_include_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eposts.module.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="making-a-posts-service">Making a Posts service</h2>
<p>Before we can render anything, we need to transport data from the server to the client.</p><p>Create a file at <code>static/javascripts/posts/services/</code> called <code>posts.service.js</code> and add the following:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* Posts</span>
<span class="cm">* @namespace thinkster.posts.services</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">services</span><span class="p">')</span>
    <span class="p">.</span><span class="n">factory</span><span class="p">('</span><span class="n">Posts</span><span class="p">',</span> <span class="n">Posts</span><span class="p">);</span>

  <span class="n">Posts</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">http</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace Posts</span>
<span class="cm">  * @returns {Factory}</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">Posts</span><span class="p">(</span><span class="err">$</span><span class="n">http</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">Posts</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nl">all:</span> <span class="n">all</span><span class="p">,</span>
      <span class="nl">create:</span> <span class="n">create</span><span class="p">,</span>
      <span class="nl">get:</span> <span class="n">get</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">Posts</span><span class="p">;</span>

    <span class="c1">////////////////////</span>

    <span class="cm">/**</span>
<span class="cm">    * @name all</span>
<span class="cm">    * @desc Get all Posts</span>
<span class="cm">    * @returns {Promise}</span>
<span class="cm">    * @memberOf thinkster.posts.services.Posts</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">all</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">get</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="p">');</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name create</span>
<span class="cm">    * @desc Create a new Post</span>
<span class="cm">    * @param {string} content The content of the new Post</span>
<span class="cm">    * @returns {Promise}</span>
<span class="cm">    * @memberOf thinkster.posts.services.Posts</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">create</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">post</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="p">',</span> <span class="p">{</span>
        <span class="nl">content:</span> <span class="n">content</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * @name get</span>
<span class="cm">     * @desc Get the Posts of a given user</span>
<span class="cm">     * @param {string} username The username to get Posts for</span>
<span class="cm">     * @returns {Promise}</span>
<span class="cm">     * @memberOf thinkster.posts.services.Posts</span>
<span class="cm">     */</span>
    <span class="k">function</span> <span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">get</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="p">'</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="p">'</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="p">');</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_service&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new factory called \u003ccode\u003ePosts\u003c/code\u003e in \u003ccode\u003estatic/javascripts/posts/services/posts.service.js\u003c/code\u003e&quot;}"/><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/posts/services/posts.service.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_service_include_javascripts&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eposts.service.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/><p>This code should look pretty familiar. It is very similar to the services we created before.</p><p>The <code>Posts</code> service only has two methods: <code>all</code> and <code>create</code>.</p><p>On the index page, we will use <code>Posts.all()</code> to get the list of objects we want to display. We will use <code>Posts.create()</code> to let users add their own posts.</p>
<h2 id="making-an-interface-for-the-index-page">Making an interface for the index page</h2>
<p>Create <code>static/templates/layout/index.html</code> with the following contents:</p><div class="highlight"><pre><span class="nt">&lt;posts</span> <span class="na">posts=</span><span class="s">"vm.posts"</span> <span class="na">ng-show=</span><span class="s">"vm.posts &amp;&amp; vm.posts.length"</span><span class="nt">&gt;&lt;/posts&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;index_template&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create the index template&quot;}"/><p>We will add a little more later, but not much. Most of what we need will be in the template we create for the posts directive next.</p>
<h2 id="making-a-snackbar-service">Making a Snackbar service</h2>
<p>In the boilerplate project for this tutorial, we've included SnackbarJS. SnackbarJS is a small JavaScript library that makes showing snackbars (a concept from Google's Material Design) easy. Here, we will create a service to include this functionality in our AngularJS application.</p><p>Open <code>static/javascripts/utils/services/snackbar.service.js</code> and add the following:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* Snackbar</span>
<span class="cm">* @namespace thinkster.utils.services</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="err">$</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">services</span><span class="p">')</span>
    <span class="p">.</span><span class="n">factory</span><span class="p">('</span><span class="n">Snackbar</span><span class="p">',</span> <span class="n">Snackbar</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace Snackbar</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">Snackbar</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">    * @name Snackbar</span>
<span class="cm">    * @desc The factory to be returned</span>
<span class="cm">    */</span>
    <span class="k">var</span> <span class="n">Snackbar</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nl">error:</span> <span class="n">error</span><span class="p">,</span>
      <span class="nl">show:</span> <span class="n">show</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">Snackbar</span><span class="p">;</span>

    <span class="c1">////////////////////</span>

    <span class="cm">/**</span>
<span class="cm">    * @name _snackbar</span>
<span class="cm">    * @desc Display a snackbar</span>
<span class="cm">    * @param {string} content The content of the snackbar</span>
<span class="cm">    * @param {Object} options Options for displaying the snackbar</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">_snackbar</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">options</span> <span class="o">=</span> <span class="n">_</span><span class="p">.</span><span class="n">extend</span><span class="p">({</span> <span class="nl">timeout:</span> <span class="mh">3000</span> <span class="p">},</span> <span class="n">options</span><span class="p">);</span>
      <span class="n">options</span><span class="p">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">;</span>

      <span class="err">$</span><span class="p">.</span><span class="n">snackbar</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name error</span>
<span class="cm">    * @desc Display an error snackbar</span>
<span class="cm">    * @param {string} content The content of the snackbar</span>
<span class="cm">    * @param {Object} options Options for displaying the snackbar</span>
<span class="cm">    * @memberOf thinkster.utils.services.Snackbar</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">error</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">_snackbar</span><span class="p">('</span><span class="nl">Error:</span> <span class="p">'</span> <span class="o">+</span> <span class="n">content</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name show</span>
<span class="cm">    * @desc Display a standard snackbar</span>
<span class="cm">    * @param {string} content The content of the snackbar</span>
<span class="cm">    * @param {Object} options Options for displaying the snackbar</span>
<span class="cm">    * @memberOf thinkster.utils.services.Snackbar</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">_snackbar</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})(</span><span class="err">$</span><span class="p">,</span> <span class="n">_</span><span class="p">);</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_snackbar_service&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a \u003ccode\u003eSnackbar\u003c/code\u003e service&quot;}"/><p>Don't forget to set up your modules. Open <code>static/javascripts/utils/utils.module.js</code> and add the following:</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.utils', [</span>
<span class="w">      </span><span class="c1">'thinkster.utils.services'</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.utils.services', []);</span>
<span class="p">})();</span>
</pre></div><p>And make <code>thinksters.utils</code> a dependency of <code>thinkster</code> in <code>static/javascripts/thinkster.js</code>:</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster', [</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="w">    </span><span class="c1">'thinkster.utils',</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="w">  </span><span class="p">]);</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_utils_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Set up your modules for the \u003ccode\u003ethinkster.utils\u003c/code\u003e module&quot;}"/><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;angularjs_include_utils&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make \u003ccode\u003ethinkster.utils\u003c/code\u003e a dependency of \u003ccode\u003ethinkster\u003c/code\u003e&quot;}"/><p>The last step for this service is to include the new JavaScript files in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/utils/utils.module.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/utils/services/snackbar.service.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;include_utils_js&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eutils.module.js\u003c/code\u003e and \u003ccode\u003esnackbar.service.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="controlling-the-index-interface-with-indexcontroller">Controlling the index interface with IndexController</h2>
<p>Create a file in <code>static/javascripts/layout/controllers/</code> called <code>index.controller.js</code> and add the following:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* IndexController</span>
<span class="cm">* @namespace thinkster.layout.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">IndexController</span><span class="p">',</span> <span class="n">IndexController</span><span class="p">);</span>

  <span class="n">IndexController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">scope</span><span class="p">',</span> <span class="p">'</span><span class="n">Authentication</span><span class="p">',</span> <span class="p">'</span><span class="n">Posts</span><span class="p">',</span> <span class="p">'</span><span class="n">Snackbar</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace IndexController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">IndexController</span><span class="p">(</span><span class="err">$</span><span class="n">scope</span><span class="p">,</span> <span class="n">Authentication</span><span class="p">,</span> <span class="n">Posts</span><span class="p">,</span> <span class="n">Snackbar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">isAuthenticated</span> <span class="o">=</span> <span class="n">Authentication</span><span class="p">.</span><span class="n">isAuthenticated</span><span class="p">();</span>
    <span class="n">vm</span><span class="p">.</span><span class="n">posts</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="n">activate</span><span class="p">();</span>

    <span class="cm">/**</span>
<span class="cm">    * @name activate</span>
<span class="cm">    * @desc Actions to be performed when this controller is instantiated</span>
<span class="cm">    * @memberOf thinkster.layout.controllers.IndexController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">activate</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Posts</span><span class="p">.</span><span class="n">all</span><span class="p">().</span><span class="n">then</span><span class="p">(</span><span class="n">postsSuccessFn</span><span class="p">,</span> <span class="n">postsErrorFn</span><span class="p">);</span>

      <span class="err">$</span><span class="n">scope</span><span class="p">.</span><span class="err">$</span><span class="n">on</span><span class="p">('</span><span class="n">post</span><span class="p">.</span><span class="n">created</span><span class="p">',</span> <span class="k">function</span> <span class="p">(</span><span class="k">event</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">unshift</span><span class="p">(</span><span class="n">post</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="err">$</span><span class="n">scope</span><span class="p">.</span><span class="err">$</span><span class="n">on</span><span class="p">('</span><span class="n">post</span><span class="p">.</span><span class="n">created</span><span class="p">.</span><span class="n">error</span><span class="p">',</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">shift</span><span class="p">();</span>
      <span class="p">});</span>


      <span class="cm">/**</span>
<span class="cm">      * @name postsSuccessFn</span>
<span class="cm">      * @desc Update posts array on view</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">postsSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">posts</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">      * @name postsErrorFn</span>
<span class="cm">      * @desc Show snackbar with error</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">postsErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;index_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new controller called \u003ccode\u003eIndexController\u003c/code\u003e in \u003ccode\u003estatic/javascripts/layout/controllers/index.controller.js\u003c/code\u003e&quot;}"/><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/layout/controllers/index.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;index_controller_include_javascripts&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eindex.controller.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/><p>Let's touch on a couple of things here.</p><div class="highlight"><pre><span class="err">$</span><span class="vg">scope</span><span class="o">.</span><span class="err">$</span><span class="vg">on</span><span class="p">(</span><span class="c1">'post.created', function (event, post) {</span>
<span class="w">  </span><span class="vg">vm</span><span class="o">.</span><span class="vg">posts</span><span class="o">.</span><span class="vg">unshift</span><span class="p">(</span><span class="vg">post</span><span class="p">);</span>
<span class="p">});</span>
</pre></div><p>Later, when we get around to creating a new post, we will fire off an event called <code>post.created</code> when the user creates a post. By catching this event here, we can add this new post to the front of the <code>vm.posts</code> array. This will prevent us from having to make an extra API request to the server for updated data. We will talk about this more shortly, but for now you should know that we do this to increase the <em>perceived</em> performance of our application.</p><div class="highlight"><pre><span class="err">$</span><span class="vg">scope</span><span class="o">.</span><span class="err">$</span><span class="vg">on</span><span class="p">(</span><span class="c1">'post.created.error', function () {</span>
<span class="w">  </span><span class="vg">vm</span><span class="o">.</span><span class="vg">posts</span><span class="o">.</span><span class="vg">shift</span><span class="p">();</span>
<span class="p">});</span>
</pre></div><p>Analogous to the previous event listener, this one will remove the post at the front of <code>vm.posts</code> if the API request returns an error status code.</p>
<h2 id="making-a-route-for-the-index-page">Making a route for the index page</h2>
<p>With a controller and template in place, we need to set up a route for the index page.</p><p>Open <code>static/javascripts/thinkster.routes.js</code> and add the following route:</p><div class="highlight"><pre><span class="o">.</span><span class="vg">when</span><span class="p">(</span><span class="c1">'/', {</span>
<span class="w">  </span><span class="nl">controller:</span><span class="w"> </span><span class="c1">'IndexController',</span>
<span class="w">  </span><span class="nl">controllerAs:</span><span class="w"> </span><span class="c1">'vm',</span>
<span class="w">  </span><span class="nl">templateUrl:</span><span class="w"> </span><span class="c1">'/static/templates/layout/index.html'</span>
<span class="p">})</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;index_route&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add a route to \u003ccode\u003ethinkster.routes.js\u003c/code\u003e for the \u003ccode\u003e/\u003c/code\u003e path&quot;}"/>
<h2 id="making-a-directive-for-displaying-posts">Making a directive for displaying Posts</h2>
<p>Create <code>static/javascripts/posts/directives/posts.directive.js</code> with the following contents:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* Posts</span>
<span class="cm">* @namespace thinkster.posts.directives</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">directives</span><span class="p">')</span>
    <span class="p">.</span><span class="n">directive</span><span class="p">('</span><span class="n">posts</span><span class="p">',</span> <span class="n">posts</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace Posts</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">posts</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">    * @name directive</span>
<span class="cm">    * @desc The directive to be returned</span>
<span class="cm">    * @memberOf thinkster.posts.directives.Posts</span>
<span class="cm">    */</span>
    <span class="k">var</span> <span class="n">directive</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nl">controller:</span> <span class="p">'</span><span class="n">PostsController</span><span class="p">',</span>
      <span class="nl">controllerAs:</span> <span class="p">'</span><span class="n">vm</span><span class="p">',</span>
      <span class="k">restrict</span><span class="o">:</span> <span class="sc">'E'</span><span class="p">,</span>
      <span class="nl">scope:</span> <span class="p">{</span>
        <span class="nl">posts:</span> <span class="sc">'='</span>
      <span class="p">},</span>
      <span class="nl">templateUrl:</span> <span class="p">'</span><span class="o">/</span><span class="k">static</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">posts</span><span class="p">.</span><span class="n">html</span><span class="p">'</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">directive</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_directive&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new directive called \u003ccode\u003eposts\u003c/code\u003e in \u003ccode\u003estatic/javascripts/posts/directives/posts.directive.js\u003c/code\u003e&quot;}"/><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/posts/directives/posts.directive.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_directive_include_js&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eposts.directive.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/><p>There are two parts of the directives API that I want to touch on: <code>scope</code> and <code>restrict</code>.</p><p><code>scope</code> defines the scope of this directive, similar to how <code>$scope</code> works for controllers. The difference is that, in a controller, a new scope is implicitly created. For a directive, we have the option of explicitly defining our scopes and that's what we do here.</p><p>The second line, <code>posts: '='</code> simply means that we want to set <code>$scope.posts</code> to the value passed in through the <code>posts</code> attribute in the template that we made earlier.</p><p><code>restrict</code> tells Angular how we are allowed to use this directive. In our case, we set the value of <code>restrict</code> to <code>E</code> (for element) which means Angular should only match the name of our directive with the name of an element: <code>&lt;posts&gt;&lt;/posts&gt;</code>. </p><p>Another common option is <code>A</code> (for attribute), which tells Angular to only match the name of the directive with the name of an attribute. <code>ngDialog</code> uses this option, as we will see shortly.</p>
<h2 id="controller-the-posts-directive-with-postscontroller">Controller the posts directive with PostsController</h2>
<p>The directive we just created requires a controller called <code>PostsController</code>. </p><p>Create <code>static/javascripts/posts/controllers/posts.controller.js</code> with the following content:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* PostsController</span>
<span class="cm">* @namespace thinkster.posts.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">PostsController</span><span class="p">',</span> <span class="n">PostsController</span><span class="p">);</span>

  <span class="n">PostsController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">scope</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace PostsController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">PostsController</span><span class="p">(</span><span class="err">$</span><span class="n">scope</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="n">activate</span><span class="p">();</span>


    <span class="cm">/**</span>
<span class="cm">    * @name activate</span>
<span class="cm">    * @desc Actions to be performed when this controller is instantiated</span>
<span class="cm">    * @memberOf thinkster.posts.controllers.PostsController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">activate</span><span class="p">()</span> <span class="p">{</span>
      <span class="err">$</span><span class="n">scope</span><span class="p">.</span><span class="err">$</span><span class="n">watchCollection</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="err">$</span><span class="n">scope</span><span class="p">.</span><span class="n">posts</span><span class="p">;</span> <span class="p">},</span> <span class="n">render</span><span class="p">);</span>
      <span class="err">$</span><span class="n">scope</span><span class="p">.</span><span class="err">$</span><span class="n">watch</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="err">$</span><span class="p">(</span><span class="n">window</span><span class="p">).</span><span class="n">width</span><span class="p">();</span> <span class="p">},</span> <span class="n">render</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name calculateNumberOfColumns</span>
<span class="cm">    * @desc Calculate number of columns based on screen width</span>
<span class="cm">    * @returns {Number} The number of columns containing Posts</span>
<span class="cm">    * @memberOf thinkster.posts.controllers.PostsControllers</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">calculateNumberOfColumns</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">var</span> <span class="n">width</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">window</span><span class="p">).</span><span class="n">width</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">width</span> <span class="o">&gt;=</span> <span class="mh">1200</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mh">4</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">width</span> <span class="o">&gt;=</span> <span class="mh">992</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mh">3</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">width</span> <span class="o">&gt;=</span> <span class="mh">768</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mh">2</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mh">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name approximateShortestColumn</span>
<span class="cm">    * @desc An algorithm for approximating which column is shortest</span>
<span class="cm">    * @returns The index of the shortest column</span>
<span class="cm">    * @memberOf thinkster.posts.controllers.PostsController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">approximateShortestColumn</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">var</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">vm</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">columnMapFn</span><span class="p">);</span>

      <span class="k">return</span> <span class="n">scores</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">scores</span><span class="p">));</span>


      <span class="cm">/**</span>
<span class="cm">      * @name columnMapFn</span>
<span class="cm">      * @desc A map function for scoring column heights</span>
<span class="cm">      * @returns The approximately normalized height of a given column</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">columnMapFn</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">lengths</span> <span class="o">=</span> <span class="n">column</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">element</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="n">lengths</span><span class="p">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span> <span class="mh">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">column</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">      * @name sum</span>
<span class="cm">      * @desc Sums two numbers</span>
<span class="cm">      * @params {Number} m The first number to be summed</span>
<span class="cm">      * @params {Number} n The second number to be summed</span>
<span class="cm">      * @returns The sum of two numbers</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name render</span>
<span class="cm">    * @desc Renders Posts into columns of approximately equal height</span>
<span class="cm">    * @param {Array} current The current value of `vm.posts`</span>
<span class="cm">    * @param {Array} original The value of `vm.posts` before it was updated</span>
<span class="cm">    * @memberOf thinkster.posts.controllers.PostsController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">render</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="o">!==</span> <span class="n">original</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">calculateNumberOfColumns</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">vm</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">push</span><span class="p">([]);</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">current</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">var</span> <span class="n">column</span> <span class="o">=</span> <span class="n">approximateShortestColumn</span><span class="p">();</span>

          <span class="n">vm</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="n">push</span><span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new controller called \u003ccode\u003ePostsController\u003c/code\u003e in \u003ccode\u003estatic/javascripts/posts/controllers/posts.controller.js\u003c/code\u003e&quot;}"/><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/posts/controllers/posts.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_controller_include_js&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eposts.controller.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/><p>It isn't worth taking the time to step through this controller line-by-line. Suffice it to say that this controller presents an algorithm for ensuring the columns of posts are of approximately equal height.</p><p>The only thing worth mentioning here is this line:</p><div class="highlight"><pre><span class="err">$</span><span class="vg">scope</span><span class="o">.</span><span class="err">$</span><span class="vg">watchCollection</span><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="vg">return</span><span class="w"> </span><span class="err">$</span><span class="vg">scope</span><span class="o">.</span><span class="vg">posts</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="vg">render</span><span class="p">);</span>
</pre></div><p>Because we do not have direct access to the ViewModel that <code>posts</code> is stored on, we watch <code>$scope.posts</code> instead of <code>vm.posts</code>. Furthermore, we use <code>$watchCollection</code> here because <code>$scope.posts</code> is an array. <code>$watch</code> watches the object's reference, not it's actual value. <code>$watchCollection</code> watches the value of an array from changes. If we used <code>$watch</code> here instead of <code>$watchCollection</code>, the changes caused by <code>$scope.posts.shift()</code> and <code>$scope.posts.unshift()</code> would not trigger the watcher.</p>
<h2 id="making-a-template-for-the-posts-directive">Making a template for the posts directive</h2>
<p>In our directive we defined a <code>templateUrl</code> that doesn't match any of our existing templates. Let's go ahead and make a new one.</p><p>Create <code>static/templates/posts/posts.html</code> with the following content:</p><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="err">ng-cloak</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">"column in vm.columns"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-12 col-sm-6 col-md-4 col-lg-3"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">ng-repeat=</span><span class="s">"post in column"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;post</span> <span class="na">post=</span><span class="s">"post"</span><span class="nt">&gt;&lt;/post&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">ng-hide=</span><span class="s">"vm.columns &amp;&amp; vm.columns.length"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-12 no-posts-here"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;em&gt;</span>The are no posts here.<span class="nt">&lt;/em&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;posts_template&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a template for the \u003ccode\u003eposts\u003c/code\u003e directive&quot;}"/><p>A few things worth noting:</p>
<ol>
<li>We use the <code>ng-cloak</code> directive to prevent flashing since this directive will be used on the first page loaded.</li>
<li>We will need to create a <code>post</code> directive for rendering each individual post.</li>
<li>If no posts are present, we render a message informing the user.</li>
</ol>

<h2 id="making-a-directive-for-displaying-a-single-post">Making a directive for displaying a single Post</h2>
<p>In the template for the posts directive, we use another directive called <code>post</code>. Let's create that.</p><p>Create <code>static/javascripts/posts/directives/post.directive.js</code> with the following content:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* Post</span>
<span class="cm">* @namespace thinkster.posts.directives</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">directives</span><span class="p">')</span>
    <span class="p">.</span><span class="n">directive</span><span class="p">('</span><span class="n">post</span><span class="p">',</span> <span class="n">post</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace Post</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">post</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">    * @name directive</span>
<span class="cm">    * @desc The directive to be returned</span>
<span class="cm">    * @memberOf thinkster.posts.directives.Post</span>
<span class="cm">    */</span>
    <span class="k">var</span> <span class="n">directive</span> <span class="o">=</span> <span class="p">{</span>
      <span class="k">restrict</span><span class="o">:</span> <span class="sc">'E'</span><span class="p">,</span>
      <span class="nl">scope:</span> <span class="p">{</span>
        <span class="nl">post:</span> <span class="sc">'='</span>
      <span class="p">},</span>
      <span class="nl">templateUrl:</span> <span class="p">'</span><span class="o">/</span><span class="k">static</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">post</span><span class="p">.</span><span class="n">html</span><span class="p">'</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">directive</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;post_directive&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a new directive called \u003ccode\u003epost\u003c/code\u003e in \u003ccode\u003estatic/javascripts/posts/directives/post.directive.js\u003c/code\u003e&quot;}"/><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/posts/directives/post.directive.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;post_directive_include_js&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003epost.directive.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/><p>There is nothing new worth discussing here. This directive is almost identical to the previous one. The only difference is we use a different template.</p>
<h2 id="making-a-template-for-the-post-directive">Making a template for the post directive</h2>
<p>Like we did for the <code>posts</code> directive, we now need to make a template for the <code>post</code> directive.</p><p>Create <code>static/templates/posts/post.html</code> with the following content:</p><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-12"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"well"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post__meta"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/+{{ post.author.username }}"</span><span class="nt">&gt;</span>
            +{{ post.author.username }}
          <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post__content"</span><span class="nt">&gt;</span>
          {{ post.content }}
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;post_template&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a template for the \u003ccode\u003epost\u003c/code\u003e directive&quot;}"/>
<h2 id="some-quick-css">Some quick CSS</h2>
<p>We want to add a few simple styles to make our posts look better. Open <code>static/stylesheets/styles.css</code> and add the following:</p><div class="highlight"><pre><span class="o">.</span><span class="vg">no</span><span class="o">-</span><span class="vg">posts</span><span class="o">-</span><span class="vg">here</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="vg">text</span><span class="o">-</span><span class="nl">align:</span><span class="w"> </span><span class="vg">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="vg">post</span><span class="w"> </span><span class="p">{}</span>

<span class="o">.</span><span class="vg">post</span><span class="w"> </span><span class="o">.</span><span class="vg">post__meta</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="vg">font</span><span class="o">-</span><span class="nl">weight:</span><span class="w"> </span><span class="vg">bold</span><span class="p">;</span>
<span class="w">  </span><span class="vg">text</span><span class="o">-</span><span class="nl">align:</span><span class="w"> </span><span class="vg">right</span><span class="p">;</span>
<span class="w">  </span><span class="vg">padding</span><span class="o">-</span><span class="nl">bottom:</span><span class="w"> </span><span class="il">19</span><span class="vg">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="vg">post</span><span class="w"> </span><span class="o">.</span><span class="vg">post__meta</span><span class="w"> </span><span class="nl">a:</span><span class="vg">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="vg">text</span><span class="o">-</span><span class="nl">decoration:</span><span class="w"> </span><span class="vg">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;post_css&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add some CSS to \u003ccode\u003estatic/stylesheets/style.css\u003c/code\u003e to make our posts look better&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>Assuming all is well, you can confirm you're on the right track by loading <code>http://localhost:8000/</code> in your browser. You should see the <code>Post</code> object you created at the end of the last section!</p><p>This also confirms that <code>PostViewSet</code> from the last section is working.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_render_posts&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Visit \u003ccode\u003ehttp://localhost:8000/\u003c/code\u003e and confirm the \u003ccode\u003ePost\u003c/code\u003e object you made earlier is shown.&quot;}"/></div><div class="course-section" id="making-new-posts"><h1>Making new posts</h1><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;make-new-post&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/c63a5a4fa0ca40d84f50ffd3246703b5ce64f6a9.jpg&quot;}"/><p>Given that we already have the necessary endpoints in place, the next thing we need to let users make new posts is an interface. We accomplish this by adding a button to the bottom-right corner of the screen. When this button is clicked, a modal shows up asking the user to type in their post.</p><p>We only want this button to show up on the index page for now, so open <code>static/templates/layout/index.html</code> and add the following snippet to the bottom of the file:</p><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-fab btn-raised mdi-content-add btn-add-new-post"</span>
  <span class="na">href=</span><span class="s">"javascript:void(0)"</span>
  <span class="na">ng-show=</span><span class="s">"vm.isAuthenticated"</span>
  <span class="na">ng-dialog=</span><span class="s">"/static/templates/posts/new-post.html"</span>
  <span class="na">ng-dialog-controller=</span><span class="s">"NewPostController as vm"</span><span class="nt">&gt;&lt;/a&gt;</span>
</pre></div><p>The anchor tag in this snippet uses the <code>ngDialog</code> directive we included as a dependency earlier to show a modal when the user wants to submit a new post.</p><p>Because we want the button to be fixed to the bottom-right corner of the screen, we also need to add a new CSS rule.</p><p>Open <code>static/stylesheets/styles.css</code> and add this rule to the bottom of the file:</p><div class="highlight"><pre><span class="o">.</span><span class="vg">btn</span><span class="o">-</span><span class="vg">add</span><span class="o">-</span><span class="vg">new</span><span class="o">-</span><span class="vg">post</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">position:</span><span class="w"> </span><span class="vg">fixed</span><span class="p">;</span>
<span class="w">  </span><span class="nl">bottom:</span><span class="w"> </span><span class="il">20</span><span class="vg">px</span><span class="p">;</span>
<span class="w">  </span><span class="nl">right:</span><span class="w"> </span><span class="il">20</span><span class="vg">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;new_post_modal_button&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Add a button for showing the new post modal&quot;}"/><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;style_new_post_button&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Style the new post button&quot;}"/>
<h2 id="an-interface-for-submitting-new-posts">An interface for submitting new posts</h2>
<p>Now we need to create the form the user will type their new post into. Open <code>static/templates/posts/new-post.html</code> and add the following to the bottom of the file:</p><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">role=</span><span class="s">"form"</span> <span class="na">ng-submit=</span><span class="s">"vm.submit()"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"post__content"</span><span class="nt">&gt;</span>New Post<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"form-control"</span> 
              <span class="na">id=</span><span class="s">"post__content"</span> 
              <span class="na">rows=</span><span class="s">"3"</span> 
              <span class="na">placeholder=</span><span class="s">"ex. This is my first time posting on Not Google Plus!"</span> 
              <span class="na">ng-model=</span><span class="s">"vm.content"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/textarea&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>
      Submit
    <span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;new_post_template&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a template for adding new posts in \u003ccode\u003estatic/templates/posts/new-post.html\u003c/code\u003e&quot;}"/>
<h2 id="controlling-the-new-post-interface-with-newpostcontroller">Controlling the new post interface with NewPostController</h2>
<p>Create <code>static/javascripts/posts/controller/new-post.controller.js</code> with the following content:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* NewPostController</span>
<span class="cm">* @namespace thinkster.posts.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">NewPostController</span><span class="p">',</span> <span class="n">NewPostController</span><span class="p">);</span>

  <span class="n">NewPostController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">rootScope</span><span class="p">',</span> <span class="p">'</span><span class="err">$</span><span class="n">scope</span><span class="p">',</span> <span class="p">'</span><span class="n">Authentication</span><span class="p">',</span> <span class="p">'</span><span class="n">Snackbar</span><span class="p">',</span> <span class="p">'</span><span class="n">Posts</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace NewPostController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">NewPostController</span><span class="p">(</span><span class="err">$</span><span class="n">rootScope</span><span class="p">,</span> <span class="err">$</span><span class="n">scope</span><span class="p">,</span> <span class="n">Authentication</span><span class="p">,</span> <span class="n">Snackbar</span><span class="p">,</span> <span class="n">Posts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">submit</span> <span class="o">=</span> <span class="n">submit</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">    * @name submit</span>
<span class="cm">    * @desc Create a new Post</span>
<span class="cm">    * @memberOf thinkster.posts.controllers.NewPostController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">submit</span><span class="p">()</span> <span class="p">{</span>
      <span class="err">$</span><span class="n">rootScope</span><span class="p">.</span><span class="err">$</span><span class="n">broadcast</span><span class="p">('</span><span class="n">post</span><span class="p">.</span><span class="n">created</span><span class="p">',</span> <span class="p">{</span>
        <span class="nl">content:</span> <span class="n">vm</span><span class="p">.</span><span class="n">content</span><span class="p">,</span>
        <span class="nl">author:</span> <span class="p">{</span>
          <span class="nl">username:</span> <span class="n">Authentication</span><span class="p">.</span><span class="n">getAuthenticatedAccount</span><span class="p">().</span><span class="n">username</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="err">$</span><span class="n">scope</span><span class="p">.</span><span class="n">closeThisDialog</span><span class="p">();</span>

      <span class="n">Posts</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">content</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">createPostSuccessFn</span><span class="p">,</span> <span class="n">createPostErrorFn</span><span class="p">);</span>


      <span class="cm">/**</span>
<span class="cm">      * @name createPostSuccessFn</span>
<span class="cm">      * @desc Show snackbar with success message</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">createPostSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">show</span><span class="p">('</span><span class="n">Success</span><span class="o">!</span> <span class="n">Post</span> <span class="n">created</span><span class="p">.');</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">      * @name createPostErrorFn</span>
<span class="cm">      * @desc Propogate error event and show snackbar with error message</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">createPostErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">$</span><span class="n">rootScope</span><span class="p">.</span><span class="err">$</span><span class="n">broadcast</span><span class="p">('</span><span class="n">post</span><span class="p">.</span><span class="n">created</span><span class="p">.</span><span class="n">error</span><span class="p">');</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;new_post_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a \u003ccode\u003eNewPostController\u003c/code\u003e in \u003ccode\u003estatic/javascripts/posts/controllers/new-post.controller.js\u003c/code\u003e&quot;}"/><p>There are a few things going on here that we should talk about.</p><div class="highlight"><pre><span class="err">$</span><span class="vg">rootScope</span><span class="o">.</span><span class="err">$</span><span class="vg">broadcast</span><span class="p">(</span><span class="c1">'post.created', {</span>
<span class="w">  </span><span class="nl">content:</span><span class="w"> </span><span class="err">$</span><span class="vg">scope</span><span class="o">.</span><span class="vg">content</span><span class="p">,</span>
<span class="w">  </span><span class="nl">author:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">username:</span><span class="w"> </span><span class="vg">Authentication</span><span class="o">.</span><span class="vg">getAuthenticatedAccount</span><span class="p">()</span><span class="o">.</span><span class="vg">username</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</pre></div><p>Earlier we set up an event listener in <code>IndexController</code> that listened for the <code>post.created</code> event and then pushed the new post onto the front of <code>vm.posts</code>. Let's look at this a little more closely, as this turns out to be an important feature of rich web applications.</p><p>What we are doing here is being <em>optimistic</em> that the API response from <code>Posts.create()</code> will contain a 200 status code telling us everything went according to plan. This may seem like a bad idea at first. Something could go wrong during the request and then our data is stale. Why don't we just wait for the response?</p><p>When I said we are increasing the <em>perceived</em> performance of our app, this is what I was talking about. We want the user to <em>perceive</em> the response as instant.</p><p>The fact of the matter is that this call will rarely fail. There are only two cases where this will reasonably fail: either the user is not authenticated or the server is down.</p><p>In the case where the user is not authenticated, they shouldn't be submitting new posts anyways. Consider the error to be a small punishment for the user doing things they shouldn't.</p><p>If the server is down, then there is nothing we can do. Unless the user already had the page loaded before the server crashed, they wouldn't be able to see this page anyways.</p><p>Other things that could possibly go wrong make up such a small percentage that we are willing to allow a slightly worse experience to make the experience better for the 99.9% of cases where everything is working properly.</p><p>Furthermore, the object we pass as the second argument is meant to emulate the response from the server. This is not the best design pattern because it assumes we know what the response will look like. If the response changes, we have to update this code. However, given what we have, this is an acceptable cost.</p><p>So what happens when the API call returns an error?</p><div class="highlight"><pre><span class="err">$</span><span class="vg">rootScope</span><span class="o">.</span><span class="err">$</span><span class="vg">broadcast</span><span class="p">(</span><span class="c1">'post.created.error');</span>
</pre></div><p>If the error callback is triggered, then we will broadcast a new event: <code>post.created.error</code>. The event listener we set up earlier will be trigger by this event and remove the post at the front of <code>vm.posts</code>. We will also show the error message to the user to let them know what happened.</p><div class="highlight"><pre><span class="err">$</span><span class="vg">scope</span><span class="o">.</span><span class="vg">closeThisDialog</span><span class="p">();</span>
</pre></div><p>This is a method provided by <code>ngDialog</code>. All it does is close the model we have open. It's also worth nothing that <code>closeThisDialog()</code> is not stored on the ViewModel, so we must call <code>$scope.closeThisDialog()</code> instead of <code>vm.closeThisDialog()</code>.</p><p>Be sure to include <code>new-post.controller.js</code> in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/posts/controllers/new-post.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;js_include_new_post&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003enew-post.controller.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>Visit <code>http://localhost:8000/</code> and click the + button in the bottom-right corner. Fill out this form to create a new post. You will know everything worked because the new post will be displayed at the top of the page.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_new_post&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a new \u003ccode\u003ePost\u003c/code\u003e object via the interface you\u0026#39;ve just created&quot;}"/></div><div class="course-section" id="displaying-user-profiles"><h1>Displaying user profiles</h1><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;display-user-profile&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/f8bd21c7361383171ca7f0b721da8f310bfa35ae.jpg&quot;}"/><p>We already have the Django views and routes necessary to display a profile for each user. From here we can jump into making an AngularJS service and then move on to the template and controllers.</p><p>{info}
In this section and the next, we will refer to accounts as profiles. For the purposes of our client, that is effectively what the <code>Account</code> model translates into: a user's profile.</p>
<h2 id="making-the-profile-modules">Making the profile modules</h2>
<p>We will be creating a service and a couple of controllers relating to user profiles, so let's go ahead and define the modules we will need.</p><p>Create <code>static/javascripts/profiles/profiles.module.js</code> with the following content:</p><div class="highlight"><pre><span class="p">(</span><span class="vg">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">'use strict';</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.profiles', [</span>
<span class="w">      </span><span class="c1">'thinkster.profiles.controllers',</span>
<span class="w">      </span><span class="c1">'thinkster.profiles.services'</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.profiles.controllers', []);</span>

<span class="w">  </span><span class="vg">angular</span>
<span class="w">    </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster.profiles.services', []);</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_modules&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Define the modules needed for profiles in \u003ccode\u003eprofiles.module.js\u003c/code\u003e&quot;}"/><p>As always, don't forget to register <code>thinkster.profiles</code> as a dependency of <code>thinkster</code> in <code>thinkster.js</code>:</p><div class="highlight"><pre><span class="vg">angular</span>
<span class="w">  </span><span class="o">.</span><span class="vg">module</span><span class="p">(</span><span class="c1">'thinkster', [</span>
<span class="w">    </span><span class="c1">'thinkster.config',</span>
<span class="w">    </span><span class="c1">'thinkster.routes',</span>
<span class="w">    </span><span class="c1">'thinkster.authentication',</span>
<span class="w">    </span><span class="c1">'thinkster.layout',</span>
<span class="w">    </span><span class="c1">'thinkster.posts',</span>
<span class="w">    </span><span class="c1">'thinkster.profiles'</span>
<span class="w">  </span><span class="p">]);</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;thinkster_profile_module&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Register \u003ccode\u003ethinkster.profiles\u003c/code\u003e as a dependency of the \u003ccode\u003ethinkster\u003c/code\u003e module&quot;}"/><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/profiles/profiles.module.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
<h2 id="making-a-profile-factory">Making a Profile factory</h2>
<p>With the module definitions in place, we are ready to create the <code>Profile</code> service that will communicate with our API.</p><p>Create <code>static/javascripts/profiles/services/profile.service.js</code> with the following contents:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* Profile</span>
<span class="cm">* @namespace thinkster.profiles.services</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">profiles</span><span class="p">.</span><span class="n">services</span><span class="p">')</span>
    <span class="p">.</span><span class="n">factory</span><span class="p">('</span><span class="n">Profile</span><span class="p">',</span> <span class="n">Profile</span><span class="p">);</span>

  <span class="n">Profile</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">http</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace Profile</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">Profile</span><span class="p">(</span><span class="err">$</span><span class="n">http</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">    * @name Profile</span>
<span class="cm">    * @desc The factory to be returned</span>
<span class="cm">    * @memberOf thinkster.profiles.services.Profile</span>
<span class="cm">    */</span>
    <span class="k">var</span> <span class="n">Profile</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nl">destroy:</span> <span class="n">destroy</span><span class="p">,</span>
      <span class="nl">get:</span> <span class="n">get</span><span class="p">,</span>
      <span class="nl">update:</span> <span class="n">update</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">Profile</span><span class="p">;</span>

    <span class="c1">/////////////////////</span>

    <span class="cm">/**</span>
<span class="cm">    * @name destroy</span>
<span class="cm">    * @desc Destroys the given profile</span>
<span class="cm">    * @param {Object} profile The profile to be destroyed</span>
<span class="cm">    * @returns {Promise}</span>
<span class="cm">    * @memberOf thinkster.profiles.services.Profile</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">destroy</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">delete</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="p">'</span> <span class="o">+</span> <span class="n">profile</span><span class="p">.</span><span class="n">id</span> <span class="o">+</span> <span class="sc">'/'</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name get</span>
<span class="cm">    * @desc Gets the profile for user with username `username`</span>
<span class="cm">    * @param {string} username The username of the user to fetch</span>
<span class="cm">    * @returns {Promise}</span>
<span class="cm">    * @memberOf thinkster.profiles.services.Profile</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">get</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="p">'</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="sc">'/'</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name update</span>
<span class="cm">    * @desc Update the given profile</span>
<span class="cm">    * @param {Object} profile The profile to be updated</span>
<span class="cm">    * @returns {Promise}</span>
<span class="cm">    * @memberOf thinkster.profiles.services.Profile</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">update</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="n">put</span><span class="p">('</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">accounts</span><span class="o">/</span><span class="p">'</span> <span class="o">+</span> <span class="n">profile</span><span class="p">.</span><span class="n">username</span> <span class="o">+</span> <span class="sc">'/'</span><span class="p">,</span> <span class="n">profile</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profiles_factory&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a new factory called \u003ccode\u003eProfiles\u003c/code\u003e in \u003ccode\u003estatic/javascripts/profiles/services/profiles.service.js\u003c/code\u003e&quot;}"/><p>We aren't doing anything special here. Each of these API calls is a basic CRUD operation, so we get away with not having much code.</p><p>Add this file to <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/profiles/services/profile.service.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profiles_service_include_js&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eprofiles.service.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="making-an-interface-for-user-profiles">Making an interface for user profiles</h2>
<p>Create <code>static/templates/profiles/profile.html</code> with the following content:</p><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"profile"</span> <span class="na">ng-show=</span><span class="s">"vm.profile"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"jumbotron profile__header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"profile__username"</span><span class="nt">&gt;</span>+{{ vm.profile.username }}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"profile__tagline"</span><span class="nt">&gt;</span>{{ vm.profile.tagline }}<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;posts</span> <span class="na">posts=</span><span class="s">"vm.posts"</span><span class="nt">&gt;&lt;/posts&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_template&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a template for displaying profiles in \u003ccode\u003estatic/templates/profiles/profile.html\u003c/code\u003e&quot;}"/><p>This will render a header with the username and tagline of the profile owner, followed by a list of their posts. The posts are rendered using the directive we created earlier for the index page.</p>
<h2 id="controlling-the-profile-interface-with-profilecontroller">Controlling the profile interface with ProfileController</h2>
<p>The next step is to create the controller that will use the service we just created, along with the <code>Post</code> service, to retrieve the data we want to display.</p><p>Create <code>static/javascripts/profiles/controllers/profile.controller.js</code> with the following content:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* ProfileController</span>
<span class="cm">* @namespace thinkster.profiles.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">profiles</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">ProfileController</span><span class="p">',</span> <span class="n">ProfileController</span><span class="p">);</span>

  <span class="n">ProfileController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">['</span><span class="err">$</span><span class="n">location</span><span class="p">',</span> <span class="p">'</span><span class="err">$</span><span class="n">routeParams</span><span class="p">',</span> <span class="p">'</span><span class="n">Posts</span><span class="p">',</span> <span class="p">'</span><span class="n">Profile</span><span class="p">',</span> <span class="p">'</span><span class="n">Snackbar</span><span class="p">'];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace ProfileController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">ProfileController</span><span class="p">(</span><span class="err">$</span><span class="n">location</span><span class="p">,</span> <span class="err">$</span><span class="n">routeParams</span><span class="p">,</span> <span class="n">Posts</span><span class="p">,</span> <span class="n">Profile</span><span class="p">,</span> <span class="n">Snackbar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">;</span>
    <span class="n">vm</span><span class="p">.</span><span class="n">posts</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="n">activate</span><span class="p">();</span>

    <span class="cm">/**</span>
<span class="cm">    * @name activate</span>
<span class="cm">    * @desc Actions to be performed when this controller is instantiated</span>
<span class="cm">    * @memberOf thinkster.profiles.controllers.ProfileController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">activate</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">var</span> <span class="n">username</span> <span class="o">=</span> <span class="err">$</span><span class="n">routeParams</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mh">1</span><span class="p">);</span>

      <span class="n">Profile</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">profileSuccessFn</span><span class="p">,</span> <span class="n">profileErrorFn</span><span class="p">);</span>
      <span class="n">Posts</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">postsSuccessFn</span><span class="p">,</span> <span class="n">postsErrorFn</span><span class="p">);</span>

      <span class="cm">/**</span>
<span class="cm">      * @name profileSuccessProfile</span>
<span class="cm">      * @desc Update `profile` on viewmodel</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">      * @name profileErrorFn</span>
<span class="cm">      * @desc Redirect to index and show error Snackbar</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">That</span> <span class="n">user</span> <span class="n">does</span> <span class="k">not</span> <span class="n">exist</span><span class="p">.');</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">        * @name postsSucessFn</span>
<span class="cm">        * @desc Update `posts` on viewmodel</span>
<span class="cm">        */</span>
      <span class="k">function</span> <span class="n">postsSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">posts</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">        * @name postsErrorFn</span>
<span class="cm">        * @desc Show error snackbar</span>
<span class="cm">        */</span>
      <span class="k">function</span> <span class="n">postsErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a new controller called \u003ccode\u003eProfileController\u003c/code\u003e in \u003ccode\u003estatic/javascripts/profiles/controllers/profile.controller.js\u003c/code\u003e&quot;}"/><p>Include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/profiles/controllers/profile.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_controller_include_js&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eprofile.controller.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/>
<h2 id="making-a-route-for-viewing-user-profiles">Making a route for viewing user profiles</h2>
<p>Open <code>static/javascripts/thinkster.routes.js</code> and add the following route:</p><div class="highlight"><pre><span class="o">.</span><span class="vg">when</span><span class="p">(</span><span class="c1">'/+:username', {</span>
<span class="w">  </span><span class="nl">controller:</span><span class="w"> </span><span class="c1">'ProfileController',</span>
<span class="w">  </span><span class="nl">controllerAs:</span><span class="w"> </span><span class="c1">'vm',</span>
<span class="w">  </span><span class="nl">templateUrl:</span><span class="w"> </span><span class="c1">'/static/templates/profiles/profile.html'</span>
<span class="p">})</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_route&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Make a route for viewing user profiles&quot;}"/>
<h2 id="checkpoint">Checkpoint</h2>
<p>To view your profile, direct your browser to <code>http://localhost:8000/+&lt;username&gt;</code>. If the page renders, everything is good!</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_display_user_profile&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Visit your profile page at \u003ccode\u003ehttp://localhost:8000/+\u0026lt;username\u0026gt;\u003c/code\u003e&quot;}"/></div><div class="course-section" id="updating-user-profiles"><h1>Updating user profiles</h1><p>The last feature we will implement in this tutorial is the ability for a user to update their profile. The updates we offer will be minimal, including updating the user's first name, last name, email, and tagline, but you will get the gist of it and can add more options at will.</p><p data-react-class="Course.Video" data-react-props="{&quot;slug&quot;:&quot;update-user-profile&quot;,&quot;provider&quot;:&quot;wistia&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;pro&quot;:false,&quot;thumbnailUrl&quot;:&quot;https://embed-ssl.wistia.com/deliveries/f2731556ae0c88585e2c94bd7bceb7637c50bdd7.jpg&quot;}"/>
<h2 id="profilesettingscontroller">ProfileSettingsController</h2>
<p>To get started, open <code>static/javascripts/profiles/controllers/profile-settings.controller.js</code> and add the following contents:</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">* ProfileSettingsController</span>
<span class="cm">* @namespace thinkster.profiles.controllers</span>
<span class="cm">*/</span>
<span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="p">'</span><span class="k">use</span> <span class="n">strict</span><span class="p">';</span>

  <span class="n">angular</span>
    <span class="p">.</span><span class="k">module</span><span class="p">('</span><span class="n">thinkster</span><span class="p">.</span><span class="n">profiles</span><span class="p">.</span><span class="n">controllers</span><span class="p">')</span>
    <span class="p">.</span><span class="n">controller</span><span class="p">('</span><span class="n">ProfileSettingsController</span><span class="p">',</span> <span class="n">ProfileSettingsController</span><span class="p">);</span>

  <span class="n">ProfileSettingsController</span><span class="p">.</span><span class="err">$</span><span class="n">inject</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">'</span><span class="err">$</span><span class="n">location</span><span class="p">',</span> <span class="p">'</span><span class="err">$</span><span class="n">routeParams</span><span class="p">',</span> <span class="p">'</span><span class="n">Authentication</span><span class="p">',</span> <span class="p">'</span><span class="n">Profile</span><span class="p">',</span> <span class="p">'</span><span class="n">Snackbar</span><span class="p">'</span>
  <span class="p">];</span>

  <span class="cm">/**</span>
<span class="cm">  * @namespace ProfileSettingsController</span>
<span class="cm">  */</span>
  <span class="k">function</span> <span class="n">ProfileSettingsController</span><span class="p">(</span><span class="err">$</span><span class="n">location</span><span class="p">,</span> <span class="err">$</span><span class="n">routeParams</span><span class="p">,</span> <span class="n">Authentication</span><span class="p">,</span> <span class="n">Profile</span><span class="p">,</span> <span class="n">Snackbar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="n">vm</span><span class="p">.</span><span class="n">destroy</span> <span class="o">=</span> <span class="n">destroy</span><span class="p">;</span>
    <span class="n">vm</span><span class="p">.</span><span class="n">update</span> <span class="o">=</span> <span class="n">update</span><span class="p">;</span>

    <span class="n">activate</span><span class="p">();</span>


    <span class="cm">/**</span>
<span class="cm">    * @name activate</span>
<span class="cm">    * @desc Actions to be performed when this controller is instantiated.</span>
<span class="cm">    * @memberOf thinkster.profiles.controllers.ProfileSettingsController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">activate</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">var</span> <span class="n">authenticatedAccount</span> <span class="o">=</span> <span class="n">Authentication</span><span class="p">.</span><span class="n">getAuthenticatedAccount</span><span class="p">();</span>
      <span class="k">var</span> <span class="n">username</span> <span class="o">=</span> <span class="err">$</span><span class="n">routeParams</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mh">1</span><span class="p">);</span>

      <span class="c1">// Redirect if not logged in</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">authenticatedAccount</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">You</span> <span class="n">are</span> <span class="k">not</span> <span class="n">authorized</span> <span class="n">to</span> <span class="n">view</span> <span class="k">this</span> <span class="n">page</span><span class="p">.');</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Redirect if logged in, but not the owner of this profile.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">authenticatedAccount</span><span class="p">.</span><span class="n">username</span> <span class="o">!==</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
          <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
          <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">You</span> <span class="n">are</span> <span class="k">not</span> <span class="n">authorized</span> <span class="n">to</span> <span class="n">view</span> <span class="k">this</span> <span class="n">page</span><span class="p">.');</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="n">Profile</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">profileSuccessFn</span><span class="p">,</span> <span class="n">profileErrorFn</span><span class="p">);</span>

      <span class="cm">/**</span>
<span class="cm">      * @name profileSuccessFn</span>
<span class="cm">      * @desc Update `profile` for view</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="cm">/**</span>
<span class="cm">      * @name profileErrorFn</span>
<span class="cm">      * @desc Redirect to index</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">That</span> <span class="n">user</span> <span class="n">does</span> <span class="k">not</span> <span class="n">exist</span><span class="p">.');</span>
      <span class="p">}</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name destroy</span>
<span class="cm">    * @desc Destroy this user's profile</span>
<span class="cm">    * @memberOf thinkster.profiles.controllers.ProfileSettingsController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">destroy</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Profile</span><span class="p">.</span><span class="n">destroy</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">profile</span><span class="p">.</span><span class="n">username</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">profileSuccessFn</span><span class="p">,</span> <span class="n">profileErrorFn</span><span class="p">);</span>

      <span class="cm">/**</span>
<span class="cm">      * @name profileSuccessFn</span>
<span class="cm">      * @desc Redirect to index and display success snackbar</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Authentication</span><span class="p">.</span><span class="n">unauthenticate</span><span class="p">();</span>
        <span class="n">window</span><span class="p">.</span><span class="n">location</span> <span class="o">=</span> <span class="sc">'/'</span><span class="p">;</span>

        <span class="n">Snackbar</span><span class="p">.</span><span class="n">show</span><span class="p">('</span><span class="n">Your</span> <span class="n">account</span> <span class="n">has</span> <span class="n">been</span> <span class="n">deleted</span><span class="p">.');</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">      * @name profileErrorFn</span>
<span class="cm">      * @desc Display error snackbar</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>


    <span class="cm">/**</span>
<span class="cm">    * @name update</span>
<span class="cm">    * @desc Update this user's profile</span>
<span class="cm">    * @memberOf thinkster.profiles.controllers.ProfileSettingsController</span>
<span class="cm">    */</span>
    <span class="k">function</span> <span class="n">update</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Profile</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">profile</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">profileSuccessFn</span><span class="p">,</span> <span class="n">profileErrorFn</span><span class="p">);</span>

      <span class="cm">/**</span>
<span class="cm">      * @name profileSuccessFn</span>
<span class="cm">      * @desc Show success snackbar</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">show</span><span class="p">('</span><span class="n">Your</span> <span class="n">profile</span> <span class="n">has</span> <span class="n">been</span> <span class="n">updated</span><span class="p">.');</span>
      <span class="p">}</span>


      <span class="cm">/**</span>
<span class="cm">      * @name profileErrorFn</span>
<span class="cm">      * @desc Show error snackbar</span>
<span class="cm">      */</span>
      <span class="k">function</span> <span class="n">profileErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_settings_controller&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create the \u003ccode\u003eProfileSettingsController\u003c/code\u003e controller&quot;}"/><p>Be sure to include this file in <code>javascripts.html</code>:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"{% static 'javascripts/profiles/controllers/profile-settings.controller.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_settings_controller_include_js&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Include \u003ccode\u003eprofile-settings.controller.js\u003c/code\u003e in \u003ccode\u003ejavascripts.html\u003c/code\u003e&quot;}"/><p>Here we have created two methods that will be available to the view: <code>update</code> and <code>destroy</code>. As their names suggest, <code>update</code> will allow the user to update their profile and <code>destroy</code> will destroy the user's account.</p><p>Most of this controller should look familiar, but let's go over the methods we've created for clarity.</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name activate</span>
<span class="cm"> * @desc Actions to be performed when this controller is instantiated.</span>
<span class="cm"> * @memberOf thinkster.profiles.controllers.ProfileSettingsController</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">activate</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">var</span> <span class="n">authenticatedAccount</span> <span class="o">=</span> <span class="n">Authentication</span><span class="p">.</span><span class="n">getAuthenticatedAccount</span><span class="p">();</span>
  <span class="k">var</span> <span class="n">username</span> <span class="o">=</span> <span class="err">$</span><span class="n">routeParams</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mh">1</span><span class="p">);</span>

  <span class="c1">// Redirect if not logged in</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">authenticatedAccount</span><span class="p">)</span> <span class="p">{</span>
    <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
    <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">You</span> <span class="n">are</span> <span class="k">not</span> <span class="n">authorized</span> <span class="n">to</span> <span class="n">view</span> <span class="k">this</span> <span class="n">page</span><span class="p">.');</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Redirect if logged in, but not the owner of this profile.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">authenticatedAccount</span><span class="p">.</span><span class="n">username</span> <span class="o">!==</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
      <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
      <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">You</span> <span class="n">are</span> <span class="k">not</span> <span class="n">authorized</span> <span class="n">to</span> <span class="n">view</span> <span class="k">this</span> <span class="n">page</span><span class="p">.');</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">Profile</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">profileSuccessFn</span><span class="p">,</span> <span class="n">profileErrorFn</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">   * @name profileSuccessFn</span>
<span class="cm">   * @desc Update `profile` for view</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">profileSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vm</span><span class="p">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * @name profileErrorFn</span>
<span class="cm">   * @desc Redirec to index</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">profileErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="err">$</span><span class="n">location</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="sc">'/'</span><span class="p">);</span>
    <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">('</span><span class="n">That</span> <span class="n">user</span> <span class="n">does</span> <span class="k">not</span> <span class="n">exist</span><span class="p">.');</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><p>In <code>activate</code>, we follow a familiar pattern. Because this page allows for dangerous operations to be performed, we must make sure the current user is authorized to see this page. We do this by first checking if the user is authenticated and then checking if the authenticated user owns the profile. If either case is false, then we redirect to the index page with a snackbar error stating that the user is not authorized to view this page.</p><p>If the authorization process succeeds, we simply grab the user's profile from the server and allow the user to do as they wish.</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name destroy</span>
<span class="cm"> * @desc Destroy this user's profile</span>
<span class="cm"> * @memberOf thinkster.profiles.controllers.ProfileSettingsController</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">destroy</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Profile</span><span class="p">.</span><span class="n">destroy</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">profile</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">profileSuccessFn</span><span class="p">,</span> <span class="n">profileErrorFn</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">   * @name profileSuccessFn</span>
<span class="cm">   * @desc Redirect to index and display success snackbar</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">profileSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Authentication</span><span class="p">.</span><span class="n">unauthenticate</span><span class="p">();</span>
    <span class="n">window</span><span class="p">.</span><span class="n">location</span> <span class="o">=</span> <span class="sc">'/'</span><span class="p">;</span>

    <span class="n">Snackbar</span><span class="p">.</span><span class="n">show</span><span class="p">('</span><span class="n">Your</span> <span class="n">account</span> <span class="n">has</span> <span class="n">been</span> <span class="n">deleted</span><span class="p">.');</span>
  <span class="p">}</span>


  <span class="cm">/**</span>
<span class="cm">   * @name profileErrorFn</span>
<span class="cm">   * @desc Display error snackbar</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">profileErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><p>When a user wishes to destroy their profile, we must unauthenticate them and redirect to the index page, performing a page refresh in the process. This will make the navigation bar re-render with the logged out view.</p><p>If for some reason destroying the user's profile returns an error status code, we simply display an error snackbar with the error message returned by the server. We do not perform any other actions because we see no reason why this call should fail unless the user is not authorized to delete this profile, but we have already accounted for this scenario in the <code>activate</code> method.</p><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @name update</span>
<span class="cm"> * @desc Update this user's profile</span>
<span class="cm"> * @memberOf thinkster.profiles.controllers.ProfileSettingsController</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="n">update</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Profile</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">profile</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">profileSuccessFn</span><span class="p">,</span> <span class="n">profileErrorFn</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">   * @name profileSuccessFn</span>
<span class="cm">   * @desc Show success snackbar</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">profileSuccessFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Snackbar</span><span class="p">.</span><span class="n">show</span><span class="p">('</span><span class="n">Your</span> <span class="n">profile</span> <span class="n">has</span> <span class="n">been</span> <span class="n">updated</span><span class="p">.');</span>
  <span class="p">}</span>


  <span class="cm">/**</span>
<span class="cm">   * @name profileErrorFn</span>
<span class="cm">   * @desc Show error snackbar</span>
<span class="cm">   */</span>
  <span class="k">function</span> <span class="n">profileErrorFn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="k">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Snackbar</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><p><code>update()</code> is very simple. Whether the call succeeds or fails, we show a snackbar with the appropriate message.</p>
<h2 id="a-template-for-the-settings-page">A template for the settings page</h2>
<p>As usual, now that we have the controller we need to make a corresponding template.</p><p>Create <code>static/templates/profiles/settings.html</code> with the following content:</p><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4 col-md-offset-4"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"well"</span> <span class="na">ng-show=</span><span class="s">"vm.profile"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">role=</span><span class="s">"form"</span> <span class="na">class=</span><span class="s">"settings"</span> <span class="na">ng-submit=</span><span class="s">"vm.update()"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"settings__email"</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"settings__email"</span> <span class="na">ng-model=</span><span class="s">"vm.profile.email"</span> <span class="na">placeholder=</span><span class="s">"ex. john@example.com"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"settings__password"</span><span class="nt">&gt;</span>New Password<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"settings__password"</span> <span class="na">ng-model=</span><span class="s">"vm.profile.password"</span> <span class="na">placeholder=</span><span class="s">"ex. notgoogleplus"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"settings__confirm-password"</span><span class="nt">&gt;</span>Confirm Password<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"settings__confirm-password"</span> <span class="na">ng-model=</span><span class="s">"vm.profile.confirm_password"</span> <span class="na">placeholder=</span><span class="s">"ex. notgoogleplus"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"settings__username"</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"settings__username"</span> <span class="na">ng-model=</span><span class="s">"vm.profile.username"</span> <span class="na">placeholder=</span><span class="s">"ex. notgoogleplus"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"settings__tagline"</span><span class="nt">&gt;</span>Tagline<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"settings__tagline"</span> <span class="na">ng-model=</span><span class="s">"vm.profile.tagline"</span> <span class="na">placeholder=</span><span class="s">"ex. This is Not Google Plus."</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-danger pull-right"</span> <span class="na">ng-click=</span><span class="s">"vm.destroy()"</span><span class="nt">&gt;</span>Delete Account<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;profile_settings_html&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Create a template for \u003ccode\u003eProfileSettingsController\u003c/code\u003e&quot;}"/><p>This template is similar to the forms we created for registering and logging in. There is nothing here worth discussing. </p>
<h2 id="profile-settings-route">Profile settings route</h2>
<p>Open up <code>static/javascripts/thinkster.routes.js</code> and add the following route:</p><div class="highlight"><pre><span class="c1">// ...</span>
<span class="p">.</span><span class="n">when</span><span class="p">('</span><span class="o">/+:</span><span class="n">username</span><span class="o">/</span><span class="n">settings</span><span class="p">',</span> <span class="p">{</span>
  <span class="nl">controller:</span> <span class="p">'</span><span class="n">ProfileSettingsController</span><span class="p">',</span>
  <span class="nl">controllerAs:</span> <span class="p">'</span><span class="n">vm</span><span class="p">',</span>
  <span class="nl">templateUrl:</span> <span class="p">'</span><span class="o">/</span><span class="k">static</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">profiles</span><span class="o">/</span><span class="n">settings</span><span class="p">.</span><span class="n">html</span><span class="p">'</span>
<span class="p">})</span>
<span class="c1">// ...</span>
</pre></div>
<h2 id="checkpoint">Checkpoint</h2>
<p>And that's our last feature! You should now be able to load up the settings page at <code>http://localhost:8000/+:username/settings</code> and update your settings as you wish.</p><p>Try updating your tagline. If it works, you will now see your tagline displayed on your profile page.</p><p data-react-class="Course.Checkbox" data-react-props="{&quot;checkboxSlug&quot;:&quot;checkpoint_update_user_profile&quot;,&quot;courseSlug&quot;:&quot;django-angularjs-tutorial&quot;,&quot;content&quot;:&quot;Update your tagline and view the new tagline on your profile page&quot;}"/></div><div class="course-section" id="congratulations-you-did-it"><h1>Congratulations, you did it!</h1><p>During this tutorial you accomplished a lot.</p><p>For starters, you build an entire authentication system by yourself! You extended Django's built-in <code>User</code> model and added various attributes and did so in a way that makes adding other information an easy feat when it becomes necessary. You went on to built both the front and back ends for registration, logging in, logging out, and updating the user's profile.</p><p>In addition to building the authentication system you also create a way for users to add their posts to our application and view other users' posts.</p><p>This is the stuff that we do as engineers of the web. There will be times when you will need skills learned outside this tutorial and there are certainly best practices that we did not touch on, but what you've done here is the gist of web development!</p><p>Be proud of what you've accomplished here and tell you friends by <a href="https://twitter.com/intent/tweet?text=I%20just%20built%20a%20Google%20Plus%20clone%20with%20%23django%20and%20%23angularjs!&amp;url=http%3A%2F%2Fthinkster.io%2F&amp;via=gothinkster" target="_blank">tweeting about it</a>. We hope that you enjoyed this tutorial and will come back when you want to learn more. As always, our inbox is open to your comments, suggestions, and feedback.</p><p>Happy hacking!</p>
<h2 id="contributors">Contributors</h2>
<p>Before you go, I want to give a shoutout to all of the people who were kind enough to send us emails and pull requests.</p><p>Here is a full list of contributors who helped with the current release:</p><p>Albert Pai, Christophe Blefari, Diego Martinez, Eric Simons, Ernest Ezis, Iulian Gulea, James Brewer, Lorenzo Cinque, Martin Hill, Martin Oosthuizen, Matt Green, Ronald Paloschi, Seth Clossman, Vladimir Vitvitskiy, Zach Reinhardt</p></div>
      </div>
    </div></body></html>