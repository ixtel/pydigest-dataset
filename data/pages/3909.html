<html><body><div><div class="col-md-12">
				<p>You’ve coded your way through the harrowing challenges of the first <a href="https://www.twilio.com/blog/2014/11/choose-your-own-adventure-presentations-with-reveal-js-python-and-websockets.html">Choose Your Own Adventure Presentations</a> tutorial. A sign lies in the road ahead. “PyCon has summoned you to give a <a href="https://us.pycon.org/2015/schedule/presentation/336/">Choose Your Own Adventure talk in Montreal</a>!” it reads.</p>
<p>—————</p>
<p><em>How do you proceed? If you choose to run from the PyCon challenge, close the browser window now. If you accept the challenge, prepare yourself for the dangers ahead with the new Wizard Mode functionality and continuing reading this blog post.</em></p>
<p>—————</p>
<p>You’re still here, adventurer! Let’s get to work. In this series of three blog posts we’re going to expand the <a href="https://github.com/makaimc/choose-your-own-adventure-presentations">Choose Your Own Adventure Presentations application</a> with new a Wizard Mode. If you haven’t yet worked through the original blog post I highly recommend doing that before working through this series. The section below named “A Clean Starting Point” will get you set up for this tutorial if you’ve already gone through the original <a href="https://www.twilio.com/blog/2014/11/choose-your-own-adventure-presentations-with-reveal-js-python-and-websockets.html">Choose Your Own Adventure Presentations post</a> and just need a fresh copy of the code.</p>
<p>What’s this mysterious Wizard Mode we’re building? Think of it as an administrative interface that grants you, the presenting wizard, with new magical powers to control your presentations and how the audience can vote for story choices. The interface will only be accessible by authorized wizards through the sign-in page which will look like the following screenshot.</p>
<p><img alt="sign-in-preview.jpg" src="https://lh4.googleusercontent.com/3EgZQC4C8Q9JXv82qJ5h_udcALD9ZwT683XxSurbWjvQ-SG-uAx_EWZZ5BF1g-OmU3n85uEMsfgqyVkFnw_6ujN4ivTvmZjnYE0LQJguuXwQa-1o7rlvDo5KBgxQLqfGrdzXl8A"/></p>
<p>Once you’re inside the application you’ll be able to manage one or more Choose Your Own Adventure Presentations with a simple screen like this one:</p>
<p><img alt="wizard-panel.png" src="https://lh3.googleusercontent.com/Tu6oQPhL-OSNo-8d3I6qND0hzXbNK6WvfCcV0DrdkYAcROemTRhVFv2UOyY1t14A52-6gm4o6WTlXIDid-PDicLFP42qe7TO4AM6qRqvgel4sfthrV3WiF2M99sy4EpvzLBqH3w"/></p>
<p>As we go about building our new Wizard Mode you’ll learn about Flask <a href="http://en.wikipedia.org/wiki/Form_%28HTML%29">form</a> handling, <a href="http://www.fullstackpython.com/websockets.html">WebSockets</a> and how to persist presentation data to a <a href="http://www.postgresql.org/">PostgreSQL database</a>.</p>
<p>There are three posts in this tutorial series where we will incrementally build out functionality:</p>
<ol>
<li><strong>Wizards Only</strong>: this blog post, where we’ll create a section of the application only authorized wizards can access</li>
<li><strong>Even Wizards Need Web Forms</strong>: the next blog post where we expand the wizard only pages to control our presentations</li>
<li><strong>Voting with a Wand, or Smartphone</strong>: our third and final post where we add a new magical trick to our presentations – voting via web browser when poor cell service prevents SMS voting</li>
</ol>
<p>At the end of each post we’ll be able to test what we just built to make sure it’s working properly. If something goes wrong while you’re working through the tutorial, the Git tag <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/tree/tutorial-step-4">tutorial-step-4 tag</a> has the end result for code written in this post.</p>
<p>Let’s get to work!</p>
<h2 dir="ltr">What We’ll Need</h2>
<p>We’ll continue using open source code to build our project including the <a href="https://github.com/makaimc/choose-your-own-adventure-presentations">existing Choose Your Own Adventure Presentations code base</a>, <a href="http://www.postgresql.org">PostgreSQL</a> and several additional Python libraries. Don’t worry about downloading anything just yet – we will grab these tools throughout the tutorial. This list is just so you know ahead of time what’ll be installed along the way:</p>

<p>Finally, time to roll up the magical cloak sleeves and dive into coding.</p>
<h2 dir="ltr">A Clean Starting Point</h2>
<p>If you just worked through the <a href="https://www.twilio.com/blog/2014/11/choose-your-own-adventure-presentations-with-reveal-js-python-and-websockets.html">original Choose Your Own Adventure Presentation blog post</a> and have your code ready then you can skip this section and go to “Wizards Only”.</p>
<p>Clone a copy of the Git repository of the code from GitHub:</p>
<p>
			<span id="crayon-56d5aab701951519069960" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">git </span><span class="crayon-r">clone</span><span class="crayon-h"> </span><span class="crayon-v">git</span><span class="crayon-sy">@</span><span class="crayon-v">github</span><span class="crayon-sy">.</span><span class="crayon-v">com</span><span class="crayon-o">:</span><span class="crayon-v">makaimc</span><span class="crayon-o">/</span><span class="crayon-v">choose</span><span class="crayon-o">-</span><span class="crayon-v">your</span><span class="crayon-o">-</span><span class="crayon-v">own</span><span class="crayon-o">-</span><span class="crayon-v">adventure</span><span class="crayon-o">-</span><span class="crayon-v">presentations</span></span></span></p>
<p>Change into the directory of our newly cloned repository.</p>
<p>
			<span id="crayon-56d5aab701966066686939" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">cd </span><span class="crayon-v">choose</span><span class="crayon-o">-</span><span class="crayon-v">your</span><span class="crayon-o">-</span><span class="crayon-v">own</span><span class="crayon-o">-</span><span class="crayon-v">adventure</span><span class="crayon-o">-</span><span class="crayon-v">presentations</span></span></span></p>
<p>Next, the code we need is found in the tutorial-step-3 tag, so we’ll create a new Git branch with that code to work from.</p>
<p>
			<span id="crayon-56d5aab701971119395277" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">git </span><span class="crayon-v">checkout</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">b</span><span class="crayon-h"> </span><span class="crayon-e">tutorial </span><span class="crayon-v">tags</span><span class="crayon-o">/</span><span class="crayon-v">tutorial</span><span class="crayon-o">-</span><span class="crayon-v">step</span><span class="crayon-o">-</span><span class="crayon-cn">3</span></span></span></p>
<p>Create a <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> that will hold our Python dependencies with the following commands. If you already have a directory where you keep your virtualenvs, you can skip the first step and place your new virtualenv in that existing directory.</p>
<p>
			<span id="crayon-56d5aab70197b491628529" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">mkdir</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-o">/</span><span class="crayon-v">Envs</span><span class="crayon-o">/</span></span></span></p>
<p>
			<span id="crayon-56d5aab701985288769558" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">virtualenv</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-o">/</span><span class="crayon-v">Envs</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span></span></span></p>
<p>
			<span id="crayon-56d5aab70198f137332946" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-o">/</span><span class="crayon-v">Envs</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">bin</span><span class="crayon-o">/</span><span class="crayon-v">activate</span></span></span></p>
<p>When you enter the last of those commands above your prompt should change to look something like this:</p>
<p>
			<span id="crayon-56d5aab701999455037608" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-sy">(</span><span class="crayon-v">cyoa</span><span class="crayon-sy">)</span><span class="crayon-sy">$</span></span></span></p>
<p>That prompt means we’re ready to install our dependencies into our new virtualenv using pip:</p>
<p>
			<span id="crayon-56d5aab7019a3618729101" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">pip </span><span class="crayon-v">install</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-v">requirements</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span></span></span></p>
<p>Finally, there are several environment variables that need to be set so our application runs properly. These variables can be found in the 
			<span id="crayon-56d5aab7019ad079357270" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file. Here’s a rundown of what each of these environment variables is for:</p>
<ol>
<li>
			<span id="crayon-56d5aab7019b6852226353" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">DEBUG</span></span></span> – True or False for whether Flask should display error messages if something goes wrong</li>
<li>
			<span id="crayon-56d5aab7019c0093031225" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">SECRET_KEY</span></span></span> – a long key that should be kept secret</li>
<li>
			<span id="crayon-56d5aab7019ca943233481" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">REDIS_SERVER</span></span></span> – in this case likely to be localhost or wherever Redis is running</li>
<li>
			<span id="crayon-56d5aab7019d3042028200" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">REDIS_PORT</span></span></span> – generally set to 6379 for the default Redis port</li>
<li>
			<span id="crayon-56d5aab7019dd634648743" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">REDIS_DB</span></span></span> – set to 0</li>
<li>
			<span id="crayon-56d5aab7019e7084231270" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_ACCOUNT_SID</span></span></span> – found on your <a href="https://www.twilio.com/user/account">Twilio account dashboard</a></li>
<li>
			<span id="crayon-56d5aab7019f0353938620" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_AUTH_TOKEN</span></span></span> – also found on your <a href="https://www.twilio.com/user/account">Twilio account dashboard</a></li>
<li>
			<span id="crayon-56d5aab7019fa364772012" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">TWILIO_NUMBER</span></span></span> – a number you’ve <a href="https://www.twilio.com/phone-numbers">purchased on Twilio</a></li>
</ol>
<p>Setting up environment variables depends on your operating system. Here are guides for every major operating system, whether you’re using <a href="https://help.ubuntu.com/community/EnvironmentVariables">Ubuntu Linux</a>, <a href="http://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x">Mac OS X</a> or <a href="http://www.computerhope.com/issues/ch000549.htm">Windows</a>.</p>
<p>Great! Now our code and environment is ready to roll for the rest of the tutorial. Let’s write some new Python code.</p>
<h2 dir="ltr">Wizards Only</h2>
<p>We’re going to create the wizard’s panel to control multiple presentations and how our audience can interact with them. First though we need a way to sort wizards from non-wizards in the form of a sign-in screen.</p>
<p>We’re going to use four new Python code libraries in this post so let’s get those added to our project. These new libraries are highlighted below. Update the requirements.txt file so it matches the following code.</p>

		<div id="crayon-56d5aab701a04128666338" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701a04128666338-1"><span class="crayon-v">Flask</span><span class="crayon-o">==</span><span class="crayon-cn">0.10.1</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a04128666338-2"><span class="crayon-v">Flask</span><span class="crayon-o">-</span><span class="crayon-v">Script</span><span class="crayon-o">==</span><span class="crayon-cn">2.0.5</span></p><p class="crayon-line" id="crayon-56d5aab701a04128666338-3"><span class="crayon-v">Flask</span><span class="crayon-o">-</span><span class="crayon-v">SocketIO</span><span class="crayon-o">==</span><span class="crayon-cn">0.4.1</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5aab701a04128666338-4"><span class="crayon-v">Flask</span><span class="crayon-o">-</span><span class="crayon-v">Login</span><span class="crayon-o">==</span><span class="crayon-cn">0.2.11</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701a04128666338-5"><span class="crayon-v">Flask</span><span class="crayon-o">-</span><span class="crayon-v">SQLAlchemy</span><span class="crayon-o">==</span><span class="crayon-cn">2.0</span></p><p class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-56d5aab701a04128666338-6"><span class="crayon-v">Flask</span><span class="crayon-o">-</span><span class="crayon-v">WTF</span><span class="crayon-o">==</span><span class="crayon-cn">0.10.3</span></p><p class="crayon-line" id="crayon-56d5aab701a04128666338-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a04128666338-8"><span class="crayon-v">gunicorn</span><span class="crayon-o">==</span><span class="crayon-cn">19.1.1</span></p><p class="crayon-line" id="crayon-56d5aab701a04128666338-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a04128666338-10"><span class="crayon-v">redis</span><span class="crayon-o">==</span><span class="crayon-cn">2.10.3</span></p><p class="crayon-line" id="crayon-56d5aab701a04128666338-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a04128666338-12"><span class="crayon-v">twilio</span><span class="crayon-o">==</span><span class="crayon-cn">3.6.8</span></p><p class="crayon-line" id="crayon-56d5aab701a04128666338-13"> </p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-56d5aab701a04128666338-14"><span class="crayon-v">psycopg2</span><span class="crayon-o">==</span><span class="crayon-cn">2.5.4</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Make sure to active your project’s virtualenv and install the new dependencies with pip using these two steps:</p>
<p>
			<span id="crayon-56d5aab701a0e753238663" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-o">/</span><span class="crayon-v">Envs</span><span class="crayon-o">/</span><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">bin</span><span class="crayon-o">/</span><span class="crayon-v">activate</span></span></span></p>
<p>
			<span id="crayon-56d5aab701a18111018179" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">pip </span><span class="crayon-v">install</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-v">requirements</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span></span></span></p>
<p>With our new dependencies in place we can create our Wizards Only sign-in page.</p>
<p>Create a new file named 
			<span id="crayon-56d5aab701a22070692730" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> within the 
			<span id="crayon-56d5aab701a2b410885114" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span></span></span> subdirectory to store information about wizards. The file should have the following contents:</p>

		<div id="crayon-56d5aab701a35803134070" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-2">2</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-4">4</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-6">6</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-8">8</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-10">10</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-12">12</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-14">14</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-16">16</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-18">18</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-20">20</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-22">22</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-24">24</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-26">26</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-28">28</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a35803134070-30">30</p><p class="crayon-num" data-line="crayon-56d5aab701a35803134070-31">31</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701a35803134070-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">login </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">UserMixin</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">werkzeug</span><span class="crayon-sy">.</span><span class="crayon-e">security </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">generate_password_hash</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">check_password_hash</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">db</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-5"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-6"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Wizard</span><span class="crayon-sy">(</span><span class="crayon-v">UserMixin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-v">Model</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-7"><span class="crayon-h">    </span><span class="crayon-s">"""</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-8"><span class="crayon-s">        Represents a wizard who can access special parts of the application.</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-9"><span class="crayon-s">    """</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-10"><span class="crayon-h">    </span><span class="crayon-v">__tablename__</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'wizards'</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-11"><span class="crayon-h">    </span><span class="crayon-k ">id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">Column</span><span class="crayon-sy">(</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-v">Integer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">primary_key</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-12"><span class="crayon-h">    </span><span class="crayon-v">wizard_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">Column</span><span class="crayon-sy">(</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-k ">String</span><span class="crayon-sy">(</span><span class="crayon-cn">64</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">unique</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-13"><span class="crayon-h">    </span><span class="crayon-v">password_hash</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">Column</span><span class="crayon-sy">(</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-k ">String</span><span class="crayon-sy">(</span><span class="crayon-cn">128</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-14"> </p><p class="crayon-line" id="crayon-56d5aab701a35803134070-15"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">wizard_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-16"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">wizard_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">wizard_name</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-17"><span class="crayon-e">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">password</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">password</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-18"> </p><p class="crayon-line" id="crayon-56d5aab701a35803134070-19"><span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-k ">property</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-20"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">password</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-21"><span class="crayon-h">        </span><span class="crayon-st">raise</span><span class="crayon-h"> </span><span class="crayon-k ">AttributeError</span><span class="crayon-sy">(</span><span class="crayon-s">'password is not readable'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-22"> </p><p class="crayon-line" id="crayon-56d5aab701a35803134070-23"><span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-v">password</span><span class="crayon-sy">.</span><span class="crayon-e">setter</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-24"><span class="crayon-e">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">password</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-25"><span class="crayon-h">        </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">password_hash</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_password_hash</span><span class="crayon-sy">(</span><span class="crayon-v">password</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-26"> </p><p class="crayon-line" id="crayon-56d5aab701a35803134070-27"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">verify_password</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-28"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">check_password_hash</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">password_hash</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">password</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-29"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a35803134070-30"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__repr__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701a35803134070-31"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">wizard_name</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Next we need to modify the 
			<span id="crayon-56d5aab701a3f084172767" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file to create a login manager. The login manager will allow us to control access to wizard settings.</p>
<p/>

		<div id="crayon-56d5aab701a49363481232" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5aab701a49363481232-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-2">2</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d5aab701a49363481232-3">3</p><p class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-56d5aab701a49363481232-4">4</p><p class="crayon-num" data-line="crayon-56d5aab701a49363481232-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-6">6</p><p class="crayon-num" data-line="crayon-56d5aab701a49363481232-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-8">8</p><p class="crayon-num" data-line="crayon-56d5aab701a49363481232-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-10">10</p><p class="crayon-num" data-line="crayon-56d5aab701a49363481232-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-12">12</p><p class="crayon-num" data-line="crayon-56d5aab701a49363481232-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-14">14</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d5aab701a49363481232-15">15</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-16">16</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701a49363481232-17">17</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-18">18</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5aab701a49363481232-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-20">20</p><p class="crayon-num" data-line="crayon-56d5aab701a49363481232-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701a49363481232-22">22</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701a49363481232-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">redis</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span></p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d5aab701a49363481232-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">login </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">LoginManager</span></p><p class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-56d5aab701a49363481232-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">sqlalchemy </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">SQLAlchemy</span></p><p class="crayon-line" id="crayon-56d5aab701a49363481232-5"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">socketio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">SocketIO</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-6"> </p><p class="crayon-line" id="crayon-56d5aab701a49363481232-7"><span class="crayon-v">app</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flask</span><span class="crayon-sy">(</span><span class="crayon-v">__name__</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">static_url_path</span><span class="crayon-o">=</span><span class="crayon-s">'/static'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-8"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-e">from_pyfile</span><span class="crayon-sy">(</span><span class="crayon-s">'config.py'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a49363481232-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-10"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">config </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">REDIS_SERVER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">REDIS_PORT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">REDIS_DB</span></p><p class="crayon-line" id="crayon-56d5aab701a49363481232-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-12"><span class="crayon-v">redis_db</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">redis</span><span class="crayon-sy">.</span><span class="crayon-e">StrictRedis</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_SERVER</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_PORT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-o">=</span><span class="crayon-v">REDIS_DB</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a49363481232-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-14"><span class="crayon-v">socketio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SocketIO</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d5aab701a49363481232-15"><span class="crayon-v">db</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SQLAlchemy</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701a49363481232-16"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701a49363481232-17"><span class="crayon-v">login_manager</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LoginManager</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701a49363481232-18"><span class="crayon-v">login_manager</span><span class="crayon-sy">.</span><span class="crayon-v">login_view</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'sign_in'</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5aab701a49363481232-19"><span class="crayon-v">login_manager</span><span class="crayon-sy">.</span><span class="crayon-e">init_app</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-20"> </p><p class="crayon-line" id="crayon-56d5aab701a49363481232-21"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">views</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a49363481232-22"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">websockets</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We need to configure where the database is located in a configuration parameter so our SQLAlchemy database loads properly. Make sure you have PostgreSQL installed on your system. Here are some handy guides and downloads to install PostgreSQL on <a href="https://help.ubuntu.com/community/PostgreSQL">Ubuntu Linux</a>, <a href="http://www.postgresql.org/download/windows/">Windows</a> and <a href="http://www.postgresql.org/download/macosx/">Mac OS X</a>.</p>
<p>Our new configuration variable will reside in our 
			<span id="crayon-56d5aab701a53904176905" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file as highlighted below.</p>

		<div id="crayon-56d5aab701a5d122704548" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701a5d122704548-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a5d122704548-2"> </p><p class="crayon-line" id="crayon-56d5aab701a5d122704548-3"><span class="crayon-c"># General Flask app settings</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a5d122704548-4"><span class="crayon-v">DEBUG</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'DEBUG'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a5d122704548-5"><span class="crayon-v">SECRET_KEY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'SECRET_KEY'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-56d5aab701a5d122704548-6"><span class="crayon-v">SQLALCHEMY_DATABASE_URI</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'DATABASE_URL'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a5d122704548-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a5d122704548-8"><span class="crayon-c"># Redis connection</span></p><p class="crayon-line" id="crayon-56d5aab701a5d122704548-9"><span class="crayon-v">REDIS_SERVER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'REDIS_SERVER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a5d122704548-10"><span class="crayon-v">REDIS_PORT</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'REDIS_PORT'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a5d122704548-11"><span class="crayon-v">REDIS_DB</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'REDIS_DB'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a5d122704548-12"> </p><p class="crayon-line" id="crayon-56d5aab701a5d122704548-13"><span class="crayon-c"># Twilio API credentials</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a5d122704548-14"><span class="crayon-v">TWILIO_ACCOUNT_SID</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'TWILIO_ACCOUNT_SID'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701a5d122704548-15"><span class="crayon-v">TWILIO_AUTH_TOKEN</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'TWILIO_AUTH_TOKEN'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701a5d122704548-16"><span class="crayon-v">TWILIO_NUMBER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-v">environ</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'TWILIO_NUMBER'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>In our original <a href="https://www.twilio.com/blog/2014/11/choose-your-own-adventure-presentations-with-reveal-js-python-and-websockets.html">Choose Your Own Adventure Presentations blog post</a> we set the other environment variables listed in the above 
			<span id="crayon-56d5aab701a68952434241" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file. Set an environment variable for 
			<span id="crayon-56d5aab701a71464406486" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">DATABASE_URL</span></span></span> that will be loaded into 
			<span id="crayon-56d5aab701a7b019273341" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">SQLALCHEMY_DATABASE_URI</span></span></span>. The value for this variable will be a URI that points to your running PostgreSQL database. For example, in my local development environment the 
			<span id="crayon-56d5aab701a84671831824" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">DATABASE_URL</span></span></span> is set to 
			<span id="crayon-56d5aab701a8e890894503" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">postgresql</span><span class="crayon-o">:</span><span class="crayon-c">//matt:password123@localhost/cyoa</span></span></span>. And no, that’s not the actual password value I use on my development environment.</p>
<p>We’ll need a form to handle data coming from a wizard. In our application the Flask-WTF library is going to handle form generation and input sanitization. Create a new file named 
			<span id="crayon-56d5aab701a98364258872" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">forms</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> in your 
			<span id="crayon-56d5aab701aa1961810034" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span></span></span> subdirectory.</p>
<p/>

		<div id="crayon-56d5aab701aab214385309" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-2">2</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-4">4</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-6">6</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-8">8</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-10">10</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-12">12</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-14">14</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-16">16</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-18">18</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-20">20</p><p class="crayon-num" data-line="crayon-56d5aab701aab214385309-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701aab214385309-22">22</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701aab214385309-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">wtf </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Form</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">wtforms </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">StringField</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">PasswordField</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">BooleanField</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">SubmitField</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-3"><span class="crayon-h">                    </span><span class="crayon-v">DateField</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">IntegerField</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">wtforms</span><span class="crayon-sy">.</span><span class="crayon-e">validators </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Required</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Regexp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">EqualTo</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-5"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">wtforms </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">ValidationError</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-6"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Wizard</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-8"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">LoginForm</span><span class="crayon-sy">(</span><span class="crayon-v">Form</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-9"><span class="crayon-h">    </span><span class="crayon-v">wizard_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">StringField</span><span class="crayon-sy">(</span><span class="crayon-s">'Wizard Name'</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-10"><span class="crayon-h">                              </span><span class="crayon-v">validators</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-e">Required</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Length</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">32</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-11"><span class="crayon-h">    </span><span class="crayon-v">password</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PasswordField</span><span class="crayon-sy">(</span><span class="crayon-s">'Password'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validators</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-e">Required</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-12"><span class="crayon-h">                                                     </span><span class="crayon-e">Length</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">32</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-14"><span class="crayon-h">    </span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">validate</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-15"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">Form</span><span class="crayon-sy">.</span><span class="crayon-e">validate</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-16"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">False</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-17"><span class="crayon-h">        </span><span class="crayon-k ">user</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Wizard</span><span class="crayon-sy">.</span><span class="crayon-v">query</span><span class="crayon-sy">.</span><span class="crayon-e">filter_by</span><span class="crayon-sy">(</span><span class="crayon-v">wizard_name</span><span class="crayon-o">=</span><span class="crayon-r">self</span><span class="crayon-sy">.</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-18"><span class="crayon-h">                                      </span><span class="crayon-v">wizard_name</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">first</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-19"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-k ">user</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-k ">user</span><span class="crayon-sy">.</span><span class="crayon-e">verify_password</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">password</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-20"><span class="crayon-h">            </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">password</span><span class="crayon-sy">.</span><span class="crayon-v">errors</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">'Incorrect password.'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701aab214385309-21"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">False</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701aab214385309-22"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">True</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The above code creates a Python representation of the sign-in page form. We add a custom validator within the validate function to ensure the password entered by the user matches what’s stored in the database. If the form input passes the validation function then 
			<span id="crayon-56d5aab701ab6880480025" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-t">True</span></span></span> is returned and the form processing continues along in our 
			<span id="crayon-56d5aab701abf736172011" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file.</p>
<p>Now in 
			<span id="crayon-56d5aab701ac9764832350" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">views</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> we need a couple of functions to handle signing wizards in and out of their special part of the application.</p>

		<div id="crayon-56d5aab701ad3836489620" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-2">2</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-3">3</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-4">4</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5aab701ad3836489620-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-6">6</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-8">8</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-10">10</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom" data-line="crayon-56d5aab701ad3836489620-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-12">12</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-14">14</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom" data-line="crayon-56d5aab701ad3836489620-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-16">16</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-18">18</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d5aab701ad3836489620-19">19</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-20">20</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5aab701ad3836489620-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-22">22</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-24">24</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-26">26</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-28">28</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-30">30</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-32">32</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-34">34</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-36">36</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-38">38</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-40">40</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-42">42</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-44">44</p><p class="crayon-num" data-line="crayon-56d5aab701ad3836489620-45">45</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-46">46</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-47">47</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-48">48</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-49">49</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-50">50</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-51">51</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-52">52</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-53">53</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-54">54</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-55">55</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-56">56</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-57">57</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-58">58</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-59">59</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-60">60</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-61">61</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-62">62</p><p class="crayon-num crayon-marked-num" data-line="crayon-56d5aab701ad3836489620-63">63</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701ad3836489620-64">64</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701ad3836489620-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">cgi</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">render_template</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">abort</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">request </span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-3"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">flask </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">redirect</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">url_for</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5aab701ad3836489620-4"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">login </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">login_user</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">logout_user</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">login_required</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5aab701ad3836489620-5"><span class="crayon-h">                            </span><span class="crayon-e">current_user</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-6"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">jinja2 </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TemplateNotFound</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-7"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">twilio </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">twiml</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">twilio</span><span class="crayon-sy">.</span><span class="crayon-e">rest </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-9"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-10"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">config </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">TWILIO_NUMBER</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-56d5aab701ad3836489620-11"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">forms </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">LoginForm</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-12"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Wizard</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-14"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">socketio</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-56d5aab701ad3836489620-15"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">login_manager</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-16"> </p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-17"><span class="crayon-v">client</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TwilioRestClient</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-18"> </p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d5aab701ad3836489620-19"><span class="crayon-sy">@</span><span class="crayon-v">login_manager</span><span class="crayon-sy">.</span><span class="crayon-e">user_loader</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-20"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">load_user</span><span class="crayon-sy">(</span><span class="crayon-v">userid</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5aab701ad3836489620-21"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Wizard</span><span class="crayon-sy">.</span><span class="crayon-v">query</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-v">userid</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-22"> </p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-23"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/&lt;presentation_name&gt;/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-24"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">landing</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-25"><span class="crayon-h">    </span><span class="crayon-st">try</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-26"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-v">presentation_name</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'.html'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-27"><span class="crayon-h">    </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">TemplateNotFound</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-28"><span class="crayon-h">        </span><span class="crayon-e">abort</span><span class="crayon-sy">(</span><span class="crayon-cn">404</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-29"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-30"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/cyoa/twilio/webhook/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-31"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">twilio_callback</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-32"><span class="crayon-h">    </span><span class="crayon-v">to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'To'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-33"><span class="crayon-h">    </span><span class="crayon-v">from_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'From'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-34"><span class="crayon-h">    </span><span class="crayon-v">message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">'Body'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-35"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">to</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">TWILIO_NUMBER</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-36"><span class="crayon-h">        </span><span class="crayon-v">redis_db</span><span class="crayon-sy">.</span><span class="crayon-e">incr</span><span class="crayon-sy">(</span><span class="crayon-k ">cgi</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-37"><span class="crayon-h">        </span><span class="crayon-v">socketio</span><span class="crayon-sy">.</span><span class="crayon-e">emit</span><span class="crayon-sy">(</span><span class="crayon-s">'msg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'div'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-k ">cgi</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-38"><span class="crayon-h">                              </span><span class="crayon-s">'val'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-39"><span class="crayon-h">                      </span><span class="crayon-v">namespace</span><span class="crayon-o">=</span><span class="crayon-s">'/cyoa'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-40"><span class="crayon-h">    </span><span class="crayon-v">resp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">twiml</span><span class="crayon-sy">.</span><span class="crayon-e">Response</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-41"><span class="crayon-h">    </span><span class="crayon-v">resp</span><span class="crayon-sy">.</span><span class="crayon-e">message</span><span class="crayon-sy">(</span><span class="crayon-s">"Thanks for your vote!"</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-42"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-v">resp</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-43"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-44"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/wizard/'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">methods</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'GET'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'POST'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701ad3836489620-45"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">sign_in</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5aab701ad3836489620-46"><span class="crayon-h">    </span><span class="crayon-v">form</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LoginForm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-47"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-e">validate_on_submit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-48"><span class="crayon-h">        </span><span class="crayon-v">wizard</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Wizard</span><span class="crayon-sy">.</span><span class="crayon-v">query</span><span class="crayon-sy">.</span><span class="crayon-e">filter_by</span><span class="crayon-sy">(</span><span class="crayon-v">wizard_name</span><span class="crayon-o">=</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-49"><span class="crayon-h">                                        </span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-v">wizard_name</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">first</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-50"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">wizard </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">wizard</span><span class="crayon-sy">.</span><span class="crayon-e">verify_password</span><span class="crayon-sy">(</span><span class="crayon-v">form</span><span class="crayon-sy">.</span><span class="crayon-v">password</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-51"><span class="crayon-h">            </span><span class="crayon-e">login_user</span><span class="crayon-sy">(</span><span class="crayon-v">wizard</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-52"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">redirect</span><span class="crayon-sy">(</span><span class="crayon-e">url_for</span><span class="crayon-sy">(</span><span class="crayon-s">'wizard_landing'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-53"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-s">'wizard/sign_in.html'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">form</span><span class="crayon-o">=</span><span class="crayon-v">form</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">no_nav</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-54"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-55"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/sign-out/'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-56"><span class="crayon-sy">@</span><span class="crayon-e">login_required</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-57"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">sign_out</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-58"><span class="crayon-h">    </span><span class="crayon-e">logout_user</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-59"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">redirect</span><span class="crayon-sy">(</span><span class="crayon-e">url_for</span><span class="crayon-sy">(</span><span class="crayon-s">'sign_in'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-60"> </p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-61"><span class="crayon-sy">@</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">route</span><span class="crayon-sy">(</span><span class="crayon-s">'/wizard/presentations/'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-62"><span class="crayon-sy">@</span><span class="crayon-e">login_required</span></p><p class="crayon-line crayon-marked-line" id="crayon-56d5aab701ad3836489620-63"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">wizard_landing</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701ad3836489620-64"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">render_template</span><span class="crayon-sy">(</span><span class="crayon-s">'wizard/presentations.html'</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>What we’re doing in the code above is including our new login manager we created in the 
			<span id="crayon-56d5aab701ade764301592" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">__init__</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file. We then implement a <a href="https://flask-login.readthedocs.org/en/latest/">login manager</a> callback function named load_user which reloads a Wizard object from the user ID stored in the session. There are three additional functions:</p>
<ul>
<li>
			<span id="crayon-56d5aab701ae8141581244" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">sign_in</span></span></span>: authenticate a user as a valid wizard to get into the app</li>
<li>
			<span id="crayon-56d5aab701af2840047868" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">sign_out</span></span></span>: deauthenticate a logged in wizard’s session</li>
<li>
			<span id="crayon-56d5aab701afb022412829" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">wizard_landing</span></span></span>: a simple stub page only accessible to wizards to prove the authentication is working properly</li>
</ul>
<p>We have the code to run the app but there are no templates to render yet. Let’s create those now so we can test this thing out. Under the 
			<span id="crayon-56d5aab701b05680066455" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">templates</span><span class="crayon-o">/</span></span></span> folder create a new file named 
			<span id="crayon-56d5aab701b0f592906505" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">base</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> with the following template code:</p>

		<div id="crayon-56d5aab701b18351708427" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-2">2</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-4">4</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-6">6</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-8">8</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-10">10</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-12">12</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-14">14</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-16">16</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-18">18</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-20">20</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-22">22</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701b18351708427-24">24</p><p class="crayon-num" data-line="crayon-56d5aab701b18351708427-25">25</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701b18351708427-1"><span class="crayon-n">&lt;!DOCTYPE html&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-2"><span class="crayon-r ">&lt;html </span><span class="crayon-e ">lang</span><span class="crayon-o">=</span><span class="crayon-s ">"en"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-3"><span class="crayon-i ">  </span><span class="crayon-r ">&lt;head&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-4"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;meta </span><span class="crayon-e ">charset</span><span class="crayon-o">=</span><span class="crayon-s ">"utf-8"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-5"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;meta </span><span class="crayon-e ">http-equiv</span><span class="crayon-o">=</span><span class="crayon-s ">"X-UA-Compatible"</span><span class="crayon-h"> </span><span class="crayon-e ">content</span><span class="crayon-o">=</span><span class="crayon-s ">"IE=edge"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-6"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;meta </span><span class="crayon-e ">name</span><span class="crayon-o">=</span><span class="crayon-s ">"viewport"</span><span class="crayon-h"> </span><span class="crayon-e ">content</span><span class="crayon-o">=</span><span class="crayon-s ">"width=device-width, initial-scale=1"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-7"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;meta </span><span class="crayon-e ">name</span><span class="crayon-o">=</span><span class="crayon-s ">"description"</span><span class="crayon-h"> </span><span class="crayon-e ">content</span><span class="crayon-o">=</span><span class="crayon-s ">""</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-8"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;meta </span><span class="crayon-e ">name</span><span class="crayon-o">=</span><span class="crayon-s ">"author"</span><span class="crayon-h"> </span><span class="crayon-e ">content</span><span class="crayon-o">=</span><span class="crayon-s ">"Matt Makai"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-9"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;title&gt;</span><span class="crayon-i ">{% block title %}{% endblock %}CYOA Presentations</span><span class="crayon-r ">&lt;/title&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-10"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;link </span><span class="crayon-e ">rel</span><span class="crayon-o">=</span><span class="crayon-s ">"stylesheet"</span><span class="crayon-h"> </span><span class="crayon-e ">href</span><span class="crayon-o">=</span><span class="crayon-s ">"https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-11"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;link </span><span class="crayon-e ">rel</span><span class="crayon-o">=</span><span class="crayon-s ">"stylesheet"</span><span class="crayon-h"> </span><span class="crayon-e ">href</span><span class="crayon-o">=</span><span class="crayon-s ">"/static/css/wizard.css"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-12"><span class="crayon-i ">    {% block css_head %}{% endblock %}</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-13"><span class="crayon-i ">    </span><span class="crayon-c">&lt;!--[if lt IE 9]&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-14"><span class="crayon-c">      <span class="crayon-ta">&lt;script </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"</span><span class="crayon-o">&gt;</span></span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-15"><span class="crayon-h">      </span><span class="crayon-ta">&lt;/script&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-16"><span class="crayon-c">      <span class="crayon-ta">&lt;script </span><span class="crayon-e ">src</span><span class="crayon-o">=</span><span class="crayon-s">"https://oss.maxcdn.com/respond/1.4.2/respond.min.js"</span><span class="crayon-o">&gt;</span></span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-17"><span class="crayon-h">      </span><span class="crayon-ta">&lt;/script&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-18"><span class="crayon-c">    &lt;![endif]--&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-19"><span class="crayon-i ">  </span><span class="crayon-r ">&lt;/head&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-20"><span class="crayon-i ">  </span><span class="crayon-r ">&lt;body{% </span>block<span class="crayon-h"> </span>body<span class="crayon-sy">_</span>class<span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>endblock<span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-21"><span class="crayon-i ">    {% block nav %}{% endblock %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-22"><span class="crayon-i ">    {% block content %}{% endblock %}</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-23"><span class="crayon-i ">    {% block js_body %}{% endblock %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b18351708427-24"><span class="crayon-i ">  </span><span class="crayon-r ">&lt;/body&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b18351708427-25"><span class="crayon-r ">&lt;/html&gt;</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The above template serves as a base HTML template file that other templates can extend. Our sign-in page and our wizard landing page will both extend 
			<span id="crayon-56d5aab701b23051774909" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">base</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span>.</p>
<p>You’ll notice we have a new 
			<span id="crayon-56d5aab701b2c506944937" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">wizard</span><span class="crayon-sy">.</span><span class="crayon-v">css</span></span></span> file included in our 
			<span id="crayon-56d5aab701b36595018112" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">base</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> file. There are a few extra styles and a background image we will include in our app. Rather than having you type out all that code you’ll want to download the file <a href="https://github.com/makaimc/choose-your-own-adventure-presentations/blob/tutorial-step-4/cyoa/static/cyoa-tutorial-step-4.tar.gz?raw=true">cyoa-tutorial-step-4.tar.gz</a> and extract it under the 
			<span id="crayon-56d5aab701b40503560459" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-m">static</span><span class="crayon-o">/</span></span></span> directory so those files can be served up when we run our application.</p>
<p>
			<span id="crayon-56d5aab701b4a709516790" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">base</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> eliminates the boilerplate code we don’t want to write in every template, but we can go even further with our <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">Don’t Repeat Yourself</a> (DRY) principle by using a helper to render forms. Make a subdirectory named 
			<span id="crayon-56d5aab701b53160686854" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">partials</span></span></span> under the 
			<span id="crayon-56d5aab701b5d321691041" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">cyoa</span><span class="crayon-o">/</span><span class="crayon-v">templates</span><span class="crayon-o">/</span></span></span> directory. Within 
			<span id="crayon-56d5aab701b66819066982" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">partials</span></span></span> construct a file named 
			<span id="crayon-56d5aab701b70330726876" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">_formhelpers</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> and put the following template code inside:</p>
<p/>

		<div id="crayon-56d5aab701b79051404441" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701b79051404441-1"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>macro<span class="crayon-h"> </span>render<span class="crayon-sy">_</span>field<span class="crayon-sy">(</span>field<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b79051404441-2"><span class="crayon-h">    </span><span class="crayon-r ">&lt;dt </span><span class="crayon-e ">style</span><span class="crayon-o">=</span><span class="crayon-s ">"text-align: left;"</span><span class="crayon-h"> </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"admin-field"</span><span class="crayon-r ">&gt;</span><span class="crayon-i ">{{ field.label }}</span></p><p class="crayon-line" id="crayon-56d5aab701b79051404441-3"><span class="crayon-i ">    {% if field.errors %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b79051404441-4"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;ul </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"errors"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b79051404441-5"><span class="crayon-i ">            {% for error in field.errors %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b79051404441-6"><span class="crayon-i ">                </span><span class="crayon-r ">&lt;li </span><span class="crayon-e ">style</span><span class="crayon-o">=</span><span class="crayon-s ">"color: red;"</span><span class="crayon-r ">&gt;</span><span class="crayon-i ">{{ error }}</span><span class="crayon-r ">&lt;/li&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b79051404441-7"><span class="crayon-i ">            {% endfor %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b79051404441-8"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;/ul&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701b79051404441-9"><span class="crayon-i ">    {% endif %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b79051404441-10"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;dd&gt;</span><span class="crayon-i ">{{ field(class_="form-control", **kwargs)|safe }}</span></p><p class="crayon-line" id="crayon-56d5aab701b79051404441-11"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;/dd&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701b79051404441-12"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>endmacro<span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>Every time we render a form field in future templates we can include the above file and it will insert the boilerplate code for a single field into the template.</p>
<p>Next, create a new directory under your templates folder named 
			<span id="crayon-56d5aab701b83372376304" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">wizard</span><span class="crayon-o">/</span></span></span>. Within the 
			<span id="crayon-56d5aab701b8d508189992" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">wizard</span><span class="crayon-o">/</span></span></span> directory create a new file named 
			<span id="crayon-56d5aab701b97712754987" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">sign_in</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> with the following template:</p>

		<div id="crayon-56d5aab701ba0742132786" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-2">2</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-4">4</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-6">6</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-7">7</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-8">8</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-10">10</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-12">12</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-14">14</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-16">16</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-18">18</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-20">20</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-22">22</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-24">24</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-26">26</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-28">28</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-30">30</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-32">32</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-34">34</p><p class="crayon-num" data-line="crayon-56d5aab701ba0742132786-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701ba0742132786-36">36</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701ba0742132786-1"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>extends<span class="crayon-h"> </span><span class="crayon-s ">"base.html"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-2"> </p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-3"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>block<span class="crayon-h"> </span>css<span class="crayon-sy">_</span>head<span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-4"><span class="crayon-h">    </span><span class="crayon-r ">&lt;link </span><span class="crayon-e ">href</span><span class="crayon-o">=</span><span class="crayon-s ">"/static/css/signin.css"</span><span class="crayon-h"> </span><span class="crayon-e ">rel</span><span class="crayon-o">=</span><span class="crayon-s ">"stylesheet"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-5"><span class="crayon-i ">{% endblock %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-6"> </p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-7"><span class="crayon-i ">{% block body_class %} class="wizard-bg" {% endblock %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-8"> </p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-9"><span class="crayon-i ">{% block content %}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-10"><span class="crayon-r ">&lt;div </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"container sign-in"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-11"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;div </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"col-md-12"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-12"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;div </span><span class="crayon-e ">id</span><span class="crayon-o">=</span><span class="crayon-s ">"login"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-13"><span class="crayon-i ">            </span><span class="crayon-r ">&lt;h1&gt;</span><span class="crayon-i ">Wizards Only!</span><span class="crayon-r ">&lt;/h1&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-14"><span class="crayon-i ">            {% from "partials/_formhelpers.html" import render_field %}</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-15"><span class="crayon-i ">            </span><span class="crayon-r ">&lt;form </span><span class="crayon-e ">method</span><span class="crayon-o">=</span><span class="crayon-s ">"post"</span><span class="crayon-h"> </span><span class="crayon-e ">action</span><span class="crayon-o">=</span><span class="crayon-s ">"{{ url_for('sign_in') }}"</span><span class="crayon-h"> </span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-16"><span class="crayon-h">                  </span><span class="crayon-e ">id</span><span class="crayon-o">=</span><span class="crayon-s ">"login-form"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-17"><span class="crayon-i ">                {{ form.csrf_token }}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-18"><span class="crayon-i ">                {{ render_field(form.wizard_name, required=True) }}</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-19"><span class="crayon-i ">                </span><span class="crayon-r ">&lt;br&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-20"><span class="crayon-i ">                {{ render_field(form.password, required=True) }}</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-21"><span class="crayon-i ">                </span><span class="crayon-r ">&lt;div </span><span class="crayon-e ">style</span><span class="crayon-o">=</span><span class="crayon-s ">"margin-top: 10px; text-align: right;"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-22"><span class="crayon-i ">                    </span><span class="crayon-r ">&lt;input </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"btn btn-primary"</span><span class="crayon-h"> </span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-23"><span class="crayon-h">                           </span><span class="crayon-e ">type</span><span class="crayon-o">=</span><span class="crayon-s ">"submit"</span><span class="crayon-h"> </span><span class="crayon-e ">value</span><span class="crayon-o">=</span><span class="crayon-s ">"Sign in"</span><span class="crayon-r "> /&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-24"><span class="crayon-i ">                </span><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-25"><span class="crayon-i ">            </span><span class="crayon-r ">&lt;/form&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-26"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-27"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-28"><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-29"><span class="crayon-r ">&lt;footer </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"footer"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-30"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;div </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"container"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-31"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;p </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"text-muted pull-right"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-32"><span class="crayon-i ">            Photo by </span><span class="crayon-r ">&lt;a </span><span class="crayon-e ">href</span><span class="crayon-o">=</span><span class="crayon-s ">"http://photos.jdhancock.com/photo/2012-04-16-000233-a-spot-of-magic.html"</span><span class="crayon-r ">&gt;</span><span class="crayon-i ">JD Hancock</span><span class="crayon-r ">&lt;/a&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-33"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;/p&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-34"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701ba0742132786-35"><span class="crayon-r ">&lt;/footer&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701ba0742132786-36"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>endblock<span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>The template renders a page with a nice wizard background image for some extra flavor. We’re close to running our app, but we need a page to render once the wizard gets past the sign-in page.</p>
<p>Create a new file named 
			<span id="crayon-56d5aab701bab709588247" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">wizard</span><span class="crayon-o">/</span><span class="crayon-v">presentations</span><span class="crayon-sy">.</span><span class="crayon-v">html</span></span></span> that will store a stub page that we’ll expand upon in part 2 of this tutorial.</p>

		<div id="crayon-56d5aab701bb4729089834" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701bb4729089834-1"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>extends<span class="crayon-h"> </span><span class="crayon-s ">"base.html"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bb4729089834-2"> </p><p class="crayon-line" id="crayon-56d5aab701bb4729089834-3"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>block<span class="crayon-h"> </span>content<span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bb4729089834-4"><span class="crayon-r ">&lt;div </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"container"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701bb4729089834-5"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;div </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"row"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bb4729089834-6"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;div </span><span class="crayon-e ">class</span><span class="crayon-o">=</span><span class="crayon-s ">"col-md-10"</span><span class="crayon-r ">&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701bb4729089834-7"><span class="crayon-i ">            </span><span class="crayon-r ">&lt;h1&gt;</span><span class="crayon-i ">Wizards Only Stuff Here</span><span class="crayon-r ">&lt;/h1&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bb4729089834-8"><span class="crayon-i ">            </span><span class="crayon-r ">&lt;a </span><span class="crayon-e ">href</span><span class="crayon-o">=</span><span class="crayon-s ">"{{ url_for('sign_out') }}"</span><span class="crayon-r ">&gt;</span><span class="crayon-i ">Sign out</span><span class="crayon-r ">&lt;/a&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701bb4729089834-9"><span class="crayon-i ">        </span><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bb4729089834-10"><span class="crayon-i ">    </span><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line" id="crayon-56d5aab701bb4729089834-11"><span class="crayon-r ">&lt;/div&gt;</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bb4729089834-12"><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-h"> </span>endblock<span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-sy">}</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>With our application code and templates in place we just have one more file to update so we can run the application. Change the existing 
			<span id="crayon-56d5aab701bbe382962332" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> file with the following highlighted lines.</p>

		<div id="crayon-56d5aab701bc8850183378" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-1">1</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-2">2</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-3">3</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-4">4</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-5">5</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-6">6</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-7">7</p><p class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-8">8</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5aab701bc8850183378-9">9</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-10">10</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-11">11</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-12">12</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-14">14</p><p class="crayon-num crayon-marked-num crayon-top crayon-bottom" data-line="crayon-56d5aab701bc8850183378-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-16">16</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-18">18</p><p class="crayon-num crayon-marked-num crayon-top" data-line="crayon-56d5aab701bc8850183378-19">19</p><p class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-20">20</p><p class="crayon-num crayon-marked-num crayon-bottom" data-line="crayon-56d5aab701bc8850183378-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-22">22</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-24">24</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-26">26</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-28">28</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-30">30</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-32">32</p><p class="crayon-num" data-line="crayon-56d5aab701bc8850183378-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5aab701bc8850183378-34">34</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701bc8850183378-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">gevent </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">monkey</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-2"><span class="crayon-v">monkey</span><span class="crayon-sy">.</span><span class="crayon-e">patch_all</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">redis</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-6"> </p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-7"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">cyoa </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">socketio</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-56d5aab701bc8850183378-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">cyoa </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">db</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5aab701bc8850183378-9"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">cyoa</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Wizard</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-10"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">flask</span><span class="crayon-sy">.</span><span class="crayon-v">ext</span><span class="crayon-sy">.</span><span class="crayon-e">script </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">Manager</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Shell</span></p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-11"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-12"><span class="crayon-v">manager</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Manager</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-13"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-14"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">make_shell_context</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-top crayon-bottom" id="crayon-56d5aab701bc8850183378-15"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">dict</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-o">=</span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">redis_db</span><span class="crayon-o">=</span><span class="crayon-v">redis_db</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-o">=</span><span class="crayon-v">db</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Wizard</span><span class="crayon-o">=</span><span class="crayon-v">Wizard</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-16"> </p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-17"><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">add_command</span><span class="crayon-sy">(</span><span class="crayon-s">"shell"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Shell</span><span class="crayon-sy">(</span><span class="crayon-v">make_context</span><span class="crayon-o">=</span><span class="crayon-v">make_shell_context</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-18"> </p><p class="crayon-line crayon-marked-line crayon-top" id="crayon-56d5aab701bc8850183378-19"><span class="crayon-sy">@</span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">command</span></p><p class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-20"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">syncdb</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-marked-line crayon-bottom" id="crayon-56d5aab701bc8850183378-21"><span class="crayon-h">    </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">create_all</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-22"> </p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-23"><span class="crayon-sy">@</span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">command</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-24"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">runserver</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-25"><span class="crayon-h">    </span><span class="crayon-v">socketio</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"0.0.0.0"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-cn">5001</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-26"> </p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-27"><span class="crayon-sy">@</span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">command</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-28"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">clear_redis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-29"><span class="crayon-h">    </span><span class="crayon-v">redis_cli</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">redis</span><span class="crayon-sy">.</span><span class="crayon-e">StrictRedis</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-o">=</span><span class="crayon-s">'localhost'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-o">=</span><span class="crayon-s">'6379'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-o">=</span><span class="crayon-s">'0'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-30"><span class="crayon-h">    </span><span class="crayon-v">redis_cli</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-s">'left'</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-31"><span class="crayon-h">    </span><span class="crayon-v">redis_cli</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-s">'right'</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-32"> </p><p class="crayon-line" id="crayon-56d5aab701bc8850183378-33"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bc8850183378-34"><span class="crayon-h">    </span><span class="crayon-v">manager</span><span class="crayon-sy">.</span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We’re itching to get this application running but we need to make sure our database is created along with our Wizard table. On the command line create PostgreSQL database using this command:</p>
<p>
			<span id="crayon-56d5aab701bd2438133530" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">createdb </span><span class="crayon-v">cyoa</span></span></span></p>
<p>With our updated 
			<span id="crayon-56d5aab701bdc634339340" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span> script we can create the database tables necessary for storing wizards.</p>
<p>
			<span id="crayon-56d5aab701be6273411225" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">syncdb</span></span></span></p>
<p>Also we need to populate our first authorized wizard. Start up the shell and enter the following code to create and save a wizard. You can modify the credentials as you see fit.</p>
<p/>

		<div id="crayon-56d5aab701bef960021183" class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover expand">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5aab701bef960021183-1"><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">shell</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bef960021183-2"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Wizard</span><span class="crayon-sy">(</span><span class="crayon-s">'gandalf'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thegrey'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5aab701bef960021183-3"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">commit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5aab701bef960021183-4"><span class="crayon-o">&gt;&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-e">exit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/>
<p>Finally, time to test out our new wizard sign-in screen! Within the base directory of our application run the built-in server using the following command:</p>
<p>
			<span id="crayon-56d5aab701bf9505977024" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-e">python </span><span class="crayon-v">manage</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">runserver</span></span></span></p>
<p>Head to <a href="http://localhost:5001/wizard/">http://localhost:5001/wizard/</a> in a web browser to bring up our application. Now we can authenticate as a wizard with the name and password we just added to the database.</p>
<p><img alt="wizards-credentials.jpg" src="https://lh5.googleusercontent.com/3aQlYFoJx2W_4iLDxOwMTDsJUN90i6M4FiO5atKaVeiV9vTE5SkO09fx6te_MPUmplJ_OS0fX-L1gLSQjNt98pYTvAC_UxdEJgL9fh_KpPIF3Z-iLn64fdj1ZkCtOgpRqy3733o"/></p>
<p>After entering our credentials and hitting the <em>Sign in</em> button we’ll see the following landing page.</p>
<p><img alt="wizards-only.png" src="https://lh6.googleusercontent.com/0_A1yrQIYtLdOMLzU-OjlYyM0i2X9g7pyo2tA6tVAu77kr0FOgUgM_drbUm4IAv1cTKS2KX7lOYNd66VBbN-HL0U3TT1WjLENFU0FFZqAEO8gGRfe3m4ofc9m9yMms3jhZyPxQk"/></p>
<p>Click the <em>Sign out</em> button to test out the 
			<span id="crayon-56d5aab701c03073971825" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-consolas"><span class="crayon-pre crayon-code"><span class="crayon-v">sign_out</span></span></span> function and ensure that we eliminate any trace of our wizard-ness to the application.</p>
<h2 dir="ltr">Wizards Only Engaged</h2>
<p>Our Wizards Only sign-in page is complete, but there’s more work to be done. In part two of the Wizard Mode tutorial, we’ll enable better control over presentations by building out our wizard pages. Tune back in shortly for the second story in this three part tutorial.</p>
<p>Confused over steps in this tutorial or think it should be built a different way? Let me know how you’d like to see the Choose Your Own Adventure Presentations tutorial evolve after the Wizard Mode tutorial series is finished. Contact me via:</p>
<ul>
<li>Email: makai@twilio.com</li>
<li>GitHub: Follow <a href="https://github.com/makaimc">makaimc</a> for repository updates</li>
<li>Twitter: <a href="https://twitter.com/mattmakai">@mattmakai</a></li>
</ul>
			</div>
					</div></body></html>