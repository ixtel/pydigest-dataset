<html><body><div><div id="content">

            

            
        


            <div class="section">
              <h1>mpsign 1.5.1</h1>

              


<p>a tool which signs your bars on Baidu Tieba</p>








<div id="id1">
<h2>需求</h2>
<div>
<p>MPSIGN 在 Python 3.5 的环境下开发，对 Python 3.x
其他版本的运行状况未知。1.5.2 的工作就是兼容测试。</p>
<p>暂时没有兼容 2.x 的计划。</p>
</div>
</div>
<div id="id2">
<h2>安装</h2>
<pre>$ sudo pip install mpsign
</pre>
</div>
<div id="api">
<h2>API</h2>
<p>MPSIGN 的所有核心功能均在 <tt>mpsign.core</tt> 模块下。以下是一些示例。</p>
<ul>
<li><p>登录</p>
<ul>
<li><p>通过账号密码</p>
<pre><span class="kn">from</span> <span class="nn">mpsign.core</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Captcha</span><span class="p">,</span> <span class="n">LoginFailure</span>

<span class="n">user_gen</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">'USERNAME'</span><span class="p">,</span> <span class="s1">'PASSWORD'</span><span class="p">)</span>  <span class="c1"># 登陆的接口是用 generator 实现的</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">user_gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>  <span class="c1"># 启动 generator</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Captcha</span><span class="p">):</span>  <span class="c1"># 是否需要验证码</span>
        <span class="n">result</span><span class="o">.</span><span class="n">as_file</span><span class="p">(</span><span class="s1">'captcha.gif'</span><span class="p">)</span>  <span class="c1"># 验证码图片保存到 captcha.gif</span>
        <span class="n">your_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'captcha: '</span><span class="p">)</span>  <span class="c1"># 获取用户输入</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">user_gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">your_input</span><span class="p">)</span>  <span class="c1"># 发送验证码给 generator</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">result</span>  <span class="c1"># 不需要验证码的话，result 即是新建的 User 实例</span>
<span class="k">except</span> <span class="n">LoginFailure</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">ex</span>
</pre>
<p>注: <tt>LoginFailure</tt> 还有如下子异常: <tt>InvalidPassword</tt>,
<tt>InvalidCaptcha</tt>, <tt>InvalidUsername</tt>, <tt>DangerousEnvironment</tt></p>
<p>注: <tt>user = user_gen.send(your_input)</tt> 也等价与以下代码:</p>
<pre><span class="n">result</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">your_input</span><span class="p">)</span>  <span class="c1"># result 是一个 Captcha 对象</span>
<span class="n">user_gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</pre>
</li>
<li><p>通过 BDUSS</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mpsign.core</span> <span class="kn">import</span> <span class="n">User</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">'YOUR BDUSS'</span><span class="p">)</span>  <span class="c1"># 此处的 BDUSS 可从 baidu.com 域下的 Cookies 找到</span>
</pre>
</li>
</ul>
</li>
<li><p>获取喜欢的吧</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">bars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">kw</span>
<span class="s1">'chrome'</span>
</pre>
</li>
<li><p>签到</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mpsign.core</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Bar</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="o">...</span><span class="n">get</span> <span class="n">User</span> <span class="n">instance</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s1">'python'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">bar</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="n">SignResult</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">'ok'</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bar</span><span class="o">=&lt;</span><span class="n">mpsign</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Bar</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f7648d35e48</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_sign</span><span class="o">=</span><span class="s1">'41'</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="s1">'3249'</span><span class="p">,</span> <span class="n">cont_sign</span><span class="o">=</span><span class="s1">'4'</span><span class="p">)</span>
</pre>
<p>注: <tt>user.sign(bar)</tt> 与 <tt>bar.sign(user)</tt> 等价。</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">bars</span><span class="p">]</span>
<span class="o">...</span><span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">SignResult</span>
</pre>
<p>注: 签到需要四样东西：BDUSS，tbs，吧名和<strong>对应贴吧的 fid</strong>.
<tt>mpsign.core.Bar</tt> 有两种实例化的方法: Bar(kw, fid) 或 Bar(kw).
如果使用后者，访问 <tt>bar.fid</tt> 的时候会去单独获取该贴吧的
fid，贴吧多了之后流量消耗相当可观. 所以除非真的不知道 fid，
否则请使用第一种构造方法。有一种批量获取用户喜欢的吧 fid 的方法是使用
<tt>user.bars</tt>，返回的是一个由前者构造成的 Bar 的 tuple.</p>
</li>
<li><p>检验 BDUSS 是否合法</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mpsign.core</span> <span class="kn">import</span> <span class="n">User</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">User</span><span class="p">(</span><span class="s1">'AN INVALID BDUSS'</span><span class="p">)</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>
<span class="bp">False</span>
</pre>
</li>
<li><p>TBS</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">tbs</span>
<span class="o">...</span>
</pre>
</li>
<li><p>fid</p>
<pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mpsign.core</span> <span class="kn">import</span> <span class="n">Bar</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Bar</span><span class="p">(</span><span class="s1">'chrome'</span><span class="p">)</span><span class="o">.</span><span class="n">fid</span>
<span class="s1">'1074587'</span>
</pre>
</li>
</ul>
</div>
<div id="id3">
<h2>命令行工具</h2>
<p>MPSIGN
提供一个现成的命令行工具，自带一个轻量的用户管理系统。所有的用户信息都会被储存在
<tt><span class="pre">~/.mpsign/.mpsigndb</span></tt> 之下。你可以配合 Linux Crontab
与此工具快速设置一个全自动的签到系统。</p>
<div id="id4">
<h3>基本用法</h3>
<pre>$ mpsign --help
Usage:
  mpsign login &lt;username&gt;
  mpsign <span class="o">(</span>new<span class="p">|</span><span class="nb">set</span><span class="o">)</span> &lt;user&gt; &lt;bduss&gt; <span class="o">[</span>--without-verifying<span class="o">]</span>
  mpsign <span class="o">(</span>delete<span class="p">|</span>update<span class="o">)</span> <span class="o">[</span>&lt;user&gt;<span class="o">]</span>
  mpsign sign <span class="o">[</span>&lt;user&gt;<span class="o">]</span> <span class="o">[</span>--delay<span class="o">=</span>&lt;second&gt;<span class="o">]</span>
  mpsign info <span class="o">[</span>&lt;user&gt;<span class="o">]</span>
  mpsign -h <span class="p">|</span> --help
  mpsign -v <span class="p">|</span> --version

Options:
  -h --help             Show this screen.
  -v --version          Show version.
  --without-verifying   Do not verify BDUSS.
  --bduss               Your Baidu BDUSS.
  --username            Your Baidu ID
  --user                Your mpsign ID.
  --delay<span class="o">=</span>&lt;second&gt;      Delay <span class="k">for</span> every single bar <span class="o">[</span>default: 3<span class="o">]</span>.
</pre>
</div>
</div>


<a name="downloads"> </a>


<ul class="nodot">
  <li><strong>Downloads (All Versions):</strong></li>
  <li>
    <span>0</span> downloads in the last day
  </li>
  <li>
    <span>145</span> downloads in the last week
  </li>
  <li>
    <span>1089</span> downloads in the last month
  </li>
</ul>









            </div>


          </div>
          </div></body></html>