<html><body><div><div class="pf-content"><p>The other day I was trying to figure out a way to monitor the print queue on Windows. The task at hand was to keep track of what documents went to the printer and completely successfully. The idea was that when the print completed, the document would then be archived. To do this sort of thing, you need <a href="http://sourceforge.net/projects/pywin32/" target="_blank">PyWin32</a> (AKA: Python for Windows extensions). In this article, we’ll look at a simple script that checks the print queue. <span id="more-3630"/></p>
<p>Here’s the code:</p>
<pre class="python"><span>import</span> <span>time</span>
<span>import</span> win32print
 
<span>#----------------------------------------------------------------------</span>
<span>def</span> print_job_checker<span>(</span><span>)</span>:
    <span>""</span><span>"
    Prints out all jobs in the print queue every 5 seconds
    "</span><span>""</span>
    jobs = <span>[</span><span>1</span><span>]</span>
    <span>while</span> jobs:
        jobs = <span>[</span><span>]</span>
        <span>for</span> p <span>in</span> win32print.<span>EnumPrinters</span><span>(</span>win32print.<span>PRINTER_ENUM_LOCAL</span>,
                                         <span>None</span>, <span>1</span><span>)</span>:
            flags, desc, name, comment = p
 
            phandle = win32print.<span>OpenPrinter</span><span>(</span>name<span>)</span>
            print_jobs = win32print.<span>EnumJobs</span><span>(</span>phandle, <span>0</span>, <span>-1</span>, <span>1</span><span>)</span>
            <span>if</span> print_jobs:
                jobs.<span>extend</span><span>(</span><span>list</span><span>(</span>print_jobs<span>)</span><span>)</span>
            <span>for</span> job <span>in</span> print_jobs:
                <span>print</span> <span>"printer name =&gt; "</span> + name
                document = job<span>[</span><span>"pDocument"</span><span>]</span>
                <span>print</span> <span>"Document name =&gt; "</span> + document
            win32print.<span>ClosePrinter</span><span>(</span>phandle<span>)</span>
 
        <span>time</span>.<span>sleep</span><span>(</span><span>5</span><span>)</span>
    <span>print</span> <span>"No more jobs!"</span>
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    print_job_checker<span>(</span><span>)</span></pre>
<p>First off we import <strong>win32print</strong> and the time module. We need win32print to access the printer. We create a potentially infinite loop to keep checking for jobs in the print queue. If the jobs list is ever empty, that means there is nothing left in the print queue and the function will exit. In the code above we use <strong>win32print.EnumPrinters()</strong> to loop over the printers that are installed on the machine. The first argument is a flag (win32print.PRINTER_ENUM_LOCAL), the second is a name (or None in this case), and the third is information level. There are several flags we can use, such as PRINTER_ENUM_SHARED, PRINTER_ENUM_LOCAL or PRINTER_ENUM_CONNECTIONS. I went with PRINTER_ENUM_LOCAL because it was returning a printer name in a format that I could use with win32print’s <strong>OpenPrinter</strong> method. We do this to query the printer for information via a handle. To get a list of the print jobs, we call win32print.EnumJobs() with the print handle. Then we loop over them and print out the printer name and the document name. You don’t need to do all these prints, but I found it helpful when I was writing the code. For testing purposes, I recommend opening the print queue and setting it to “paused” so that you can prevent printing paper until you are ready. This allows you to still add items to the print queue that you can query.</p>
<p>I put a 5 seconds delay between checks to make sure there are no new updates to the queue. If there are print jobs, it checks the queue again. Otherwise it breaks out of the loop.</p>
<p>Hopefully you will find this piece of code useful for something you are doing. Enjoy!</p>
<h3>Additional Information</h3>
<p>
</p>
</div>	</div></body></html>