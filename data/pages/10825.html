<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-wxbot---" class="anchor" href="#wxbot---" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>wxBot <a href="http://github.com/liuwons/wxBot"><img src="https://camo.githubusercontent.com/1966e4ac12c6cbad767b12c7d2ae75ec26d5868b/687474703a2f2f6769746875622d7376672d627574746f6e732e6865726f6b756170702e636f6d2f737461722e7376673f757365723d6c6975776f6e73267265706f3d7778426f74267374796c653d666c6174266261636b67726f756e643d313038314331" alt="star this repo" data-canonical-src="http://github-svg-buttons.herokuapp.com/star.svg?user=liuwons&amp;repo=wxBot&amp;style=flat&amp;background=1081C1"/></a> <a href="http://github.com/liuwons/wxBot/fork"><img src="https://camo.githubusercontent.com/583287998dc1b936dde16bea3118e1f5382c41fb/687474703a2f2f6769746875622d7376672d627574746f6e732e6865726f6b756170702e636f6d2f666f726b2e7376673f757365723d6c6975776f6e73267265706f3d7778426f74267374796c653d666c6174266261636b67726f756e643d313038314331" alt="fork this repo" data-canonical-src="http://github-svg-buttons.herokuapp.com/fork.svg?user=liuwons&amp;repo=wxBot&amp;style=flat&amp;background=1081C1"/></a> <a href="https://camo.githubusercontent.com/392a32588691a8418368a51ff33a12d41f11f0a9/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d322e372d6666363962342e737667" target="_blank"><img src="https://camo.githubusercontent.com/392a32588691a8418368a51ff33a12d41f11f0a9/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f707974686f6e2d322e372d6666363962342e737667" alt="python" data-canonical-src="https://img.shields.io/badge/python-2.7-ff69b4.svg"/></a></h1>

<p>Python包装Web微信实现的微信机器人框架。可以很容易地实现微信机器人。</p>

<h2><a id="user-content-环境与依赖" class="anchor" href="#环境与依赖" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>环境与依赖</h2>

<p>目前只能运行于Python 2环境 。
<strong>wxBot</strong> 用到了Python <strong>requests</strong> , <strong>pypng</strong> , 以及 <strong>pyqrcode</strong> 库，使用之前需要安装这三个库:</p>

<div class="highlight highlight-source-shell"><pre>pip install requests
pip install pyqrcode
pip install pypng</pre></div>

<h2><a id="user-content-快速开发" class="anchor" href="#快速开发" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>快速开发</h2>

<h3><a id="user-content-代码" class="anchor" href="#代码" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>代码</h3>

<p>利用 <strong>wxBot</strong> 最简单的方法就是继承WXBot类并实现handle_msg_all或者schedule函数，然后实例化子类并run，如下的代码对所有来自好友的文本消息回复 "hi"， 并不断向好友tb发送"schedule"。
handle_msg_all函数用于处理收到的每条消息，而schedule函数可以做一些任务性的事情(例如不断向好友推送信息或者一些定时任务)。</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c">#!/usr/bin/env python</span>
<span class="pl-c"># coding: utf-8</span>

<span class="pl-k">import</span> time
<span class="pl-k">from</span> wxbot <span class="pl-k">import</span> <span class="pl-k">*</span>

<span class="pl-k">class</span> <span class="pl-en">MyWXBot</span>(<span class="pl-e">WXBot</span>):
    <span class="pl-k">def</span> <span class="pl-en">handle_msg_all</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">msg</span>):
        <span class="pl-k">if</span> msg[<span class="pl-s"><span class="pl-pds">'</span>msg_type_id<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-c1">4</span> <span class="pl-k">and</span> msg[<span class="pl-s"><span class="pl-pds">'</span>content<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>type<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-c1">0</span>:
            <span class="pl-v">self</span>.send_msg_by_uid(<span class="pl-s"><span class="pl-pds">'</span>hi<span class="pl-pds">'</span></span>, msg[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>])

    <span class="pl-k">def</span> <span class="pl-en">schedule</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
        <span class="pl-v">self</span>.send_msg(<span class="pl-s"><span class="pl-pds">'</span>tb<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>schedule<span class="pl-pds">'</span></span>)
        time.sleep(<span class="pl-c1">1</span>)

<span class="pl-k">def</span> <span class="pl-en">main</span>():
    bot <span class="pl-k">=</span> MyWXBot()
    bot.<span class="pl-c1">DEBUG</span> <span class="pl-k">=</span> <span class="pl-c1">True</span>
    bot.run()

<span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    main()
</pre></div>

<h3><a id="user-content-运行" class="anchor" href="#运行" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>运行</h3>

<p>直接用python运行代码(如运行测试代码test.py):</p>



<h3><a id="user-content-登录微信" class="anchor" href="#登录微信" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>登录微信</h3>

<p>程序运行之后，会在当前目录下生成二维码图片文件 qr.png ，用微信扫描此二维码并按操作指示确认登录网页微信。</p>

<p><a href="/liuwons/wxBot/blob/master/img/1.png" target="_blank"><img src="/liuwons/wxBot/raw/master/img/1.png" alt="1"/></a></p>

<p>如果运行在Linux下，还可以通过设置WXBot对象的conf['qr']为'tty'的方式直接在终端打印二维码(此方法只能在Linux终端下使用)，效果如下：</p>

<p><a href="/liuwons/wxBot/blob/master/img/login_on_ubuntu.png" target="_blank"><img src="/liuwons/wxBot/raw/master/img/login_on_ubuntu.png" alt="login_on_ubuntu"/></a></p>

<h2><a id="user-content-效果展示" class="anchor" href="#效果展示" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>效果展示</h2>

<p>测试代码test.py的运行效果：</p>

<p><a href="/liuwons/wxBot/blob/master/img/send_msg.png" target="_blank"><img src="/liuwons/wxBot/raw/master/img/send_msg.png" alt="向机器人发送消息"/></a></p>

<p><a href="/liuwons/wxBot/blob/master/img/backfront.jpg" target="_blank"><img src="/liuwons/wxBot/raw/master/img/backfront.jpg" alt="后台"/></a></p>

<h2><a id="user-content-接口" class="anchor" href="#接口" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>接口</h2>

<h3><a id="user-content-handle_msg_all" class="anchor" href="#handle_msg_all" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>handle_msg_all</h3>

<p>handle_msg_all函数的参数msg是代表一条消息的字典。字段的内容为：</p>

<table><thead>
<tr>
<th>字段名</th>
<th>字段内容</th>
</tr>
</thead><tbody>
<tr>
<td>msg_type_id</td>
<td>整数，消息类型，具体解释可以查看消息类型表</td>
</tr>
<tr>
<td>msg_id</td>
<td>字符串，消息id</td>
</tr>
<tr>
<td>content</td>
<td>字典，消息内容，具体含有的字段请参考消息类型表，一般含有type(数据类型)与data(数据内容)字段，type与data的对应关系可以参考数据类型表</td>
</tr>
<tr>
<td>user</td>
<td>字典，消息来源，字典包含name(发送者名称)字段与id(发送者id)字段，都是字符串</td>
</tr>
</tbody></table>

<p>消息类型表：</p>

<table><thead>
<tr>
<th>类型号</th>
<th>消息类型</th>
<th>content</th>
</tr>
</thead><tbody>
<tr>
<td>0</td>
<td>初始化消息，内部数据</td>
<td>无意义，可以忽略</td>
</tr>
<tr>
<td>1</td>
<td>自己发送的消息</td>
<td>无意义，可以忽略</td>
</tr>
<tr>
<td>2</td>
<td>文件消息</td>
<td>字典，包含type与data字段</td>
</tr>
<tr>
<td>3</td>
<td>群消息</td>
<td>字典， 包含user(字典，包含id与name字段，都是字符串，表示发送此消息的群用户)与type、data字段</td>
</tr>
<tr>
<td>4</td>
<td>联系人消息</td>
<td>字典，包含type与data字段</td>
</tr>
<tr>
<td>5</td>
<td>公众号消息</td>
<td>字典，包含type与data字段</td>
</tr>
<tr>
<td>6</td>
<td>特殊账号消息</td>
<td>字典，包含type与data字段</td>
</tr>
<tr>
<td>99</td>
<td>未知账号消息</td>
<td>无意义，可以忽略</td>
</tr>
</tbody></table>

<p>数据类型表：</p>

<table><thead>
<tr>
<th>type</th>
<th>数据类型</th>
<th>data</th>
</tr>
</thead><tbody>
<tr>
<td>0</td>
<td>文本</td>
<td>字符串，表示文本消息的具体内容</td>
</tr>
<tr>
<td>1</td>
<td>地理位置</td>
<td>字符串，表示地理位置</td>
</tr>
<tr>
<td>3</td>
<td>图片</td>
<td>字符串，图片数据的url，HTTP POST得到jpg文件格式的数据</td>
</tr>
<tr>
<td>4</td>
<td>语音</td>
<td>字符串，语音数据的url，HTTP POST得到mp3文件格式的数据</td>
</tr>
<tr>
<td>5</td>
<td>名片</td>
<td>字典，包含nickname(昵称)，alias(别名)，province(省份)，city(城市)， gender(性别)字段</td>
</tr>
<tr>
<td>6</td>
<td>动画</td>
<td>字符串， 动画url</td>
</tr>
<tr>
<td>7</td>
<td>分享</td>
<td>字典，包含type(类型)，title(标题)，desc(描述)，url(链接)，from(来自)字段</td>
</tr>
<tr>
<td>8</td>
<td>视频</td>
<td>字符串，未解析的xml字符串</td>
</tr>
<tr>
<td>9</td>
<td>视频电话</td>
<td>字符串，未解析的xml字符串</td>
</tr>
<tr>
<td>10</td>
<td>撤回消息</td>
<td>字符串，未解析的xml字符串</td>
</tr>
<tr>
<td>11</td>
<td>空内容</td>
<td>空字符串</td>
</tr>
<tr>
<td>12</td>
<td>未知类型</td>
<td>字符串，未解析的xml字符串</td>
</tr>
</tbody></table>

<h3><a id="user-content-wxbot对象属性" class="anchor" href="#wxbot对象属性" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>WXBot对象属性</h3>

<p>WXBot对象在登录并初始化之后,含有以下的可用数据:</p>

<table><thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>contact_list</td>
<td>当前用户的微信联系人列表</td>
</tr>
<tr>
<td>group_list</td>
<td>当前用户的微信群列表</td>
</tr>
<tr>
<td>public_list</td>
<td>当前用户关注的公众号列表</td>
</tr>
<tr>
<td>special_list</td>
<td>特殊账号列表</td>
</tr>
<tr>
<td>session</td>
<td>WXBot与WEB微信服务器端交互所用的requests Session对象</td>
</tr>
</tbody></table>

<p>WXBot对象还含有一些可以利用的方法：</p>

<table><thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead><tbody>
<tr>
<td>get_icon(id)</td>
<td>获取用户icon并保存到本地文件 img_[id].jpg ,id为用户id(Web微信数据)</td>
</tr>
<tr>
<td>get_head_img(id)</td>
<td>获取用户头像并保存到本地文件 img_[id].jpg，id为用户id(Web微信数据)</td>
</tr>
<tr>
<td>get_msg_img(msgid)</td>
<td>获取图像消息并保存到本地文件 img_[msgid].jpg, msgid为消息id(Web微信数据)</td>
</tr>
<tr>
<td>get_voice(msgid)</td>
<td>获取语音消息并保存到本地文件 voice_[msgid].mp3, msgid为消息id(Web微信数据)</td>
</tr>
<tr>
<td>get_user_remark_name(uid)</td>
<td>获取好友的备注名，没有备注名则获取好友微信号， uid为好友的用户id(Web微信数据)</td>
</tr>
<tr>
<td>send_msg_by_uid(word, dst)</td>
<td>向好友发送消息，word为消息字符串，dst为好友用户id(Web微信数据)</td>
</tr>
<tr>
<td>send_msg(name, word, isfile)</td>
<td>向好友发送消息，name为好友的备注名或者好友微信号，isfile为False时word为消息，isfile为True时word为文件路径(此时向好友发送文件里的每一行)</td>
</tr>
<tr>
<td>is_contact(uid)</td>
<td>判断id为uid的账号是否是本帐号的好友，返回True(是)或False(不是)</td>
</tr>
<tr>
<td>is_public(uid)</td>
<td>判断id为uid的账号是否是本帐号所关注的公众号，返回True(是)或False(不是)</td>
</tr>
</tbody></table>
</article>
  </div></body></html>