<html><body><div><div class="text-content">
 

<p>This article is going to be different from the rest of my articles published on Analytics Vidhya – both in terms of content and format. I usually layout my article such that after a read, the reader is left to think about how this article can be implemented on grounds.</p>
<p><a href="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/Hacking-Google-Maps-1.jpg"><img class="size-full wp-image-19624 aligncenter" src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/Hacking-Google-Maps-1.jpg?resize=500%2C300" alt="Hacking Google Maps 1" srcset="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/Hacking-Google-Maps-1.jpg?resize=300%2C180 300w, http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/Hacking-Google-Maps-1.jpg?w=500 500w" sizes="(max-width: 500px) 100vw, 500px" data-recalc-dims="1"/></a></p>
<p>In this article, I will start with a round of brainstorming around a particular type of business problem and then talk about a sample analytics based solution to these problems. To make use of this article make sure that you follow my instructions carefully.</p>
<p>Let’s start with a few business cases:</p>
<ol>
<li><strong>Retail bank:</strong> Optimize primary bank branch allocation for all the customers. This is to make sure that the bank branch allotted to the customer is close to the mailing or permanent address of the customer for his convenience.  This might be specially applicable, if we open a new branch and the closest branch for many existing customer changes to this new branch.</li>
<li><strong>Retail Store chain:</strong> Send special offers to your loyal customers. But offers could be region specific so same offer cannot be sent to all. Hence, you first need to find the closest store to the customer and then mail the offer which is currently applicable for that store.</li>
<li><strong>Credit card company who sells co-branded cards:</strong> You wish to find out all partner stores which are closest to your existing client base and then mail them appropriate offers.</li>
<li><strong>Manufacturing plant:</strong> Wish to find out wholesalers near your plant for components required in manufacturing of the product.</li>
</ol>
<p>What is so common in all the problems mentioned above? Each of these problems deal with getting the distance between multiple combination of source and target destinations.</p>
<p><em><strong>Exercise : Think about at-least 2 such cases in your current industry and then at least 2 cases outside your current industry and write them in the comment section below.</strong></em></p>
<p> </p>
<h3><strong>A common approach </strong></h3>
<p>I have worked in multiple domains and saw this problem being solved in similar fashion which gives approximate but quick results.</p>
<p><em><strong>Exercise : Can you think of a method to do the same using your currently available data and resources?</strong></em></p>
<p>Here is the approach :</p>
<p>You generally have a PIN CODE for both source and destination. Using these PIN CODES, we find the centroid of these regions. Once you have both the centroids, you check their latitude and longitude. You finally calculate the eucledian distance between these two points. We approximate our required distance with this number. Following figure will explain the process better :</p>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/dist1.png"><img class=" size-full wp-image-14858 aligncenter" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/dist1.png?resize=627%2C454" alt="dist" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/dist1.png?resize=300%2C217 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/dist1.png?w=627 627w" sizes="(max-width: 627px) 100vw, 627px" data-recalc-dims="1"/></a></p>
<p> </p>
<p>The two marked areas refers to different PIN CODES and the distance 10 kms is used as an approximate distance between the two points.</p>
<p><em><strong>Exercise : Can you think of challenges with this approach ? </strong></em></p>
<p>Here are a few I can think of :</p>
<ol>
<li>If the point of interest is far away from the centroid, this approach will give inaccurate results.</li>
<li>Some times the centroid of other PIN CODE can be more closer to the point of interest than its own PIN CODE. But because it falls in area of the distant PIN CODE, we still approximate the point of interest with the centroid of distant PIN CODE.</li>
<li>In cases where we need finer distances than the precision of PIN CODE demarcation, this method will lead nowhere. Imagine a scenario where two branches of a bank and customer address is located in the same PIN CODE. We have no way to find the closest branch.</li>
<li>The distance calculated is a point to point distance and not on road. Imagine a scenario when you have two PIN Codes right next to each other but you have valley between which you need to circle around to reach destination.</li>
</ol>
<p> </p>
<h3><strong>A manual Approach</strong></h3>
<p>Say you have two branches and a single customer, how will you make a call between the two branches (which one is closer)? Here is a step by step approach :</p>
<ol>
<li>You choose the first combination of branch-customer pair.</li>
<li>You feed the two addresses in Google Maps.</li>
<li>You pick the distance/time on road</li>
<li>You fill in the distance in the table with the combinations (2 in this case)</li>
<li>Repeat the same process with the other combination.</li>
</ol>
<p> </p>
<h3><strong>How to automate this approach?</strong></h3>
<p>Obviously, this process cannot be done manually for millions of customers and thousands of branches. But this process can be well automated (however, Google API have a few caps on the total number of searches). Here is a simple Python code which can be used to create functions to calculate the distance between two points on Google Map.</p>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code11.png"><img class="alignnone size-large wp-image-14855" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code11.png?resize=1024%2C345" alt="code1" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code11.png?resize=300%2C101 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code11.png?resize=1024%2C345 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code11.png?resize=850%2C286 850w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code11.png?w=1182 1182w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a></p>
<p> </p>
<p><em><strong>Exercise : Create a table with a few sources and destinations. Use these functions to find distance and time between those points. Reply “Done without support” if you are able to implement the code without looking at the rest of the solution.</strong></em></p>
<p>Here is how we can read in a table of different source-destination combinations :</p>
<p><a href="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code2.png"><img class="alignnone size-large wp-image-14856" src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code2.png?resize=1024%2C391" alt="code2" srcset="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code2.png?resize=300%2C115 300w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code2.png?resize=1024%2C391 1024w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code2.png?resize=850%2C324 850w, http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code2.png?w=1179 1179w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a>Notice that we have all types of combinations here. Combination 1 is a combo of two cities. Combo 4 is a combination of two detailed address. Combo 6 is a combination of a city and a monument. Let’s now try to get the distances and time &amp; check if they make sense.</p>
<p><a href="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code3.png"><img class="alignnone size-large wp-image-14857" src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code3.png?resize=1024%2C382" alt="code3" srcset="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code3.png?resize=300%2C112 300w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code3.png?resize=1024%2C382 1024w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code3.png?resize=850%2C317 850w, http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/03/code3.png?w=1213 1213w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"/></a>All the distance and time calculations in this table look accurate.</p>
<p><em><strong>Exercise : What are the benefits of using this approach over the PIN CODE approach mentioned above? Can you think of a better way to do this task</strong></em>?</p>
<p>Here is the complete Code :</p>
<div id="stb-container-7316" class="stb-container-css stb-grey-container stb-image-none stb-ltr stb-corners stb-side-none"><aside class="stb-icon"><img src="http://i2.wp.com/www.analyticsvidhya.com/blog/wp-content/plugins/wp-special-textboxes/images/gears-b.png" data-recalc-dims="1"/></aside><div id="stb-box-7316" class="stb-grey_box stb-box">
<pre>import googlemaps
from datetime import datetime</pre>
<pre>def finddist(source, destination):
     gmaps = googlemaps.Client(key='XXX')
    now = datetime.now()
   directions_result = gmaps.directions(source, destination, mode="driving",departure_time=now)
   for map1 in directions_result:
         overall_stats = map1['legs']
         for dimensions in overall_stats:
                distance = dimensions['distance']
                return [distance['text']]
 
def findtime(source, destination):
      gmaps = googlemaps.Client(key='XXX')
      now = datetime.now()
      directions_result = gmaps.directions(source, destination, mode="driving",departure_time=now)
      for map1 in directions_result:
            overall_stats = map1['legs']
            for dimensions in overall_stats:
                   duration = dimensions['duration']
                   return [duration['text']]</pre>
<pre/>
<pre>import numpy as np
import pandas as pd
import pylab as pl 
import os
os.chdir(r"C:\Users\Tavish\Desktop")
cities = pd.read_csv("cities.csv")</pre>
<pre>cities["distance"] = 0
cities["time"] = 0
for i in range(0,8):
 source = cities['Source'][i]
 destination = cities['Destination'][i]
 cities['distance'][i] = finddist(source,destination)
 cities['time'][i] = findtime(source,destination)
</pre></div></div>


<p> </p>
<h3/>
<h3><strong>End Notes</strong></h3>
<p>GoogleMaps API come with a few limitations on the total number of searches. You can have look at the <a href="https://github.com/googlemaps/google-maps-services-python" target="_blank" rel="nofollow">documentation</a>, if you see a use case of this algorithm.</p>
<p>Did you find the article useful? Share with us find more use cases of GoogleMaps API usage apart from the one mentioned in this article? Also share with us any links of related video or article to leverage GoogleMaps API. Do let us know your thoughts about this article in the box below.</p>

<p/>
<p id="jp-relatedposts" class="jp-relatedposts">
<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p>
</div>
</div></body></html>