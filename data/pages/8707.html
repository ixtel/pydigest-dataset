<html><body><div><div class="css-entry"> 
                     										
                                
                   

            
				                                                                                                             	      	        			                             <p dir="ltr">My mother likes <a href="https://en.wikipedia.org/wiki/Fractal">fractals</a> for their strange beauty.  I decided to give her a simple way to generate beautiful fractal images of the <a href="https://en.wikipedia.org/wiki/Mandelbrot_set">Mandelbrot set</a>.  As you may guess, I'll be using Python for this.</p>

<p dir="ltr">There are available Python code for this on the web, but they are either slow, or they don't produce nice images.  Hence my own attempt at it.</p>

<p dir="ltr">The code used here is available in a notebook on <a href="https://gist.github.com/jfpuget/16eb22a3c26b6275d9dd">github</a> or on <a href="http://nbviewer.jupyter.org/gist/jfpuget/16eb22a3c26b6275d9dd">nbviewer</a>.  I explore various ways to speed that code in <a href="https://www.ibm.com/developerworks/community/blogs/jfp/entry/How_To_Compute_Mandelbrodt_Set_Quickly?lang=en" id="entry-e1951110-075e-42d6-8dad-e097e9e238e7:link:entries">How To Quickly Compute The Mandelbrot Set In Python </a>.</p>

<p dir="ltr">In order to tease you, here is one sample of what you'll be able to create very soon.  It is an image of the Mandelbrot set.</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_27.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_27.png"/></a></p>

<p dir="ltr">You can click on each image in this post to get a higher precision image.</p>

<h1 dir="ltr">Mandelbrot Set</h1>

<p dir="ltr">You can skip this explanation and directly go to the code if you wish, but I feel compelled to define precisely what we are computing here.</p>

<p dir="ltr">Each point in the plane of coordinates <em>(x,y)</em> can be interpreted as a complex number with real part <em>x</em> and imaginary part <em>y</em>.  Let <em>c</em> be such point.  We define a series of complex numbers for it:</p>

<p dir="ltr"><em>z<sub>0</sub> = 0</em></p>

<p dir="ltr"><em>z<sub>1</sub> = c</em></p>

<p dir="ltr"><em>z<sub>2</sub> = z<sub>1</sub><sup>2</sup> + c</em></p>

<p dir="ltr"><em>...</em></p>

<p dir="ltr"><em>z<sub>n+1</sub> = z<sub>n</sub><sup>2</sup> + c</em></p>

<p dir="ltr"> </p>

<p dir="ltr">If the size <em>|z<sub>n</sub>|</em> of these complex numbers stays bounded as <em>n</em> tends to infinity, then <em>c</em> belongs to the Mandelbrot set. </p>

<h1 dir="ltr">Computing Images</h1>

<p dir="ltr">In order to compute images, people usually compute the series until either<em> z<sub>n</sub></em> exceed a given horizon value, or <em>n</em> reaches a max number of iterations.  In the later case, we assume that the point belongs to the Mandelbrot set.</p>

<p dir="ltr">The following function computes that number with an horizon equal to 2.  It can be shown that using any value greater or equal to 2 for the horizon yields the same set.</p>

<blockquote dir="ltr">
<pre>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="k">import</span> <span class="n">jit</span>
</pre>

<p> </p>

<pre>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">mand<wbr>elbr<wbr>o<wbr>t</wbr></wbr></wbr></span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n"><wbr>maxi<wbr>te<wbr>r</wbr></wbr></wbr></span><span class="p">)<wbr>:</wbr></span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxiter</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">c</span>
    <span class="k">return</span> <span class="mi">0</span></pre>
</blockquote>

<p dir="ltr">The <span>@jit </span>says that I want the function to be compiled with Numba.  See <a href="https://www.ibm.com/developerworks/community/blogs/jfp/entry/Python_Meets_Julia_Micro_Performance?lang=en">How <wbr>To M<wbr>ake <wbr>Pyth<wbr>on R<wbr>un A<wbr>s Fa<wbr>st A<wbr>s Ju<wbr>li<wbr>a</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></a> to get a short introduction to Numba and how to install it.  If you can't install it, just remove the <span>@jit</span> lines in the code.  The code will run fine but it will be way slower.</p>

<p dir="ltr">The following function computes the number of iterations for all points in a given region of the plane.  It gets the number of pixels to compute as arguments.</p>

<blockquote dir="ltr">
<pre dir="ltr">
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">mand<wbr>elbr<wbr>ot_s<wbr>e<wbr>t</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">wi<wbr>dt<wbr>h</wbr></wbr></span><span class="p">,</span><span class="n">he<wbr>igh<wbr>t</wbr></wbr></span><span class="p">,</span><span class="n">ma<wbr>xite<wbr>r</wbr></wbr></span><span class="p">)<wbr>:</wbr></span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">em<wbr>pt<wbr>y</wbr></wbr></span><span class="p">(<wbr>(</wbr></span><span class="n">wid<wbr>t<wbr>h</wbr></wbr></span><span class="p">,</span><span class="n">he<wbr>igh<wbr>t</wbr></wbr></span><span class="p">)<wbr>)</wbr></span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">):</span>
            <span class="n">n3</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mandelbrot</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">r2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">maxiter</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">n3</span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr">It is rather fast.  Computing a 1M pixels image takes about 1.5 seconds on my old laptop.</p>

<h1 dir="ltr">Display</h1>

<p dir="ltr">We will use matplotlib in a Jupyter notebook.  We need to import it and we use the matplolib inline magic to display in the notebook.  Most of the code is about decorating the image.  The key piece is the use of the imshow function that displays the input array as an image.  The function gets the coordinates of the region to compute plus the size of the image to compute, in inches.</p>

<blockquote dir="ltr">
<pre>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">colors</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre>

<p> </p>

<pre>
<span class="k">def</span> <span class="nf">mand<wbr>elbr<wbr>ot_i<wbr>mag<wbr>e</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">wi<wbr>dt<wbr>h</wbr></wbr></span><span class="o">=</span><span class="mi">1<wbr>0</wbr></span><span class="p">,</span><span class="n">he<wbr>igh<wbr>t</wbr></wbr></span><span class="o">=</span><span class="mi">1<wbr>0</wbr></span><span class="p">,</span><span class="n">ma<wbr>xite<wbr>r</wbr></wbr></span><span class="o">=</span><span class="mi">25<wbr>6</wbr></span><span class="p">)<wbr>:</wbr></span>
    <span class="n">dpi</span> <span class="o">=</span> <span class="mi">72</span>
    <span class="n">img_width</span> <span class="o">=</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">width</span>
    <span class="n">img_height</span> <span class="o">=</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">height</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">mand<wbr>elbr<wbr>ot_s<wbr>e<wbr>t</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span><span class="p">,</span><span class="n">im<wbr>g_he<wbr>igh<wbr>t</wbr></wbr></wbr></span><span class="p">,</span><span class="n">ma<wbr>xite<wbr>r</wbr></wbr></span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pl<wbr>t</wbr></span><span class="o">.</span><span class="n">su<wbr>bplo<wbr>t<wbr>s</wbr></wbr></wbr></span><span class="p">(</span><span class="n">fi<wbr>gsiz<wbr>e</wbr></wbr></span><span class="o">=</span><span class="p">(</span><span class="n">w<wbr>idt<wbr>h</wbr></wbr></span><span class="p">,</span> <span class="n">height</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="p">)</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">ar<wbr>ang<wbr>e</wbr></wbr></span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n"><wbr>img_<wbr>widt<wbr>h</wbr></wbr></wbr></span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n"><wbr>dp<wbr>i</wbr></wbr></span><span class="p">)</span>
    <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">xma<wbr>x</wbr></span><span class="o">-</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">)</span><span class="o">*</span><span class="n">t<wbr>ick<wbr>s</wbr></wbr></span><span class="o">/</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">x_ticks</span><span class="p">)</span>
    <span class="n">y_ticks</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">+</span> <span class="p">(</span><span class="n">yma<wbr>x</wbr></span><span class="o">-</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">)</span><span class="o">*</span><span class="n">t<wbr>ick<wbr>s</wbr></wbr></span><span class="o">/</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">y_ticks</span><span class="p">)</span>
    
    <span class="n">a<wbr>x</wbr></span><span class="o">.</span><span class="n">im<wbr>sho<wbr>w</wbr></wbr></span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n"><wbr>T</wbr></span><span class="p">,</span><span class="n">or<wbr>igi<wbr>n</wbr></wbr></span><span class="o">=</span><span class="s">'l<wbr>ower<wbr>'</wbr></wbr></span><span class="p">)</span> 
    
    <span class="n">save_image</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr"> </p>

<p dir="ltr">The last line is optional, only use it if you also want to save the image as a file.  I used it to save the images shown in this entry with this function:</p>

<blockquote dir="ltr">
<pre>
<span class="n">image_counter</span> <span class="o">=</span> <span class="mi">30</span>

<span class="k">def</span> <span class="nf">save_image</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">image_counter</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s">"man<wbr>delb<wbr>rodt<wbr>_%d.<wbr>png<wbr>"</wbr></wbr></wbr></wbr></wbr></span> <span class="o">%</span> <span class="n">image_counter</span>
    <span class="n">image_counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">fi<wbr>g</wbr></span><span class="o">.</span><span class="n">sa<wbr>vefi<wbr>g</wbr></wbr></span><span class="p">(</span><span class="n">fi<wbr>lena<wbr>m<wbr>e</wbr></wbr></wbr></span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr">It can be shown that the Mandelbrot set is entirely contained in the region where -2.5 &lt;= x &lt;= 0.5 and -1.25 &lt;= y &lt;= 1.25.  Therefore, we call our function with these values:</p>

<blockquote dir="ltr">
<p dir="ltr"><span>mand<wbr>elbr<wbr>ot_i<wbr>mage<wbr>(-2.<wbr>0,0.<wbr>5,-1<wbr>.25,<wbr>1.25<wbr>)</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></p>
</blockquote>

<p dir="ltr">It yields this image of the Mandelbrot set.</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_0.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_0.png"/></a></p>

<h1 dir="ltr">Color Maps</h1>

<p dir="ltr">When I first shown this image to my wife, she asked if we could not use other colors.  I must tell you that <a href="http://www.marie-hermance.com">she is a painter</a>, and that color choices is her bread and butter.  Matplotlib lets us select the color palette when rendering an image. </p>

<p dir="ltr">In order to produce the above image, matplotlib maps each value in the input array to a color, before rendering the result.  The way values are mapped to colors is defined by color maps.  A list of predefined color maps can be found <a href="http://matplotlib.org/users/colormaps.html">here</a>. </p>

<p dir="ltr">We modify our function to accept a color map as input.  Jet is the default color map.</p>

<blockquote dir="ltr">
<pre>
<span class="k">def</span> <span class="nf">mand<wbr>elbr<wbr>ot_i<wbr>mag<wbr>e</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">wi<wbr>dt<wbr>h</wbr></wbr></span><span class="o">=</span><span class="mi">1<wbr>0</wbr></span><span class="p">,</span><span class="n">he<wbr>igh<wbr>t</wbr></wbr></span><span class="o">=</span><span class="mi">1<wbr>0</wbr></span><span class="p">,</span><span class="n">ma<wbr>xite<wbr>r</wbr></wbr></span><span class="o">=</span><span class="mi">8<wbr>0</wbr></span><span class="p">,</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="o">=</span><span class="s">'j<wbr>et<wbr>'</wbr></wbr></span><span class="p">)<wbr>:</wbr></span>
    <span class="n">dpi</span> <span class="o">=</span> <span class="mi">72</span>
    <span class="n">img_width</span> <span class="o">=</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">width</span>
    <span class="n">img_height</span> <span class="o">=</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">height</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">mand<wbr>elbr<wbr>ot_s<wbr>e<wbr>t</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span><span class="p">,</span><span class="n">im<wbr>g_he<wbr>igh<wbr>t</wbr></wbr></wbr></span><span class="p">,</span><span class="n">ma<wbr>xite<wbr>r</wbr></wbr></span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pl<wbr>t</wbr></span><span class="o">.</span><span class="n">su<wbr>bplo<wbr>t<wbr>s</wbr></wbr></wbr></span><span class="p">(</span><span class="n">fi<wbr>gsiz<wbr>e</wbr></wbr></span><span class="o">=</span><span class="p">(</span><span class="n">w<wbr>idt<wbr>h</wbr></wbr></span><span class="p">,</span> <span class="n">height</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="p">)</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">ar<wbr>ang<wbr>e</wbr></wbr></span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n"><wbr>img_<wbr>widt<wbr>h</wbr></wbr></wbr></span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n"><wbr>dp<wbr>i</wbr></wbr></span><span class="p">)</span>
    <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">xma<wbr>x</wbr></span><span class="o">-</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">)</span><span class="o">*</span><span class="n">t<wbr>ick<wbr>s</wbr></wbr></span><span class="o">/</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">x_ticks</span><span class="p">)</span>
    <span class="n">y_ticks</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">+</span> <span class="p">(</span><span class="n">yma<wbr>x</wbr></span><span class="o">-</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">)</span><span class="o">*</span><span class="n">t<wbr>ick<wbr>s</wbr></wbr></span><span class="o">/</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">y_ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    
    <span class="n">a<wbr>x</wbr></span><span class="o">.</span><span class="n">im<wbr>sho<wbr>w</wbr></wbr></span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n"><wbr>T</wbr></span><span class="p">,</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="o">=</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="p">,</span><span class="n">or<wbr>igi<wbr>n</wbr></wbr></span><span class="o">=</span><span class="s">'l<wbr>ower<wbr>'</wbr></wbr></span><span class="p">)</span> 
    
    <span class="n">save_image</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr">My wife looked at all color maps, and she decided that the 'hot' color map was producing beautiful colors.</p>

<blockquote dir="ltr">
<pre>
<span class="n">mand<wbr>elbr<wbr>ot_i<wbr>mag<wbr>e</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="o">-</span><span class="mf">2<wbr>.<wbr>0</wbr></wbr></span><span class="p">,</span><span class="mf">0.<wbr>5</wbr></span><span class="p">,</span><span class="o">-</span><span class="mf">1<wbr>.2<wbr>5</wbr></wbr></span><span class="p">,</span><span class="mf">1.<wbr>2<wbr>5</wbr></wbr></span><span class="p">,</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="o">=</span><span class="s">'h<wbr>ot<wbr>'</wbr></wbr></span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr">yields</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_1.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_1.png"/></a></p>

<p dir="ltr">The image is too dark and not all colors of the palette are used.  Could it be that the pixel values aren't distributed correctly?  There is only one way to answer that question: plot a histogram of the values taken by the pixels.  The higher the bar in the histogram, the more pixels have this value. </p>

<blockquote dir="ltr">
<p dir="ltr"><span>r1,r2,z = mand<wbr>elbr<wbr>ot_s<wbr>et(-<wbr>2.0,<wbr>0.5,<wbr>-1.2<wbr>5,1.<wbr>25,1<wbr>00,1<wbr>00,1<wbr>00)<br/>
plt.hist(z)<br/>
plt.show()</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></p>
</blockquote>

<p dir="ltr">yields</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/hist1.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/hist1.png"/></a></p>

<p dir="ltr">We see that most pixels have a value between 0 and 10.  We can spread the values using a low power normalization, for instance taking the 0.3 power of the values:</p>

<blockquote dir="ltr">
<p dir="ltr"><span>z3 = z ** 0.3<br/>
plt.hist(z3)<br/>
plt.show()</span></p>
</blockquote>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/hist2.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/hist2.png"/></a></p>

<p dir="ltr"> </p>

<p dir="ltr">This looks better.  We can achieve this normalization using a normalize object in our function.  This object takes as argument the power coefficient.  We pass it as the gamma argument to our function.</p>

<blockquote dir="ltr">
<pre>
<span class="k">def</span> <span class="nf">mand<wbr>elbr<wbr>ot_i<wbr>mag<wbr>e</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">wi<wbr>dt<wbr>h</wbr></wbr></span><span class="o">=</span><span class="mi">1<wbr>0</wbr></span><span class="p">,</span><span class="n">he<wbr>igh<wbr>t</wbr></wbr></span><span class="o">=</span><span class="mi">1<wbr>0</wbr></span><span class="p">,\
                     </span><span class="n">maxi<wbr>te<wbr>r</wbr></wbr></span><span class="o">=</span><span class="mi">8<wbr>0</wbr></span><span class="p">,</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="o">=</span><span class="s">'j<wbr>et<wbr>'</wbr></wbr></span><span class="p">,</span><span class="n">ga<wbr>mm<wbr>a</wbr></wbr></span><span class="o">=</span><span class="mf">0.<wbr>3</wbr></span><span class="p">)<wbr>:</wbr></span>
    <span class="n">dpi</span> <span class="o">=</span> <span class="mi">72</span>
    <span class="n">img_width</span> <span class="o">=</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">width</span>
    <span class="n">img_height</span> <span class="o">=</span> <span class="n">dpi</span> <span class="o">*</span> <span class="n">height</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">mand<wbr>elbr<wbr>ot_s<wbr>e<wbr>t</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span><span class="p">,</span><span class="n">im<wbr>g_he<wbr>igh<wbr>t</wbr></wbr></wbr></span><span class="p">,</span><span class="n">ma<wbr>xite<wbr>r</wbr></wbr></span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pl<wbr>t</wbr></span><span class="o">.</span><span class="n">su<wbr>bplo<wbr>t<wbr>s</wbr></wbr></wbr></span><span class="p">(</span><span class="n">fi<wbr>gsiz<wbr>e</wbr></wbr></span><span class="o">=</span><span class="p">(</span><span class="n">w<wbr>idt<wbr>h</wbr></wbr></span><span class="p">,</span> <span class="n">height</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="p">)</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">ar<wbr>ang<wbr>e</wbr></wbr></span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n"><wbr>img_<wbr>widt<wbr>h</wbr></wbr></wbr></span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n"><wbr>dp<wbr>i</wbr></wbr></span><span class="p">)</span>
    <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">xma<wbr>x</wbr></span><span class="o">-</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">)</span><span class="o">*</span><span class="n">t<wbr>ick<wbr>s</wbr></wbr></span><span class="o">/</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">x_ticks</span><span class="p">)</span>
    <span class="n">y_ticks</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">+</span> <span class="p">(</span><span class="n">yma<wbr>x</wbr></span><span class="o">-</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">)</span><span class="o">*</span><span class="n">t<wbr>ick<wbr>s</wbr></wbr></span><span class="o">/</span><span class="n">im<wbr>g_wi<wbr>dt<wbr>h</wbr></wbr></wbr></span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">y_ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    
    <span class="n">norm</span> <span class="o">=</span> <span class="n">colo<wbr>r<wbr>s</wbr></wbr></span><span class="o">.</span><span class="n">Po<wbr>werN<wbr>or<wbr>m</wbr></wbr></wbr></span><span class="p">(</span><span class="n">ga<wbr>mm<wbr>a</wbr></wbr></span><span class="p">)</span>
    <span class="n">a<wbr>x</wbr></span><span class="o">.</span><span class="n">im<wbr>sho<wbr>w</wbr></wbr></span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n"><wbr>T</wbr></span><span class="p">,</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="o">=</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="p">,</span><span class="n">or<wbr>igi<wbr>n</wbr></wbr></span><span class="o">=</span><span class="s">'l<wbr>ower<wbr>'</wbr></wbr></span><span class="p">,</span><span class="n">no<wbr>r<wbr>m</wbr></wbr></span><span class="o">=</span><span class="n">no<wbr>r<wbr>m</wbr></wbr></span><span class="p">)</span>  
    
    <span class="n">save_image</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr">Executing <span>mand<wbr>elbr<wbr>ot_i<wbr>mg(-<wbr>2.0,<wbr>0.5,<wbr>-1.2<wbr>5,1.<wbr>25,c<wbr>map=<wbr>'hot<wbr>'<wbr>)</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span> now yields</p>

<p dir="ltr"> </p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_2.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_2.png"/></a></p>

<p dir="ltr"> </p>

<p dir="ltr">Much better, but the image isn't perfect.  The region is segmented by color levels.  Some may find it aesthetic, but I'd rather have smooth transitions between color levels.</p>

<h1 dir="ltr">Anti Aliasing</h1>

<p dir="ltr">We can achieve smooth color transitions with the following function.  It computes a floating point value for each pixel rather than an integer.  The math behind it are given at the end of the post for those interested.  The main difference with the previous function is that we use a very large horizon instead of 2, namely 2<sup>40</sup> .</p>

<blockquote dir="ltr">
<pre>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">mand<wbr>elbr<wbr>o<wbr>t</wbr></wbr></wbr></span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n"><wbr>maxi<wbr>te<wbr>r</wbr></wbr></wbr></span><span class="p">,</span><span class="n">ho<wbr>rizo<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">lo<wbr>g_ho<wbr>rizo<wbr>n</wbr></wbr></wbr></span><span class="p">)<wbr>:</wbr></span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">z</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxiter</span><span class="p">):</span>
        <span class="n">az</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">az</span> <span class="o">&gt;</span> <span class="n">horizon</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">lo<wbr>g</wbr></span><span class="p">(</span><span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">lo<wbr>g</wbr></span><span class="p">(</span><span class="n">a<wbr>z</wbr></span><span class="p">)<wbr>)</wbr></span><span class="o">/</span><span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">lo<wbr>g</wbr></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">log_horizon</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">c</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">mand<wbr>elbr<wbr>ot_s<wbr>e<wbr>t</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="n">xm<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">xm<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>i<wbr>n</wbr></wbr></span><span class="p">,</span><span class="n">ym<wbr>a<wbr>x</wbr></wbr></span><span class="p">,</span><span class="n">wi<wbr>dt<wbr>h</wbr></wbr></span><span class="p">,</span><span class="n">he<wbr>igh<wbr>t</wbr></wbr></span><span class="p">,</span><span class="n">ma<wbr>xite<wbr>r</wbr></wbr></span><span class="p">)<wbr>:</wbr></span>
    <span class="n">horizon</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="mi">40</span>
    <span class="n">log_horizon</span> <span class="o">=</span> <span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">lo<wbr>g</wbr></span><span class="p">(</span><span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">lo<wbr>g</wbr></span><span class="p">(</span><span class="n">ho<wbr>rizo<wbr>n</wbr></wbr></span><span class="p">)<wbr>)</wbr></span><span class="o">/</span><span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">lo<wbr>g</wbr></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n<wbr>p</wbr></span><span class="o">.</span><span class="n">em<wbr>pt<wbr>y</wbr></wbr></span><span class="p">(<wbr>(</wbr></span><span class="n">wid<wbr>t<wbr>h</wbr></wbr></span><span class="p">,</span><span class="n">he<wbr>igh<wbr>t</wbr></wbr></span><span class="p">)<wbr>)</wbr></span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">):</span>
            <span class="n">n3</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mandelbrot</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">r<wbr>2</wbr></span><span class="p">[</span><span class="n">j</span><span class="p">]<wbr>,</wbr></span><span class="n">max<wbr>ite<wbr>r</wbr></wbr></span><span class="p">,</span><span class="n">ho<wbr>rizo<wbr>n</wbr></wbr></span><span class="p">,</span> <span class="n">log_horizon</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">n3</span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr">Using it yields this image of the Mandelbrot set</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_5.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_5.png"/></a></p>

<p dir="ltr">This is much better, we no longer see the sharp transitions we had between colors. </p>

<h1 dir="ltr">Zooming In</h1>

<p dir="ltr">We can now zoom in the image if we wish to, by modifying the coordinates of the region we want to display.  For instance, this zooms into the valley between the two largest black areas:</p>

<blockquote dir="ltr">
<pre>
<span class="n">mand<wbr>elbr<wbr>ot_i<wbr>mag<wbr>e</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="o">-</span><span class="mf">0<wbr>.<wbr>8</wbr></wbr></span><span class="p">,</span><span class="o">-</span><span class="mf">0<wbr>.<wbr>7</wbr></wbr></span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf"><wbr>0.<wbr>1</wbr></wbr></span><span class="p">,</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="o">=</span><span class="s">'h<wbr>ot<wbr>'</wbr></wbr></span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_7.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_7.png"/></a></p>

<p dir="ltr">Oops, the result does not look right.  We need to use a larger number of iterations for a more accurate result, say 1024 iterations.</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_8.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_8.png"/></a></p>

<p dir="ltr">Win.</p>

<p dir="ltr">For the images below we use 2048 iterations.  Computation time stays reasonable, a couple of seconds for a 1M pixels image, to my surprise.  In fact, the less black in the picture, the faster the computation.  I'll let readers figure out why.</p>

<p dir="ltr">Zooming on the right side of the valley yields a nice set of inverted sea horses.</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_11.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_11.png"/></a></p>

<p dir="ltr">Zooming on one of these sea horses</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_12.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_12.png"/></a></p>

<p dir="ltr">Zooming on its tail</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_13.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_13.png"/></a></p>

<p dir="ltr">Zooming on the tiny black dot near the lower left corner</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_14.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_14.png"/></a></p>

<p dir="ltr">Surprise!  The black dot appears to be a copy of the whole Mandelbrot set itself.  This is not by chance.  It is precisely because small parts are similar to the whole that the Mandelbrot set is a fractal.</p>

<h1 dir="ltr">Your Turn</h1>

<p dir="ltr">You are all set.  You can use the code to zoom in any region you'd like.  Beware though that there will be a limit on how far you can go before hitting rounding error problems.  You can also explore using other color maps. </p>

<p dir="ltr">For instance, here is the Mandelbrot set with the magma color map.</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_27.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_27.png"/></a></p>

<p dir="ltr">And here is the latest detail with the gnuplot2 color map.</p>

<p dir="ltr"><a href="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_40.png" target="_blank"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/jfp/resource/BLOGS_UPLOADED_IMAGES/mandelbrodt_40.png"/></a></p>

<p dir="ltr">You may need to change the gamma parameter to get better results, depending on the color map and on the number of iterations. </p>

<p dir="ltr">You can also create larger images, by providing new values for the width and height.  These are expressed in inches.  For instance, to create a 20x20 inches image you can call:</p>

<blockquote dir="ltr">
<pre>
<span class="n">mand<wbr>elbr<wbr>ot_i<wbr>mag<wbr>e</wbr></wbr></wbr></wbr></span><span class="p">(</span><span class="o">-</span><span class="mf">2<wbr>.<wbr>0</wbr></wbr></span><span class="p">,</span><span class="mf">0.<wbr>5</wbr></span><span class="p">,</span><span class="o">-</span><span class="mf">1<wbr>.2<wbr>5</wbr></wbr></span><span class="p">,</span><span class="mf">1.<wbr>2<wbr>5</wbr></wbr></span><span class="p">,</span><span class="n">cm<wbr>a<wbr>p</wbr></wbr></span><span class="o">=</span><span class="s">'h<wbr>ot<wbr>'</wbr></wbr></span><span>,wi<wbr>dth=<wbr>20,h<wbr>eigh<wbr>t=2<wbr>0</wbr></wbr></wbr></wbr></wbr></span><span class="p">)</span></pre>
</blockquote>

<p dir="ltr">If you want to save images for a printer, then you should change the dpi value in the function from 72 to 300.  Beware, this will slow computation.</p>

<p dir="ltr">As promised I'll conclude with an explanation of why our second <span>mandelbrot_set</span> function provides smooth colors.  Non mathematically oriented readers can skip it safely.</p>

<h1 dir="ltr">Some Math</h1>

<p dir="ltr">Let's see how we moved to an integer number of iterations to a floating point value.  The first step is to chose a very large horizon <em>h</em>.  We use <em>h = 2<sup>40</sup></em> which is about one trillion.  For a given point <em>c</em>, we have</p>

<p dir="ltr"><em>z<sub>n+1</sub> = z<sub>n</sub><sup>2</sup> + c</em></p>

<p dir="ltr">When the size of <em>z<sub>n</sub></em> is approaching <em>h</em>, then we can neglect <em>c</em>, and we have that</p>

<p dir="ltr"><em>z<sub>n+1</sub> = z<sub>n</sub><sup>2</sup></em></p>

<p dir="ltr">Taking the log of the size of on both side we get</p>

<p dir="ltr"><em>log( |z<sub>n+1</sub>| ) = 2 log( |z<sub>n</sub>| )</em></p>

<p dir="ltr">Therefore, <em>log( |z<sub>n</sub>| )</em> grows like the power of 2:</p>

<p dir="ltr"><em>log( |z<sub>n</sub> | ) = 2<sup>n+a</sup></em></p>

<p dir="ltr">for some constant a. Taking the log base 2 we get</p>

<p dir="ltr"><em>f(n) = n+a</em></p>

<p dir="ltr">where</p>

<p dir="ltr"><em>f(n) = log( log( |z<sub>n</sub>| ) ) / log(2)</em></p>

<p dir="ltr">Let's define <em>g(x) = x + a</em> for any real number <em>x</em>.  We have that <em>g(x) = f(x</em>) when <em>x </em>is integer.</p>

<p dir="ltr">Let <em>N</em> be the first iteration where <em>|z<sub>N</sub>|</em> exceeds the horizon <em>h</em>:</p>

<p dir="ltr"><em>|z<sub>N-1</sub>| &lt; h &lt;= | z<sub>N</sub> |</em></p>

<p dir="ltr">Taking the log twice</p>

<p dir="ltr"><em>g(N-1) &lt; log( log(h) ) / log(2) &lt;= g(N)</em></p>

<p dir="ltr">Instead of returning <em>N</em>, we want to return <em>A </em>such that <em>g(A) = log( log(h) ) / log(2)</em></p>

<p dir="ltr">A is the value where <em>g</em> crosses the horizon.  We would then have</p>

<p dir="ltr"><em>g(N-1) &lt; g(A)&lt;= g(N)</em></p>

<p dir="ltr">which is what we are looking for.</p>

<p dir="ltr">We have</p>

<p dir="ltr"><em>A = g(A) - a = log( log(h) ) / log(2) - a = log( log(h) ) / log(2) - f(N) + N </em></p>

<p dir="ltr">This is what our function computes. Q.E.D.</p>

<p dir="ltr">I didn't invent that approach, but my exposure may be different from others. Wikipedia provides these references:</p>

<ol class="references" dir="ltr">
	<li id="cite_note-26"><span class="reference-text"><cite class="citation journal">García, Francisco; Ángel Fernández; Javier Barrallo; Luis Martín. <a class="external text" href="http://math.unipa.it/%7Egrim/Jbarrallo.PDF" rel="nofollow">"Coloring Dynamical Systems in the Complex Plane"</a> <span>(PDF)</span><span class="reference-accessdate">. Retrieved <span class="nowrap">2008-01-21</span></span>.</cite></span></li>
	<li><span class="reference-text"><cite class="citation web">Linas Vepstas. <a class="external text" href="http://linas.org/art-gallery/escape/escape.html" rel="nofollow">"Renormalizing the Mandelbrot Escape"</a>.</cite></span></li>
</ol>

<p dir="ltr"> </p>           
                                	                                   <p/>

                    
                                                                  
                                                   
           <p/>
           
	        </div>
 		</div></body></html>