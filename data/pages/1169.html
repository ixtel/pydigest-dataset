<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-ipython-vimception" class="anchor" href="#ipython-vimception" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>IPython Vimception</h1>

<p>Vim-within-Vim in the IPython Notebook.</p>

<p>In my "Putting the V in IPython" talk at SciPy2014, I spent <a href="https://www.youtube.com/watch?v=p9gnhmX1sPo#t=723">half of my time
talking about ipython-vimception</a>.
Here are the <a href="http://nbviewer.ipython.org/github/ivanov/scipy2014/blob/master/v%20in%20IPython.ipynb">slides for the talk</a>.</p>

<p>This is a work in progress. For now, put these files into a folder called
<code>vimception</code> (<strong>not</strong> <code>ipython-vimception</code>) in the <code>extensions</code> subdirectory of whatever <code>ipython locate</code>
returns, usually these files go into the <code>~/.ipython/extensions</code> directory.</p>

<p>Once you do that, in the notebook, just make an execute a cell with:</p>

<pre><code>%load_ext vimception
</code></pre>

<p>Once you're satisfied that the above works, you can edit your profile's
static/custom/custom.js to have this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">load_vimception</span>() {
    cell <span class="pl-k">=</span> <span class="pl-smi">IPython</span>.<span class="pl-smi">notebook</span>.<span class="pl-en">insert_cell_at_index</span>(<span class="pl-s"><span class="pl-pds">'</span>code<span class="pl-pds">'</span></span>, <span class="pl-c1">0</span>);
    <span class="pl-smi">IPython</span>.<span class="pl-smi">notebook</span>.<span class="pl-c1">select</span>(<span class="pl-c1">0</span>);
    <span class="pl-smi">cell</span>.<span class="pl-en">set_text</span>(<span class="pl-s"><span class="pl-pds">'</span>%load_ext vimception<span class="pl-cce">\n</span>%reload_ext vimception<span class="pl-cce">\n</span>%vimception<span class="pl-pds">'</span></span>);
    <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">IPython</span>.<span class="pl-smi">notebook</span>.<span class="pl-smi">kernel</span>) {
        <span class="pl-en">$</span>([<span class="pl-smi">IPython</span>.<span class="pl-smi">events</span>]).<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>status_started.Kernel<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
            <span class="pl-smi">cell</span>.<span class="pl-en">execute</span>();
            <span class="pl-smi">IPython</span>.<span class="pl-smi">notebook</span>.<span class="pl-en">delete_cell</span>();
        });
    } <span class="pl-k">else</span> { 
        <span class="pl-smi">cell</span>.<span class="pl-en">execute</span>();
        <span class="pl-smi">IPython</span>.<span class="pl-smi">notebook</span>.<span class="pl-en">delete_cell</span>();
    }
}

<span class="pl-en">$</span>([<span class="pl-smi">IPython</span>.<span class="pl-smi">events</span>]).<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>notebook_loaded.Notebook<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(){
    <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">'</span>#help_menu<span class="pl-pds">'</span></span>).<span class="pl-en">prepend</span>([
            <span class="pl-s"><span class="pl-pds">'</span>&lt;li id="vimception" title="load up vimception cell"&gt;<span class="pl-pds">'</span></span>,
            <span class="pl-s"><span class="pl-pds">'</span>&lt;a href="#" title="vimception" onClick="load_vimception()"&gt;vimception&lt;/a&gt;&lt;/li&gt;<span class="pl-pds">'</span></span>,
            ].<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>));

<span class="pl-c">// uncomment next line to *always* start in vimception</span>
<span class="pl-c">// $('#vimception a').click();</span>
});</pre></div>

<p>This allows you to enter vimception by going clicking on <code>Help -&gt;
vimception </code>. To leave vimception, save and reload the notebook. If you
uncomment the last line to <em>always</em> start vimception, there will not be a way to
get out of vimception mode without editing custom.js and then reload the page.</p>

<p>It's all very rough right now, I'm working on it, so hang tight.</p>

<h2><a id="user-content-todo" class="anchor" href="#todo" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>TODO</h2>

<p>[ ] suppress switching into command mode when moving cursor past the top/bottom
     lines (using new methods Jonathan added)</p>

<p>[ ] make the multi-level escaping optional (i.e. allow only <code>ctrl-m</code> to take
     you to command mode)</p>

<p>[ ] look up what else I had in my todo a few weeks ago</p>

<p>[ ] add logic to %vimception to write vimception.json to profile_dir/static/custom
    - investigate json config in general (Matthias implemented this at some point)</p>

<p>[ ] multi-level undo</p>

<p>[ ] unalias v - and use nb-cccp if it's loaded </p>

<p>[ ] turn it into an nbextension (no python side)
    - implementing this should close #4 as well</p>

<p>[ ] Ctrl-n and Ctrl-p should work as local completion (like in vim)</p>

<p>[ ] on click, disable the vim fire</p>

<p>[ ] the cell that vimception is started from gets FUBARed  :\ or actuall just
    entering edit mode doesn't work?</p>

<p>[ ] allow going between cells independent of which character you're on</p>

<p>[ ] shift-J on the last line should join cell below</p>

<p>[ ] standardize on a post-load function that vimception will call to allow for
    further customization.</p>

<p>[ ] look into the codemirror changes <a href="https://github.com/codemirror/CodeMirror/issues/2915">here</a></p>

<h2><a id="user-content-related-projects" class="anchor" href="#related-projects" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Related Projects</h2>

<p><a href="https://github.com/ivanov/vim-ipython">vim-ipython</a> - A two-way integration
between Vim and IPython by the same author.</p>
</article>
  </div></body></html>