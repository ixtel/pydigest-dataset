<html><body><div><div class="ibm-col-1-1">

<p>Согласно распространенному заблуждению относительно разработки для платформы Google Android, программный для нее должен быть написан на языке Java™. В действительности имеется множество различных возможностей, реализуемых в рамках проекта SL4A (Scripting Layer for Android). Проект SL4A был начат сотрудником компании Google Деймоном Колером (Damon Kohler) в рамках 20-процентной квоты (Google официально разрешает своим разработчикам до 20% рабочего времени тратить на "инициативные" проекты). Это было почти два года назад. За это время было выпущено четыре этапные версии.
	</p><p>SL4A предоставляет платформу для нескольких скриптовых языков, включая Beanshell, Lua, Perl, Python и Rhino. Кроме того, поддерживаются базовые скрипты оболочки. В настоящее время работы по языку Python, проводившиеся в рамках проекта SL4A, выделилась в собственный отдельный проект. В значительной степени это произошло благодаря популярности Python и потребности в отделении выпусков новой функциональности Python от основного цикла выпусков системы SL4A. 
	</p><p>В данной статье основное внимание уделяется применению языка Python при написании приложений для платформы Android. Python – это превосходный инструмент для написания как простых скриптов, так и сложных многопоточных приложений. Поддержка Python на платформе Android важна потому, что позволяет использовать огромные объемы уже написанного и находящегося в свободном доступе программного кода. Язык Python прост в изучении даже для абсолютных новичков, к тому же в Интернете имеется множество ресурсов, помогающих ускорить его освоение. 
	</p><h2 id="Installation_setup">Установка и настройка</h2><p>Прежде чем вы сможете приступить к разработке с помощью SL4A, необходимо загрузить и установить несколько обязательных компонентов. Первым их них является полный комплект разработчика <strong>Java Development Kit (JDK)</strong>. Его последнюю версию можно найти на сайте Oracle для разработчиков.</p><p>Затем вам потребуется комплект <strong>Android software development kit
			(SDK)</strong>. На основном сайте для Android-разработчиков имеется два варианта загрузки: в виде zip-файла и в виде exe-файла. Если вы загрузите этот exe-файл и запустите его на исполнение, на экране появится окно, в котором вы должны выбрать, какие версии SDK и файлов поддержки вы хотите установить (см. рис. 1). 
		</p><h5 id="fig1">Рисунок 1. Выбор нужных опций Android SDK для загрузки 
				</h5><img alt="Window in which you choose your SDK options" src="figure1.jpg"/><p>Все необходимое для этой статьи я установил и протестировал на машине под управлением 64-разрядной версии Windows® 7. 
		</p><p>Эта статья посвящена разработке приложений для платформы Android с помощью языка Python, поэтому вполне очевидно, что вам необходимо установить Python на своей машине разработки. На Windows-компьютерах язык Python изначально не установлен. На момент написания этой статьи актуальная версия пакета SL4A Python имела номер 2.6.2. Для обеспечения совместимости со своей системой загрузите соответствующую <strong>версию Python 2.6 — 32-разрядную или 64-разрядную</strong>.
		</p><p>Рекомендуется добавить несколько <strong>ссылок на Android SDK в директиве PATH</strong>— это упростит запуск SDK Manager и других инструментов. Чтобы сделать это в среде Windows 7, выполните следующие шаги. 
		</p><ol><li>Нажмите клавишу Windows, а затем нажмите <strong>Search</strong>.</li><li>В текстовом поле введите <strong>Environment</strong>.</li><li>Нажмите на <strong>Edit the system environment variables</strong>.</li><li>В открывшемся окне нажмите <strong>Environment Variables</strong>,
					а затем выберите переменную PATH в списке <strong>User variables</strong>.
				</li><li>Нажмите <strong>Edit</strong>, а затем добавьте соответствующий маршрут к своему каталогу инструментов Android SDK. 
				</li></ol><p>Строка, которую необходимо добавить, имеет следующий вид</p><div class="codesection"><pre class="displaycode">;C:\Users\paul\Downloads\android-sdk-windows\platform-tools</pre></div><p>Необходимо поставить точку с запятой (<code>;</code>) перед новым маршрутом для добавления нового каталога. После того как вы введете соответствующую строку, нажмите <strong>OK</strong> три раза.
		</p><p>Процесс установки SL4A на Android-устройстве подобен процессу установки любого другого Android-приложения. Вы можете просканировать QR- код на основном сайте проекта SL4A с помощью своего устройства, чтобы загрузить <strong>SL4A installation file</strong>. После завершения загрузки этого файла он должен запуститься автоматически. В этот момент вы должны увидеть экран установки, показанный на рисунке 2. 
		</p><h5 id="fig2">Рисунок 2. Экран установки SL4A</h5><img alt="The installation screen for SL4A" src="figure2.jpg"/><p>Нажмите <strong>Install</strong> для запуска процесса.</p><p>Заключительный шаг состоит в установке <strong>интерпретатора Python</strong> на вашем устройстве. Это можно сделать с использованием любого из нескольких методов. Из эмулятора вы можете ввести текст
			<code>sl4a download</code> в поисковом поле браузера (рис. 3). 
		</p><h5 id="fig3">Рисунок 3. Экран загрузки SL4A</h5><img alt="Image showing the SL4A download screen" src="figure3.jpg"/><p>Нажмите на ссылку <strong>PythonForAndroid_r4.apk</strong> для запуска процесса загрузки. Чтобы действительно запустить установщик, просмотрите экран уведомления, для чего нажмите на него и переместитесь по нему от верхней до нижней части экрана. Нажмите на сообщение
			<strong>Download complete</strong> для запуска установщика Python for Android (рис. 4). 
		</p><h5 id="fig4">Рисунок 4. Начальный экран установки Python for Android  
				</h5><img alt="Image showing the initial SL4A installation screen" src="figure4.jpg"/><p>Нажмите <strong>Install</strong> для запуска процесса, который загружает и распаковывает несколько zip-файлов. В данном случае просто нажмите  <strong>Install</strong>
			на основном экране установки (рис. 5). 
		</p><h5 id="fig5">Рисунок 5. Основной экран установки Python for Android  
				</h5><img alt="Imaging showing the primary Python installation screen" src="figure5.jpg"/><p>Вы должны увидеть три отдельных окна хода выполнения. Первое окно демонстрирует процесс загрузки, а затем извлечения файлов на SD-карту. Если все прошло нормально, появится сообщение "Installation Successful". 
		</p><p class="ibm-alternate-rule"><hr/></p><p class="ibm-ind-link ibm-back-to-top"><a href="#ibm-pcon" class="ibm-anchor-up-link">В начало</a></p><h2 id="basics">Основы Android SDK</h2><p>Есть два основных метода для тестирования Python-кода с помощью SL4A: с использованием эмулятора или с использованием реального физического устройства. Android SDK предоставляет базовые возможности эмулятора и инструменты для создания эмулированного устройства с такими же характеристиками, как у соответствующего физического устройства. В некоторых случаях, например, при создании дополнительных модулей для планшетов Samsung, вы можете воспользоваться готовым эмулятором. 
		</p><p>Инструмент SDK Manager действует в качестве менеджера обновлений и инструмента для создания виртуального устройства. При каждом запуске инструмента SDK Manager он подключается к сайту для Android-разработчиков с целью проверки на наличие новых выпусков (вы можете пропустить этот процесс, нажав на <strong>Cancel</strong>). В этой точке вы должны видеть окно <strong>Android SDK and AVD Manager</strong>
			 (см. рис. 6). 
		</p><h5 id="fig6">Рисунок 6. Окно Android SDK and AVD Manager</h5><img alt="Image showing the Android SDK and AVD Manager screen" src="figure6.jpg"/><p>Выберите <strong>Virtual devices</strong> в дереве каталогов для отображения всех ранее определенных виртуальных Android-устройств (AVD — Android virtual device) в панели подробностей. Чтобы создать новый эмулятор устройства, нажмите <strong>New</strong>. В окне <strong>Create New Android Virtual Device (AVD)</strong>
		введите необходимую информацию в полях  <strong>Name</strong>,
			<strong>Target</strong> и <strong>SD Card Size</strong>. На рисунке 7 показаны параметры моего тестового устройства. Имя устройства не должно содержать пробелов; для хранения данных необходимо выделить не менее 100 МБ. Выберите соответствующий номер версии Android для своего целевого устройства. Этот ниспадающий список отображает только доступные опции, загруженные ранее. 
		</p><h5 id="fig7">Рисунок 7. Мастер создания нового AVD-устройства</h5><img alt="The Create New Android Virtual Device (AVD) window" src="figure7.jpg"/><p>Теперь нажмите <strong>Create AVD</strong>. Появится всплывающее окно со сведениями о вашем новом устройстве. Чтобы запустить любой из доступных образов эмулятора, выберите требуемую цель, а затем нажмите <strong>Start</strong>. В окне <strong>Launch Options</strong>
		можно оставить значения по умолчанию для размеров экрана или поставить флажок в контрольном окошке <strong>Scale display
			to real size</strong> (Масштабировать экран до реального размера) и указать иные размеры экрана. Значение "7" меня полностью устраивает (см. рис. 8). Чтобы запустить эмулятор "с чистого листа", поставьте флажок в контрольном окошке <strong>Wipe user data</strong> (Стереть данные пользователя). 
		</p><h5 id="fig8">Рисунок 8. Опции запуска AVD-устройства</h5><img alt="Image showing the AVD launch options" src="figure8.jpg"/><p>В состав Android SDK входит еще один обязательный инструмент под названием ADB (Android Device Bridge). Этот инструмент поддерживает такие функции, как установка приложений (apk-файлы), копирование файлов на устройство или с устройства, выдача команд оболочки на устройство. Кроме того, инструмент ADB используется для запуска SL4A на устройстве, что позволяет разработчику запускать программы на исполнение с рабочей станции. Чтобы установить коммуникационный канал между хостом (рабочей станцией) разработчика и устройством, необходимо с помощью ADB перенаправить TCP/IP-трафик с порта 9999 на конкретный порт на этом устройстве. Откройте командное окно и введите в него следующую командную строку: 
		</p><div class="codesection"><pre class="displaycode">$ adb forward tcp:9999 tcp:42306</pre></div><p>Второй номер порта соответствует устройству. В последней версии SL4A этот номер можно задать в предпочтениях. В стандартном выпуске вы должны использовать номер, который предоставит вам SL4A. 
		</p><p>Теперь запустите SL4A, а затем нажмите <strong>Menu</strong>. В области с шестью опциями в нижней части окна нажмите <strong>View</strong>, а затем нажмите <strong>Interpreters</strong>
		(рис. 9). 
		</p><h5 id="fig9">Рисунок 9. Запуск удаленного сервера из меню Interpreters системы SL4A 
				</h5><img alt="Imaginge showing the Interpreters menu, from which you launch a remote server" src="figure9.jpg"/><p>Нажмите еще раз <strong>Menu</strong>, а затем нажмите <strong>Private</strong> для запуска сервера в приватном режиме. 
		</p><p>Для реального устройства различие состоит в том, что опция Private запускает сервер с использованием USB-порта, а опция Public использует Wi-Fi. Если вы снова посмотрите страницу уведомлений, то увидите, что сервис SL4A Service исполняется (рис. 10). 
		</p><h5 id="fig10">Рисунок 10. Экран уведомления Android</h5><img alt="Image showing that the SL4A service is running" src="figure10.jpg"/><p>Нажмите на сообщение, чтобы увидеть фактический присвоенный номер порта. В нашем случае для второго значения TCP в команде <code>adb forward</code>
			мы используем номер порта 42306. Теперь вы готовы к тому, чтобы написать какой-либо Python-код и протестировать его на устройстве. 
		</p><p class="ibm-alternate-rule"><hr/></p><p class="ibm-ind-link ibm-back-to-top"><a href="#ibm-pcon" class="ibm-anchor-up-link">В начало</a></p><h2 id="Hello_World">Программа Hello World на языке Python for Android</h2><p>Практически в каждой вводной статье по программированию ее автор считает своим долгом написать программу "hello world". Я делаю это здесь для того, чтобы продемонстрировать несколько способов для написания и тестирования Python-кода с помощью SL4A. Мой код выглядит следующим образом. 
		</p><div class="codesection"><pre class="displaycode">import android
droid = android.Android()
result = droid.makeToast('Hello, world!')</pre></div><p>Каждый скриптовый язык SL4A использует файл импорта — в случае Python это файл android.py — для формирования интерфейса между скриптом и поддерживающими API-интерфейсами Android. Этот код можно ввести непосредственно на своем устройстве в интерпретаторе (см. <a href="#fig9">рисунок 9</a>)
			или с помощью редактора. Чтобы использовать интерпретатор Python, запустите его на экране <strong>Interpreters</strong>,
			для чего выберите опцию <strong>Python 2.6.2</strong>.
			На появившемся в результате экране вы сможете ввести показанный выше код; после ввода последней строки вы должны увидеть всплывающее окно со словами: "Hello, world!" 
		</p><p>Текстовый ввод как на эмулированном, так и на реальном устройстве может оказаться утомительным занятием. Python предоставляет среду IDLE (консоль/редактор), которая в сочетании с инструментом ADB очень удобна для написания кода на персональном компьютере и тестировании его на Android-устройстве. Вам потребуется лишь локальная копия файла android.py. Вы можете извлечь ее из файла python_extras_r14.zip, доступного на странице загрузки SL4A, или передать ее с устройства с помощью команды 
			<code>adb pull</code>. Кроме того, весьма удобно иметь каталог с именем SDCARD в корне своего первичного системного диска для зеркалирования всего содержимого эмулируемого устройства. Это существенно упрощает маршрут к файлу при исполнении скрипта на локальной машине, которому необходимо обращаться к файловой системе. На рисунке 11 показан скрипт Hello World в консоли IDLE. 
		</p><h5 id="fig11">Рисунок 11. Скрипт Hello World в Python-консоли IDLE 
				</h5><img alt="Image showing the Hello World application in the Python IDLE console" src="figure11.jpg"/><p>Если вы запустили сервер и выполнили команду <code>adb forward</code>,
			то должны увидеть Toast-сообщение, показанное на рисунке 12, и не должны увидеть никаких ошибок. 
		</p><h5 id="fig12">Рисунок 12. Всплывающее сообщение Hello World </h5><img alt="Image showing the Hello World pop-up message on the device" src="figure12.jpg"/><p>В Windows-системе для запуска окна редактирования в среде IDLE нажмите: <strong>File &gt; New 
		Window</strong>. Это окно предоставляет все необходимые средства для редактирования и тестирования эмулированного или реального Android-устройства на своей машине разработки. 
		</p>


</div>
</div></body></html>