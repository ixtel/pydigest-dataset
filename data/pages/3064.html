<html><body><div><div class="post-text" itemprop="text">
<p><strong>Edit, after discussion:</strong></p>

<blockquote>
  <p>"I want all paths outside my virtualenv (/usr...) to be below the
  paths of the virtualenv. [...] It needs to be sorted."</p>
</blockquote>

<p>Then, just sort your <code>sys.path</code> before the first import happens. Given a certain path <code>prefix</code> corresponding to the location of your virtalenv, this approach likely is sufficient:</p>

<pre><code>sys.path = sorted(sys.path, key=lambda x: x.startswith(prefix), reverse=True)
</code></pre>

<p><code>sorted()</code>'s sorting behavior is stable: the original order is preserved for items with same sort key. Here, only two sort keys are used: <code>True</code> and <code>False</code>. You need to come up with a reliable way to set your <code>prefix</code> (You might want to hard-code it, or determine it based on the current working directory, I am sure you find a way).</p>

<p><strong>Original answer (still valid, in general):</strong></p>

<p>You did not want to elaborate on your requirements and application scenario too much, so I provide a more general answer: you may need to overthink your approach, and maybe not expect <code>virtualenv</code> to entirely solve your problem.</p>

<p>In certain situations, <code>virtualenv</code> is just not the perfect solution. It <em>is</em> a compromise, and one side of this compromise is exhaustively described in this article: <a href="https://pythonrants.wordpress.com/2013/12/06/why-i-hate-virtualenv-and-pip/" rel="nofollow">https://pythonrants.wordpress.com/2013/12/06/why-i-hate-virtualenv-and-pip/</a></p>

<p>In many scenarios <code>virtualenv</code> serves a splendid purpose and does its job very fine! It helped me a lot, for sure, especially for development purposes. In other scenarios, it is either not a complete solution or even a bad solution.</p>

<p>So, there are a few different options now that I see:</p>

<ol>
<li>Use virtualenv, but take control over those things that you need to have changed. For instance, modify <code>sys.path</code> from within your package <em>before</em> doing a certain import. While some might consider this "not clean", it for sure is a very quick way to efficiently and reliably control directory search order. <code>sys.path.insert(1, foo)</code> is actually used by <strong>many</strong> packages and test environments. It not uncommon at all. This approach may provide you with a working solution after just one minute of work. Give it a try!</li>
<li>If you think that virtualenv in your case does not behave as documented or clearly shows buggy behavior, then please report you findings to the project. They will surely appreciate your concise feedback.</li>
<li>If you think that virtualenv does not provide the level of isolation or control that you need in your application case, you might want to look at other options, such as Docker or Vagrant, or fully-features virtual machines.</li>
</ol>
    </div>
    </div></body></html>