<html><body><div><div class="post-text" itemprop="text">

<p>I have a <a href="https://github.com/facebook/presto/tree/master/presto-docs/src/main/sphinx">Sphinx project</a> with a TOC (<code>index.rst</code>) that includes <code>:maxdepth: 2</code>. The problem is I want to reduce the depth to <code>1</code> for the <code>release</code> section so that it doesn't include the list of release notes in the main TOC (the list is too long).</p>

<p>It seems that the TOC list can be modified using a <code>doctree-resolved</code> event handler, but I can't figure out how to modify the TOC tree in the event handler:</p>

<pre><code>from sphinx import addnodes

def setup(app):
    def update_toctree(app, doctree, docname):
        if docname != 'index':
            return

        node = doctree.traverse(addnodes.toctree)[0]
        toc = app.env.resolve_toctree(docname, app.builder, node)

        # do something with "toc" here

    app.connect('doctree-resolved', update_toctree)
</code></pre>
    </div>
    </div></body></html>