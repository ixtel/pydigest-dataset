<html><body><div><section class="entry">
<p class="fsb-clear"/><p><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_results.gif"><img class="aligncenter wp-image-3630" src="http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_results.gif" alt="shape_detection_results"/></a></p>
<p>This tutorial is the second post in our three part series on <em>shape detection and analysis</em>.</p>
<p>Last week we learned how to compute the <a href="http://www.pyimagesearch.com/2016/02/01/opencv-center-of-contour/" target="_blank">center of a contour using OpenCV</a>.</p>
<p>Today, we are going to leverage contour properties to actually <em>label</em> and <i>identify</i> shapes in an image, just like in the figure at the top of this post.</p>

<h2>OpenCV shape detection</h2>
<p>Before we get started with this tutorial, let’s quickly review our project structure:</p>

		<div id="crayon-56d5a1e6d558b922828234" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a1e6d558b922828234-1"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">pyimagesearch</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d558b922828234-2"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">__init__</span><span class="crayon-e">.py</span></p><p class="crayon-line" id="crayon-56d5a1e6d558b922828234-3"><span class="crayon-o">|</span><span class="crayon-h">    </span><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">shapedetector</span><span class="crayon-e">.py</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d558b922828234-4"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">detect_shapes</span><span class="crayon-e">.py</span></p><p class="crayon-line" id="crayon-56d5a1e6d558b922828234-5"><span class="crayon-o">|</span><span class="crayon-o">--</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">shapes_and_colors</span><span class="crayon-e">.png</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>As you can see, we have defined a 
			<span id="crayon-56d5a1e6d55a4932599835" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pyimagesearch</span></span></span>  module. Inside this module we have 
			<span id="crayon-56d5a1e6d55ae988305799" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">shapedetector</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  which will store our implementation of the 
			<span id="crayon-56d5a1e6d55b5267067232" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ShapeDetector</span></span></span>  class.</p>
<p>Finally, we have the 
			<span id="crayon-56d5a1e6d55bc512084774" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect_shapes</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  driver script that we’ll use to load an image from disk, analyze it for shapes, and then perform shape detection and identification via the 
			<span id="crayon-56d5a1e6d55c4499821260" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ShapeDetector</span></span></span>  class.</p>
<p>Before we get started, make sure you have the <a href="https://github.com/jrosebr1/imutils" target="_blank">imutils package</a> installed on your system, a series of OpenCV convenience functions that we’ll be using later in this tutorial:</p>

		

<p/>
<h3>Defining our shape detector</h3>
<p>The first step in building our shape detector is to write some code to encapsulate the shape identification logic.</p>
<p>Let’s go ahead and define our 
			<span id="crayon-56d5a1e6d55d2650585094" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ShapeDetector</span></span></span> . Open up the 
			<span id="crayon-56d5a1e6d55d9951336195" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">shapedetector</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  file and insert the following code:</p>

		<div id="crayon-56d5a1e6d55e1899388853" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a1e6d55e1899388853-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d55e1899388853-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">cv2</span></p><p class="crayon-line" id="crayon-56d5a1e6d55e1899388853-3"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d55e1899388853-4"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">ShapeDetector</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a1e6d55e1899388853-5"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d55e1899388853-6"><span class="crayon-h">		</span><span class="crayon-r">pass</span></p><p class="crayon-line" id="crayon-56d5a1e6d55e1899388853-7"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d55e1899388853-8"><span class="crayon-h">	</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">detect</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a1e6d55e1899388853-9"><span class="crayon-h">		</span><span class="crayon-c"># initialize the shape name and approximate the contour</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d55e1899388853-10"><span class="crayon-h">		</span><span class="crayon-v">shape</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"unidentified"</span></p><p class="crayon-line" id="crayon-56d5a1e6d55e1899388853-11"><span class="crayon-h">		</span><span class="crayon-v">peri</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">arcLength</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d55e1899388853-12"><span class="crayon-h">		</span><span class="crayon-v">approx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">approxPolyDP</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.04</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">peri</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p><strong>Line 4 </strong>starts the definition of our 
			<span id="crayon-56d5a1e6d55e8569777357" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ShapeDetector</span></span></span>  class. We’ll skip the 
			<span id="crayon-56d5a1e6d55ef968868342" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">__init__</span></span></span>  constructor here since nothing needs to be initialized.</p>
<p>We then have our 
			<span id="crayon-56d5a1e6d55f6297495402" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect</span></span></span>  method on <strong>Line 8</strong> which requires only a single argument, 
			<span id="crayon-56d5a1e6d55fd225546558" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">c</span></span></span> , the contour (i.e., outline) of the shape we are trying to identify.</p>
<p>In order to perform shape detection, we’ll be using <em>contour approximation</em>.</p>
<p>As the name suggests, contour approximation is an algorithm for reducing the number of points in a curve with a reduced set of points — thus the term <em>approximation</em>.</p>
<p>This algorithm is commonly known as the <a href="https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm" target="_blank">Ramer-Douglas-Peucker</a> algorithm, or simply the split-and-merge algorithm.</p>
<p>Contour approximation is predicated on the assumption that a curve can be approximated by a <em>series of short line segments</em>. This leads to a resulting approximated curve that consists of a subset of points that were defined by the original cruve.</p>
<p>Contour approximation is actually already implemented in OpenCV via the 
			<span id="crayon-56d5a1e6d5605909840667" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">approxPolyDP</span></span></span>  method.</p>
<p>In order to perform contour approximation, we first compute the perimeter of the contour (<strong>Line 11</strong>), followed by constructing the actual contour approximation (<strong>Line 12</strong>).</p>
<p>Common values for the second parameter to 
			<span id="crayon-56d5a1e6d560c704161900" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">approxPolyDP</span></span></span>  are normally in the range of 1-5% of the original contour perimeter.</p>
<p><em><strong>Note:</strong> Interested in a more in-depth look at contour approximation? Be sure to check out the <a href="http://www.pyimagesearch.com/pyimagesearch-gurus/" target="_blank">PyImageSearch Gurus course</a> where I discuss computer vision and image processing fundamentals such as contours and connected-component analysis in detail.</em></p>
<p>Given our approximated contour, we can move on to performing shape detection:</p>

		<div id="crayon-56d5a1e6d561a583016020" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-14">14</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-16">16</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-18">18</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-20">20</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-22">22</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-24">24</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-26">26</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-28">28</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-30">30</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-31">31</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-32">32</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-34">34</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-36">36</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d561a583016020-38">38</p><p class="crayon-num" data-line="crayon-56d5a1e6d561a583016020-39">39</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-14"><span class="crayon-h">		</span><span class="crayon-c"># if the shape is a triangle, it will have 3 vertices</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-15"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-16"><span class="crayon-h">			</span><span class="crayon-v">shape</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"triangle"</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-17"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-18"><span class="crayon-h">		</span><span class="crayon-c"># if the shape has 4 vertices, it is either a square or</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-19"><span class="crayon-h">		</span><span class="crayon-c"># a rectangle</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-20"><span class="crayon-h">		</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-o">:</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-21"><span class="crayon-h">			</span><span class="crayon-c"># compute the bounding box of the contour and use the</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-22"><span class="crayon-h">			</span><span class="crayon-c"># bounding box to compute the aspect ratio</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-23"><span class="crayon-h">			</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">boundingRect</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-24"><span class="crayon-h">			</span><span class="crayon-v">ar</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">w</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-25"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-26"><span class="crayon-h">			</span><span class="crayon-c"># a square will have an aspect ratio that is approximately</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-27"><span class="crayon-h">			</span><span class="crayon-c"># equal to one, otherwise, the shape is a rectangle</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-28"><span class="crayon-h">			</span><span class="crayon-v">shape</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"square"</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ar</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0.95</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">ar</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">1.05</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-s">"rectangle"</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-29"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-30"><span class="crayon-h">		</span><span class="crayon-c"># if the shape is a pentagon, it will have 5 vertices</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-31"><span class="crayon-h">		</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">approx</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-32"><span class="crayon-h">			</span><span class="crayon-v">shape</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"pentagon"</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-33"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-34"><span class="crayon-h">		</span><span class="crayon-c"># otherwise, we assume the shape is a circle</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-35"><span class="crayon-h">		</span><span class="crayon-st">else</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-36"><span class="crayon-h">			</span><span class="crayon-v">shape</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"circle"</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-37"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d561a583016020-38"><span class="crayon-h">		</span><span class="crayon-c"># return the name of the shape</span></p><p class="crayon-line" id="crayon-56d5a1e6d561a583016020-39"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">shape</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>It’s important to understand that a contour consists of a <em>list of <strong>vertices</strong>. </em>We can check the number of entries in this list to determine the shape of an object.</p>
<p>For example, if the approximated contour has <em>three vertices</em>, then it must be a triangle (<strong>Lines 15 and 16</strong>).</p>
<p>If a contour has <em>four vertices</em>, then it must be either a <em>square</em> or a <i>rectangle</i> (<strong>Line 20</strong>). To determine which, we compute the aspect ratio of the shape, which is simply the width of the contour bounding box divided by the height (<strong>Lines 23 and 24</strong>). If the aspect ratio is ~1.0, then we are examining a square (since all sides have approximately equal length). Otherwise, the shape is a rectangle.</p>
<p>If a contour has <em>five vertices</em>, we can label it as a <em>pentagon</em> (<strong>Line 31 and 32</strong>).</p>
<p>Otherwise, by process of elimination (in context of this example, of course), we can make the assumption that the shape we are examining is a <em>circle</em> (<strong>Lines 35 and 36</strong>).</p>
<p>Finally, we return the identified shape to the calling method.</p>
<h3>Shape detection with OpenCV</h3>
<p>Now that our 
			<span id="crayon-56d5a1e6d5624069528952" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ShapeDetector</span></span></span>  class has been defined, let’s create the 
			<span id="crayon-56d5a1e6d562c731379250" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">detect_shapes</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></span></span>  driver script:</p>

		<div id="crayon-56d5a1e6d5633328550699" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a1e6d5633328550699-1"><span class="crayon-c"># import the necessary packages</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5633328550699-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">pyimagesearch</span><span class="crayon-sy">.</span><span class="crayon-e">shapedetector </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">ShapeDetector</span></p><p class="crayon-line" id="crayon-56d5a1e6d5633328550699-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5633328550699-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">imutils</span></p><p class="crayon-line" id="crayon-56d5a1e6d5633328550699-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5633328550699-6"> </p><p class="crayon-line" id="crayon-56d5a1e6d5633328550699-7"><span class="crayon-c"># construct the argument parse and parse the arguments</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5633328550699-8"><span class="crayon-v">ap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">argparse</span><span class="crayon-sy">.</span><span class="crayon-e">ArgumentParser</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5633328550699-9"><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">add_argument</span><span class="crayon-sy">(</span><span class="crayon-s">"-i"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"--image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">required</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5633328550699-10"><span class="crayon-h">	</span><span class="crayon-k ">help</span><span class="crayon-o">=</span><span class="crayon-s">"path to the input image"</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5633328550699-11"><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">vars</span><span class="crayon-sy">(</span><span class="crayon-v">ap</span><span class="crayon-sy">.</span><span class="crayon-e">parse_args</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>We start off on <strong>Lines 2-5</strong> by importing our required packages. Notice how we’re importing our implementation of the 
			<span id="crayon-56d5a1e6d563b825054499" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ShapeDetector</span></span></span>  class from the 
			<span id="crayon-56d5a1e6d5642964855605" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">shapedetector</span></span></span>  sub-module of 
			<span id="crayon-56d5a1e6d5651698165581" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">pyimagesearch</span></span></span> .</p>
<p><strong>Lines 8-11</strong> handle parsing our command line arguments. We only need a single switch here, 
			<span id="crayon-56d5a1e6d5659659812101" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-o">--</span><span class="crayon-v">image</span></span></span> , which is the path to where the image we want to process resides on disk.</p>
<p>Next up, let’s pre-process our image:</p>

		<div id="crayon-56d5a1e6d5660881902269" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-13">13</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-14">14</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-15">15</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-16">16</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-17">17</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-18">18</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-19">19</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-20">20</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-21">21</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-22">22</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-23">23</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-24">24</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-25">25</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-26">26</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-27">27</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-28">28</p><p class="crayon-num" data-line="crayon-56d5a1e6d5660881902269-29">29</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5660881902269-30">30</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-13"><span class="crayon-c"># load the image and resize it to a smaller factor so that</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-14"><span class="crayon-c"># the shapes can be approximated better</span></p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-15"><span class="crayon-v">image</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imread</span><span class="crayon-sy">(</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-s">"image"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-16"><span class="crayon-v">resized</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">resize</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-o">=</span><span class="crayon-cn">300</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-17"><span class="crayon-v">ratio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">(</span><span class="crayon-v">resized</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-18"> </p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-19"><span class="crayon-c"># convert the resized image to grayscale, blur it slightly,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-20"><span class="crayon-c"># and threshold it</span></p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-21"><span class="crayon-v">gray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">cvtColor</span><span class="crayon-sy">(</span><span class="crayon-v">resized</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">COLOR_BGR2GRAY</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-22"><span class="crayon-v">blurred</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">GaussianBlur</span><span class="crayon-sy">(</span><span class="crayon-v">gray</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-23"><span class="crayon-v">thresh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">threshold</span><span class="crayon-sy">(</span><span class="crayon-v">blurred</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">THRESH_BINARY</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-24"> </p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-25"><span class="crayon-c"># find contours in the thresholded image and initialize the</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-26"><span class="crayon-c"># shape detector</span></p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-27"><span class="crayon-v">cnts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">findContours</span><span class="crayon-sy">(</span><span class="crayon-v">thresh</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">RETR_EXTERNAL</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-28"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">CHAIN_APPROX_SIMPLE</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5660881902269-29"><span class="crayon-v">cnts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cnts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">imutils</span><span class="crayon-sy">.</span><span class="crayon-e">is_cv2</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">cnts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5660881902269-30"><span class="crayon-v">sd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ShapeDetector</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>First, we load our image from disk on <strong>Line 15 </strong>and resize it on <strong>Line 16</strong>. We then keep track of the 
			<span id="crayon-56d5a1e6d5669778876002" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ratio</span></span></span>  of the old height to the new resized height on <strong>Line 17</strong> — we’ll find out exactly why we do this later in the tutorial.</p>
<p>From there, <strong>Lines 21-23</strong> handle converting the resized image to grayscale, smoothing it to reduce high frequency noise, and finally thresholding it to reveal the shapes in the image.</p>
<p>After thresholding, our image should look like this:</p>
<div id="attachment_3631" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_thresh.jpg"><img class="size-full wp-image-3631" src="http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_thresh.jpg" alt="Figure 1: Thresholding reveals the shapes in our image." srcset="http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_thresh-298x300.jpg 298w, http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_thresh.jpg 400w" sizes="(max-width: 400px) 100vw, 400px"/></a><p class="wp-caption-text"><strong>Figure 1:</strong> Thresholding reveals the shapes in our image.</p></div>
<p>Notice how our image has been <em>binarized</em> — the shapes appear as a <em>white foreground</em> against a <em>black background</em>.</p>
<p>Lastly, we find contours in our binary image, handle grabbing the correct tuple value from 
			<span id="crayon-56d5a1e6d5672177675411" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">findContours</span></span></span>  <a href="http://www.pyimagesearch.com/2015/08/10/checking-your-opencv-version-using-python/" target="_blank">based on our OpenCV version</a>, and finally initialize our 
			<span id="crayon-56d5a1e6d5679300406181" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ShapeDetector</span></span></span>  (<strong>Lines 27-30</strong>).</p>
<p>The last step is to identify each of the contours:</p>

		<div id="crayon-56d5a1e6d5680428674381" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content"><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-32">32</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-33">33</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-34">34</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-35">35</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-36">36</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-37">37</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-38">38</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-39">39</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-40">40</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-41">41</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-42">42</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-43">43</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-44">44</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-45">45</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-46">46</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-47">47</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-48">48</p><p class="crayon-num" data-line="crayon-56d5a1e6d5680428674381-49">49</p><p class="crayon-num crayon-striped-num" data-line="crayon-56d5a1e6d5680428674381-50">50</p></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-32"><span class="crayon-c"># loop over the contours</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-33"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">cnts</span><span class="crayon-o">:</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-34"><span class="crayon-h">	</span><span class="crayon-c"># compute the center of the contour, then detect the name of the</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-35"><span class="crayon-h">	</span><span class="crayon-c"># shape using only the contour</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-36"><span class="crayon-h">	</span><span class="crayon-v">M</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">moments</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-37"><span class="crayon-h">	</span><span class="crayon-v">cX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m10"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m00"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-38"><span class="crayon-h">	</span><span class="crayon-v">cY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m01"</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">M</span><span class="crayon-sy">[</span><span class="crayon-s">"m00"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">ratio</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-39"><span class="crayon-h">	</span><span class="crayon-v">shape</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sd</span><span class="crayon-sy">.</span><span class="crayon-e">detect</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-40"> </p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-41"><span class="crayon-h">	</span><span class="crayon-c"># multiply the contour (x, y)-coordinates by the resize ratio,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-42"><span class="crayon-h">	</span><span class="crayon-c"># then draw the contours and the name of the shape on the image</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-43"><span class="crayon-h">	</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">*=</span><span class="crayon-h"> </span><span class="crayon-e">ratio</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-44"><span class="crayon-e">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">drawContours</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">c</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-45"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">putText</span><span class="crayon-sy">(</span><span class="crayon-v">image</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">cX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-v">FONT_HERSHEY_SIMPLEX</span><span class="crayon-sy">,</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-46"><span class="crayon-h">		</span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">255</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-47"> </p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-48"><span class="crayon-h">	</span><span class="crayon-c"># show the output image</span></p><p class="crayon-line" id="crayon-56d5a1e6d5680428674381-49"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">imshow</span><span class="crayon-sy">(</span><span class="crayon-s">"Image"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">image</span><span class="crayon-sy">)</span></p><p class="crayon-line crayon-striped-line" id="crayon-56d5a1e6d5680428674381-50"><span class="crayon-h">	</span><span class="crayon-v">cv2</span><span class="crayon-sy">.</span><span class="crayon-e">waitKey</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p>On <strong>Line 33</strong> we start looping over each of the individual contours. For each of them, we <a href="http://www.pyimagesearch.com/2016/02/01/opencv-center-of-contour/" target="_blank">compute the center of the contour</a>, followed by performing shape detection and labeling.</p>
<p>Since we are processing the contours extracted from the <em>resized image</em> (rather than the original image), we need to multiply the contours and center <em>(x, y)</em>-coordinates by our resize 
			<span id="crayon-56d5a1e6d568c482479532" class="crayon-syntax crayon-syntax-inline  crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco"><span class="crayon-pre crayon-code"><span class="crayon-v">ratio</span></span></span>  (<strong>Line 43</strong>). This will give us the correct <em>(x, y)</em>-coordinates for both the contours and centroid of the original image.</p>
<p>Lastly, we draw the contours and the labeled shape on our image (<strong>Lines 44-46</strong>), followed by displaying our results (<strong>Lines 49 and 50</strong>).</p>
<p>To see our shape detector in action, just execute the following command:</p>

		<div id="crayon-56d5a1e6d5699520929161" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover">
		
			
			<p class="crayon-info"/>
			<p class="crayon-plain-wrap"/>
			<div class="crayon-main">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					
				</td>
						<td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-56d5a1e6d5699520929161-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">detect_shapes</span><span class="crayon-e">.py</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">image </span><span class="crayon-v">shapes_and_colors</span><span class="crayon-e">.png</span></p></div></td>
					</tr>
				</table>
			</div>
		</div>

<p/><div id="attachment_3630" class="wp-caption aligncenter"><a href="http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_results.gif"><img class="wp-image-3630" src="http://www.pyimagesearch.com/wp-content/uploads/2016/01/shape_detection_results.gif" alt="Figure 2: Performing shape detection with OpenCV."/></a><p class="wp-caption-text"><strong>Figure 2:</strong> Performing shape detection with OpenCV.</p></div>
<p>As you can see from the animation above, our script loops over each of the shapes individually, performs shape detection on each one, and then draws the name of the shape on the object.</p>
<h2>Summary</h2>
<p>In today’s post blog, we learned how to perform shape detection with OpenCV and Python.</p>
<p>To accomplish this, we leveraged <em>contour approximation</em>, the process of reducing the number of points on a curve to a more simple <em>approximated </em>version.</p>
<p>Then, based on this contour approximation, we examined the number of vertices each shape has. Given the vertex count, we were able to accurately label each of the shapes.</p>
<p>This lesson is part of a three part series on shape detection and analysis. Last week we covered how to compute the <a href="http://www.pyimagesearch.com/2016/02/01/opencv-center-of-contour/" target="_blank">center of a contour</a>. Today we covered shape detection with OpenCV. And next week we’ll discuss how to <em><strong>label the actual color of a shape</strong></em> using color channel statistics.</p>
<p>Be sure to enter your email address in the form below to be notified when the next post goes live — <em><strong>you won’t want to miss it!</strong></em></p>
<h2 id="post_downloads">Downloads:</h2>

	</section>
	</div></body></html>