<html><body><div><div class="postcontents">
                    <p>Eloquent 0.3 is now out. This is the first official release of the ORM.</p>

<h2 id="what-is-eloquent">What is Eloquent</h2>

<p>The Eloquent ORM provides a simple and beautiful ActiveRecord implementation
for Python.</p>

<p>It is inspired by the database part of the <a href="http://laravel.com">Laravel framework</a>
but largely modified to be more pythonic.</p>

<p>The full documentation is available here: <a href="http://eloquent.readthedocs.org">http://eloquent.readthedocs.org</a>.</p>

<h2 id="why">Why</h2>

<p>I started Eloquent because of a personal need for simplicity when defining
models and accessing databases, which is one of the things that i find quite
appealing in a framework like Ruby On Rails.</p>

<p>So I wanted Eloquent to follow the ActiveRecord pattern which provides less
configuration and verbosity compared to the data mapper pattern
which pretty much all of the Python ORMs follow.</p>

<p>I also wanted it to be really simple to read and write, with useful features
out of the box (like timestampable models, soft deletes, protection against mass assigment, model events).
Some of these features are not ready yet.</p>

<h2 id="installation">Installation</h2>

<p>You can install Eloquent in 2 different ways:</p>

<ul>
  <li>The easier and more straightforward is to use pip</li>
</ul>



<ul>
  <li>Install from source using the official repository (https://github.com/sdispater/eloquent)</li>
</ul>

<p>The different dbapi packages are not part of the package dependencies,
so you must install them in order to connect to corresponding databases:</p>

<ul>
  <li>Postgres: <code>pyscopg2</code></li>
  <li>MySQL: <code>PyMySQL</code> or <code>MySQL-python</code></li>
  <li>Sqlite: The <code>sqlite3</code> module is bundled with Python by default</li>
</ul>

<h2 id="basic-usage">Basic Usage</h2>

<h3 id="configuration">Configuration</h3>

<p>All you need to get you started is the configuration describing your database connections
and passing it to a <code>DatabaseManager</code> instance.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">eloquent</span> <span class="kn">import</span> <span class="n">DatabaseManager</span><span class="p">,</span> <span class="n">Model</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'mysql'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'driver'</span><span class="p">:</span> <span class="s">'mysql'</span><span class="p">,</span>
        <span class="s">'host'</span><span class="p">:</span> <span class="s">'localhost'</span><span class="p">,</span>
        <span class="s">'database'</span><span class="p">:</span> <span class="s">'database'</span><span class="p">,</span>
        <span class="s">'username'</span><span class="p">:</span> <span class="s">'root'</span><span class="p">,</span>
        <span class="s">'password'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span>
        <span class="s">'prefix'</span><span class="p">:</span> <span class="s">''</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseManager</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">Model</span><span class="o">.</span><span class="n">set_connection_resolver</span><span class="p">(</span><span class="n">db</span><span class="p">)</span></code></pre></div>

<h3 id="defining-a-model">Defining a model</h3>



<p>Note that we did not tell the ORM which table to use for the <code>User</code> model. The plural “snake case” name of the
class name will be used as the table name unless another name is explicitly specified.
In this case, the ORM will assume the <code>User</code> model stores records in the <code>users</code> table.
You can specify a custom table by defining a <code>__table__</code> property on your model:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">__table__</span> <span class="o">=</span> <span class="s">'my_users'</span></code></pre></div>

<div class="note">
<p>The ORM will also assume that each table has a primary key column named ``id``.
You can define a <code>__primary_key__</code> property to override this convention.
Likewise, you can define a <code>__connection__</code> property to override the name of the database
connection that should be used when using the model.</p>
</div>

<p>Once a model is defined, you are ready to start retrieving and creating records in your table.
Note that you will need to place <code>updated_at</code> and <code>created_at</code> columns on your table by default.
If you do not wish to have these columns automatically maintained,
set the <code>__timestamps__</code> property on your model to <code>False</code>.</p>

<h3 id="retrieving-all-models">Retrieving all models</h3>



<h3 id="retrieving-a-record-by-primary-key">Retrieving a record by primary key</h3>



<h3 id="querying-using-models">Querying using models</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'votes'</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></code></pre></div>

<h3 id="aggregates">Aggregates</h3>

<p>You can also use the query builder aggregate functions:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">count</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'votes'</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></code></pre></div>

<p>If you feel limited by the builder’s fluent interface, you can use the <code>where_raw</code> method:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where_raw</span><span class="p">(</span><span class="s">'age &gt; ? and votes = 100'</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></code></pre></div>

<h3 id="chunking-results">Chunking Results</h3>

<p>If you need to process a lot of records, you can use the <code>chunk</code> method to avoid
consuming a lot of RAM:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">users</span> <span class="ow">in</span> <span class="n">User</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="c"># ...</span></code></pre></div>

<h3 id="specifying-the-query-connection">Specifying the query connection</h3>

<p>You can specify which database connection to use when querying a model by using the <code>on</code> method:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s">'connection-name'</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></pre></div>

<p>If you are using read / write connections, you can force the query to use the “write” connection
with the following method:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">on_write_connection</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></pre></div>

<h2 id="mass-assignment">Mass assignment</h2>

<p>When creating a new model, you pass attributes to the model constructor.
These attributes are then assigned to the model via mass-assignment.
Though convenient, this can be a serious security concern when passing user input into a model,
since the user is then free to modify <strong>any</strong> and <strong>all</strong> of the model’s attributes.
For this reason, all models protect against mass-assignment by default.</p>

<p>To get started, set the <code>__fillable__</code> or <code>__guarded__</code> properties on your model.</p>

<h3 id="defining-fillable-attributes-on-a-model">Defining fillable attributes on a model</h3>

<p>The <code>__fillable__</code> property specifies which attributes can be mass-assigned.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">__fillable__</span> <span class="o">=</span> <span class="p">[</span><span class="s">'first_name'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">]</span></code></pre></div>

<h3 id="defining-guarded-attributes-on-a-model">Defining guarded attributes on a model</h3>

<p>The <code>__guarded__</code> is the inverse and acts as “blacklist”.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">__guarded__</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">]</span></code></pre></div>

<p>You can also block <strong>all</strong> attributes from mass-assignment:</p>



<h2 id="insert-update-and-delete">Insert, update and delete</h2>

<h3 id="saving-a-new-model">Saving a new model</h3>

<p>To create a new record in the database, simply create a new model instance and call the <code>save</code> method.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>

<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'John'</span>

<span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></code></pre></div>

<p>You can also use the <code>create</code> method to save a model in a single line, but you will need to specify
either the <code>__fillable__</code> or <code>__guarded__</code> property on the model since all models are protected against
mass-assigment by default.</p>

<p>After saving or creating a new model with auto-incrementing IDs, you can retrieve the ID by accessing
the object’s <code>id</code> attribute:</p>



<h3 id="using-the-create-method">Using the create method</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Create a new user in the database</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John'</span><span class="p">)</span>

<span class="c"># Retrieve the user by attributes, or create it if it does not exist</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John'</span><span class="p">)</span>

<span class="c"># Retrieve the user by attributes, or instantiate it if it does not exist</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">first_or_new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'John'</span><span class="p">)</span></code></pre></div>

<h3 id="updating-a-retrieved-model">Updating a retrieved model</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'Foo'</span>

<span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></code></pre></div>

<p>You can also run updates as queries against a set of models:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">affected_rows</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'votes'</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code></pre></div>

<h3 id="deleting-an-existing-model">Deleting an existing model</h3>

<p>To delete a model, simply call the <code>delete</code> model:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">user</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></code></pre></div>

<h3 id="deleting-an-existing-model-by-key">Deleting an existing model by key</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">User</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">User</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></code></pre></div>

<p>You can also run a delete query on a set of models:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">affected_rows</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'votes'</span><span class="p">,</span> <span class="s">'&gt;'</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></code></pre></div>

<h3 id="updating-only-the-models-timestamps">Updating only the model’s timestamps</h3>

<p>If you want to only update the timestamps on a model, you can use the <code>touch</code> method:</p>



<h2 id="timestamps">Timestamps</h2>

<p>By default, the ORM will maintain the <code>created_at</code> and <code>updated_at</code> columns on your database table
automatically. Simply add these <code>timestamp</code> columns to your table. If you do not wish for the ORM to maintain
these columns, just add the <code>__timestamps__</code> property:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">__timestamps__</span> <span class="o">=</span> <span class="bp">False</span></code></pre></div>

<h2 id="converting-to-dictionaries--json">Converting to dictionaries / JSON</h2>

<h3 id="converting-a-model-to-a-dictionary">Converting a model to a dictionary</h3>

<p>When building JSON APIs, you may often need to convert your models and relationships to dictionaries or JSON.
So, Eloquent includes methods for doing so. To convert a model and its loaded relationship to a dictionary,
you may use the <code>to_dict</code> method:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">with_</span><span class="p">(</span><span class="s">'roles'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span></code></pre></div>

<p>Note that entire collections of models can also be converted to dictionaries:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span></code></pre></div>

<h3 id="converting-a-model-to-json">Converting a model to JSON</h3>

<p>To convert a model to JSON, you can use the <code>to_json</code> method:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span></code></pre></div>

<p>There is a lot more you can do with Eloquent, just give a look at the <a href="http://eloquent.readthedocs.org">documentation</a>
to see all available features.</p>

<p>And if you are interested by how it all works, you can just check out the <a href="https://github.com/sdispater/eloquent">Github Repository</a>, and feel free to contribute.</p>

<p>And, finally, here are some features targeted for the 0.4 version:</p>

<ul>
  <li>A schema builder to create and modify tables:</li>
</ul>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">eloquent</span> <span class="kn">import</span> <span class="n">SchemaBuilder</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">SchemaBuilder</span><span class="p">()</span>

<span class="k">with</span> <span class="n">schema</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
    <span class="n">table</span><span class="o">.</span><span class="n">increments</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">table</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="s">'email'</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">table</span><span class="o">.</span><span class="n">timestamps</span><span class="p">()</span></code></pre></div>

<ul>
  <li>Support for soft delete and other mixins:</li>
</ul>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">SoftDeletesMixin</span><span class="p">):</span>
    <span class="k">pass</span></code></pre></div>

<p>You can check the advancement on <a href="https://github.com/sdispater/eloquent/issues?q=is%3Aissue+milestone%3A0.4">the Github project</a></p>

                </div>
                </div></body></html>