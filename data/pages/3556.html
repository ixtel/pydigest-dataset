<html><body><div><div class="post-1409 post type-post status-publish format-standard has-post-thumbnail hentry category-flask-framework-tutorials-and-examples category-gunicorn category-nginx category-python category-ubuntu-linux-tutorials tag-deploy-flask-on-nginx tag-deploy-flask-on-ubuntu tag-install-gunicorn-ubuntu">
                <p>
                            <a href="" rel="nofollow"><img src="http://techarena51.com/wp-content/uploads/2015/03/deploy-flask-on-ubuntu.jpg" alt="Launching your Flask web application on Linux  with Gunicorn and Nginx" align="left" class="affiliate-image"/></a>
                        </p><p>Flask is a web framework for python, Flask tackles Routing, HTML template rendering, Sessions etc. If you are building web applications on Linux then I highly recommend using Flask, here’s how quickly you can build an app with it on Linux.<br/>
The inbuilt server with Flask is good for development, but sooner or later you will want to serve hundreds or even thousands of request, hence in this post I will describe how you can deploy your flask application on a production Linux servver with Gunicorn and Nginx.</p>
<p>Gunicorn is a WSGI HTTP server written in Python and used to serve Python files, it uses a pre-fork worker model in which it forks worker processes to handle requests. Although Gunicorn can serve as a standalone server it is recommended to use Nginx as a frontend and reverse proxy Python requests to Gunicorn.</p>
<p><strong>Software versions</strong></p>
<p>Ubuntu 14.04</p>
<p>Python 2.7.6</p>
<p>Linux kernel  3.13.0-24-generic</p>
<p>Flask 0.10.1</p>
<p>Gunicorn 19.2.1</p>
<p>Nginx  1.4.6</p>
<p><strong>Installing  Nginx and Gunicorn </strong></p>
<pre>leo@flask:~$ sudo  apt-get install python-pip python-virtualenv nginx supervisor

leo@flask:~$ mkdir myapp

leo@flask:~$ cd myapp

leo@flask:~/myapp$ virtualenv venv

leo@flask:~/myapp$ source venv/bin/activate

(venv)leo@flask:~/myapp$ pip install flask gunicorn
</pre>
<p>I have installed Gunicorn in a Virtual Environment via “pip” so I can use the latest version, you can install it via “apt” as well but it does not have the latest version.</p>
<p>Write some application code</p>
<pre>(venv)leo@flask:~/myapp$ vim app.py

from flask import Flask

app = Flask(__name__)

@app.route('/')

def index():
    return 'Houston we have lift off'

if __name__ == '__main__':

app.run()

</pre>
<p><strong>Start Gunicorn</strong></p>
<pre>(venv)leo@flask:~/myapp$ gunicorn app:app -b localhost:5000

[2015-03-06 09:59:28 +0000] [12794] [INFO] Starting gunicorn 19.2.1

[2015-03-06 09:59:28 +0000] [12794] [INFO] Listening at: http://127.0.0.1:5000 (12794)

[2015-03-06 09:59:28 +0000] [12794] [INFO] Using worker: sync

[2015-03-06 09:59:28 +0000] [12799] [INFO] Booting worker with pid: 12799

</pre>
<p>You should see “Houston we have lift off”  when you resolve http://localhost:5000<br/>
<a href="http://techarena51.com/wp-content/uploads/2015/03/install-gunicorn-nginx-flask.png"><img class="aligncenter size-full wp-image-1413" src="http://techarena51.com/wp-content/uploads/2015/03/install-gunicorn-nginx-flask.png" alt="install gunicorn on ubuntu"/></a></p>
<p><strong>Daemon-izing Gunicorn with Supervisor</strong></p>
<p><a href="http://supervisord.org/introduction.html#overview">Supervisor</a> allows you to control and monitor  processes on  Linux. With Supervisor you can start/stop/restart Gunicorn via the command line just like an init process and view it’s logs in “/var/log/supervisor/”. One of the key benefits of Supervisor is it’s simple configuration.</p>
<pre>#Add the Gunicorn configuration to Supervisor

(venv)leo@flask:~/myapp$ sudo vim /etc/supervisor/conf.d/myapp

#name of the process

[program:myapp]

#command to run

command = /complete/path/to/venv/bin/gunicorn app:app -b localhost:5000

#complete path to your application directory

directory = /path/to/myapp/

#User to run the process with

user = username

#Start process at system boot

autostart=true

</pre>
<p>Ensure you add the complete path to the “gunicorn” command else you will get a “Error: File not found” message.</p>
<pre>(venv)leo@flask:~/myapp$ sudo supervisorctl reread
(venv)leo@flask:~/myapp$ sudo supervisorctl update
(venv)leo@flask:~/myapp$ sudo supervisorctl start myapp

</pre>
<p>To stop or  restart Gunicorn you can use</p>

<p>


</p>

<pre>(venv)leo@flask:~/myapp$ sudo supervisorctl stop myapp

(venv)leo@flask:~/myapp$ sudo supervisorctl restart myapp

</pre>
<p><strong>Configure  and Start Nginx</strong></p>
<pre>(venv)leo@flask:~/myapp$ mv /etc/nginx/sites-enabled/default /tmp/nginx.bak

(venv)leo@flask:~/myapp$ vim /etc/nginx/sites-enabled/myapp

server {

location / {

proxy_pass http://127.0.0.1:5000;

}

}

(venv)leo@flask:~/myapp$ sudo service nginx start

</pre>
<p>You should be able to successfully resolve localhost and view “Houston we have lift off” if everything went ok.</p>
<p><strong>Optimize</strong></p>
<p>One way to speed up your app is to serve static files like Javascript and Images directly through Nginx.</p>
<pre>(venv)leo@flask:~/myapp$ sudo vim /etc/nginx/sites-enabled/myapp

server {

location / {

proxy_pass <a href="http://127.0.0.1:5000">http://127.0.0.1:5000</a>;

}

#Serve all static files including js and css directly

location ~\.(jpg|png|gif|js|css)${

root /myapp/static/;

}

}

(venv)leo@flask:~/myapp$ sudo service nginx restart

</pre>
<p>Create a directory static and add an image file to it.</p>
<pre>(venv)leo@flask:~/myapp$ mkdir static

(venv)leo@flask:~/myapp/static$ll

-rw-r--r-- 1 leo_g leo_g 130868 Mar  6 18:24 myimage.jpg

</pre>
<p>Add some HTML code to your app to serve images</p>
<pre>(venv)leo@flask:~/myapp$ vim app.py

from flask import Flask

 

app = Flask(__name__)

@app.route('/')

def index():
    return '''&lt;html&gt; &lt;body&gt;
         &lt;h2&gt;Houston we have lift off&lt;/h2&gt;
          &lt;img src="myimage.jpg" height="700"&gt;
           &lt;/body&gt;&lt;/html&gt;'''

if __name__ == '__main__':

app.run()

</pre>
<p>Now restart Gunicorn</p>
<pre>(venv)leo@flask:~/myapp$ sudo supervisorctl restart myapp

</pre>
<p><a href="http://techarena51.com/wp-content/uploads/2015/03/install-gunicorn-ubuntu.png"><img class="aligncenter size-full wp-image-1416" src="http://techarena51.com/wp-content/uploads/2015/03/install-gunicorn-ubuntu.png" alt="deploy flask with Gunicorn"/></a></p>
<p>Have fun
</p>

<p/>
                         <div class="abh_box abh_box_down abh_box_business"><div class="abh_tab_content"><section class="vcard abh_about_tab abh_tab"><div class="abh_text"><p class="abh_job"/><p class="description note abh_description">Is a Technical project manager who through this blog shares his experience building Web Applications with Python, FlaskAngularjs and Linux.His Projects are opensource and available at https://github.com/Leo-g</p></div> </section><section class="abh_posts_tab abh_tab"><div class="abh_text"><h4>Latest posts by Leo G <span class="abh_allposts">(<a href="http://techarena51.com/index.php/author/leo/">see all</a>)</span></h4></div> </section></div> </div>        <p class="clear"/>
                
    </div>
    
    
        
</div></body></html>