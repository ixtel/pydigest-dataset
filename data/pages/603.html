<html><body><div><div class="pf-content"><p>The <a href="https://groups.google.com/forum/#!topic/wxpython-users/IXFsH9vKQMQ" target="_blank">wxPython Google Group</a> was discussing different methods of catching exceptions in wxPython the other day. If you use wxPython a lot, you will soon realize that some exceptions are difficult to catch. The <a href="http://wiki.wxpython.org/C%2B%2B%20%26%20Python%20Sandwich?action=show&amp;redirect=CppAndPythonSandwich" target="_blank">wxPython Wiki</a> explains why. Anyway, the fellows on the list were recommending the use of <strong>sys.excepthook</strong>. So I took one of the methods they mentioned and created a little example:<span id="more-3770"/></p>
<pre class="python"><span>import</span> <span>sys</span>
<span>import</span> <span>traceback</span>
<span>import</span> wx
 
<span>########################################################################</span>
<span>class</span> Panel<span>(</span>wx.<span>Panel</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Panel</span>.<span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>
 
        btn = wx.<span>Button</span><span>(</span><span>self</span>, label=<span>"Raise Exception"</span><span>)</span>
        btn.<span>Bind</span><span>(</span>wx.<span>EVT_BUTTON</span>, <span>self</span>.<span>onExcept</span><span>)</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> onExcept<span>(</span><span>self</span>, event<span>)</span>:
        <span>""</span><span>"
        Raise an error
        "</span><span>""</span>
        <span>1</span>/<span>0</span>
 
<span>########################################################################</span>
<span>class</span> Frame<span>(</span>wx.<span>Frame</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Frame</span>.<span>__init__</span><span>(</span><span>self</span>, <span>None</span>, title=<span>"Exceptions"</span><span>)</span>
        <span>sys</span>.<span>excepthook</span> = MyExceptionHook
        panel = Panel<span>(</span><span>self</span><span>)</span>
        <span>self</span>.<span>Show</span><span>(</span><span>)</span>
 
<span>########################################################################</span>
<span>class</span> ExceptionDialog<span>(</span>GMD.<span>GenericMessageDialog</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span>, msg<span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        GMD.<span>GenericMessageDialog</span>.<span>__init__</span><span>(</span><span>self</span>, <span>None</span>, msg, <span>"Exception!"</span>,
                                          wx.<span>OK</span>|wx.<span>ICON_ERROR</span><span>)</span>        
 
<span>#----------------------------------------------------------------------</span>
<span>def</span> MyExceptionHook<span>(</span>etype, value, trace<span>)</span>:
    <span>""</span><span>"
    Handler for all unhandled exceptions.
 
    :param `etype`: the exception type (`SyntaxError`, `ZeroDivisionError`, etc...);
    :type `etype`: `Exception`
    :param string `value`: the exception error message;
    :param string `trace`: the traceback header, if any (otherwise, it prints the
     standard Python header: ``Traceback (most recent call last)``.
    "</span><span>""</span>
    frame = wx.<span>GetApp</span><span>(</span><span>)</span>.<span>GetTopWindow</span><span>(</span><span>)</span>
    tmp = <span>traceback</span>.<span>format_exception</span><span>(</span>etype, value, trace<span>)</span>
    exception = <span>""</span>.<span>join</span><span>(</span>tmp<span>)</span>
 
    dlg = ExceptionDialog<span>(</span>exception<span>)</span>
    dlg.<span>ShowModal</span><span>(</span><span>)</span>
    dlg.<span>Destroy</span><span>(</span><span>)</span>    
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    app = wx.<span>App</span><span>(</span><span>False</span><span>)</span>
    frame = Frame<span>(</span><span>)</span>
    app.<span>MainLoop</span><span>(</span><span>)</span></pre>
<p>In this example, we create a panel with a button that will deliberately cause an exception to be raised. We catch the exception by redirecting <strong>sys.excepthook</strong> to our <strong>MyExceptionHook</strong> function. This function will format the traceback of the exception, format it to make it readable and then display a dialog with the exception information. Robing Dunn, creator of wxPython, thought it would be good if someone came up with a decorator that we could use to catch exception with that could then be added as an example to the <a href="http://wiki.wxpython.org/C%2B%2B%20%26%20Python%20Sandwich?action=show&amp;redirect=CppAndPythonSandwich" target="_blank">wiki page</a>.</p>
<p>My first idea for a decorator was the following:</p>
<pre class="python"><span>import</span> <span>logging</span>
<span>import</span> wx
 
<span>########################################################################</span>
<span>class</span> ExceptionLogging<span>(</span><span>object</span><span>)</span>:
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span>, fn<span>)</span>:
        <span>self</span>.<span>fn</span> = fn
 
        <span># create logging instance</span>
        <span>self</span>.<span>log</span> = <span>logging</span>.<span>getLogger</span><span>(</span><span>"wxErrors"</span><span>)</span>
        <span>self</span>.<span>log</span>.<span>setLevel</span><span>(</span><span>logging</span>.<span>INFO</span><span>)</span>
 
        <span># create a logging file handler / formatter</span>
        log_fh = <span>logging</span>.<span>FileHandler</span><span>(</span><span>"error.log"</span><span>)</span>
        <span>formatter</span> = <span>logging</span>.<span>Formatter</span><span>(</span><span>"%(asctime)s - %(name)s - %(message)s"</span><span>)</span>
        log_fh.<span>setFormatter</span><span>(</span><span>formatter</span><span>)</span>
        <span>self</span>.<span>log</span>.<span>addHandler</span><span>(</span>log_fh<span>)</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__call__</span><span>(</span><span>self</span>, evt<span>)</span>:
        <span>try</span>:
            <span>self</span>.<span>fn</span><span>(</span><span>self</span>, evt<span>)</span>
        <span>except</span> <span>Exception</span>, e:
            <span>self</span>.<span>log</span>.<span>exception</span><span>(</span><span>"Exception"</span><span>)</span>
 
<span>########################################################################</span>
<span>class</span> Panel<span>(</span>wx.<span>Panel</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Panel</span>.<span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>
 
        btn = wx.<span>Button</span><span>(</span><span>self</span>, label=<span>"Raise Exception"</span><span>)</span>
        btn.<span>Bind</span><span>(</span>wx.<span>EVT_BUTTON</span>, <span>self</span>.<span>onExcept</span><span>)</span>
 
    <span>#----------------------------------------------------------------------</span>
    @ExceptionLogging
    <span>def</span> onExcept<span>(</span><span>self</span>, event<span>)</span>:
        <span>""</span><span>"
        Raise an error
        "</span><span>""</span>
        <span>1</span>/<span>0</span>
 
<span>########################################################################</span>
<span>class</span> Frame<span>(</span>wx.<span>Frame</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Frame</span>.<span>__init__</span><span>(</span><span>self</span>, <span>None</span>, title=<span>"Exceptions"</span><span>)</span>
        panel = Panel<span>(</span><span>self</span><span>)</span>
        <span>self</span>.<span>Show</span><span>(</span><span>)</span>
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    app = wx.<span>App</span><span>(</span><span>False</span><span>)</span>
    frame = Frame<span>(</span><span>)</span>
    app.<span>MainLoop</span><span>(</span><span>)</span></pre>
<p>In this code, we create a class that creates a logging instance. Then we override the <strong>__call__</strong> method to wrap a method call in an exception handler so we can catch exceptions. Basically what we’re doing here is creating a class decorator. Next we decorate an event handler with our exception logging class. This wasn’t exactly what Mr. Dunn wanted, as the decorator needed to be able to wrap other functions too. So I edited it a bit and came up with the following minor adjustment:</p>
<pre class="python"><span>import</span> <span>logging</span>
<span>import</span> wx
 
<span>class</span> ExceptionLogging<span>(</span><span>object</span><span>)</span>:
    <span>def</span> <span>__init__</span><span>(</span><span>self</span>, fn, <span>*</span>args, <span>**</span>kwargs<span>)</span>:
        <span>self</span>.<span>fn</span> = fn
 
        <span># create logging instance</span>
        <span>self</span>.<span>log</span> = <span>logging</span>.<span>getLogger</span><span>(</span><span>"wxErrors"</span><span>)</span>
        <span>self</span>.<span>log</span>.<span>setLevel</span><span>(</span><span>logging</span>.<span>INFO</span><span>)</span>
 
        <span># create a logging file handler / formatter</span>
        log_fh = <span>logging</span>.<span>FileHandler</span><span>(</span><span>"error.log"</span><span>)</span>
        <span>formatter</span> = <span>logging</span>.<span>Formatter</span><span>(</span><span>"%(asctime)s - %(name)s - %(message)s"</span><span>)</span>
        log_fh.<span>setFormatter</span><span>(</span><span>formatter</span><span>)</span>
        <span>self</span>.<span>log</span>.<span>addHandler</span><span>(</span>log_fh<span>)</span>
 
    <span>def</span> <span>__call__</span><span>(</span><span>self</span>, <span>*</span>args, <span>**</span>kwargs<span>)</span>:
        <span>try</span>:
            <span>self</span>.<span>fn</span><span>(</span><span>self</span>, <span>*</span>args, <span>**</span>kwargs<span>)</span>
        <span>except</span> <span>Exception</span>, e:
            <span>self</span>.<span>log</span>.<span>exception</span><span>(</span><span>"Exception"</span><span>)</span>
 
<span>########################################################################</span>
<span>class</span> Panel<span>(</span>wx.<span>Panel</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Panel</span>.<span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>
 
        btn = wx.<span>Button</span><span>(</span><span>self</span>, label=<span>"Raise Exception"</span><span>)</span>
        btn.<span>Bind</span><span>(</span>wx.<span>EVT_BUTTON</span>, <span>self</span>.<span>onExcept</span><span>)</span>
 
    <span>#----------------------------------------------------------------------</span>
    @ExceptionLogging
    <span>def</span> onExcept<span>(</span><span>self</span>, event<span>)</span>:
        <span>""</span><span>"
        Raise an error
        "</span><span>""</span>
        <span>1</span>/<span>0</span>
 
<span>########################################################################</span>
<span>class</span> Frame<span>(</span>wx.<span>Frame</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Frame</span>.<span>__init__</span><span>(</span><span>self</span>, <span>None</span>, title=<span>"Exceptions"</span><span>)</span>
        panel = Panel<span>(</span><span>self</span><span>)</span>
        <span>self</span>.<span>Show</span><span>(</span><span>)</span>
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
    app = wx.<span>App</span><span>(</span><span>False</span><span>)</span>
    frame = Frame<span>(</span><span>)</span>
    app.<span>MainLoop</span><span>(</span><span>)</span></pre>
<p>This time the <strong>__call__</strong> method can accept any number of arguments or keyword arguments, which gives it a bit more flexibility. This still wasn’t what Robin Dunn wanted, so he wrote up the following example:</p>
<pre class="python"><span>from</span> <span>__future__</span> <span>import</span> print_function
 
<span>import</span> <span>logging</span>
<span>import</span> wx
 
<span>print</span><span>(</span>wx.<span>version</span><span>(</span><span>)</span><span>)</span>
 
<span>def</span> exceptionLogger<span>(</span>func, loggerName=<span>''</span><span>)</span>:
    <span>""</span><span>"
    A simple decorator that will catch and log any exceptions that may occur
    to the root logger.
    "</span><span>""</span>
    <span>assert</span> <span>callable</span><span>(</span>func<span>)</span>
    mylogger = <span>logging</span>.<span>getLogger</span><span>(</span>loggerName<span>)</span>
 
    <span># wrap a new function around the callable</span>
    <span>def</span> logger_func<span>(</span><span>*</span>args, <span>**</span>kw<span>)</span>:
        <span>try</span>:
            <span>if</span> <span>not</span> kw:
                <span>return</span> func<span>(</span><span>*</span>args<span>)</span>
            <span>return</span> func<span>(</span><span>*</span>args, <span>**</span>kw<span>)</span>
        <span>except</span> <span>Exception</span>:
            mylogger.<span>exception</span><span>(</span><span>'Exception in %s:'</span>, func.__name__<span>)</span>
 
    logger_func.__name__ = func.__name__
    logger_func.__doc__ = func.__doc__
    <span>if</span> <span>hasattr</span><span>(</span>func, <span>'__dict__'</span><span>)</span>:
        logger_func.<span>__dict__</span>.<span>update</span><span>(</span>func.<span>__dict__</span><span>)</span>
    <span>return</span> logger_func    
 
 
<span>def</span> exceptionLog2Logger<span>(</span>loggerName<span>)</span>:
    <span>""</span><span>"
    A decorator that will catch and log any exceptions that may occur
    to the named logger.
    "</span><span>""</span>
    <span>import</span> functools
    <span>return</span> functools.<span>partial</span><span>(</span>exceptionLogger, loggerName=loggerName<span>)</span>    
 
 
<span>########################################################################</span>
<span>class</span> Panel<span>(</span>wx.<span>Panel</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Panel</span>.<span>__init__</span><span>(</span><span>self</span>, parent<span>)</span>
 
        btn = wx.<span>Button</span><span>(</span><span>self</span>, label=<span>"Raise Exception"</span><span>)</span>
        btn.<span>Bind</span><span>(</span>wx.<span>EVT_BUTTON</span>, <span>self</span>.<span>onExcept</span><span>)</span>
 
    <span>#----------------------------------------------------------------------</span>
 
    @exceptionLog2Logger<span>(</span><span>'testLogger'</span><span>)</span>
    <span>def</span> onExcept<span>(</span><span>self</span>, event<span>)</span>:
        <span>""</span><span>"
        Raise an error
        "</span><span>""</span>
        <span>print</span><span>(</span><span>self</span>, event<span>)</span>
        <span>print</span><span>(</span><span>isinstance</span><span>(</span><span>self</span>, wx.<span>Panel</span><span>)</span><span>)</span>
 
        <span>#trigger an exception</span>
        <span>1</span>/<span>0</span>
 
<span>########################################################################</span>
<span>class</span> Frame<span>(</span>wx.<span>Frame</span><span>)</span>:
    <span>""</span><span>""</span><span>""</span>
 
    <span>#----------------------------------------------------------------------</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>)</span>:
        <span>""</span><span>"Constructor"</span><span>""</span>
        wx.<span>Frame</span>.<span>__init__</span><span>(</span><span>self</span>, <span>None</span>, title=<span>"Exceptions"</span><span>)</span>
        panel = Panel<span>(</span><span>self</span><span>)</span>
        <span>self</span>.<span>Show</span><span>(</span><span>)</span>
 
<span>#----------------------------------------------------------------------</span>
<span>if</span> __name__ == <span>"__main__"</span>:
 
    <span># set up the default logger</span>
    log = <span>logging</span>.<span>getLogger</span><span>(</span><span>'testLogger'</span><span>)</span>
    log.<span>setLevel</span><span>(</span><span>logging</span>.<span>INFO</span><span>)</span>
 
    <span># create a logging file handler / formatter</span>
    log_fh = <span>logging</span>.<span>FileHandler</span><span>(</span><span>"error.log"</span><span>)</span>
    <span>formatter</span> = <span>logging</span>.<span>Formatter</span><span>(</span><span>"%(asctime)s - %(name)s - %(message)s"</span><span>)</span>
    log_fh.<span>setFormatter</span><span>(</span><span>formatter</span><span>)</span>
    log.<span>addHandler</span><span>(</span>log_fh<span>)</span>
 
    app = wx.<span>App</span><span>(</span><span>False</span><span>)</span>
    frame = Frame<span>(</span><span>)</span>
    app.<span>MainLoop</span><span>(</span><span>)</span></pre>
<p>This shows a couple of different decorator examples. This example demonstrates the more traditional methodology of decorator construction. It has a bit more metaprogramming in it though. The first example checks to make sure what is passed to it is actually callable. Then it creates a logger and wraps the callable with an exception handler. Before it returns the wrapped function, the wrapped function is modified so that it has the same name and docstring as the original function passed to it. I believe you could drop that and use <a href="http://docs.python.org/2/library/functools.html#functools.wraps" target="_blank">functools.wraps</a> instead, but being explicit is probably better in a tutorial.</p>
<hr/>
<h3>Wrapping Up</h3>
<p>
</p><p>Now you know how you catch exceptions in a couple of different ways. Hopefully you will find this helpful in your own application design. Have fun!</p>
</div>	</div></body></html>