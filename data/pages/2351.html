<html><body><div><div class="post-body entry-content" id="post-body-6784951987642425703" itemprop="description articleBody">
<span>Yesterday I discovered <a href="http://stevepulec.com/freezegun/">freezegun</a>, a Python library to run test cases at defined moments in time. It feels just like the equivalent of Ruby's <a href="https://github.com/travisjeffery/timecop">timecop</a> gem, and it saves me a lot of headaches trying to mock the </span><span>datetime</span><span> module.</span>
<span><br/></span>
<span>What I was trying to test is a method named </span><span>delete_expired_promises</span><span>, which removes reservations for items after the expiration time has run out. The code, using </span><span>freezegun</span><span> came to be this simple:</span>

<pre class="prettyprint">with freeze_time('2013-10-30 10:00:00'):
            self.store.save('1111', '2222', reservation_id='1')
            self.store.save('3333', '4444', reservation_id='2')

with freeze_time('2013-10-30 11:00:00'):
    self.store.save('1111', '2222', reservation_id='3')

with freeze_time('2013-10-30 12:30:00'):
    self.store.delete_expired_promises()

    self.assertIsNone(self.collection.find_one({'reservation_id': '1'}) )
    self.assertIsNone(self.collection.find_one({'reservation_id': '2'}) )
    self.assertIsNotNone(self.collection.find_one({'reservation_id': '3'}) )
</pre>

<span>As you can see, I "freeze" the time at different intervals, create reservations, then run the </span><span>delete_expired_promises</span><span> method, and check if they have been removed correctly. It could not be more straighforward!</span>
<p/>
</div>
</div></body></html>