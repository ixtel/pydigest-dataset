<html><body><div><p class="lead" itemprop="description">Как и обещал, речь в статье пойдёт о приложении django-sitecats, о том, как его использует pythonz.net, а также о том, при чём тут кошки, и чем метки отличаются от категорий.</p>
                <div class="py_user"><p>Для тех, кого прежде всего интересует проблема кошек в названии приложения, скажу сразу: кошки ни при чём, далее в статье речь пойдёт о категориях.</p><p>Появившееся недавно приложение </p><a href="https://pypi.python.org/pypi/django-sitecats" target="_blank">django-sitecats</a><p>, является попыткой взглянуть на проблему категоризации материалов на сайтах сбоку. И сейчас я попытаюсь объяснить, что имею в виду.</p><p>Беглый осмотр популярных пакетов для категоризации материалов на </p><a href="https://www.djangopackages.com" target="_blank">https://www.djangopackages.com</a><p> обнаруживает интересную вещь: если оставить в стороне </p><b>django-categories</b><p> (который, не смотря на описание, вряд ли можно относить к общим решениям) и таксономические плагины для </p><b>django-shop</b><p>, можно решить, что систематизация на сайтах, использующих Django, реализуется при помощи </p><a href="https://www.djangopackages.com/grids/g/tagging" target="_blank">меток</a><p>. Такой подход, зачастую, является вполне приемлемым вариантом, когда плоские таксономии устраивают.</p><p>Однако людей считающих, что «плоские таксономии» это осксюморон, такое положение дел устроить, конечно, не может. На почве этого внутреннего конфликта и возникает пакет </p><b>django-sitecats</b><p>, позволяющий в терминах иерархий описывать более-менее приличные таксономии. При помощи этого приложения мы создаём иерархии категорий, к которым сможем привязывать объекты сайта, таким образом структурируя информацию.</p><p>Например, здесь, на pythonz.net, используется достаточно простая таксономия, описанная иерархией, состоящей всего из двух уровней — </p><a href="http://pythonz.net/categories" target="_blank">http://pythonz.net/categories</a><p> (например: «Язык — русский», «Проект — Django»).</p><p>Характерной чертой приложения является обращение к категориям (если желаете, можете по-прежнему называть их тегами, которые метки) через их родителей. Так, например, чтобы иметь возможность работать с категориями «байткод», «генераторы», «конкурентность», «сборка мусора» нам достаточно обратиться к их родительской категории «Аспект языка». Обращение к родительским категориям из кода производится при помощи псевдонимов (alias).</p><p>Для наглядности, примерно так выводится список категорий, связанных с объектом на страницах с детальной информацией (см. </p><a href="http://pythonz.net/books/3" target="_blank">http://pythonz.net/books/3</a><p> блок «Категории» в правой части страницы):</p><pre><code class="python"><br/>    # Код из представления, собирающего страницу с детальной информаций о книге.<br/>    book = ... # Здесь у нас экземпляр модели Book. <br/>    # Модель Book мы унаследовали, кроме прочего, от sitecats.models.ModelWithCategory.<br/>    # Это наследование позволило нам упростить работу работу с категориями. См. ниже.<br/><br/>    # Настраиваем параметры списков категорий.<br/>    # Например, если книга фигурирует в категориях «русский» и «Django»,<br/>    # будет сформировано два списка категорий: «Язык» и «Проект».<br/>    # 'show_title': True говорит, что мы хотим видеть на странице заголовки<br/>    # родительских категорий «Язык» и «Проект».<br/>    book.set_category_lists_init_kwargs({'show_title': True})<br/><br/>    ...  # И в конце представление выводит страницу.<br/></code></pre><p>Вот практически и всё. Осталось в шаблонах, на места, где нужно вывести списки категорий, проставить тег </p><code>{% sitecats_categories from book %}</code><p> (здесь </p><i>book</i><p> содержит объект </p><i>book</i><p>, сформированный в коде выше).</p><p>Для изменения принадлежности объектов к категориям, можно включить редактор:</p><pre><code class="python"><br/>    # Код из представления, собирающего страницу редактирования данных о книге.<br/>    from sitecats.toolbox import get_category_aliases_under<br/> <br/>    book = ... # Здесь у нас экземпляр модели Book. <br/>    book.enable_category_lists_editor(request,<br/>        # По умолчанию редактор выводит только списки для родителей тех<br/>        # категорий, которые уже связаны с объектом, в нашем случае: «Язык» и «Проект».<br/>        # Однако нам понадобилась возможность выбирать из всех родителей<br/>        # расположенных на корневом уровне иерархии, поэтому мы <br/>        # в additional_parents_aliases передаём псевдонимы всех корневых родителей.<br/>        # Псевдонимы получаем при помощи get_category_aliases_under().<br/>        additional_parents_aliases=get_category_aliases_under(),<br/>  <br/>        # Устанавливаем параметры редактора.<br/>        # `allow_add` разрешает добавлять книгу в уже существующие категории;<br/>        # `allow_remove` разрешает удалять привязки книги к категориям;<br/>        # `allow_new` здесь позволяет суперпользователям создавать новые категории и привязывать к ним книгу.<br/>        editor_init_kwargs={'allow_add': True, 'allow_remove': True, 'allow_new': request.user.is_superuser}<br/> <br/>        # Настраиваем обработчик запросов от редактора категорий.<br/>        # Здесь мы задаём дополнительную метку для сообщений об ошибках,<br/>        # генерируемых обработчиком. Эта метка в нашем случае превратиться <br/>        # в имя css класса, используемого для стилизации сообщений об ошибках.<br/>        handler_init_kwargs={'error_messages_extra_tags': 'alert alert-danger'},<br/> <br/>        # Ну и здесь мы выведем названия родительских категорий.<br/>        lists_init_kwargs={'show_title': True},<br/>    )<br/> <br/>    # В шаблоне будем использовать всё тот же тег {% sitecats_categories from article %}`<br/>    # выводить редактор он тоже умеет.<br/></code></pre><p>Теперь попробуем вывести все категории, к которым отнесены объекты (как это сделано в разделе «Категории»). В этом нам поможет функция конструктор списков категорий </p><code>get_category_lists()</code><pre><code class="python"><br/>    # Код из представления, собирающего страницу со списком используемых категорий.<br/>    from sitecats.toolbox import get_category_lists, get_category_aliases_under<br/>    from django.core.urlresolvers import reverse<br/> <br/> <br/>    cat_lists = get_category_lists(<br/>        # Ограничиваем выборку родительскими категориями из корня иерархии.<br/>        additional_parents_aliases=get_category_aliases_under(),<br/>        init_kwargs={<br/>            # И тут будем показывать заголовки родителей.<br/>            'show_title': True,<br/>            # Теперь укажем, как формировать ссылки на страницы с детальной<br/>            # информацией по категории.<br/>            # Предположим, что у нас в urls.py уже определен URL с именем `category-details`,<br/>            # вот он и послужит нам.<br/>            'show_links': lambda cat: reverse('category-details', args=[cat.id])<br/>        })<br/><br/>    # В шаблоне опять тег {% sitecats_categories from cat_lists %}`<br/></code></pre><p>Ну, а стилизовать списки категорий и их редакторы вы можете при помощи своих css стилей.</p><p>Вот такое приложение, если вкратце. Больше информации в исходном коде и документации.</p><p>На этом откланиваюсь. Пользуйтесь, участвуйте в разработке — </p><a href="https://github.com/idlesign/django-sitecats" target="_blank">https://github.com/idlesign/django-sitecats</a></div>

                

                

                </div></body></html>