<html><body><div><div class="entry-content">
						<p>Logic programming can reduce your code size, and make deductions based on facts. I’ll illustrate this using pyDatalog, a Datalog implementation in Python 3, to create a unit conversion program. I provide it wil some basic facts about how many meters, miles and feet there are in an inch, together with two conversion rules. Using those rules, I can use Datalog to “automagically” convert between any two units, even though I haven’t explicitly told it how to perform the conversion.</p>
<p>Let’s start with the completed code first:</p>
<pre>from pyDatalog import pyDatalog
from pyDatalog.pyDatalog import create_terms as terms
from pyDatalog.pyDatalog import ask

pyDatalog.create_terms('scale') # the long way of doing it
terms('A, B, C, V')

scale['meter', 'inch'] = 39.3700787
scale['mile', 'inch'] = 63360.0
scale['feet', 'inch'] = 12.0

scale[A, B] =  1/scale[B, A]
scale[A,B] = scale[A,C] * scale[C, B]

print(scale['inch', 'meter'] == V)
print(scale['mile', 'meter'] == V)

terms('conv')
conv[V, A, B] = V * scale[A, B]
print(conv[3, 'mile', 'meter'] == V)
print(conv[1, 'meter', 'feet'] == V)
</pre>
<p>There is a division bug in pyDatalog v 0.14.6, so if you want to run the example, you will need to check out changeset <a href="https://bitbucket.org/pcarbonn/pydatalog/commits/b1a5df97b98e16bdce2718110049d2574774af38">b1a5df9</a> until a new version is released.</p>
<p>Now let me walk through the code. First, I import the pyDatalog module, and define some convenience functions:</p>
<pre>from pyDatalog import pyDatalog
from pyDatalog.pyDatalog import create_terms as terms
from pyDatalog.pyDatalog import ask</pre>
<p>Next, let’s create some terms: scale, which is a function (actually a <strong>term</strong>) where we specify how one unit relates to another, and A,B,C, V, which we think of as matching “variables”:</p>
<pre>pyDatalog.create_terms('scale') # the long way of doing it
terms('A, B, C, V')</pre>
<p>Then, let use give some <strong>facts</strong> about how to scale between various units:</p>
<pre>scale['meter', 'inch'] = 39.3700787
scale['mile', 'inch'] = 63360.0
scale['feet', 'inch'] = 12.0</pre>
<p>So, these facts state that 1 meter has 39.3700787 inches, and so on. They look like functions, but they are in fact terms:</p>
<pre>In [3]: type(scale)
Out[3]: pyDatalog.pyParser.Term</pre>
<p>The same applies for A, B, C, and V. So far, so good. But what if we want to convert, say, inches into meters instead of meters into inches? Then we need an inverse rule:</p>
<pre>scale[A, B] =  1/scale[B, A]</pre>
<p>Let’s test it:</p>
<pre>In [5]: print(scale['inch', 'meter'] == V)
V
-----------------
0.025400000025908</pre>
<p>Datalog has used the inverse rule to “go the other way”. There is some minor magic going on here. Note that we didn’t specify which fact to use for inversion, Datalog figured it out for itself.</p>
<p>Now let’s cast some real magic. Specify a transition rule:</p>
<pre>scale[A,B] = scale[A,C] * scale[C, B]</pre>
<p>which states that you can get from unit A to B if there exists another unit C that serves as an intermediate conversion. Now test it:</p>
<pre>In [6]: print(scale['mile', 'meter'] == V)
V
------------------
1609.3440016415307</pre>
<p>Good. It’s cleverness doesn’t stop there:</p>
<pre>In [7]: scale['league', 'mile'] = 3.45233834

In [8]: print(scale['league', 'meter'] == V)
V
-----------------
5555.999999116079</pre>
<p>Notice how there is no simple way to convert from leagues to meters. Datalog must deduce a chain of transitions in order to obtain the result.</p>
<p>To round things off, let’s define a convenience function, “conv”, which converts V units in A into units of B:</p>
<pre>conv[V, A, B] = V * scale[A, B]</pre>
<p>Perhaps we could have used a simple python function for that, but let’s keep with the paradigm. We can then ask questions like: what is 3 miles in meters:</p>
<pre>In [9]: print(conv[3, 'mile', 'meter'] == V)
V
-----------------
4828.032004924591</pre>
<p>Bon apetitite.</p>
		<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-33125702-3061-56d5b45d3a119" data-src="//widgets.wp.com/likes/#blog_id=33125702&amp;post_id=3061&amp;origin=mcturra2000.wordpress.com&amp;obj_id=33125702-3061-56d5b45d3a119" data-name="like-post-frame-33125702-3061-56d5b45d3a119"><h3 class="sd-title">Like this:</h3><p class="likes-widget-placeholder post-likes-widget-placeholder"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></p><span class="sd-text-color"/><a class="sd-link-color"/></div>
<p id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</p></div>											</div>

					</div></body></html>