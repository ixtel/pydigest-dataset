<html><body><div><div class="entry-content">
            <p>В джанговской админке есть встроенный механизм поиска по полям модели. Достаточно просто указать поле <code>search_fields</code> в классе, унаследованном от <code>ModelAdmin</code>, и поиск по нужным полям заработает сам. Однако, иногда возникают задачи обеспечить поиск не только по простым полям, но и по значениям, сгенерированным методами. Это тоже возможно.</p>
<p>В моём случае на сайте, посвящённом поиску работы, структура данных такова:</p>
<pre><code>class Company(models.Mode):
    …
    personal_number = models.CharField(max_length=11)


class Vacancy(models.Model):
    …
    owner = models.ForeignKey(Company)
    personal_number = models.PositiveIntegerField()

    def get_personal_number(self):
        return "{}-{}".format(self.owner.personal_number, self.personal_number)
</code></pre>
<p>И вот это этому значению, генерируемому методом <code>get_personal_number</code>, нужен поиск в админке, в кабинете модератора, который делается отдельно от админки, а возможно в будущем заказчик пожелает сделать поиск по этому значению и в публичной части.
Имя метода в <code>search_fields</code> не указать, нужно немного поколдовать.</p>
<p>Поскольку действия над моделью нужно будет выполнять в нескольких местах, логично саму логику поиска записать в менеджере модели.</p>
<pre><code>import re


class VacancyManager(models.Manager):

    def filter_by_personal_number(self, personal_number):
       m = re.match(r"(?P&lt;company_number&gt;.{2}\d+)-(?P&lt;vacancy_number&gt;\d+)", personal_number)
       if m:
           return self.get_queryset().filter(
               personal_number=int(m.group(vacancy_number)),
               owner__personal_number=m.group('company_number')
           )
       else:
           return self.none()
</code></pre>
<p>В приведённом коде присутствует некоторая специфика проекта: регулярным выражением проверяется соответствие формату номера. В вашем случае эта часть может быть совершенно другой.</p>
<p>Теперь в админке следует дописать логику поиска:</p>
<pre><code>class VacancyAdmin(admin.ModelAdmin):

   def get_search_results(self, request, queryset, search_term):
       queryset, use_distinct = super().get_search_results(request, queryset, search_term)
       queryset |= self.model.objects.filter_by_personal_number(search_term)
       return queryset, use_distinct
</code></pre>
<p>метод <code>get_search_results</code> класса <code>ModelAdmin</code> как раз и отвечает за логику поиска. Возьмём штатный метод поиска, чтобы оставить себе возможность использовать поле <code>search_fields</code>, добавим выборку из модели свеженаписанным менеджером, и получим прекрасно работающий поиск по вычисляемому полю с возможностью использовать этот же алгоритм где угодно в проекте.</p>
<p>Пример результата(используется <a href="https://github.com/sehmaschine/django-grappelli">Django Grappelli</a>)
<img alt="enter image description here" src="https://leto44d.storage.yandex.net/rdisk/a8f45916649be6dc5c0cd39aec82901a57f7a1d57cad0637a8e218ffcf772cc9/inf/7SCmtshFNq_tO802SeP2SWPQIlFU5WmXe8MKSj2b2BPf0FJuPzqpkYoz48qxjtITFfGhJzOVzrYHlImEasFyOQ==?uid=0&amp;filename=2015-03-27%2016-47-43%20%D0%92%D1%8B%D0%B1%D0%B5%D1%80%D0%B8%D1%82%D0%B5%20%D0%B2%D0%B0%D0%BA%D0%B0%D0%BD%D1%81%D0%B8%D1%8F%20%D0%B4%D0%BB%D1%8F%20%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%20%7C%20%D0%A0%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%20%D0%9A%D0%B0%D0%B4%D1%80%D0%BE%D0%B2.png&amp;disposition=inline&amp;hash=&amp;limit=0&amp;content_type=image/png&amp;tknv=v2&amp;rtoken=f76bce7a35b638ec974285a7f20cb77c&amp;force_default=no"/></p>
        </div>
        

        

        </div></body></html>