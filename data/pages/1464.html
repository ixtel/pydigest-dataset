<html><body><div><div class="post shortcuts_item" id="post_236939">
    <p class="published">17 сентября 2014 в 07:23</p>
    <h1 class="title">
      

        <span class="post_title">Экспортируем комментарии и оценки из Google Play для анализа</span>

      <span class="flag flag_tutorial" title="Обучающий материал">tutorial</span>

      

    </h1>

      


    <div class="content html_format">
      <img align="right" src="https://habrastorage.org/files/fd3/e20/3fa/fd3e203fa279491ebc0c9800ae74c286.jpg"/><p> Не все знают, но в </p><b>Google Play</b><p> существует вполне легальная возможность выгрузить все комментарии и оценки к своему приложению в отдельный CSV-файл, после чего заняться каким-нибудь анализом, не доступном из гугловской системы. Но делается это с помощью внешней утилиты </p><b>gsutil,</b><p> написанной на Python’е. Так что в этом посте будет небольшая инструкция по тому, как это сделать.
</p><a name="habracut"/>
<ol>
<li>Инсталлируем python 2.6 или 2.7, если его ещё нет в системе. Инструкция по установке <a href="https://www.python.org/downloads/">на официальном сайте</a>, там нет ничего сложного для любой ОС.<br/>
<br/>
</li>
<li><a href="https://developers.google.com/storage/docs/gsutil_install#install_archive">Скачиваем</a> и распаковываем в любую папку <b>gsutil</b> (<a href="https://storage.googleapis.com/pub/gsutil.zip">прямая ссылка на zip</a>, <a href="https://storage.googleapis.com/pub/gsutil.tar.gz">прямая ссылка на tar.gz</a>)<br/>
<br/>
</li>
<li>Открываем консоль в папке с gsutil и продолжаем работать в ней. (Для windows – shift+правый клик в этой папке и выбор “Открыть окно команд”, пользователи более популярных и сами знают, как это сделать, раз уж сумели их установить)<br/>
<br/>
</li>
<li>Выполним команду<br/>
<pre><code class="bash">gsutil.py update</code></pre><br/>
для очевидных целей. Обычно в архиве уже лежит свежая версия, но бывает всякое.<br/>
<br/>
<img src="https://habrastorage.org/files/bad/559/9a2/bad5599a29f74650833cae4d6ff6b581.png"/><br/>
<br/>
</li>
<li>Выполним команду<br/>
<pre><code class="bash">gsutil.py config</code></pre><br/>
<img src="https://habrastorage.org/files/65e/6b2/339/65e6b2339c5142e98f0c54d45628e1ee.png"/><br/>
<br/>
Получаем примерно такое сообщение. Что делать, опять же, очевидно – скопировать ссылку в браузер.<br/>
<br/>
</li>
<li>Перейдя по ссылке мы попадём на страницу, на которой разрешим приложению работать с нашим аккаунтом.<br/>
<br/>
<img src="https://habrastorage.org/files/507/57d/558/50757d5585aa47ea814859d637dabb7b.png"/><br/>
</li>
<li>И скопируем код в консоль<br/>
<br/>
<img src="https://habrastorage.org/files/d60/a53/9fd/d60a539fd3d244508e7781ac3af88515.png"/><br/>
<img src="https://habrastorage.org/files/8ac/ee4/fc4/8acee4fc4764477b808d7a018d140d6e.png"/><br/>
<br/>
</li>
<li>В ответ получим ещё одно сообщение, с предложением выбрать проект по умолчанию в <b>Google Developer Console</b>, но это делать не обязательно, тем более, что нужного нам проекта там может просто не быть. Но что-то ввести в скрипт нужно, пустую строку он не примет. Так что введём просто “1” например и закончим работу.<br/>
<br/>
<img src="https://habrastorage.org/files/318/d68/804/318d68804a0b498496a538c65a809944.png"/><br/>
<br/>
</li>
<li>На странице «Оценки и отзывы» своего приложения нужно найти идентификатор сегмента отчетов, начинающийся со строки <b>pubsite_prod_rev_</b>, например <b>pubsite_prod_rev_1234567890123456789</b>.<br/>
<br/>
<img src="https://habrastorage.org/files/fe1/6c5/32f/fe16c532f21a41a1b7652fd4219b48a0.png"/><br/>
<br/>
<img src="https://habrastorage.org/files/bd3/c42/3a4/bd3c423a495b45e98154d57411746291.png"/><br/>
<br/>
</li>
<li>Теперь никто не мешает нам скачать все отчеты. Для этого достаточно выполнить команду<br/>
<pre><code class="bash">gsutil.py -m cp gs://pubsite_prod_rev_1234567890123456789/reviews/*.* Адрес_папки_куда_копировать</code></pre><br/>
 В нашем случае:<br/>
<pre><code class="bash">gsutil.py -m cp gs://pubsite_prod_rev_1234567890123456789/reviews/*.* C:\Python27\texts</code></pre><br/>
<b>-m</b> – флаг копирования в несколько параллельных потоков<br/>
<b>cp</b> – команда копирования файлов.<br/>
Подробно о командах утилиты <a href="https://developers.google.com/storage/docs/gsutil/">можно прочитать тут</a>.<br/>
<br/>
</li>
<li>В результате в папке мы получим кучу файлов с именами по схеме <b>reviews_[имя_пакета_приложения]_YYYYMM</b> (Y — год, M — месяц). Причем для всех закреплённых за вашим аккаунтом приложений сразу.<br/>
<br/>
<img src="https://habrastorage.org/files/917/d2a/457/917d2a45790a420080a51de0c5ec8673.png"/><br/>
<br/>
Конечно, если вам нужны отчеты только одному приложению, можно качать данные запросом вида<br/>
<pre><code class="bash">gsutil.py -m cp gs://pubsite_prod_rev_1234567890123456789/reviews/* com.new_program*.* C:\Python27\texts</code></pre><br/>
Но, думаю, принцип фильтрации и так понятен. <br/>
<br/>
</li>
<li>В целом, всё уже прекрасно, но работать с пачкой отдельных файлов неудобно, так что простым питоновским скриптом склеим их в один файл. Конечно, можно было бы простой командой <b>copy</b> объединить файлы в один, но тогда у нас будет дублироваться заголовок, а это неприятно.<br/>
<br/>
<pre><code class="python">import os
import codecs

files = os.listdir(".")
csvs = filter(lambda x: x.endswith(".csv") and x!="all_csv.csv", files)
file_write = codecs.open('all_csv.csv', 'w','utf-16')
header_writed = False
for file_name in csvs:
    file_read = codecs.open(file_name,'r','utf-16')
    lines_count=0
    for line in file_read:
        lines_count=lines_count+1
        if (lines_count == 1):
            if (header_writed == False):
                header_writed = True
                file_write.write(line)
        else:
            file_write.write(line)
    file_read.close()
file_write.close() </code></pre><br/>
</li>
</ol><p>
Ну вот вроде бы и всё. Полученный файл в экселе выглядит примерно так:

</p><img src="https://habrastorage.org/files/1f9/b78/be3/1f9b78be3b974d9aaa3b5f9d016042a1.png"/>

<img src="https://habrastorage.org/files/763/fef/0af/763fef0af6c34936a2f7515a48b70d93.png"/>

<p>
А уж какую аналитику творить с полученным файлом – смотрите сами. :)
 
</p><h2>Список использованной литературы</h2>
<a href="https://support.google.com/googleplay/android-developer/answer/138230#export_ratings_and_reviews">support.google.com/googleplay/android-developer/answer/138230#export_ratings_and_reviews</a>
<a href="https://developers.google.com/storage/docs/gsutil">developers.google.com/storage/docs/gsutil</a>

      
      <p class="clear"/>
    </div>

    
  


      <div class="infopanel_wrapper js-user_">
    <ul class="postinfo-panel postinfo-panel_post" id="infopanel_post_236939">

          <li class="postinfo-panel__item">
            
          </li>

      <li class="postinfo-panel__item">
        <p class="views-count_post" title="Просмотры публикации">5,5k</p>
      </li>

      <li class="postinfo-panel__item">
        <p class="favorite-wjt favorite">
            <button type="button" disabled="disabled" class="favorite-wjt__button favorite-wjt__button_disabled" title="Только зарегистрированные пользователи могут добавлять публикации в избранное">
              <span>Добавить в избранное</span>
            </button>
          <span class="favorite-wjt__counter js-favs_count" title="Количество пользователей, добавивших публикацию в избранное">85</span>
        </p>
      </li>




      
        <li class="postinfo-panel__item postinfo-panel__item_socials  postinfo-panel__item_socials_right ">
          
        </li>

      
    </ul>
  </div>


          

  


  </div>

        
        </div></body></html>