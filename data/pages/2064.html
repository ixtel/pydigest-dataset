<html><body><div><div class="entry-content"><p>Наверняка, у каждого Python-программиста возникало непреодолимое желание, а изредка и реальная потребность, скомпилировать свою программу на python в exe файл. Сегодня я расскажу, как это сделать с помощью программы cx_Freeze.</p><div class="section" id="id1"><h2>Вопрос 1: а оно надо?</h2><p>Прежде, чем начинать компилировать программу, нужно убедиться, что это действительно необходимо.</p><p>"Компиляция" программы на python - процесс, который может сопровождаться множеством проблем. Более того, это не компиляция в машинный код, как, например, программы на C, а лишь "сборка" в исполняемый файл вашей программы вместе с частью интерпретатора python.</p><p>Поэтому, если вы будете использовать программу сами или на компьютерах тех, кто её будет использовать, будет стоять интерпретатор python, то вам <b>не нужно</b> её компилировать.</p></div><div class="section" id="id2"><h2>Компиляция</h2><p>Компилировать будем программу "<a href="http://pythonworld.ru/primery-programm/pishem-blekdzhek.html" target="_blank">блэкджек</a>" (файл 21.py) (кому лень смотреть, привожу полный исходный код).</p><pre class="code python3"><span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">koloda</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'Поиграем в очко?'</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Будете брать карту? y/n</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="s1">'y'</span><span class="p">:</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">koloda</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Вам попалась карта достоинством </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span><span class="n">current</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">current</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">21</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Извините, но вы проиграли'</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">21</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Поздравляю, вы набрали 21!'</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'У вас </span><span class="si">%d</span><span class="s1"> очков.'</span> <span class="o">%</span><span class="n">count</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="s1">'n'</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'У вас </span><span class="si">%d</span><span class="s1"> очков и вы закончили игру.'</span> <span class="o">%</span><span class="n">count</span><span class="p">)</span>
        <span class="k">break</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'До новых встреч!'</span><span class="p">)</span></pre><p>Создаём в папке с программой файл setup.py с содержимым:</p><pre class="code python3"><span class="kn">from</span> <span class="nn">cx_Freeze</span> <span class="k">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">Executable</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"21"</span><span class="p">,</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">"0.1"</span><span class="p">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">"Blackjack"</span><span class="p">,</span>
    <span class="n">executables</span> <span class="o">=</span> <span class="p">[</span><span class="n">Executable</span><span class="p">(</span><span class="s2">"21.py"</span><span class="p">)]</span>
<span class="p">)</span></pre><p>Переходим в командную строку (обычно Пуск → Стандартные → Командная строка). Переходим в папку с программой (в моём случае D:\Dima\py). Запускаем команду <b>C:\Python34\python.exe setup.py build</b> (вместо C:\Python34 нужно написать папку, куда установлен python).</p><p><img alt="Компиляция. Начало" src="/uploads/python-compile-exe/compile-1.png"/></p><p>Начнется процесс сборки, в котором cx_Freeze может выдавать предупреждения, но, скорее всего, они не повлияют на работу программы.</p><p><img alt="Предупреждения в процессе компиляции" src="/uploads/python-compile-exe/compile-2.png"/></p><p>Поздравляю! В папке build теперь есть ваша папка с исполняемым файлом!</p><p><img alt="Запуск exe файла" src="/uploads/python-compile-exe/compile-3.png"/></p><p>Заметьте, не файл, а папка! Все остальные файлы также нужны для работы программы (да, это недостаток cx_Freeze). К тому же, при завершении программы окно сразу закрывается (а не ждет нажатия клавиши), поэтому в конец программы нужно дописать что-то вроде:</p><pre class="code python3"><span class="nb">input</span><span class="p">(</span><span class="s2">"Press Enter"</span><span class="p">)</span></pre><p>И скомпилировать ещё раз.</p><p>Также можно создать msi-архив командой <b>C:\Python34\python.exe setup.py bdist_msi</b>.</p><p>Разумеется, при компиляции более сложных программ вы можете столкнуться с более сложными проблемами.</p><p>Для их решения следует воспользоваться <a href="https://cx-freeze.readthedocs.org/en/latest/" target="_blank">официальной документацией</a>.</p></div></div></div></body></html>