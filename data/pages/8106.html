<html><body><div><dd><pre><span class="o">./</span><span class="n">mongo</span>

<span class="n">use</span> <span class="n">mongolog</span>
<span class="n">db</span><span class="o">.</span><span class="n">mongolog</span><span class="o">.</span><span class="n">findOne</span><span class="p">({</span><span class="s1">'level'</span><span class="p">:</span> <span class="s2">"INFO"</span><span class="p">})</span>
</pre>
<p>Will produde a mongo document like:</p>
<pre><span class="p">{</span>
    <span class="s2">"_id"</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">"5664a22bdd162ca58f0693d2"</span><span class="p">),</span>
    <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"__builtin__"</span><span class="p">,</span>
    <span class="s2">"thread"</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="s2">"140735229362944"</span><span class="p">),</span>
    <span class="s2">"level"</span> <span class="p">:</span> <span class="s2">"INFO"</span><span class="p">,</span>
    <span class="s2">"process"</span> <span class="p">:</span> <span class="mi">42383</span><span class="p">,</span>
    <span class="s2">"module"</span> <span class="p">:</span> <span class="s2">"&lt;console&gt;"</span><span class="p">,</span>
    <span class="s2">"filename"</span> <span class="p">:</span> <span class="s2">"&lt;console&gt;"</span><span class="p">,</span>
    <span class="s2">"func"</span> <span class="p">:</span> <span class="s2">"&lt;module&gt;"</span><span class="p">,</span>
    <span class="s2">"time"</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">"2015-12-06T21:01:31.258Z"</span><span class="p">),</span>
    <span class="s2">"msg"</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">"test"</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">"Life"</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">"Domain"</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s2">"Eukaryota"</span> <span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"Excavata"</span><span class="p">,</span>
                        <span class="s2">"description"</span> <span class="p">:</span> <span class="s2">"Various flagellate protozoa"</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"Amoebozoa"</span><span class="p">,</span>
                        <span class="s2">"descritpion"</span> <span class="p">:</span> <span class="s2">"most lobose amoeboids and slime moulds"</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"Opisthokonta"</span><span class="p">,</span>
                        <span class="s2">"description"</span> <span class="p">:</span> <span class="s2">"animals, fungi, choanoflagellates, etc."</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">"Archaea"</span> <span class="p">:</span> <span class="p">[</span> <span class="p">],</span>
                <span class="s2">"Bacteria"</span> <span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"&lt;type 'exceptions.ValueError'&gt;"</span><span class="p">,</span>
                        <span class="s2">"description"</span> <span class="p">:</span> <span class="s2">"Just a bad description"</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">"test class"</span> <span class="p">:</span> <span class="s2">"TestBaseMongoLogHandler"</span>
    <span class="p">},</span>
    <span class="s2">"path"</span> <span class="p">:</span> <span class="s2">"&lt;console&gt;"</span><span class="p">,</span>
    <span class="s2">"line"</span> <span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre>
<p>Take a look at the “msg” section and you will notice that all of the information from our LOG_MSG
is contained under that key in standard mongo data structures.  This means that we can query
based on our log message.  For example in your mongo shell try the following queries:</p>
<pre><span class="c1">// Find all documents logged with a 'test' key
</span><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">mongolog</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s1">'msg.test'</span><span class="o">:</span> <span class="p">{</span><span class="nx">$exists</span><span class="o">:</span> <span class="kc">true</span><span class="p">}}).</span><span class="nx">count</span><span class="p">()</span>
<span class="mi">5</span>

<span class="c1">// Find all documents that have a Eukaryota name in the list of  ["Amoebozoa", "Opisthokonta"]
</span><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">mongolog</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s1">'msg.Life.Domain.Eukaryota.name'</span><span class="o">:</span> <span class="p">{</span><span class="nx">$in</span><span class="o">:</span> <span class="p">[</span><span class="s2">"Amoebozoa"</span><span class="p">,</span> <span class="s2">"Opisthokonta"</span><span class="p">]}}).</span><span class="nx">count</span><span class="p">()</span>
<span class="mi">1</span>

<span class="c1">// Same as above but only those documents logged at level INFO
</span><span class="o">&gt;</span><span class="nx">db</span><span class="p">.</span><span class="nx">mongolog</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="s1">'level'</span><span class="o">:</span> <span class="s1">'INFO'</span><span class="p">,</span>
    <span class="s1">'msg.Life.Domain.Eukaryota.name'</span><span class="o">:</span> <span class="p">{</span><span class="nx">$in</span><span class="o">:</span> <span class="p">[</span><span class="s2">"Amoebozoa"</span><span class="p">,</span> <span class="s2">"Opisthokonta"</span><span class="p">]},</span>
<span class="p">}).</span><span class="nx">count</span><span class="p">()</span>
<span class="mi">1</span>

<span class="c1">// And again at level ERROR.
</span><span class="o">&gt;</span><span class="nx">db</span><span class="p">.</span><span class="nx">mongolog</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="s1">'level'</span><span class="o">:</span> <span class="s1">'INFO'</span><span class="p">,</span>
    <span class="s1">'msg.Life.Domain.Eukaryota.name'</span><span class="o">:</span> <span class="p">{</span><span class="nx">$in</span><span class="o">:</span> <span class="p">[</span><span class="s2">"Amoebozoa"</span><span class="p">,</span> <span class="s2">"Opisthokonta"</span><span class="p">]},</span>
<span class="p">}).</span><span class="nx">count</span><span class="p">()</span>
<span class="mi">2</span>

<span class="c1">// Notice that now two records are returned.  This is because
// logger.exception(...) also logs at level ERROR, but also notice that if when we
// pretty print the records...
</span><span class="o">&gt;</span><span class="nx">db</span><span class="p">.</span><span class="nx">mongolog</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="s1">'level'</span><span class="o">:</span> <span class="s1">'ERROR'</span><span class="p">,</span>
    <span class="s1">'msg.Life.Domain.Eukaryota.name'</span><span class="o">:</span> <span class="p">{</span><span class="nx">$in</span><span class="o">:</span> <span class="p">[</span><span class="s2">"Amoebozoa"</span><span class="p">,</span> <span class="s2">"Opisthokonta"</span><span class="p">]},</span>
<span class="p">}).</span><span class="nx">pretty</span><span class="p">()</span>

<span class="c1">// ...that one of the entries has exception info.  When running in a real environment
// and not the console the 'trace' section will be populated with the full stack trace.
</span><span class="s2">"exception"</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">"info"</span> <span class="o">:</span> <span class="p">[</span>
        <span class="s2">"&lt;type 'exceptions.ValueError'&gt;"</span><span class="p">,</span>
        <span class="s2">"Bad Value"</span><span class="p">,</span>
        <span class="s2">"&lt;traceback object at 0x106853b90&gt;"</span>
    <span class="p">],</span>
    <span class="s2">"trace"</span> <span class="o">:</span>
     <span class="kc">null</span>
<span class="p">}</span>
</pre>
</dd>
</div></body></html>