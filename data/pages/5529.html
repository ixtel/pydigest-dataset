<html><body><div><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-arghandler-" class="anchor" href="#arghandler-" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>arghandler <a href="https://travis-ci.org/druths/arghandler"><img src="https://camo.githubusercontent.com/dee8fdd31086b3ea6f4484c0b060fbefbfee3744/68747470733a2f2f7472617669732d63692e6f72672f6472757468732f61726768616e646c65722e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/druths/arghandler.svg?branch=master"/></a></h1>

<p><em>Making argparse even more awesome</em></p>

<p>I love <a href="https://docs.python.org/3/library/argparse.html">argparse</a>, but there
are some things that it simply doesn't help with as much as I'd like. Enter
arghandler.</p>

<p>The goal behind arghandler is to provide all the capabilities of argparse
<em>plus</em> some high-level capabilities that crop up a lot when writing
command-line tools: the library aims for high quality command line interfaces
with (even more) minimal code.</p>

<p>At present, arghandler provides two key capabilities:</p>

<ol>
<li><p>Adding subcommands with basically zero extra lines of code. This gives
support for writing programs like <code>git</code> and <code>svn</code> which have nested
subcommands.</p></li>
<li><p>Configuring the logging framework (e.g., the desired logging level) from
the command line - again with basically one line of code.</p></li>
</ol>

<p>We have lots more improvements we want to add - and as we have time and receive
feedback, we'll add more features.</p>

<p>If you have ideas, <a href="mailto:druths@networkdynamics.org">email me</a> or code it up
and generate a pull request!</p>

<h2><a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Installation</h2>

<p>Use <code>pip</code> or <code>easy_install</code> to install the library:</p>

<pre><code>pip install arghandler
</code></pre>

<p>or </p>

<pre><code>easy_install arghandler 
</code></pre>

<p>You can find arghandler on pypi for relevant details should you need them.</p>

<h2><a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Usage</h2>

<p>Just like with
<a href="https://docs.python.org/3/library/argparse.html#argumentparser-objects">argparse.ArgumentParser</a>,
in <code>arghandler</code> everything revolves around <code>ArgumentHandler</code>. In fact, it's
(not so secretly) a subclass of ArgumentParser, so you can use it exactly the
way you use <code>ArgumentParser</code>.  But <code>ArgumentHandler</code> has some new tricks.</p>

<p>To benefit from <code>ArgumentHandler</code>, your command-line configuration code will
follow this logic:</p>

<pre><code>from arghandler import ArgumentHandler

handler = ArgumentHandler() # this accepts all args supported by ArgumentParser

# config the handler using add_argument, set_logging_level, set_subcommands, etc...

handler.run() # throw the configured handler at an argument string!
</code></pre>

<p>Now for some details...</p>

<h3><a id="user-content-invoking-argumenthandler" class="anchor" href="#invoking-argumenthandler" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Invoking ArgumentHandler</h3>

<p><code>ArgumentHandler</code> can be invoked on arguments in two ways.  </p>

<p><em><code>ArgumentHandler.parse_args([argv])</code></em> is little different from
<code>ArgumentParser.parse_args([argv])</code>.  If <code>argv</code> is omitted, then the value of
<code>sys.argv</code> is used. The only notable differences are:</p>

<ul>
<li><p>If a logging argument was set, then this will be included in the namespace
object returned.</p></li>
<li><p>If subcommands are available, then the subcommand will be given by the
value of <code>args.cmd</code> and the subcommand's arguments will be given by
<code>args.cargs</code>.</p></li>
</ul>

<p><em><code>ArgumentHandler.run(argv,context_fxn)</code></em> makes the class perform its more
unique and powerful capabilities.  Notably: configuring the logger and running
subcommands.  As with <code>parse_args(...)</code>, if <code>argv</code> is not specified, then
<code>sys.argv</code> will be used.  The <code>context_fxn</code> is also optional and is used as
part of subcommand processing.  See that <a href="#subcommands">section</a> below for more
details.</p>

<h3><a id="user-content-setting-the-logging-level" class="anchor" href="#setting-the-logging-level" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Setting the logging level</h3>

<p>If you use the python <a href="https://docs.python.org/3/library/logging.html">logging</a>
package, this feature will save you some time.</p>

<p>The <code>ArgumentParser.set_logging_argument(...)</code> method allows you to specify a
command-line argument that will set the logging level.  The method accepts
several arguments:</p>

<pre><code>ArgumentParser.set_logging_argument(*names,default_level=logging.ERROR,config_fxn=None)
</code></pre>

<ul>
<li><p><code>*names</code> stands in for one or more arguments that specify the 
argument names that will be used. These follow the same rules as ones
passed into
<a href="https://docs.python.org/3/library/argparse.html#argparse.ArgumentParser.add_argument">ArgumentParser.add_argument(...)</a>.
Moreover, they MUST be optional arguments (i.e., start with a '-'
character).</p></li>
<li><p><code>default_level</code> indicates the default level the logging 
framework will be set to should the level not be specified on the command
line.</p></li>
<li><p><code>config_fxn</code> allows the developer to write special logging 
configuration code.  If not specified, the
<a href="https://docs.python.org/3/library/logging.html#logging.basicConfig">logging.basicConfig</a>
function will be invoked with the appropriate logging level. The function
must accept two arguments: the logging level and the namespace args object
returned by the <code>ArgumentParser.parse_args</code> method. The configuration
itself will happen when the <code>ArgumentHandler.run(...)</code> method is called.</p></li>
</ul>

<p>If you're cool with the defaults in <code>basicConfig</code>, then your method call will
look something like this</p>

<pre><code>handler.set_logging_argument('-l','-log_level',default_level=logging.INFO)
</code></pre>

<p>If you do want to do some customization, then your code will look like this</p>

<pre><code>handler.set_logging_argument('-l','-llevel',
    config_fxn=lambda level,args: logging.basicConfig(level=level,format='%(message)'))
</code></pre>

<h3><a id="user-content-declaring-subcommands-using-decorators" class="anchor" href="#declaring-subcommands-using-decorators" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a><a name="user-content-subcommands"/>Declaring subcommands using decorators</h3>

<p>This feature makes it possible to write nested commands like <code>git commit</code> and
<code>svn checkout</code> with basically zero boilerplate code.  To do this <code>arghandler</code>
provides the <code>@subcmd</code> decorator.  To declare a subcommand, just put the
decorator on the function  you want to act as the subcommand.</p>

<pre><code>from arghandler import *

@subcmd
def echo(parser,context,args):
    print ' '.join(args)

# here we associate the subcommand 'foobar' with function cmd_foobar
@subcmd('foobar')
def cmd_foobar(parser,context,args):
    print 'foobar'

handler = ArgumentHandler()
handler.run(['echo','hello','world']) # echo will be called and 'hello world' will be printed
</code></pre>

<p>Notice that the subcommands always take three arguments. </p>

<p><code>args</code> is the set of arguments that <em>follow</em> the subcommand on the command
line. </p>

<p><code>context</code> is an object that can make valuable global information available to
subcommands.  By default, the context is the namespace object returned by the
internal call to <code>ArgumentHandler.parse_args(...)</code>.  Other contexts can be
produced by passing a context-producing function to the
<code>ArgumentHandler.run(...)</code> function:</p>

<pre><code>@subcmd('ping')
def ping_server(parser,server_address,args):
    os.system('ping %s' % server_address)

handler = ArgumentHandler()
handler.add_argument('-s','--server')

# when this is run, the context will be set to the return value of context_fxn
# in this case, it will be the string '127.0.0.1'
handler.run(['-s','127.0.0.1','ping'],context_fxn=lambda args: args.server
</code></pre>

<p>Finally, <code>parser</code> is an instance of <code>argparse.ArgumentParser</code> which has been
preconfigured to behave properly for the subcommand.  Most crucially, this
means that <code>parser.prog</code> is set to <code>&lt;top_level_program&gt; &lt;sub_command&gt;</code> so that
help messages print out correctly for the subcommand.  Should your subcommand
want to parse arguments, this parser object should be used.</p>

<h3><a id="user-content-declaring-subcommands-without-decorators" class="anchor" href="#declaring-subcommands-without-decorators" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Declaring subcommands without decorators</h3>

<p>While decorators are the preferred way to specify subcommands, subcommands can
also be specified using the <code>ArgumentHandler.set_subcommands(...)</code> function.
This method expects a dictionary: keys are command names, values are the
command functions:</p>

<pre><code>from arghandler import *

def echo(parser,context,args):
    print ' '.join(args)

def cmd_foobar(parser,context,args):
    print 'foobar'

handler = ArgumentHandler()
handler.set_subcommands( {'echo':echo, 'foobar':cmd_foobar} )
handler.run(['echo','hello','world']) # echo will be called and 'hello world' will be printed
</code></pre>

<p>All the logic and rules around the context function apply here.  Moreoever, the
complete set of subcommands include those specified using decorators AND those
specified through the <code>set_subcommands(...)</code> method.</p>

<h2><a id="user-content-some-best-practices" class="anchor" href="#some-best-practices" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" role="img" version="1.1" viewbox="0 0 16 16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"/></svg></a>Some best practices</h2>

<p><em>Use <code>ArgumentParser</code> or <code>ArgumentHandler</code> inside subcommands.</em> This will
ensure that informative help messages are available for all your subcommands.</p>

<pre><code>from arghandler import *

@subcmd
def echo(parser,context,args):
    parser.add_argument('-q','--quote_char',required=True)
    args = parser.parse_args(args)
    print '%s%s%s' % (args.quote_char,' '.join(args),args.quote_char)

@subcmd('foobar')
def cmd_foobar(parser,context,args):
    print 'foobar'

handler = ArgumentHandler()
handler.run(['echo','-h']) # the help message for echo will be printed
</code></pre>

<p><em>Use logging.</em> Logging gives you much more control over what
debugging/informational content is printed out by your program. And with
<code>arghandler</code> it's easier than ever to configure from the command line!</p>
</article>
  </div></body></html>