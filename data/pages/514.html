<html><body><div><div>
<p><a href="https://impythonist.files.wordpress.com/2014/02/sl4a.jpg"><img class="size-full wp-image aligncenter" id="i-357" alt="Image" src="https://impythonist.files.wordpress.com/2014/02/sl4a.jpg?w=458"/></a></p>
<p>Android has a range of built-in dialogs that allow apps to interact with users. They can be used to display things like spinners and progress bars, and can be used to prompt the user for some kind of input, like a date or string.</p>
<p>All of the methods for creating dialogs live in SL4A’s <em>UI Facade</em>, along with most of the methods you’ll ever need for managing them. The UI Facade also hosts methods for creating webviews and for working with the experimental FullScreenUI stuff.</p>
<h2>SL4A and Native Dialogs</h2>
<p>The normal flow when using dialogs is to first create the appropriate dialog object, then set any additional features you want it to have, then render it to the user. It takes a few calls, but it’s easy to do. Once it’s displayed, there are methods for getting results from a dialog and for dismissing it. You can also update progress dialogs while they’re being rendered.</p>
<h3>Creating Android Dialogs</h3>
<p>You create a new dialog using one of the <code>dialogCreate*</code> calls. The standard dialogs are <code>Alert</code>, <code>Input</code>, <code>Password</code>, <code>DatePicker</code>, <code>SeekBar</code>, <code>SpinnerProgress</code> and <code>HorizontalProgress</code>.</p>
<p>For example, to create and render a date picker dialog, you’d do something like…</p>
<div id="crayon-52ee25463a9eb293321998">
<div>
<table>
<tbody>
<tr>
<td>

</td>
<td>
<div>
<p id="crayon-52ee25463a9eb293321998-1">from android import Android</p>
<p id="crayon-52ee25463a9eb293321998-2">droid = Android()</p>
<p id="crayon-52ee25463a9eb293321998-3">droid.dialogCreateDatePicker()</p>
<p id="crayon-52ee25463a9eb293321998-4">droid.dialogShow()</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Note that all interaction with the dialog is done by calling methods of <code>droid</code>. This is just a consequence of the way SL4A interfaces with the Android API; the <code>droid</code> object is a ‘god object’, so everything is a method of <code>droid</code>. For simplicity’s sake, there is only ever one instance of a dialog, so any <code>dialogCreate*</code> call will cause any existing dialog to be destroyed.</p>
<h3>Customising Dialogs</h3>
<p>You set any additional features of a dialog with the <code>dialogSet*</code> calls. What you can customise will depend on what kind of dialog you’ve created.</p>
<p>For example, you could set the positive button text on an alert dialog using <code>dialogSetPositiveButtonText</code>, and there’s matching methods for setting neutral and negative button texts. You can use any combination of the three on an alert dialog.</p>
<h3>Displaying Dialogs</h3>
<p>You display a dialog using <code>dialogShow</code>, and you can then dismiss the dialog with <code>dialogDismiss</code>.</p>
<h3>Getting the Input</h3>
<p>You can normally get any results using <code>dialogGetResponse</code>, which blocks until the user responds to the dialog. However, for certain types of dialogs, you may instead have to use the <code>eventPoll</code> method of the Events Facade to wait for a dialog event. <em>Some dialogs, such as menus, are persistent features of an application, potentially generating multiple events over time, so they must be managed through the Events Facade.</em></p>
<p>If you create single-choice dialogs (radio buttons) or multi-choice dialogs (checklists), you must pass in a list of choices for the user to select from. You can find out which choices were selected using the <code>dialogGetSelectedItems</code> method. This method returns a list of integers, which map to the indices of the selected items in the list of choices you passed in. Obviously, for a single-choice dialog, there will only be one.</p>
<h2>Say That Again in Python…</h2>
<p>Let’s imagine we need to ask the user if they want to install a bunch of packages, then, assuming they do, we want to create a progress bar that shows how that installation process is doing. Let’s also say say we have 5 packages to install.</p>
<div id="crayon-52ee25463a9fe227714041">
<div>
<table>
<tbody>
<tr>
<td>
<div>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>13</p>
<p>14</p>
<p>15</p>
<p>16</p>
<p>17</p>
<p>18</p>
<p>19</p>
<p>20</p>
<p>21</p>
<p>22</p>
<p>23</p>
<p>24</p>
<p>25</p>
<p>26</p>
<p>27</p>
<p>28</p>
<p>29</p>
<p>30</p>
<p>31</p>
<p>32</p>
<p>33</p>
<p>34</p>
<p>35</p>
<p>36</p>
<p>37</p>
<p>38</p>
<p>39</p>
<p>40</p>
<p>41</p>
<p>42</p>
<p>43</p>
<p>44</p>
<p>45</p>
<p>46</p>
<p>47</p>
<p>48</p>
<p>49</p>
<p>50</p>
<p>51</p>
<p>52</p>
<p>53</p>
</div>
</td>
<td>
<div>
<p id="crayon-52ee25463a9fe227714041-1">import sys</p>
<p id="crayon-52ee25463a9fe227714041-2"> </p>
<p id="crayon-52ee25463a9fe227714041-3"># Create the droid object</p>
<p id="crayon-52ee25463a9fe227714041-4">from android import Android</p>
<p id="crayon-52ee25463a9fe227714041-5">droid = Android()</p>
<p id="crayon-52ee25463a9fe227714041-6"> </p>
<p id="crayon-52ee25463a9fe227714041-7"># Create an alert, setting a title and message</p>
<p id="crayon-52ee25463a9fe227714041-8">droid.dialogCreateAlert(</p>
<p id="crayon-52ee25463a9fe227714041-9">    ‘Install Packages?’,</p>
<p id="crayon-52ee25463a9fe227714041-10">    ‘You may want to use WiFi for this.’</p>
<p id="crayon-52ee25463a9fe227714041-11">)</p>
<p id="crayon-52ee25463a9fe227714041-12"> </p>
<p id="crayon-52ee25463a9fe227714041-13"># Set up a couple of buttons</p>
<p id="crayon-52ee25463a9fe227714041-14">droid.dialogSetPositiveButtonText(‘Yes’)</p>
<p id="crayon-52ee25463a9fe227714041-15">droid.dialogSetNegativeButtonText(‘No’)</p>
<p id="crayon-52ee25463a9fe227714041-16"> </p>
<p id="crayon-52ee25463a9fe227714041-17"># Now render the dialog to the user</p>
<p id="crayon-52ee25463a9fe227714041-18">droid.dialogShow()</p>
<p id="crayon-52ee25463a9fe227714041-19"> </p>
<p id="crayon-52ee25463a9fe227714041-20"># Get the result and dismiss the dialog</p>
<p id="crayon-52ee25463a9fe227714041-21">response = droid.dialogGetResponse().result</p>
<p id="crayon-52ee25463a9fe227714041-22">droid.dialogDismiss()</p>
<p id="crayon-52ee25463a9fe227714041-23"> </p>
<p id="crayon-52ee25463a9fe227714041-24"># Check to see if the user has pressed a button, as users can dismiss</p>
<p id="crayon-52ee25463a9fe227714041-25"># dialogs, and check if it was the positive one, otherwise we’re done</p>
<p id="crayon-52ee25463a9fe227714041-26">if not ‘which’ in response or response[‘which’] != ‘positive’: sys.exit()</p>
<p id="crayon-52ee25463a9fe227714041-27"> </p>
<p id="crayon-52ee25463a9fe227714041-28"># Now the checks are done, create and render the new progress bar dialog,</p>
<p id="crayon-52ee25463a9fe227714041-29"># setting a title, message and a maximum progress of 5</p>
<p id="crayon-52ee25463a9fe227714041-30">droid.dialogCreateHorizontalProgress(</p>
<p id="crayon-52ee25463a9fe227714041-31">    ‘Installing Packages…’,</p>
<p id="crayon-52ee25463a9fe227714041-32">    ‘This should just take a moment.’,</p>
<p id="crayon-52ee25463a9fe227714041-33">    5</p>
<p id="crayon-52ee25463a9fe227714041-34">)</p>
<p id="crayon-52ee25463a9fe227714041-35"> </p>
<p id="crayon-52ee25463a9fe227714041-36"># Render the dialog</p>
<p id="crayon-52ee25463a9fe227714041-37">droid.dialogShow()</p>
<p id="crayon-52ee25463a9fe227714041-38"> </p>
<p id="crayon-52ee25463a9fe227714041-39"># Now do the installation, updating the progress bar along the way…</p>
<p id="crayon-52ee25463a9fe227714041-40"> </p>
<p id="crayon-52ee25463a9fe227714041-41"># Import a couple of parsimonyms</p>
<p id="crayon-52ee25463a9fe227714041-42">import some_package_installing_function as install</p>
<p id="crayon-52ee25463a9fe227714041-43">import some_list_of_packages as packages</p>
<p id="crayon-52ee25463a9fe227714041-44"> </p>
<p id="crayon-52ee25463a9fe227714041-45"># Install each of the packages, incrementing the progress bar on each</p>
<p id="crayon-52ee25463a9fe227714041-46">progress = 0</p>
<p id="crayon-52ee25463a9fe227714041-47">for package in packages:</p>
<p id="crayon-52ee25463a9fe227714041-48">    install(package)</p>
<p id="crayon-52ee25463a9fe227714041-49">    progress += 1</p>
<p id="crayon-52ee25463a9fe227714041-50">    droid.dialogSetCurrentProgress(progress)</p>
<p id="crayon-52ee25463a9fe227714041-51"> </p>
<p id="crayon-52ee25463a9fe227714041-52"># Tidy up and exit</p>
<p id="crayon-52ee25463a9fe227714041-53">droid.dialogDismiss()</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The screenshots to the right show the confirmation dialog and the progress dialog. The actual look and feel will be slightly different from device to device of course.</p>
<p><img alt="Android progress dialog" src="https://i1.wp.com/www.pythoncentral.io/wp-content/uploads/2013/09/progress.png"/></p>
<p><img alt="Android confirmation dialog" src="https://i2.wp.com/www.pythoncentral.io/wp-content/uploads/2013/09/confirm.png"/></p>
<p>Note that, if you only want to ask the user for some text input, like Python’s <code>input</code> function would, or a password, you can use the <code>dialogGetInput</code> and <code>dialogGetPassword</code> methods, which are just convenient wrappers, allowing you to get these inputs in a single call.</p>
<h2>Event Based Dialogs</h2>
<p>The above example pretty much covered all the basics of using dialogs with SL4A, and the <a title="Android Scripting Layer API Reference" href="http://code.google.com/p/android-scripting/wiki/ApiReference" target="_blank">API Reference</a> covers all the finer details. The only real exception to the normal way of doing dialogs (create-customise-render-read-dismiss) is when using menu items. As mentioned before, menu items are added to the native menus of applications; generally they’re always available to the user and may be clicked at any point, any number of times, so they are managed a bit differently.</p>
<p>For example, you can use <code>addOptionsMenuItem</code> to add an item to your application’s options menu. The method requires two arguments, a string that sets the text to display on the item, and a string that sets a name for the events that are produced whenever the item is clicked. You can optionally set the data that is passed with the events, and set an icon to be displayed on the menu item. Again, see the API docs for all the details.</p>
<p>If you’ve used the Events Facade before, this will already will make perfect sense. Either way, it’s not difficult to get started with. The following example will block, so it’d need another thread or something to be much use; this example just covers the SL4A API.</p>
<div id="crayon-52ee25463aa05166763703">
<div>
<table>
<tbody>
<tr>
<td>
<div>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>13</p>
<p>14</p>
<p>15</p>
<p>16</p>
<p>17</p>
<p>18</p>
</div>
</td>
<td>
<div>
<p id="crayon-52ee25463aa05166763703-1"># addOptionsMenuItem takes two to four arguments:</p>
<p id="crayon-52ee25463aa05166763703-2"># item_label, event_name, [event_data], [icon_name]</p>
<p id="crayon-52ee25463aa05166763703-3"> </p>
<p id="crayon-52ee25463aa05166763703-4"># The following calls add three items to the options menu…</p>
<p id="crayon-52ee25463aa05166763703-5">droid.addOptionsMenuItem(‘Do A’, ‘a_event’, ‘Some event data.’)</p>
<p id="crayon-52ee25463aa05166763703-6">droid.addOptionsMenuItem(‘Do B’, ‘b_event’, ‘Some other data.’)</p>
<p id="crayon-52ee25463aa05166763703-7">droid.addOptionsMenuItem(‘Quit’, ‘kill’, None, ‘ic_menu_revert’)</p>
<p id="crayon-52ee25463aa05166763703-8"> </p>
<p id="crayon-52ee25463aa05166763703-9">while True:</p>
<p id="crayon-52ee25463aa05166763703-10">    # Block until an event happens, then grab the result</p>
<p id="crayon-52ee25463aa05166763703-11">    res = droid.eventWait().result</p>
<p id="crayon-52ee25463aa05166763703-12">    </p>
<p id="crayon-52ee25463aa05166763703-13">    # If it’s a kill event, exit the event loop</p>
<p id="crayon-52ee25463aa05166763703-14">    if res[‘name’] == ‘kill’:</p>
<p id="crayon-52ee25463aa05166763703-15">        break</p>
<p id="crayon-52ee25463aa05166763703-16"> </p>
<p id="crayon-52ee25463aa05166763703-17">    # Otherwise, print the event data</p>
<p id="crayon-52ee25463aa05166763703-18">    print(res[‘data’])</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></body></html>