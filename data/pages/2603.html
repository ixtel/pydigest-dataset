<html><body><div><div class="e-content entry-content" itemprop="articleBody text">
<div>
<p>This is to inform you about the new stable release of <a class="reference external" href="http://nuitka.net">Nuitka</a>. It is the extremely compatible Python compiler. Please see the page <a class="reference external" href="../pages/overview.html">"What is Nuitka?"</a> for an overview.</p>
<p>This release brings bug fixes, important new optimization, newly supported
platforms, and important compatibility improvements. Progress on all fronts.</p>
<div class="section" id="bug-fixes">
<h2>Bug Fixes</h2>
<ul>
<li>
<p class="first">Closure taking of global variables in member functions of classes that had
a class variable of the same name was binding to the class variable as
opposed to the module variable.</p>
</li>
<li>
<p class="first">Overwriting compiled function's <tt class="docutils literal">__doc__</tt> attribute more than once could
corrupt the old value, leading to crashes.
<a class="reference external" href="http://bugs.nuitka.net/issue156">Issue#156</a>. Fixed in 0.5.5.2 already.</p>
</li>
<li>
<p class="first">Compatibility Python2: The <tt class="docutils literal">exec</tt> statement <tt class="docutils literal">execfile</tt> were changing
<tt class="docutils literal">locals()</tt> was given as an argument.</p>
<pre class="code python"><a name="rest_code_a247d6eed51844a1accdafdaaeb438a2-1"/><span class="k">def</span> <span class="nf">function</span><span class="p">():</span>
<a name="rest_code_a247d6eed51844a1accdafdaaeb438a2-2"/>   <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_a247d6eed51844a1accdafdaaeb438a2-3"/>
<a name="rest_code_a247d6eed51844a1accdafdaaeb438a2-4"/>   <span class="k">exec</span> <span class="n">code</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="c"># Cannot change local "a".</span>
<a name="rest_code_a247d6eed51844a1accdafdaaeb438a2-5"/>   <span class="k">exec</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">None</span>     <span class="c"># Can change local "a"</span>
<a name="rest_code_a247d6eed51844a1accdafdaaeb438a2-6"/>   <span class="k">exec</span> <span class="n">code</span>
</pre>
<p>Previously Nuitka treated all 3 variants the same.</p>
</li>
<li>
<p class="first">Compatibility: Empty branches with a condition were reduced to only the
condition, but they need in fact to also check the truth value:</p>
<pre class="code python"><a name="rest_code_8c6be2a815684275bc12f940a35e2f46-1"/><span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
<a name="rest_code_8c6be2a815684275bc12f940a35e2f46-2"/>    <span class="k">pass</span>
<a name="rest_code_8c6be2a815684275bc12f940a35e2f46-3"/><span class="c"># must be treated as</span>
<a name="rest_code_8c6be2a815684275bc12f940a35e2f46-4"/><span class="nb">bool</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
<a name="rest_code_8c6be2a815684275bc12f940a35e2f46-5"/><span class="c"># and not (bug)</span>
<a name="rest_code_8c6be2a815684275bc12f940a35e2f46-6"/><span class="n">condition</span>
</pre>
</li>
<li>
<p class="first">Detection of Windows virtualenv was not working properly. Fixed in 0.5.5.2
already.</p>
</li>
<li>
<p class="first">Large enough constants structures are now unstreamed via <tt class="docutils literal">marshal</tt> module,
avoiding large codes being generated with no point. Fixed in 0.5.5.2 already.</p>
</li>
<li>
<p class="first">Windows: Pressing CTRL-C gave two stack traces, one from the re-execution of
Nuitka which was rather pointless. Fixed in 0.5.5.1 already.</p>
</li>
<li>
<p class="first">Windows: Searching for virtualenv environments didn't terminate in all cases.
Fixed in 0.5.5.1 already.</p>
</li>
<li>
<p class="first">During installation from PyPI with Python3 versions, there were errors given
for the Python2 only scons files.
<a class="reference external" href="http://bugs.nuitka.net/issue153">Issue#153</a>. Fixed in 0.5.5.3 already.</p>
</li>
<li>
<p class="first">Fix, the arguments of <tt class="docutils literal">yield from</tt> expressions could be leaked.</p>
</li>
<li>
<p class="first">Fix, closure taking of a class variable could have in a sub class where the
module variable was meant.</p>
<pre class="code python"><a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-1"/><span class="n">var</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-2"/>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-3"/><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-4"/>   <span class="n">var</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-5"/>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-6"/>   <span class="k">class</span> <span class="nc">D</span><span class="p">:</span>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-7"/>      <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-8"/>         <span class="c"># was C.var, now correctly addressed top level var</span>
<a name="rest_code_bb5633b9d4c64e0fb97afc76e0c72a53-9"/>         <span class="k">return</span> <span class="n">var</span>
</pre>
</li>
<li>
<p class="first">Fix, setting <tt class="docutils literal">CXX</tt> environment variable because the installed gcc has too
low version, wasn't affecting the version check at all.</p>
</li>
<li>
<p class="first">Fix, on Debian/Ubuntu with <tt class="docutils literal"><span class="pre">hardening-wrapper</span></tt> installed the version check
was always failing, because these report a shortened version number to Scons.</p>
</li>
</ul>
</div>
<div class="section" id="new-optimization">
<h2>New Optimization</h2>
<ul class="simple">
<li>Local variables that must be assigned also have no side effects, making use
of SSA. This allows for a host of optimization to be applied to them as
well, often yielding simpler access/assign code, and discovering in more
cases that frames are not necessary.</li>
<li>Micro optimization to <tt class="docutils literal">dict</tt> built-in for simpler code generation.</li>
</ul>
</div>
<div class="section" id="organizational">
<h2>Organizational</h2>
<ul class="simple">
<li>Added support for ARM "hard float" architecture.</li>
<li>Added package for Ubuntu 14.10 for download.</li>
<li>Added package for openSUSE 13.2 for download.</li>
<li>Donations were used to buy a Cubox-i4 Pro. It got Debian Jessie installed
on it, and will be used to run an even larger amount of tests.</li>
<li>Made it more clear in the user documentation that the <tt class="docutils literal">.exe</tt> suffix is used
for all platforms, and why.</li>
<li>Generally updated information in user manual and developer manual about the
optimization status.</li>
<li>Using Nikola 7.1 with external filters instead of our own, outdated branch
for the web site.</li>
</ul>
</div>
<div class="section" id="cleanups">
<h2>Cleanups</h2>
<ul class="simple">
<li>PyLint clean for the first time ever. We now have a Buildbot driven test
that this stays that way.</li>
<li>Massive indentation cleanup of keyword argument calls. We have a rule to
align the keywords, but as this was done manually, it could easily get out
of touch. Now with a "autoformat" tool based on RedBaron, it's correct. Also,
spacing around arguments is now automatically corrected. More to come.</li>
<li>For <tt class="docutils literal">exec</tt> statements, the coping back to local variables is now an
explicit node in the tree, leader to cleaner code generation, as it now
uses normal variable assignment code generation.</li>
<li>The <tt class="docutils literal">MaybeLocalVariables</tt> became explicit about which variable they
might be, and contribute to its SSA trace as well, which was incomplete
before.</li>
<li>Removed some cases of code duplication that were marked as TODO items. This
often resulted in cleanups.</li>
<li>Do not use <tt class="docutils literal">replaceWith</tt> on child nodes, that potentially were re-used
during their computation.</li>
</ul>
</div>
<div class="section" id="summary">
<h2>Summary</h2>
<p>The release is mainly the result of consolidation work. While the previous
release contained many important enhancements, this is another important step
towards full SSA, closing one loop whole (class variables and <tt class="docutils literal">exec</tt>
functions), as well as applying it to local variables, largely extending its
use.</p>
<p>The amount of cleanups is tremendous, in huge part due to infrastructure
problems that prevented release repeatedly. This reduces the technological
debt very much.</p>
<p>More importantly, it would appear that now eliminating local and temporary
variables that are not necessary is only a small step away. But as usual, while
this may be easy to implement now, it will uncover more bugs in existing code,
that we need to address before we continue.</p>
</div>
</div>
</div>
</div></body></html>