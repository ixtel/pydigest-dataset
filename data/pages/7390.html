<html><body><div><div class="clear padding-top-small">
                        <p>I love <a href="http://support.dominodatalab.com/hc/en-us/articles/204856585-Jupyter-Notebooks">Jupyter</a> notebooks! They're great for experimenting with new ideas or data sets, and although my notebook "playgrounds" start out as a mess, I use them to crystallize a clear idea for building my final projects. </p>

<p>Jupyter is so great for interactive exploratory analysis that it's easy to overlook some of its other powerful features and use cases. I wanted to write a blog post on some of the lesser known ways of using Jupyter — but there are so many that I broke the post into two parts.</p>

<p>In Part 1, today, I describe how to use Jupyter to create pipelines and reports. In the next post, I will describe how to use Jupyter to create interactive dashboards.</p>

<p><em>The accompanying project to this blog can be found <a href="https://app.dominodatalab.com/r00sj3/jupyter">here</a></em></p>

<p><a name="part1"/>  </p>

<h1 id="magics">Magics</h1>

<p>You probably know that you can start notebooks with different kernels (e.g., R, Julia) — not just Python. What you might not know is that even within a notebook, you can run different types of code in different cells. With "magics", it is possible to use different languages. The magics that are available vary per notebook kernel, however. </p>

<p>By running <code>% lsmagic</code> in a cell you get a list of all the available magics. You can use <code>%</code> to start a single-line expression to run with the magics command. Or you can use a double <code>%%</code> to run a multi-line expression.</p>

<p>Some of my favorites are:</p>

<ul>
<li><code>% env</code> to list your environment variables.</li>
<li><code>!</code>: to run a shell command. E.g., <code>! pip freeze | grep pandas</code> to see what version of pandas is installed.</li>
<li><code>% matplotlib inline</code> to show matplotlib plots inline the notebook.</li>
<li><code>% pastebin 'file.py'</code> to upload code to pastebin and get the url returned.</li>
<li><code>% bash</code> to run cell with bash in a subprocess.
<img src="/content/images/2015/10/bash-1.png" alt=""/></li>
<li><code>%time</code> will time whatever you evaluate</li>
<li><code>%%latex</code> to render cell contents as LaTeX
<img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-10-37-59-PM.png" alt=""/></li>
<li><code>%timeit</code> will time whatever you evaluate multiple times and give you the best, and the average times </li>
</ul>

<p><img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-10-28-18-PM.png"/></p>

<ul>
<li><code>%prun</code>, <code>%lprun</code>, <code>%mprun</code> can give you line-by-line breakdown of time and memory usage in a function or script. See a good tutorial <a href="http://pynash.org/2013/03/06/timing-and-profiling.html">here</a>.</li>
<li><code>%% HTML</code>: to render the cell as HTML. So you can even embed an image or other media in your notebook:</li>
</ul>

<p><img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-10-20-38-PM.png"/></p>

<p>You can even use magics to mix languages in a single notebook. For example, <a href="https://ipython.org/ipython-doc/2/config/extensions/rmagic.html">rmagics</a> lets you run R code — including plotting — in a Python notebook. Note that you first need to load the <code>rmagics</code> extension.</p>

<p><img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-10-42-44-PM.png" alt=""/></p>

<p>As described in the <a href="https://ipython.org/ipython-doc/2/config/extensions/rmagic.html">rmagics documentation</a>, you can use <code>%Rpush</code> and <code>%Rpull</code> to move values back and forth between R and Python:</p>

<p><img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-10-45-35-PM.png" alt=""/></p>

<p>You can find other examples of language-magics online, including <a href="https://github.com/catherinedevlin/ipython-sql">SQL magics</a> and <a href="https://acsgsoc15.wordpress.com/2015/04/07/using-cython-in-ipython/">cython magics</a>. You can read about more common magics <a href="https://ipython.org/ipython-doc/3/interactive/magics.html">here</a>. Seriously, you could spend an entire day learning about these!</p>

<h3 id="pipelines">Pipelines</h3>

<p>Magics are handy on their own, but they really shine when you combine them. These functions can help you create pipelines in one visual flow by combining steps in different languages. Getting familiar with magics gives you the power to use the most efficient solution per subtask and bind them together for your project. </p>

<p>When used this way, Jupyter notebooks became "visual shell scripts" tailored for data science work. Each cell can be a step in a pipeline that can use a high-level language directly (e.g., R, Python), or a lower-level shell command. At the same time, your "script" can also contain nicely formatted documentation and visual output from the steps in the process. It can even document its own performance, automatically recording CPU and memory utilization in its output.</p>

<p><a name="part2"/>  </p>

<h1 id="batchschedulingandreports">Batch, scheduling, and reports</h1>

<p>Like any other Python script it is possible to also run your notebook in batch mode. By using <a href="https://ipython.org/ipython-doc/1/interactive/nbconvert.html">nbconvert</a>, you can calculate an entire notebook non-interactively, saving it in place or to a variety of other formats. </p>

<p>This capability makes notebooks a powerful tool for ETL and for reporting. For a report, just schedule your notebooks to run on a recurring basis automatically and update its contents or email its results to colleagues. Or using the magics techniques described above, a notebook can implement a data pipeline or ETL task to run on an automatic schedule, as well.</p>

<h3 id="scheduleddashboard">Scheduled dashboard</h3>

<p>Let's say that you have to regularly send a <a href="http://blog.dominodatalab.com/creating-interactive-crime-maps-with-folium/">folium</a> map to your colleague's email with all the earthquakes of the past day. </p>

<p>To be able to do that, you first need an earthquake data set that updates regularly (at least daily). A data feed that updates every 5 minutes can be found <a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/csv.php">here</a>. Then, you can use Jupyter to write the <a href="https://app.dominodatalab.com/r00sj3/jupyter/view/batchdemo.ipynb">code</a> to load this data and create the map. <br/>
<img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-11-15-49-PM.png" alt=""/></p>

<p>Domino lets you <a href="http://support.dominodatalab.com/hc/en-us/articles/204843165-Scheduling-Runs">schedule</a> any script to run on a regular basis, and this works for ipynb files just like anything else. When it runs a scheduled execution of <code>batchdemo.ipynb</code>, Domino will calculate the notebook and update its cells with the newest results. </p>

<p><img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-11-39-04-PM.png" alt=""/></p>

<p>Collaborators can visit the page to view the <a href="https://app.dominodatalab.com/r00sj3/jupyter/view/batchdemo.ipynb">updated notebook</a> in the browser — without running a Jupyter server. So your notebook has become as a dashboard that's always up to date. </p>

<p><img src="/content/images/2015/11/Screen-Shot-2015-11-02-at-11-57-48-PM.png" alt=""/></p>

<h3 id="scheduleddashboardwithmagicsandhtmlexport">Scheduled dashboard with magics and HTML export</h3>

<p>A step further is combining magics pipelining and turning the whole notebook into a HTML report. This next <a href="https://app.dominodatalab.com/r00sj3/jupyter/view/pipelinedashboard.ipynb">example</a> shows how you can first use a shell script to retrieve a webpage (<a href="http://www.sfgate.com">http://www.sfgate.com</a>) that you visualize in a wordcloud with Python. Then, as part of the scheduled run, it is converted to a HTML page with the result of the run. You can set up your scheduled runs to automatically email any results (e.g., your notebook rendered as HTML) to your colleagues. </p>

<p>When you finish your notebook with inline visualizations, create a <a href="https://app.dominodatalab.com/r00sj3/jupyter/view/dashboard.sh">shell script</a> that is similar to:</p>

<pre><code>ipython nbconvert --to html pipelinedashboard.ipynb  
</code></pre>

<p>After scheduling this shell script, the result will be a <a href="https://app.dominodatalab.com/r00sj3/jupyter/raw/latest/pipelinedashboard.html">regular HTML version</a> of the last run of your notebook. </p>



<hr/>

<p>Stay tuned for Part II, where we'll explore creating interactive dashboards in Jupyter notebooks.</p>
                      </div>

                </div></body></html>