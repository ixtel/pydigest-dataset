<html><body><div><div class="entry-content">
                    <p>Early in my journeys with Python I struggled with understanding the purpose and use of <strong>lambda</strong> functions. When I finally understood them I was disappointed by their lack of <strong>docstrings</strong>. For that reason, and various other shortcomings, <a class="reference external" href="http://pydanny.blogspot.com/2007/07/lambdas-no-more.html">I went back to standard functions</a>. Also, for what it's worth, I've even spoken about how <a class="reference external" href="http://www.slideshare.net/pydanny/python-worst-practices/41">you shouldn't use lambdas</a>.</p>
<p>Recently I was thinking about how everything in Python is an object. This includes lambdas. Since all Python objects have the <cite>__doc__</cite> special (aka 'magic') attribute, can we add custom docstrings to everything?</p>
<p>Using <a class="reference external" href="http://pydanny.com/pytest-no-boilerplate-testing.html">pytest</a>, Python 2.7.x, and lambdas, let's find out!</p>
<div class="highlight"><pre><span class="c"># test_docstrings.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">def</span> <span class="nf">test_lambdas</span><span class="p">():</span>
    <span class="c"># Create a lambda and test it</span>
    <span class="n">doubler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">doubler</span><span class="p">(</span><span class="s">"fun"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"fun fun"</span>

    <span class="c"># Add a docstring to the lambda</span>
    <span class="n">doubler</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">"Doubles strings"</span>

    <span class="c"># Test that calling __doc__ works</span>
    <span class="k">assert</span> <span class="n">doubler</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">==</span> <span class="s">"Doubles strings"</span>
</pre></div>
<p>Hey! It worked! If I try it in the shell, I can even see that the <tt class="docutils literal">help()</tt> function works:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="c"># Welcome to the REPL!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">doubler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">doubler</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">"Doubles strings"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">help</span><span class="p">(</span><span class="n">doubler</span><span class="p">)</span>
<span class="n">Help</span> <span class="n">on</span> <span class="n">function</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">__main__</span><span class="p">:</span>

<span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="k">lambda</span> <span class="n">x</span>
    <span class="n">Doubles</span> <span class="n">strings</span>
</pre></div>
<p>Contrary to what I thought in 2007, Python lambdas <em>can</em> be documented. Modifying their docstring functions with both the direct <tt class="docutils literal">__doc___</tt> special attribute and the <tt class="docutils literal">help()</tt> built-in works just fine.</p>
<div class="section" id="should-we-use-lambdas">
<h2>Should We Use Lambdas?</h2>
<p>As demonstrated in this article, lambdas can be documented. Nevertheless, I'm still not entirely convinced python lambdas should be used as anything except when an anonymous function is advantageous, i.e during functional programming.</p>
</div>
<div class="section" id="what-about-other-python-types">
<h2>What About Other Python Types?</h2>
<p>Enough about lambdas, let's see what else we can do with docstrings.</p>
<div class="section" id="functions-and-docstrings">
<h3>Functions and Docstrings</h3>
<p>We know modifying docstrings of functions works, so we'll use it as a 'control'.</p>
<div class="highlight"><pre><span class="c"># appended to test_docstrings.py</span>
<span class="k">def</span> <span class="nf">test_functions</span><span class="p">():</span>
    <span class="c"># Create a function and test it</span>
    <span class="k">def</span> <span class="nf">doubler</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="s">"Doubles strings"</span>
        <span class="k">return</span> <span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">doubler</span><span class="p">(</span><span class="s">"fun"</span><span class="p">)</span> <span class="o">==</span> <span class="s">"fun fun"</span>
    <span class="k">assert</span> <span class="n">doubler</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">==</span> <span class="s">"Doubles strings"</span>

    <span class="c"># Change the docstring</span>
    <span class="n">doubler</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">"Really doubles strings"</span>

    <span class="c"># Test that calling __doc__ works</span>
    <span class="k">assert</span> <span class="n">doubler</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">==</span> <span class="s">"Really doubles strings"</span>
</pre></div>
</div>
<div class="section" id="strings-and-docstrings">
<h3>Strings and Docstrings</h3>
<p>Let's go for something a bit harder. Strings, for example, come with a docstring, but as Python strings are immutable types, it's read-only access:</p>
<div class="highlight"><pre><span class="c"># more appended to test_docstrings.py</span>
<span class="k">def</span> <span class="nf">test_strings</span><span class="p">():</span>
    <span class="c"># Assert that strings come with a built-in doc string</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">"Hello, world"</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">==</span> <span class="s">'str(object) -&gt; string</span><span class="se">\n\n</span><span class="s">Return a nice string'</span> \
        <span class="s">' representation of the object.</span><span class="se">\n</span><span class="s">If the argument is a string,'</span> \
        <span class="s">' the return value is the same object.'</span>

    <span class="c"># Try to set the docstring of a string and you get an AttributeError</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">"Stock programming text"</span>

    <span class="c"># The error's value explains the problem...</span>
    <span class="k">assert</span> <span class="n">err</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="s">"'str' object attribute '__doc__' is read-only"</span>
</pre></div>
<p>Hmmm... does this mean that we can't assign a docstring to a string? What if we subclass Python's <tt class="docutils literal">str</tt> type?</p>
<div class="highlight"><pre><span class="c"># Again appended to test_docstrings.py</span>
<span class="k">def</span> <span class="nf">test_subclassed_string</span><span class="p">():</span>

    <span class="c"># Subclass the string type</span>
    <span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
        <span class="sd">"""I am a string class"""</span>

    <span class="c"># Instantiate the string</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="s">"Hello, world"</span><span class="p">)</span>

    <span class="c"># The default docstring is set</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">==</span> <span class="s">"""I am a string class"""</span>

    <span class="c"># Let's set the docstring</span>
    <span class="n">s</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">"I am a string object"</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">==</span> <span class="s">"I am a string object"</span>
</pre></div>
<p>This looks like it works, but it doesn't do enough. Specifically, this doesn't satisfy the needs of Python's <tt class="docutils literal">help()</tt> function when called against the instantiated object.</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="c"># REPL again so we can call the help() function</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
<span class="o">...</span>     <span class="s">"""I am a string class"""</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="s">"Hello, world"</span><span class="p">)</span> <span class="c"># instantiate the String Object</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">"I am a string object"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">help</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="c"># Called against the 's' object, not the 'String' class.</span>
<span class="n">Help</span> <span class="n">on</span> <span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">module</span> <span class="n">__builtin__</span><span class="p">:</span>

<span class="n">NAME</span>
    <span class="n">__builtin__</span> <span class="o">-</span> <span class="n">Built</span><span class="o">-</span><span class="ow">in</span> <span class="n">functions</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">,</span> <span class="ow">and</span> <span class="n">other</span> <span class="n">objects</span><span class="o">.</span>

<span class="n">FILE</span>
    <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span>

<span class="n">DESCRIPTION</span>
    <span class="n">Noteworthy</span><span class="p">:</span> <span class="bp">None</span> <span class="ow">is</span> <span class="n">the</span> <span class="sb">`nil' object; Ellipsis represents `</span><span class="o">...</span><span class="s">' in slices.</span>
<span class="o">...</span>
</pre></div>
<p>You'll notice in the result of the <tt class="docutils literal">help()</tt> call on the 's' object, that the phrase, "I am a string object" does not exist.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>In Python, everything might be an object, but not all objects are created equal. Lambdas (and functions and objects) do allow for docstrings, but many, if not all basic types (strings, lists, classes, etc) for Python do not.</p>
<p>I wonder if I scratch this particular itch long enough I might be able to create a string-like class that handles the <tt class="docutils literal">help()</tt> issue. If that happens, maybe I'll add it to <a class="reference external" href="http://pydanny.com/fixing-pythons-string-class.html">String Theory</a>. ;-)</p>
<p><strong>Resource</strong>: The entire <tt class="docutils literal">test_docstrings.py</tt> module: <a class="reference external" href="https://gist.github.com/pydanny/9373279">https://gist.github.com/pydanny/9373279</a></p>
<a class="reference external image-reference" href="https://s3.amazonaws.com/pydanny/lambda_scoops.png"><img alt="https://s3.amazonaws.com/pydanny/lambda_scoops.png" class="align-center" id="lambda-scoops" src="https://s3.amazonaws.com/pydanny/lambda_scoops.png"/></a>
</div>

                    
                </div>
                                </div></body></html>