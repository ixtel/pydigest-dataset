<html><body><div><div class="entry-content"><p>В первых трёх частях мы написали более-менее работающее приложение и запустили его на локальном сервере.</p><p>Остаётся самый важный вопрос: "Как это заставить работать на сайте"? На него я постараюсь дать ответ в четвёртой части.</p><p>Для наших приложений обычный хостинг не подойдёт, поэтому нужен <b>виртуальный сервер</b>.</p><p>Для тестирования нашего приложения желателен тестовый период, поэтому для тестового приложения я остановился на виртуальном сервере от <a href="http://ihc.ru/?ref=159779" target="_blank">IHC</a>.</p><p>Регистрируемся по ссылке выше и заказываем трёхдневный тестовый период.</p><p>Создаём виртуальный сервер с операционной системой <i>Ubuntu 14.10 (Utopic Unicorn) 64-bit</i> (так как она удобнее всего в обращении).</p><p>Заходим на созданный виртуальный сервер по SSH (это можно сделать через консоль в linux, или через программу PUTTY для Windows) (логин - ubuntu, пароль - какой задали, сервер - ip сервера, который вам выдали. У меня это 176.103.149.168).</p><p>Теперь нам нужно установить программы, которые позволят нам запустить <b>cgi на виртуальном сервере</b>.</p><pre class="code bash literal-block">
sudo apt-get install nginx fcgiwrap
sudo apt-get install mc
sudo mcedit /etc/nginx/sites-enabled/default
</pre><p>Мы открыли на редактирование файл default с конфигурацией нашего сервера.</p><p>Покажу, что в итоге должно остаться:</p><pre class="code nginx literal-block">
<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span> <span class="s">default_server</span><span class="p">;</span>
    <span class="kn">listen</span> <span class="s">[::]:80</span> <span class="s">default_server</span> <span class="s">ipv6only=on</span><span class="p">;</span>
    <span class="kn">charset</span> <span class="s">utf-8</span><span class="p">;</span>
    <span class="kn">root</span> <span class="s">/home/ubuntu/www</span><span class="p">;</span>
    <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>

    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="s">/cgi-bin/</span> <span class="p">{</span>
        <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/fcgiwrap.socket</span><span class="p">;</span>
        <span class="kn">include</span> <span class="s">/etc/nginx/fastcgi_params</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="s">/home/ubuntu/www</span><span class="nv">$fastcgi_script_name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre><p>Создаём директорию, в которой будут храниться файлы (собственно, в файле конфигурации мы указали /home/ubuntu/www):</p><pre class="code bash literal-block">
mkdir /home/ubuntu/www
</pre><p>Заходим по FTP (это можно сделать с помощью программ WinSCP, FileZilla, Total Commander, файлового менеджера Nautilus в linux и других программ).</p><p>Копируем в созданную папку файлы из примеров (я скопирую из <a href="http://pythonworld.ru/web/cgi-2.html" target="_blank">этого</a> примера).</p><p>В form.py в начале файла (но после строчки <b>#!/usr/bin/env python3</b>) дописываем:</p><pre class="code python3"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span></pre><p>Иначе кириллица не заработает.</p><p>Всё. Осталось поменять права:</p><pre class="code bash literal-block">
<span class="nb">cd</span> /home/ubuntu/www
chmod <span class="m">644</span> index.html
chmod <span class="m">755</span> cgi-bin/form.py
sudo service nginx restart
sudo service fcgiwrap restart
</pre><p>И наслаждаться (до тех пор, пока не кончится тестовый период).</p><p>А когда кончится, можно остаться на <a href="http://ihc.ru/?ref=159779" target="_blank">IHC</a>, перейти на <a href="https://www.digitalocean.com/?refcode=c76db5e18363" target="_blank">digitalocean</a> (подороже, но меня ни разу не подводил) или <a href="http://firstvds.ru/?from=369086" target="_blank">firstvds</a> (дешево и сердито).</p></div></div></body></html>