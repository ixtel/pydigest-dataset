<html><body><div><div class="detail template ng-non-bindable" id="detail">


<p><img class="alignleft" src="https://s3.amazonaws.com/codementor_content/2014-Sep-Week1/ankuar.jpg" alt=""/><em>Ankur Ankan is the lead developer of <a href="https://github.com/pgmpy/pgmpy">pgmpy</a>, a Python library for Probabilistic Graphical Models. He mentors students at Google Summer Code and has great passion for Python programming.</em></p>
<p><em>This tutorial was originally posted in his <a href="http://ankurankan.github.io/blog/2014/06/03/custom-assert-method-in-python/">blog</a>.</em></p>
<hr/>
<p> </p>
<p>While writing tests we often need to compare objects defined by us and we then have to compare each attribute of the object one by one.</p>
<p>Let’s take an example of a simple <code>Car</code> class. The Car object has two attributes <code>speed</code> and <code>color</code>.</p>
<pre><code><span>class</span> <span>Car</span>:
    <span>def</span> <span><strong>__init__</strong></span>(self, <span>speed</span>, <span>color</span>):
        self.<span>speed</span> = <span>speed</span>
        self.<span>color</span> = <span>color</span></code></pre>
<p>So if you try writing test for it using <code>unittest.TestCase.AssertEqual</code> method.</p>
<pre><code>import <span>unittest</span>

<span>class</span> <span>TestCar</span>(<span>unittest</span>.<span>TestCase</span>):
    <span>def</span> <span><strong>test_car_equal</strong></span>(self):
       <span>car1</span> = <span>Car</span>(<span>40</span>, <span>'red'</span>)
       <span>car2</span> = <span>Car</span>(<span>40</span>, <span>'red'</span>)
       self.<span>assertEqual</span>(<span>car1</span>, <span>car2</span>)</code></pre>
<p>If you now try to run this test, the test case will fail.</p>
<pre><code>self.<span>assertEqual</span>(<span>Car</span>(<span>40</span>, <span>'red'</span>), <span>Car</span>(<span>40</span>, <span>'red'</span>))
<span><strong>AssertionError</strong></span>: &lt;<span>assert</span>.<span>Car</span><span> object </span><span>at</span> <span>0x7f8edbc078d0</span>&gt; != &lt;<span>assert</span>.<span>Car</span><span> object </span><span>at </span><span>0x7f8edbc07908</span>&gt;
</code></pre>
<p>This is because unittest doesn’t know how to compare two Car objects.</p>
<p>So, we have a two options to make this work:<br/>
1. We can define a <code>__eq__</code> method in <code>Car</code> class.<br/>
2. We can create a custom assertion class.</p>
<h4>1. __eq__ method</h4>
<p><code>__eq__</code> is one of the rich comparison methods. Whenever <code>==</code> is used on any object its <code>__eq__</code> method is called. For example <code>car1 == car2</code> internally calls <code>car1.__eq__(car2)</code>.</p>
<p>Our new car class:</p>
<pre><code><span>class</span> <span>Car</span>:
   <span>def</span> <span><strong>__init__</strong></span>(self, <span>speed</span>, <span>color</span>):
      self.<span>speed</span> = <span>speed</span>
      self.<span>color</span> = <span>color</span>

   <span>def</span> <span><strong>__eq__</strong></span>(self, <span>another_car</span>):
       <span>if</span> <span>type</span>(self)==<span>type</span>(<span>another_car</span>) <span><strong>and</strong></span> self.<span>speed</span>==<span>another_car</span>.<span>speed</span> <span><strong>and</strong></span>
               self.<span>color</span>==<span>another_car</span>.<span>color</span>:
           <span>return</span> True
        <span>else</span>:
           <span>return </span>False</code></pre>
<p>And now the same test passes. But when car1 is not equal to car2, the test fails and the output is not at all informative about why the test failed. It simply prints:</p>
<pre><code>self.<span>assertEqual</span>(<span>car1</span>, <span>car2</span>)
<span><strong>AssertionError</strong></span>: &lt;<span>Car</span> <span>object </span><span>at</span> <span>0x7f1f86af6a20</span>&gt; != &lt;<span>Car</span> <span>object </span><span>at</span> <span>0x7f1f86af6a58</span>&gt;</code></pre>
<p>So, one drawback of this approach is that we can’t show some message about why the equality failed. Showing an error message by printing it wouldn’t be a good design because when the user does a simple <code>car1 == car2</code> and if they are not equal, <code>__eq__</code> would still print the details of why they are not equal.</p>
<p>Now, we see the second approach in which we can give a detailed message about why the equality failed.</p>
<h4>2. Custom assertion class</h4>
<p>We can write a custom assertion class for out car class.</p>
<pre><code><span>class</span> <span>AssertCarEqual</span>:
    <span>def </span><span><strong>assert_car_equal</strong></span>(self, <span>car1</span>, <span>car2</span>):
        <span>if</span> <span>type</span>(<span>car1</span>) != <span>type</span>(<span>car2</span>):
            <span>raise</span> <span><strong>AssertionError</strong></span>(<span>"car1 is of type: "</span>, <span>type</span>(<span>car1</span>), <span>" and car2 is of type: "</span>, <span>type</span>(<span>car2</span>))
        <span>elif </span><span>car1</span>.<span>speed</span> != <span>car2</span>.<span>speed</span>:
            <span>raise</span> <span><strong>AssertionError</strong></span>(<span>"speed of car1: "</span>, <span>car1</span>.<span>speed</span>, <span>" and speed of car2: "</span>, <span>car2</span>.<span>speed</span>)
        <span>elif </span><span>car1</span>.<span>color</span> != <span>car2</span>.<span>color</span>:
            <span>raise</span> <span><strong>AssertionError</strong></span>(<span>"color of car1: "</span>, <span>car1</span>.<span>color</span>, <span>" and color of car2: "</span>, <span>car2</span>.<span>color</span>)</code></pre>
<p>And modifying the test like this:</p>
<pre><code><span>class </span><span>TestCar</span>(<span>unittest</span>.<span>TestCase</span>, <span>AssertCarEqual</span>):
    <span>def</span> <span><strong>test_car_equal</strong></span>(self):
        <span>car1</span> = <span>car</span>.<span>Car</span>(<span>40</span>, <span>'blue'</span>)
        <span>car2</span> = <span>car</span>.<span>Car</span>(<span>40</span>, <span>'red'</span>)
        self.<span>assert_car_equal</span>(<span>car1</span>,<span>car2</span>)</code></pre>
<p>Now when we run the test, the test fails and gives a message about why the test failed.</p>
<pre><code><span>raise</span> <span><strong>AssertionError</strong></span>(<span>"color of car1: "</span>, <span>car1.</span><span>color</span>, <span>" and color of car2: "</span>, <span>car2</span>.<span>color</span>)
<span><strong>AssertionError</strong></span>: (<span>'color of car1: '</span>, <span>'blue'</span>, <span>' and color of car2: '</span>, <span>'red'</span>)</code></pre>
<hr/>
<p dir="ltr"><a href="https://www.codementor.io/ankurankan"><img class=" wp-image-50 alignleft" src="https://s3.amazonaws.com/codementor_content/2014-Sep-Week1/ankuar.jpg" alt="Ankur Ankan"/></a><strong>Need Ankur’s help? Book a 1-on-1 session! </strong></p>
<p><a href="https://www.codementor.io/ankurankan"><button type="button">View Ankur’s Profile </button></a></p>
<p>or <a href="http://www.codementor.io/mentor/apply" target="_blank">join us as an expert mentor</a>!</p>
<p id="workrooms-extension-is-installed"/>


</div>


</div></body></html>