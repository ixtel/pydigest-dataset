<html><body><div><div class="content-body" itemprop="text articleBody">
	<div class="section" id="introduction">
<h2>Introduction</h2>
<p>A common task for python and pandas is to automate the process of aggregating
data from multiple files and spreadsheets.</p>
<p>This article will walk through the basic flow required to parse multiple Excel files, combine
the data, clean it up and analyze it. The combination of python + <a class="reference external" href="http://pandas.pydata.org/">pandas</a> can be extremely
powerful for these activities and can be a very useful alternative to the manual processes or painful <span class="caps">VBA</span> scripts
frequently used in business settings today.</p>
</div>
<div class="section" id="the-problem">
<h2>The Problem</h2>
<p>Before, I get into the examples, here is a simple diagram showing the challenges with
the common process used in businesses all over the world to consolidate data from multiple
Excel files, clean it up and perform some analysis.</p>

<p>If you’re reading this article, I suspect you have experienced some of the problems
shown above. Cutting and pasting data or writing painful <span class="caps">VBA</span> code will quickly get old.
There has to be a better way!</p>
<p>Python + pandas can be a great alternative that is much more scaleable and powerful.</p>

<p>By using a python script, you can develop a more streamlined and repeatable solution to
your data processing needs. The rest of this article will show a simple example of how
this process works. I hope it will give you ideas of how to apply these tools to your unique situation.</p>
</div>
<div class="section" id="collecting-the-data">
<h2>Collecting the Data</h2>
<p>If you are interested in following along, here are the excel files and a link to the notebook:</p>

<p>The first step in the process is collecting all the data into one place.</p>
<p>First, import pandas and numpy</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
<p>Let’s take a look at the files in our input directory, using the
convenient shell commands in ipython.</p>

<pre class="literal-block">
address-state-example.xlsx  report.xlsx                sample-address-new.xlsx
customer-status.xlsx            sales-feb-2014.xlsx    sample-address-old.xlsx
excel-comp-data.xlsx            sales-jan-2014.xlsx    sample-diff-1.xlsx
my-diff-1.xlsx                  sales-mar-2014.xlsx    sample-diff-2.xlsx
my-diff-2.xlsx                  sample-address-1.xlsx  sample-salesv3.xlsx
my-diff.xlsx                    sample-address-2.xlsx
pricing.xlsx                    sample-address-3.xlsx
</pre>
<p>There are a lot of files, but we only want to look at the sales .xlsx files.</p>

<pre class="literal-block">
../in/sales-feb-2014.xlsx  ../in/sales-jan-2014.xlsx  ../in/sales-mar-2014.xlsx
</pre>
<p>Use the python <code class="code">
glob</code>
 module to easily list out the files we need.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">glob</span>
<span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">"../in/sales*.xlsx"</span><span class="p">)</span>
</pre></div>
<pre class="literal-block">
['../in/sales-jan-2014.xlsx',
 '../in/sales-mar-2014.xlsx',
 '../in/sales-feb-2014.xlsx']
</pre>
<p>This gives us what we need.  Let’s import each of our files and combine
them into one file.
Panda’s <code class="code">
concat</code>
 and <code class="code">
append</code>
 can do this for us. I’m going to use <code class="code">
append</code>
 in
this example.</p>
<p>The code snippet below will initialize a blank DataFrame then append all
of the individual files into the <code class="code">
all_data</code>
 DataFrame.</p>
<div class="highlight"><pre><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">"../in/sales*.xlsx"</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<p>Now we have all the data in our <code class="code">
all_data</code>
 DataFrame. You can use
<code class="code">
describe</code>
 to look at it and make sure you data looks good.</p>

<div>
<table border="1" class="dataframe">
<thead>
<tr>
<th/>
<th>account number</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
</tr>
</thead>
<tbody>
<tr>
<th>count</th>
<td>   1742.000000</td>
<td> 1742.000000</td>
<td> 1742.000000</td>
<td> 1742.000000</td>
</tr>
<tr>
<th>mean</th>
<td> 485766.487945</td>
<td>   24.319173</td>
<td>   54.985454</td>
<td> 1349.229392</td>
</tr>
<tr>
<th>std</th>
<td> 223750.660792</td>
<td>   14.502759</td>
<td>   26.108490</td>
<td> 1094.639319</td>
</tr>
<tr>
<th>min</th>
<td> 141962.000000</td>
<td>   -1.000000</td>
<td>   10.030000</td>
<td>  -97.160000</td>
</tr>
<tr>
<th>25%</th>
<td> 257198.000000</td>
<td>   12.000000</td>
<td>   32.132500</td>
<td>  468.592500</td>
</tr>
<tr>
<th>50%</th>
<td> 527099.000000</td>
<td>   25.000000</td>
<td>   55.465000</td>
<td> 1049.700000</td>
</tr>
<tr>
<th>75%</th>
<td> 714466.000000</td>
<td>   37.000000</td>
<td>   77.607500</td>
<td> 2074.972500</td>
</tr>
<tr>
<th>max</th>
<td> 786968.000000</td>
<td>   49.000000</td>
<td>   99.850000</td>
<td> 4824.540000</td>
</tr>
</tbody>
</table>
</div><p>A lot of this data may not make much sense for this data set but I’m most
interested in the count row to make sure the number of data elements
makes sense. In this case, I see all the data rows I expect.</p>

<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td> 740150</td>
<td>                  Barton <span class="caps">LLC</span></td>
<td> B1-20000</td>
<td> 39</td>
<td> 86.69</td>
<td> 3380.91</td>
<td> 2014-01-01 07:21:51</td>
</tr>
<tr>
<th>1</th>
<td> 714466</td>
<td>             Trantow-Barrows</td>
<td> S2-77896</td>
<td> -1</td>
<td> 63.16</td>
<td>  -63.16</td>
<td> 2014-01-01 10:00:47</td>
</tr>
<tr>
<th>2</th>
<td> 218895</td>
<td>                   Kulas Inc</td>
<td> B1-69924</td>
<td> 23</td>
<td> 90.70</td>
<td> 2086.10</td>
<td> 2014-01-01 13:24:58</td>
</tr>
<tr>
<th>3</th>
<td> 307599</td>
<td> Kassulke, Ondricka and Metz</td>
<td> S1-65481</td>
<td> 41</td>
<td> 21.05</td>
<td>  863.05</td>
<td> 2014-01-01 15:05:22</td>
</tr>
<tr>
<th>4</th>
<td> 412290</td>
<td>               Jerde-Hilpert</td>
<td> S2-34077</td>
<td>  6</td>
<td> 83.21</td>
<td>  499.26</td>
<td> 2014-01-01 23:26:55</td>
</tr>
</tbody>
</table>
</div><p>It is not critical in this example but the best practice is to convert
the date column to a date time object.</p>
<div class="highlight"><pre><span class="n">all_data</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="s">'date'</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="combining-data">
<h2>Combining Data</h2>
<p>Now that we have all of the data into one DataFrame, we can do any
manipulations the DataFrame supports. In this case, the next thing we
want to do is read in another file that contains the customer status by
account. You can think of this as a company’s customer segmentation
strategy or some other mechanism for identifying their customers.</p>
<p>First, we read in the data.</p>
<div class="highlight"><pre><span class="n">status</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s">"../in/customer-status.xlsx"</span><span class="p">)</span>
<span class="n">status</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>0 </th>
<td> 740150</td>
<td>                      Barton <span class="caps">LLC</span></td>
<td>   gold</td>
</tr>
<tr>
<th>1 </th>
<td> 714466</td>
<td>                 Trantow-Barrows</td>
<td> silver</td>
</tr>
<tr>
<th>2 </th>
<td> 218895</td>
<td>                       Kulas Inc</td>
<td> bronze</td>
</tr>
<tr>
<th>3 </th>
<td> 307599</td>
<td>     Kassulke, Ondricka and Metz</td>
<td> bronze</td>
</tr>
<tr>
<th>4 </th>
<td> 412290</td>
<td>                   Jerde-Hilpert</td>
<td> bronze</td>
</tr>
<tr>
<th>5 </th>
<td> 729833</td>
<td>                       Koepp Ltd</td>
<td> silver</td>
</tr>
<tr>
<th>6 </th>
<td> 146832</td>
<td>                    Kiehn-Spinka</td>
<td> silver</td>
</tr>
<tr>
<th>7 </th>
<td> 688981</td>
<td>                     Keeling <span class="caps">LLC</span></td>
<td> silver</td>
</tr>
<tr>
<th>8 </th>
<td> 786968</td>
<td>        Frami, Hills and Schmidt</td>
<td> silver</td>
</tr>
<tr>
<th>9 </th>
<td> 239344</td>
<td>                      Stokes <span class="caps">LLC</span></td>
<td>   gold</td>
</tr>
<tr>
<th>10</th>
<td> 672390</td>
<td>                 Kuhn-Gusikowski</td>
<td> silver</td>
</tr>
<tr>
<th>11</th>
<td> 141962</td>
<td>                      Herman <span class="caps">LLC</span></td>
<td>   gold</td>
</tr>
<tr>
<th>12</th>
<td> 424914</td>
<td>                   White-Trantow</td>
<td> silver</td>
</tr>
<tr>
<th>13</th>
<td> 527099</td>
<td>                Sanford and Sons</td>
<td> bronze</td>
</tr>
<tr>
<th>14</th>
<td> 642753</td>
<td>                     Pollich <span class="caps">LLC</span></td>
<td> bronze</td>
</tr>
<tr>
<th>15</th>
<td> 257198</td>
<td> Cronin, Oberbrunner and Spencer</td>
<td>   gold</td>
</tr>
</tbody>
</table>
</div><p>We want to merge this data with our concatenated data set of sales. Use panda’s <code class="code">
merge</code>

function and tell it to do a left join which is similar to Excel’s vlookup function.</p>
<div class="highlight"><pre><span class="n">all_data_st</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'left'</span><span class="p">)</span>
<span class="n">all_data_st</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td> 740150</td>
<td>                  Barton <span class="caps">LLC</span></td>
<td> B1-20000</td>
<td> 39</td>
<td> 86.69</td>
<td> 3380.91</td>
<td>2014-01-01 07:21:51</td>
<td>   gold</td>
</tr>
<tr>
<th>1</th>
<td> 714466</td>
<td>             Trantow-Barrows</td>
<td> S2-77896</td>
<td> -1</td>
<td> 63.16</td>
<td>  -63.16</td>
<td>2014-01-01 10:00:47</td>
<td> silver</td>
</tr>
<tr>
<th>2</th>
<td> 218895</td>
<td>                   Kulas Inc</td>
<td> B1-69924</td>
<td> 23</td>
<td> 90.70</td>
<td> 2086.10</td>
<td>2014-01-01 13:24:58</td>
<td> bronze</td>
</tr>
<tr>
<th>3</th>
<td> 307599</td>
<td> Kassulke, Ondricka and Metz</td>
<td> S1-65481</td>
<td> 41</td>
<td> 21.05</td>
<td>  863.05</td>
<td>2014-01-01 15:05:22</td>
<td> bronze</td>
</tr>
<tr>
<th>4</th>
<td> 412290</td>
<td>               Jerde-Hilpert</td>
<td> S2-34077</td>
<td>  6</td>
<td> 83.21</td>
<td>  499.26</td>
<td>2014-01-01 23:26:55</td>
<td> bronze</td>
</tr>
</tbody>
</table>
</div><p>This looks pretty good but let’s look at a specific account.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="p">[</span><span class="n">all_data_st</span><span class="p">[</span><span class="s">"account number"</span><span class="p">]</span><span class="o">==</span><span class="mi">737550</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>9 </th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> S2-82423</td>
<td> 14</td>
<td> 81.92</td>
<td> 1146.88</td>
<td>2014-01-03 19:07:37</td>
<td> NaN</td>
</tr>
<tr>
<th>14</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> B1-53102</td>
<td> 23</td>
<td> 71.56</td>
<td> 1645.88</td>
<td>2014-01-04 08:57:48</td>
<td> NaN</td>
</tr>
<tr>
<th>26</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> B1-53636</td>
<td> 42</td>
<td> 42.06</td>
<td> 1766.52</td>
<td>2014-01-08 00:02:11</td>
<td> NaN</td>
</tr>
<tr>
<th>32</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> S1-27722</td>
<td> 20</td>
<td> 29.54</td>
<td>  590.80</td>
<td>2014-01-09 13:20:40</td>
<td> NaN</td>
</tr>
<tr>
<th>42</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> S1-93683</td>
<td> 22</td>
<td> 71.68</td>
<td> 1576.96</td>
<td>2014-01-11 23:47:36</td>
<td> NaN</td>
</tr>
</tbody>
</table>
</div><p>This account number was not in our status file, so we have a bunch of
NaN’s. We can decide how we want to handle this situation. For this
specific case, let’s label all missing accounts as bronze. Use the
<code class="code">
fillna</code>
 function to easily accomplish this on the status column.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s">'bronze'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">all_data_st</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td> 740150</td>
<td>                  Barton <span class="caps">LLC</span></td>
<td> B1-20000</td>
<td> 39</td>
<td> 86.69</td>
<td> 3380.91</td>
<td>2014-01-01 07:21:51</td>
<td>   gold</td>
</tr>
<tr>
<th>1</th>
<td> 714466</td>
<td>             Trantow-Barrows</td>
<td> S2-77896</td>
<td> -1</td>
<td> 63.16</td>
<td>  -63.16</td>
<td>2014-01-01 10:00:47</td>
<td> silver</td>
</tr>
<tr>
<th>2</th>
<td> 218895</td>
<td>                   Kulas Inc</td>
<td> B1-69924</td>
<td> 23</td>
<td> 90.70</td>
<td> 2086.10</td>
<td>2014-01-01 13:24:58</td>
<td> bronze</td>
</tr>
<tr>
<th>3</th>
<td> 307599</td>
<td> Kassulke, Ondricka and Metz</td>
<td> S1-65481</td>
<td> 41</td>
<td> 21.05</td>
<td>  863.05</td>
<td>2014-01-01 15:05:22</td>
<td> bronze</td>
</tr>
<tr>
<th>4</th>
<td> 412290</td>
<td>               Jerde-Hilpert</td>
<td> S2-34077</td>
<td>  6</td>
<td> 83.21</td>
<td>  499.26</td>
<td>2014-01-01 23:26:55</td>
<td> bronze</td>
</tr>
</tbody>
</table>
</div><p>Check the data just to make sure we’re all good.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="p">[</span><span class="n">all_data_st</span><span class="p">[</span><span class="s">"account number"</span><span class="p">]</span><span class="o">==</span><span class="mi">737550</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>9 </th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> S2-82423</td>
<td> 14</td>
<td> 81.92</td>
<td> 1146.88</td>
<td>2014-01-03 19:07:37</td>
<td> bronze</td>
</tr>
<tr>
<th>14</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> B1-53102</td>
<td> 23</td>
<td> 71.56</td>
<td> 1645.88</td>
<td>2014-01-04 08:57:48</td>
<td> bronze</td>
</tr>
<tr>
<th>26</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> B1-53636</td>
<td> 42</td>
<td> 42.06</td>
<td> 1766.52</td>
<td>2014-01-08 00:02:11</td>
<td> bronze</td>
</tr>
<tr>
<th>32</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> S1-27722</td>
<td> 20</td>
<td> 29.54</td>
<td>  590.80</td>
<td>2014-01-09 13:20:40</td>
<td> bronze</td>
</tr>
<tr>
<th>42</th>
<td> 737550</td>
<td> Fritsch, Russel and Anderson</td>
<td> S1-93683</td>
<td> 22</td>
<td> 71.68</td>
<td> 1576.96</td>
<td>2014-01-11 23:47:36</td>
<td> bronze</td>
</tr>
</tbody>
</table>
</div><p>Now we have all of the data along with the status column filled in. We
can do our normal data manipulations using the full suite of pandas capability.</p>
</div>
<div class="section" id="using-categories">
<h2>Using Categories</h2>
<p>One of the relatively new functions in pandas is support for categorical
data. From the pandas, documentation:</p>
<blockquote>
Categoricals are a pandas data type, which correspond to categorical
variables in statistics: a variable, which can take on only a limited,
and usually fixed, number of possible values (categories; levels in R).
Examples are gender, social class, blood types, country affiliations,
observation time or ratings via Likert scales.</blockquote>
<p>For our purposes, the status field is a good candidate for a category type.</p>
<div class="panel panel-warning">
<p class="panel-heading">
Version Warning</p>
<p class="panel-body">
You must make sure you have a recent version of pandas ( &gt; 0.15) installed for this example to work.</p>
</div>

<pre class="literal-block">
'0.15.2'
</pre>
<p>First, we typecast it the column to a category using <code class="code">
astype</code>
.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_data_st</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">"category"</span><span class="p">)</span>
</pre></div>
<p>This doesn’t immediately appear to change anything yet.</p>

<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td> 740150</td>
<td>                  Barton <span class="caps">LLC</span></td>
<td> B1-20000</td>
<td> 39</td>
<td> 86.69</td>
<td> 3380.91</td>
<td>2014-01-01 07:21:51</td>
<td>   gold</td>
</tr>
<tr>
<th>1</th>
<td> 714466</td>
<td>             Trantow-Barrows</td>
<td> S2-77896</td>
<td> -1</td>
<td> 63.16</td>
<td>  -63.16</td>
<td>2014-01-01 10:00:47</td>
<td> silver</td>
</tr>
<tr>
<th>2</th>
<td> 218895</td>
<td>                   Kulas Inc</td>
<td> B1-69924</td>
<td> 23</td>
<td> 90.70</td>
<td> 2086.10</td>
<td>2014-01-01 13:24:58</td>
<td> bronze</td>
</tr>
<tr>
<th>3</th>
<td> 307599</td>
<td> Kassulke, Ondricka and Metz</td>
<td> S1-65481</td>
<td> 41</td>
<td> 21.05</td>
<td>  863.05</td>
<td>2014-01-01 15:05:22</td>
<td> bronze</td>
</tr>
<tr>
<th>4</th>
<td> 412290</td>
<td>               Jerde-Hilpert</td>
<td> S2-34077</td>
<td>  6</td>
<td> 83.21</td>
<td>  499.26</td>
<td>2014-01-01 23:26:55</td>
<td> bronze</td>
</tr>
</tbody>
</table>
</div><p>Buy you can see that it is a new data type.</p>

<pre class="literal-block">
account number             int64
name                      object
sku                       object
quantity                   int64
unit price               float64
ext price                float64
date              datetime64[ns]
status                  category
dtype: object
</pre>
<p>Categories get more interesting when you assign order to the categories.
Right now, if we call <code class="code">
sort</code>
 on the column, it will sort alphabetically.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"status"</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>1741</th>
<td> 642753</td>
<td>      Pollich <span class="caps">LLC</span></td>
<td> B1-04202</td>
<td>  8</td>
<td> 95.86</td>
<td>  766.88</td>
<td>2014-02-28 23:47:32</td>
<td> bronze</td>
</tr>
<tr>
<th>1232</th>
<td> 218895</td>
<td>        Kulas Inc</td>
<td> S1-06532</td>
<td> 29</td>
<td> 42.75</td>
<td> 1239.75</td>
<td>2014-09-21 11:27:55</td>
<td> bronze</td>
</tr>
<tr>
<th>579 </th>
<td> 527099</td>
<td> Sanford and Sons</td>
<td> S1-27722</td>
<td> 41</td>
<td> 87.86</td>
<td> 3602.26</td>
<td>2014-04-14 18:36:11</td>
<td> bronze</td>
</tr>
<tr>
<th>580 </th>
<td> 383080</td>
<td>         Will <span class="caps">LLC</span></td>
<td> B1-20000</td>
<td> 40</td>
<td> 51.73</td>
<td> 2069.20</td>
<td>2014-04-14 22:44:58</td>
<td> bronze</td>
</tr>
<tr>
<th>581 </th>
<td> 383080</td>
<td>         Will <span class="caps">LLC</span></td>
<td> S2-10342</td>
<td> 15</td>
<td> 76.75</td>
<td> 1151.25</td>
<td>2014-04-15 02:57:43</td>
<td> bronze</td>
</tr>
</tbody>
</table>
</div><p>We use <code class="code">
set_categories</code>
 to tell it the order we want to use for this
category object. In this case, we use the Olympic medal ordering.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">set_categories</span><span class="p">([</span> <span class="s">"gold"</span><span class="p">,</span><span class="s">"silver"</span><span class="p">,</span><span class="s">"bronze"</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<p>Now, we can sort it so that gold shows on top.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"status"</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th>account number</th>
<th>name</th>
<th>sku</th>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
<th>date</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<th>0   </th>
<td> 740150</td>
<td>                      Barton <span class="caps">LLC</span></td>
<td> B1-20000</td>
<td> 39</td>
<td> 86.69</td>
<td> 3380.91</td>
<td>2014-01-01 07:21:51</td>
<td> gold</td>
</tr>
<tr>
<th>1193</th>
<td> 257198</td>
<td> Cronin, Oberbrunner and Spencer</td>
<td> S2-82423</td>
<td> 23</td>
<td> 52.90</td>
<td> 1216.70</td>
<td>2014-09-09 03:06:30</td>
<td> gold</td>
</tr>
<tr>
<th>1194</th>
<td> 141962</td>
<td>                      Herman <span class="caps">LLC</span></td>
<td> B1-86481</td>
<td> 45</td>
<td> 52.78</td>
<td> 2375.10</td>
<td>2014-09-09 11:49:45</td>
<td> gold</td>
</tr>
<tr>
<th>1195</th>
<td> 257198</td>
<td> Cronin, Oberbrunner and Spencer</td>
<td> B1-50809</td>
<td> 30</td>
<td> 51.96</td>
<td> 1558.80</td>
<td>2014-09-09 21:14:31</td>
<td> gold</td>
</tr>
<tr>
<th>1197</th>
<td> 239344</td>
<td>                      Stokes <span class="caps">LLC</span></td>
<td> B1-65551</td>
<td> 43</td>
<td> 15.24</td>
<td>  655.32</td>
<td>2014-09-10 11:10:02</td>
<td> gold</td>
</tr>
</tbody>
</table>
</div></div>
<div class="section" id="analyze-data">
<h2>Analyze Data</h2>
<p>The final step in the process is to analyze the data. Now that it is consolidated and
cleaned, we can see if there are any insights to be learned.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
<pre class="literal-block">
count       1742
unique         3
top       bronze
freq         764
Name: status, dtype: object
</pre>
<p>For instance, if you want to take a quick look at how your top tier
customers are performaing compared to the bottom. Use <code class="code">
groupby</code>
 to get
the average of the values.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"status"</span><span class="p">])[</span><span class="s">"quantity"</span><span class="p">,</span><span class="s">"unit price"</span><span class="p">,</span><span class="s">"ext price"</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
<div>
<table border="1" class="dataframe">
<thead>
<tr>
<th/>
<th>quantity</th>
<th>unit price</th>
<th>ext price</th>
</tr>
<tr>
<th>status</th>
<th/>
<th/>
<th/>
</tr>
</thead>
<tbody>
<tr>
<th>gold</th>
<td> 24.680723</td>
<td> 52.431205</td>
<td> 1325.566867</td>
</tr>
<tr>
<th>silver</th>
<td> 23.814241</td>
<td> 55.724241</td>
<td> 1339.477539</td>
</tr>
<tr>
<th>bronze</th>
<td> 24.589005</td>
<td> 55.470733</td>
<td> 1367.757736</td>
</tr>
</tbody>
</table>
</div><p>Of course, you can run multiple aggregation functions on the data to get
really useful information</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"status"</span><span class="p">])[</span><span class="s">"quantity"</span><span class="p">,</span><span class="s">"unit price"</span><span class="p">,</span><span class="s">"ext price"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
</pre></div>
<div>
<table border="1" class="table table-condensed">
<thead>
<tr>
<th/>
<th colspan="3" halign="left">quantity</th>
<th colspan="3" halign="left">unit price</th>
<th colspan="3" halign="left">ext price</th>
</tr>
<tr>
<th/>
<th>sum</th>
<th>mean</th>
<th>std</th>
<th>sum</th>
<th>mean</th>
<th>std</th>
<th>sum</th>
<th>mean</th>
<th>std</th>
</tr>
<tr>
<th>status</th>
<th/>
<th/>
<th/>
<th/>
<th/>
<th/>
<th/>
<th/>
<th/>
</tr>
</thead>
<tbody>
<tr>
<th>gold</th>
<td>  8194</td>
<td> 24.680723</td>
<td> 14.478670</td>
<td> 17407.16</td>
<td> 52.431205</td>
<td> 26.244516</td>
<td>  440088.20</td>
<td> 1325.566867</td>
<td> 1074.564373</td>
</tr>
<tr>
<th>silver</th>
<td> 15384</td>
<td> 23.814241</td>
<td> 14.519044</td>
<td> 35997.86</td>
<td> 55.724241</td>
<td> 26.053569</td>
<td>  865302.49</td>
<td> 1339.477539</td>
<td> 1094.908529</td>
</tr>
<tr>
<th>bronze</th>
<td> 18786</td>
<td> 24.589005</td>
<td> 14.506515</td>
<td> 42379.64</td>
<td> 55.470733</td>
<td> 26.062149</td>
<td> 1044966.91</td>
<td> 1367.757736</td>
<td> 1104.129089</td>
</tr>
</tbody>
</table>
</div><p>So, what does this tell you? Well, the data is completely random but my
first observation is that we sell more units to our bronze customers
than gold. Even when you look at the total dollar value associated with
bronze vs. gold, it looks odd that we sell more to bronze customers than gold.</p>
<p>Maybe we should look at how many bronze customers we have and see what
is going on?</p>
<p>What I plan to do is filter out the unique accounts and see how many
gold, silver and bronze customers there are.</p>
<p>I’m purposely stringing a lot of commands together which is not
necessarily best practice but does show how powerful pandas can be. Feel
free to review my previous article <a class="reference external" href="http://pbpython.com/excel-pandas-comp.html">here</a> <a class="reference external" href="http://pbpython.com/excel-pandas-comp-2.html">and here</a> to understand it better.
Play with this command yourself to understand how the commands interact.</p>
<div class="highlight"><pre><span class="n">all_data_st</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s">"account number"</span><span class="p">,</span><span class="s">"name"</span><span class="p">])</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"status"</span><span class="p">])[</span><span class="s">"name"</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
<pre class="literal-block">
status
gold      4
silver    7
bronze    9
Name: name, dtype: int64
</pre>
<p>Ok. This makes a little more sense. We see that we have 9 bronze
customers and only 4 customers. That is probably why the volumes are so
skewed towards our bronze customers. This result makes sense given the fact
that we defaulted to bronze for many of our customers. Maybe we should
reclassify some of them? Obviously this data is fake but hopefully this
shows how you can use these tools to quickly analyze your own data.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>This example only covered the aggregation of 4 simple Excel files containing random data. However
the principles can be applied to much larger data sets yet you can keep the code
base very manageable. Additionally, you have the full power of python at your
fingertips so you can do much more than just simply manipulate the data.</p>
<p>I encourage you to try some of these concepts out on your scenarios and
see if you can find a way to automate that painful Excel task that hangs
over your head every day, week or month.</p>
<p>Good luck!</p>
</div>

  </div>
  
</div></body></html>